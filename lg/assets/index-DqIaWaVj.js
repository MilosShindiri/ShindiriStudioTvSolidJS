var Q4 = Object.defineProperty;
var J4 = (u, n, i) =>
  n in u ? Q4(u, n, { enumerable: !0, configurable: !0, writable: !0, value: i }) : (u[n] = i);
var j = (u, n, i) => J4(u, typeof n != "symbol" ? n + "" : n, i);
function oY() {
  (import.meta.url, import("_").catch(() => 1), (async function* () {})().next());
}
(function () {
  const n = document.createElement("link").relList;
  if (n && n.supports && n.supports("modulepreload")) return;
  for (const l of document.querySelectorAll('link[rel="modulepreload"]')) o(l);
  new MutationObserver(l => {
    for (const h of l)
      if (h.type === "childList")
        for (const p of h.addedNodes) p.tagName === "LINK" && p.rel === "modulepreload" && o(p);
  }).observe(document, { childList: !0, subtree: !0 });
  function i(l) {
    const h = {};
    return (
      l.integrity && (h.integrity = l.integrity),
      l.referrerPolicy && (h.referrerPolicy = l.referrerPolicy),
      l.crossOrigin === "use-credentials"
        ? (h.credentials = "include")
        : l.crossOrigin === "anonymous"
          ? (h.credentials = "omit")
          : (h.credentials = "same-origin"),
      h
    );
  }
  function o(l) {
    if (l.ep) return;
    l.ep = !0;
    const h = i(l);
    fetch(l.href, h);
  }
})();
function Z4(u, n = !1, i) {
  const o = {
      alpha: !0,
      antialias: !1,
      depth: !1,
      stencil: !0,
      desynchronized: !1,
      powerPreference: "high-performance",
      premultipliedAlpha: !0,
      preserveDrawingBuffer: !1,
    },
    l = u.getContext(n ? "webgl2" : "webgl", o) || u.getContext("experimental-webgl", o);
  if (!l) throw new Error("Unable to create WebGL context");
  return i
    ? new Proxy(l, {
        get(h, p) {
          const d = h[p];
          return typeof d == "function" ? (i.increment(String(p)), d.bind(h)) : d;
        },
      })
    : l;
}
function Qx(u, n, i) {
  const o = Math.trunc(u >>> 24),
    l = Math.trunc((u >>> 16) & 255),
    h = Math.trunc((u >>> 8) & 255),
    p = Math.trunc(u & 255),
    d = Math.trunc(n >>> 24),
    y = Math.trunc((n >>> 16) & 255),
    v = Math.trunc((n >>> 8) & 255),
    T = Math.trunc(n & 255),
    S = Math.round(d * i + o * (1 - i)),
    w = Math.round(y * i + l * (1 - i)),
    C = Math.round(v * i + h * (1 - i)),
    L = Math.round(T * i + p * (1 - i));
  return ((S << 24) | (w << 16) | (C << 8) | L) >>> 0;
}
function e$(u, n) {
  const i = u >>> 24,
    o = (u >>> 16) & 255,
    l = (u >>> 8) & 255,
    h = Math.trunc((u & 255) * n);
  return ((i << 24) | (o << 16) | (l << 8) | h) >>> 0;
}
let rD = !0;
function t$(u) {
  rD = u === "webgl";
}
function _p(u, n, i = !1) {
  const o = ((u & 255) / 255) * n,
    l = rD ? o : 1,
    h = Math.trunc((u >>> 24) * l),
    p = Math.trunc(((u >>> 16) & 255) * l),
    d = Math.trunc(((u >>> 8) & 255) * l),
    y = Math.trunc(o * 255);
  return i ? ((y << 24) | (d << 16) | (p << 8) | h) >>> 0 : ((h << 24) | (p << 16) | (d << 8) | y) >>> 0;
}
function Sg(u, n) {
  return Object.prototype.hasOwnProperty.call(u, n);
}
const n$ = !0;
let i$ = 1;
function r$() {
  return i$++;
}
let Fo = class {
  constructor() {
    j(this, "eventListeners", {});
  }
  on(n, i) {
    let o = this.eventListeners[n];
    (o || (o = []), o.push(i), (this.eventListeners[n] = o));
  }
  off(n, i) {
    const o = this.eventListeners[n];
    if (!o) return;
    if (!i) {
      delete this.eventListeners[n];
      return;
    }
    const l = o.indexOf(i);
    l >= 0 && o.splice(l, 1);
  }
  once(n, i) {
    const o = (l, h) => {
      (this.off(n, o), i(l, h));
    };
    this.on(n, o);
  }
  emit(n, i) {
    const o = this.eventListeners[n];
    o &&
      [...o].forEach(l => {
        l(this, i);
      });
  }
  removeAllListeners() {
    this.eventListeners = {};
  }
};
var _i;
(function (u) {
  ((u[(u.generic = 0)] = "generic"),
    (u[(u.color = 1)] = "color"),
    (u[(u.image = 2)] = "image"),
    (u[(u.noise = 3)] = "noise"),
    (u[(u.renderToTexture = 4)] = "renderToTexture"),
    (u[(u.subTexture = 5)] = "subTexture"));
})(_i || (_i = {}));
const Wg = class Wg extends Fo {
  constructor(i) {
    super();
    j(this, "txManager");
    j(this, "_dimensions", null);
    j(this, "_error", null);
    j(this, "state", "initial");
    j(this, "renderableOwners", []);
    j(this, "renderable", !1);
    j(this, "type", _i.generic);
    j(this, "preventCleanup", !1);
    j(this, "ctxTexture");
    j(this, "textureData", null);
    j(this, "memUsed", 0);
    j(this, "retryCount", 0);
    j(this, "maxRetryCount");
    j(this, "createdAt", Date.now());
    j(this, "gracePeriodExpired", !1);
    ((this.txManager = i), (this.maxRetryCount = i.maxRetryCount));
  }
  get dimensions() {
    return this._dimensions;
  }
  get error() {
    return this._error;
  }
  isWithinStartupGracePeriod() {
    return this.gracePeriodExpired
      ? !1
      : Date.now() - this.createdAt >= Wg.STARTUP_GRACE_PERIOD
        ? ((this.gracePeriodExpired = !0), !1)
        : !0;
  }
  canBeCleanedUp() {
    return !(
      this.preventCleanup ||
      this.isWithinStartupGracePeriod() ||
      this.renderable === !0 ||
      this.renderableOwners.length > 0
    );
  }
  setRenderableOwner(i, o) {
    var p, d;
    const l = this.renderableOwners.length,
      h = this.renderableOwners.indexOf(i);
    if (o === !0) {
      h === -1 && this.renderableOwners.push(i);
      const y = this.renderableOwners.length;
      l !== y &&
        y === 1 &&
        ((this.renderable = !0), (p = this.onChangeIsRenderable) == null || p.call(this, !0), this.load());
    } else {
      h !== -1 && this.renderableOwners.splice(h, 1);
      const y = this.renderableOwners.length;
      l !== y &&
        y === 0 &&
        ((this.renderable = !1), (d = this.onChangeIsRenderable) == null || d.call(this, !1));
    }
  }
  load() {
    this.retryCount > this.maxRetryCount || this.txManager.loadTexture(this);
  }
  loadCtxTexture() {
    return (
      this.ctxTexture === void 0 && (this.ctxTexture = this.txManager.renderer.createCtxTexture(this)),
      this.ctxTexture
    );
  }
  free() {
    var i;
    (i = this.ctxTexture) == null || i.free();
  }
  release() {
    var i;
    ((i = this.ctxTexture) == null || i.release(), (this.ctxTexture = void 0), this.freeTextureData());
  }
  destroy() {
    (this.state === "loaded" && this.free(), this.freeTextureData());
  }
  freeTextureData() {
    queueMicrotask(() => {
      this.textureData = null;
    });
  }
  setState(i, o) {
    if (this.state === i) return;
    let l = null;
    (i === "loaded"
      ? ((this._error = null),
        o !== void 0 &&
          "width" in o &&
          "height" in o &&
          o.width !== void 0 &&
          o.height !== void 0 &&
          (this._dimensions = o),
        (l = this._dimensions))
      : i === "failed"
        ? ((this._error = o),
          (l = this._error),
          (this.retryCount += 1),
          queueMicrotask(() => {
            this.release();
          }))
        : i === "loading"
          ? ((this._error = null), (this._dimensions = null))
          : (this._error = null),
      (this.state = i),
      this.emit(i, l));
  }
  async getTextureData() {
    return (
      this.textureData === null && (this.textureData = await this.getTextureSource()),
      this.textureData
    );
  }
  static makeCacheKey(i) {
    return !1;
  }
  static resolveDefaults(i) {
    return {};
  }
  retry() {
    (this.release(), (this.retryCount = 0), this.load());
  }
};
j(Wg, "STARTUP_GRACE_PERIOD", 2e3);
let Sa = Wg;
const s$ = /^(data|ftps?|https?):/,
  Xg = u => {
    const n = u >>> 24,
      i = (u >>> 16) & 255,
      o = (u >>> 8) & 255,
      l = u & 255;
    return [n / 255, i / 255, o / 255, l / 255];
  };
function Jl(u, n, i, o, l) {
  return l ? ((l.x1 = u), (l.y1 = n), (l.x2 = i), (l.y2 = o), l) : { x1: u, y1: n, x2: i, y2: o };
}
function nx(u, n) {
  return u.x1 < n.x2 && u.x2 > n.x1 && u.y1 < n.y2 && u.y2 > n.y1;
}
function o$(u, n) {
  return n
    ? ((n.x = u.x1), (n.y = u.y1), (n.width = u.x2 - u.x1), (n.height = u.y2 - u.y1), n)
    : { x: u.x1, y: u.y1, width: u.x2 - u.x1, height: u.y2 - u.y1 };
}
function sD(u, n, i) {
  const o = Math.max(u.x, n.x),
    l = Math.max(u.y, n.y),
    h = Math.min(u.x + u.width, n.x + n.width) - o,
    p = Math.min(u.y + u.height, n.y + n.height) - l;
  return h > 0 && p > 0
    ? i
      ? ((i.x = o), (i.y = l), (i.width = h), (i.height = p), i)
      : { x: o, y: l, width: h, height: p }
    : i
      ? ((i.x = 0), (i.y = 0), (i.width = 0), (i.height = 0), i)
      : { x: 0, y: 0, width: 0, height: 0 };
}
function oD(u, n) {
  return n
    ? ((n.x = u.x), (n.y = u.y), (n.width = u.width), (n.height = u.height), n)
    : { x: u.x, y: u.y, width: u.width, height: u.height };
}
function a$(u, n) {
  return u === n
    ? !0
    : u === null || n === null
      ? !1
      : u.x === n.x && u.y === n.y && u.width === n.width && u.height === n.height;
}
function ix(u, n) {
  return u.x1 <= n.x2 && u.y1 <= n.y2 && u.x2 >= n.x1 && u.y2 >= n.y1;
}
function l$(u, n) {
  return u.x1 < n.x1 && u.x2 > n.x2 && u.y1 < n.y1 && u.y2 > n.y2;
}
function u$(u, n, i) {
  return !(u < i.x1 || u > i.x2 || n < i.y1 || n > i.y2);
}
function c$(u) {
  return u.x1 < u.x2 && u.y1 < u.y2;
}
function Jx(u, n) {
  return Jl(u.x1 - n[3], u.y1 - n[0], u.x2 + n[1], u.y2 + n[2]);
}
function d$(u) {
  if (self.location.protocol === "file:" && !s$.test(u)) {
    const i = self.location.pathname.split("/");
    i.pop();
    const o = i.join("/"),
      l = self.location.protocol + "//" + o;
    return (u.charAt(0) === "." && (u = u.slice(1)), u.charAt(0) === "/" && (u = u.slice(1)), l + "/" + u);
  }
  return new URL(u, self.location.href).href;
}
function rx(u) {
  return u.startsWith("data:") === !0;
}
function h$(u) {
  var y, v;
  u = u.replace(/^data:/, "");
  const n = ((y = u.match(/image\/[^;]+/)) == null ? void 0 : y[0]) || "",
    i = u.replace(/^[^,]+,/, ""),
    o = 1024,
    l = atob(i),
    h = l.length,
    p = Math.ceil(h / o),
    d = new Array(p);
  for (let T = 0; T < p; ++T) {
    const S = T * o,
      w = Math.min(S + o, h),
      C = new Array(w - S);
    for (let L = S, k = 0; L < w; ++k, ++L) C[k] = (v = l[L]) == null ? void 0 : v.charCodeAt(0);
    d[T] = new Uint8Array(C);
  }
  return new Blob(d, { type: n });
}
class Zn {
  constructor() {
    j(this, "ta");
    j(this, "tb");
    j(this, "tx");
    j(this, "tc");
    j(this, "td");
    j(this, "ty");
    j(this, "_floatArr", null);
    j(this, "mutation");
    ((this.ta = 0),
      (this.tb = 0),
      (this.tx = 0),
      (this.tc = 0),
      (this.td = 0),
      (this.ty = 0),
      (this.mutation = !0));
  }
  static get temp() {
    return f$;
  }
  static multiply(n, i, o) {
    const l = n.ta * i.ta + n.tb * i.tc,
      h = n.ta * i.tb + n.tb * i.td,
      p = n.ta * i.tx + n.tb * i.ty + n.tx,
      d = n.tc * i.ta + n.td * i.tc,
      y = n.tc * i.tb + n.td * i.td,
      v = n.tc * i.tx + n.td * i.ty + n.ty;
    return (
      o || (o = new Zn()),
      (o.ta = l),
      (o.tb = h),
      (o.tx = p),
      (o.tc = d),
      (o.td = y),
      (o.ty = v),
      (o.mutation = !0),
      o
    );
  }
  static identity(n) {
    return (
      n || (n = new Zn()),
      (n.ta = 1),
      (n.tb = 0),
      (n.tx = 0),
      (n.tc = 0),
      (n.td = 1),
      (n.ty = 0),
      (n.mutation = !0),
      n
    );
  }
  static translate(n, i, o) {
    return (
      o || (o = new Zn()),
      (o.ta = 1),
      (o.tb = 0),
      (o.tx = n),
      (o.tc = 0),
      (o.td = 1),
      (o.ty = i),
      (o.mutation = !0),
      o
    );
  }
  static scale(n, i, o) {
    return (
      o || (o = new Zn()),
      (o.ta = n),
      (o.tb = 0),
      (o.tx = 0),
      (o.tc = 0),
      (o.td = i),
      (o.ty = 0),
      (o.mutation = !0),
      o
    );
  }
  static rotate(n, i) {
    const o = Math.cos(n),
      l = Math.sin(n);
    return (
      i || (i = new Zn()),
      (i.ta = o),
      (i.tb = -l),
      (i.tx = 0),
      (i.tc = l),
      (i.td = o),
      (i.ty = 0),
      (i.mutation = !0),
      i
    );
  }
  static copy(n, i) {
    return (
      i || (i = new Zn()),
      (i.ta = n.ta),
      (i.tc = n.tc),
      (i.tb = n.tb),
      (i.td = n.td),
      (i.tx = n.tx),
      (i.ty = n.ty),
      (i.mutation = !0),
      i
    );
  }
  translate(n, i) {
    return (
      (this.tx = this.ta * n + this.tb * i + this.tx),
      (this.ty = this.tc * n + this.td * i + this.ty),
      (this.mutation = !0),
      this
    );
  }
  scale(n, i) {
    return (
      (this.ta = this.ta * n),
      (this.tb = this.tb * i),
      (this.tc = this.tc * n),
      (this.td = this.td * i),
      (this.mutation = !0),
      this
    );
  }
  rotate(n) {
    if (n === 0 || !((n % Math.PI) * 2)) return this;
    const i = Math.cos(n),
      o = Math.sin(n),
      l = this.ta * i + this.tb * o,
      h = this.tb * i - this.ta * o,
      p = this.tc * i + this.td * o,
      d = this.td * i - this.tc * o;
    return ((this.ta = l), (this.tb = h), (this.tc = p), (this.td = d), (this.mutation = !0), this);
  }
  multiply(n) {
    return Zn.multiply(this, n, this);
  }
  getFloatArr() {
    return (
      this._floatArr || (this._floatArr = new Float32Array(9)),
      this.mutation &&
        ((this._floatArr[0] = this.ta),
        (this._floatArr[1] = this.tc),
        (this._floatArr[2] = 0),
        (this._floatArr[3] = this.tb),
        (this._floatArr[4] = this.td),
        (this._floatArr[5] = 0),
        (this._floatArr[6] = this.tx),
        (this._floatArr[7] = this.ty),
        (this._floatArr[8] = 1),
        (this.mutation = !1)),
      this._floatArr
    );
  }
}
const f$ = new Zn(),
  bp = 0,
  Dp = 2,
  kp = 4,
  Mp = 6,
  Pp = 1,
  Op = 3,
  Np = 5,
  Fp = 7;
class Zl {
  constructor(n) {
    j(this, "data");
    ((this.data = new Float32Array(8)),
      n &&
        ((this.data[bp] = n[bp]),
        (this.data[Dp] = n[Dp]),
        (this.data[kp] = n[kp]),
        (this.data[Mp] = n[Mp]),
        (this.data[Pp] = n[Pp]),
        (this.data[Op] = n[Op]),
        (this.data[Np] = n[Np]),
        (this.data[Fp] = n[Fp])));
  }
  static translate(n, i, o, l, h, p, d, y, v) {
    return (
      v || (v = new Zl()),
      (v.data[bp] = n),
      (v.data[Dp] = o),
      (v.data[kp] = h),
      (v.data[Mp] = d),
      (v.data[Pp] = i),
      (v.data[Op] = l),
      (v.data[Np] = p),
      (v.data[Fp] = y),
      v
    );
  }
  get x1() {
    return this.data[bp];
  }
  get x2() {
    return this.data[Dp];
  }
  get x3() {
    return this.data[kp];
  }
  get x4() {
    return this.data[Mp];
  }
  get y1() {
    return this.data[Pp];
  }
  get y2() {
    return this.data[Op];
  }
  get y3() {
    return this.data[Np];
  }
  get y4() {
    return this.data[Fp];
  }
}
const aD = (u, n, i, o) => {
    const l = 3 * u,
      h = 3 * (i - u) - l,
      p = 1 - l - h,
      d = 3 * n,
      y = 3 * (o - n) - d,
      v = 1 - d - y;
    return function (T) {
      if (T >= 1) return 1;
      if (T <= 0) return 0;
      let S = 0.5,
        w,
        C,
        L;
      for (let B = 0; B < 20; B++) {
        if (((w = S * (S * (S * p + h) + l)), (L = T - w), L > -1e-8 && L < 1e-8))
          return S * (S * (S * v + y) + d);
        if (((C = S * (S * (3 * p) + 2 * h) + l), C > 1e-10 && C < 1e-10)) break;
        S += L / C;
      }
      let k = 0,
        O = 1;
      for (let B = 0; B < 20; B++) {
        if (((S = 0.5 * (k + O)), (w = S * (S * (S * p + h) + l)), (L = T - w), L > -1e-8 && L < 1e-8))
          return S * (S * (S * v + y) + d);
        L < 0 ? (O = S) : (k = S);
      }
    };
  },
  sg = {},
  p$ = {
    ease: [0.25, 0.1, 0.25, 1],
    "ease-in": [0.42, 0, 1, 1],
    "ease-out": [0, 0, 0.58, 1],
    "ease-in-out": [0.42, 0, 0.58, 1],
    "ease-in-sine": [0.12, 0, 0.39, 0],
    "ease-out-sine": [0.12, 0, 0.39, 0],
    "ease-in-out-sine": [0.37, 0, 0.63, 1],
    "ease-in-cubic": [0.32, 0, 0.67, 0],
    "ease-out-cubic": [0.33, 1, 0.68, 1],
    "ease-in-out-cubic": [0.65, 0, 0.35, 1],
    "ease-in-circ": [0.55, 0, 1, 0.45],
    "ease-out-circ": [0, 0.55, 0.45, 1],
    "ease-in-out-circ": [0.85, 0, 0.15, 1],
    "ease-in-back": [0.36, 0, 0.66, -0.56],
    "ease-out-back": [0.34, 1.56, 0.64, 1],
    "ease-in-out-back": [0.68, -0.6, 0.32, 1.6],
  },
  og = u => u,
  g$ = u => {
    const n = /-?\d*\.?\d+/g,
      i = u.match(n);
    if (i) {
      const [o, l, h, p] = i,
        d = parseFloat(o || "0.42"),
        y = parseFloat(l || "0"),
        v = parseFloat(h || "1"),
        T = parseFloat(p || "1"),
        S = aD(d, y, v, T);
      return ((sg[u] = S), S);
    }
    return (console.warn("Unknown cubic-bezier timing: " + u), og);
  },
  lD = u => {
    if (u === "linear") return og;
    if (sg[u] !== void 0) return sg[u] || og;
    if (u === "step-start") return () => 1;
    if (u === "step-end") return i => (i === 1 ? 1 : 0);
    const n = p$[u];
    if (n !== void 0) {
      const [i, o, l, h] = n,
        p = aD(i, o, l, h);
      return ((sg[u] = p), p);
    }
    return u.startsWith("cubic-bezier") ? g$(u) : (console.warn("Unknown timing function: " + u), og);
  };
function ML(u) {
  return (u / 1024 / 1024).toFixed(2);
}
class m$ extends Fo {
  constructor(i, o, l) {
    var d, y, v, T, S, w;
    super();
    j(this, "node");
    j(this, "props");
    j(this, "settings");
    j(this, "progress", 0);
    j(this, "delayFor", 0);
    j(this, "delay", 0);
    j(this, "timingFunction");
    j(this, "propValuesMap", {});
    j(this, "dynPropValuesMap");
    ((this.node = i), (this.props = o));
    for (const C in o)
      if (C !== "shaderProps")
        (this.propValuesMap.props === void 0 && (this.propValuesMap.props = {}),
          (this.propValuesMap.props[C] = { start: i[C] || 0, target: o[C] }));
      else if (i.shader.type !== "DynamicShader") {
        this.propValuesMap.shaderProps = {};
        for (const L in o.shaderProps)
          this.propValuesMap.shaderProps[L] = { start: i.shader.props[L], target: o.shaderProps[L] };
      } else {
        const L = Object.keys(o.shaderProps),
          k = L.length;
        this.dynPropValuesMap = {};
        for (let O = 0; O < k; O++) {
          const B = L[O],
            N = o.shaderProps[B];
          this.dynPropValuesMap[B] = {};
          const $ = Object.entries(N),
            I = $.length;
          for (let V = 0; V < I; V++) {
            const [oe, Y] = $[V];
            this.dynPropValuesMap[B][oe] = { start: i.shader.props[B][oe], target: Y };
          }
        }
      }
    const h = l.easing || "linear",
      p = (d = l.delay) != null ? d : 0;
    ((this.settings = {
      duration: (y = l.duration) != null ? y : 0,
      delay: p,
      easing: h,
      loop: (v = l.loop) != null ? v : !1,
      repeat: (T = l.repeat) != null ? T : 0,
      repeatDelay: (S = l.repeatDelay) != null ? S : 0,
      stopMethod: (w = l.stopMethod) != null ? w : !1,
    }),
      (this.timingFunction = lD(h)),
      (this.delayFor = p),
      (this.delay = p));
  }
  reset() {
    ((this.progress = 0), (this.delayFor = this.settings.delay || 0), this.update(0));
  }
  restoreValues(i, o) {
    const l = Object.entries(o),
      h = l.length;
    for (let p = 0; p < h; p++) {
      const [d, y] = l[p];
      i[d] = y.start;
    }
  }
  restore() {
    if (
      (this.reset(),
      this.propValuesMap.props !== void 0 && this.restoreValues(this.node, this.propValuesMap.props),
      this.propValuesMap.shaderProps !== void 0 &&
        this.restoreValues(this.node.shader.props, this.propValuesMap.shaderProps),
      this.dynPropValuesMap !== void 0)
    ) {
      const i = Object.keys(this.dynPropValuesMap),
        o = i.length;
      if (o > 0)
        for (let l = 0; l < o; l++) {
          const h = i[l];
          this.restoreValues(this.node.shader.props[h], this.dynPropValuesMap[h]);
        }
    }
  }
  reverseValues(i) {
    const o = Object.entries(i),
      l = o.length;
    for (let h = 0; h < l; h++) {
      const [p, d] = o[h];
      i[p] = { start: d.target, target: d.start };
    }
  }
  reverse() {
    if (
      ((this.progress = 0),
      this.propValuesMap.props !== void 0 && this.reverseValues(this.propValuesMap.props),
      this.propValuesMap.shaderProps !== void 0 && this.reverseValues(this.propValuesMap.shaderProps),
      this.dynPropValuesMap !== void 0)
    ) {
      const i = Object.keys(this.dynPropValuesMap),
        o = i.length;
      if (o > 0)
        for (let l = 0; l < o; l++) {
          const h = i[l];
          this.reverseValues(this.dynPropValuesMap[h]);
        }
    }
    this.settings.loop || (this.settings.stopMethod = !1);
  }
  applyEasing(i, o, l) {
    return (this.timingFunction(i) || i) * (l - o) + o;
  }
  updateValue(i, o, l, h) {
    if (this.progress === 1) return o;
    if (this.progress === 0) return l;
    const p = o;
    if (i.indexOf("color") !== -1) {
      if (l === p) return l;
      if (h) {
        const d = this.timingFunction(this.progress) || this.progress;
        return Qx(l, p, d);
      }
      return Qx(l, p, this.progress);
    }
    return h ? this.applyEasing(this.progress, l, p) : l + (p - l) * this.progress;
  }
  updateValues(i, o, l) {
    const h = Object.entries(o),
      p = h.length;
    for (let d = 0; d < p; d++) {
      const [y, v] = h[d];
      i[y] = this.updateValue(y, v.target, v.start, l);
    }
  }
  update(i) {
    const { duration: o, loop: l, easing: h, stopMethod: p } = this.settings,
      { delayFor: d } = this;
    if (this.node.destroyed) {
      this.emit("destroyed", {});
      return;
    }
    if (o === 0 && d === 0) {
      this.emit("finished", {});
      return;
    }
    if (this.delayFor > 0) {
      if (((this.delayFor -= i), this.delayFor >= 0)) return;
      ((i = -this.delayFor), (this.delayFor = 0));
    }
    if (o === 0) {
      this.emit("finished", {});
      return;
    }
    if (
      (this.progress === 0 && this.emit("animating", {}),
      (this.progress += i / o),
      this.progress > 1 && ((this.progress = l ? 0 : 1), (this.delayFor = this.delay), p))
    ) {
      this.emit("finished", {});
      return;
    }
    if (
      (this.propValuesMap.props !== void 0 && this.updateValues(this.node, this.propValuesMap.props, h),
      this.propValuesMap.shaderProps !== void 0 &&
        this.updateValues(this.node.shader.props, this.propValuesMap.shaderProps, h),
      this.dynPropValuesMap !== void 0)
    ) {
      const y = Object.keys(this.dynPropValuesMap),
        v = y.length;
      if (v > 0)
        for (let T = 0; T < v; T++) {
          const S = y[T];
          this.updateValues(this.node.shader.props[S], this.dynPropValuesMap[S], h);
        }
    }
    (this.progress < 1 && this.emit("tick", { progress: this.progress }),
      this.progress === 1 && this.emit("finished", {}));
  }
}
class y$ extends Fo {
  constructor(i, o) {
    super();
    j(this, "manager");
    j(this, "animation");
    j(this, "stoppedPromise");
    j(this, "stoppedResolve", null);
    j(this, "state");
    ((this.manager = i),
      (this.animation = o),
      (this.state = "stopped"),
      (this.stoppedPromise = Promise.resolve()),
      (this.onAnimating = this.onAnimating.bind(this)),
      (this.onFinished = this.onFinished.bind(this)),
      (this.onTick = this.onTick.bind(this)),
      (this.onDestroy = this.onDestroy.bind(this)));
  }
  start() {
    return (
      this.state !== "running" &&
        this.state !== "scheduled" &&
        (this.makeStoppedPromise(), this.registerAnimation(), (this.state = "scheduled")),
      this
    );
  }
  stop() {
    return (
      this.unregisterAnimation(),
      this.stoppedResolve !== null &&
        (this.stoppedResolve(), (this.stoppedResolve = null), this.emit("stopped", this)),
      this.animation.reset(),
      (this.state = "stopped"),
      this
    );
  }
  pause() {
    return (this.unregisterAnimation(), (this.state = "paused"), this);
  }
  restore() {
    return ((this.stoppedResolve = null), this.animation.restore(), this);
  }
  waitUntilStopped() {
    return this.stoppedPromise;
  }
  registerAnimation() {
    (this.animation.once("finished", this.onFinished),
      this.animation.on("animating", this.onAnimating),
      this.animation.on("tick", this.onTick),
      this.animation.on("destroyed", this.onDestroy),
      this.manager.registerAnimation(this.animation));
  }
  unregisterAnimation() {
    (this.manager.unregisterAnimation(this.animation),
      this.animation.off("finished", this.onFinished),
      this.animation.off("animating", this.onAnimating),
      this.animation.off("tick", this.onTick),
      this.animation.off("destroy", this.onDestroy));
  }
  makeStoppedPromise() {
    this.stoppedResolve === null &&
      (this.stoppedPromise = new Promise(i => {
        this.stoppedResolve = i;
      }));
  }
  onDestroy() {
    (this.unregisterAnimation(), (this.state = "stopped"));
  }
  onFinished() {
    const { loop: i, stopMethod: o } = this.animation.settings;
    if (o === "reverse") {
      (this.animation.once("finished", this.onFinished), this.animation.reverse());
      return;
    }
    i ||
      (this.unregisterAnimation(),
      this.stoppedResolve !== null && (this.stoppedResolve(), (this.stoppedResolve = null)),
      this.emit("stopped", this),
      (this.state = "stopped"));
  }
  onAnimating() {
    ((this.state = "running"), this.emit("animating", this));
  }
  onTick(i, o) {
    this.emit("tick", o);
  }
}
var si;
(function (u) {
  ((u[(u.Init = 0)] = "Init"),
    (u[(u.OutOfBounds = 2)] = "OutOfBounds"),
    (u[(u.InBounds = 4)] = "InBounds"),
    (u[(u.InViewport = 8)] = "InViewport"));
})(si || (si = {}));
const Md = new Map();
Md.set(si.Init, "init");
Md.set(si.OutOfBounds, "outOfBounds");
Md.set(si.InBounds, "inBounds");
Md.set(si.InViewport, "inViewport");
var Ie;
(function (u) {
  ((u[(u.Children = 1)] = "Children"),
    (u[(u.ScaleRotate = 2)] = "ScaleRotate"),
    (u[(u.Local = 4)] = "Local"),
    (u[(u.Global = 8)] = "Global"),
    (u[(u.Clipping = 16)] = "Clipping"),
    (u[(u.CalculatedZIndex = 32)] = "CalculatedZIndex"),
    (u[(u.ZIndexSortedChildren = 64)] = "ZIndexSortedChildren"),
    (u[(u.PremultipliedColors = 128)] = "PremultipliedColors"),
    (u[(u.WorldAlpha = 256)] = "WorldAlpha"),
    (u[(u.RenderState = 512)] = "RenderState"),
    (u[(u.IsRenderable = 1024)] = "IsRenderable"),
    (u[(u.RenderTexture = 2048)] = "RenderTexture"),
    (u[(u.ParentRenderTexture = 4096)] = "ParentRenderTexture"),
    (u[(u.RenderBounds = 8192)] = "RenderBounds"),
    (u[(u.None = 0)] = "None"),
    (u[(u.All = 14335)] = "All"));
})(Ie || (Ie = {}));
class Zx extends Fo {
  constructor(i, o) {
    super();
    j(this, "stage");
    j(this, "children", []);
    j(this, "_id", r$());
    j(this, "props");
    j(this, "updateType", Ie.All);
    j(this, "childUpdateType", Ie.None);
    j(this, "globalTransform");
    j(this, "scaleRotateTransform");
    j(this, "localTransform");
    j(this, "sceneGlobalTransform");
    j(this, "renderCoords");
    j(this, "sceneRenderCoords");
    j(this, "renderBound");
    j(this, "strictBound");
    j(this, "preloadBound");
    j(this, "clippingRect", { x: 0, y: 0, width: 0, height: 0, valid: !1 });
    j(this, "isRenderable", !1);
    j(this, "renderState", si.Init);
    j(this, "worldAlpha", 1);
    j(this, "premultipliedColorTl", 0);
    j(this, "premultipliedColorTr", 0);
    j(this, "premultipliedColorBl", 0);
    j(this, "premultipliedColorBr", 0);
    j(this, "calcZIndex", 0);
    j(this, "hasRTTupdates", !1);
    j(this, "parentHasRenderTexture", !1);
    j(this, "rttParent", null);
    j(this, "destroyed", !1);
    j(this, "onTextureLoaded", (i, o) => {
      var l, h;
      (this.autosizeNode(o),
        this.setUpdateType(Ie.IsRenderable),
        this.stage.requestRender(),
        this.parentHasRenderTexture && this.notifyParentRTTOfUpdate(),
        o.width > 1 && o.height > 1 && this.emit("loaded", { type: "texture", dimensions: o }),
        ((h = (l = this.props.textureOptions) == null ? void 0 : l.resizeMode) == null ? void 0 : h.type) ===
          "contain" && this.setUpdateType(Ie.Local));
    });
    j(this, "onTextureFailed", (i, o) => {
      ((this.isRenderable = !1),
        this.updateTextureOwnership(!1),
        this.setUpdateType(Ie.IsRenderable),
        this.parentHasRenderTexture && this.notifyParentRTTOfUpdate(),
        this.texture !== null &&
          this.texture.retryCount > this.texture.maxRetryCount &&
          this.emit("failed", { type: "texture", error: o }));
    });
    j(this, "onTextureFreed", () => {
      ((this.isRenderable = !1),
        this.updateTextureOwnership(!1),
        this.setUpdateType(Ie.IsRenderable),
        this.parentHasRenderTexture && this.notifyParentRTTOfUpdate(),
        this.emit("freed", { type: "texture" }));
    });
    ((this.stage = i),
      (this.props = { ...o, parent: null, texture: null, src: null, rtt: !1 }),
      (this.parent = o.parent),
      (this.texture = o.texture),
      (this.src = o.src),
      (this.rtt = o.rtt),
      (this.interactive = o.interactive),
      o.boundsMargin &&
        (this.boundsMargin = Array.isArray(o.boundsMargin)
          ? o.boundsMargin
          : [o.boundsMargin, o.boundsMargin, o.boundsMargin, o.boundsMargin]),
      this.setUpdateType(Ie.ScaleRotate | Ie.Local | Ie.RenderBounds | Ie.RenderState),
      this.stage.defaultTexture &&
        this.stage.defaultTexture.state !== "loaded" &&
        this.stage.defaultTexture.once("loaded", () => {
          this.setUpdateType(Ie.IsRenderable);
        }));
  }
  loadTexture() {
    const { texture: i } = this.props;
    queueMicrotask(() => {
      var o, l;
      if (
        (this.textureOptions.preload === !0 && this.stage.txManager.loadTexture(i),
        (i.preventCleanup =
          (l = (o = this.props.textureOptions) == null ? void 0 : o.preventCleanup) != null ? l : !1),
        i.on("loaded", this.onTextureLoaded),
        i.on("failed", this.onTextureFailed),
        i.on("freed", this.onTextureFreed),
        i.state === "loaded"
          ? (i.dimensions, this.onTextureLoaded(i, i.dimensions))
          : i.state === "failed"
            ? (i.error, this.onTextureFailed(i, i.error))
            : i.state === "freed" && this.onTextureFreed(i),
        this.parentHasRenderTexture)
      ) {
        this.notifyParentRTTOfUpdate();
        return;
      }
    });
  }
  unloadTexture() {
    this.texture !== null &&
      (this.texture.off("loaded", this.onTextureLoaded),
      this.texture.off("failed", this.onTextureFailed),
      this.texture.off("freed", this.onTextureFreed),
      this.texture.setRenderableOwner(this._id, !1));
  }
  autosizeNode(i) {
    this.autosize && ((this.width = i.width), (this.height = i.height));
  }
  setUpdateType(i) {
    this.updateType |= i;
    const o = this.props.parent;
    o && (o.updateType & Ie.Children) === 0 && o.setUpdateType(Ie.Children);
  }
  sortChildren() {
    this.children.sort((i, o) => i.calcZIndex - o.calcZIndex);
  }
  updateScaleRotateTransform() {
    const { rotation: i, scaleX: o, scaleY: l } = this.props;
    if (i === 0 && o === 1 && l === 1) {
      this.scaleRotateTransform = void 0;
      return;
    }
    this.scaleRotateTransform = Zn.rotate(i, this.scaleRotateTransform).scale(o, l);
  }
  updateLocalTransform() {
    var v, T;
    const { x: i, y: o, width: l, height: h } = this.props,
      p = this.props.mountX * l,
      d = this.props.mountY * h;
    if (this.scaleRotateTransform) {
      const S = this.props.pivotX * l,
        w = this.props.pivotY * h;
      this.localTransform = Zn.translate(i - p + S, o - d + w, this.localTransform)
        .multiply(this.scaleRotateTransform)
        .translate(-S, -w);
    } else this.localTransform = Zn.translate(i - p, o - d, this.localTransform);
    const y = this.props.texture;
    if (
      y &&
      y.dimensions &&
      ((T = (v = this.props.textureOptions) == null ? void 0 : v.resizeMode) == null ? void 0 : T.type) ===
        "contain"
    ) {
      let S = 1,
        w = 1,
        C = 0,
        L = 0;
      const { width: k, height: O } = y.dimensions,
        B = k / O,
        N = l / h;
      if (B > N) {
        const $ = l / k,
          I = O * $;
        ((L = (h - I) / 2), (w = I / h));
      } else {
        const $ = h / O,
          I = k * $;
        ((C = (l - I) / 2), (S = I / l));
      }
      this.localTransform.translate(C, L).scale(S, w);
    }
    this.setUpdateType(Ie.Global);
  }
  update(i, o) {
    (this.updateType & Ie.ScaleRotate && (this.updateScaleRotateTransform(), this.setUpdateType(Ie.Local)),
      this.updateType & Ie.Local && (this.updateLocalTransform(), this.setUpdateType(Ie.Global)));
    const l = this.props.parent;
    let h = null;
    if (
      (this.updateType & Ie.RenderTexture && this.rtt && (this.hasRTTupdates = !0),
      this.updateType & Ie.Global &&
        (this.localTransform,
        this.parentHasRenderTexture === !0 && (l == null ? void 0 : l.rtt) === !0
          ? ((this.globalTransform = Zn.identity()),
            (this.sceneGlobalTransform = Zn.copy(
              (l == null ? void 0 : l.globalTransform) || Zn.identity(),
            ).multiply(this.localTransform)))
          : this.parentHasRenderTexture === !0 && (l == null ? void 0 : l.rtt) === !1
            ? ((this.sceneGlobalTransform = Zn.copy(
                (l == null ? void 0 : l.sceneGlobalTransform) || this.localTransform,
              ).multiply(this.localTransform)),
              (this.globalTransform = Zn.copy(
                (l == null ? void 0 : l.globalTransform) || this.localTransform,
                this.globalTransform,
              )))
            : (this.globalTransform = Zn.copy(
                (l == null ? void 0 : l.globalTransform) || this.localTransform,
                this.globalTransform,
              )),
        l !== null && this.globalTransform.multiply(this.localTransform),
        this.calculateRenderCoords(),
        this.updateBoundingRect(),
        this.setUpdateType(Ie.RenderState | Ie.Children),
        (this.childUpdateType |= Ie.Global),
        this.clipping === !0 &&
          (this.setUpdateType(Ie.Clipping | Ie.RenderBounds), (this.childUpdateType |= Ie.RenderBounds))),
      this.updateType & Ie.RenderBounds &&
        (this.createRenderBounds(),
        this.setUpdateType(Ie.RenderState),
        this.setUpdateType(Ie.Children),
        (this.childUpdateType |= Ie.RenderBounds)),
      this.updateType & Ie.RenderState &&
        ((h = this.checkRenderBounds()),
        this.setUpdateType(Ie.IsRenderable),
        h !== si.OutOfBounds && this.updateRenderState(h)),
      this.updateType & Ie.WorldAlpha &&
        (l ? (this.worldAlpha = l.worldAlpha * this.props.alpha) : (this.worldAlpha = this.props.alpha),
        this.setUpdateType(Ie.Children | Ie.PremultipliedColors | Ie.IsRenderable),
        (this.childUpdateType |= Ie.WorldAlpha)),
      this.updateType & Ie.IsRenderable && this.updateIsRenderable(),
      this.updateType & Ie.Clipping &&
        (this.calculateClippingRect(o),
        this.setUpdateType(Ie.Children),
        (this.childUpdateType |= Ie.Clipping),
        (this.childUpdateType |= Ie.RenderBounds)),
      this.updateType & Ie.PremultipliedColors &&
        ((this.premultipliedColorTl = _p(this.props.colorTl, this.worldAlpha, !0)),
        this.props.colorTl === this.props.colorTr &&
        this.props.colorBl === this.props.colorBr &&
        this.props.colorTl === this.props.colorBl
          ? (this.premultipliedColorTr =
              this.premultipliedColorBl =
              this.premultipliedColorBr =
                this.premultipliedColorTl)
          : ((this.premultipliedColorTr = _p(this.props.colorTr, this.worldAlpha, !0)),
            (this.premultipliedColorBl = _p(this.props.colorBl, this.worldAlpha, !0)),
            (this.premultipliedColorBr = _p(this.props.colorBr, this.worldAlpha, !0)))),
      l !== null &&
        this.updateType & Ie.CalculatedZIndex &&
        (this.calculateZIndex(), l.setUpdateType(Ie.ZIndexSortedChildren)),
      this.props.strictBounds === !0 && this.renderState === si.OutOfBounds)
    ) {
      this.updateType &= ~Ie.RenderBounds;
      return;
    }
    if (this.updateType & Ie.Children && this.children.length > 0)
      for (let p = 0, d = this.children.length; p < d; p++) {
        const y = this.children[p];
        if ((y.setUpdateType(this.childUpdateType), y.updateType === 0)) continue;
        let v = this.clippingRect;
        (this.rtt === !0 && (v = { x: 0, y: 0, width: 0, height: 0, valid: !1 }), y.update(i, v));
      }
    (this.parentHasRenderTexture && this.updateType > 0 && this.notifyParentRTTOfUpdate(),
      this.updateType & Ie.ZIndexSortedChildren && this.sortChildren(),
      h === si.OutOfBounds &&
        (this.updateRenderState(h),
        this.updateIsRenderable(),
        this.rtt === !0 && h === si.OutOfBounds && this.notifyChildrenRTTOfUpdate(h)),
      (this.updateType = 0),
      (this.childUpdateType = 0));
  }
  findParentRTTNode() {
    let i = this.parent;
    for (; i && !i.rtt; ) i = i.parent;
    return i;
  }
  getRTTParentRenderState() {
    const i = this.rttParent || this.findParentRTTNode();
    return i ? i.renderState : null;
  }
  notifyChildrenRTTOfUpdate(i) {
    for (const o of this.children)
      (o.updateRenderState(i), o.updateIsRenderable(), o.notifyChildrenRTTOfUpdate(i));
  }
  notifyParentRTTOfUpdate() {
    if (this.parent === null) return;
    const i = this.rttParent || this.findParentRTTNode();
    i &&
      ((i.hasRTTupdates = !0),
      i.setUpdateType(Ie.RenderTexture),
      i.parentHasRenderTexture === !0 && i.notifyParentRTTOfUpdate());
  }
  checkRenderBounds() {
    return (
      this.renderBound,
      this.strictBound,
      this.preloadBound,
      ix(this.renderBound, this.strictBound)
        ? si.InViewport
        : ix(this.renderBound, this.preloadBound)
          ? si.InBounds
          : l$(this.renderBound, this.strictBound)
            ? si.InViewport
            : this.parent !== null && (this.props.width === 0 || this.props.height === 0)
              ? this.parent.renderState
              : si.OutOfBounds
    );
  }
  updateBoundingRect() {
    const i = this.sceneGlobalTransform || this.globalTransform,
      o = this.sceneRenderCoords || this.renderCoords,
      { tb: l, tc: h } = i,
      { x1: p, y1: d, x3: y, y3: v } = o;
    if (l === 0 || h === 0) this.renderBound = Jl(p, d, y, v, this.renderBound);
    else {
      const { x2: T, x4: S, y2: w, y4: C } = o;
      this.renderBound = Jl(
        Math.min(p, T, y, S),
        Math.min(d, w, v, C),
        Math.max(p, T, y, S),
        Math.max(d, w, v, C),
        this.renderBound,
      );
    }
  }
  createRenderBounds() {
    if ((this.stage, this.parent !== null && this.parent.strictBound !== void 0)) {
      const T = this.parent.strictBound;
      ((this.strictBound = Jl(T.x1, T.y1, T.x2, T.y2)),
        (this.preloadBound = Jx(this.strictBound, this.boundsMargin)));
    } else ((this.strictBound = this.stage.strictBound), (this.preloadBound = this.stage.preloadBound));
    if (
      this.props.clipping === !1 ||
      this.renderBound === void 0 ||
      ix(this.renderBound, this.strictBound) === !1
    )
      return;
    const { x: i, y: o, width: l, height: h } = this.props,
      { tx: p, ty: d } = this.sceneGlobalTransform || this.globalTransform || {},
      y = p != null ? p : i,
      v = d != null ? d : o;
    ((this.strictBound = Jl(y, v, y + l, v + h, this.strictBound)),
      (this.preloadBound = Jx(this.strictBound, this.boundsMargin)));
  }
  updateRenderState(i) {
    if (i === this.renderState) return;
    const o = this.renderState;
    this.renderState = i;
    const l = Md.get(i);
    this.emit(l, { previous: o, current: i });
  }
  updateIsRenderable() {
    let i = !1,
      o = !1;
    if (this.checkBasicRenderability() === !1) {
      (this.updateTextureOwnership(!1), this.setRenderable(!1));
      return;
    }
    if (this.texture !== null) {
      if (this.texture.retryCount > this.texture.maxRetryCount) {
        (this.updateTextureOwnership(!1), this.setRenderable(!1));
        return;
      }
      ((o = !0), (i = this.texture.state === "loaded"));
    } else
      (this.hasShader() || this.hasColorProperties() === !0) &&
        this.hasDimensions() === !0 &&
        this.stage.defaultTexture &&
        this.stage.defaultTexture.state === "loaded" &&
        (i = !0);
    (this.updateTextureOwnership(o), this.setRenderable(i));
  }
  checkBasicRenderability() {
    return !(this.worldAlpha === 0 || this.isOutOfBounds() === !0);
  }
  setRenderable(i) {
    this.isRenderable = i;
  }
  updateTextureOwnership(i) {
    var o;
    (o = this.texture) == null || o.setRenderableOwner(this._id, i);
  }
  isOutOfBounds() {
    return this.renderState <= si.OutOfBounds;
  }
  hasDimensions() {
    return this.props.width !== 0 && this.props.height !== 0;
  }
  hasColorProperties() {
    return (
      this.props.color !== 0 ||
      this.props.colorTop !== 0 ||
      this.props.colorBottom !== 0 ||
      this.props.colorLeft !== 0 ||
      this.props.colorRight !== 0 ||
      this.props.colorTl !== 0 ||
      this.props.colorTr !== 0 ||
      this.props.colorBl !== 0 ||
      this.props.colorBr !== 0
    );
  }
  hasShader() {
    return this.props.shader !== null;
  }
  calculateRenderCoords() {
    const { width: i, height: o } = this,
      { tx: l, ty: h, ta: p, tb: d, tc: y, td: v } = this.globalTransform;
    if (d === 0 && y === 0) {
      const O = l,
        B = l + i * p,
        N = h,
        $ = h + o * v;
      this.renderCoords = Zl.translate(O, N, B, N, B, $, O, $, this.renderCoords);
    } else
      this.renderCoords = Zl.translate(
        l,
        h,
        l + i * p,
        h + i * y,
        l + i * p + o * d,
        h + i * y + o * v,
        l + o * d,
        h + o * v,
        this.renderCoords,
      );
    if (this.sceneGlobalTransform === void 0) return;
    const { tx: T, ty: S, ta: w, tb: C, tc: L, td: k } = this.sceneGlobalTransform;
    if (C === 0 && L === 0) {
      const O = T,
        B = T + i * w,
        N = S,
        $ = S + o * k;
      this.sceneRenderCoords = Zl.translate(O, N, B, N, B, $, O, $, this.sceneRenderCoords);
    } else
      this.sceneRenderCoords = Zl.translate(
        T,
        S,
        T + i * w,
        S + i * L,
        T + i * w + o * C,
        S + i * L + o * k,
        T + o * C,
        S + o * k,
        this.sceneRenderCoords,
      );
  }
  calculateClippingRect(i) {
    this.globalTransform;
    const { clippingRect: o, props: l, globalTransform: h } = this,
      { clipping: p } = l,
      d = h.tb !== 0 || h.tc !== 0;
    (p === !0 && d === !1
      ? ((o.x = h.tx),
        (o.y = h.ty),
        (o.width = this.width * h.ta),
        (o.height = this.height * h.td),
        (o.valid = !0))
      : (o.valid = !1),
      i.valid === !0 && o.valid === !0 ? sD(i, o, o) : i.valid === !0 && (oD(i, o), (o.valid = !0)));
  }
  calculateZIndex() {
    var p, d;
    const i = this.props,
      o = i.zIndex || 0,
      l = ((p = i.parent) == null ? void 0 : p.zIndex) || 0;
    let h = o;
    ((d = i.parent) != null && d.zIndexLocked && (h = o < l ? o : l), (this.calcZIndex = h));
  }
  destroy() {
    var i;
    if (this.destroyed !== !0) {
      for (
        this.destroyed = !0,
          this.unloadTexture(),
          this.clippingRect.valid = !1,
          this.isRenderable = !1,
          this.renderCoords = void 0,
          this.renderBound = void 0,
          this.strictBound = void 0,
          this.preloadBound = void 0,
          this.globalTransform = void 0,
          this.scaleRotateTransform = void 0,
          this.localTransform = void 0,
          this.props.texture = null,
          this.props.shader = this.stage.defShaderCtr;
        this.children.length > 0;
      )
        (i = this.children[0]) == null || i.destroy();
      ((this.parent = null), this.rtt && this.stage.renderer.removeRTTNode(this), this.removeAllListeners());
    }
  }
  renderQuads(i) {
    (this.parentHasRenderTexture &&
      (!i.renderToTextureActive || this.parentRenderTexture !== i.activeRttNode)) ||
      (this.globalTransform,
      this.renderCoords,
      i.addQuad({
        width: this.props.width,
        height: this.props.height,
        colorTl: this.premultipliedColorTl,
        colorTr: this.premultipliedColorTr,
        colorBl: this.premultipliedColorBl,
        colorBr: this.premultipliedColorBr,
        texture: this.texture || this.stage.defaultTexture,
        textureOptions: this.textureOptions,
        zIndex: this.zIndex,
        shader: this.shader.shader,
        shaderProps: this.shader.getResolvedProps(),
        alpha: this.worldAlpha,
        clippingRect: this.clippingRect,
        tx: this.globalTransform.tx,
        ty: this.globalTransform.ty,
        ta: this.globalTransform.ta,
        tb: this.globalTransform.tb,
        tc: this.globalTransform.tc,
        td: this.globalTransform.td,
        renderCoords: this.renderCoords,
        rtt: this.rtt,
        parentHasRenderTexture: this.parentHasRenderTexture,
        framebufferDimensions: this.framebufferDimensions,
      }));
  }
  get id() {
    return this._id;
  }
  get data() {
    return this.props.data;
  }
  set data(i) {
    this.props.data = i;
  }
  get x() {
    return this.props.x;
  }
  set x(i) {
    this.props.x !== i && ((this.props.x = i), this.setUpdateType(Ie.Local));
  }
  get absX() {
    var i, o, l;
    return (
      this.props.x +
      -this.props.width * this.props.mountX +
      (((i = this.props.parent) == null ? void 0 : i.absX) ||
        ((l = (o = this.props.parent) == null ? void 0 : o.globalTransform) == null ? void 0 : l.tx) ||
        0)
    );
  }
  get absY() {
    var i, o;
    return (
      this.props.y +
      -this.props.height * this.props.mountY +
      ((o = (i = this.props.parent) == null ? void 0 : i.absY) != null ? o : 0)
    );
  }
  get y() {
    return this.props.y;
  }
  set y(i) {
    this.props.y !== i && ((this.props.y = i), this.setUpdateType(Ie.Local));
  }
  get width() {
    return this.props.width;
  }
  set width(i) {
    this.props.width !== i &&
      ((this.props.width = i),
      this.setUpdateType(Ie.Local),
      this.props.rtt &&
        ((this.texture = this.stage.txManager.createTexture("RenderTexture", {
          width: this.width,
          height: this.height,
        })),
        this.setUpdateType(Ie.RenderTexture)));
  }
  get height() {
    return this.props.height;
  }
  set height(i) {
    this.props.height !== i &&
      ((this.props.height = i),
      this.setUpdateType(Ie.Local),
      this.props.rtt &&
        ((this.texture = this.stage.txManager.createTexture("RenderTexture", {
          width: this.width,
          height: this.height,
        })),
        this.setUpdateType(Ie.RenderTexture)));
  }
  get scale() {
    return this.scaleX;
  }
  set scale(i) {
    ((this.scaleX = i), (this.scaleY = i));
  }
  get scaleX() {
    return this.props.scaleX;
  }
  set scaleX(i) {
    this.props.scaleX !== i && ((this.props.scaleX = i), this.setUpdateType(Ie.ScaleRotate));
  }
  get scaleY() {
    return this.props.scaleY;
  }
  set scaleY(i) {
    this.props.scaleY !== i && ((this.props.scaleY = i), this.setUpdateType(Ie.ScaleRotate));
  }
  get mount() {
    return this.props.mount;
  }
  set mount(i) {
    (this.props.mountX !== i || this.props.mountY !== i) &&
      ((this.props.mountX = i),
      (this.props.mountY = i),
      (this.props.mount = i),
      this.setUpdateType(Ie.Local));
  }
  get mountX() {
    return this.props.mountX;
  }
  set mountX(i) {
    this.props.mountX !== i && ((this.props.mountX = i), this.setUpdateType(Ie.Local));
  }
  get mountY() {
    return this.props.mountY;
  }
  set mountY(i) {
    this.props.mountY !== i && ((this.props.mountY = i), this.setUpdateType(Ie.Local));
  }
  get pivot() {
    return this.props.pivot;
  }
  set pivot(i) {
    (this.props.pivotX !== i || this.props.pivotY !== i) &&
      ((this.props.pivotX = i),
      (this.props.pivotY = i),
      (this.props.pivot = i),
      this.setUpdateType(Ie.Local));
  }
  get pivotX() {
    return this.props.pivotX;
  }
  set pivotX(i) {
    this.props.pivotX !== i && ((this.props.pivotX = i), this.setUpdateType(Ie.Local));
  }
  get pivotY() {
    return this.props.pivotY;
  }
  set pivotY(i) {
    this.props.pivotY !== i && ((this.props.pivotY = i), this.setUpdateType(Ie.Local));
  }
  get rotation() {
    return this.props.rotation;
  }
  set rotation(i) {
    this.props.rotation !== i && ((this.props.rotation = i), this.setUpdateType(Ie.ScaleRotate));
  }
  get alpha() {
    return this.props.alpha;
  }
  set alpha(i) {
    ((this.props.alpha = i),
      this.setUpdateType(Ie.PremultipliedColors | Ie.WorldAlpha | Ie.Children | Ie.IsRenderable),
      (this.childUpdateType |= Ie.WorldAlpha));
  }
  get autosize() {
    return this.props.autosize;
  }
  set autosize(i) {
    this.props.autosize = i;
  }
  get boundsMargin() {
    var i, o, l;
    return (l =
      (o = this.props.boundsMargin) != null ? o : (i = this.parent) == null ? void 0 : i.boundsMargin) != null
      ? l
      : this.stage.boundsMargin;
  }
  set boundsMargin(i) {
    if (i !== this.props.boundsMargin) {
      if (i === null) this.props.boundsMargin = i;
      else {
        const o = Array.isArray(i) ? i : [i, i, i, i];
        this.props.boundsMargin = o;
      }
      this.setUpdateType(Ie.RenderBounds);
    }
  }
  get clipping() {
    return this.props.clipping;
  }
  set clipping(i) {
    ((this.props.clipping = i),
      this.setUpdateType(Ie.Clipping | Ie.RenderBounds | Ie.Children),
      (this.childUpdateType |= Ie.Global | Ie.Clipping));
  }
  get color() {
    return this.props.color;
  }
  set color(i) {
    ((this.colorTop = i),
      (this.colorBottom = i),
      (this.colorLeft = i),
      (this.colorRight = i),
      (this.props.color = i),
      this.setUpdateType(Ie.PremultipliedColors));
  }
  get colorTop() {
    return this.props.colorTop;
  }
  set colorTop(i) {
    ((this.props.colorTl !== i || this.props.colorTr !== i) && ((this.colorTl = i), (this.colorTr = i)),
      (this.props.colorTop = i),
      this.setUpdateType(Ie.PremultipliedColors));
  }
  get colorBottom() {
    return this.props.colorBottom;
  }
  set colorBottom(i) {
    ((this.props.colorBl !== i || this.props.colorBr !== i) && ((this.colorBl = i), (this.colorBr = i)),
      (this.props.colorBottom = i),
      this.setUpdateType(Ie.PremultipliedColors));
  }
  get colorLeft() {
    return this.props.colorLeft;
  }
  set colorLeft(i) {
    ((this.props.colorTl !== i || this.props.colorBl !== i) && ((this.colorTl = i), (this.colorBl = i)),
      (this.props.colorLeft = i),
      this.setUpdateType(Ie.PremultipliedColors));
  }
  get colorRight() {
    return this.props.colorRight;
  }
  set colorRight(i) {
    ((this.props.colorTr !== i || this.props.colorBr !== i) && ((this.colorTr = i), (this.colorBr = i)),
      (this.props.colorRight = i),
      this.setUpdateType(Ie.PremultipliedColors));
  }
  get colorTl() {
    return this.props.colorTl;
  }
  set colorTl(i) {
    ((this.props.colorTl = i), this.setUpdateType(Ie.PremultipliedColors));
  }
  get colorTr() {
    return this.props.colorTr;
  }
  set colorTr(i) {
    ((this.props.colorTr = i), this.setUpdateType(Ie.PremultipliedColors));
  }
  get colorBl() {
    return this.props.colorBl;
  }
  set colorBl(i) {
    ((this.props.colorBl = i), this.setUpdateType(Ie.PremultipliedColors));
  }
  get colorBr() {
    return this.props.colorBr;
  }
  set colorBr(i) {
    ((this.props.colorBr = i), this.setUpdateType(Ie.PremultipliedColors));
  }
  get zIndexLocked() {
    return this.props.zIndexLocked || 0;
  }
  set zIndexLocked(i) {
    ((this.props.zIndexLocked = i), this.setUpdateType(Ie.CalculatedZIndex | Ie.Children));
    for (let o = 0, l = this.children.length; o < l; o++) this.children[o].setUpdateType(Ie.CalculatedZIndex);
  }
  get zIndex() {
    return this.props.zIndex;
  }
  set zIndex(i) {
    ((this.props.zIndex = i), this.setUpdateType(Ie.CalculatedZIndex | Ie.Children));
    for (let o = 0, l = this.children.length; o < l; o++) this.children[o].setUpdateType(Ie.CalculatedZIndex);
  }
  get parent() {
    return this.props.parent;
  }
  set parent(i) {
    const o = this.props.parent;
    if (o !== i) {
      if (((this.props.parent = i), o)) {
        const l = o.children.indexOf(this);
        (o.children.splice(l, 1), o.setUpdateType(Ie.Children | Ie.ZIndexSortedChildren));
      }
      (i &&
        (i.children.push(this),
        this.setUpdateType(Ie.All),
        i.setUpdateType(Ie.Children | Ie.ZIndexSortedChildren),
        (i.rtt || i.parentHasRenderTexture) && this.applyRTTInheritance(i)),
        this.updateScaleRotateTransform(),
        this.setUpdateType(Ie.RenderBounds | Ie.Children));
    }
  }
  get preventCleanup() {
    return this.props.textureOptions.preventCleanup || !1;
  }
  set preventCleanup(i) {
    this.props.textureOptions.preventCleanup = i;
  }
  get rtt() {
    return this.props.rtt;
  }
  set rtt(i) {
    this.props.rtt !== i &&
      ((this.props.rtt = i),
      i === !0 ? (this.initRenderTexture(), this.markChildrenWithRTT()) : this.cleanupRenderTexture(),
      this.setUpdateType(Ie.RenderTexture),
      this.parentHasRenderTexture === !0 && this.notifyParentRTTOfUpdate());
  }
  initRenderTexture() {
    ((this.texture = this.stage.txManager.createTexture("RenderTexture", {
      width: this.width,
      height: this.height,
    })),
      this.stage.renderer.renderToTexture(this));
  }
  cleanupRenderTexture() {
    (this.unloadTexture(), this.clearRTTInheritance(), (this.hasRTTupdates = !1), (this.texture = null));
  }
  markChildrenWithRTT(i = null) {
    const o = i || this;
    for (const l of o.children)
      (l.setUpdateType(Ie.All), (l.parentHasRenderTexture = !0), l.markChildrenWithRTT());
  }
  applyRTTInheritance(i) {
    (i.rtt && i.setUpdateType(Ie.RenderTexture), this.markChildrenWithRTT(i));
  }
  clearRTTInheritance() {
    if (!this.rtt)
      for (const i of this.children)
        ((i.parentHasRenderTexture = !1),
          (i.rttParent = null),
          i.setUpdateType(Ie.All),
          i.clearRTTInheritance());
  }
  get shader() {
    return this.props.shader;
  }
  set shader(i) {
    this.props.shader !== i && ((this.props.shader = i), this.setUpdateType(Ie.IsRenderable));
  }
  get src() {
    return this.props.src;
  }
  set src(i) {
    if (this.props.src !== i) {
      if (((this.props.src = i), !i)) {
        this.texture = null;
        return;
      }
      this.texture = this.stage.txManager.createTexture("ImageTexture", {
        src: i,
        width: this.props.width,
        height: this.props.height,
        type: this.props.imageType,
        sx: this.props.srcX,
        sy: this.props.srcY,
        sw: this.props.srcWidth,
        sh: this.props.srcHeight,
        maxRetryCount: this.props.textureOptions.maxRetryCount,
      });
    }
  }
  set imageType(i) {
    this.props.imageType !== i && (this.props.imageType = i);
  }
  get imageType() {
    return this.props.imageType || null;
  }
  get srcHeight() {
    return this.props.srcHeight;
  }
  set srcHeight(i) {
    this.props.srcHeight = i;
  }
  get srcWidth() {
    return this.props.srcWidth;
  }
  set srcWidth(i) {
    this.props.srcWidth = i;
  }
  get srcX() {
    return this.props.srcX;
  }
  set srcX(i) {
    this.props.srcX = i;
  }
  get srcY() {
    return this.props.srcY;
  }
  set srcY(i) {
    this.props.srcY = i;
  }
  get framebufferDimensions() {
    return this.parentHasRenderTexture && !this.rtt && this.parent
      ? this.parent.framebufferDimensions
      : { width: this.width, height: this.height };
  }
  get parentRenderTexture() {
    let i = this.parent;
    for (; i; ) {
      if (i.rtt) return i;
      i = i.parent;
    }
    return null;
  }
  get texture() {
    return this.props.texture;
  }
  set texture(i) {
    if (this.props.texture === i) return;
    (this.props.texture && this.unloadTexture(),
      (this.props.texture = i),
      i !== null && (i.setRenderableOwner(this._id, this.isRenderable), this.loadTexture()),
      this.setUpdateType(Ie.IsRenderable));
  }
  set textureOptions(i) {
    this.props.textureOptions = i;
  }
  get textureOptions() {
    return this.props.textureOptions;
  }
  get strictBounds() {
    return this.props.strictBounds;
  }
  set strictBounds(i) {
    i !== this.props.strictBounds &&
      ((this.props.strictBounds = i),
      this.setUpdateType(Ie.RenderBounds | Ie.Children),
      (this.childUpdateType |= Ie.RenderBounds | Ie.Children));
  }
  set interactive(i) {
    ((this.props.interactive = i), i === !0 && this.stage.interactiveNodes.add(this));
  }
  get interactive() {
    return this.props.interactive;
  }
  animate(i, o) {
    const l = new m$(this, i, o);
    return new y$(this.stage.animationManager, l);
  }
  flush() {}
}
const v$ = u => {
    let n = !1,
      i = 0;
    const o = (l = 0) => {
      const h = u.targetFrameTime;
      if (h > 0 && l - i < h) {
        const p = h - (l - i);
        setTimeout(() => requestAnimationFrame(o), p);
        return;
      }
      if (((i = l), u.updateFrameTime(), u.updateAnimations(), !u.hasSceneUpdates())) {
        (u.calculateFps(),
          h > 0
            ? setTimeout(() => requestAnimationFrame(o), Math.max(h, 16.666666666666668))
            : setTimeout(() => requestAnimationFrame(o), 16.666666666666668),
          n || (u.eventBus.emit("idle"), (n = !0)),
          u.txMemManager.checkCleanup() === !0 && u.txMemManager.cleanup(),
          u.flushFrameEvents());
        return;
      }
      if (((n = !1), u.drawFrame(), u.flushFrameEvents(), h > 0)) {
        const p = Math.max(0, h - (performance.now() - l));
        setTimeout(() => requestAnimationFrame(o), p);
      } else requestAnimationFrame(o);
    };
    requestAnimationFrame(o);
  },
  ag = () => (performance ? performance.now() : Date.now());
class x$ {
  constructor() {
    j(this, "activeAnimations", new Set());
  }
  registerAnimation(n) {
    this.activeAnimations.add(n);
  }
  unregisterAnimation(n) {
    this.activeAnimations.delete(n);
  }
  update(n) {
    this.activeAnimations.forEach(i => {
      i.update(n);
    });
  }
}
function T$() {
  function u(i) {
    return i.indexOf("image/png") !== -1;
  }
  function n(i, o, l, h, p, d, y) {
    return new Promise(function (v, T) {
      var S = new XMLHttpRequest();
      (S.open("GET", i, !0),
        (S.responseType = "blob"),
        (S.onload = function () {
          if (S.status !== 200 && S.status !== 0)
            return T(new Error("Failed to load image: " + S.statusText));
          var w = S.response;
          (o !== void 0 || u(w.type),
            createImageBitmap(w)
              .then(function (C) {
                v({ data: C, premultiplyAlpha: o });
              })
              .catch(function (C) {
                T(C);
              }));
        }),
        (S.onerror = function () {
          T(new Error("Network error occurred while trying to fetch the image."));
        }),
        S.send());
    });
  }
  self.onmessage = i => {
    var o = i.data.src,
      l = i.data.id,
      h = i.data.premultiplyAlpha;
    (i.data.sx,
      i.data.sy,
      i.data.sw,
      i.data.sh,
      n(o, h)
        .then(function (p) {
          self.postMessage({ id: l, src: o, data: p }, [p.data]);
        })
        .catch(function (p) {
          self.postMessage({ id: l, src: o, error: p.message });
        }));
  };
}
class S$ {
  constructor(n, i) {
    j(this, "imageWorkersEnabled", !0);
    j(this, "messageManager", {});
    j(this, "workers", []);
    j(this, "workerIndex", 0);
    j(this, "nextId", 0);
    ((this.workers = this.createWorkers(n, i)),
      this.workers.forEach(o => {
        o.onmessage = this.handleMessage.bind(this);
      }));
  }
  handleMessage(n) {
    const { id: i, data: o, error: l } = n.data,
      h = this.messageManager[i];
    if (h) {
      const [p, d] = h;
      (delete this.messageManager[i], l ? d(new Error(l)) : p(o));
    }
  }
  createWorkers(n = 1, i) {
    let o = "(".concat(T$.toString(), ")()");
    (i.options === !0 &&
      (o = o.replace(
        "var supportsOptionsCreateImageBitmap = false;",
        "var supportsOptionsCreateImageBitmap = true;",
      )),
      i.full === !0 &&
        ((o = o.replace(
          "var supportsOptionsCreateImageBitmap = false;",
          "var supportsOptionsCreateImageBitmap = true;",
        )),
        (o = o.replace(
          "var supportsFullCreateImageBitmap = false;",
          "var supportsFullCreateImageBitmap = true;",
        ))),
      (o = o.replace('"use strict";', "")));
    const l = new Blob([o], { type: "application/javascript" }),
      h = (self.URL ? URL : webkitURL).createObjectURL(l),
      p = [];
    for (let d = 0; d < n; d++) p.push(new Worker(h));
    return p;
  }
  getNextWorker() {
    const n = this.workers[this.workerIndex];
    return ((this.workerIndex = (this.workerIndex + 1) % this.workers.length), n);
  }
  getImage(n, i, o, l, h, p) {
    return new Promise((d, y) => {
      try {
        if (this.workers) {
          const v = this.nextId++;
          this.messageManager[v] = [d, y];
          const T = this.getNextWorker();
          T && T.postMessage({ id: v, src: n, premultiplyAlpha: i, sx: o, sy: l, sw: h, sh: p });
        }
      } catch (v) {
        y(v);
      }
    });
  }
}
const pd = class pd extends Sa {
  constructor(i, o) {
    super(i);
    j(this, "type", _i.color);
    j(this, "props");
    this.props = pd.resolveDefaults(o);
  }
  get color() {
    return this.props.color;
  }
  set color(i) {
    this.props.color = i;
  }
  async getTextureSource() {
    const i = new Uint8Array(4);
    return (
      this.color === 4294967295
        ? ((i[0] = 255), (i[1] = 255), (i[2] = 255), (i[3] = 255))
        : ((i[0] = (this.color >> 16) & 255),
          (i[1] = (this.color >> 8) & 255),
          (i[2] = this.color & 255),
          (i[3] = (this.color >>> 24) & 255)),
      { data: i, premultiplyAlpha: !0 }
    );
  }
  static makeCacheKey(i) {
    const o = pd.resolveDefaults(i);
    return "ColorTexture,".concat(o.color);
  }
  static resolveDefaults(i) {
    return { color: i.color || 4294967295 };
  }
};
j(pd, "z$__type__Props");
let Eg = pd;
function E$(u) {
  return /\.(ktx|pvr)$/.test(u);
}
const A$ = 55727696,
  I$ = {
    0: 35841,
    1: 35843,
    2: 35840,
    3: 35842,
    6: 36196,
    7: 33776,
    8: 33778,
    9: 33778,
    10: 33779,
    11: 33779,
  },
  w$ = 1554098963,
  R$ = { "4x4": 37808, "5x5": 37809, "6x6": 37810, "8x8": 37811, "10x10": 37812, "12x12": 37813 },
  PL = [171, 75, 84, 88, 32, 49, 49, 187, 13, 10, 26, 10],
  OL = async u => {
    try {
      const n = await fetch(u);
      if (!n.ok)
        throw new Error("Failed to fetch compressed texture: ".concat(n.status, " ").concat(n.statusText));
      const i = await n.arrayBuffer();
      if (i.byteLength < 16)
        throw new Error(
          "File too small to be a valid compressed texture (".concat(
            i.byteLength,
            " bytes). Expected at least 16 bytes for header inspection.",
          ),
        );
      const o = new DataView(i),
        l = o.getUint32(0, !0);
      if (l === A$) return k$(o);
      if (l === w$) return C$(o);
      let h = !0;
      for (let p = 0; p < PL.length; p++)
        if (o.getUint8(p) !== PL[p]) {
          h = !1;
          break;
        }
      if (h === !0) return _$(o);
      throw new Error("Unrecognized compressed texture format");
    } catch (n) {
      throw new Error("Failed to load compressed texture from ".concat(u, ": ").concat(n));
    }
  };
function NL(u, n) {
  return u.getUint8(n) + (u.getUint8(n + 1) << 8) + (u.getUint8(n + 2) << 16);
}
const C$ = async function (u) {
    const n = u.getUint8(4),
      i = u.getUint8(5),
      o = NL(u, 7),
      l = NL(u, 10);
    if (o === 0 || l === 0) throw new Error("Invalid ASTC texture dimensions: ".concat(o, "x").concat(l));
    const h = Math.ceil(o / n) * Math.ceil(l / i) * 16,
      p = u.byteLength - 16;
    if (h !== p) throw new Error("Invalid ASTC texture data size: expected ".concat(h, ", got ").concat(p));
    const d = R$["".concat(n, "x").concat(i)];
    if (d === void 0) throw new Error("Unsupported ASTC block size: ".concat(n, "x").concat(i));
    const y = u.buffer,
      v = [];
    return (
      v.push(y.slice(16)),
      {
        data: { blockInfo: vd[d], glInternalFormat: d, mipmaps: v, width: o, height: l, type: "astc" },
        premultiplyAlpha: !1,
      }
    );
  },
  L$ = function (u, n, i) {
    if (u.getExtension("WEBGL_compressed_texture_astc") === null)
      throw new Error("ASTC compressed textures not supported by this device");
    u.bindTexture(n);
    const { glInternalFormat: o, mipmaps: l, width: h, height: p } = i,
      d = new Uint8Array(l[0]);
    (u.compressedTexImage2D(0, o, h, p, 0, d),
      u.texParameteri(u.TEXTURE_WRAP_S, u.CLAMP_TO_EDGE),
      u.texParameteri(u.TEXTURE_WRAP_T, u.CLAMP_TO_EDGE),
      u.texParameteri(u.TEXTURE_MAG_FILTER, u.LINEAR),
      u.texParameteri(u.TEXTURE_MIN_FILTER, u.LINEAR));
  },
  _$ = async function (u) {
    const n = u.getUint32(12, !0),
      i = n === 67305985;
    if (i === !1 && n !== 16909060) throw new Error("Invalid KTX endianness value");
    const o = u.getUint32(16, i),
      l = u.getUint32(24, i);
    if (o !== 0 || l !== 0)
      throw new Error("KTX texture is not compressed (glType: ".concat(o, ", glFormat: ").concat(l, ")"));
    const h = u.getUint32(28, i);
    if (vd[h] === void 0)
      throw new Error("Unsupported KTX compressed texture format: 0x".concat(h.toString(16)));
    const p = u.getUint32(36, i),
      d = u.getUint32(40, i);
    if (p === 0 || d === 0) throw new Error("Invalid KTX texture dimensions: ".concat(p, "x").concat(d));
    const y = u.getUint32(56, i);
    if (y === 0) throw new Error("KTX texture has no mipmap levels");
    const v = u.getUint32(60, i),
      T = [],
      S = u.buffer;
    let w = 64 + v;
    if (w > u.byteLength) throw new Error("Invalid KTX file: key/value data exceeds file size");
    for (let C = 0; C < y; C++) {
      const L = u.getUint32(w, i);
      w += 4;
      const k = w + L;
      (T.push(S.slice(w, k)), (w = k), w % 4 !== 0 && (w += 4 - (w % 4)));
    }
    return {
      data: { blockInfo: vd[h], glInternalFormat: h, mipmaps: T, width: p, height: d, type: "ktx" },
      premultiplyAlpha: !1,
    };
  },
  b$ = function (u, n, i) {
    const { glInternalFormat: o, mipmaps: l, width: h, height: p, blockInfo: d } = i;
    u.bindTexture(n);
    const y = d.width,
      v = d.height;
    let T = h,
      S = p;
    for (let w = 0; w < l.length; w++) {
      let C = new Uint8Array(l[w]);
      const L = Math.ceil(T / y) * y,
        k = Math.ceil(S / v) * v,
        O = Math.ceil(T / y) * Math.ceil(S / v) * d.bytes;
      if (C.byteLength < O) {
        const B = new Uint8Array(O);
        (B.set(C), (C = B));
      }
      (u.compressedTexImage2D(w, o, L, k, 0, C), (T = Math.max(1, T >> 1)), (S = Math.max(1, S >> 1)));
    }
    (u.texParameteri(u.TEXTURE_WRAP_S, u.CLAMP_TO_EDGE),
      u.texParameteri(u.TEXTURE_WRAP_T, u.CLAMP_TO_EDGE),
      u.texParameteri(u.TEXTURE_MAG_FILTER, u.LINEAR),
      u.texParameteri(u.TEXTURE_MIN_FILTER, l.length > 1 ? u.LINEAR_MIPMAP_LINEAR : u.LINEAR));
  };
function D$(u, n, i) {
  const o = i === 2 ? 16 : 8,
    l = 8,
    h = Math.max(u, o),
    p = Math.max(n, l);
  return (h * p * i) / 8;
}
const k$ = async function (u) {
    const n = u.getUint32(8, !0),
      i = I$[n];
    if (i === void 0) throw new Error("Unsupported PVR pixel format: 0x".concat(n.toString(16)));
    const o = u.getInt32(24, !0),
      l = u.getInt32(28, !0);
    if (l === 0 || o === 0) throw new Error("Invalid PVR texture dimensions: ".concat(l, "x").concat(o));
    const h = u.getInt32(44, !0),
      p = u.getUint32(48, !0),
      d = u.buffer;
    let y = 52 + p;
    if (y > d.byteLength) throw new Error("Invalid PVR file: metadata exceeds file size");
    const v = [],
      T = vd[i];
    for (let S = 0; S < h; S++) {
      const w = u.getUint32(y, !0),
        C = d.byteLength - (y + 4);
      if (w > 0 && w <= C) {
        y += 4;
        const L = y,
          k = y + w;
        (v.push(d.slice(L, k)), (y = k), (y = (y + 3) & -4));
        continue;
      }
      if (n === 0 || n === 1 || n === 2 || n === 3) {
        const L = n === 0 || n === 1 ? 2 : 4,
          k = D$(l >> S, o >> S, L);
        (v.push(d.slice(y, y + k)), (y += k), (y = (y + 3) & -4));
        continue;
      }
      if (T !== void 0) {
        const L = Math.ceil((l >> S) / T.width),
          k = Math.ceil((o >> S) / T.height),
          O = L * k * T.bytes;
        (v.push(d.slice(y, y + O)), (y += O), (y = (y + 3) & -4));
      }
    }
    return {
      data: { blockInfo: vd[i], glInternalFormat: i, mipmaps: v, width: l, height: o, type: "pvr" },
      premultiplyAlpha: !1,
    };
  },
  M$ = function (u, n, i) {
    const { glInternalFormat: o, mipmaps: l, width: h, height: p } = i;
    u.bindTexture(n);
    let d = h,
      y = p;
    for (let v = 0; v < l.length; v++)
      (u.compressedTexImage2D(v, o, d, y, 0, new Uint8Array(l[v])),
        (d = Math.max(1, d >> 1)),
        (y = Math.max(1, y >> 1)));
    (u.texParameteri(u.TEXTURE_WRAP_S, u.CLAMP_TO_EDGE),
      u.texParameteri(u.TEXTURE_WRAP_T, u.CLAMP_TO_EDGE),
      u.texParameteri(u.TEXTURE_MAG_FILTER, u.LINEAR),
      u.texParameteri(u.TEXTURE_MIN_FILTER, l.length > 1 ? u.LINEAR_MIPMAP_LINEAR : u.LINEAR));
  },
  fa = { width: 4, height: 4, bytes: 8 },
  Ol = { width: 4, height: 4, bytes: 16 },
  FL = { width: 5, height: 5, bytes: 16 },
  UL = { width: 6, height: 6, bytes: 16 },
  BL = { width: 8, height: 4, bytes: 8 },
  $L = { width: 8, height: 8, bytes: 16 },
  GL = { width: 10, height: 10, bytes: 16 },
  jL = { width: 12, height: 12, bytes: 16 },
  vd = {
    33776: fa,
    33777: fa,
    33778: Ol,
    33779: Ol,
    36196: fa,
    37492: fa,
    37493: fa,
    37496: Ol,
    37497: Ol,
    35840: fa,
    35842: fa,
    35841: BL,
    35843: BL,
    37808: Ol,
    37840: Ol,
    37809: FL,
    37841: FL,
    37810: UL,
    37842: UL,
    37811: $L,
    37843: $L,
    37812: GL,
    37844: GL,
    37813: jL,
    37845: jL,
  },
  P$ = { ktx: b$, pvr: M$, astc: L$ };
function O$(u) {
  return /\.(svg)(\?.*)?$/.test(u);
}
const VL = (u, n, i, o, l, h, p) =>
  new Promise((d, y) => {
    const v = document.createElement("canvas"),
      T = v.getContext("2d");
    T.imageSmoothingEnabled = !0;
    const S = new Image();
    ((S.onload = () => {
      const w = o != null ? o : 0,
        C = l != null ? l : 0,
        L = n || S.width,
        k = i || S.height;
      ((v.width = L),
        (v.height = k),
        T.drawImage(S, 0, 0, L, k),
        d({ data: T.getImageData(w, C, h != null ? h : L, p != null ? p : k), premultiplyAlpha: !1 }));
    }),
      (S.onerror = w => {
        y(w);
      }),
      (S.src = u));
  });
function uD(u, n = "") {
  return new Promise((i, o) => {
    const l = new XMLHttpRequest();
    ((l.responseType = n),
      (l.onreadystatechange = function () {
        l.readyState == XMLHttpRequest.DONE &&
          (l.status === 0 || l.status === 200 ? i(l.response) : o(l.statusText));
      }),
      l.open("GET", u, !0),
      l.send(null));
  });
}
const gd = class gd extends Sa {
  constructor(i, o) {
    var h;
    const l = gd.resolveDefaults(o);
    super(i);
    j(this, "type", _i.image);
    j(this, "props");
    ((this.props = l),
      (this.maxRetryCount = (h = l.maxRetryCount) != null ? h : this.txManager.maxRetryCount));
  }
  hasAlphaChannel(i) {
    return i.indexOf("image/png") !== -1;
  }
  async loadImageFallback(i, o) {
    const l = new Image();
    return (
      typeof i == "string" && rx(i) === !1 && (l.crossOrigin = "anonymous"),
      new Promise((h, p) => {
        ((l.onload = () => {
          h({ data: l, premultiplyAlpha: o });
        }),
          (l.onerror = d => {
            const y =
              d instanceof Error
                ? d.message
                : d instanceof Event
                  ? "Image loading failed for ".concat(l.src)
                  : "Unknown image loading error";
            p(new Error("Image loading failed: ".concat(y)));
          }),
          i instanceof Blob ? (l.src = URL.createObjectURL(i)) : (l.src = i));
      })
    );
  }
  async createImageBitmap(i, o, l, h, p, d) {
    const y = o != null ? o : i.type.includes("image/png"),
      v = this.txManager.imageBitmapSupported;
    if (v.full === !0 && p !== null && d !== null)
      try {
        return {
          data: await createImageBitmap(i, l || 0, h || 0, p, d, {
            premultiplyAlpha: y ? "premultiply" : "none",
            colorSpaceConversion: "none",
            imageOrientation: "none",
          }),
          premultiplyAlpha: y,
        };
      } catch (T) {
        throw new Error("Failed to create image bitmap with crop: ".concat(T));
      }
    else if (v.basic === !0)
      try {
        return { data: await createImageBitmap(i), premultiplyAlpha: y };
      } catch (T) {
        throw new Error("Failed to create basic image bitmap: ".concat(T));
      }
    try {
      return {
        data: await createImageBitmap(i, {
          premultiplyAlpha: y ? "premultiply" : "none",
          colorSpaceConversion: "none",
          imageOrientation: "none",
        }),
        premultiplyAlpha: y,
      };
    } catch (T) {
      throw new Error("Failed to create image bitmap with options: ".concat(T));
    }
  }
  async loadImage(i) {
    const { premultiplyAlpha: o, sx: l, sy: h, sw: p, sh: d } = this.props;
    if (this.txManager.hasCreateImageBitmap === !0) {
      if (rx(i) === !1 && this.txManager.hasWorker === !0 && this.txManager.imageWorkerManager !== null)
        try {
          return this.txManager.imageWorkerManager.getImage(i, o, l, h, p, d);
        } catch (v) {
          throw new Error("Failed to load image via worker: ".concat(v));
        }
      let y;
      if (rx(i) === !0) y = h$(i);
      else
        try {
          y = await uD(i, "blob");
        } catch (v) {
          throw new Error("Failed to fetch image blob from ".concat(i, ": ").concat(v));
        }
      return this.createImageBitmap(y, o, l, h, p, d);
    }
    return this.loadImageFallback(i, o != null ? o : !0);
  }
  async getTextureSource() {
    var o;
    let i;
    try {
      i = await this.determineImageTypeAndLoadImage();
    } catch (l) {
      return (this.setState("failed", l), { data: null });
    }
    return i.data === null
      ? (this.setState("failed", Error("ImageTexture: No image data")), { data: null })
      : { data: i.data, premultiplyAlpha: (o = this.props.premultiplyAlpha) != null ? o : !0 };
  }
  determineImageTypeAndLoadImage() {
    const { src: i, premultiplyAlpha: o, type: l } = this.props;
    if (i === null) return { data: null };
    if (typeof i != "string") {
      if (i instanceof Blob)
        if (this.txManager.hasCreateImageBitmap === !0) {
          const { sx: p, sy: d, sw: y, sh: v } = this.props;
          return this.createImageBitmap(i, o, p, d, y, v);
        } else return this.loadImageFallback(i, o != null ? o : !0);
      return i instanceof ImageData ? { data: i, premultiplyAlpha: o } : { data: i(), premultiplyAlpha: o };
    }
    const h = d$(i);
    return l === "regular"
      ? this.loadImage(h)
      : l === "svg"
        ? VL(
            h,
            this.props.width,
            this.props.height,
            this.props.sx,
            this.props.sy,
            this.props.sw,
            this.props.sh,
          )
        : O$(i) === !0
          ? VL(
              h,
              this.props.width,
              this.props.height,
              this.props.sx,
              this.props.sy,
              this.props.sw,
              this.props.sh,
            )
          : l === "compressed" || E$(i) === !0
            ? OL(h)
            : this.loadImage(h);
  }
  static makeCacheKey(i) {
    var p, d, y;
    const o = gd.resolveDefaults(i),
      l = o.key || o.src;
    if (typeof l != "string") return !1;
    let h = "";
    return (
      o.sh !== null &&
        o.sw !== null &&
        ((h += ","),
        (h += (p = o.sx) != null ? p : ""),
        (h += (d = o.sy) != null ? d : ""),
        (h += o.sw || ""),
        (h += o.sh || "")),
      "ImageTexture,"
        .concat(l, ",")
        .concat((y = o.premultiplyAlpha) != null ? y : "true")
        .concat(h)
    );
  }
  static resolveDefaults(i) {
    var o, l, h, p, d, y, v, T, S, w, C;
    return {
      src: (o = i.src) != null ? o : "",
      premultiplyAlpha: (l = i.premultiplyAlpha) != null ? l : !0,
      key: (h = i.key) != null ? h : null,
      type: (p = i.type) != null ? p : null,
      width: (d = i.width) != null ? d : null,
      height: (y = i.height) != null ? y : null,
      sx: (v = i.sx) != null ? v : null,
      sy: (T = i.sy) != null ? T : null,
      sw: (S = i.sw) != null ? S : null,
      sh: (w = i.sh) != null ? w : null,
      maxRetryCount: (C = i.maxRetryCount) != null ? C : null,
    };
  }
};
j(gd, "z$__type__Props");
let xd = gd;
const md = class md extends Sa {
  constructor(i, o) {
    super(i);
    j(this, "props");
    j(this, "type", _i.noise);
    this.props = md.resolveDefaults(o);
  }
  async getTextureSource() {
    const { width: i, height: o } = this.props,
      l = i * o * 4,
      h = new Uint8ClampedArray(l);
    for (let p = 0; p < l; p += 4) {
      const d = Math.floor(Math.random() * 256);
      ((h[p] = d), (h[p + 1] = d), (h[p + 2] = d), (h[p + 3] = 255));
    }
    return { data: new ImageData(h, i, o) };
  }
  static makeCacheKey(i) {
    if (i.cacheId === void 0) return !1;
    const o = md.resolveDefaults(i);
    return "NoiseTexture,".concat(o.width, ",").concat(o.height, ",").concat(o.cacheId);
  }
  static resolveDefaults(i) {
    var o, l, h;
    return {
      width: (o = i.width) != null ? o : 128,
      height: (l = i.height) != null ? l : 128,
      cacheId: (h = i.cacheId) != null ? h : 0,
    };
  }
};
j(md, "z$__type__Props");
let eT = md,
  N$ = 0;
const zg = class zg extends Sa {
  constructor(i, o) {
    super(i);
    j(this, "props");
    j(this, "parentTexture");
    j(this, "type", _i.subTexture);
    j(this, "subtextureId", "subtexture-".concat(N$++));
    j(this, "onParentTxLoaded", () => {
      this.forwardParentTxState("loaded", { width: this.props.width, height: this.props.height });
    });
    j(this, "onParentTxFailed", (i, o) => {
      ((this.retryCount = this.parentTexture.retryCount - 1), this.forwardParentTxState("failed", o));
    });
    j(this, "onParentTxLoading", () => {
      this.forwardParentTxState("loading");
    });
    j(this, "onParentTxFreed", () => {
      this.forwardParentTxState("freed");
    });
    ((this.props = zg.resolveDefaults(o || {})),
      this.props.texture,
      this.props.texture instanceof xd,
      (this.parentTexture = i.resolveParentTexture(this.props.texture)),
      this.renderableOwners.length > 0 && this.parentTexture.setRenderableOwner(this.subtextureId, !0),
      queueMicrotask(() => {
        const l = this.parentTexture;
        (l.state === "loaded" && l.dimensions
          ? this.onParentTxLoaded(l, l.dimensions)
          : l.state === "loading"
            ? this.onParentTxLoading()
            : l.state === "failed" && l.error
              ? this.onParentTxFailed(l, l.error)
              : l.state === "freed" && this.onParentTxFreed(),
          l.on("loading", this.onParentTxLoading),
          l.on("loaded", this.onParentTxLoaded),
          l.on("failed", this.onParentTxFailed),
          l.on("freed", this.onParentTxFreed));
      }));
  }
  forwardParentTxState(i, o) {
    this.setState(i, o);
  }
  onChangeIsRenderable(i) {
    this.parentTexture.setRenderableOwner(this.subtextureId, i);
  }
  async getTextureSource() {
    return { data: this.props };
  }
  static makeCacheKey(i) {
    return !1;
  }
  static resolveDefaults(i) {
    return { texture: i.texture, x: i.x || 0, y: i.y || 0, width: i.width || 0, height: i.height || 0 };
  }
};
j(zg, "z$__type__Props");
let Ag = zg;
const Yg = class Yg extends Sa {
  constructor(i, o) {
    super(i);
    j(this, "props");
    j(this, "type", _i.renderToTexture);
    this.props = Yg.resolveDefaults(o || {});
  }
  get width() {
    return this.props.width;
  }
  set width(i) {
    this.props.width = i;
  }
  get height() {
    return this.props.height;
  }
  set height(i) {
    this.props.height = i;
  }
  async getTextureSource() {
    return { data: null, premultiplyAlpha: null };
  }
  static resolveDefaults(i) {
    return { width: i.width || 256, height: i.height || 256 };
  }
};
j(Yg, "z$__type__Props");
let Ig = Yg;
async function F$() {
  var l, h, p;
  const u = new Uint8Array([
      137, 80, 78, 71, 13, 10, 26, 10, 0, 0, 0, 13, 73, 72, 68, 82, 0, 0, 0, 1, 0, 0, 0, 1, 1, 3, 0, 0, 0, 37,
      219, 86, 202, 0, 0, 0, 3, 80, 76, 84, 69, 0, 0, 0, 167, 122, 61, 218, 0, 0, 0, 1, 116, 82, 78, 83, 0,
      64, 230, 216, 102, 0, 0, 0, 10, 73, 68, 65, 84, 8, 215, 99, 96, 0, 0, 0, 2, 0, 1, 226, 33, 188, 51, 0,
      0, 0, 0, 73, 69, 78, 68, 174, 66, 96, 130,
    ]),
    n = { basic: !1, options: !1, full: !1 },
    i = new Blob([u], { type: "image/png" }),
    o = await createImageBitmap(i);
  ((l = o.close) == null || l.call(o), (n.basic = !0));
  try {
    const d = { premultiplyAlpha: "none" },
      y = await createImageBitmap(i, d);
    ((h = y.close) == null || h.call(y), (n.options = !0));
  } catch (d) {}
  try {
    const d = await createImageBitmap(i, 0, 0, 1, 1, { premultiplyAlpha: "none" });
    ((p = d.close) == null || p.call(d), (n.full = !0));
  } catch (d) {}
  return n;
}
var zs;
(function (u) {
  ((u.MEMORY_THRESHOLD_EXCEEDED = "MEMORY_THRESHOLD_EXCEEDED"),
    (u.TEXTURE_DATA_NULL = "TEXTURE_DATA_NULL"),
    (u.TEXTURE_TYPE_NOT_REGISTERED = "TEXTURE_TYPE_NOT_REGISTERED"));
})(zs || (zs = {}));
const U$ = {
  [zs.MEMORY_THRESHOLD_EXCEEDED]: "Memory threshold exceeded",
  [zs.TEXTURE_DATA_NULL]: "Texture data is null",
  [zs.TEXTURE_TYPE_NOT_REGISTERED]: "Texture type is not registered",
};
class sx extends Error {
  constructor(i, o) {
    const l = Object.values(zs).includes(i),
      h = l ? i : void 0;
    let p;
    l && h ? (p = o != null ? o : U$[h]) : (p = String(i));
    super(p);
    j(this, "code");
    ((this.name = new.target.name), h && (this.code = h));
  }
}
class B$ extends Fo {
  constructor(i, o) {
    super();
    j(this, "keyCache", new Map());
    j(this, "inverseKeyCache", new WeakMap());
    j(this, "txConstructors", {});
    j(this, "maxRetryCount");
    j(this, "priorityQueue", []);
    j(this, "uploadTextureQueue", []);
    j(this, "initialized", !1);
    j(this, "stage");
    j(this, "numImageWorkers");
    j(this, "imageWorkerManager", null);
    j(this, "hasCreateImageBitmap", !!self.createImageBitmap);
    j(this, "imageBitmapSupported", { basic: !1, options: !1, full: !1 });
    j(this, "hasWorker", !!self.Worker);
    j(this, "renderer");
    j(this, "frameTime", 0);
    const { numImageWorkers: l, createImageBitmapSupport: h, maxRetryCount: p } = o;
    ((this.stage = i),
      (this.numImageWorkers = l),
      (this.maxRetryCount = p),
      h === "auto"
        ? F$()
            .then(d => {
              this.initialize(d);
            })
            .catch(() => {
              (console.warn(
                "[Lightning] createImageBitmap is not supported on this browser. ImageTexture will be slower.",
              ),
                (this.initialized = !0),
                this.emit("initialized"));
            })
        : this.initialize({ basic: h === "basic", options: h === "options", full: h === "full" }),
      this.registerTextureType("ImageTexture", xd),
      this.registerTextureType("ColorTexture", Eg),
      this.registerTextureType("NoiseTexture", eT),
      this.registerTextureType("SubTexture", Ag),
      this.registerTextureType("RenderTexture", Ig));
  }
  registerTextureType(i, o) {
    this.txConstructors[i] = o;
  }
  initialize(i) {
    ((this.hasCreateImageBitmap = i.basic || i.options || i.full),
      (this.imageBitmapSupported = i),
      this.hasCreateImageBitmap ||
        console.warn(
          "[Lightning] createImageBitmap is not supported on this browser. ImageTexture will be slower.",
        ),
      this.hasCreateImageBitmap && this.hasWorker && this.numImageWorkers > 0
        ? (this.imageWorkerManager = new S$(this.numImageWorkers, i))
        : console.warn(
            "[Lightning] Imageworker is 0 or not supported on this browser. Image loading will be slower.",
          ),
      (this.initialized = !0),
      this.emit("initialized"));
  }
  enqueueUploadTexture(i) {
    this.uploadTextureQueue.includes(i) === !1 && this.uploadTextureQueue.push(i);
  }
  createTexture(i, o) {
    let l;
    const h = this.txConstructors[i];
    if (!h) throw new sx(zs.TEXTURE_TYPE_NOT_REGISTERED, 'Texture type "'.concat(i, '" is not registered'));
    const p = h.makeCacheKey(o);
    return (
      p && this.keyCache.has(p)
        ? (l = this.keyCache.get(p))
        : ((l = new h(this, o)), p && this.initTextureToCache(l, p)),
      l
    );
  }
  async loadTexture(i, o) {
    if (i.type === _i.subTexture || i.state === "loaded" || i.state === "loading") return;
    if (this.initialized === !1) {
      this.priorityQueue.push(i);
      return;
    }
    if (
      (i.setState("loading"),
      (await i.getTextureData().catch(p => (console.error(p), i.setState("failed"), null))) === null ||
        i.state === "failed")
    )
      return;
    if ((i.type !== _i.image || o === !0) === !0) {
      await this.uploadTexture(i).catch(p => {
        (console.error("Failed to upload texture:", p), i.setState("failed"));
      });
      return;
    }
    this.enqueueUploadTexture(i);
  }
  async uploadTexture(i) {
    if (
      this.stage.txMemManager.doNotExceedCriticalThreshold === !0 &&
      this.stage.txMemManager.criticalCleanupRequested === !0
    ) {
      i.setState("failed", new sx(zs.MEMORY_THRESHOLD_EXCEEDED));
      return;
    }
    if (i.state === "failed" || i.state === "freed" || i.state === "loaded") return;
    if (i.textureData === null) {
      i.setState("failed", new sx(zs.TEXTURE_DATA_NULL, "Texture data is null, cannot upload texture"));
      return;
    }
    const o = i.loadCtxTexture();
    if (o !== null && o.state === "loaded") {
      i.setState("loaded");
      return;
    }
    await o.load();
  }
  isProcessingTexture(i) {
    return this.uploadTextureQueue.includes(i) === !0;
  }
  async processSome(i) {
    if (this.initialized === !1) return;
    const o = ag();
    for (; this.priorityQueue.length > 0 && ag() - o < i; ) {
      const l = this.priorityQueue.pop();
      try {
        (await l.getTextureData(), await this.uploadTexture(l));
      } catch (h) {
        console.error("Failed to process priority texture:", h);
      }
    }
    for (; this.uploadTextureQueue.length > 0 && ag() - o < i; ) {
      const l = this.uploadTextureQueue.shift();
      try {
        await this.uploadTexture(l);
      } catch (h) {
        console.error("Failed to upload texture:", h);
      }
    }
  }
  hasUpdates() {
    return this.uploadTextureQueue.length > 0;
  }
  initTextureToCache(i, o) {
    const { keyCache: l, inverseKeyCache: h } = this;
    (l.set(o, i), h.set(i, o));
  }
  getTextureFromCache(i) {
    return this.keyCache.get(i);
  }
  removeTextureFromCache(i) {
    const { inverseKeyCache: o, keyCache: l } = this,
      h = o.get(i);
    h && l.delete(h);
  }
  resolveParentTexture(i) {
    if (!(i != null && i.props)) return i;
    const o = xd.makeCacheKey(i.props),
      l = o ? this.getTextureFromCache(o) : void 0;
    return l != null ? l : i;
  }
}
const $$ = { normal: 400, bold: 700, bolder: 900, lighter: 100 },
  HL = u => (typeof u == "number" ? u : $$[u] || 400);
function G$(u, n, i, o, l) {
  let h = HL(i);
  for (const p of u) {
    const d = p[n];
    if (!d) continue;
    if (d.size === 1)
      return (
        console.warn(
          "TrFontManager: Only one font face found for family: '".concat(
            n,
            "' - will be used for all weights and styles",
          ),
        ),
        d.values().next().value
      );
    const y = new Map();
    for (const T of d) {
      const S = HL(T.descriptors.weight);
      if (S === h && T.descriptors.style === o && T.descriptors.stretch === l) return T;
      y.set(S, T);
    }
    const v = "TrFontManager: No exact match: '"
      .concat(n, " Weight: ")
      .concat(h, " Style: ")
      .concat(o, " Stretch: ")
      .concat(l, "'");
    if ((console.error(v), h === 400 && y.has(500))) return y.get(500);
    if (h === 500 && y.has(400)) return y.get(400);
    if (h < 400) {
      for (; h > 0; ) {
        if (y.has(h)) return y.get(h);
        h -= 100;
      }
      h = 600;
    }
    for (; h < 1e3; ) {
      if (y.has(h)) return y.get(h);
      h += 100;
    }
    for (h = 500; h > 0; ) {
      if (y.has(h)) return y.get(h);
      h -= 100;
    }
  }
}
class j$ {
  constructor(n) {
    j(this, "textRenderers");
    j(this, "fontCache", new Map());
    this.textRenderers = n;
  }
  addFontFace(n) {
    for (const i in this.textRenderers) {
      const o = this.textRenderers[i];
      o && o.isFontFaceSupported(n) && o.addFontFace(n);
    }
  }
  resolveFontFace(n, i, o) {
    const { fontFamily: l, fontWeight: h, fontStyle: p, fontStretch: d } = i,
      y = "".concat(o, "_").concat(l, "_").concat(p, "_").concat(h, "_").concat(d);
    if (this.fontCache.has(y) === !0) return this.fontCache.get(y);
    const v = G$(n, l, h, p, d);
    return (v !== void 0 && this.fontCache.set(y, v), v);
  }
}
class cD {
  static makeCacheKey(n) {
    return !1;
  }
  static resolveDefaults(n) {
    return {};
  }
}
function KL(u, n, i) {
  const o = u.createShader(n);
  if (!o) {
    const h = u.getError();
    throw new Error(
      "Unable to create the shader: "
        .concat(n === u.VERTEX_SHADER ? "VERTEX_SHADER" : "FRAGMENT_SHADER", ".")
        .concat(h ? " WebGlContext Error: ".concat(h) : ""),
    );
  }
  if ((u.shaderSource(o, i), u.compileShader(o), !!u.getShaderParameter(o, u.COMPILE_STATUS))) return o;
  (console.error(u.getShaderInfoLog(o)), u.deleteShader(o));
}
function V$(u, n, i) {
  const o = u.createProgram();
  if (!o) throw new Error("Unable to create program");
  if (
    (u.attachShader(o, n), u.attachShader(o, i), u.linkProgram(o), !!u.getProgramParameter(o, u.LINK_STATUS))
  )
    return o;
  (console.warn(u.getProgramInfoLog(o)), u.deleteProgram(o));
}
class Ia extends cD {
  constructor(i) {
    super();
    j(this, "buffersBound", !1);
    j(this, "program");
    j(this, "vao");
    j(this, "renderer");
    j(this, "glw");
    j(this, "attributeLocations");
    j(this, "uniformLocations");
    j(this, "supportsIndexedTextures");
    const o = (this.renderer = i.renderer),
      l = (this.glw = this.renderer.glw);
    this.supportsIndexedTextures = i.supportsIndexedTextures || !1;
    const h = l.isWebGl2(),
      p = (h && i.webgl2Extensions) || (!h && i.webgl1Extensions) || [],
      d = h ? "2.0" : "1.0";
    p.forEach(k => {
      if (!l.getExtension(k))
        throw new Error(
          'Shader "'
            .concat(this.constructor.name, '" requires extension "')
            .concat(k, '" for WebGL ')
            .concat(d, " but wasn't found"),
        );
    });
    const y = i.shaderSources || this.constructor.shaderSources;
    if (y)
      h &&
        y != null &&
        y.webGl2 &&
        ((y.fragment = y.webGl2.fragment), (y.vertex = y.webGl2.vertex), delete y.webGl2);
    else throw new Error('Shader "'.concat(this.constructor.name, '" is missing shaderSources.'));
    const v = o.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS,
      T = y.vertex instanceof Function ? y.vertex(v) : y.vertex,
      S = y.fragment instanceof Function ? y.fragment(v) : y.fragment,
      w = KL(l, l.VERTEX_SHADER, T),
      C = KL(l, l.FRAGMENT_SHADER, S);
    if (!w || !C)
      throw new Error(
        "Unable to create the following shader(s): ".concat(
          [!w && "VERTEX_SHADER", !C && "FRAGMENT_SHADER"].filter(Boolean).join(" and "),
        ),
      );
    const L = V$(l, w, C);
    if (!L) throw new Error("Unable to create program");
    ((this.program = L),
      (this.attributeLocations = l.getAttributeLocations(this.program)),
      (this.uniformLocations = l.getUniformLocations(this.program)));
  }
  disableAttribute(i) {
    this.glw.disableVertexAttribArray(i);
  }
  disableAttributes() {
    const i = this.glw,
      o = this.attributeLocations.length;
    for (let l = 0; l < o; l++) i.disableVertexAttribArray(l);
  }
  canBatchShaderProps(i, o) {
    return !1;
  }
  bindRenderOp(i, o) {
    var d;
    (this.bindBufferCollection(i.buffers),
      i.textures.length > 0 && (d = i.textures[0]) != null && d.ctxTexture && this.bindTextures(i.textures));
    const { glw: l, parentHasRenderTexture: h, renderToTexture: p } = i;
    if (!(p && h)) {
      if (h) {
        const { width: y, height: v } = i.framebufferDimensions || {};
        (l.uniform1f(this.getUniformLocation("u_pixelRatio"), 1),
          l.uniform2f(this.getUniformLocation("u_resolution"), y != null ? y : 0, v != null ? v : 0));
      } else
        (l.uniform1f(this.getUniformLocation("u_pixelRatio"), i.options.pixelRatio),
          l.uniform2f(this.getUniformLocation("u_resolution"), l.canvas.width, l.canvas.height));
      if (o) {
        if (Sg(o, "$dimensions")) {
          let y = o.$dimensions;
          (y || (y = i.dimensions), l.uniform2f(this.getUniformLocation("u_dimensions"), y.width, y.height));
        }
        if (Sg(o, "$alpha")) {
          let y = o.$alpha;
          (y || (y = i.alpha), l.uniform1f(this.getUniformLocation("u_alpha"), y));
        }
        this.bindProps(o);
      }
    }
  }
  getUniformLocation(i) {
    return this.uniformLocations[i] || null;
  }
  bindBufferCollection(i) {
    const { glw: o } = this,
      l = this.attributeLocations,
      h = l.length;
    for (let p = 0; p < h; p++) {
      const d = l[p],
        y = i.getBuffer(d),
        v = i.getAttributeInfo(d);
      y === void 0 ||
        v === void 0 ||
        (o.enableVertexAttribArray(p),
        o.vertexAttribPointer(y, p, v.size, v.type, v.normalized, v.stride, v.offset));
    }
  }
  bindProps(i) {}
  bindTextures(i) {}
  attach() {
    (this.glw.useProgram(this.program),
      this.glw.isWebGl2() && this.vao && this.glw.bindVertexArray(this.vao));
  }
  detach() {
    this.disableAttributes();
  }
}
j(Ia, "shaderSources");
class dD extends Ia {
  constructor(n) {
    super({ renderer: n });
  }
  bindTextures(n) {
    const { glw: i } = this;
    (i.activeTexture(0), i.bindTexture(n[0].ctxTexture));
  }
}
j(dD, "shaderSources", {
  vertex:
    "\n      # ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      attribute vec2 a_position;\n      attribute vec2 a_textureCoordinate;\n      attribute vec2 a_nodeCoordinate;\n      attribute vec4 a_color;\n\n      uniform vec2 u_resolution;\n      uniform float u_pixelRatio;\n\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n      varying vec2 v_nodeCoordinate;\n\n      void main() {\n        vec2 normalized = a_position * u_pixelRatio;\n        vec2 screenSpace = vec2(2.0 / u_resolution.x, -2.0 / u_resolution.y);\n\n        v_color = a_color;\n        v_textureCoordinate = a_textureCoordinate;\n        v_nodeCoordinate = a_nodeCoordinate;\n\n        gl_Position = vec4(normalized.x * screenSpace.x - 1.0, normalized.y * -abs(screenSpace.y) + 1.0, 0.0, 1.0);\n        gl_Position.y = -sign(screenSpace.y) * gl_Position.y;\n      }\n    ",
  fragment:
    "\n      # ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      uniform vec2 u_resolution;\n      uniform sampler2D u_texture;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n\n      void main() {\n          vec4 color = texture2D(u_texture, v_textureCoordinate);\n          gl_FragColor = vec4(v_color) * texture2D(u_texture, v_textureCoordinate);\n      }\n    ",
});
class hD extends Ia {
  constructor(i) {
    super({ renderer: i });
    j(this, "supportsIndexedTextures", !0);
  }
  bindTextures(i) {
    const { renderer: o, glw: l } = this;
    if (i.length > o.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS)
      throw new Error(
        "DefaultShaderBatched: Cannot bind more than ".concat(
          o.system.parameters.MAX_VERTEX_TEXTURE_IMAGE_UNITS,
          " textures",
        ),
      );
    i.forEach((p, d) => {
      (l.activeTexture(d), l.bindTexture(p.ctxTexture));
    });
    const h = Array.from(Array(i.length).keys());
    this.glw.uniform1iv(this.getUniformLocation("u_textures[0]"), h);
  }
}
j(hD, "shaderSources", {
  vertex:
    "\n      # ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      attribute vec2 a_textureCoordinate;\n      attribute vec2 a_position;\n      attribute vec4 a_color;\n      attribute float a_textureIndex;\n      attribute float a_depth;\n\n      uniform vec2 u_resolution;\n      uniform float u_pixelRatio;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n      varying float v_textureIndex;\n\n      void main(){\n        vec2 normalized = a_position * u_pixelRatio / u_resolution;\n        vec2 zero_two = normalized * 2.0;\n        vec2 clip_space = zero_two - 1.0;\n\n        // pass to fragment\n        v_color = a_color;\n        v_textureCoordinate = a_textureCoordinate;\n        v_textureIndex = a_textureIndex;\n\n        // flip y\n        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);\n      }\n    ",
  fragment: i =>
    "\n      #define txUnits "
      .concat(
        i,
        "\n      # ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      uniform vec2 u_resolution;\n      uniform sampler2D u_image;\n      uniform sampler2D u_textures[txUnits];\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n      varying float v_textureIndex;\n\n      vec4 sampleFromTexture(sampler2D textures[",
      )
      .concat(i, "], int idx, vec2 uv) {\n        ")
      .concat(
        Array.from(Array(i).keys())
          .map(o =>
            "\n          "
              .concat(o !== 0 ? "else " : "", "if (idx == ")
              .concat(o, ") {\n            return texture2D(textures[")
              .concat(o, "], uv);\n          }\n        "),
          )
          .join(""),
        "\n        return texture2D(textures[0], uv);\n      }\n\n      void main(){\n        gl_FragColor = vec4(v_color) * sampleFromTexture(u_textures, int(v_textureIndex), v_textureCoordinate);\n      }\n    ",
      ),
});
class oi {
  constructor(n) {
    j(this, "priority", 1);
    j(this, "name", "");
    j(this, "ref");
    j(this, "target");
    j(this, "passParameters", "");
    j(this, "declaredUniforms", "");
    j(this, "uniformInfo", {});
    const { ref: i, target: o, props: l = {} } = n;
    ((this.ref = i), (this.target = o));
    const h = {},
      p = [];
    let d = "";
    const y = this.constructor.uniforms || {};
    for (const v in y) {
      const T = y[v],
        S = T.type,
        w = "".concat(i, "_").concat(v);
      let C = "";
      (T.size && (C = "[".concat(T.size(l), "]")),
        p.push(w),
        (d += "uniform ".concat(S, " ").concat(w).concat(C, ";")),
        (h[v] = { name: w, uniform: y[v].method }));
    }
    ((this.passParameters = p.join(",")), (this.declaredUniforms = d), (this.uniformInfo = h));
  }
  static getEffectKey(n) {
    return "";
  }
  static getMethodParameters(n, i) {
    const o = [];
    for (const l in n) {
      const h = n[l];
      let p = "";
      (h.size && (p = "[".concat(h.size(i), "]")), o.push("".concat(h.type, " ").concat(l).concat(p)));
    }
    return o.join(",");
  }
  static resolveDefaults(n) {
    return {};
  }
  static makeEffectKey(n) {
    return !1;
  }
}
(j(oi, "uniforms", {}), j(oi, "methods"), j(oi, "onShaderMask"), j(oi, "onColorize"), j(oi, "onEffectMask"));
const ox = new Map(),
  H$ = (u, n) => {
    const i = JSON.stringify(u);
    if (ox.has(i)) return ox.get(i);
    u = u != null ? u : [];
    const o = [],
      l = u.length;
    let h = 0;
    for (; h < l; h++) {
      const { name: p, type: d, props: y } = u[h],
        v = { name: p, type: d, props: {} },
        T = n[d],
        S = T.resolveDefaults(y),
        w = T.uniforms,
        C = Object.keys(w),
        L = C.length;
      let k = 0;
      for (; k < L; k++) {
        const O = C[k],
          B = w[O],
          N = {
            value: S[O],
            programValue: void 0,
            method: B.method,
            updateOnBind: B.updateOnBind || !1,
            hasValidator: B.validator !== void 0,
            hasProgramValueUpdater: B.updateProgramValue !== void 0,
          },
          $ = (N.hasValidator && B.validator(S[O], S)) || S[O];
        (S[O] !== $ && (N.validatedValue = $),
          N.hasProgramValueUpdater && B.updateProgramValue(N),
          N.programValue === void 0 && (N.programValue = N.value),
          (v.props[O] = N));
      }
      o.push(v);
    }
    return (ox.set(i, o), o);
  },
  Ks = class Ks extends Ia {
    constructor(i, o, l) {
      const h = Ks.createShader(o, l);
      super({ renderer: i, shaderSources: { vertex: h.vertex, fragment: h.fragment } });
      j(this, "effects", []);
      this.effects = h.effects;
    }
    bindTextures(i) {
      const { glw: o } = this;
      (o.activeTexture(0), o.bindTexture(i[0].ctxTexture));
    }
    bindUniformMethods(i) {
      const o = this.glw,
        l = i.effects,
        h = l.length;
      for (let p = 0; p < h; p++) {
        const d = this.effects[p].uniformInfo,
          y = l[p],
          v = Object.keys(y.props),
          T = v.length;
        for (let S = 0; S < T; S++) {
          const w = v[S],
            C = y.props[w].method,
            L = this.getUniformLocation(d[w].name);
          if (
            C === "uniform2fv" ||
            C === "uniform2iv" ||
            C === "uniform3iv" ||
            C === "uniform4fv" ||
            C === "uniform4iv" ||
            C === "uniformMatrix2fv" ||
            C === "uniformMatrix3fv" ||
            C === "uniformMatrix4fv" ||
            C === "uniform1f" ||
            C === "uniform1fv" ||
            C === "uniform1i" ||
            C === "uniform1iv"
          ) {
            y.props[w].setUniformValue = function () {
              o[C](L, this.programValue);
            };
            continue;
          }
          if (C === "uniform2f" || C === "uniform2i") {
            y.props[w].setUniformValue = function () {
              o[C](L, this.programValue[0], this.programValue[1]);
            };
            continue;
          }
          if (C === "uniform3f" || C === "uniform3i") {
            y.props[w].setUniformValue = function () {
              o[C](L, this.programValue[0], this.programValue[1], this.programValue[2]);
            };
            continue;
          }
          if (C === "uniform4f" || C === "uniform4i") {
            y.props[w].setUniformValue = function () {
              o[C](L, this.programValue[0], this.programValue[1], this.programValue[2], this.programValue[3]);
            };
            continue;
          }
        }
      }
    }
    bindProps(i) {
      var p;
      const o = i.effects,
        l = o.length;
      let h = 0;
      for (; h < l; h++) {
        const d = o[h],
          y = Object.keys(d.props),
          v = y.length;
        let T = 0;
        for (; T < v; T++) {
          const S = y[T],
            w = d.props[S];
          if (w.updateOnBind === !0) {
            const C =
              (p = this.renderer.shManager.getRegisteredEffects()[d.type]) == null ? void 0 : p.uniforms[S];
            C == null || C.updateProgramValue(d.props[S], i);
          }
          w.setUniformValue();
        }
      }
    }
    canBatchShaderProps(i, o) {
      if (
        i.$alpha !== o.$alpha ||
        i.$dimensions.width !== o.$dimensions.width ||
        i.$dimensions.height !== o.$dimensions.height ||
        i.effects.length !== o.effects.length
      )
        return !1;
      const l = i.effects.length;
      let h = 0;
      for (; h < l; h++) {
        const p = i.effects[h],
          d = o.effects[h];
        if (p.type !== d.type) return !1;
        for (const y in p.props)
          if ((d.props && !d.props[y]) || p.props[y].value !== d.props[y].value) return !1;
      }
      return !0;
    }
    static createShader(i, o) {
      const l = {},
        h = {};
      let p = "";
      const d = [],
        y = [],
        v = i.effects.map(L => {
          const k = o[L.type],
            O = k.getEffectKey(L.props || {});
          l[O] = l[O] ? ++l[O] : 1;
          const B = l[O];
          B === 1 && y.push({ key: O, type: L.type, props: L.props });
          const N = new k({ ref: "".concat(O).concat(B === 1 ? "" : B), target: O, props: L.props });
          return ((p += N.declaredUniforms), d.push(...Object.values(N.uniformInfo)), N);
        });
      let T = "";
      y == null ||
        y.forEach(L => {
          var Y;
          const k = o[L.type],
            O = k.resolveDefaults((Y = L.props) != null ? Y : {}),
            B = [];
          for (const te in k.methods) {
            let _ = te;
            const K = k.methods[te];
            (h[te] && h[te] !== K && (_ = Ks.resolveMethodDuplicate(te, K, h)),
              (h[_] = K.replace("function", _)),
              B.push({ m: te, cm: _ }));
          }
          let N = k.onShaderMask instanceof Function ? k.onShaderMask(O) : k.onShaderMask,
            $ = k.onColorize instanceof Function ? k.onColorize(O) : k.onColorize,
            I = k.onEffectMask instanceof Function ? k.onEffectMask(O) : k.onEffectMask;
          B.forEach(te => {
            const { m: _, cm: K } = te,
              q = new RegExp("\\$".concat(_), "g");
            (N && (N = N.replace(q, K)), $ && ($ = $.replace(q, K)), I && (I = I.replace(q, K)));
          });
          const V = k.getMethodParameters(k.uniforms, O),
            oe = V.length > 0 ? ", ".concat(V) : "";
          (N &&
            (T += "\n        float fx_"
              .concat(L.key, "_onShaderMask(float shaderMask ")
              .concat(oe, ") {\n          ")
              .concat(N, "\n        }\n        ")),
            $ &&
              (T += "\n          vec4 fx_"
                .concat(L.key, "_onColorize(float shaderMask, vec4 maskColor, vec4 shaderColor")
                .concat(oe, ") {\n            ")
                .concat($, "\n          }\n        ")),
            I &&
              (T += "\n          vec4 fx_"
                .concat(L.key, "_onEffectMask(float shaderMask, vec4 maskColor, vec4 shaderColor")
                .concat(oe, ") {\n            ")
                .concat(I, "\n          }\n        ")));
        });
      let S = "";
      for (const L in h) S += h[L];
      let w = "mix(shaderColor, maskColor, clamp(-(lng_DefaultMask), 0.0, 1.0))",
        C = "\n\n    ";
      for (let L = 0; L < v.length; L++) {
        const k = v[L],
          O = k.passParameters.length > 0 ? ", ".concat(k.passParameters) : "",
          B = o[k.name];
        (B.onShaderMask &&
          (C += "\n        shaderMask = fx_"
            .concat(k.target, "_onShaderMask(shaderMask ")
            .concat(O, ");\n        ")),
          B.onColorize &&
            (C += "\n        maskColor = fx_"
              .concat(k.target, "_onColorize(shaderMask, maskColor, shaderColor")
              .concat(O, ");\n        ")),
          B.onEffectMask &&
            (w = "fx_".concat(k.target, "_onEffectMask(shaderMask, maskColor, shaderColor").concat(O, ")")));
        const N = v[L + 1];
        (N === void 0 || o[N.name].onEffectMask) &&
          (C += "\n          shaderColor = ".concat(w, ";\n        "));
      }
      return { effects: v, uniforms: d, fragment: Ks.fragment(p, S, T, C), vertex: Ks.vertex() };
    }
    static resolveMethodDuplicate(i, o, l, h = 0) {
      const p = i + (h > 0 ? h : "");
      return l[p] && l[p] !== o ? this.resolveMethodDuplicate(i, o, l, ++h) : p;
    }
    static resolveDefaults(i, o) {
      var l;
      return {
        effects: H$((l = i.effects) != null ? l : [], o),
        $dimensions: { width: 0, height: 0 },
        $alpha: 0,
      };
    }
    static makeCacheKey(i, o) {
      var h;
      let l = "";
      return (
        (h = i.effects) == null ||
          h.forEach(p => {
            const y = o[p.type].getEffectKey(p.props || {});
            l += ",".concat(y);
          }),
        "DynamicShader".concat(l)
      );
    }
  };
(j(Ks, "z$__type__Props"),
  j(
    Ks,
    "vertex",
    () =>
      "\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision mediump float;\n    # endif\n\n    attribute vec2 a_textureCoordinate;\n    attribute vec2 a_nodeCoordinate;\n    attribute vec2 a_position;\n    attribute vec4 a_color;\n    attribute float a_textureIndex;\n\n    uniform vec2 u_resolution;\n    uniform float u_pixelRatio;\n\n    varying vec4 v_color;\n    varying vec2 v_textureCoordinate;\n    varying float v_textureIndex;\n    varying vec2 v_nodeCoordinate;\n\n    void main(){\n      vec2 normalized = a_position * u_pixelRatio / u_resolution;\n      vec2 zero_two = normalized * 2.0;\n      vec2 clip_space = zero_two - 1.0;\n\n      // pass to fragment\n      v_color = a_color;\n      v_textureCoordinate = a_textureCoordinate;\n      v_textureIndex = a_textureIndex;\n      v_nodeCoordinate = a_nodeCoordinate;\n\n      // flip y\n      gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);\n    }\n  ",
  ),
  j(Ks, "fragment", (i, o, l, h) =>
    "\n    # ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    # else\n    precision mediump float;\n    # endif\n\n    #define PI 3.14159265359\n\n    uniform vec2 u_resolution;\n    uniform vec2 u_dimensions;\n    uniform float u_alpha;\n    uniform float u_radius;\n    uniform sampler2D u_texture;\n    uniform float u_pixelRatio;\n\n    "
      .concat(
        i,
        "\n\n    varying vec4 v_color;\n    varying vec2 v_textureCoordinate;\n    varying vec2 v_nodeCoordinate;\n\n    ",
      )
      .concat(o, "\n\n    ")
      .concat(
        l,
        "\n\n    void main() {\n      vec2 p = v_nodeCoordinate.xy * u_dimensions - u_dimensions * 0.5;\n      vec2 d = abs(p) - (u_dimensions) * 0.5;\n      float lng_DefaultMask = min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n\n      vec4 shaderColor = vec4(0.0);\n      float shaderMask = lng_DefaultMask;\n\n      vec4 maskColor = texture2D(u_texture, v_textureCoordinate) * v_color;\n\n      shaderColor = mix(shaderColor, maskColor, clamp(-(lng_DefaultMask + 0.5), 0.0, 1.0));\n\n      ",
      )
      .concat(h, "\n\n      gl_FragColor = shaderColor * u_alpha;\n    }\n  "),
  ));
let eu = Ks;
class tT extends Ia {
  constructor(n) {
    super({ renderer: n });
  }
  static resolveDefaults(n) {
    return { radius: n.radius || 10, $dimensions: { width: 0, height: 0 } };
  }
  bindTextures(n) {
    const { glw: i } = this;
    (i.activeTexture(0), i.bindTexture(n[0].ctxTexture));
  }
  bindProps(n) {
    const i = Math.min(n.$dimensions.width, n.$dimensions.height) / (2 * n.radius);
    this.glw.uniform1f(this.getUniformLocation("u_radius"), n.radius * Math.min(i, 1));
  }
  canBatchShaderProps(n, i) {
    return (
      n.radius === i.radius &&
      n.$dimensions.width === i.$dimensions.width &&
      n.$dimensions.height === i.$dimensions.height
    );
  }
}
(j(tT, "z$__type__Props"),
  j(tT, "shaderSources", {
    vertex:
      "\n      # ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      attribute vec2 a_position;\n      attribute vec2 a_textureCoordinate;\n      attribute vec4 a_color;\n      attribute float a_textureIndex;\n      attribute vec2 a_nodeCoordinate;\n\n      uniform vec2 u_resolution;\n      uniform float u_pixelRatio;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n      varying vec2 v_nodeCoordinate;\n\n      void main() {\n        vec2 normalized = a_position * u_pixelRatio / u_resolution;\n        vec2 zero_two = normalized * 2.0;\n        vec2 clip_space = zero_two - 1.0;\n\n        // pass to fragment\n        v_color = a_color;\n        v_textureCoordinate = a_textureCoordinate;\n        v_nodeCoordinate = a_nodeCoordinate;\n\n        // flip y\n        gl_Position = vec4(clip_space * vec2(1.0, -1.0), 0, 1);\n      }\n    ",
    fragment:
      "\n      # ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n\n      uniform vec2 u_resolution;\n      uniform vec2 u_dimensions;\n      uniform float u_radius;\n      uniform sampler2D u_texture;\n\n      varying vec4 v_color;\n      varying vec2 v_textureCoordinate;\n      varying vec2 v_nodeCoordinate;\n\n      float boxDist(vec2 p, vec2 size, float radius){\n        size -= vec2(radius);\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;\n      }\n\n      float fillMask(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n\n      void main() {\n        vec4 color = texture2D(u_texture, v_textureCoordinate) * v_color;\n        vec2 halfDimensions = u_dimensions * 0.5;\n\n        float d = boxDist(v_nodeCoordinate.xy * u_dimensions - halfDimensions, halfDimensions + 0.5, u_radius);\n        gl_FragColor = mix(vec4(0.0), color, fillMask(d));\n      }\n    ",
  }));
const K$ = new Float32Array([1, 0, 0, 0, 1, 0, 0, 0, 1]),
  yd = class yd extends Ia {
    constructor(n) {
      super({ renderer: n });
    }
    bindTextures(n) {
      const { glw: i } = this;
      (i.activeTexture(0), i.bindTexture(n[0].ctxTexture));
    }
    bindProps(n) {
      const i = yd.resolveDefaults(n);
      for (const o in i)
        if (o === "transform") this.glw.uniformMatrix3fv(this.getUniformLocation("u_transform"), i[o]);
        else if (o === "scrollY") this.glw.uniform1f(this.getUniformLocation("u_scrollY"), i[o]);
        else if (o === "color") {
          const l = Xg(i.color);
          this.glw.uniform4fv(this.getUniformLocation("u_color"), l);
        } else
          o === "size"
            ? this.glw.uniform1f(this.getUniformLocation("u_size"), i[o])
            : o === "distanceRange"
              ? this.glw.uniform1f(this.getUniformLocation("u_distanceRange"), i[o])
              : o === "debug" && this.glw.uniform1i(this.getUniformLocation("u_debug"), i[o] ? 1 : 0);
    }
    static resolveDefaults(n = {}) {
      var i, o, l, h, p, d;
      return {
        transform: (i = n.transform) != null ? i : K$,
        scrollY: (o = n.scrollY) != null ? o : 0,
        color: (l = n.color) != null ? l : 4294967295,
        size: (h = n.size) != null ? h : 16,
        distanceRange: (p = n.distanceRange) != null ? p : 1,
        debug: (d = n.debug) != null ? d : !1,
      };
    }
  };
(j(yd, "z$__type__Props"),
  j(yd, "shaderSources", {
    vertex:
      "\n      # ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n      // an attribute is an input (in) to a vertex shader.\n      // It will receive data from a buffer\n      attribute vec2 a_position;\n      attribute vec2 a_textureCoordinate;\n\n      uniform vec2 u_resolution;\n      uniform mat3 u_transform;\n      uniform float u_scrollY;\n      uniform float u_pixelRatio;\n      uniform float u_size;\n\n      varying vec2 v_texcoord;\n\n      void main() {\n        vec2 scrolledPosition = a_position * u_size - vec2(0, u_scrollY);\n        vec2 transformedPosition = (u_transform * vec3(scrolledPosition, 1)).xy;\n\n        // Calculate screen space with pixel ratio\n        vec2 screenSpace = (transformedPosition * u_pixelRatio / u_resolution * 2.0 - 1.0) * vec2(1, -1);\n\n        gl_Position = vec4(screenSpace, 0.0, 1.0);\n        v_texcoord = a_textureCoordinate;\n\n      }\n    ",
    fragment:
      "\n      # ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      # else\n      precision mediump float;\n      # endif\n      uniform vec4 u_color;\n      uniform sampler2D u_texture;\n      uniform float u_distanceRange;\n      uniform float u_pixelRatio;\n      uniform int u_debug;\n\n      varying vec2 v_texcoord;\n\n      float median(float r, float g, float b) {\n          return max(min(r, g), min(max(r, g), b));\n      }\n\n      void main() {\n          vec3 sample = texture2D(u_texture, v_texcoord).rgb;\n          if (u_debug == 1) {\n            gl_FragColor = vec4(sample.r, sample.g, sample.b, 1.0);\n            return;\n          }\n          float scaledDistRange = u_distanceRange * u_pixelRatio;\n          float sigDist = scaledDistRange * (median(sample.r, sample.g, sample.b) - 0.5);\n          float opacity = clamp(sigDist + 0.5, 0.0, 1.0) * u_color.a;\n\n          // Build the final color.\n          // IMPORTANT: We must premultiply the color by the alpha value before returning it.\n          gl_FragColor = vec4(u_color.r * opacity, u_color.g * opacity, u_color.b * opacity, opacity);\n      }\n    ",
  }));
let nT = yd;
const du = u => {
    u.programValue === void 0 && (u.programValue = new Float32Array(4));
    const n = u.value,
      i = u.programValue;
    ((i[0] = (n >>> 24) / 255),
      (i[1] = ((n >>> 16) & 255) / 255),
      (i[2] = ((n >>> 8) & 255) / 255),
      (i[3] = (n & 255) / 255));
  },
  W$ = u => {
    const n = u.validatedValue || u.value;
    if (u.programValue instanceof Float32Array) {
      const i = u.programValue;
      ((i[0] = n[0]), (i[1] = n[1]));
    } else u.programValue = new Float32Array(n);
  },
  z$ = u => {
    const n = u.validatedValue || u.value;
    if (u.programValue instanceof Float32Array) {
      const i = u.programValue;
      ((i[0] = n[0]), (i[1] = n[1]), (i[2] = n[2]), (i[3] = n[3]));
    } else u.programValue = new Float32Array(n);
  },
  fD = u => {
    const n = u.validatedValue || u.value;
    if (u.programValue instanceof Float32Array) {
      const i = n.length,
        o = u.programValue;
      for (let l = 0; l < i; l++) o[l] = n[l];
    } else u.programValue = new Float32Array(n);
  },
  HT = u => {
    const n = Array.isArray(u);
    if (n) {
      if (n && u.length === 4) return u;
      if (n && u.length === 2) return [u[0], u[1], u[0], u[1]];
      if (n && u.length === 3) return [u[0], u[1], u[2], u[0]];
    } else return [u, u, u, u];
    return [u[0], u[0], u[0], u[0]];
  },
  pD = (u, n) => {
    u.programValue === void 0 && (u.programValue = new Float32Array(4));
    const i = u.programValue,
      o = u.validatedValue || u.value;
    if (n === void 0 && u.$dimensions === void 0) {
      ((i[0] = o[0]), (i[1] = o[1]), (i[2] = o[2]), (i[3] = o[3]));
      return;
    }
    let l = u.$dimensions;
    if (n !== void 0) {
      const { $dimensions: w } = n;
      if (l !== void 0 && (l.width === w.width || l.height === w.height)) return;
      l === void 0 &&
        ((l = { width: w == null ? void 0 : w.width, height: w == null ? void 0 : w.height }),
        (u.$dimensions = l));
    }
    const { width: h, height: p } = l,
      [d, y, v, T] = o,
      S = Math.min(
        Math.min(
          Math.min(h / Math.max(h, d + y), h / Math.max(h, v + T)),
          Math.min(p / Math.max(p, d + v), p / Math.max(p, y + T)),
        ),
        1,
      );
    ((i[0] = d * S), (i[1] = y * S), (i[2] = v * S), (i[3] = T * S));
  };
class jl extends oi {
  constructor() {
    super(...arguments);
    j(this, "name", "radius");
  }
  static getEffectKey() {
    return "radius";
  }
  static resolveDefaults(i) {
    var o;
    return { radius: (o = i.radius) != null ? o : 10 };
  }
}
(j(jl, "z$__type__Props"),
  j(jl, "uniforms", {
    radius: {
      value: 0,
      method: "uniform4fv",
      type: "vec4",
      updateOnBind: !0,
      validator: HT,
      updateProgramValue: pD,
    },
  }),
  j(jl, "methods", {
    fillMask: "\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",
    boxDist:
      "\n      float function(vec2 p, vec2 size, float radius) {\n        size -= vec2(radius);\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;\n      }\n    ",
  }),
  j(
    jl,
    "onShaderMask",
    "\n  vec2 halfDimensions = u_dimensions * 0.5;\n  float r = radius[0] * step(v_nodeCoordinate.x, 0.5) * step(v_nodeCoordinate.y, 0.5);\n  r = r + radius[1] * step(0.5, v_nodeCoordinate.x) * step(v_nodeCoordinate.y, 0.5);\n  r = r + radius[2] * step(0.5, v_nodeCoordinate.x) * step(0.5, v_nodeCoordinate.y);\n  r = r + radius[3] * step(v_nodeCoordinate.x, 0.5) * step(0.5, v_nodeCoordinate.y);\n  return $boxDist(v_nodeCoordinate.xy * u_dimensions - halfDimensions, halfDimensions, r);\n  ",
  ),
  j(jl, "onEffectMask", "\n  return mix(vec4(0.0), maskColor, $fillMask(shaderMask));\n  "));
class Jc extends oi {
  constructor() {
    super(...arguments);
    j(this, "name", "border");
  }
  static getEffectKey() {
    return "border";
  }
  static resolveDefaults(i) {
    var o, l;
    return { width: (o = i.width) != null ? o : 10, color: (l = i.color) != null ? l : 4294967295 };
  }
}
(j(Jc, "z$__type__Props"),
  j(Jc, "uniforms", {
    width: { value: 0, method: "uniform1f", type: "float" },
    color: { value: 4294967295, updateProgramValue: du, method: "uniform4fv", type: "vec4" },
  }),
  j(
    Jc,
    "onEffectMask",
    "\n  float intR = shaderMask + 1.0;\n  float mask = clamp(intR + width, 0.0, 1.0) - clamp(intR, 0.0, 1.0);\n  return mix(shaderColor, mix(shaderColor, maskColor, maskColor.a), mask);\n  ",
  ),
  j(Jc, "onColorize", "\n    return color;\n  "));
class Vl extends oi {
  constructor() {
    super(...arguments);
    j(this, "name", "linearGradient");
  }
  static getEffectKey(i) {
    return i.colors.value
      ? "linearGradient".concat(i.colors.value.length)
      : "linearGradient".concat(i.colors.length);
  }
  static resolveDefaults(i) {
    var h, p;
    const o = (h = i.colors) != null ? h : [4278190080, 4294967295];
    let l = i.stops || [];
    if (l.length === 0 || l.length !== o.length) {
      const d = o.length;
      let y = 0;
      const v = l;
      for (; y < d; y++)
        l[y]
          ? ((v[y] = l[y]),
            l[y - 1] === void 0 && v[y - 2] !== void 0 && (v[y - 1] = v[y - 2] + (l[y] - v[y - 2]) / 2))
          : (v[y] = y * (1 / (o.length - 1)));
      l = v;
    }
    return { colors: o, stops: l, angle: (p = i.angle) != null ? p : 0 };
  }
}
(j(Vl, "z$__type__Props"),
  j(Vl, "uniforms", {
    angle: { value: 0, method: "uniform1f", type: "float" },
    colors: {
      value: 4294967295,
      validator: i => i.reduce((o, l) => o.concat(Xg(l)), []),
      updateProgramValue: fD,
      size: i => i.colors.length,
      method: "uniform4fv",
      type: "vec4",
    },
    stops: { value: [], size: i => i.colors.length, method: "uniform1fv", type: "float" },
  }),
  j(Vl, "methods", {
    calcPoint:
      "\n      vec2 function(float d, float angle) {\n        return d * vec2(cos(angle), sin(angle)) + (u_dimensions * 0.5);\n      }\n    ",
  }),
  j(Vl, "ColorLoop", i => {
    let o = "";
    for (let l = 2; l < i; l++)
      o += "colorOut = mix(colorOut, colors["
        .concat(l, "], clamp((dist - stops[")
        .concat(l - 1, "]) / (stops[")
        .concat(l, "] - stops[")
        .concat(l - 1, "]), 0.0, 1.0));");
    return o;
  }),
  j(Vl, "onColorize", i => {
    const o = i.colors.length || 1;
    return "\n      float a = angle - (PI / 180.0 * 90.0);\n      float lineDist = abs(u_dimensions.x * cos(a)) + abs(u_dimensions.y * sin(a));\n      vec2 f = $calcPoint(lineDist * 0.5, a);\n      vec2 t = $calcPoint(lineDist * 0.5, a + PI);\n      vec2 gradVec = t - f;\n      float dist = dot(v_nodeCoordinate.xy * u_dimensions - f, gradVec) / dot(gradVec, gradVec);\n\n      //return early if dist is lower or equal to first stop\n      if(dist <= stops[0]) {\n        return mix(maskColor, colors[0], clamp(colors[0].a, 0.0, 1.0));\n      }\n      const int amount = ".concat(
      o,
      ";\n      const int last = amount - 1;\n\n      if(dist >= stops[last]) {\n        return mix(maskColor, colors[last], clamp(colors[last].a, 0.0, 1.0));\n      }\n\n      for(int i = 0; i < last; i++) {\n        float left = stops[i];\n        float right = stops[i + 1];\n        if(dist >= left && dist <= right) {\n          float localDist = smoothstep(left, right, dist);\n          vec4 colorOut = mix(colors[i], colors[i + 1], localDist);\n          return mix(maskColor, colorOut, clamp(colorOut.a, 0.0, 1.0));\n        }\n      }\n\n      //final fallback\n      return mix(maskColor, colors[last], clamp(colors[last].a, 0.0, 1.0));\n    ",
    );
  }));
class iT extends oi {
  constructor() {
    super(...arguments);
    j(this, "name", "grayscale");
  }
  static getEffectKey() {
    return "grayscale";
  }
  static resolveDefaults(i) {
    var o;
    return { amount: (o = i.amount) != null ? o : 1 };
  }
}
(j(iT, "uniforms", { amount: { value: 1, method: "uniform1f", type: "float" } }),
  j(
    iT,
    "onColorize",
    "\n    float grayness = 0.2 * maskColor.r + 0.6 * maskColor.g + 0.2 * maskColor.b;\n    return vec4(amount * vec3(grayness) + (1.0 - amount) * maskColor.rgb, maskColor.a);\n  ",
  ));
class Hl extends oi {
  constructor() {
    super(...arguments);
    j(this, "name", "borderRight");
  }
  static getEffectKey() {
    return "borderRight";
  }
  static resolveDefaults(i) {
    var o, l;
    return { width: (o = i.width) != null ? o : 10, color: (l = i.color) != null ? l : 4294967295 };
  }
}
(j(Hl, "z$__type__Props"),
  j(Hl, "uniforms", {
    width: { value: 0, method: "uniform1f", type: "float" },
    color: { value: 4294967295, updateProgramValue: du, method: "uniform4fv", type: "vec4" },
  }),
  j(Hl, "methods", {
    fillMask: "\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",
    rectDist:
      "\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    ",
  }),
  j(
    Hl,
    "onEffectMask",
    "\n  vec2 pos = vec2(u_dimensions.x - width * 0.5, 0.0);\n  float mask = $rectDist(v_nodeCoordinate.xy * u_dimensions - pos, vec2(width*0.5, u_dimensions.y));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  ",
  ),
  j(Hl, "onColorize", "\n    return color;\n  "));
class Kl extends oi {
  constructor() {
    super(...arguments);
    j(this, "name", "borderTop");
  }
  static getEffectKey() {
    return "borderTop";
  }
  static resolveDefaults(i) {
    var o, l;
    return { width: (o = i.width) != null ? o : 10, color: (l = i.color) != null ? l : 4294967295 };
  }
}
(j(Kl, "z$__type__Props"),
  j(Kl, "uniforms", {
    width: { value: 0, method: "uniform1f", type: "float" },
    color: { value: 4294967295, updateProgramValue: du, method: "uniform4fv", type: "vec4" },
  }),
  j(Kl, "methods", {
    fillMask: "\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",
    rectDist:
      "\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    ",
  }),
  j(
    Kl,
    "onEffectMask",
    "\n  vec2 pos = vec2(0.0, width * 0.5);\n  float mask = $rectDist(v_nodeCoordinate.xy * u_dimensions - pos, vec2(u_dimensions.x, width*0.5));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  ",
  ),
  j(Kl, "onColorize", "\n    return color;\n  "));
class Wl extends oi {
  constructor() {
    super(...arguments);
    j(this, "name", "borderBottom");
  }
  static getEffectKey() {
    return "borderBottom";
  }
  static resolveDefaults(i) {
    var o, l;
    return { width: (o = i.width) != null ? o : 10, color: (l = i.color) != null ? l : 4294967295 };
  }
}
(j(Wl, "z$__type__Props"),
  j(Wl, "uniforms", {
    width: { value: 0, method: "uniform1f", type: "float" },
    color: { value: 4294967295, updateProgramValue: du, method: "uniform4fv", type: "vec4" },
  }),
  j(Wl, "methods", {
    fillMask: "\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",
    rectDist:
      "\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    ",
  }),
  j(
    Wl,
    "onEffectMask",
    "\n  vec2 pos = vec2(0.0, u_dimensions.y - width * 0.5);\n  float mask = $rectDist(v_nodeCoordinate.xy * u_dimensions - pos, vec2(u_dimensions.x, width*0.5));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  ",
  ),
  j(Wl, "onColorize", "\n    return color;\n  "));
class zl extends oi {
  constructor() {
    super(...arguments);
    j(this, "name", "borderLeft");
  }
  static getEffectKey() {
    return "borderLeft";
  }
  static resolveDefaults(i) {
    var o, l;
    return { width: (o = i.width) != null ? o : 10, color: (l = i.color) != null ? l : 4294967295 };
  }
}
(j(zl, "z$__type__Props"),
  j(zl, "uniforms", {
    width: { value: 0, method: "uniform1f", type: "float" },
    color: { value: 4294967295, updateProgramValue: du, method: "uniform4fv", type: "vec4" },
  }),
  j(zl, "methods", {
    fillMask: "\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",
    rectDist:
      "\n      float function(vec2 p, vec2 size) {\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n      }\n    ",
  }),
  j(
    zl,
    "onEffectMask",
    "\n  vec2 pos = vec2(width * 0.5, 0.0);\n  float mask = $rectDist(v_nodeCoordinate.xy * u_dimensions - pos, vec2(width*0.5, u_dimensions.y));\n  return mix(shaderColor, maskColor, $fillMask(mask));\n  ",
  ),
  j(zl, "onColorize", "\n    return color;\n  "));
class Zc extends oi {
  constructor() {
    super(...arguments);
    j(this, "name", "glitch");
  }
  static getEffectKey(i) {
    return "glitch";
  }
  static resolveDefaults(i) {
    var o, l, h, p, d;
    return {
      amplitude: (o = i.amplitude) != null ? o : 0.2,
      narrowness: (l = i.narrowness) != null ? l : 4,
      blockiness: (h = i.blockiness) != null ? h : 2,
      minimizer: (p = i.minimizer) != null ? p : 8,
      time: (d = i.time) != null ? d : Date.now(),
    };
  }
}
(j(Zc, "z$__type__Props"),
  j(Zc, "uniforms", {
    amplitude: { value: 0, method: "uniform1f", type: "float" },
    narrowness: { value: 0, method: "uniform1f", type: "float" },
    blockiness: { value: 0, method: "uniform1f", type: "float" },
    minimizer: { value: 0, method: "uniform1f", type: "float" },
    time: {
      value: 0,
      method: "uniform1f",
      updateOnBind: !0,
      updateProgramValue: i => {
        const o = (i.value = (Date.now() - i.value) % 1e3);
        i.programValue = o;
      },
      type: "float",
    },
  }),
  j(Zc, "methods", {
    rand: "\n      float function(vec2 p, float time) {\n        float t = floor(time * 20.) / 10.;\n        return fract(sin(dot(p, vec2(t * 12.9898, t * 78.233))) * 43758.5453);\n      }\n    ",
    noise:
      "\n      float function(vec2 uv, float blockiness, float time) {\n        vec2 lv = fract(uv);\n        vec2 id = floor(uv);\n\n        float n1 = rand(id, time);\n        float n2 = rand(id+vec2(1,0), time);\n        float n3 = rand(id+vec2(0,1), time);\n        float n4 = rand(id+vec2(1,1), time);\n        vec2 u = smoothstep(0.0, 1.0 + blockiness, lv);\n        return mix(mix(n1, n2, u.x), mix(n3, n4, u.x), u.y);\n      }\n    ",
    fbm: "\n      float function(vec2 uv, int count, float blockiness, float complexity, float time) {\n        float val = 0.0;\n        float amp = 0.5;\n        const int MAX_ITERATIONS = 10;\n\n        for(int i = 0; i < MAX_ITERATIONS; i++) {\n          if(i >= count) {break;}\n          val += amp * noise(uv, blockiness, time);\n          amp *= 0.5;\n          uv *= complexity;\n        }\n        return val;\n      }\n    ",
  }),
  j(
    Zc,
    "onColorize",
    "\n    vec2 uv = v_textureCoordinate.xy;\n    float aspect = u_dimensions.x / u_dimensions.y;\n    vec2 a = vec2(uv.x * aspect , uv.y);\n    vec2 uv2 = vec2(a.x / u_dimensions.x, exp(a.y));\n\n    float shift = amplitude * pow($fbm(uv2, 4, blockiness, narrowness, time), minimizer);\n    float colR = texture2D(u_texture, vec2(uv.x + shift, uv.y)).r * (1. - shift);\n    float colG = texture2D(u_texture, vec2(uv.x - shift, uv.y)).g * (1. - shift);\n    float colB = texture2D(u_texture, vec2(uv.x - shift, uv.y)).b * (1. - shift);\n\n    vec3 f = vec3(colR, colG, colB);\n    return vec4(f, texture2D(u_texture, vec2(uv.x - shift, uv.y)).a);\n  ",
  ));
class lg extends oi {
  constructor() {
    super(...arguments);
    j(this, "name", "fadeOut");
  }
  static getEffectKey() {
    return "fadeOut";
  }
  static resolveDefaults(i) {
    var o;
    return { fade: (o = i.fade) != null ? o : 10 };
  }
}
(j(lg, "z$__type__Props"),
  j(lg, "uniforms", {
    fade: { value: 0, method: "uniform4fv", type: "vec4", validator: HT, updateProgramValue: z$ },
  }),
  j(
    lg,
    "onColorize",
    "\n  vec2 point = v_nodeCoordinate.xy * u_dimensions.xy;\n  vec2 pos1;\n  vec2 pos2;\n  vec2 d;\n  float c;\n  vec4 result = maskColor;\n\n\n  if(fade[0] > 0.0) {\n    pos1 = vec2(point.x, point.y);\n    pos2 = vec2(point.x, point.y + fade[0]);\n    d = pos2 - pos1;\n    c = dot(pos1, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  if(fade[1] > 0.0) {\n    pos1 = vec2(point.x - u_dimensions.x - fade[1], v_nodeCoordinate.y);\n    pos2 = vec2(point.x - u_dimensions.x, v_nodeCoordinate.y);\n    d = pos1 - pos2;\n    c = dot(pos2, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  if(fade[2] > 0.0) {\n    pos1 = vec2(v_nodeCoordinate.x, point.y - u_dimensions.y - fade[2]);\n    pos2 = vec2(v_nodeCoordinate.x, point.y - u_dimensions.y);\n    d = pos1 - pos2;\n    c = dot(pos2, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  if(fade[3] > 0.0) {\n    pos1 = vec2(point.x, point.y);\n    pos2 = vec2(point.x + fade[3], point.y);\n    d = pos2 - pos1;\n    c = dot(pos1, d) / dot(d, d);\n    result = mix(vec4(0.0), result, smoothstep(0.0, 1.0, clamp(c, 0.0, 1.0)));\n  }\n\n  return result;\n  ",
  ));
class Yl extends oi {
  constructor() {
    super(...arguments);
    j(this, "name", "radialGradient");
  }
  static getEffectKey(i) {
    return i.colors.value
      ? "radialGradient".concat(i.colors.value.length)
      : "radialGradient".concat(i.colors.length);
  }
  static resolveDefaults(i) {
    var h, p, d, y, v;
    const o = (h = i.colors) != null ? h : [4278190080, 4294967295];
    let l = i.stops || [];
    if (l.length === 0 || l.length !== o.length) {
      const T = o.length;
      let S = 0;
      const w = l;
      for (; S < T; S++)
        l[S]
          ? ((w[S] = l[S]),
            l[S - 1] === void 0 && w[S - 2] !== void 0 && (w[S - 1] = w[S - 2] + (l[S] - w[S - 2]) / 2))
          : (w[S] = S * (1 / (o.length - 1)));
      l = w;
    }
    return {
      colors: o,
      stops: l,
      width: (p = i.width) != null ? p : 0,
      height: (y = (d = i.height) != null ? d : i.width) != null ? y : 0,
      pivot: (v = i.pivot) != null ? v : [0.5, 0.5],
    };
  }
}
(j(Yl, "z$__type__Props"),
  j(Yl, "uniforms", {
    width: { value: 0, method: "uniform1f", type: "float" },
    height: { value: 0, method: "uniform1f", type: "float" },
    pivot: { value: [0.5, 0.5], updateProgramValue: W$, method: "uniform2fv", type: "vec2" },
    colors: {
      value: 4294967295,
      validator: i => i.reduce((o, l) => o.concat(Xg(l)), []),
      updateProgramValue: fD,
      size: i => i.colors.length,
      method: "uniform4fv",
      type: "vec4",
    },
    stops: { value: [], size: i => i.colors.length, method: "uniform1fv", type: "float" },
  }),
  j(Yl, "methods", {
    getGradientColor:
      "\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",
  }),
  j(Yl, "ColorLoop", i => {
    let o = "";
    for (let l = 2; l < i; l++)
      o += "colorOut = mix(colorOut, colors["
        .concat(l, "], clamp((dist - stops[")
        .concat(l - 1, "]) / (stops[")
        .concat(l, "] - stops[")
        .concat(l - 1, "]), 0.0, 1.0));");
    return o;
  }),
  j(Yl, "onColorize", i => {
    const o = i.colors.length || 1;
    return "\n      vec2 point = v_nodeCoordinate.xy * u_dimensions;\n      vec2 projection = vec2(pivot.x * u_dimensions.x, pivot.y * u_dimensions.y);\n\n      float dist = length((point - projection) / vec2(width, height));\n\n      dist = clamp(dist, 0.0, 1.0);\n      //return early if dist is lower or equal to first stop\n      if(dist <= stops[0]) {\n        return mix(maskColor, colors[0], clamp(colors[0].a, 0.0, 1.0));\n      }\n      const int amount = ".concat(
      o,
      ";\n      const int last = amount - 1;\n\n      if(dist >= stops[last]) {\n        return mix(maskColor, colors[last], clamp(colors[last].a, 0.0, 1.0));\n      }\n\n      for(int i = 0; i < last; i++) {\n        float left = stops[i];\n        float right = stops[i + 1];\n        if(dist >= left && dist <= right) {\n          float localDist = smoothstep(left, right, dist);\n          vec4 colorOut = mix(colors[i], colors[i + 1], localDist);\n          return mix(maskColor, colorOut, clamp(colorOut.a, 0.0, 1.0));\n        }\n      }\n\n      //final fallback\n      return mix(maskColor, colors[last], clamp(colors[last].a, 0.0, 1.0));\n    ",
    );
  }));
class Xl extends oi {
  constructor() {
    super(...arguments);
    j(this, "name", "radialProgress");
  }
  static getEffectKey() {
    return "radialProgress";
  }
  static resolveDefaults(i) {
    var o, l, h, p, d, y, v;
    return {
      width: (o = i.width) != null ? o : 10,
      progress: (l = i.progress) != null ? l : 0.5,
      offset: (h = i.offset) != null ? h : 0,
      range: (p = i.range) != null ? p : Math.PI * 2,
      rounded: (d = i.rounded) != null ? d : !1,
      radius: (y = i.radius) != null ? y : 1,
      color: (v = i.color) != null ? v : 4294967295,
    };
  }
}
(j(Xl, "z$__type__Props"),
  j(Xl, "uniforms", {
    width: { value: 0, method: "uniform1f", type: "float" },
    progress: { value: 0.5, method: "uniform1f", type: "float" },
    offset: { value: 0, method: "uniform1f", type: "float" },
    range: { value: 0, method: "uniform1f", type: "float" },
    rounded: { value: 0, method: "uniform1f", type: "float", validator: i => (i ? 1 : 0) },
    radius: { value: 1, method: "uniform1f", type: "float" },
    color: { value: 4294967295, updateProgramValue: du, method: "uniform4fv", type: "vec4" },
  }),
  j(Xl, "methods", {
    rotateUV:
      "\n    vec2 function(vec2 uv, float d) {\n      float s = sin(d);\n      float c = cos(d);\n      mat2 rotMatrix = mat2(c, -s, s, c);\n      return uv * rotMatrix;\n    }\n    ",
    drawDot:
      "\n    float function(vec2 uv, vec2 p, float r) {\n      uv += p;\n      float circle = length(uv) - r;\n      return clamp(-circle, 0.0, 1.0);\n    }\n    ",
  }),
  j(
    Xl,
    "onEffectMask",
    "\n    float outerRadius = radius * u_dimensions.y * 0.5;\n\n    float endAngle = range * progress - 0.0005;\n\n    vec2 uv = v_nodeCoordinate.xy * u_dimensions.xy - u_dimensions * 0.5;\n\n    uv = $rotateUV(uv, -(offset));\n    float linewidth = width * u_pixelRatio;\n    float circle = length(uv) - (outerRadius - linewidth) ;\n    circle = abs(circle) - linewidth;\n    circle = clamp(-circle, 0.0, 1.0);\n\n    float angle = (atan(uv.x, -uv.y) / 3.14159265359 * 0.5);\n    float p = endAngle / (PI * 2.);\n\n    circle *= step(fract(angle), fract(p));\n\n    circle = rounded < 1. ? circle : max(circle, $drawDot(uv, vec2(0, outerRadius - linewidth), linewidth));\n    circle = rounded < 1. ? circle : max(circle, $drawDot($rotateUV(uv, -(endAngle)), vec2(0, outerRadius - linewidth), linewidth));\n\n    return mix(shaderColor, maskColor, circle);\n  ",
  ),
  j(Xl, "onColorize", "\n    return color;\n  "));
class ql extends oi {
  constructor() {
    super(...arguments);
    j(this, "name", "holePunch");
  }
  static getEffectKey() {
    return "holePunch";
  }
  static resolveDefaults(i) {
    var o;
    return {
      x: i.x || 0,
      y: i.y || 0,
      width: i.width || 50,
      height: i.height || 50,
      radius: (o = i.radius) != null ? o : 0,
    };
  }
}
(j(ql, "z$__type__Props"),
  j(ql, "uniforms", {
    x: { value: 0, method: "uniform1f", type: "float" },
    y: { value: 0, method: "uniform1f", type: "float" },
    width: { value: 0, method: "uniform1f", type: "float" },
    height: { value: 0, method: "uniform1f", type: "float" },
    radius: {
      value: 0,
      method: "uniform4fv",
      type: "vec4",
      updateOnBind: !0,
      validator: HT,
      updateProgramValue: pD,
    },
  }),
  j(ql, "methods", {
    fillMask: "\n      float function(float dist) {\n        return clamp(-dist, 0.0, 1.0);\n      }\n    ",
    boxDist:
      "\n      float function(vec2 p, vec2 size, float radius) {\n        size -= vec2(radius);\n        vec2 d = abs(p) - size;\n        return min(max(d.x, d.y), 0.0) + length(max(d, 0.0)) - radius;\n      }\n    ",
  }),
  j(
    ql,
    "onShaderMask",
    "\n  vec2 halfDimensions = u_dimensions * 0.5;\n  vec2 size = vec2(width, height) * 0.5;\n  vec2 basePos = v_nodeCoordinate.xy * u_dimensions.xy - vec2(x, y);\n  vec2 pos = basePos - size;\n  float r = radius[0] * step(pos.x, 0.5) * step(pos.y, 0.5);\n  r = r + radius[1] * step(0.5, pos.x) * step(pos.y, 0.5);\n  r = r + radius[2] * step(0.5, pos.x) * step(0.5, pos.y);\n  r = r + radius[3] * step(pos.x, 0.5) * step(0.5, pos.y);\n  return $boxDist(pos, size, r);\n  ",
  ),
  j(ql, "onEffectMask", "\n  return mix(maskColor, vec4(0.0), $fillMask(shaderMask));\n  "));
class Y$ extends cD {
  constructor(i) {
    super();
    j(this, "shType");
    this.shType = i;
  }
  bindRenderOp() {}
  bindProps() {}
  attach() {}
  detach() {}
}
class X$ {
  constructor(n, i, o, l) {
    j(this, "type");
    j(this, "shader");
    j(this, "resolvedProps");
    j(this, "props");
    ((this.type = n), (this.shader = i), (this.resolvedProps = o));
    const h = Object.keys(o),
      p = h.length,
      d = {};
    for (let y = 0; y < p; y++) {
      const v = h[y];
      Object.defineProperty(d, v, {
        get: () => this.resolvedProps[v],
        set: T => {
          ((this.resolvedProps[v] = T), l.requestRender());
        },
      });
    }
    this.props = d;
  }
  getResolvedProps() {
    return this.resolvedProps;
  }
}
class q$ {
  constructor(n, i, o) {
    j(this, "shader");
    j(this, "resolvedProps");
    j(this, "props");
    j(this, "type");
    ((this.shader = n), (this.type = "DynamicShader"), (this.resolvedProps = i));
    const l = o.getRegisteredEffects(),
      h = {},
      p = i.effects,
      d = p.length;
    for (let y = 0; y < d; y++) {
      const { name: v, props: T, type: S } = p[y];
      if (v === void 0) continue;
      const w = {},
        C = Object.keys(T),
        L = C.length;
      for (let k = 0; k < L; k++) {
        const O = C[k];
        Object.defineProperty(w, O, {
          get: () => this.resolvedProps.effects[y].props[O].value,
          set: B => {
            var $, I;
            const N = this.resolvedProps.effects[y].props[O];
            ((N.value = B),
              N.hasValidator &&
                (B = N.validatedValue = ($ = l[S].uniforms[O]) == null ? void 0 : $.validator(B, T)),
              N.hasProgramValueUpdater
                ? (I = l[S].uniforms[O]) == null || I.updateProgramValue(N)
                : (N.programValue = B),
              o.renderer.stage.requestRender());
          },
        });
      }
      Object.defineProperty(h, v, { get: () => w });
    }
    this.props = h;
  }
  getResolvedProps() {
    return this.resolvedProps;
  }
}
class Q$ {
  constructor() {
    j(this, "shCache", new Map());
    j(this, "shConstructors", {});
    j(this, "attachedShader", null);
    j(this, "effectConstructors", {});
    j(this, "renderer");
    (this.registerShaderType("DefaultShader", dD),
      this.registerShaderType("DefaultShaderBatched", hD),
      this.registerShaderType("RoundedRectangle", tT),
      this.registerShaderType("DynamicShader", eu),
      this.registerShaderType("SdfShader", nT),
      this.registerEffectType("border", Jc),
      this.registerEffectType("borderBottom", Wl),
      this.registerEffectType("borderLeft", zl),
      this.registerEffectType("borderRight", Hl),
      this.registerEffectType("borderTop", Kl),
      this.registerEffectType("fadeOut", lg),
      this.registerEffectType("linearGradient", Vl),
      this.registerEffectType("radialGradient", Yl),
      this.registerEffectType("grayscale", iT),
      this.registerEffectType("glitch", Zc),
      this.registerEffectType("radius", jl),
      this.registerEffectType("radialProgress", Xl),
      this.registerEffectType("holePunch", ql));
  }
  registerShaderType(n, i) {
    this.shConstructors[n] = i;
  }
  registerEffectType(n, i) {
    this.effectConstructors[n] = i;
  }
  getRegisteredEffects() {
    return this.effectConstructors;
  }
  getRegisteredShaders() {
    return this.shConstructors;
  }
  loadShader(n, i) {
    if (!this.renderer) throw new Error("Renderer is not been defined");
    const o = this.shConstructors[n];
    if (!o) throw new Error('Shader type "'.concat(n, '" is not registered'));
    if (this.renderer.mode === "canvas" && o.prototype instanceof Ia)
      return this._createShaderCtr(n, new Y$(n), i);
    if (n === "DynamicShader") return this.loadDynamicShader(i);
    const l = o.resolveDefaults(i),
      h = o.makeCacheKey(l) || o.name;
    if (h && this.shCache.has(h)) return this._createShaderCtr(n, this.shCache.get(h), l);
    const p = new o(this.renderer, i);
    return (h && this.shCache.set(h, p), this._createShaderCtr(n, p, l));
  }
  loadDynamicShader(n) {
    if (!this.renderer) throw new Error("Renderer is not been defined");
    const i = eu.resolveDefaults(n, this.effectConstructors),
      o = eu.makeCacheKey(i, this.effectConstructors);
    if (o && this.shCache.has(o)) return this._createDynShaderCtr(this.shCache.get(o), i);
    const l = new eu(this.renderer, n, this.effectConstructors);
    return (o && this.shCache.set(o, l), this._createDynShaderCtr(l, i));
  }
  _createShaderCtr(n, i, o) {
    return new X$(n, i, o, this.renderer.stage);
  }
  _createDynShaderCtr(n, i) {
    return (n.bindUniformMethods(i), new q$(n, i, this));
  }
  useShader(n) {
    this.attachedShader !== n &&
      (this.attachedShader && this.attachedShader.detach(), n.attach(), (this.attachedShader = n));
  }
}
const J$ = {
  x: (u, n) => {
    u.props.x = n;
  },
  y: (u, n) => {
    u.props.y = n;
  },
  width: (u, n) => {
    u.props.width = n;
  },
  height: (u, n) => {
    u.props.height = n;
  },
  color: (u, n) => {
    u.props.color = n;
  },
  zIndex: (u, n) => {
    u.props.zIndex = n;
  },
  fontFamily: (u, n) => {
    u.props.fontFamily = n;
  },
  fontWeight: (u, n) => {
    u.props.fontWeight = n;
  },
  fontStyle: (u, n) => {
    u.props.fontStyle = n;
  },
  fontStretch: (u, n) => {
    u.props.fontStretch = n;
  },
  fontSize: (u, n) => {
    u.props.fontSize = n;
  },
  text: (u, n) => {
    u.props.text = n;
  },
  textAlign: (u, n) => {
    u.props.textAlign = n;
  },
  contain: (u, n) => {
    u.props.contain = n;
  },
  offsetY: (u, n) => {
    u.props.offsetY = n;
  },
  scrollable: (u, n) => {
    u.props.scrollable = n;
  },
  scrollY: (u, n) => {
    u.props.scrollY = n;
  },
  letterSpacing: (u, n) => {
    u.props.letterSpacing = n;
  },
  lineHeight: (u, n) => {
    u.props.lineHeight = n;
  },
  maxLines: (u, n) => {
    u.props.maxLines = n;
  },
  textBaseline: (u, n) => {
    u.props.textBaseline = n;
  },
  verticalAlign: (u, n) => {
    u.props.verticalAlign = n;
  },
  overflowSuffix: (u, n) => {
    u.props.overflowSuffix = n;
  },
  debug: (u, n) => {
    u.props.debug = n;
  },
};
class gD {
  constructor(n) {
    j(this, "stage");
    j(this, "set");
    this.stage = n;
    const i = { ...J$, ...this.getPropertySetters() },
      o = {};
    (Object.keys(i).forEach(l => {
      Object.defineProperty(o, l, {
        value: (h, p) => {
          h.props[l] !== p && (i[l](h, p), this.stage.requestRender());
        },
        writable: !1,
        configurable: !1,
      });
    }),
      (this.set = o));
  }
  setStatus(n, i, o) {
    n.status !== i && ((n.status = i), n.emitter.emit(i, o));
  }
  setIsRenderable(n, i) {
    n.isRenderable = i;
  }
  destroyState(n) {
    (this.setStatus(n, "destroyed"), n.emitter.removeAllListeners());
  }
  scheduleUpdateState(n) {
    n.updateScheduled ||
      ((n.updateScheduled = !0),
      queueMicrotask(() => {
        n.status !== "destroyed" && ((n.updateScheduled = !1), this.updateState(n));
      }));
  }
}
class Z$ {
  constructor() {
    j(this, "data", {});
  }
  reset() {
    this.data = {};
  }
  increment(n) {
    (this.data[n] || (this.data[n] = 0), this.data[n]++);
  }
  getData() {
    return { ...this.data };
  }
}
class e5 {
  constructor(n, i) {
    j(this, "stage");
    j(this, "memUsed", 0);
    j(this, "loadedTextures", []);
    j(this, "criticalThreshold");
    j(this, "targetThreshold");
    j(this, "cleanupInterval");
    j(this, "debugLogging");
    j(this, "lastCleanupTime", 0);
    j(this, "baselineMemoryAllocation");
    j(this, "hasWarnedAboveCritical", !1);
    j(this, "criticalCleanupRequested", !1);
    j(this, "doNotExceedCriticalThreshold");
    j(this, "frameTime", 0);
    this.stage = n;
    const { criticalThreshold: o, doNotExceedCriticalThreshold: l } = i;
    ((this.doNotExceedCriticalThreshold = l || !1), (this.criticalThreshold = Math.round(o)));
    const h = Math.max(0, Math.min(1, i.targetThresholdLevel));
    if (
      ((this.cleanupInterval = i.cleanupInterval),
      (this.debugLogging = i.debugLogging),
      (this.baselineMemoryAllocation = Math.round(i.baselineMemoryAllocation)),
      (this.targetThreshold = Math.max(Math.round(o * h), this.baselineMemoryAllocation)),
      (this.memUsed = Math.round(i.baselineMemoryAllocation)),
      i.debugLogging)
    ) {
      let p = 0;
      setInterval(() => {
        p !== this.memUsed &&
          ((p = this.memUsed),
          console.log(
            "[TextureMemoryManager] Memory used: "
              .concat(ML(this.memUsed), " mb / ")
              .concat(ML(this.criticalThreshold), " mb (")
              .concat(((this.memUsed / this.criticalThreshold) * 100).toFixed(1), "%)"),
          ));
      }, 1e3);
    }
    o === 0 && (this.setTextureMemUse = () => {});
  }
  setTextureMemUse(n, i) {
    if (((this.memUsed -= n.memUsed), i === 0)) {
      const o = this.loadedTextures.indexOf(n);
      (o !== -1 && (this.loadedTextures[o] = null), (n.memUsed = 0));
      return;
    } else if (((n.memUsed = i), (this.memUsed += i), this.loadedTextures.indexOf(n) === -1)) {
      const o = this.loadedTextures.indexOf(null);
      o !== -1 ? (this.loadedTextures[o] = n) : this.loadedTextures.push(n);
    }
    this.memUsed > this.criticalThreshold && (this.criticalCleanupRequested = !0);
  }
  checkCleanup() {
    return (
      this.criticalCleanupRequested ||
      (this.memUsed > this.targetThreshold && this.frameTime - this.lastCleanupTime >= this.cleanupInterval)
    );
  }
  checkCriticalCleanup() {
    return this.memUsed > this.criticalThreshold;
  }
  destroyTexture(n) {
    this.debugLogging === !0 &&
      console.log("[TextureMemoryManager] Destroying texture. State: ".concat(n.state));
    const i = this.loadedTextures.indexOf(n);
    (i !== -1 && (this.loadedTextures[i] = null),
      this.stage.txManager.removeTextureFromCache(n),
      n.destroy(),
      (this.memUsed -= n.memUsed),
      (n.memUsed = 0));
  }
  cleanup() {
    const n = this.criticalCleanupRequested;
    ((this.lastCleanupTime = this.frameTime),
      n === !0 &&
        this.stage.queueFrameEvent("criticalCleanup", {
          memUsed: this.memUsed,
          criticalThreshold: this.criticalThreshold,
        }),
      this.debugLogging === !0 &&
        console.log("[TextureMemoryManager] Cleaning up textures. Critical: ".concat(n, ".")));
    const i = n ? this.criticalThreshold : this.targetThreshold;
    let o = this.memUsed;
    for (let l = 0; l < this.loadedTextures.length && !(o < i); l++) {
      const h = this.loadedTextures[l];
      if (!h) continue;
      if (
        (h.type === _i.image || h.type === _i.noise || h.type === _i.renderToTexture) &&
        h.canBeCleanedUp() === !0
      ) {
        const d = h.memUsed;
        (this.destroyTexture(h), (o -= d));
      }
    }
    this.memUsed >= this.criticalThreshold
      ? (this.stage.queueFrameEvent("criticalCleanupFailed", {
          memUsed: this.memUsed,
          criticalThreshold: this.criticalThreshold,
        }),
        !this.hasWarnedAboveCritical &&
          (this.debugLogging === !0 || n$ === !1) &&
          (console.warn(
            "[TextureMemoryManager] Memory usage above critical threshold after cleanup: ".concat(
              this.memUsed,
            ),
          ),
          (this.hasWarnedAboveCritical = !0)))
      : ((this.criticalCleanupRequested = !1), (this.hasWarnedAboveCritical = !1));
  }
  getMemoryInfo() {
    let n = 0,
      i = this.baselineMemoryAllocation;
    for (const l of this.loadedTextures) l && l.renderable && ((n += 1), (i += l.memUsed));
    const o = this.loadedTextures.filter(l => l !== null).length;
    return {
      criticalThreshold: this.criticalThreshold,
      targetThreshold: this.targetThreshold,
      renderableMemUsed: i,
      memUsed: this.memUsed,
      renderableTexturesLoaded: n,
      loadedTextures: o,
      baselineMemoryAllocation: this.baselineMemoryAllocation,
    };
  }
}
class t5 {
  constructor(n, i) {
    j(this, "textureSource");
    j(this, "memManager");
    j(this, "state", "freed");
    ((this.memManager = n), (this.textureSource = i));
  }
  setTextureMemUse(n) {
    this.memManager.setTextureMemUse(this.textureSource, n);
  }
  get renderable() {
    return this.textureSource.renderable;
  }
}
class n5 {
  constructor(n) {
    j(this, "options");
    j(this, "mode");
    j(this, "stage");
    j(this, "txManager");
    j(this, "txMemManager");
    j(this, "shManager");
    j(this, "rttNodes", []);
    ((this.options = n),
      (this.stage = n.stage),
      (this.txManager = n.txManager),
      (this.txMemManager = n.txMemManager),
      (this.shManager = n.shManager));
  }
}
class i5 extends Zx {
  constructor(i, o, l) {
    super(i, o);
    j(this, "textRenderer");
    j(this, "trState");
    j(this, "_textRendererOverride", null);
    j(this, "onTextLoaded", () => {
      const { contain: i } = this,
        o = this.trState.props.width,
        l = this.trState.props.height,
        h = this.trState.textW || 0,
        p = this.trState.textH || 0;
      (i === "both"
        ? ((this.props.width = o), (this.props.height = l))
        : i === "width"
          ? ((this.props.width = o), (this.props.height = p))
          : i === "none" && ((this.props.width = h), (this.props.height = p)),
        this.updateLocalTransform(),
        this.stage.requestRender(),
        this.emit("loaded", {
          type: "text",
          dimensions: { width: this.trState.textW || 0, height: this.trState.textH || 0 },
        }));
    });
    j(this, "onTextFailed", (i, o) => {
      this.emit("failed", { type: "text", error: o });
    });
    ((this._textRendererOverride = o.textRendererOverride), (this.textRenderer = l));
    const h = this.createState({
      x: 0,
      y: 0,
      width: o.width,
      height: o.height,
      textAlign: o.textAlign,
      color: o.color,
      zIndex: o.zIndex,
      contain: o.contain,
      scrollable: o.scrollable,
      scrollY: o.scrollY,
      offsetY: o.offsetY,
      letterSpacing: o.letterSpacing,
      debug: o.debug,
      fontFamily: o.fontFamily,
      fontSize: o.fontSize,
      fontStretch: o.fontStretch,
      fontStyle: o.fontStyle,
      fontWeight: o.fontWeight,
      text: o.text,
      lineHeight: o.lineHeight,
      maxLines: o.maxLines,
      textBaseline: o.textBaseline,
      verticalAlign: o.verticalAlign,
      overflowSuffix: o.overflowSuffix,
    });
    this.trState = h;
  }
  get width() {
    return this.props.width;
  }
  set width(i) {
    ((this.props.width = i),
      this.textRenderer.set.width(this.trState, i),
      this.contain === "none" && this.setUpdateType(Ie.Local));
  }
  get height() {
    return this.props.height;
  }
  set height(i) {
    ((this.props.height = i),
      this.textRenderer.set.height(this.trState, i),
      this.contain !== "both" && this.setUpdateType(Ie.Local));
  }
  get color() {
    return this.trState.props.color;
  }
  set color(i) {
    this.textRenderer.set.color(this.trState, i);
  }
  get text() {
    return this.trState.props.text;
  }
  set text(i) {
    this.textRenderer.set.text(this.trState, i);
  }
  get textRendererOverride() {
    return this._textRendererOverride;
  }
  set textRendererOverride(i) {
    ((this._textRendererOverride = i), this.textRenderer.destroyState(this.trState));
    const o = this.stage.resolveTextRenderer(this.trState.props, this._textRendererOverride);
    if (!o) {
      console.warn("Text Renderer not found for font", this.trState.props.fontFamily);
      return;
    }
    ((this.textRenderer = o), (this.trState = this.createState(this.trState.props)));
  }
  get fontSize() {
    return this.trState.props.fontSize;
  }
  set fontSize(i) {
    this.textRenderer.set.fontSize(this.trState, i);
  }
  get fontFamily() {
    return this.trState.props.fontFamily;
  }
  set fontFamily(i) {
    this.textRenderer.set.fontFamily(this.trState, i);
  }
  get fontStretch() {
    return this.trState.props.fontStretch;
  }
  set fontStretch(i) {
    this.textRenderer.set.fontStretch(this.trState, i);
  }
  get fontStyle() {
    return this.trState.props.fontStyle;
  }
  set fontStyle(i) {
    this.textRenderer.set.fontStyle(this.trState, i);
  }
  get fontWeight() {
    return this.trState.props.fontWeight;
  }
  set fontWeight(i) {
    this.textRenderer.set.fontWeight(this.trState, i);
  }
  get textAlign() {
    return this.trState.props.textAlign;
  }
  set textAlign(i) {
    this.textRenderer.set.textAlign(this.trState, i);
  }
  get contain() {
    return this.trState.props.contain;
  }
  set contain(i) {
    this.textRenderer.set.contain(this.trState, i);
  }
  get scrollable() {
    return this.trState.props.scrollable;
  }
  set scrollable(i) {
    this.textRenderer.set.scrollable(this.trState, i);
  }
  get scrollY() {
    return this.trState.props.scrollY;
  }
  set scrollY(i) {
    this.textRenderer.set.scrollY(this.trState, i);
  }
  get offsetY() {
    return this.trState.props.offsetY;
  }
  set offsetY(i) {
    this.textRenderer.set.offsetY(this.trState, i);
  }
  get letterSpacing() {
    return this.trState.props.letterSpacing;
  }
  set letterSpacing(i) {
    this.textRenderer.set.letterSpacing(this.trState, i);
  }
  get lineHeight() {
    return this.trState.props.lineHeight;
  }
  set lineHeight(i) {
    this.textRenderer.set.lineHeight(this.trState, i);
  }
  get maxLines() {
    return this.trState.props.maxLines;
  }
  set maxLines(i) {
    this.textRenderer.set.maxLines(this.trState, i);
  }
  get textBaseline() {
    return this.trState.props.textBaseline;
  }
  set textBaseline(i) {
    this.textRenderer.set.textBaseline(this.trState, i);
  }
  get verticalAlign() {
    return this.trState.props.verticalAlign;
  }
  set verticalAlign(i) {
    this.textRenderer.set.verticalAlign(this.trState, i);
  }
  get overflowSuffix() {
    return this.trState.props.overflowSuffix;
  }
  set overflowSuffix(i) {
    this.textRenderer.set.overflowSuffix(this.trState, i);
  }
  get debug() {
    return this.trState.props.debug;
  }
  set debug(i) {
    this.textRenderer.set.debug(this.trState, i);
  }
  update(i, o) {
    (super.update(i, o),
      this.globalTransform,
      this.textRenderer.set.x(this.trState, this.globalTransform.tx),
      this.textRenderer.set.y(this.trState, this.globalTransform.ty));
  }
  checkBasicRenderability() {
    return this.worldAlpha === 0 || this.isOutOfBounds() === !0
      ? !1
      : !!(this.trState && this.trState.props.text !== "");
  }
  setRenderable(i) {
    (super.setRenderable(i), this.textRenderer.setIsRenderable(this.trState, i));
  }
  renderQuads(i) {
    var o;
    if ((this.globalTransform, !this.textRenderer.renderQuads)) {
      super.renderQuads(i);
      return;
    }
    (this.parentHasRenderTexture &&
      (!i.renderToTextureActive || this.parentRenderTexture !== i.activeRttNode)) ||
      (this.parentHasRenderTexture &&
        (o = this.props.parent) != null &&
        o.rtt &&
        ((this.globalTransform = Zn.identity()),
        this.localTransform && this.globalTransform.multiply(this.localTransform)),
      this.globalTransform,
      this.textRenderer.renderQuads(
        this.trState,
        this.globalTransform,
        this.clippingRect,
        this.worldAlpha,
        this.parentHasRenderTexture,
        this.framebufferDimensions,
      ));
  }
  destroy() {
    (super.destroy(), this.textRenderer.destroyState(this.trState));
  }
  createState(i) {
    const o = this.textRenderer.createState(i, this);
    return (
      o.emitter.on("loaded", this.onTextLoaded),
      o.emitter.on("failed", this.onTextFailed),
      this.textRenderer.scheduleUpdateState(o),
      o
    );
  }
}
function r5(u) {
  const n = { boolean: !0, string: !0, number: !0, undefined: !0 },
    i = Object.keys(u);
  for (let o = 0; o < i.length; o++) {
    const l = i[o];
    if (!l) continue;
    const h = u[l],
      p = typeof h;
    (p === "string" &&
      h.length > 2048 &&
      (console.warn(
        "Custom Data value for ".concat(l, " is too long, it will be truncated to 2048 characters"),
      ),
      (u[l] = h.substring(0, 2048))),
      n[p] ||
        (console.warn(
          "Custom Data value for ".concat(l, " is not a boolean, string, or number, it will be ignored"),
        ),
        delete u[l]));
  }
  return u;
}
const s5 = 2e6;
class o5 {
  constructor(n) {
    j(this, "options");
    j(this, "animationManager");
    j(this, "txManager");
    j(this, "txMemManager");
    j(this, "fontManager");
    j(this, "textRenderers");
    j(this, "shManager");
    j(this, "renderer");
    j(this, "root");
    j(this, "interactiveNodes", new Set());
    j(this, "boundsMargin");
    j(this, "defShaderCtr");
    j(this, "strictBound");
    j(this, "preloadBound");
    j(this, "strictBounds");
    j(this, "defaultTexture", null);
    j(this, "targetFrameTime", 0);
    j(this, "eventBus");
    j(this, "deltaTime", 0);
    j(this, "lastFrameTime", 0);
    j(this, "currentFrameTime", 0);
    j(this, "fpsNumFrames", 0);
    j(this, "fpsElapsedTime", 0);
    j(this, "numQuadsRendered", 0);
    j(this, "renderRequested", !1);
    j(this, "frameEventQueue", []);
    j(this, "fontResolveMap", {});
    j(this, "contextSpy", null);
    this.options = n;
    const {
      canvas: i,
      clearColor: o,
      appWidth: l,
      appHeight: h,
      boundsMargin: p,
      enableContextSpy: d,
      forceWebGL2: y,
      numImageWorkers: v,
      textureMemory: T,
      renderEngine: S,
      fontEngines: w,
      createImageBitmapSupport: C,
      maxRetryCount: L,
    } = n;
    ((this.eventBus = n.eventBus),
      (this.targetFrameTime = n.targetFPS > 0 ? 1e3 / n.targetFPS : 0),
      (this.txManager = new B$(this, { numImageWorkers: v, createImageBitmapSupport: C, maxRetryCount: L })),
      this.txManager.on("initialized", () => {
        this.requestRender();
      }),
      (this.txMemManager = new e5(this, T)),
      (this.shManager = new Q$()),
      (this.animationManager = new x$()),
      (this.contextSpy = d ? new Z$() : null),
      (this.strictBounds = n.strictBounds));
    let k = [0, 0, 0, 0];
    (p && (k = Array.isArray(p) ? p : [p, p, p, p]),
      (this.boundsMargin = k),
      (this.strictBound = Jl(0, 0, l, h)),
      (this.preloadBound = Jx(this.strictBound, k)));
    const O = {
      stage: this,
      canvas: i,
      pixelRatio: n.devicePhysicalPixelRatio * n.deviceLogicalPixelRatio,
      clearColor: o != null ? o : 4278190080,
      bufferMemory: s5,
      txManager: this.txManager,
      txMemManager: this.txMemManager,
      shManager: this.shManager,
      contextSpy: this.contextSpy,
      forceWebGL2: y,
    };
    this.renderer = new S(O);
    const B = this.renderer.mode || "webgl";
    (this.createDefaultTexture(),
      (this.defShaderCtr = this.renderer.getDefShaderCtr()),
      t$(B),
      (this.txManager.renderer = this.renderer),
      (this.textRenderers = {}),
      w.forEach($ => {
        const I = new $(this),
          V = I.type;
        if (V === "sdf" && B === "canvas") {
          console.warn("SdfTextRenderer is not compatible with Canvas renderer. Skipping...");
          return;
        }
        I instanceof gD &&
          (V === "canvas" ? (this.textRenderers.canvas = I) : V === "sdf" && (this.textRenderers.sdf = I));
      }),
      Object.keys(this.textRenderers).length === 0 &&
        console.warn("No text renderers available. Your text will not render."),
      (this.fontManager = new j$(this.textRenderers)));
    const N = new Zx(this, {
      x: 0,
      y: 0,
      width: l,
      height: h,
      alpha: 1,
      autosize: !1,
      boundsMargin: null,
      clipping: !1,
      color: 0,
      colorTop: 0,
      colorBottom: 0,
      colorLeft: 0,
      colorRight: 0,
      colorTl: 0,
      colorTr: 0,
      colorBl: 0,
      colorBr: 0,
      zIndex: 0,
      zIndexLocked: 0,
      scaleX: 1,
      scaleY: 1,
      mountX: 0,
      mountY: 0,
      mount: 0,
      pivot: 0.5,
      pivotX: 0.5,
      pivotY: 0.5,
      rotation: 0,
      parent: null,
      texture: null,
      textureOptions: {},
      shader: this.defShaderCtr,
      rtt: !1,
      src: null,
      scale: 1,
      preventCleanup: !1,
      strictBounds: this.strictBounds,
    });
    ((this.root = N), v$(this));
  }
  setClearColor(n) {
    (this.renderer.updateClearColor(n), (this.renderRequested = !0));
  }
  updateTargetFrameTime() {
    this.targetFrameTime = this.options.targetFPS > 0 ? 1e3 / this.options.targetFPS : 0;
  }
  updateFrameTime() {
    const n = ag();
    ((this.lastFrameTime = this.currentFrameTime),
      (this.currentFrameTime = n),
      (this.deltaTime = this.lastFrameTime ? n - this.lastFrameTime : 100 / 6),
      (this.txManager.frameTime = n),
      (this.txMemManager.frameTime = n),
      this.eventBus.emit("frameTick", { time: this.currentFrameTime, delta: this.deltaTime }));
  }
  createDefaultTexture() {
    ((this.defaultTexture = this.txManager.createTexture("ColorTexture", { color: 4294967295 })),
      this.defaultTexture instanceof Eg,
      this.txManager.loadTexture(this.defaultTexture, !0),
      this.defaultTexture.setRenderableOwner("stage", !0),
      this.defaultTexture.once("loaded", () => {
        this.requestRender();
      }));
  }
  updateAnimations() {
    const { animationManager: n } = this;
    this.root && n.update(this.deltaTime);
  }
  hasSceneUpdates() {
    return !!this.root.updateType || this.renderRequested || this.txManager.hasUpdates();
  }
  drawFrame() {
    const { renderer: n, renderRequested: i } = this;
    (this.root.updateType !== 0 && this.root.update(this.deltaTime, this.root.clippingRect),
      this.txManager.processSome(this.options.textureProcessingTimeLimit).catch(o => {
        console.error("Error processing textures:", o);
      }),
      n.reset(),
      n.rttNodes.length > 0 && n.renderRTTNodes(),
      this.addQuads(this.root),
      n == null || n.render(),
      this.calculateFps(),
      this.calculateQuads(),
      i && (this.renderRequested = !1),
      this.txMemManager.criticalCleanupRequested === !0 && this.txMemManager.cleanup());
  }
  queueFrameEvent(n, i) {
    this.frameEventQueue.push([n, i]);
  }
  flushFrameEvents() {
    for (const [n, i] of this.frameEventQueue) this.eventBus.emit(n, i);
    this.frameEventQueue = [];
  }
  calculateFps() {
    var i, o, l;
    const { fpsUpdateInterval: n } = this.options;
    if (n && (this.fpsNumFrames++, (this.fpsElapsedTime += this.deltaTime), this.fpsElapsedTime >= n)) {
      const h = Math.round((this.fpsNumFrames * 1e3) / this.fpsElapsedTime);
      ((this.fpsNumFrames = 0),
        (this.fpsElapsedTime = 0),
        this.queueFrameEvent("fpsUpdate", {
          fps: h,
          contextSpyData: (o = (i = this.contextSpy) == null ? void 0 : i.getData()) != null ? o : null,
        }),
        (l = this.contextSpy) == null || l.reset());
    }
  }
  calculateQuads() {
    const n = this.renderer.getQuadCount();
    n &&
      n !== this.numQuadsRendered &&
      ((this.numQuadsRendered = n), this.queueFrameEvent("quadsUpdate", { quads: n }));
  }
  addQuads(n) {
    (this.renderer, n.isRenderable === !0 && n.renderQuads(this.renderer));
    for (let i = 0; i < n.children.length; i++) {
      const o = n.children[i];
      o !== void 0 &&
        (o.worldAlpha === 0 ||
          (o.strictBounds === !0 && o.renderState === si.OutOfBounds) ||
          this.addQuads(o));
    }
  }
  requestRender() {
    this.renderRequested = !0;
  }
  findNodesAtPoint(n) {
    const i = n.x / this.options.deviceLogicalPixelRatio,
      o = n.y / this.options.deviceLogicalPixelRatio,
      l = [];
    for (const h of this.interactiveNodes)
      h.isRenderable !== !1 && u$(i, o, h.renderBound) === !0 && l.push(h);
    return l;
  }
  getNodeFromPosition(n) {
    const i = this.findNodesAtPoint(n);
    if (i.length === 0) return null;
    let o = i[0];
    for (let l = 0; l < i.length; l++) i[l].zIndex > o.zIndex && (o = i[l]);
    return o || null;
  }
  resolveTextRenderer(n, i = null) {
    const o = ""
      .concat(n.fontFamily)
      .concat(n.fontStyle)
      .concat(n.fontWeight)
      .concat(n.fontStretch)
      .concat(i || "");
    if (this.fontResolveMap[o] !== void 0) return this.fontResolveMap[o];
    let l = i,
      h = !1;
    if (l) {
      const d = this.textRenderers[l];
      d
        ? d.canRenderFont(n) ||
          (console.warn("Cannot use override text renderer '".concat(l, "' for font"), n),
          (l = null),
          (h = !0))
        : (console.warn("Text renderer override '".concat(l, "' not found.")), (l = null), (h = !0));
    }
    if (!l) {
      for (const [d, y] of Object.entries(this.textRenderers))
        if (y.canRenderFont(n)) {
          l = d;
          break;
        }
      !l && this.textRenderers.canvas !== void 0 && (l = "canvas");
    }
    if ((h && console.warn("Falling back to text renderer ".concat(String(l))), !l)) return null;
    const p = this.textRenderers[l];
    return ((this.fontResolveMap[o] = p), p);
  }
  createShaderCtr(n, i) {
    return this.shManager.loadShader(n, i);
  }
  createNode(n) {
    const i = this.resolveNodeDefaults(n);
    return new Zx(this, i);
  }
  createTextNode(n) {
    var h, p, d, y, v, T, S, w, C, L, k, O, B, N, $, I, V, oe;
    const i = (h = n.fontSize) != null ? h : 16,
      o = {
        ...this.resolveNodeDefaults(n),
        text: (p = n.text) != null ? p : "",
        textRendererOverride: (d = n.textRendererOverride) != null ? d : null,
        fontSize: i,
        fontFamily: (y = n.fontFamily) != null ? y : "sans-serif",
        fontStyle: (v = n.fontStyle) != null ? v : "normal",
        fontWeight: (T = n.fontWeight) != null ? T : "normal",
        fontStretch: (S = n.fontStretch) != null ? S : "normal",
        textAlign: (w = n.textAlign) != null ? w : "left",
        contain: (C = n.contain) != null ? C : "none",
        scrollable: (L = n.scrollable) != null ? L : !1,
        scrollY: (k = n.scrollY) != null ? k : 0,
        offsetY: (O = n.offsetY) != null ? O : 0,
        letterSpacing: (B = n.letterSpacing) != null ? B : 0,
        lineHeight: n.lineHeight,
        maxLines: (N = n.maxLines) != null ? N : 0,
        textBaseline: ($ = n.textBaseline) != null ? $ : "alphabetic",
        verticalAlign: (I = n.verticalAlign) != null ? I : "middle",
        overflowSuffix: (V = n.overflowSuffix) != null ? V : "...",
        debug: (oe = n.debug) != null ? oe : {},
        shaderProps: null,
      },
      l = this.resolveTextRenderer(o, n.textRendererOverride);
    if (!l) throw new Error("No compatible text renderer found for ".concat(o.fontFamily));
    return new i5(this, o, l);
  }
  setBoundsMargin(n) {
    ((this.boundsMargin = Array.isArray(n) ? n : [n, n, n, n]), this.root.setUpdateType(Ie.RenderBounds));
  }
  resolveNodeDefaults(n) {
    var y,
      v,
      T,
      S,
      w,
      C,
      L,
      k,
      O,
      B,
      N,
      $,
      I,
      V,
      oe,
      Y,
      te,
      _,
      K,
      q,
      ce,
      he,
      ae,
      ye,
      ve,
      we,
      Le,
      ke,
      Ne,
      Re,
      Ce,
      W,
      Qe,
      ot,
      Je,
      Ut,
      St,
      Xt,
      vn,
      Rn,
      Ee,
      Di,
      ai,
      xi,
      Et,
      Bt,
      He,
      Cn,
      Vn,
      Wr,
      Or,
      Js,
      zr;
    const i = (y = n.color) != null ? y : 4294967295,
      o = (S = (T = (v = n.colorTl) != null ? v : n.colorTop) != null ? T : n.colorLeft) != null ? S : i,
      l = (L = (C = (w = n.colorTr) != null ? w : n.colorTop) != null ? C : n.colorRight) != null ? L : i,
      h = (B = (O = (k = n.colorBl) != null ? k : n.colorBottom) != null ? O : n.colorLeft) != null ? B : i,
      p = (I = ($ = (N = n.colorBr) != null ? N : n.colorBottom) != null ? $ : n.colorRight) != null ? I : i;
    let d = {};
    return (
      this.options.inspector === !0 && (d = r5((V = n.data) != null ? V : {})),
      {
        x: (oe = n.x) != null ? oe : 0,
        y: (Y = n.y) != null ? Y : 0,
        width: (te = n.width) != null ? te : 0,
        height: (_ = n.height) != null ? _ : 0,
        alpha: (K = n.alpha) != null ? K : 1,
        autosize: (q = n.autosize) != null ? q : !1,
        boundsMargin: (ce = n.boundsMargin) != null ? ce : null,
        clipping: (he = n.clipping) != null ? he : !1,
        color: i,
        colorTop: (ae = n.colorTop) != null ? ae : i,
        colorBottom: (ye = n.colorBottom) != null ? ye : i,
        colorLeft: (ve = n.colorLeft) != null ? ve : i,
        colorRight: (we = n.colorRight) != null ? we : i,
        colorBl: h,
        colorBr: p,
        colorTl: o,
        colorTr: l,
        zIndex: (Le = n.zIndex) != null ? Le : 0,
        zIndexLocked: (ke = n.zIndexLocked) != null ? ke : 0,
        parent: (Ne = n.parent) != null ? Ne : null,
        texture: (Re = n.texture) != null ? Re : null,
        textureOptions: (Ce = n.textureOptions) != null ? Ce : {},
        shader: (W = n.shader) != null ? W : this.defShaderCtr,
        src: (Qe = n.src) != null ? Qe : null,
        srcHeight: n.srcHeight,
        srcWidth: n.srcWidth,
        srcX: n.srcX,
        srcY: n.srcY,
        scale: (ot = n.scale) != null ? ot : null,
        scaleX: (Ut = (Je = n.scaleX) != null ? Je : n.scale) != null ? Ut : 1,
        scaleY: (Xt = (St = n.scaleY) != null ? St : n.scale) != null ? Xt : 1,
        mount: (vn = n.mount) != null ? vn : 0,
        mountX: (Ee = (Rn = n.mountX) != null ? Rn : n.mount) != null ? Ee : 0,
        mountY: (ai = (Di = n.mountY) != null ? Di : n.mount) != null ? ai : 0,
        pivot: (xi = n.pivot) != null ? xi : 0.5,
        pivotX: (Bt = (Et = n.pivotX) != null ? Et : n.pivot) != null ? Bt : 0.5,
        pivotY: (Cn = (He = n.pivotY) != null ? He : n.pivot) != null ? Cn : 0.5,
        rotation: (Vn = n.rotation) != null ? Vn : 0,
        rtt: (Wr = n.rtt) != null ? Wr : !1,
        data: d,
        preventCleanup: (Or = n.preventCleanup) != null ? Or : !1,
        imageType: n.imageType,
        interactive: (Js = n.interactive) != null ? Js : !1,
        strictBounds: (zr = n.strictBounds) != null ? zr : this.strictBounds,
      }
    );
  }
  cleanup() {
    this.txMemManager.cleanup();
  }
}
class a5 extends Fo {
  constructor(i, o) {
    var k, O, B, N, $, I, V, oe, Y, te, _, K, q;
    super();
    j(this, "root");
    j(this, "canvas");
    j(this, "settings");
    j(this, "stage");
    j(this, "inspector", null);
    const l = {
        criticalThreshold: ((k = i.textureMemory) == null ? void 0 : k.criticalThreshold) || 124e6,
        targetThresholdLevel: ((O = i.textureMemory) == null ? void 0 : O.targetThresholdLevel) || 0.5,
        cleanupInterval: ((B = i.textureMemory) == null ? void 0 : B.cleanupInterval) || 5e3,
        debugLogging: ((N = i.textureMemory) == null ? void 0 : N.debugLogging) || !1,
        baselineMemoryAllocation:
          (($ = i.textureMemory) == null ? void 0 : $.baselineMemoryAllocation) || 26e6,
        doNotExceedCriticalThreshold:
          ((I = i.textureMemory) == null ? void 0 : I.doNotExceedCriticalThreshold) || !1,
      },
      h = {
        appWidth: i.appWidth || 1920,
        appHeight: i.appHeight || 1080,
        textureMemory: l,
        boundsMargin: i.boundsMargin || 0,
        deviceLogicalPixelRatio: i.deviceLogicalPixelRatio || 1,
        devicePhysicalPixelRatio: i.devicePhysicalPixelRatio || window.devicePixelRatio,
        clearColor: (V = i.clearColor) != null ? V : 0,
        fpsUpdateInterval: i.fpsUpdateInterval || 0,
        targetFPS: i.targetFPS || 0,
        numImageWorkers: i.numImageWorkers !== void 0 ? i.numImageWorkers : 2,
        enableContextSpy: (oe = i.enableContextSpy) != null ? oe : !1,
        forceWebGL2: (Y = i.forceWebGL2) != null ? Y : !1,
        inspector: (te = i.inspector) != null ? te : !1,
        renderEngine: i.renderEngine,
        quadBufferSize: (_ = i.quadBufferSize) != null ? _ : 4 * 1024 * 1024,
        fontEngines: i.fontEngines,
        strictBounds: (K = i.strictBounds) != null ? K : !0,
        textureProcessingTimeLimit: i.textureProcessingTimeLimit || 42,
        canvas: i.canvas || document.createElement("canvas"),
        createImageBitmapSupport: i.createImageBitmapSupport || "full",
        maxRetryCount: (q = i.maxRetryCount) != null ? q : 5,
      };
    this.settings = h;
    const {
        appWidth: p,
        appHeight: d,
        deviceLogicalPixelRatio: y,
        devicePhysicalPixelRatio: v,
        inspector: T,
        canvas: S,
      } = h,
      w = p * y,
      C = d * y;
    ((this.canvas = S),
      (S.width = w * v),
      (S.height = C * v),
      (S.style.width = "".concat(w, "px")),
      (S.style.height = "".concat(C, "px")),
      (this.stage = new o5({
        appWidth: this.settings.appWidth,
        appHeight: this.settings.appHeight,
        boundsMargin: this.settings.boundsMargin,
        clearColor: this.settings.clearColor,
        canvas: this.canvas,
        deviceLogicalPixelRatio: this.settings.deviceLogicalPixelRatio,
        devicePhysicalPixelRatio: this.settings.devicePhysicalPixelRatio,
        enableContextSpy: this.settings.enableContextSpy,
        forceWebGL2: this.settings.forceWebGL2,
        fpsUpdateInterval: this.settings.fpsUpdateInterval,
        targetFPS: this.settings.targetFPS,
        numImageWorkers: this.settings.numImageWorkers,
        renderEngine: this.settings.renderEngine,
        textureMemory: l,
        eventBus: this,
        quadBufferSize: this.settings.quadBufferSize,
        fontEngines: this.settings.fontEngines,
        inspector: this.settings.inspector !== null,
        strictBounds: this.settings.strictBounds,
        textureProcessingTimeLimit: this.settings.textureProcessingTimeLimit,
        createImageBitmapSupport: this.settings.createImageBitmapSupport,
        maxRetryCount: this.settings.maxRetryCount,
      })),
      (this.root = this.stage.root));
    let L;
    if ((typeof o == "string" ? (L = document.getElementById(o)) : (L = o), !L))
      throw new Error("Could not find target element");
    L.appendChild(S);
  }
  createNode(i) {
    const o = this.stage.createNode(i);
    return this.inspector ? this.inspector.createNode(o) : o;
  }
  createTextNode(i) {
    const o = this.stage.createTextNode(i);
    return this.inspector ? this.inspector.createTextNode(o) : o;
  }
  destroyNode(i) {
    return (this.inspector && this.inspector.destroyNode(i.id), i.destroy());
  }
  createTexture(i, o) {
    return this.stage.txManager.createTexture(i, o);
  }
  createShader(i, o) {
    return this.stage.shManager.loadShader(i, o);
  }
  createDynamicShader(i) {
    return this.stage.shManager.loadDynamicShader({ effects: i });
  }
  createEffect(i, o, l) {
    return { name: l, type: i, props: o };
  }
  getNodeById(i) {
    var h;
    const o = (h = this.stage) == null ? void 0 : h.root;
    if (!o) return null;
    const l = p => {
      if (p.id === i) return p;
      for (const d of p.children) {
        const y = l(d);
        if (y) return y;
      }
      return null;
    };
    return l(o);
  }
  toggleFreeze() {
    throw new Error("Not implemented");
  }
  advanceFrame() {
    throw new Error("Not implemented");
  }
  getBufferInfo() {
    return this.stage.renderer.getBufferInfo();
  }
  rerender() {
    this.stage.requestRender();
  }
  cleanup() {
    this.stage.cleanup();
  }
  setClearColor(i) {
    this.stage.setClearColor(i);
  }
  get targetFPS() {
    return this.stage.options.targetFPS;
  }
  set targetFPS(i) {
    ((this.stage.options.targetFPS = i > 0 ? i : 0), this.stage.updateTargetFrameTime());
  }
}
class mD extends Fo {
  constructor(i) {
    super();
    j(this, "fontFamily");
    j(this, "descriptors");
    j(this, "loaded", !1);
    j(this, "metrics", null);
    const { fontFamily: o, descriptors: l, metrics: h } = i;
    (h &&
      (this.metrics = {
        ascender: h.ascender / h.unitsPerEm,
        descender: h.descender / h.unitsPerEm,
        lineGap: h.lineGap / h.unitsPerEm,
      }),
      (this.fontFamily = o),
      (this.descriptors = { style: "normal", weight: "normal", stretch: "normal", ...l }));
  }
  static convertToCssFontFaceDescriptors(i) {
    return {
      style: i.style,
      weight: typeof i.weight == "number" ? "".concat(i.weight) : i.weight,
      stretch: i.stretch,
      unicodeRange: i.unicodeRange,
      featureSettings: i.featureSettings,
      display: i.display,
    };
  }
}
class l5 extends mD {
  constructor(i) {
    super(i);
    j(this, "fontFace");
    j(this, "fontUrl");
    const { fontFamily: o, fontUrl: l } = i,
      h = l.replace(/\(|\)/g, ""),
      p = this.descriptors;
    let d = {
      style: p.style,
      weight: typeof p.weight == "number" ? "".concat(p.weight) : p.weight,
      stretch: p.stretch,
      unicodeRange: p.unicodeRange,
      featureSettings: p.featureSettings,
      display: p.display,
    };
    for (const v in d) {
      const T = v;
      d[T] === void 0 && delete d[T];
    }
    const y = new FontFace(o, "url(".concat(h, ")"), d);
    (h.length > 0
      ? y
          .load()
          .then(() => {
            ((this.loaded = !0), this.emit("loaded"));
          })
          .catch(console.error)
      : ((this.loaded = !0), this.emit("loaded")),
      (this.fontFace = y),
      (this.fontUrl = l));
  }
}
class u5 {}
class yD extends u5 {
  constructor(i, o, l, h, p, d, y, v, T, S, w, C, L) {
    super();
    j(this, "glw");
    j(this, "options");
    j(this, "buffers");
    j(this, "shader");
    j(this, "shaderProps");
    j(this, "alpha");
    j(this, "clippingRect");
    j(this, "dimensions");
    j(this, "bufferIdx");
    j(this, "zIndex");
    j(this, "renderToTexture");
    j(this, "parentHasRenderTexture");
    j(this, "framebufferDimensions");
    j(this, "length", 0);
    j(this, "numQuads", 0);
    j(this, "textures", []);
    j(this, "maxTextures");
    ((this.glw = i),
      (this.options = o),
      (this.buffers = l),
      (this.shader = h),
      (this.shaderProps = p),
      (this.alpha = d),
      (this.clippingRect = y),
      (this.dimensions = v),
      (this.bufferIdx = T),
      (this.zIndex = S),
      (this.renderToTexture = w),
      (this.parentHasRenderTexture = C),
      (this.framebufferDimensions = L),
      (this.maxTextures = h.supportsIndexedTextures ? i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS) : 1));
  }
  addTexture(i) {
    const { textures: o, maxTextures: l } = this;
    let h = -1;
    const p = o.length;
    for (let d = 0; d < p; d++)
      if (o[d] === i) {
        h = d;
        break;
      }
    return h !== -1 ? h : p >= l ? 4294967295 : (this.textures.push(i), p);
  }
  draw() {
    const { glw: i, shader: o, shaderProps: l, options: h } = this,
      { shManager: p } = h;
    (p.useShader(o), o.bindRenderOp(this, l));
    const d = (this.bufferIdx / 32) * 6 * 2;
    if (this.clippingRect.valid) {
      const { x: y, y: v, width: T, height: S } = this.clippingRect,
        w = this.parentHasRenderTexture ? 1 : h.pixelRatio,
        C = h.canvas.height,
        L = Math.round(y * w),
        k = Math.round(T * w),
        O = Math.round(S * w);
      let B = Math.round(C - O - v * w);
      (this.parentHasRenderTexture &&
        (B = this.framebufferDimensions ? this.framebufferDimensions.height - this.dimensions.height : 0),
        i.setScissorTest(!0),
        i.scissor(L, B, k, O));
    } else i.setScissorTest(!1);
    i.drawElements(i.TRIANGLES, 6 * this.numQuads, i.UNSIGNED_SHORT, d);
  }
}
function c5(u) {
  const n = {
    MAX_RENDERBUFFER_SIZE: 0,
    MAX_TEXTURE_SIZE: 0,
    MAX_VIEWPORT_DIMS: 0,
    MAX_VERTEX_TEXTURE_IMAGE_UNITS: 0,
    MAX_TEXTURE_IMAGE_UNITS: 0,
    MAX_COMBINED_TEXTURE_IMAGE_UNITS: 0,
    MAX_VERTEX_ATTRIBS: 0,
    MAX_VARYING_VECTORS: 0,
    MAX_VERTEX_UNIFORM_VECTORS: 0,
    MAX_FRAGMENT_UNIFORM_VECTORS: 0,
  };
  return (
    Object.keys(n).forEach(o => {
      n[o] = u.getParameter(u[o]);
    }),
    n
  );
}
function d5(u) {
  const n = {
    ANGLE_instanced_arrays: null,
    WEBGL_compressed_texture_s3tc: null,
    WEBGL_compressed_texture_astc: null,
    WEBGL_compressed_texture_etc: null,
    WEBGL_compressed_texture_etc1: null,
    WEBGL_compressed_texture_pvrtc: null,
    WEBKIT_WEBGL_compressed_texture_pvrtc: null,
    WEBGL_compressed_texture_s3tc_srgb: null,
    OES_vertex_array_object: null,
  };
  return (
    Object.keys(n).forEach(o => {
      n[o] = u.getExtension(o);
    }),
    n
  );
}
function h5(u, n) {
  const i = ~~(n / 80),
    o = new Uint16Array(i * 6);
  for (let h = 0, p = 0; h < i; h += 6, p += 4)
    ((o[h] = p),
      (o[h + 1] = p + 1),
      (o[h + 2] = p + 2),
      (o[h + 3] = p + 2),
      (o[h + 4] = p + 1),
      (o[h + 5] = p + 3));
  const l = u.createBuffer();
  u.elementArrayBufferData(l, o, u.STATIC_DRAW);
}
function f5(u) {
  return (
    u !== null &&
    ((typeof u == "object" && u.constructor && u.constructor.name === "HTMLImageElement") ||
      (typeof HTMLImageElement < "u" && u instanceof HTMLImageElement))
  );
}
const p5 = new Uint8Array([0, 0, 0, 0]);
class KT extends t5 {
  constructor(i, o, l) {
    super(o, l);
    j(this, "glw");
    j(this, "_nativeCtxTexture", null);
    j(this, "_w", 0);
    j(this, "_h", 0);
    j(this, "txCoordX1", 0);
    j(this, "txCoordY1", 0);
    j(this, "txCoordX2", 1);
    j(this, "txCoordY2", 1);
    this.glw = i;
  }
  checkGLError() {
    if (this.state === "failed") return !0;
    const i = this.glw.getError();
    return i !== 0
      ? ((this.state = "failed"),
        this.textureSource.setState("failed", new Error("WebGL Error: ".concat(i))),
        !0)
      : !1;
  }
  get ctxTexture() {
    return this.state === "freed" ? (this.load(), null) : (this._nativeCtxTexture, this._nativeCtxTexture);
  }
  get w() {
    return this._w;
  }
  get h() {
    return this._h;
  }
  async load() {
    if (this.state === "loading" || this.state === "loaded") return Promise.resolve();
    if (
      ((this.state = "loading"),
      this.textureSource.setState("loading"),
      (this._nativeCtxTexture = this.createNativeCtxTexture()),
      this._nativeCtxTexture === null)
    ) {
      ((this.state = "failed"),
        this.textureSource.setState("failed", new Error("WebGL Texture creation failed")));
      return;
    }
    try {
      const { width: i, height: o } = await this.onLoadRequest();
      if (this.state === "freed") return;
      ((this.state = "loaded"),
        (this._w = i),
        (this._h = o),
        this.textureSource.setState("loaded", { width: i, height: o }),
        this.textureSource.freeTextureData());
    } catch (i) {
      if (this.state === "freed") return;
      ((this.state = "failed"), this.textureSource.setState("failed"));
    }
  }
  async onLoadRequest() {
    var T, S;
    const { glw: i } = this,
      o = this.textureSource.textureData;
    if (this.state === "failed") return { width: 0, height: 0 };
    if (o === null || this._nativeCtxTexture === null)
      return (
        (this.state = "failed"),
        this.textureSource.setState("failed", new Error("No texture data available")),
        { width: 0, height: 0 }
      );
    (i.texImage2D(0, i.RGBA, 1, 1, 0, i.RGBA, i.UNSIGNED_BYTE, null), this.setTextureMemUse(p5.byteLength));
    let l = 0,
      h = 0;
    if ((i.activeTexture(0), this.checkGLError() === !0)) return { width: 0, height: 0 };
    const p = o.data,
      d = i.RGBA,
      y = 4,
      v = 1.1;
    if ((typeof ImageBitmap < "u" && p instanceof ImageBitmap) || p instanceof ImageData || f5(p)) {
      if (
        ((l = p.width),
        (h = p.height),
        i.bindTexture(this._nativeCtxTexture),
        i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL, !!o.premultiplyAlpha),
        i.texImage2D(0, d, d, i.UNSIGNED_BYTE, p),
        this.checkGLError() === !0)
      )
        return { width: 0, height: 0 };
      this.setTextureMemUse(h * l * y * v);
    } else if (p && "mipmaps" in p && p.mipmaps) {
      const { mipmaps: w, type: C, blockInfo: L } = p;
      if ((P$[C](i, this._nativeCtxTexture, p), this.checkGLError() === !0)) return { width: 0, height: 0 };
      ((l = p.width),
        (h = p.height),
        (this.txCoordX2 = l / (Math.ceil(l / L.width) * L.width)),
        (this.txCoordY2 = h / (Math.ceil(h / L.height) * L.height)),
        this.setTextureMemUse((S = (T = w[0]) == null ? void 0 : T.byteLength) != null ? S : 0));
    } else if (p && p instanceof Uint8Array) {
      if (
        ((l = 1),
        (h = 1),
        i.bindTexture(this._nativeCtxTexture),
        i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL, !!o.premultiplyAlpha),
        i.texImage2D(0, d, l, h, 0, d, i.UNSIGNED_BYTE, p),
        this.checkGLError() === !0)
      )
        return { width: 0, height: 0 };
      this.setTextureMemUse(l * h * y);
    } else
      return (
        console.error("WebGlCoreCtxTexture.onLoadRequest: Unexpected textureData returned", o),
        (this.state = "failed"),
        this.textureSource.setState("failed", new Error("Unexpected texture data")),
        { width: 0, height: 0 }
      );
    return { width: l, height: h };
  }
  free() {
    this.state !== "freed" && ((this.state = "freed"), this.textureSource.setState("freed"), this.release());
  }
  release() {
    ((this._w = 0),
      (this._h = 0),
      this._nativeCtxTexture !== null &&
        (this.glw.deleteTexture(this._nativeCtxTexture),
        this.setTextureMemUse(0),
        (this._nativeCtxTexture = null)),
      this.textureSource.freeTextureData());
  }
  createNativeCtxTexture() {
    const { glw: i } = this,
      o = i.createTexture();
    return !o ||
      (i.activeTexture(0),
      i.bindTexture(o),
      i.texParameteri(i.TEXTURE_MAG_FILTER, i.LINEAR),
      i.texParameteri(i.TEXTURE_MIN_FILTER, i.LINEAR),
      i.texParameteri(i.TEXTURE_WRAP_S, i.CLAMP_TO_EDGE),
      i.texParameteri(i.TEXTURE_WRAP_T, i.CLAMP_TO_EDGE),
      i.getError() !== 0)
      ? null
      : o;
  }
}
class g5 extends KT {
  constructor(n, i, o) {
    super(n, i, o);
  }
  async onLoadRequest() {
    var i, o;
    const n = this.textureSource.textureData;
    return n.data instanceof Uint8Array
      ? { width: 1, height: 1 }
      : {
          width: ((i = n.data) == null ? void 0 : i.width) || 0,
          height: ((o = n.data) == null ? void 0 : o.height) || 0,
        };
  }
}
class vD {
  constructor(n) {
    j(this, "config");
    this.config = n;
  }
  getBuffer(n) {
    var i;
    return (i = this.config.find(o => o.attributes[n])) == null ? void 0 : i.buffer;
  }
  getAttributeInfo(n) {
    var i;
    return (i = this.config.find(o => o.attributes[n])) == null ? void 0 : i.attributes[n];
  }
}
function m5(u) {
  return self.WebGL2RenderingContext && u instanceof self.WebGL2RenderingContext;
}
class y5 {
  constructor(n) {
    j(this, "gl");
    j(this, "activeTextureUnit", 0);
    j(this, "texture2dUnits");
    j(this, "texture2dParams", new WeakMap());
    j(this, "scissorEnabled");
    j(this, "scissorX");
    j(this, "scissorY");
    j(this, "scissorWidth");
    j(this, "scissorHeight");
    j(this, "blendEnabled");
    j(this, "blendSrcRgb");
    j(this, "blendDstRgb");
    j(this, "blendSrcAlpha");
    j(this, "blendDstAlpha");
    j(this, "boundArrayBuffer");
    j(this, "boundElementArrayBuffer");
    j(this, "curProgram");
    j(this, "canvas");
    j(this, "MAX_RENDERBUFFER_SIZE");
    j(this, "MAX_TEXTURE_SIZE");
    j(this, "MAX_VIEWPORT_DIMS");
    j(this, "MAX_VERTEX_TEXTURE_IMAGE_UNITS");
    j(this, "MAX_TEXTURE_IMAGE_UNITS");
    j(this, "MAX_COMBINED_TEXTURE_IMAGE_UNITS");
    j(this, "MAX_VERTEX_ATTRIBS");
    j(this, "MAX_VARYING_VECTORS");
    j(this, "MAX_VERTEX_UNIFORM_VECTORS");
    j(this, "MAX_FRAGMENT_UNIFORM_VECTORS");
    j(this, "TEXTURE_MAG_FILTER");
    j(this, "TEXTURE_MIN_FILTER");
    j(this, "TEXTURE_WRAP_S");
    j(this, "TEXTURE_WRAP_T");
    j(this, "LINEAR");
    j(this, "LINEAR_MIPMAP_LINEAR");
    j(this, "CLAMP_TO_EDGE");
    j(this, "RGB");
    j(this, "RGBA");
    j(this, "UNSIGNED_BYTE");
    j(this, "UNPACK_PREMULTIPLY_ALPHA_WEBGL");
    j(this, "UNPACK_FLIP_Y_WEBGL");
    j(this, "FLOAT");
    j(this, "TRIANGLES");
    j(this, "UNSIGNED_SHORT");
    j(this, "ONE");
    j(this, "ONE_MINUS_SRC_ALPHA");
    j(this, "VERTEX_SHADER");
    j(this, "FRAGMENT_SHADER");
    j(this, "STATIC_DRAW");
    j(this, "COMPILE_STATUS");
    j(this, "LINK_STATUS");
    j(this, "DYNAMIC_DRAW");
    j(this, "COLOR_ATTACHMENT0");
    j(this, "INVALID_ENUM");
    j(this, "INVALID_OPERATION");
    ((this.gl = n), (this.activeTextureUnit = n.getParameter(n.ACTIVE_TEXTURE) - n.TEXTURE0));
    const i = n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS);
    ((this.texture2dUnits = new Array(i)
      .fill(void 0)
      .map((l, h) => (this.activeTexture(h), n.getParameter(n.TEXTURE_BINDING_2D)))),
      this.activeTexture(this.activeTextureUnit),
      (this.scissorEnabled = n.isEnabled(n.SCISSOR_TEST)));
    const o = n.getParameter(n.SCISSOR_BOX);
    ((this.scissorX = o[0]),
      (this.scissorY = o[1]),
      (this.scissorWidth = o[2]),
      (this.scissorHeight = o[3]),
      (this.blendEnabled = n.isEnabled(n.BLEND)),
      (this.blendSrcRgb = n.getParameter(n.BLEND_SRC_RGB)),
      (this.blendDstRgb = n.getParameter(n.BLEND_DST_RGB)),
      (this.blendSrcAlpha = n.getParameter(n.BLEND_SRC_ALPHA)),
      (this.blendDstAlpha = n.getParameter(n.BLEND_DST_ALPHA)),
      (this.boundArrayBuffer = n.getParameter(n.ARRAY_BUFFER_BINDING)),
      (this.boundElementArrayBuffer = n.getParameter(n.ELEMENT_ARRAY_BUFFER_BINDING)),
      (this.curProgram = n.getParameter(n.CURRENT_PROGRAM)),
      (this.canvas = n.canvas),
      (this.MAX_RENDERBUFFER_SIZE = n.MAX_RENDERBUFFER_SIZE),
      (this.MAX_TEXTURE_SIZE = n.MAX_TEXTURE_SIZE),
      (this.MAX_VIEWPORT_DIMS = n.MAX_VIEWPORT_DIMS),
      (this.MAX_VERTEX_TEXTURE_IMAGE_UNITS = n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),
      (this.MAX_TEXTURE_IMAGE_UNITS = n.MAX_TEXTURE_IMAGE_UNITS),
      (this.MAX_COMBINED_TEXTURE_IMAGE_UNITS = n.MAX_COMBINED_TEXTURE_IMAGE_UNITS),
      (this.MAX_VERTEX_ATTRIBS = n.MAX_VERTEX_ATTRIBS),
      (this.MAX_VARYING_VECTORS = n.MAX_VARYING_VECTORS),
      (this.MAX_VERTEX_UNIFORM_VECTORS = n.MAX_VERTEX_UNIFORM_VECTORS),
      (this.MAX_FRAGMENT_UNIFORM_VECTORS = n.MAX_FRAGMENT_UNIFORM_VECTORS),
      (this.TEXTURE_MAG_FILTER = n.TEXTURE_MAG_FILTER),
      (this.TEXTURE_MIN_FILTER = n.TEXTURE_MIN_FILTER),
      (this.TEXTURE_WRAP_S = n.TEXTURE_WRAP_S),
      (this.TEXTURE_WRAP_T = n.TEXTURE_WRAP_T),
      (this.LINEAR = n.LINEAR),
      (this.LINEAR_MIPMAP_LINEAR = n.LINEAR_MIPMAP_LINEAR),
      (this.CLAMP_TO_EDGE = n.CLAMP_TO_EDGE),
      (this.RGB = n.RGB),
      (this.RGBA = n.RGBA),
      (this.UNSIGNED_BYTE = n.UNSIGNED_BYTE),
      (this.UNPACK_PREMULTIPLY_ALPHA_WEBGL = n.UNPACK_PREMULTIPLY_ALPHA_WEBGL),
      (this.UNPACK_FLIP_Y_WEBGL = n.UNPACK_FLIP_Y_WEBGL),
      (this.FLOAT = n.FLOAT),
      (this.TRIANGLES = n.TRIANGLES),
      (this.UNSIGNED_SHORT = n.UNSIGNED_SHORT),
      (this.ONE = n.ONE),
      (this.ONE_MINUS_SRC_ALPHA = n.ONE_MINUS_SRC_ALPHA),
      (this.MAX_VERTEX_TEXTURE_IMAGE_UNITS = n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),
      (this.TRIANGLES = n.TRIANGLES),
      (this.UNSIGNED_SHORT = n.UNSIGNED_SHORT),
      (this.VERTEX_SHADER = n.VERTEX_SHADER),
      (this.FRAGMENT_SHADER = n.FRAGMENT_SHADER),
      (this.STATIC_DRAW = n.STATIC_DRAW),
      (this.COMPILE_STATUS = n.COMPILE_STATUS),
      (this.LINK_STATUS = n.LINK_STATUS),
      (this.DYNAMIC_DRAW = n.DYNAMIC_DRAW),
      (this.COLOR_ATTACHMENT0 = n.COLOR_ATTACHMENT0),
      (this.INVALID_ENUM = n.INVALID_ENUM),
      (this.INVALID_OPERATION = n.INVALID_OPERATION));
  }
  isWebGl2() {
    return m5(this.gl);
  }
  activeTexture(n) {
    const { gl: i } = this;
    this.activeTextureUnit !== n && (i.activeTexture(n + i.TEXTURE0), (this.activeTextureUnit = n));
  }
  bindTexture(n) {
    const { gl: i, activeTextureUnit: o, texture2dUnits: l } = this;
    l[o] !== n && ((l[o] = n), i.bindTexture(this.gl.TEXTURE_2D, n));
  }
  _getActiveTexture() {
    const { activeTextureUnit: n, texture2dUnits: i } = this;
    return i[n];
  }
  texParameteri(n, i) {
    const { gl: o, texture2dParams: l } = this,
      h = this._getActiveTexture();
    if (!h) throw new Error("No active texture");
    let p = l.get(h);
    (p || ((p = {}), l.set(h, p)), p[n] !== i && ((p[n] = i), o.texParameteri(o.TEXTURE_2D, n, i)));
  }
  texImage2D(n, i, o, l, h, p, d, y) {
    const { gl: v } = this;
    p ? v.texImage2D(v.TEXTURE_2D, n, i, o, l, h, p, d, y) : v.texImage2D(v.TEXTURE_2D, n, i, o, l, h);
  }
  compressedTexImage2D(n, i, o, l, h, p) {
    const { gl: d } = this;
    d.compressedTexImage2D(d.TEXTURE_2D, n, i, o, l, h, p);
  }
  pixelStorei(n, i) {
    const { gl: o } = this;
    o.pixelStorei(n, i);
  }
  generateMipmap() {
    const { gl: n } = this;
    n.generateMipmap(n.TEXTURE_2D);
  }
  createTexture() {
    const { gl: n } = this;
    return n.createTexture();
  }
  deleteTexture(n) {
    const { gl: i } = this;
    (n && this.texture2dParams.delete(n), i.deleteTexture(n));
  }
  deleteFramebuffer(n) {
    this.gl.deleteFramebuffer(n);
  }
  viewport(n, i, o, l) {
    const { gl: h } = this;
    h.viewport(n, i, o, l);
  }
  clearColor(n, i, o, l) {
    const { gl: h } = this;
    h.clearColor(n, i, o, l);
  }
  setScissorTest(n) {
    const { gl: i, scissorEnabled: o } = this;
    n !== o && (n ? i.enable(i.SCISSOR_TEST) : i.disable(i.SCISSOR_TEST), (this.scissorEnabled = n));
  }
  scissor(n, i, o, l) {
    const { gl: h, scissorX: p, scissorY: d, scissorWidth: y, scissorHeight: v } = this;
    (n !== p || i !== d || o !== y || l !== v) &&
      (h.scissor(n, i, o, l),
      (this.scissorX = n),
      (this.scissorY = i),
      (this.scissorWidth = o),
      (this.scissorHeight = l));
  }
  setBlend(n) {
    const { gl: i, blendEnabled: o } = this;
    n !== o && (n ? i.enable(i.BLEND) : i.disable(i.BLEND), (this.blendEnabled = n));
  }
  blendFunc(n, i) {
    const { gl: o, blendSrcRgb: l, blendDstRgb: h, blendSrcAlpha: p, blendDstAlpha: d } = this;
    (n !== l || i !== h || n !== p || i !== d) &&
      (o.blendFunc(n, i),
      (this.blendSrcRgb = n),
      (this.blendDstRgb = i),
      (this.blendSrcAlpha = n),
      (this.blendDstAlpha = i));
  }
  createBuffer() {
    const { gl: n } = this;
    return n.createBuffer();
  }
  createFramebuffer() {
    const { gl: n } = this;
    return n.createFramebuffer();
  }
  bindFramebuffer(n) {
    const { gl: i } = this;
    i.bindFramebuffer(i.FRAMEBUFFER, n);
  }
  framebufferTexture2D(n, i, o) {
    const { gl: l } = this;
    l.framebufferTexture2D(l.FRAMEBUFFER, n, l.TEXTURE_2D, i, o);
  }
  clear() {
    const { gl: n } = this;
    n.clear(n.COLOR_BUFFER_BIT);
  }
  arrayBufferData(n, i, o) {
    const { gl: l, boundArrayBuffer: h } = this;
    (h !== n && (l.bindBuffer(l.ARRAY_BUFFER, n), (this.boundArrayBuffer = n)),
      l.bufferData(l.ARRAY_BUFFER, i, o));
  }
  elementArrayBufferData(n, i, o) {
    const { gl: l, boundElementArrayBuffer: h } = this;
    (h !== n && (l.bindBuffer(l.ELEMENT_ARRAY_BUFFER, n), (this.boundElementArrayBuffer = n)),
      l.bufferData(l.ELEMENT_ARRAY_BUFFER, i, o));
  }
  vertexAttribPointer(n, i, o, l, h, p, d) {
    const { gl: y, boundArrayBuffer: v } = this;
    (v !== n && (y.bindBuffer(y.ARRAY_BUFFER, n), (this.boundArrayBuffer = n)),
      y.vertexAttribPointer(i, o, l, h, p, d));
  }
  getUniformLocations(n) {
    const i = this.gl,
      o = i.getProgramParameter(n, i.ACTIVE_UNIFORMS),
      l = {};
    for (let h = 0; h < o; h++) {
      let d = i.getActiveUniform(n, h).name.replace(/\[.*?\]/g, "");
      l[d] = i.getUniformLocation(n, d);
    }
    return l;
  }
  getAttributeLocations(n) {
    const i = this.gl,
      o = i.getProgramParameter(n, i.ACTIVE_ATTRIBUTES),
      l = [];
    for (let h = 0; h < o; h++) {
      const { name: p } = i.getActiveAttrib(n, h);
      l[i.getAttribLocation(n, p)] = p;
    }
    return l;
  }
  useProgram(n) {
    const { gl: i, curProgram: o } = this;
    o !== n && (i.useProgram(n), (this.curProgram = n));
  }
  uniform1f(n, i) {
    const { gl: o } = this;
    o.uniform1f(n, i);
  }
  uniform1fv(n, i) {
    const { gl: o } = this;
    o.uniform1fv(n, i);
  }
  uniform1i(n, i) {
    const { gl: o } = this;
    o.uniform1i(n, i);
  }
  uniform1iv(n, i) {
    const { gl: o } = this;
    o.uniform1iv(n, i);
  }
  uniform2f(n, i, o) {
    const { gl: l } = this;
    l.uniform2f(n, i, o);
  }
  uniform2fv(n, i) {
    const { gl: o } = this;
    o.uniform2fv(n, i);
  }
  uniform2i(n, i, o) {
    const { gl: l } = this;
    l.uniform2i(n, i, o);
  }
  uniform2iv(n, i) {
    const { gl: o } = this;
    o.uniform2iv(n, i);
  }
  uniform3f(n, i, o, l) {
    const { gl: h } = this;
    h.uniform3f(n, i, o, l);
  }
  uniform3fv(n, i) {
    const { gl: o } = this;
    o.uniform3fv(n, i);
  }
  uniform3i(n, i, o, l) {
    const { gl: h } = this;
    h.uniform3i(n, i, o, l);
  }
  uniform3iv(n, i) {
    const { gl: o } = this;
    o.uniform3iv(n, i);
  }
  uniform4f(n, i, o, l, h) {
    const { gl: p } = this;
    p.uniform4f(n, i, o, l, h);
  }
  uniform4fv(n, i) {
    const { gl: o } = this;
    o.uniform4fv(n, i);
  }
  uniform4i(n, i, o, l, h) {
    const { gl: p } = this;
    p.uniform4i(n, i, o, l, h);
  }
  uniform4iv(n, i) {
    const { gl: o } = this;
    o.uniform4iv(n, i);
  }
  uniformMatrix2fv(n, i) {
    const { gl: o } = this;
    o.uniformMatrix2fv(n, !1, i);
  }
  uniformMatrix3fv(n, i) {
    const { gl: o } = this;
    o.uniformMatrix3fv(n, !1, i);
  }
  uniformMatrix4fv(n, i) {
    const { gl: o } = this;
    o.uniformMatrix4fv(n, !1, i);
  }
  getParameter(n) {
    const { gl: i } = this;
    return i.getParameter(n);
  }
  drawElements(n, i, o, l) {
    const { gl: h } = this;
    h.drawElements(n, i, o, l);
  }
  getExtension(n) {
    const { gl: i } = this;
    return i.getExtension(n);
  }
  getError() {
    const { gl: n } = this;
    return n.getError();
  }
  createVertexArray() {
    const { gl: n } = this;
    return n.createVertexArray();
  }
  bindVertexArray(n) {
    const { gl: i } = this;
    i.bindVertexArray(n);
  }
  getAttribLocation(n, i) {
    const { gl: o } = this;
    return o.getAttribLocation(n, i);
  }
  getUniformLocation(n, i) {
    const { gl: o } = this;
    return o.getUniformLocation(n, i);
  }
  enableVertexAttribArray(n) {
    const { gl: i } = this;
    i.enableVertexAttribArray(n);
  }
  disableVertexAttribArray(n) {
    const { gl: i } = this;
    i.disableVertexAttribArray(n);
  }
  createShader(n) {
    const { gl: i } = this;
    return i.createShader(n);
  }
  compileShader(n) {
    const { gl: i } = this;
    i.compileShader(n);
  }
  attachShader(n, i) {
    const { gl: o } = this;
    o.attachShader(n, i);
  }
  linkProgram(n) {
    const { gl: i } = this;
    i.linkProgram(n);
  }
  deleteProgram(n) {
    const { gl: i } = this;
    i.deleteProgram(n);
  }
  getShaderParameter(n, i) {
    const { gl: o } = this;
    return o.getShaderParameter(n, i);
  }
  getShaderInfoLog(n) {
    const { gl: i } = this;
    return i.getShaderInfoLog(n);
  }
  createProgram() {
    const { gl: n } = this;
    return n.createProgram();
  }
  getProgramParameter(n, i) {
    const { gl: o } = this;
    return o.getProgramParameter(n, i);
  }
  getProgramInfoLog(n) {
    const { gl: i } = this;
    return i.getProgramInfoLog(n);
  }
  shaderSource(n, i) {
    const { gl: o } = this;
    o.shaderSource(n, i);
  }
  deleteShader(n) {
    const { gl: i } = this;
    i.deleteShader(n);
  }
  checkError(n) {
    const i = this.getError();
    if (i !== 0) {
      let o = "UNKNOWN_ERROR";
      switch (i) {
        case this.INVALID_ENUM:
          o = "INVALID_ENUM";
          break;
        case 1281:
          o = "INVALID_VALUE";
          break;
        case this.INVALID_OPERATION:
          o = "INVALID_OPERATION";
          break;
        case 1285:
          o = "OUT_OF_MEMORY";
          break;
        case 37442:
          o = "CONTEXT_LOST_WEBGL";
          break;
      }
      const l = "WebGL ".concat(o, " (0x").concat(i.toString(16), ") during ").concat(n);
      return { error: i, errorName: o, message: l };
    }
    return null;
  }
}
class v5 extends KT {
  constructor(i, o, l) {
    super(i, o, l);
    j(this, "framebuffer", null);
  }
  async onLoadRequest() {
    const { glw: i } = this,
      o = (this._nativeCtxTexture = this.createNativeCtxTexture());
    if (!o) throw new Error("Failed to create native texture for RenderTexture");
    const { width: l, height: h } = this.textureSource;
    return (
      (this.framebuffer = i.createFramebuffer()),
      i.texImage2D(0, i.RGBA, l, h, 0, i.RGBA, i.UNSIGNED_BYTE, null),
      this.setTextureMemUse(l * h * 4),
      i.bindFramebuffer(this.framebuffer),
      i.framebufferTexture2D(i.COLOR_ATTACHMENT0, o, 0),
      i.bindFramebuffer(null),
      { width: l, height: h }
    );
  }
  free() {
    (super.free(), this.glw.deleteFramebuffer(this.framebuffer), (this.framebuffer = null));
  }
}
class x5 extends n5 {
  constructor(i) {
    super(i);
    j(this, "glw");
    j(this, "system");
    j(this, "quadBuffer");
    j(this, "fQuadBuffer");
    j(this, "uiQuadBuffer");
    j(this, "renderOps", []);
    j(this, "curBufferIdx", 0);
    j(this, "curRenderOp", null);
    j(this, "rttNodes", []);
    j(this, "activeRttNode", null);
    j(this, "defShaderCtrl");
    j(this, "defaultShader");
    j(this, "quadBufferCollection");
    j(this, "clearColor", { raw: 0, normalized: [0, 0, 0, 0] });
    j(this, "quadBufferUsage", 0);
    j(this, "numQuadsRendered", 0);
    j(this, "renderToTextureActive", !1);
    ((this.quadBuffer = new ArrayBuffer(this.stage.options.quadBufferSize)),
      (this.fQuadBuffer = new Float32Array(this.quadBuffer)),
      (this.uiQuadBuffer = new Uint32Array(this.quadBuffer)),
      (this.mode = "webgl"));
    const { canvas: o, clearColor: l, bufferMemory: h } = i,
      p = Z4(o, i.forceWebGL2, i.contextSpy),
      d = (this.glw = new y5(p));
    (d.viewport(0, 0, o.width, o.height),
      this.updateClearColor(l),
      d.setBlend(!0),
      d.blendFunc(d.ONE, d.ONE_MINUS_SRC_ALPHA),
      h5(d, h),
      (this.system = { parameters: c5(this.glw), extensions: d5(this.glw) }),
      (this.shManager.renderer = this),
      (this.defShaderCtrl = this.shManager.loadShader("DefaultShader")),
      (this.defaultShader = this.defShaderCtrl.shader));
    const y = d.createBuffer(),
      v = 8 * Float32Array.BYTES_PER_ELEMENT;
    this.quadBufferCollection = new vD([
      {
        buffer: y,
        attributes: {
          a_position: { name: "a_position", size: 2, type: d.FLOAT, normalized: !1, stride: v, offset: 0 },
          a_textureCoordinate: {
            name: "a_textureCoordinate",
            size: 2,
            type: d.FLOAT,
            normalized: !1,
            stride: v,
            offset: 2 * Float32Array.BYTES_PER_ELEMENT,
          },
          a_color: {
            name: "a_color",
            size: 4,
            type: d.UNSIGNED_BYTE,
            normalized: !0,
            stride: v,
            offset: 4 * Float32Array.BYTES_PER_ELEMENT,
          },
          a_textureIndex: {
            name: "a_textureIndex",
            size: 1,
            type: d.FLOAT,
            normalized: !1,
            stride: v,
            offset: 5 * Float32Array.BYTES_PER_ELEMENT,
          },
          a_nodeCoordinate: {
            name: "a_nodeCoordinate",
            size: 2,
            type: d.FLOAT,
            normalized: !1,
            stride: v,
            offset: 6 * Float32Array.BYTES_PER_ELEMENT,
          },
        },
      },
    ]);
  }
  reset() {
    const { glw: i } = this;
    ((this.curBufferIdx = 0),
      (this.curRenderOp = null),
      (this.renderOps.length = 0),
      i.setScissorTest(!1),
      i.clear());
  }
  getShaderManager() {
    return this.shManager;
  }
  createCtxTexture(i) {
    return i instanceof Ag
      ? new g5(this.glw, this.txMemManager, i)
      : i instanceof Ig
        ? new v5(this.glw, this.txMemManager, i)
        : new KT(this.glw, this.txMemManager, i);
  }
  addQuad(i) {
    var O, B;
    const { fQuadBuffer: o, uiQuadBuffer: l } = this;
    let h = i.texture;
    if (i.shader !== this.defaultShader) {
      if (Sg(i.shaderProps, "$dimensions") == !0) {
        const N = i.shaderProps.$dimensions;
        ((N.width = i.width), (N.height = i.height));
      }
      Sg(i.shaderProps, "$alpha") === !0 && (i.shaderProps.$alpha = i.alpha);
    }
    let { curBufferIdx: p, curRenderOp: d } = this;
    const y = { width: i.width, height: i.height };
    this.reuseRenderOp(i) === !1 &&
      (this.newRenderOp(
        i.shader,
        i.shaderProps,
        i.alpha,
        y,
        i.clippingRect,
        p,
        i.rtt,
        i.parentHasRenderTexture,
        i.framebufferDimensions,
      ),
      (d = this.curRenderOp));
    let v,
      T = 0,
      S = 0,
      w = 1,
      C = 1;
    if (h.type === _i.subTexture) {
      const { x: N, y: $, width: I, height: V } = h.props,
        { width: oe = 0, height: Y = 0 } = h.parentTexture.dimensions || { width: 0, height: 0 };
      ((T = N / oe),
        (w = T + I / oe),
        (S = $ / Y),
        (C = S + V / Y),
        (h = h.parentTexture),
        (v = h.ctxTexture));
    } else ((v = h.ctxTexture), (T = v.txCoordX1), (S = v.txCoordY1), (w = v.txCoordX2), (C = v.txCoordY2));
    if (
      h.type === _i.image &&
      i.textureOptions !== null &&
      i.textureOptions.resizeMode !== void 0 &&
      h.dimensions !== null
    ) {
      const N = i.textureOptions.resizeMode,
        { width: $, height: I } = h.dimensions;
      if (N.type === "cover") {
        const V = i.width / $,
          oe = i.height / I,
          Y = Math.max(V, oe),
          te = 1 / Y;
        if (Y && V && V < Y) {
          const _ = te * i.width;
          ((T = (1 - _ / $) * ((O = N.clipX) != null ? O : 0.5)), (w = T + _ / $));
        }
        if (Y && oe && oe < Y) {
          const _ = te * i.height;
          ((S = (1 - _ / I) * ((B = N.clipY) != null ? B : 0.5)), (C = S + _ / I));
        }
      }
    }
    let L = 0;
    (i.textureOptions !== null &&
      (i.textureOptions.flipX === !0 && ([T, w] = [w, T]), (L = +(i.textureOptions.flipY || !1))),
      L ^ +(h.type === _i.renderToTexture) && ([S, C] = [C, S]));
    const k = this.addTexture(v, p);
    if ((this.curRenderOp, i.renderCoords))
      ((o[p++] = i.renderCoords.x1),
        (o[p++] = i.renderCoords.y1),
        (o[p++] = T),
        (o[p++] = S),
        (l[p++] = i.colorTl),
        (o[p++] = k),
        (o[p++] = 0),
        (o[p++] = 0),
        (o[p++] = i.renderCoords.x2),
        (o[p++] = i.renderCoords.y2),
        (o[p++] = w),
        (o[p++] = S),
        (l[p++] = i.colorTr),
        (o[p++] = k),
        (o[p++] = 1),
        (o[p++] = 0),
        (o[p++] = i.renderCoords.x4),
        (o[p++] = i.renderCoords.y4),
        (o[p++] = T),
        (o[p++] = C),
        (l[p++] = i.colorBl),
        (o[p++] = k),
        (o[p++] = 0),
        (o[p++] = 1),
        (o[p++] = i.renderCoords.x3),
        (o[p++] = i.renderCoords.y3),
        (o[p++] = w),
        (o[p++] = C),
        (l[p++] = i.colorBr),
        (o[p++] = k),
        (o[p++] = 1),
        (o[p++] = 1));
    else if (i.tb !== 0 || i.tc !== 0)
      ((o[p++] = i.tx),
        (o[p++] = i.ty),
        (o[p++] = T),
        (o[p++] = S),
        (l[p++] = i.colorTl),
        (o[p++] = k),
        (o[p++] = 0),
        (o[p++] = 0),
        (o[p++] = i.tx + i.width * i.ta),
        (o[p++] = i.ty + i.width * i.tc),
        (o[p++] = w),
        (o[p++] = S),
        (l[p++] = i.colorTr),
        (o[p++] = k),
        (o[p++] = 1),
        (o[p++] = 0),
        (o[p++] = i.tx + i.height * i.tb),
        (o[p++] = i.ty + i.height * i.td),
        (o[p++] = T),
        (o[p++] = C),
        (l[p++] = i.colorBl),
        (o[p++] = k),
        (o[p++] = 0),
        (o[p++] = 1),
        (o[p++] = i.tx + i.width * i.ta + i.height * i.tb),
        (o[p++] = i.ty + i.width * i.tc + i.height * i.td),
        (o[p++] = w),
        (o[p++] = C),
        (l[p++] = i.colorBr),
        (o[p++] = k),
        (o[p++] = 1),
        (o[p++] = 1));
    else {
      const N = i.tx + i.width * i.ta,
        $ = i.ty + i.height * i.td;
      ((o[p++] = i.tx),
        (o[p++] = i.ty),
        (o[p++] = T),
        (o[p++] = S),
        (l[p++] = i.colorTl),
        (o[p++] = k),
        (o[p++] = 0),
        (o[p++] = 0),
        (o[p++] = N),
        (o[p++] = i.ty),
        (o[p++] = w),
        (o[p++] = S),
        (l[p++] = i.colorTr),
        (o[p++] = k),
        (o[p++] = 1),
        (o[p++] = 0),
        (o[p++] = i.tx),
        (o[p++] = $),
        (o[p++] = T),
        (o[p++] = C),
        (l[p++] = i.colorBl),
        (o[p++] = k),
        (o[p++] = 0),
        (o[p++] = 1),
        (o[p++] = N),
        (o[p++] = $),
        (o[p++] = w),
        (o[p++] = C),
        (l[p++] = i.colorBr),
        (o[p++] = k),
        (o[p++] = 1),
        (o[p++] = 1));
    }
    (this.curRenderOp.numQuads++, (this.curBufferIdx = p));
  }
  newRenderOp(i, o, l, h, p, d, y, v, T) {
    const S = new yD(this.glw, this.options, this.quadBufferCollection, i, o, l, p, h, d, 0, y, v, T);
    ((this.curRenderOp = S), this.renderOps.push(S));
  }
  addTexture(i, o, l) {
    const { curRenderOp: h } = this,
      p = h.addTexture(i);
    if (p === 4294967295) {
      if (l) throw new Error("Unable to add texture to render op");
      return (
        this.newRenderOp(h.shader, h.shaderProps, h.alpha, h.dimensions, h.clippingRect, o),
        this.addTexture(i, o, !0)
      );
    }
    return p;
  }
  reuseRenderOp(i) {
    var y;
    const { shader: o, shaderProps: l, parentHasRenderTexture: h, rtt: p, clippingRect: d } = i;
    return !(
      ((y = this.curRenderOp) == null ? void 0 : y.shader) !== o ||
      a$(this.curRenderOp.clippingRect, d) === !1 ||
      h === !0 ||
      p === !0 ||
      (this.curRenderOp.shader !== this.defaultShader &&
        this.curRenderOp.shader.canBatchShaderProps(this.curRenderOp.shaderProps, l) === !1)
    );
  }
  addRenderOp(i) {
    (this.renderOps.push(i), (this.curRenderOp = null));
  }
  render(i = "screen") {
    const { glw: o, quadBuffer: l } = this,
      h = new Float32Array(l, 0, this.curBufferIdx),
      p = this.quadBufferCollection.getBuffer("a_position") || null;
    o.arrayBufferData(p, h, o.STATIC_DRAW);
    for (let y = 0, v = this.renderOps.length; y < v; y++) this.renderOps[y].draw();
    this.quadBufferUsage = this.curBufferIdx * h.BYTES_PER_ELEMENT;
    const d = 4 * (8 * h.BYTES_PER_ELEMENT);
    this.numQuadsRendered = this.quadBufferUsage / d;
  }
  getQuadCount() {
    return this.numQuadsRendered;
  }
  renderToTexture(i) {
    for (let o = 0; o < this.rttNodes.length; o++) if (this.rttNodes[o] === i) return;
    this.insertRTTNodeInOrder(i);
  }
  insertRTTNodeInOrder(i) {
    let o = this.rttNodes.length,
      l = i;
    for (; l && l.parent; ) {
      const p = this.rttNodes.indexOf(l.parent);
      if (p !== -1) {
        o = p;
        break;
      }
      l = l.parent;
    }
    const h = this.findMaxChildRTTIndex(i);
    (h !== -1 && (o = Math.max(o, h + 1)), this.rttNodes.splice(o, 0, i));
  }
  findMaxChildRTTIndex(i) {
    let o = -1;
    const l = h => {
      const p = this.rttNodes.indexOf(h);
      p !== -1 && (o = Math.max(o, p));
      for (const d of h.children) l(d);
    };
    return (l(i), o);
  }
  renderRTTNodes() {
    const { glw: i } = this,
      { txManager: o } = this.stage;
    for (let h = 0; h < this.rttNodes.length; h++) {
      const p = this.rttNodes[h];
      if (
        p === void 0 ||
        p.hasRTTupdates === !1 ||
        p.worldAlpha === 0 ||
        (p.strictBounds === !0 && p.renderState === si.OutOfBounds) ||
        p.texture === null ||
        p.texture.state !== "loaded"
      )
        continue;
      ((this.activeRttNode = p), p.texture);
      const d = p.texture.ctxTexture;
      ((this.renderToTextureActive = !0),
        i.bindFramebuffer(d.framebuffer),
        i.viewport(0, 0, d.w, d.h),
        i.clearColor(0, 0, 0, 0),
        i.clear());
      for (let y = 0; y < p.children.length; y++) {
        const v = p.children[y];
        v !== void 0 && (this.stage.addQuads(v), (v.hasRTTupdates = !1));
      }
      (this.render(), (this.renderOps.length = 0), (p.hasRTTupdates = !1));
    }
    const l = this.clearColor.normalized;
    (i.clearColor(l[0], l[1], l[2], l[3]),
      i.bindFramebuffer(null),
      i.viewport(0, 0, this.glw.canvas.width, this.glw.canvas.height),
      (this.renderToTextureActive = !1));
  }
  removeRTTNode(i) {
    const o = this.rttNodes.indexOf(i);
    o !== -1 && this.rttNodes.splice(o, 1);
  }
  getBufferInfo() {
    return { totalAvailable: this.stage.options.quadBufferSize, totalUsed: this.quadBufferUsage };
  }
  getDefShaderCtr() {
    return this.defShaderCtrl;
  }
  updateClearColor(i) {
    if (this.clearColor.raw === i) return;
    const o = this.glw,
      l = Xg(i);
    (o.clearColor(l[0], l[1], l[2], l[3]), (this.clearColor = { raw: i, normalized: l }), o.clear());
  }
}
const T5 = { LINE_FEED: 10 };
class S5 {}
class E5 extends S5 {
  constructor(i, o) {
    super();
    j(this, "data");
    j(this, "glyphMap");
    j(this, "kernings");
    ((this.data = i), (this.glyphMap = o));
    const l = (this.kernings = {});
    (i.kernings.forEach(h => {
      const p = h.second,
        d = (l[p] = l[p] || {});
      d[h.first] = h.amount;
    }),
      (this.kernings = l));
  }
  *shapeText(i, o) {
    var p;
    let l, h;
    for (; (l = o.peek()) && !l.done; ) {
      const d = l.value,
        y = this.glyphMap.get(d);
      if ((o.next(), y !== void 0)) {
        const v =
          h !== void 0 ? (((p = this.kernings[y.id]) == null ? void 0 : p[h]) || 0) + i.letterSpacing : 0;
        ((h = y.id),
          yield {
            mapped: !0,
            glyphId: y.id,
            codepoint: d,
            cluster: o.lastIndex,
            xAdvance: y.xadvance + v,
            yAdvance: 0,
            xOffset: y.xoffset + v,
            yOffset: y.yoffset,
            xBearing: 0,
            yBearing: 0,
            width: y.width,
            height: y.height,
          });
      } else (d === T5.LINE_FEED && (h = void 0), yield { mapped: !1, codepoint: d, cluster: o.lastIndex });
    }
  }
}
class xD extends mD {
  constructor(i, o) {
    super(o);
    j(this, "type");
    j(this, "texture");
    j(this, "maxCharHeight", 0);
    j(this, "shaper");
    j(this, "glyphMap", new Map());
    j(this, "data");
    const { atlasUrl: l, atlasDataUrl: h, stage: p } = o;
    ((this.type = i),
      p.renderer,
      (this.texture = p.txManager.createTexture("ImageTexture", { src: l, premultiplyAlpha: !1 })),
      p.txManager.loadTexture(this.texture, !0),
      (this.texture.preventCleanup = !0),
      this.texture.on("loaded", () => {
        (this.checkLoaded(), p.requestRender());
      }),
      uD(h)
        .then(d => {
          var v;
          ((this.data = JSON.parse(d)), this.data);
          let y = 0;
          if (
            (this.data.chars.forEach(T => {
              this.glyphMap.set(T.id, T);
              const S = T.yoffset + T.height;
              S > y && (y = S);
            }),
            (this.maxCharHeight = y),
            (this.shaper = new E5(this.data, this.glyphMap)),
            !this.metrics)
          )
            if ((v = this.data) != null && v.lightningMetrics) {
              const { ascender: T, descender: S, lineGap: w, unitsPerEm: C } = this.data.lightningMetrics;
              this.metrics = { ascender: T / C, descender: S / C, lineGap: w / C };
            } else
              throw new Error(
                "Font metrics not found in ".concat(this.type, " font ").concat(this.fontFamily, ". ") +
                  "Make sure you are using the latest version of the Lightning 3 `msdf-generator` tool to generate your SDF fonts.",
              );
          this.checkLoaded();
        })
        .catch(console.error));
  }
  getAtlasEntry(i) {
    const o = this.glyphMap.get(i);
    if (o === void 0) throw new Error("Glyph ".concat(i, " not found in font ").concat(this.fontFamily));
    return { x: o.x, y: o.y, width: o.width, height: o.height };
  }
  checkLoaded() {
    this.loaded ||
      (this.texture.state === "loaded" && this.data && ((this.loaded = !0), this.emit("loaded")));
  }
}
const A5 = { LEGACY: !1 },
  ax = !!A5,
  Pn = {
    debug: !1,
    focusDebug: !1,
    keyDebug: !1,
    animationsEnabled: !0,
    animationSettings: { duration: 250, easing: "ease-in-out" },
    fontSettings: { fontFamily: "Ubuntu", fontSize: 100 },
    setActiveElement: () => {},
    focusStateKey: "$focus",
    lockStyles: !0,
  };
let kr;
function I5(u, n = "app") {
  return ((kr = new a5(u, n)), kr);
}
function w5(u) {
  for (const n of u)
    kr.stage.renderer.mode === "webgl" && "type" in n && (n.type === "msdf" || n.type === "ssdf")
      ? kr.stage.fontManager.addFontFace(new xD(n.type, { ...n, stage: kr.stage }))
      : "fontUrl" in n && kr.stage.fontManager.addFontFace(new l5(n));
}
const iu = { Element: "element", TextNode: "textNode", Text: "text" };
function lx(u, n, ...i) {}
const ux = u => u instanceof Function,
  ed = u => typeof u == "function";
function rT(u) {
  return Array.isArray(u);
}
function WL(u) {
  return typeof u == "string";
}
function R5(u) {
  return typeof u == "number";
}
function zL(u) {
  return "destroy" in u && typeof u.destroy == "function";
}
function Nl(u) {
  return u instanceof Do;
}
function sd(u) {
  return u._type === iu.TextNode;
}
function C5(u) {
  return u._type === iu.Text;
}
function L5(u, n) {
  for (const i of n) if (i in u) return !0;
  return !1;
}
function TD(u) {
  var n;
  return (n = u == null ? void 0 : u.states) == null ? void 0 : n.has(Pn.focusStateKey);
}
class YL extends Array {
  constructor(i, o = {}) {
    var n = (...mY) => (super(...mY), j(this, "onChange"), this);
    return (
      rT(o)
        ? n(...o)
        : WL(o)
          ? n(o)
          : n(
              ...Object.entries(o)
                .filter(([l, h]) => h)
                .map(([l]) => l),
            ),
      (this.onChange = i),
      this
    );
  }
  has(i) {
    return this.indexOf(i) >= 0 || this.indexOf("$".concat(i)) >= 0;
  }
  is(i) {
    return this.indexOf(i) >= 0;
  }
  add(i) {
    this.has(i) || (this.push(i), this.onChange());
  }
  toggle(i, o) {
    o === !0 ? this.add(i) : o === !1 ? this.remove(i) : this.has(i) ? this.remove(i) : this.add(i);
  }
  merge(i) {
    if (rT(i)) ((this.length = 0), this.push(...i));
    else if (WL(i)) ((this.length = 0), this.push(i));
    else
      for (const o in i)
        if (i[o]) this.has(o) || this.push(o);
        else {
          const h = this.indexOf(o);
          h >= 0 && this.splice(h, 1);
        }
    return this;
  }
  remove(i) {
    const o = this.indexOf(i);
    o >= 0 && (this.splice(o, 1), this.onChange());
  }
}
function XL(u) {
  var te, _, K;
  const i = (u.flexDirection || "row") === "row",
    o = i ? "width" : "height",
    l = i ? "height" : "width",
    h = i ? "marginLeft" : "marginTop",
    p = i ? "marginTop" : "marginLeft",
    d = i ? "marginRight" : "marginBottom",
    y = i ? "marginBottom" : "marginRight",
    v = [];
  let T = !1,
    S = 0;
  for (let q = 0; q < u.children.length; q++) {
    const ce = u.children[q];
    if (sd(ce) && ce.text && !(ce.width || ce.height)) return !1;
    if (C5(ce) || ce.flexItem === !1) continue;
    const he = ce.flexOrder;
    he !== void 0 && (T = !0);
    const ae = ce.flexGrow,
      ye = ae !== void 0 && ae >= 0;
    ye && (S += ae);
    const ve = ce[o] || 0,
      we = ce[h] || 0,
      Le = ce[d] || 0;
    v.push({
      node: ce,
      mainSize: ve,
      marginStart: we,
      marginEnd: Le,
      totalMainSizeOnAxis: ve + we + Le,
      isGrowItem: ye,
      flexGrowValue: ye ? ae : 0,
      flexOrder: he || 0,
      crossSize: ce[l] || 0,
      crossMarginStart: ce[p] || 0,
      crossMarginEnd: ce[y] || 0,
    });
  }
  T ? v.sort((q, ce) => q.flexOrder - ce.flexOrder) : u.direction === "rtl" && v.reverse();
  const w = v.length;
  if (w === 0) return !1;
  const C = i ? "x" : "y",
    L = i ? "y" : "x",
    k = u[o] || 0;
  let O = u[l] || 0;
  const B = u.gap || 0,
    N = u.justifyContent || "flexStart";
  let $ = !1;
  if (S > 0 && w > 1) {
    u.flexBoundary = u.flexBoundary || "fixed";
    let q = 0;
    for (const ae of v) q += ae.mainSize + ae.marginStart + ae.marginEnd;
    const ce = w > 0 ? B * (w - 1) : 0,
      he = k - q - ce;
    if (he > 0) {
      for (const ae of v)
        if (ae.isGrowItem && ae.flexGrowValue > 0) {
          const ye = (ae.flexGrowValue / S) * he,
            ve = ae.mainSize + ye;
          ((ae.node[o] = ve),
            (ae.mainSize = ve),
            (ae.totalMainSizeOnAxis = ve + ae.marginStart + ae.marginEnd));
        }
      u._containsFlexGrow = u._containsFlexGrow ? null : !0;
    } else
      u._containsFlexGrow
        ? (u._containsFlexGrow = null)
        : console.warn("No available space for flex-grow items to expand, or items overflow.");
  }
  let I = 0;
  if (N === "center" || N === "spaceBetween" || N === "spaceEvenly" || N === "spaceAround")
    for (const q of v) I += q.totalMainSizeOnAxis;
  const V = u.alignItems || (u.flexWrap ? "flexStart" : void 0),
    oe = O
      ? (q, ce = 0) => {
          const he = q.node.alignSelf || V;
          he &&
            (he === "flexStart"
              ? (q.node[L] = ce + q.crossMarginStart)
              : he === "center"
                ? (q.node[L] = ce + (O - q.crossSize) / 2 + q.crossMarginStart)
                : he === "flexEnd" && (q.node[L] = ce + O - q.crossSize - q.crossMarginEnd));
        }
      : (q, ce = 0) => {};
  if (i && u._calcHeight && !u.flexCrossBoundary) {
    const ce = v.reduce((he, ae) => Math.max(he, ae.crossSize), 0) || u.height;
    ce !== u.height && (($ = !0), (u.height = O = ce));
  }
  let Y = u.padding || 0;
  if (N === "flexStart") {
    if (u.flexWrap === "wrap") {
      let q = 0;
      const ce = ((te = v[0]) == null ? void 0 : te.crossSize) || O,
        he = i ? ((_ = u.columnGap) != null ? _ : B) : (K = u.rowGap) != null ? K : B;
      for (const ye of v)
        (Y + ye.totalMainSizeOnAxis > k && Y > (u.padding || 0) && ((Y = u.padding || 0), (q += ce + he)),
          (ye.node[C] = Y + ye.marginStart),
          (Y += ye.totalMainSizeOnAxis + B),
          oe(ye, q));
      const ae = q + ce;
      u[l] !== ae && ((u["preFlex".concat(l)] = u[l]), (u[l] = ae), ($ = !0));
    } else for (const q of v) ((q.node[C] = Y + q.marginStart), (Y += q.totalMainSizeOnAxis + B), oe(q));
    if (u.flexBoundary !== "fixed" && u.flexWrap !== "wrap") {
      const q = Y - B + (u.padding || 0);
      if (q !== k) return ((u["preFlex".concat(o)] = k), (u[o] = q), !0);
    }
  } else if (N === "flexEnd") {
    Y = k - (u.padding || 0);
    for (let q = w - 1; q >= 0; q--) {
      const ce = v[q];
      ((ce.node[C] = Y - ce.mainSize - ce.marginEnd), (Y -= ce.totalMainSizeOnAxis + B), oe(ce));
    }
  } else if (N === "center") {
    Y = (k - (I + B * (w - 1))) / 2 + (u.padding || 0);
    for (const q of v) ((q.node[C] = Y + q.marginStart), (Y += q.totalMainSizeOnAxis + B), oe(q));
  } else if (N === "spaceBetween") {
    const q = w > 1 ? (k - I - (u.padding || 0) * 2) / (w - 1) : 0;
    Y = u.padding || 0;
    for (const ce of v) ((ce.node[C] = Y + ce.marginStart), (Y += ce.totalMainSizeOnAxis + q), oe(ce));
  } else if (N === "spaceAround") {
    const q = w > 0 ? (k - I - (u.padding || 0) * 2) / w : 0;
    Y = (u.padding || 0) + q / 2;
    for (const ce of v) ((ce.node[C] = Y + ce.marginStart), (Y += ce.totalMainSizeOnAxis + q), oe(ce));
  } else if (N === "spaceEvenly") {
    const q = (k - I - (u.padding || 0) * 2) / (w + 1);
    Y = q + (u.padding || 0);
    for (const ce of v) ((ce.node[C] = Y + ce.marginStart), (Y += ce.totalMainSizeOnAxis + q), oe(ce));
  }
  return $;
}
const td = {
    ArrowLeft: "Left",
    ArrowRight: "Right",
    ArrowUp: "Up",
    ArrowDown: "Down",
    Enter: "Enter",
    l: "Last",
    " ": "Space",
    Backspace: "Back",
    Escape: "Escape",
  },
  sT = {},
  qL = (u, n) => {
    for (const [i, o] of Object.entries(u))
      Array.isArray(o)
        ? o.forEach(l => {
            n[l] = i;
          })
        : o === null
          ? delete n[i]
          : (n[o] = i);
  };
let QL = !0;
const _5 = (u, n) => {
  if (QL) {
    const i = document.createElement("style");
    ((i.type = "text/css"),
      (i.innerHTML =
        '\n      [data-focus="3"] {\n        border: 2px solid rgba(255, 33, 33, 0.2);\n        border-radius: 5px;\n        transition: border-color 0.3s ease;\n      }\n\n      [data-focus="2"] {\n        border: 2px solid rgba(255, 33, 33, 0.4);\n        border-radius: 5px;\n        transition: border-color 0.3s ease;\n      }\n\n      [data-focus="1"] {\n        border: 4px solid rgba(255, 33, 33, 0.9);\n        border-radius: 5px;\n        transition: border-color 0.5s ease;\n      }\n    '),
      document.head.appendChild(i),
      (QL = !1));
  }
  (u.forEach(i => {
    i.data = { ...i.data, focus: void 0 };
  }),
    n.forEach((i, o) => {
      i.data = { ...i.data, focus: o + 1 };
    }));
};
let JL;
const b5 = u => {
  (D5(u, JL), (JL = u), Pn.setActiveElement(u));
};
let xa = [];
const D5 = (u, n) => {
  var l, h;
  let i = u;
  const o = [];
  for (; i; )
    ((!i.states.has(Pn.focusStateKey) || i === u) &&
      (i.states.add(Pn.focusStateKey),
      (l = i.onFocus) == null || l.call(i, u, n),
      (h = i.onFocusChanged) == null || h.call(i, !0, u, n)),
      o.push(i),
      (i = i.parent));
  return (
    xa.forEach(p => {
      var d, y;
      o.includes(p) ||
        (p.states.remove(Pn.focusStateKey),
        (d = p.onBlur) == null || d.call(p, u, n),
        (y = p.onFocusChanged) == null || y.call(p, !1, u, n));
    }),
    Pn.focusDebug && _5(xa, o),
    (xa = o),
    o
  );
};
let ZL = 0,
  e_;
const Up = (u, n, i = !1, o = !1) => {
    const l = performance.now(),
      h = u.key || u.keyCode,
      p = e_ === h;
    if (((e_ = h), !o && Pn.throttleInput)) {
      if (p && l - ZL < Pn.throttleInput) return !1;
      ZL = l;
    }
    let d;
    const y = xa.length,
      v = "onCapture".concat(n || u.key) + o ? "Release" : "",
      T = o ? "onCaptureKeyRelease" : "onCaptureKey";
    for (let L = y - 1; L >= 0; L--) {
      const k = xa[L];
      if (
        k.throttleInput &&
        p &&
        k._lastAnyKeyPressTime !== void 0 &&
        l - k._lastAnyKeyPressTime < k.throttleInput
      )
        return !0;
      const O = k[v] || k[T];
      if (ed(O) && O.call(k, u, k, d, n) === !0) return ((k._lastAnyKeyPressTime = l), !0);
    }
    let S, w, C;
    (n && ((S = "on".concat(n)), (w = "on".concat(n, "Release"))), o || (C = i ? "onKeyHold" : "onKeyPress"));
    for (let L = 0; L < y; L++) {
      const k = xa[L];
      if (
        (d || (d = k),
        k.throttleInput &&
          p &&
          k._lastAnyKeyPressTime !== void 0 &&
          l - k._lastAnyKeyPressTime < k.throttleInput)
      )
        return !0;
      let O = !1;
      if (o && w) {
        const B = k[w];
        ed(B) && B.call(k, u, k, d) === !0 && (O = !0);
      } else if (!o && S) {
        const B = k[S];
        ed(B) && B.call(k, u, k, d) === !0 && (O = !0);
      }
      if (!O && C) {
        const B = k[C];
        ed(B) && B.call(k, u, n, k, d) === !0 && (O = !0);
      }
      if (O) return ((k._lastAnyKeyPressTime = l), !0);
    }
    return !1;
  },
  k5 = 500,
  js = {},
  M5 = (u, n, i) => {
    if (n) {
      const o = n.key || n.keyCode,
        l = sT[n.key] || sT[n.keyCode],
        h = td[n.key] || td[n.keyCode];
      if (l) {
        js[o] ||
          (js[o] = window.setTimeout(() => {
            ((js[o] = !0), Up(n, l, !0));
          }, u));
        return;
      }
      Up(n, h, !1);
    } else if (i) {
      const o = i.key || i.keyCode,
        l = td[i.key] || td[i.keyCode];
      (js[o] === !0 ? delete js[o] : js[o] && (clearTimeout(js[o]), delete js[o], Up(i, l, !1)),
        Up(i, l, !1, !0));
    }
  },
  P5 = ({
    userKeyMap: u,
    keyHoldOptions: n,
    ownerContext: i = o => {
      o();
    },
  } = {}) => {
    (u && qL(u, td), n != null && n.userKeyHoldMap && qL(n.userKeyHoldMap, sT));
    const o = (n == null ? void 0 : n.holdThreshold) || k5,
      l = M5.bind(null, o),
      h = d =>
        i(() => {
          l(d, void 0);
        }),
      p = d =>
        i(() => {
          l(void 0, d);
        });
    return (
      document.addEventListener("keyup", p),
      document.addEventListener("keydown", h),
      {
        cleanup: () => {
          (document.removeEventListener("keydown", h), document.removeEventListener("keyup", p));
          for (const [d, y] of Object.entries(js)) y && y !== !0 && clearTimeout(y);
        },
        focusPath: () => xa,
      }
    );
  };
class O5 {
  constructor() {
    j(this, "nodeConfigs", []);
    j(this, "isRegistered", !1);
    j(this, "stage");
  }
  register(n) {
    this.isRegistered ||
      ((this.isRegistered = !0), (this.stage = n), n.animationManager.registerAnimation(this));
  }
  add(n, i, o, l) {
    var w, C;
    const h = this.nodeConfigs.find(L => L.node === n && L.propName === i),
      p = (w = l.duration) != null ? w : 0,
      d = (C = l.delay) != null ? C : 0,
      y = l.easing || "linear",
      v = lD(y),
      T = o,
      S = n[i];
    h
      ? ((h.duration = p),
        (h.delay = d),
        (h.easing = y),
        (h.timingFunction = v),
        (h.targetValue = T),
        (h.startValue = S),
        (h.progress = 0),
        (h.delayFor = d))
      : this.nodeConfigs.push({
          node: n,
          duration: p,
          delay: d,
          easing: y,
          progress: 0,
          delayFor: d,
          timingFunction: v,
          propName: i,
          startValue: S,
          targetValue: T,
        });
  }
  update(n) {
    var i;
    for (let o = this.nodeConfigs.length - 1; o >= 0; o--) {
      const l = this.nodeConfigs[o],
        { node: h, duration: p, timingFunction: d, propName: y, startValue: v, targetValue: T } = l;
      let S = n;
      if (l.delayFor > 0) {
        if (((l.delayFor -= S), l.delayFor >= 0)) continue;
        ((S = -l.delayFor), (l.delayFor = 0));
      }
      p > 0
        ? ((l.progress += S / p), (l.progress = Math.max(0, Math.min(1, l.progress))))
        : p === 0 && l.delayFor <= 0 && (l.progress = 1);
      const w = d(l.progress) || l.progress;
      let C;
      (l.progress === 1 ? (C = T) : y.includes("color") ? (C = Qx(v, T, w)) : (C = v + (T - v) * w),
        (h.lng[y] = C),
        l.progress === 1 && this.nodeConfigs.splice(o, 1),
        this.nodeConfigs.length === 0 &&
          ((i = this.stage) == null || i.animationManager.unregisterAnimation(this),
          (this.isRegistered = !1)));
    }
  }
}
const t_ = new O5();
let Td = !1;
const Sd = new Set();
function SD() {
  Td = !1;
  const u = [...Sd];
  Sd.clear();
  for (let n = u.length - 1; n >= 0; n--) u[n].updateLayout();
}
function n_(u) {
  (Sd.add(u), Td || ((Td = !0), queueMicrotask(SD)));
}
function cx(u, n) {
  const i = [];
  for (let o in n) {
    const l = n[o];
    (o === "rounded" && (o = "radius"), typeof l == "object" && i.push(kr.createEffect(o, l, o)));
  }
  return kr.createShader("DynamicShader", { effects: i });
}
function zc(u = "") {
  return {
    set(n) {
      (R5(n) && (n = { width: n, color: 255 }),
        (this.effects = this.effects
          ? { ...(this.effects || {}), ["border".concat(u)]: n }
          : { ["border".concat(u)]: n }));
    },
    get() {
      var n;
      return (n = this.effects) == null ? void 0 : n["border".concat(u)];
    },
  };
}
const N5 = [
    "alpha",
    "color",
    "colorTop",
    "colorRight",
    "colorLeft",
    "colorBottom",
    "colorTl",
    "colorTr",
    "colorBl",
    "colorBr",
    "height",
    "fontSize",
    "lineHeight",
    "mount",
    "mountX",
    "mountY",
    "pivot",
    "pivotX",
    "pivotY",
    "rotation",
    "scale",
    "scaleX",
    "scaleY",
    "width",
    "worldX",
    "worldY",
    "x",
    "y",
    "zIndex",
    "zIndexLocked",
  ],
  F5 = [
    "absX",
    "absY",
    "autosize",
    "clipping",
    "contain",
    "data",
    "destroyed",
    "fontFamily",
    "fontStretch",
    "fontStyle",
    "fontWeight",
    "imageType",
    "letterSpacing",
    "maxLines",
    "offsetY",
    "overflowSuffix",
    "preventCleanup",
    "rtt",
    "scrollable",
    "scrollY",
    "srcHeight",
    "srcWidth",
    "srcX",
    "srcY",
    "strictBounds",
    "text",
    "textAlign",
    "textBaseline",
    "textOverflow",
    "texture",
    "textureOptions",
    "verticalAlign",
    "wordWrap",
  ];
class Do extends Object {
  constructor(n) {
    (super(),
      (this._type = n === "text" ? iu.TextNode : iu.Element),
      (this.rendered = !1),
      (this.lng = {}),
      (this.children = []));
  }
  get effects() {
    return this._effects;
  }
  set effects(n) {
    ((this._effects = n), ax && this.rendered && (this.lng.shader = cx(this, n)));
  }
  set id(n) {
    var i;
    ((this._id = n),
      (i = Pn.rendererOptions) != null && i.inspector && (this.data = { ...this.data, testId: n }));
  }
  get id() {
    return this._id;
  }
  get parent() {
    return this._parent;
  }
  set parent(n) {
    var i;
    ((this._parent = n),
      this.rendered && n != null && n.rendered && (this.lng.parent = (i = n.lng) != null ? i : null));
  }
  insertChild(n, i) {
    if (
      (n.parent && (n.parent.removeChild(n), this.rendered || (this._hasRenderedChildren = !0)),
      (n.parent = this),
      i)
    ) {
      this.removeChild(n);
      const o = this.children.indexOf(i);
      if (o >= 0) {
        this.children.splice(o, 0, n);
        return;
      }
    }
    this.children.push(n);
  }
  removeChild(n) {
    var o;
    const i = this.children.indexOf(n);
    i >= 0 && (this.children.splice(i, 1), (o = n.onRemove) == null || o.call(n, n));
  }
  get selectedNode() {
    const n = this.selected || 0;
    for (let i = n; i < this.children.length; i++) {
      const o = this.children[i];
      if (Nl(o)) return ((this.selected = i), o);
    }
  }
  set shader(n) {
    this.lng.shader = rT(n) ? kr.createShader(...n) : n;
  }
  _sendToLightningAnimatable(n, i) {
    if (
      this.transition &&
      this.rendered &&
      Pn.animationsEnabled &&
      (this.transition === !0 || this.transition[n])
    ) {
      const o = this.transition === !0 || this.transition[n] === !0 ? void 0 : this.transition[n];
      if (Pn.simpleAnimationsEnabled) {
        (t_.add(this, n, i, o || this.animationSettings), t_.register(kr.stage));
        return;
      } else {
        const l = this.animate({ [n]: i }, o);
        if (this.onAnimation) {
          const h = Object.keys(this.onAnimation);
          for (const p of h) {
            const d = this.onAnimation[p];
            l.on(p, (y, v) => {
              d.call(this, y, n, i, v);
            });
          }
        }
        return l.start();
      }
    }
    this.lng[n] = i;
  }
  animate(n, i) {
    return this.lng.animate(n, i || this.animationSettings || {});
  }
  chain(n, i) {
    return (
      this._animationRunning && ((this._animationQueue = []), (this._animationRunning = !1)),
      i
        ? (this._animationQueueSettings = i)
        : this._animationQueueSettings || (this._animationQueueSettings = i || this.animationSettings),
      (i = i || this._animationQueueSettings),
      (this._animationQueue = this._animationQueue || []),
      this._animationQueue.push({ props: n, animationSettings: i }),
      this
    );
  }
  async start() {
    let n = this._animationQueue.shift();
    for (; n; )
      ((this._animationRunning = !0),
        await this.animate(n.props, n.animationSettings).start().waitUntilStopped(),
        (n = this._animationQueue.shift()));
    ((this._animationRunning = !1), (this._animationQueueSettings = void 0));
  }
  emit(n, ...i) {
    let o = this;
    const l = "on".concat(n.charAt(0).toUpperCase()).concat(n.slice(1));
    for (; o; ) {
      const h = o[l];
      if (ed(h) && h.call(o, this, ...i) === !0) return !0;
      o = o.parent;
    }
    return !1;
  }
  setFocus() {
    if (this.rendered) {
      if (this.forwardFocus !== void 0)
        if (ux(this.forwardFocus)) {
          if (this.forwardFocus.call(this, this) !== !1) return;
        } else {
          const n = typeof this.forwardFocus == "number" ? this.forwardFocus : null,
            i = this.children;
          if (n !== null && n < i.length) {
            const o = i[n];
            Nl(o) && o.setFocus();
            return;
          }
        }
      queueMicrotask(() => b5(this));
    } else this._autofocus = !0;
  }
  _layoutOnLoad() {
    this.lng.on("loaded", () => {
      this.parent.updateLayout();
    });
  }
  getText() {
    let n = "";
    for (let i = 0; i < this.children.length; i++) n += this.children[i].text;
    return n;
  }
  destroy() {
    if (this.onDestroy) {
      const n = this.onDestroy(this);
      n instanceof Promise ? n.then(() => this._destroy()) : this._destroy();
    } else this._destroy();
  }
  _destroy() {
    var n;
    zL(this.lng) &&
      (this.lng.destroy(), (n = this.parent) != null && n.requiresLayout() && this.parent.updateLayout());
  }
  set style(n) {
    if (!(Pn.lockStyles && this._style) && n) {
      this._style = n;
      for (const i in this._style) this[i] === void 0 && (this[i] = this._style[i]);
    }
  }
  get style() {
    return this._style;
  }
  get hasChildren() {
    return this.children.length > 0;
  }
  set src(n) {
    typeof n == "string"
      ? ((this.lng.src = n), !this.color && this.rendered && (this.color = 4294967295))
      : (this.color = 0);
  }
  get src() {
    return this.lng.src;
  }
  getChildById(n) {
    return this.children.find(i => i.id === n);
  }
  searchChildrenById(n) {
    for (let i = 0; i < this.children.length; i++) {
      const o = this.children[i];
      if (Nl(o)) {
        if (o.id === n) return o;
        const l = o.searchChildrenById(n);
        if (l) return l;
      }
    }
  }
  set states(n) {
    ((this._states = this._states ? this._states.merge(n) : new YL(this._stateChanged.bind(this), n)),
      this.rendered && this._stateChanged());
  }
  get states() {
    return ((this._states = this._states || new YL(this._stateChanged.bind(this))), this._states);
  }
  get animationSettings() {
    return this._animationSettings || Pn.animationSettings;
  }
  set animationSettings(n) {
    this._animationSettings = n;
  }
  set hidden(n) {
    this.alpha = n ? 0 : 1;
  }
  get hidden() {
    return this.alpha === 0;
  }
  get h() {
    return this.height;
  }
  set h(n) {
    this.height = n;
  }
  get w() {
    return this.width;
  }
  set w(n) {
    this.width = n;
  }
  set autofocus(n) {
    ((this._autofocus = n), n && queueMicrotask(() => this.setFocus()));
  }
  get autofocus() {
    return this._autofocus;
  }
  requiresLayout() {
    return this.display === "flex" || this.onLayout;
  }
  set updateLayoutOn(n) {
    this.updateLayout();
  }
  get updateLayoutOn() {
    return null;
  }
  updateLayout() {
    if (this.hasChildren) {
      if (this.display === "flex" && this.flexGrow && this.width === 0) return;
      const n = this.display === "flex" && XL(this);
      Sd.delete(this);
      const i = ux(this.onLayout) && this.onLayout.call(this, this);
      ((n || i) && this.parent && n_(this.parent),
        this._containsFlexGrow === !0 &&
          this.children.forEach(o => {
            o.display === "flex" && Nl(o) && (XL(o), ux(o.onLayout) && o.onLayout.call(o, o), n_(this));
          }));
    }
  }
  _stateChanged() {
    if (this.forwardStates) {
      const i = this.states.slice();
      this.children.forEach(o => {
        o.states = i;
      });
    }
    const n = this.states;
    if (this._undoStyles || L5(this, n)) {
      let i;
      this._undoStyles &&
        this._undoStyles.length &&
        ((i = {}),
        this._undoStyles.forEach(h => {
          i[h] = this.style[h];
        }));
      const o = n.length;
      if (o === 0) {
        (Object.assign(this, i), (this._undoStyles = []));
        return;
      }
      let l;
      (o === 1
        ? ((l = this[n[0]]), (l = i ? { ...i, ...l } : l))
        : (l = n.reduce((h, p) => {
            const d = this[p];
            return d ? { ...h, ...d } : h;
          }, i || {})),
        l
          ? ((this._undoStyles = Object.keys(l)),
            l.transition !== void 0 && (this.transition = l.transition),
            Object.assign(this, l))
          : (this._undoStyles = []));
    }
  }
  render(n) {
    var d, y, v, T;
    const i = this,
      o = this.parent;
    if (!o) {
      console.warn("Parent not set - no node created for: ", this);
      return;
    }
    if (!o.rendered) {
      console.warn("Parent not rendered yet: ", this);
      return;
    }
    if ((o.requiresLayout() && Sd.add(o), this.rendered)) {
      (d = this.onRender) == null || d.call(this, this);
      return;
    }
    this._states && this._stateChanged();
    const l = i.lng,
      h = o.width || 0,
      p = o.height || 0;
    if (
      ((l.x = l.x || 0),
      (l.y = l.y || 0),
      (l.parent = o.lng),
      (this.right || this.right === 0) && ((l.x = h - this.right), (l.mountX = 1)),
      (this.bottom || this.bottom === 0) && ((l.y = p - this.bottom), (l.mountY = 1)),
      this.center && (this.centerX = this.centerY = !0),
      this.centerX && ((l.x += h / 2), (l.mountX = 0.5)),
      this.centerY && ((l.y += p / 2), (l.mountY = 0.5)),
      sd(i))
    ) {
      const S = l;
      if (Pn.fontSettings) for (const w in Pn.fontSettings) S[w] === void 0 && (S[w] = Pn.fontSettings[w]);
      ((S.text = S.text || i.getText()),
        S.textAlign && !S.contain && console.warn("Text align requires contain: ", i.getText()),
        S.contain &&
          (S.width || (S.width = h - S.x - (S.marginRight || 0)),
          S.contain === "both" && !S.height && !S.maxLines
            ? (S.height = p - S.y - (S.marginBottom || 0))
            : S.maxLines === 1 && (S.height = S.height || S.lineHeight || S.fontSize)),
        ax && i._effects && (l.shader = cx(i, i._effects)),
        (i.lng = kr.createTextNode(l)),
        o.requiresLayout() && (!l.width || !l.height) && i._layoutOnLoad());
    } else if (
      (l.texture ||
        (isNaN(l.width) && ((l.width = i.flexGrow ? 0 : h - l.x), (i._calcWidth = !0)),
        isNaN(l.height) && ((l.height = p - l.y), (i._calcHeight = !0)),
        l.rtt && !l.color && (l.color = 4294967295),
        !l.color && !l.src && (l.color = 0)),
      ax && i._effects && (l.shader = cx(i, i._effects)),
      (i.lng = kr.createNode(l)),
      i._hasRenderedChildren)
    ) {
      i._hasRenderedChildren = !1;
      for (const S of i.children) Nl(S) && zL(S.lng) && (S.lng.parent = i.lng);
    }
    if (
      ((i.rendered = !0),
      i.autosize && o.requiresLayout() && i._layoutOnLoad(),
      (y = this.onCreate) == null || y.call(this, this),
      (v = this.onRender) == null || v.call(this, this),
      i.onEvent)
    )
      for (const [S, w] of Object.entries(i.onEvent)) i.lng.on(S, (C, L) => w.call(i, i, L));
    if (((T = i.lng) != null && T.div && (i.lng.div.element = i), i._type === iu.Element)) {
      const S = i.children.length;
      for (let w = 0; w < S; w++) {
        const C = i.children[w];
        Nl(C) && C.render();
      }
    }
    (n && !Td && ((Td = !0), queueMicrotask(SD)), i._autofocus && i.setFocus());
  }
}
for (const u of N5)
  Object.defineProperty(Do.prototype, u, {
    get() {
      return this.lng[u];
    },
    set(n) {
      this._sendToLightningAnimatable(u, n);
    },
  });
for (const u of F5)
  Object.defineProperty(Do.prototype, u, {
    get() {
      return this.lng[u];
    },
    set(n) {
      this.lng[u] = n;
    },
  });
function dx(u) {
  return {
    set(n) {
      this.effects = this.effects ? { ...this.effects, [u]: n } : { [u]: n };
    },
    get() {
      var n;
      return (n = this.effects) == null ? void 0 : n[u];
    },
  };
}
Object.defineProperties(Do.prototype, {
  border: zc(),
  borderLeft: zc("Left"),
  borderRight: zc("Right"),
  borderTop: zc("Top"),
  borderBottom: zc("Bottom"),
  linearGradient: dx("linearGradient"),
  radialGradient: dx("radialGradient"),
  radialProgress: dx("radialProgressGradient"),
  rounded: {
    set(u) {
      this.effects = this.effects ? { ...this.effects, radius: { radius: u } } : { radius: { radius: u } };
    },
    get() {
      var u, n;
      return (n = (u = this.effects) == null ? void 0 : u.radius) == null ? void 0 : n.radius;
    },
  },
  borderRadius: {
    set(u) {
      this.effects = this.effects ? { ...this.effects, radius: { radius: u } } : { radius: { radius: u } };
    },
    get() {
      var u, n;
      return (n = (u = this.effects) == null ? void 0 : u.radius) == null ? void 0 : n.radius;
    },
  },
});
const U5 = !1,
  B5 = (u, n) => u === n,
  oT = Symbol("solid-proxy"),
  $5 = typeof Proxy == "function",
  G5 = Symbol("solid-track"),
  wg = { equals: B5 };
let ED = CD;
const qs = 1,
  Rg = 2,
  AD = { owned: null, cleanups: null, context: null, owner: null },
  hx = {};
var Wt = null;
let fx = null,
  j5 = null,
  nn = null,
  bi = null,
  Ys = null,
  qg = 0;
function ko(u, n) {
  const i = nn,
    o = Wt,
    l = u.length === 0,
    h = o,
    p = l ? AD : { owned: null, cleanups: null, context: h ? h.context : null, owner: h },
    d = l ? u : () => u(() => Vi(() => Ed(p)));
  ((Wt = p), (nn = null));
  try {
    return cs(d, !0);
  } finally {
    ((nn = i), (Wt = o));
  }
}
function en(u, n) {
  n = n ? Object.assign({}, wg, n) : wg;
  const i = { value: u, observers: null, observerSlots: null, comparator: n.equals || void 0 },
    o = l => (typeof l == "function" && (l = l(i.value)), RD(i, l));
  return [wD.bind(i), o];
}
function V5(u, n, i) {
  const o = Qg(u, n, !0, qs);
  pu(o);
}
function Kr(u, n, i) {
  const o = Qg(u, n, !1, qs);
  pu(o);
}
function Pd(u, n, i) {
  ED = q5;
  const o = Qg(u, n, !1, qs);
  ((o.user = !0), Ys ? Ys.push(o) : pu(o));
}
function jn(u, n, i) {
  i = i ? Object.assign({}, wg, i) : wg;
  const o = Qg(u, n, !0, 0);
  return (
    (o.observers = null),
    (o.observerSlots = null),
    (o.comparator = i.equals || void 0),
    pu(o),
    wD.bind(o)
  );
}
function H5(u) {
  return u && typeof u == "object" && "then" in u;
}
function Cg(u, n, i) {
  let o, l, h;
  typeof n == "function" ? ((o = u), (l = n), (h = {})) : ((o = !0), (l = u), (h = n || {}));
  let p = null,
    d = hx,
    y = !1,
    v = "initialValue" in h,
    T = typeof o == "function" && jn(o);
  const S = new Set(),
    [w, C] = (h.storage || en)(h.initialValue),
    [L, k] = en(void 0),
    [O, B] = en(void 0, { equals: !1 }),
    [N, $] = en(v ? "ready" : "unresolved");
  function I(_, K, q, ce) {
    return (
      p === _ &&
        ((p = null),
        ce !== void 0 && (v = !0),
        (_ === d || K === d) && h.onHydrated && queueMicrotask(() => h.onHydrated(ce, { value: K })),
        (d = hx),
        V(K, q)),
      K
    );
  }
  function V(_, K) {
    cs(() => {
      (K === void 0 && C(() => _), $(K !== void 0 ? "errored" : v ? "ready" : "unresolved"), k(K));
      for (const q of S.keys()) q.decrement();
      S.clear();
    }, !1);
  }
  function oe() {
    const _ = z5,
      K = w(),
      q = L();
    if (q !== void 0 && !p) throw q;
    return (nn && nn.user, K);
  }
  function Y(_ = !0) {
    if (_ !== !1 && y) return;
    y = !1;
    const K = T ? T() : o;
    if (K == null || K === !1) {
      I(p, Vi(w));
      return;
    }
    let q;
    const ce =
      d !== hx
        ? d
        : Vi(() => {
            try {
              return l(K, { value: w(), refetching: _ });
            } catch (he) {
              q = he;
            }
          });
    if (q !== void 0) {
      I(p, void 0, ug(q), K);
      return;
    } else if (!H5(ce)) return (I(p, ce, void 0, K), ce);
    return (
      (p = ce),
      "v" in ce
        ? (ce.s === 1 ? I(p, ce.v, void 0, K) : I(p, void 0, ug(ce.v), K), ce)
        : ((y = !0),
          queueMicrotask(() => (y = !1)),
          cs(() => {
            ($(v ? "refreshing" : "pending"), B());
          }, !1),
          ce.then(
            he => I(ce, he, void 0, K),
            he => I(ce, void 0, ug(he), K),
          ))
    );
  }
  Object.defineProperties(oe, {
    state: { get: () => N() },
    error: { get: () => L() },
    loading: {
      get() {
        const _ = N();
        return _ === "pending" || _ === "refreshing";
      },
    },
    latest: {
      get() {
        if (!v) return oe();
        const _ = L();
        if (_ && !p) throw _;
        return w();
      },
    },
  });
  let te = Wt;
  return (T ? V5(() => ((te = Wt), Y(!1))) : Y(!1), [oe, { refetch: _ => fu(te, () => Y(_)), mutate: C }]);
}
function K5(u) {
  return cs(u, !1);
}
function Vi(u) {
  if (nn === null) return u();
  const n = nn;
  nn = null;
  try {
    return u();
  } finally {
    nn = n;
  }
}
function Od(u, n, i) {
  const o = Array.isArray(u);
  let l,
    h = i && i.defer;
  return p => {
    let d;
    if (o) {
      d = Array(u.length);
      for (let v = 0; v < u.length; v++) d[v] = u[v]();
    } else d = u();
    if (h) return ((h = !1), p);
    const y = Vi(() => n(d, l, p));
    return ((l = d), y);
  };
}
function WT(u) {
  Pd(() => Vi(u));
}
function hu(u) {
  return (Wt === null || (Wt.cleanups === null ? (Wt.cleanups = [u]) : Wt.cleanups.push(u)), u);
}
function wa() {
  return Wt;
}
function fu(u, n) {
  const i = Wt,
    o = nn;
  ((Wt = u), (nn = null));
  try {
    return cs(n, !0);
  } catch (l) {
    XT(l);
  } finally {
    ((Wt = i), (nn = o));
  }
}
function W5(u) {
  const n = nn,
    i = Wt;
  return Promise.resolve().then(() => {
    ((nn = n), (Wt = i), cs(u, !1), (nn = Wt = null));
  });
}
const [lY, uY] = en(!1);
function zT(u, n) {
  const i = Symbol("context");
  return { id: i, Provider: Q5(i), defaultValue: u };
}
function ID(u) {
  let n;
  return Wt && Wt.context && (n = Wt.context[u.id]) !== void 0 ? n : u.defaultValue;
}
function YT(u) {
  const n = jn(u),
    i = jn(() => aT(n()));
  return (
    (i.toArray = () => {
      const o = i();
      return Array.isArray(o) ? o : o != null ? [o] : [];
    }),
    i
  );
}
let z5;
function wD() {
  if (this.sources && this.state)
    if (this.state === qs) pu(this);
    else {
      const u = bi;
      ((bi = null), cs(() => _g(this), !1), (bi = u));
    }
  if (nn) {
    const u = this.observers ? this.observers.length : 0;
    (nn.sources
      ? (nn.sources.push(this), nn.sourceSlots.push(u))
      : ((nn.sources = [this]), (nn.sourceSlots = [u])),
      this.observers
        ? (this.observers.push(nn), this.observerSlots.push(nn.sources.length - 1))
        : ((this.observers = [nn]), (this.observerSlots = [nn.sources.length - 1])));
  }
  return this.value;
}
function RD(u, n, i) {
  let o = u.value;
  return (
    (!u.comparator || !u.comparator(o, n)) &&
      ((u.value = n),
      u.observers &&
        u.observers.length &&
        cs(() => {
          for (let l = 0; l < u.observers.length; l += 1) {
            const h = u.observers[l],
              p = fx && fx.running;
            (p && fx.disposed.has(h),
              (p ? !h.tState : !h.state) && (h.pure ? bi.push(h) : Ys.push(h), h.observers && LD(h)),
              p || (h.state = qs));
          }
          if (bi.length > 1e6) throw ((bi = []), new Error());
        }, !1)),
    n
  );
}
function pu(u) {
  if (!u.fn) return;
  Ed(u);
  const n = qg;
  Y5(u, u.value, n);
}
function Y5(u, n, i) {
  let o;
  const l = Wt,
    h = nn;
  nn = Wt = u;
  try {
    o = u.fn(n);
  } catch (p) {
    return (
      u.pure && ((u.state = qs), u.owned && u.owned.forEach(Ed), (u.owned = null)),
      (u.updatedAt = i + 1),
      XT(p)
    );
  } finally {
    ((nn = h), (Wt = l));
  }
  (!u.updatedAt || u.updatedAt <= i) &&
    (u.updatedAt != null && "observers" in u ? RD(u, o) : (u.value = o), (u.updatedAt = i));
}
function Qg(u, n, i, o = qs, l) {
  const h = {
    fn: u,
    state: o,
    updatedAt: null,
    owned: null,
    sources: null,
    sourceSlots: null,
    cleanups: null,
    value: n,
    owner: Wt,
    context: Wt ? Wt.context : null,
    pure: i,
  };
  return (Wt === null || (Wt !== AD && (Wt.owned ? Wt.owned.push(h) : (Wt.owned = [h]))), h);
}
function Lg(u) {
  if (u.state === 0) return;
  if (u.state === Rg) return _g(u);
  if (u.suspense && Vi(u.suspense.inFallback)) return u.suspense.effects.push(u);
  const n = [u];
  for (; (u = u.owner) && (!u.updatedAt || u.updatedAt < qg); ) u.state && n.push(u);
  for (let i = n.length - 1; i >= 0; i--)
    if (((u = n[i]), u.state === qs)) pu(u);
    else if (u.state === Rg) {
      const o = bi;
      ((bi = null), cs(() => _g(u, n[0]), !1), (bi = o));
    }
}
function cs(u, n) {
  if (bi) return u();
  let i = !1;
  (n || (bi = []), Ys ? (i = !0) : (Ys = []), qg++);
  try {
    const o = u();
    return (X5(i), o);
  } catch (o) {
    (i || (Ys = null), (bi = null), XT(o));
  }
}
function X5(u) {
  if ((bi && (CD(bi), (bi = null)), u)) return;
  const n = Ys;
  ((Ys = null), n.length && cs(() => ED(n), !1));
}
function CD(u) {
  for (let n = 0; n < u.length; n++) Lg(u[n]);
}
function q5(u) {
  let n,
    i = 0;
  for (n = 0; n < u.length; n++) {
    const o = u[n];
    o.user ? (u[i++] = o) : Lg(o);
  }
  for (n = 0; n < i; n++) Lg(u[n]);
}
function _g(u, n) {
  u.state = 0;
  for (let i = 0; i < u.sources.length; i += 1) {
    const o = u.sources[i];
    if (o.sources) {
      const l = o.state;
      l === qs ? o !== n && (!o.updatedAt || o.updatedAt < qg) && Lg(o) : l === Rg && _g(o, n);
    }
  }
}
function LD(u) {
  for (let n = 0; n < u.observers.length; n += 1) {
    const i = u.observers[n];
    i.state || ((i.state = Rg), i.pure ? bi.push(i) : Ys.push(i), i.observers && LD(i));
  }
}
function Ed(u) {
  let n;
  if (u.sources)
    for (; u.sources.length; ) {
      const i = u.sources.pop(),
        o = u.sourceSlots.pop(),
        l = i.observers;
      if (l && l.length) {
        const h = l.pop(),
          p = i.observerSlots.pop();
        o < l.length && ((h.sourceSlots[p] = o), (l[o] = h), (i.observerSlots[o] = p));
      }
    }
  if (u.tOwned) {
    for (n = u.tOwned.length - 1; n >= 0; n--) Ed(u.tOwned[n]);
    delete u.tOwned;
  }
  if (u.owned) {
    for (n = u.owned.length - 1; n >= 0; n--) Ed(u.owned[n]);
    u.owned = null;
  }
  if (u.cleanups) {
    for (n = u.cleanups.length - 1; n >= 0; n--) u.cleanups[n]();
    u.cleanups = null;
  }
  u.state = 0;
}
function ug(u) {
  return u instanceof Error ? u : new Error(typeof u == "string" ? u : "Unknown error", { cause: u });
}
function XT(u, n = Wt) {
  throw ug(u);
}
function aT(u) {
  if (typeof u == "function" && !u.length) return aT(u());
  if (Array.isArray(u)) {
    const n = [];
    for (let i = 0; i < u.length; i++) {
      const o = aT(u[i]);
      Array.isArray(o) ? n.push.apply(n, o) : n.push(o);
    }
    return n;
  }
  return u;
}
function Q5(u, n) {
  return function (o) {
    let l;
    return (
      Kr(
        () => (l = Vi(() => ((Wt.context = { ...Wt.context, [u]: o.value }), YT(() => o.children)))),
        void 0,
      ),
      l
    );
  };
}
const J5 = Symbol("fallback");
function i_(u) {
  for (let n = 0; n < u.length; n++) u[n]();
}
function Z5(u, n, i = {}) {
  let o = [],
    l = [],
    h = [],
    p = 0,
    d = n.length > 1 ? [] : null;
  return (
    hu(() => i_(h)),
    () => {
      let y = u() || [],
        v = y.length,
        T,
        S;
      return (
        y[G5],
        Vi(() => {
          let C, L, k, O, B, N, $, I, V;
          if (v === 0)
            (p !== 0 && (i_(h), (h = []), (o = []), (l = []), (p = 0), d && (d = [])),
              i.fallback && ((o = [J5]), (l[0] = ko(oe => ((h[0] = oe), i.fallback()))), (p = 1)));
          else if (p === 0) {
            for (l = new Array(v), S = 0; S < v; S++) ((o[S] = y[S]), (l[S] = ko(w)));
            p = v;
          } else {
            for (
              k = new Array(v), O = new Array(v), d && (B = new Array(v)), N = 0, $ = Math.min(p, v);
              N < $ && o[N] === y[N];
              N++
            );
            for ($ = p - 1, I = v - 1; $ >= N && I >= N && o[$] === y[I]; $--, I--)
              ((k[I] = l[$]), (O[I] = h[$]), d && (B[I] = d[$]));
            for (C = new Map(), L = new Array(I + 1), S = I; S >= N; S--)
              ((V = y[S]), (T = C.get(V)), (L[S] = T === void 0 ? -1 : T), C.set(V, S));
            for (T = N; T <= $; T++)
              ((V = o[T]),
                (S = C.get(V)),
                S !== void 0 && S !== -1
                  ? ((k[S] = l[T]), (O[S] = h[T]), d && (B[S] = d[T]), (S = L[S]), C.set(V, S))
                  : h[T]());
            for (S = N; S < v; S++)
              S in k ? ((l[S] = k[S]), (h[S] = O[S]), d && ((d[S] = B[S]), d[S](S))) : (l[S] = ko(w));
            ((l = l.slice(0, (p = v))), (o = y.slice(0)));
          }
          return l;
        })
      );
      function w(C) {
        if (((h[S] = C), d)) {
          const [L, k] = en(S);
          return ((d[S] = k), n(y[S], L));
        }
        return n(y[S]);
      }
    }
  );
}
function _D(u, n) {
  return Vi(() => u(n || {}));
}
function Bp() {
  return !0;
}
const e8 = {
  get(u, n, i) {
    return n === oT ? i : u.get(n);
  },
  has(u, n) {
    return n === oT ? !0 : u.has(n);
  },
  set: Bp,
  deleteProperty: Bp,
  getOwnPropertyDescriptor(u, n) {
    return {
      configurable: !0,
      enumerable: !0,
      get() {
        return u.get(n);
      },
      set: Bp,
      deleteProperty: Bp,
    };
  },
  ownKeys(u) {
    return u.keys();
  },
};
function px(u) {
  return (u = typeof u == "function" ? u() : u) ? u : {};
}
function t8() {
  for (let u = 0, n = this.length; u < n; ++u) {
    const i = this[u]();
    if (i !== void 0) return i;
  }
}
function qT(...u) {
  let n = !1;
  for (let p = 0; p < u.length; p++) {
    const d = u[p];
    ((n = n || (!!d && oT in d)), (u[p] = typeof d == "function" ? ((n = !0), jn(d)) : d));
  }
  if ($5 && n)
    return new Proxy(
      {
        get(p) {
          for (let d = u.length - 1; d >= 0; d--) {
            const y = px(u[d])[p];
            if (y !== void 0) return y;
          }
        },
        has(p) {
          for (let d = u.length - 1; d >= 0; d--) if (p in px(u[d])) return !0;
          return !1;
        },
        keys() {
          const p = [];
          for (let d = 0; d < u.length; d++) p.push(...Object.keys(px(u[d])));
          return [...new Set(p)];
        },
      },
      e8,
    );
  const i = {},
    o = Object.create(null);
  for (let p = u.length - 1; p >= 0; p--) {
    const d = u[p];
    if (!d) continue;
    const y = Object.getOwnPropertyNames(d);
    for (let v = y.length - 1; v >= 0; v--) {
      const T = y[v];
      if (T === "__proto__" || T === "constructor") continue;
      const S = Object.getOwnPropertyDescriptor(d, T);
      if (!o[T])
        o[T] = S.get
          ? { enumerable: !0, configurable: !0, get: t8.bind((i[T] = [S.get.bind(d)])) }
          : S.value !== void 0
            ? S
            : void 0;
      else {
        const w = i[T];
        w && (S.get ? w.push(S.get.bind(d)) : S.value !== void 0 && w.push(() => S.value));
      }
    }
  }
  const l = {},
    h = Object.keys(o);
  for (let p = h.length - 1; p >= 0; p--) {
    const d = h[p],
      y = o[d];
    y && y.get ? Object.defineProperty(l, d, y) : (l[d] = y ? y.value : void 0);
  }
  return l;
}
const n8 = u => "Stale read from <".concat(u, ">.");
function Ad(u) {
  const n = "fallback" in u && { fallback: () => u.fallback };
  return jn(Z5(() => u.each, u.children, n || void 0));
}
function gu(u) {
  const n = u.keyed,
    i = jn(() => u.when, void 0, void 0),
    o = n ? i : jn(i, void 0, { equals: (l, h) => !l == !h });
  return jn(
    () => {
      const l = o();
      if (l) {
        const h = u.children;
        return typeof h == "function" && h.length > 0
          ? Vi(() =>
              h(
                n
                  ? l
                  : () => {
                      if (!Vi(o)) throw n8("Show");
                      return i();
                    },
              ),
            )
          : h;
      }
      return u.fallback;
    },
    void 0,
    void 0,
  );
}
const [bD, DD] = en(void 0);
function kD(u, n) {
  return u ? (n ? { ...n, ...u } : u) : n;
}
const i8 = (u, n, i) => (n < i ? Math.min(Math.max(u, n), i) : Math.min(Math.max(u, i), n)),
  r8 = u => jn(() => u());
function s8({
  createElement: u,
  createTextNode: n,
  isTextNode: i,
  replaceText: o,
  insertNode: l,
  removeNode: h,
  setProperty: p,
  getParentNode: d,
  getFirstChild: y,
  getNextSibling: v,
}) {
  function T(N, $, I, V) {
    if ((I !== void 0 && !V && (V = []), typeof $ != "function")) return S(N, $, V, I);
    Kr(oe => S(N, $(), oe, I), V);
  }
  function S(N, $, I, V, oe) {
    for (; typeof I == "function"; ) I = I();
    if ($ === I) return I;
    const Y = typeof $,
      te = V !== void 0;
    if (Y === "string" || Y === "number")
      if ((Y === "number" && ($ = $.toString()), te)) {
        let _ = I[0];
        (_ && i(_) ? o(_, $) : (_ = n($)), (I = L(N, I, V, _)));
      } else I !== "" && typeof I == "string" ? o(y(N), (I = $)) : (L(N, I, V, n($)), (I = $));
    else if ($ == null || Y === "boolean") I = L(N, I, V);
    else {
      if (Y === "function")
        return (
          Kr(() => {
            let _ = $();
            for (; typeof _ == "function"; ) _ = _();
            I = S(N, _, I, V);
          }),
          () => I
        );
      if (Array.isArray($)) {
        const _ = [];
        if (w(_, $, oe)) return (Kr(() => (I = S(N, _, I, V, !0))), () => I);
        if (_.length === 0) {
          const K = L(N, I, V);
          if (te) return (I = K);
        } else
          Array.isArray(I)
            ? I.length === 0
              ? k(N, _, V)
              : C(N, I, _)
            : I == null || I === ""
              ? k(N, _)
              : C(N, (te && I) || [y(N)], _);
        I = _;
      } else {
        if (Array.isArray(I)) {
          if (te) return (I = L(N, I, V, $));
          L(N, I, null, $);
        } else I == null || I === "" || !y(N) ? l(N, $) : O(N, $, y(N));
        I = $;
      }
    }
    return I;
  }
  function w(N, $, I) {
    let V = !1;
    for (let oe = 0, Y = $.length; oe < Y; oe++) {
      let te = $[oe],
        _;
      if (!(te == null || te === !0 || te === !1))
        if (Array.isArray(te)) V = w(N, te) || V;
        else if ((_ = typeof te) == "string" || _ === "number") N.push(n(te));
        else if (_ === "function")
          if (I) {
            for (; typeof te == "function"; ) te = te();
            V = w(N, Array.isArray(te) ? te : [te]) || V;
          } else (N.push(te), (V = !0));
        else N.push(te);
    }
    return V;
  }
  function C(N, $, I) {
    let V = I.length,
      oe = $.length,
      Y = V,
      te = 0,
      _ = 0,
      K = v($[oe - 1]),
      q = null;
    for (; te < oe || _ < Y; ) {
      if ($[te] === I[_]) {
        (te++, _++);
        continue;
      }
      for (; $[oe - 1] === I[Y - 1]; ) (oe--, Y--);
      if (oe === te) {
        const ce = Y < V ? (_ ? v(I[_ - 1]) : I[Y - _]) : K;
        for (; _ < Y; ) l(N, I[_++], ce);
      } else if (Y === _) for (; te < oe; ) ((!q || !q.has($[te])) && h(N, $[te]), te++);
      else if ($[te] === I[Y - 1] && I[_] === $[oe - 1]) {
        const ce = v($[--oe]);
        (l(N, I[_++], v($[te++])), l(N, I[--Y], ce), ($[oe] = I[Y]));
      } else {
        if (!q) {
          q = new Map();
          let he = _;
          for (; he < Y; ) q.set(I[he], he++);
        }
        const ce = q.get($[te]);
        if (ce != null)
          if (_ < ce && ce < Y) {
            let he = te,
              ae = 1,
              ye;
            for (; ++he < oe && he < Y && !((ye = q.get($[he])) == null || ye !== ce + ae); ) ae++;
            if (ae > ce - _) {
              const ve = $[te];
              for (; _ < ce; ) l(N, I[_++], ve);
            } else O(N, I[_++], $[te++]);
          } else te++;
        else h(N, $[te++]);
      }
    }
  }
  function L(N, $, I, V) {
    if (I === void 0) {
      let Y;
      for (; (Y = y(N)); ) h(N, Y);
      return (V && l(N, V), "");
    }
    const oe = V || n("");
    if ($.length) {
      let Y = !1;
      for (let te = $.length - 1; te >= 0; te--) {
        const _ = $[te];
        if (oe !== _) {
          const K = d(_) === N;
          !Y && !te ? (K ? O(N, oe, _) : l(N, oe, I)) : K && h(N, _);
        } else Y = !0;
      }
    } else l(N, oe, I);
    return [oe];
  }
  function k(N, $, I) {
    for (let V = 0, oe = $.length; V < oe; V++) l(N, $[V], I);
  }
  function O(N, $, I) {
    (l(N, $, I), h(N, I));
  }
  function B(N, $, I = {}, V) {
    return (
      $ || ($ = {}),
      V || Kr(() => (I.children = S(N, $.children, I.children))),
      Kr(() => $.ref && $.ref(N)),
      Kr(() => {
        for (const oe in $) {
          if (oe === "children" || oe === "ref") continue;
          const Y = $[oe];
          Y !== I[oe] && (p(N, oe, Y, I[oe]), (I[oe] = Y));
        }
      }),
      I
    );
  }
  return {
    render(N, $) {
      let I;
      return (
        ko(V => {
          ((I = V), T($, N()));
        }),
        I
      );
    },
    insert: T,
    spread(N, $, I) {
      typeof $ == "function" ? Kr(V => B(N, $(), V, I)) : B(N, $, void 0, I);
    },
    createElement: u,
    createTextNode: n,
    insertNode: l,
    setProp(N, $, I, V) {
      return (p(N, $, I, V), I);
    },
    mergeProps: qT,
    effect: Kr,
    memo: r8,
    createComponent: _D,
    use(N, $, I) {
      return Vi(() => N($, I));
    },
  };
}
function o8(u) {
  const n = s8(u);
  return ((n.mergeProps = qT), n);
}
Object.defineProperty(Do.prototype, "preserve", {
  get() {
    return this._queueDelete === 0;
  },
  set(u) {
    this._queueDelete = u ? 0 : void 0;
  },
});
let lT = [];
function a8() {
  for (let u of lT) (Number(u._queueDelete) < 0 && u.destroy(), (u._queueDelete = void 0));
  lT.length = 0;
}
function r_(u, n) {
  u._queueDelete === void 0
    ? ((u._queueDelete = n), lT.push(u) === 1 && queueMicrotask(a8))
    : (u._queueDelete += n);
}
const MD = {
    createElement(u) {
      return new Do(u);
    },
    createTextNode(u) {
      return { _type: iu.Text, text: u };
    },
    replaceText(u, n) {
      (lx("Replace Text: ", u, n), (u.text = n));
      const i = u.parent;
      i.text = i.getText();
    },
    setProperty(u, n, i = !0) {
      u[n] = i;
    },
    insertNode(u, n, i) {
      lx("INSERT: ", u, n, i);
      let o = n.parent;
      (u.insertChild(n, i),
        n instanceof Do
          ? (n.parent.rendered && n.render(!0), o !== void 0 && r_(n, 1))
          : sd(u) && (u.text = u.getText()));
    },
    isTextNode(u) {
      return sd(u);
    },
    removeNode(u, n) {
      (lx("REMOVE: ", u, n), u.removeChild(n), n instanceof Do ? r_(n, -1) : sd(u) && (u.text = u.getText()));
    },
    getParentNode(u) {
      return u.parent;
    },
    getFirstChild(u) {
      return u.children[0];
    },
    getNextSibling(u) {
      const n = u.parent.children || [],
        i = n.indexOf(u) + 1;
      if (i < n.length) return n[i];
    },
  },
  PD = o8(MD);
let $p;
const cg = MD.createElement("App"),
  l8 = function (u) {
    return PD.render(u, cg);
  };
function u8(u, n) {
  const i = Pn.rendererOptions;
  return (
    ($p = I5(i, "app")),
    (Pn.setActiveElement = DD),
    (cg.lng = $p.root),
    (cg.rendered = !0),
    $p.on("idle", () => {
      ((QT = !0), ND());
    }),
    { renderer: $p, rootNode: cg, render: l8 }
  );
}
const { memo: OD, createComponent: Ae, createElement: Nd, spread: Fd, setProp: Yc, mergeProps: Ud } = PD,
  s_ = [];
let QT = !1;
ko(() => {
  Kr(() => {
    (bD(), (QT = !1));
  });
});
function ND() {
  QT &&
    s_.length &&
    setTimeout(() => {
      const u = s_.shift();
      u && (u(), ND());
    }, Pn.taskDelay || 50);
}
const pt = u => {
    const n = Nd("node");
    return (Fd(n, u, !1), n);
  },
  Gn = u => {
    const n = Nd("text");
    return (Fd(n, u, !1), n);
  };
const c8 = !1;
function FD() {
  let u = new Set();
  function n(l) {
    return (u.add(l), () => u.delete(l));
  }
  let i = !1;
  function o(l, h) {
    if (i) return !(i = !1);
    const p = { to: l, options: h, defaultPrevented: !1, preventDefault: () => (p.defaultPrevented = !0) };
    for (const d of u)
      d.listener({
        ...p,
        from: d.location,
        retry: y => {
          (y && (i = !0), d.navigate(l, { ...h, resolve: !1 }));
        },
      });
    return !p.defaultPrevented;
  }
  return { subscribe: n, confirm: o };
}
let uT;
function JT() {
  ((!window.history.state || window.history.state._depth == null) &&
    window.history.replaceState({ ...window.history.state, _depth: window.history.length - 1 }, ""),
    (uT = window.history.state._depth));
}
JT();
function d8(u) {
  return { ...u, _depth: window.history.state && window.history.state._depth };
}
function h8(u, n) {
  let i = !1;
  return () => {
    const o = uT;
    JT();
    const l = o == null ? null : uT - o;
    if (i) {
      i = !1;
      return;
    }
    l && n(l) ? ((i = !0), window.history.go(-l)) : u();
  };
}
const f8 = /^(?:[a-z0-9]+:)?\/\//i,
  p8 = /^\/+|(\/)\/+$/g,
  g8 = "http://sr";
function od(u, n = !1) {
  const i = u.replace(p8, "$1");
  return i ? (n || /^[?#]/.test(i) ? i : "/" + i) : "";
}
function dg(u, n, i) {
  if (f8.test(n)) return;
  const o = od(u),
    l = i && od(i);
  let h = "";
  return (
    !l || n.startsWith("/")
      ? (h = o)
      : l.toLowerCase().indexOf(o.toLowerCase()) !== 0
        ? (h = o + l)
        : (h = l),
    (h || "/") + od(n, !h)
  );
}
function m8(u, n) {
  if (u == null) throw new Error(n);
  return u;
}
function y8(u, n) {
  return od(u).replace(/\/*(\*.*)?$/g, "") + od(n);
}
function UD(u) {
  const n = {};
  return (
    u.searchParams.forEach((i, o) => {
      o in n ? (Array.isArray(n[o]) ? n[o].push(i) : (n[o] = [n[o], i])) : (n[o] = i);
    }),
    n
  );
}
function v8(u, n, i) {
  const [o, l] = u.split("/*", 2),
    h = o.split("/").filter(Boolean),
    p = h.length;
  return d => {
    const y = d.split("/").filter(Boolean),
      v = y.length - p;
    if (v < 0 || (v > 0 && l === void 0 && !n)) return null;
    const T = { path: p ? "" : "/", params: {} },
      S = w => (i === void 0 ? void 0 : i[w]);
    for (let w = 0; w < p; w++) {
      const C = h[w],
        L = C[0] === ":",
        k = L ? y[w] : y[w].toLowerCase(),
        O = L ? C.slice(1) : C.toLowerCase();
      if (L && gx(k, S(O))) T.params[O] = k;
      else if (L || !gx(k, O)) return null;
      T.path += "/".concat(k);
    }
    if (l) {
      const w = v ? y.slice(-v).join("/") : "";
      if (gx(w, S(l))) T.params[l] = w;
      else return null;
    }
    return T;
  };
}
function gx(u, n) {
  const i = o => o === u;
  return n === void 0
    ? !0
    : typeof n == "string"
      ? i(n)
      : typeof n == "function"
        ? n(u)
        : Array.isArray(n)
          ? n.some(i)
          : n instanceof RegExp
            ? n.test(u)
            : !1;
}
function x8(u) {
  const [n, i] = u.pattern.split("/*", 2),
    o = n.split("/").filter(Boolean);
  return o.reduce((l, h) => l + (h.startsWith(":") ? 2 : 3), o.length - (i === void 0 ? 0 : 1));
}
function BD(u) {
  const n = new Map(),
    i = wa();
  return new Proxy(
    {},
    {
      get(o, l) {
        return (
          n.has(l) ||
            fu(i, () =>
              n.set(
                l,
                jn(() => u()[l]),
              ),
            ),
          n.get(l)()
        );
      },
      getOwnPropertyDescriptor() {
        return { enumerable: !0, configurable: !0 };
      },
      ownKeys() {
        return Reflect.ownKeys(u());
      },
      has(o, l) {
        return l in u();
      },
    },
  );
}
function $D(u) {
  let n = /(\/?\:[^\/]+)\?/.exec(u);
  if (!n) return [u];
  let i = u.slice(0, n.index),
    o = u.slice(n.index + n[0].length);
  const l = [i, (i += n[1])];
  for (; (n = /^(\/\:[^\/]+)\?/.exec(o)); ) (l.push((i += n[1])), (o = o.slice(n[0].length)));
  return $D(o).reduce((h, p) => [...h, ...l.map(d => d + p)], []);
}
const T8 = 100,
  GD = zT(),
  jD = zT(),
  ZT = () => m8(ID(GD), "<A> and 'use' router primitives can be only used inside a Route."),
  Ra = () => ZT().navigatorFactory(),
  S8 = () => ZT().location,
  E8 = () => ZT().params;
function A8(u, n = "") {
  const { component: i, preload: o, load: l, children: h, info: p } = u,
    d = !h || (Array.isArray(h) && !h.length),
    y = { key: u, component: i, preload: o || l, info: p };
  return VD(u.path).reduce((v, T) => {
    for (const S of $D(T)) {
      const w = y8(n, S);
      let C = d ? w : w.split("/*", 1)[0];
      ((C = C.split("/")
        .map(L => (L.startsWith(":") || L.startsWith("*") ? L : encodeURIComponent(L)))
        .join("/")),
        v.push({ ...y, originalPath: T, pattern: C, matcher: v8(C, !d, u.matchFilters) }));
    }
    return v;
  }, []);
}
function I8(u, n = 0) {
  return {
    routes: u,
    score: x8(u[u.length - 1]) * 1e4 - n,
    matcher(i) {
      const o = [];
      for (let l = u.length - 1; l >= 0; l--) {
        const h = u[l],
          p = h.matcher(i);
        if (!p) return null;
        o.unshift({ ...p, route: h });
      }
      return o;
    },
  };
}
function VD(u) {
  return Array.isArray(u) ? u : [u];
}
function HD(u, n = "", i = [], o = []) {
  const l = VD(u);
  for (let h = 0, p = l.length; h < p; h++) {
    const d = l[h];
    if (d && typeof d == "object") {
      d.hasOwnProperty("path") || (d.path = "");
      const y = A8(d, n);
      for (const v of y) {
        i.push(v);
        const T = Array.isArray(d.children) && d.children.length === 0;
        if (d.children && !T) HD(d.children, v.pattern, i, o);
        else {
          const S = I8([...i], o.length);
          o.push(S);
        }
        i.pop();
      }
    }
  }
  return i.length ? o : o.sort((h, p) => p.score - h.score);
}
function mx(u, n) {
  for (let i = 0, o = u.length; i < o; i++) {
    const l = u[i].matcher(n);
    if (l) return l;
  }
  return [];
}
function w8(u, n, i) {
  const o = new URL(g8),
    l = jn(
      T => {
        const S = u();
        try {
          return new URL(S, o);
        } catch (w) {
          return (console.error("Invalid path ".concat(S)), T);
        }
      },
      o,
      { equals: (T, S) => T.href === S.href },
    ),
    h = jn(() => l().pathname),
    p = jn(() => l().search, !0),
    d = jn(() => l().hash),
    y = () => "",
    v = Od(p, () => UD(l()));
  return {
    get pathname() {
      return h();
    },
    get search() {
      return p();
    },
    get hash() {
      return d();
    },
    get state() {
      return n();
    },
    get key() {
      return y();
    },
    query: i ? i(v) : BD(v),
  };
}
let va;
function R8() {
  return va;
}
function C8(u, n, i, o = {}) {
  const {
      signal: [l, h],
      utils: p = {},
    } = u,
    d = p.parsePath || (ae => ae),
    y = p.renderPath || (ae => ae),
    v = p.beforeLeave || FD(),
    T = dg("", o.base || "");
  if (T === void 0) throw new Error("".concat(T, " is not a valid base path"));
  T && !l().value && h({ value: T, replace: !0, scroll: !1 });
  const [S, w] = en(!1);
  let C;
  const L = (ae, ye) => {
      (ye.value === k() && ye.state === B()) ||
        (C === void 0 && w(!0),
        (va = ae),
        (C = ye),
        W5(() => {
          C === ye && (O(C.value), N(C.state), V[1](ve => ve.filter(we => we.pending)));
        }).finally(() => {
          C === ye &&
            K5(() => {
              ((va = void 0), ae === "navigate" && ce(C), w(!1), (C = void 0));
            });
        }));
    },
    [k, O] = en(l().value),
    [B, N] = en(l().state),
    $ = w8(k, B, p.queryWrapper),
    I = [],
    V = en([]),
    oe = jn(() =>
      typeof o.transformUrl == "function" ? mx(n(), o.transformUrl($.pathname)) : mx(n(), $.pathname),
    ),
    Y = () => {
      const ae = oe(),
        ye = {};
      for (let ve = 0; ve < ae.length; ve++) Object.assign(ye, ae[ve].params);
      return ye;
    },
    te = p.paramsWrapper ? p.paramsWrapper(Y, n) : BD(Y),
    _ = {
      pattern: T,
      path: () => T,
      outlet: () => null,
      resolvePath(ae) {
        return dg(T, ae);
      },
    };
  return (
    Kr(Od(l, ae => L("native", ae), { defer: !0 })),
    {
      base: _,
      location: $,
      params: te,
      isRouting: S,
      renderPath: y,
      parsePath: d,
      navigatorFactory: q,
      matches: oe,
      beforeLeave: v,
      preloadRoute: he,
      singleFlight: o.singleFlight === void 0 ? !0 : o.singleFlight,
      submissions: V,
    }
  );
  function K(ae, ye, ve) {
    Vi(() => {
      if (typeof ye == "number") {
        ye && (p.go ? p.go(ye) : console.warn("Router integration does not support relative routing"));
        return;
      }
      const we = !ye || ye[0] === "?",
        {
          replace: Le,
          resolve: ke,
          scroll: Ne,
          state: Re,
        } = { replace: !1, resolve: !we, scroll: !0, ...ve },
        Ce = ke ? ae.resolvePath(ye) : dg((we && $.pathname) || "", ye);
      if (Ce === void 0) throw new Error("Path '".concat(ye, "' is not a routable path"));
      if (I.length >= T8) throw new Error("Too many redirects");
      const W = k();
      (Ce !== W || Re !== B()) &&
        (c8 ||
          (v.confirm(Ce, ve) &&
            (I.push({ value: W, replace: Le, scroll: Ne, state: B() }),
            L("navigate", { value: Ce, state: Re }))));
    });
  }
  function q(ae) {
    return ((ae = ae || ID(jD) || _), (ye, ve) => K(ae, ye, ve));
  }
  function ce(ae) {
    const ye = I[0];
    ye && (h({ ...ae, replace: ye.replace, scroll: ye.scroll }), (I.length = 0));
  }
  function he(ae, ye) {
    const ve = mx(n(), ae.pathname),
      we = va;
    va = "preload";
    for (let Le in ve) {
      const { route: ke, params: Ne } = ve[Le];
      ke.component && ke.component.preload && ke.component.preload();
      const { preload: Re } = ke;
      ye &&
        Re &&
        fu(i(), () =>
          Re({
            params: Ne,
            location: {
              pathname: ae.pathname,
              search: ae.search,
              hash: ae.hash,
              query: UD(ae),
              state: null,
              key: "",
            },
            intent: "preload",
          }),
        );
    }
    va = we;
  }
}
function L8(u, n, i, o) {
  const { base: l, location: h, params: p } = u,
    { pattern: d, component: y, preload: v } = o().route,
    T = jn(() => o().path);
  y && y.preload && y.preload();
  const S = v ? v({ params: p, location: h, intent: va || "initial" }) : void 0;
  return {
    parent: n,
    pattern: d,
    path: T,
    outlet: () =>
      y
        ? _D(y, {
            params: p,
            location: h,
            data: S,
            get children() {
              return i();
            },
          })
        : i(),
    resolvePath(C) {
      return dg(l.path(), C, T());
    },
  };
}
const _8 = u => n => {
  const { base: i } = n,
    o = YT(() => n.children),
    l = jn(() => HD(o(), n.base || ""));
  let h;
  const p = C8(u, l, () => h, { base: i, singleFlight: n.singleFlight, transformUrl: n.transformUrl });
  return (
    u.create && u.create(p),
    Ae(GD.Provider, {
      value: p,
      get children() {
        return Ae(b8, {
          routerState: p,
          get root() {
            return n.root;
          },
          get preload() {
            return n.rootPreload || n.rootLoad;
          },
          get children() {
            return [
              OD(() => (h = wa()) && null),
              Ae(D8, {
                routerState: p,
                get branches() {
                  return l();
                },
              }),
            ];
          },
        });
      },
    })
  );
};
function b8(u) {
  const n = u.routerState.location,
    i = u.routerState.params,
    o = jn(
      () =>
        u.preload &&
        Vi(() => {
          u.preload({ params: i, location: n, intent: R8() || "initial" });
        }),
    );
  return Ae(gu, {
    get when() {
      return u.root;
    },
    keyed: !0,
    get fallback() {
      return u.children;
    },
    children: l =>
      Ae(l, {
        params: i,
        location: n,
        get data() {
          return o();
        },
        get children() {
          return u.children;
        },
      }),
  });
}
function D8(u) {
  const n = [];
  let i;
  const o = jn(
    Od(u.routerState.matches, (l, h, p) => {
      let d = h && l.length === h.length;
      const y = [];
      for (let v = 0, T = l.length; v < T; v++) {
        const S = h && h[v],
          w = l[v];
        p && S && w.route.key === S.route.key
          ? (y[v] = p[v])
          : ((d = !1),
            n[v] && n[v](),
            ko(C => {
              ((n[v] = C),
                (y[v] = L8(
                  u.routerState,
                  y[v - 1] || u.routerState.base,
                  o_(() => o()[v + 1]),
                  () => {
                    var k;
                    const L = u.routerState.matches();
                    return (k = L[v]) != null ? k : L[0];
                  },
                )));
            }));
      }
      return (n.splice(l.length).forEach(v => v()), p && d ? p : ((i = y[0]), y));
    }),
  );
  return o_(() => o() && i)();
}
const o_ = u => () =>
    Ae(gu, {
      get when() {
        return u();
      },
      keyed: !0,
      children: n =>
        Ae(jD.Provider, {
          value: n,
          get children() {
            return n.outlet();
          },
        }),
    }),
  hg = u => {
    const n = YT(() => u.children);
    return qT(u, {
      get children() {
        return n();
      },
    });
  };
function k8([u, n], i, o) {
  return [u, o ? l => n(o(l)) : n];
}
function M8(u) {
  let n = !1;
  const i = l => (typeof l == "string" ? { value: l } : l),
    o = k8(
      en(i(u.get()), { equals: (l, h) => l.value === h.value && l.state === h.state }),
      void 0,
      l => (!n && u.set(l), l),
    );
  return (
    u.init &&
      hu(
        u.init((l = u.get()) => {
          ((n = !0), o[1](i(l)), (n = !1));
        }),
      ),
    _8({ signal: o, create: u.create, utils: u.utils })
  );
}
const [KD, P8] = en([]),
  O8 = (u, n) => {
    const i = wa(),
      o = fu.bind(void 0, i);
    Pn.setActiveElement = p => o(() => DD(p));
    const { cleanup: l, focusPath: h } = P5({ userKeyMap: u, keyHoldOptions: n, ownerContext: o });
    (Pd(
      Od(
        bD,
        () => {
          P8([...h()]);
        },
        { defer: !0 },
      ),
    ),
      hu(l));
  },
  bg = "aria-parent";
let Dg = [];
function N8(u = []) {
  const n = [];
  let i;
  for (i = 0; i < u.length; i++) {
    const o = u[i];
    if (typeof o == "string" && !o.includes("PAUSE-")) n.push(u[i]);
    else break;
  }
  return [n.join(",\b ")].concat(u.slice(i));
}
function yx(u) {
  return new Promise(n => {
    setTimeout(n, u);
  });
}
function a_(u) {
  var n;
  ((n = u == null ? void 0 : u.text) == null ? void 0 : n.trim().length) !== 0 && Dg.push(u);
}
function F8() {
  const u = YD();
  if (!u) {
    console.error("ARIA div not found: ".concat(bg));
    return;
  }
  for (const n of Dg) {
    const i = document.createElement("span");
    (i.setAttribute("lang", n.lang), i.setAttribute("aria-label", n.text), u.appendChild(i));
  }
  setTimeout(() => {
    ((Dg = []), WD(), zD());
  }, 100);
}
function WD() {
  const u = document.getElementById(bg);
  if (u) for (; u.firstChild; ) u.removeChild(u.firstChild);
}
function zD() {
  var n;
  const u = (n = document.getElementById("app")) == null ? void 0 : n.firstChild;
  u == null || u.focus();
}
function YD() {
  const u = document.getElementById(bg);
  if (!u) {
    const n = document.createElement("div");
    return (
      n.setAttribute("id", bg),
      n.setAttribute("aria-live", "assertive"),
      n.setAttribute("tabindex", "0"),
      document.body.appendChild(n),
      n
    );
  }
  return u;
}
function l_(u, n, i = "en-US", o) {
  const l = window.speechSynthesis;
  return new Promise((h, p) => {
    let d;
    if (o) {
      const v = l.getVoices();
      d = v.find(T => T.name === o) || v[0];
    }
    const y = new SpeechSynthesisUtterance(u);
    ((y.lang = i),
      d && (y.voice = d),
      (y.onend = () => {
        h();
      }),
      (y.onerror = v => {
        p(v);
      }),
      n.push(y),
      l.speak(y));
  });
}
function cT(u, n, i, o, l = !0) {
  const h = window.speechSynthesis,
    p = N8(Array.isArray(u) ? u : [u]),
    d = [],
    y = [];
  let v = !0;
  return {
    series: (async () => {
      try {
        for (; v && p.length; ) {
          const S = await Promise.resolve(p.shift());
          if (!v) break;
          if (typeof S == "string" && S.includes("PAUSE-")) {
            const w = Number(S.split("PAUSE-")[1]) * 1e3;
            isNaN(w) || (await yx(w));
          } else if (typeof S == "string") {
            if (!S) continue;
            const w = 3;
            let C = w;
            for (; v && C > 0; )
              try {
                (n ? a_({ text: S, lang: i }) : await l_(S, y, i, o), (C = 0));
              } catch (L) {
                if (L instanceof SpeechSynthesisErrorEvent)
                  if (L.error === "network")
                    (C--,
                      console.warn("Speech synthesis network error. Retries left: ".concat(C)),
                      await yx(500 * (w - C)));
                  else if (L.error === "canceled" || L.error === "interrupted") C = 0;
                  else throw new Error("SpeechSynthesisErrorEvent: ".concat(L.error));
                else throw L;
              }
          } else if (S instanceof SpeechSynthesisUtterance) {
            let C = 3;
            const L = S.text,
              k = S == null ? void 0 : S.lang,
              O = S == null ? void 0 : S.voice;
            for (; v && C > 0; )
              try {
                L && (n ? a_({ text: L, lang: k }) : await l_(L, y, k, O == null ? void 0 : O.name), (C = 0));
              } catch (B) {
                if (B instanceof SpeechSynthesisErrorEvent)
                  if (B.error === "network")
                    (C--,
                      console.warn("Speech synthesis network error. Retries left: ".concat(C)),
                      await yx(500 * (3 - C)));
                  else if (B.error === "canceled" || B.error === "interrupted") C = 0;
                  else throw new Error("SpeechSynthesisErrorEvent: ".concat(B.error));
                else throw B;
              }
          } else if (typeof S == "function") {
            const w = cT(S(), n, i, o, !1);
            (d.push(w), await w.series);
          } else if (Array.isArray(S)) {
            const w = cT(S, n, i, o, !1);
            (d.push(w), await w.series);
          }
        }
      } finally {
        ((v = !1), l && n && F8());
      }
    })(),
    get active() {
      return v;
    },
    append: S => {
      p.push(S);
    },
    cancel: () => {
      if (v) {
        if (l) {
          if (n) {
            const S = YD();
            S && ((Dg = []), WD(), S.focus(), zD());
            return;
          }
          h.cancel();
        }
        (d.forEach(S => {
          S.cancel();
        }),
          (v = !1));
      }
    },
  };
}
let Gp;
function U8(u, n, i = "en-US", o) {
  return (Gp && Gp.cancel(), (Gp = cT(u, n, i, o)), Gp);
}
const dT = (u, n) => {
  let i;
  const o = () => clearTimeout(i);
  return (
    wa() && hu(o),
    Object.assign(
      (...h) => {
        (i !== void 0 && o(), (i = setTimeout(() => u(...h), n)));
      },
      { clear: o },
    )
  );
};
let hT,
  ad = [],
  ss,
  fT = !1;
const B8 = 3e5;
function u_(u, n) {
  const i = dT(u, n);
  let o;
  const l = h => {
    ((o = h), i(h));
  };
  return (
    (l.flush = () => {
      (i.clear(), u(o));
    }),
    (l.clear = i.clear),
    l
  );
}
function Xc(u) {
  return u.id || u.name;
}
function $8(u = []) {
  if (!Mn.onFocusChange || !Mn.enabled) return;
  const n = u.every(h => !h.loading),
    i = u.filter(h => !ad.includes(h));
  if ((hT(), !n && Mn.onFocusChange)) {
    Mn.onFocusChange([]);
    return;
  }
  ad = u.slice(0);
  const o = [],
    l = i
      .reverse()
      .reduce(
        (h, p) => (
          p.announce
            ? (h.push([Xc(p), "Announce", p.announce]), o.push(p.announce))
            : p.title
              ? (h.push([Xc(p), "Title", p.title]), o.push(p.title))
              : h.push([Xc(p), "No Announce", ""]),
          h
        ),
        [],
      );
  if (
    (i
      .reverse()
      .reduce(
        (h, p) => (
          p.announceContext
            ? (h.push([Xc(p), "Context", p.announceContext]), o.push(p.announceContext))
            : h.push([Xc(p), "No Context", ""]),
          h
        ),
        l,
      ),
    Mn.debug && console.table(l),
    o.length)
  )
    return Mn.speak(o.reduce((h, p) => h.concat(p), []));
}
function G8(u, n, i, o) {
  if (!fT) return (ss = U8(u, n, i, o));
}
const Mn = {
  debug: !1,
  enabled: !0,
  lang: "en-US",
  aria: !1,
  cancel: function () {
    ss && ss.cancel();
  },
  clearPrevFocus: function (u = 0) {
    ((ad = ad.slice(0, u)), hT());
  },
  speak: function (u, { append: n = !1, notification: i = !1 } = {}) {
    return (
      Mn.onFocusChange &&
        Mn.enabled &&
        (n && ss && ss.active ? ss.append(u) : (Mn.cancel(), G8(u, Mn.aria, Mn.lang, Mn.voice)),
        i &&
          ((fT = !0),
          ss == null ||
            ss.series
              .finally(() => {
                ((fT = !1), Mn.refresh());
              })
              .catch(console.error))),
      ss
    );
  },
  refresh: function (u = 0) {
    (Mn.clearPrevFocus(u), Mn.onFocusChange && Mn.onFocusChange(Vi(() => KD())));
  },
  setupTimers: function ({ focusDebounce: u = 400, focusChangeTimeout: n = B8 } = {}) {
    ((Mn.onFocusChange = u_($8, u)),
      (hT = u_(() => {
        ad = [];
      }, n)));
  },
};
let c_ = !1;
const j8 = u => (c_ || ((c_ = !0), Mn.setupTimers(u), Pd(Od(KD, Mn.onFocusChange, { defer: !0 }))), Mn);
function V8(u) {
  const n = u.replace(/^.*?#/, "");
  if (!n.startsWith("/")) {
    const [, i = "/"] = window.location.hash.split("#", 2);
    return "".concat(i, "#").concat(n);
  }
  return n;
}
function H8(u, n, i) {
  return (u.addEventListener(n, i), () => u.removeEventListener(n, i));
}
function K8(u) {
  const n = () => window.location.hash.slice(1),
    i = FD();
  return M8({
    get: n,
    set({ value: o, replace: l, state: h }) {
      (l ? window.history.replaceState(d8(h), "", "#" + o) : window.history.pushState(h, "", "#" + o), JT());
    },
    init: o =>
      H8(
        window,
        "hashchange",
        h8(o, l => !i.confirm(l && l < 0 ? l : n())),
      ),
    utils: {
      go: o => window.history.go(o),
      renderPath: o => "#".concat(o),
      parsePath: V8,
      beforeLeave: i,
      queryWrapper: u.forceProxy || !d_ ? o => h_(o, u.queryParams) : void 0,
      paramsWrapper: u.forceProxy || !d_ ? (o, l) => h_(o, W8(l())) : void 0,
    },
  })(u);
}
const d_ = typeof Proxy == "function";
function h_(u, n) {
  const i = new Map(),
    o = wa(),
    l = {},
    h = d => (
      i.has(d) ||
        fu(o, () =>
          i.set(
            d,
            jn(() => u()[d]),
          ),
        ),
      i.get(d)()
    );
  return (
    (n || Object.keys(u())).forEach(d => {
      Object.defineProperty(l, d, { get: () => h(d), enumerable: !0, configurable: !0 });
    }),
    l
  );
}
const W8 = u => {
  const n = [];
  return (
    u.forEach(i => {
      i.routes.forEach(o => {
        if (o.pattern) {
          const l = o.pattern.match(/:(\w+)/g);
          l &&
            l.forEach(h => {
              const p = h.slice(1);
              n.includes(p) || n.push(p);
            });
        }
      });
    }),
    n
  );
};
function eS(u, n) {
  return u === 0 || (u >= 0 && u < n.length);
}
function XD(u, n = 0, i = 1) {
  var o;
  for (let l = n; ; l += i) {
    if (!eS(l, u.children))
      if (u.wrap) l = (l + u.children.length) % u.children.length;
      else break;
    if (!((o = u.children[l]) != null && o.skipFocus)) return l;
  }
  return -1;
}
function qD(u, n) {
  var l;
  const i = u.children[n];
  if (i == null || i.skipFocus) return ((u.selected = -1), !1);
  const o = u.selected;
  return (
    (u.selected = n),
    TD(i) || i.setFocus(),
    (l = u.onSelectedChanged) == null || l.call(u, n, u, i, o),
    !0
  );
}
const QD = function () {
  const u = this;
  let n = u.selected;
  if (n !== 0) for (n = i8(n, 0, this.children.length - 1); !eS(n, this.children); ) n--;
  return ((n = XD(u, n)), (u.selected = n), qD(u, n));
};
function Jg(u) {
  return function () {
    return z8(this, u === "up" || u === "left" ? -1 : 1);
  };
}
function z8(u, n) {
  var l;
  let i = XD(u, u.selected + n, n);
  if (i === -1) {
    if (
      !eS(u.selected, u.children) ||
      ((l = u.children[u.selected]) != null && l.skipFocus) ||
      TD(u.children[u.selected])
    )
      return !1;
    i = u.selected;
  }
  const o = u.children[i];
  if (u.plinko) {
    const p = u.children[u.selected].selected || 0;
    o.selected = p < o.children.length ? p : o.children.length - 1;
  }
  return qD(u, i);
}
const Y8 = 8,
  f_ = u => u.lng.renderState !== Y8;
function JD(u) {
  const n = u ? "width" : "height",
    i = u ? "x" : "y";
  return (o, l, h, p) => {
    var K, q, ce, he, ae, ye, ve, we, Le, ke, Ne, Re, Ce;
    let d = l;
    if (
      (typeof o != "number" && ((d = o), (o = d.selected || 0)),
      !d || d.scroll === "none" || o === p || !d.children.length)
    )
      return;
    d._initialPosition === void 0 && (d._initialPosition = d[i]);
    const y = d.lng,
      v = u ? y.stage.root.width : y.stage.root.height,
      T = p === void 0 || p - 1 !== o;
    if (d._screenOffset === void 0) {
      if (d.parent.clipping) {
        const W = d.parent;
        d.endOffset = (K = d.endOffset) != null ? K : v - ((u ? W.absX : W.absY) || 0) - W[n];
      }
      d._screenOffset = (q = d.offset) != null ? q : (u ? y.absX : y.absY) - d[i];
    }
    const S = d._screenOffset,
      w = d.gap || 0,
      C = d.scroll || (p === void 0 ? (d.scrollIndex ? "center" : "always") : "auto"),
      L = (ce = d._targetPosition) != null ? ce : d[i],
      k = T ? Math.min(L, d[i]) : Math.max(L, d[i]);
    d.offset = (he = d.offset) != null ? he : k;
    const O = d.offset;
    if (((h = h || d.children[o]), !h)) return;
    const B = (ae = h[i]) != null ? ae : 0,
      N = (ye = h[n]) != null ? ye : 0,
      $ =
        (ke =
          (Le = h.scale) != null
            ? Le
            : (we = (ve = h.style) == null ? void 0 : ve.focus) == null
              ? void 0
              : we.scale) != null
          ? ke
          : 1,
      I = N * $,
      V = (Ne = d[n]) != null ? Ne : 0,
      oe = Math.min(v - V - S - ((Re = d.endOffset) != null ? Re : 2 * w), O),
      Y = T ? o + 1 : o - 1,
      te = d.children[Y] || null;
    let _ = k;
    if (h.centerScroll) _ = -B + (v - I) / 2;
    else if (C === "always") _ = -B + O;
    else if (C === "bounded") {
      const W = d.children.length,
        Qe = d.upCount || 6,
        ot = Math.max(0, W - Qe),
        Je = o >= ot,
        Ut = o === ot,
        St = Ut && p !== void 0 && p < ot;
      if (!Je) _ = -B + O;
      else if (T)
        if (St) {
          const Xt = d.children[ot],
            vn = (Ce = Xt == null ? void 0 : Xt[i]) != null ? Ce : 0;
          _ = Xt ? -vn + O : k;
        } else _ = k;
      else Ut ? (_ = -B + O) : (_ = k);
    } else if (C === "center") {
      const W = -B + (v - I) / 2 - S;
      _ = Math.min(Math.max(W, oe), O);
    } else if (!te) _ = T ? oe : O;
    else if (C === "auto")
      if (d.scrollIndex && d.scrollIndex > 0) {
        const Qe = d.children.length - d.scrollIndex;
        T && d.selected >= d.scrollIndex ? (_ = k - N - w) : !T && d.selected < Qe && (_ = k + N + w);
      } else T ? (_ = k - N - w) : (_ = k + N + w);
    else T && f_(te) ? (_ = k - N - w) : f_(te) && (_ = -B + O);
    if (((_ = T && C !== "always" && C !== "bounded" ? Math.max(_, oe) : Math.min(_, O)), d[i] !== _)) {
      if (d.onScrolled) {
        const W = _ === d._initialPosition;
        d.onScrolled(d, _, W);
      }
      ((d[i] = _), (d._targetPosition = _));
    }
  };
}
const pT = JD(!0),
  gT = JD(!1);
function bo(...u) {
  const n = u.filter(i => typeof i == "function");
  if (n.length !== 0)
    return n.length === 1
      ? n[0]
      : function (...i) {
          let o;
          for (const l of n) if (((o = l.apply(this, i)), o === !0)) return o;
          return o;
        };
}
const X8 = {
  display: "flex",
  flexDirection: "column",
  gap: 30,
  transition: { y: { duration: 250, easing: "ease-in-out" } },
};
function q8(u) {
  var n;
  ((this.selected = u), gT(u, this), (n = this.children[u]) == null || n.setFocus());
}
const Q8 = Jg("up"),
  J8 = Jg("down"),
  kg = u =>
    (() => {
      var n = Nd("view");
      return (
        Fd(
          n,
          Ud(u, {
            onUp: bo(u.onUp, Q8),
            onDown: bo(u.onDown, J8),
            get selected() {
              return u.selected || 0;
            },
            scrollToIndex: q8,
            forwardFocus: QD,
            onLayout: u.selected ? bo(u.onLayout, gT) : u.onLayout,
            onSelectedChanged: bo(u.onSelectedChanged, u.scroll !== "none" ? gT : void 0),
            style: kD(u.style, X8),
          }),
          !1,
        ),
        n
      );
    })(),
  Z8 = { display: "flex", gap: 30, transition: { x: { duration: 250, easing: "ease-in-out" } } };
function eG(u) {
  var n;
  ((this.selected = u), pT(u, this), (n = this.children[u]) == null || n.setFocus());
}
const tG = Jg("left"),
  nG = Jg("right"),
  Id = u =>
    (() => {
      var n = Nd("view");
      return (
        Fd(
          n,
          Ud(u, {
            get selected() {
              return u.selected || 0;
            },
            onLeft: bo(u.onLeft, tG),
            onRight: bo(u.onRight, nG),
            forwardFocus: QD,
            scrollToIndex: eG,
            onLayout: u.selected ? bo(u.onLayout, pT) : u.onLayout,
            onSelectedChanged: bo(u.onSelectedChanged, u.scroll !== "none" ? pT : void 0),
            style: kD(u.style, Z8),
          }),
          !1,
        ),
        n
      );
    })(),
  iG = zT(void 0);
function rG(u) {
  const [n, i] = en([]);
  function o(p, d) {
    const y = d || p;
    y && i(v => [...v, y]);
  }
  function l() {
    let p = !1;
    return (
      i(d => {
        const y = d.pop();
        return (y && typeof y.setFocus == "function" && (y.setFocus(), (p = !0)), [...d]);
      }),
      p
    );
  }
  function h() {
    i([]);
  }
  return Ae(iG.Provider, {
    value: { storeFocus: o, restoreFocus: l, clearFocusStack: h },
    get children() {
      return u.children;
    },
  });
}
const Po = new Map(),
  ZD = u =>
    Po.has(u.id)
      ? (console.warn('[KeepAlive] Element with id "'.concat(u.id, '" already in cache. Recreating.')), u)
      : (Po.set(u.id, u), u),
  ek = u => {
    const n = Po.get(u);
    n && (n.dispose(), Po.delete(u));
  };
function p_(u) {
  const n =
      u.onRemove ||
      (l => {
        l.alpha = 0;
      }),
    i =
      u.onRender ||
      (l => {
        l.alpha = 1;
      }),
    o = u.transition || { alpha: !0 };
  return (() => {
    var l = Nd("view");
    return (
      Yc(l, "preserve", !0),
      Yc(l, "onRemove", n),
      Yc(l, "onRender", i),
      Yc(l, "forwardFocus", 0),
      Yc(l, "transition", o),
      Fd(l, u, !1),
      l
    );
  })();
}
const sG = u => {
    var i;
    let n = Po.get(u.id);
    if (
      (n && (i = u.shouldDispose) != null && i.call(u, u.id) && (n.dispose(), Po.delete(u.id), (n = void 0)),
      n)
    )
      n && !n.children && (n.children = fu(n.owner, () => p_(u)));
    else
      return ko(o => {
        const l = p_(u);
        return (ZD({ id: u.id, owner: wa(), children: l, dispose: o }), l);
      });
    return n.children;
  },
  vx = u => {
    const n = u.id || u.path,
      i = u.preload
        ? o => {
            var h, p;
            let l = Po.get(n);
            if (
              (l &&
                (h = u.shouldDispose) != null &&
                h.call(u, n) &&
                (l.dispose(), Po.delete(n), (l = void 0)),
              l)
            )
              l.children && ((p = l.children) == null || p.setFocus());
            else return ko(d => (ZD({ id: n, owner: wa(), dispose: d, children: null }), u.preload(o)));
          }
        : void 0;
    return Ae(
      hg,
      Ud(u, {
        preload: i,
        component: o =>
          Ae(sG, {
            id: n,
            get onRemove() {
              return u.onRemove;
            },
            get onRender() {
              return u.onRender;
            },
            get transition() {
              return u.transition;
            },
            get children() {
              return u.component(o);
            },
          }),
      }),
    );
  },
  [oG, ru] = en(""),
  [aG, g_] = en(""),
  [lG, m_] = en(""),
  [xx, ld] = en(1920),
  [Tx, ud] = en(1080),
  [cY, dY] = en(!1),
  [y_, uG] = en(null),
  [mT, cG] = en(null),
  [dG, v_] = en(0),
  [hG, x_] = en(!1),
  [fG, Zg] = en(!1),
  pG = () => {
    let u,
      n,
      i = 0,
      o = null;
    const l = { duration: 600, easing: "ease-in-out" };
    let h = null,
      p = null;
    return (
      Pd(() => {
        if (hG()) return;
        const d = oG();
        if (!d || d === o) return;
        o = d;
        const y = i === 1 ? n : u,
          v = i === 1 ? u : n;
        ((v.src = d),
          (v.alpha = 0.01),
          h && h.stop(),
          p && p.stop(),
          (p = v.animate({ alpha: 1 }, l)),
          p.start(),
          (h = y.animate({ alpha: 0 }, l)),
          h.start(),
          (i = i === 1 ? 2 : 1));
      }),
      hu(() => {
        (h.stop(), p.stop());
      }),
      Ae(pt, {
        get width() {
          return xx();
        },
        get height() {
          return Tx();
        },
        get children() {
          return [
            Ae(pt, {
              ref(d) {
                var y = u;
                typeof y == "function" ? y(d) : (u = d);
              },
              get width() {
                return xx();
              },
              get height() {
                return Tx();
              },
              alpha: 0,
            }),
            Ae(pt, {
              ref(d) {
                var y = n;
                typeof y == "function" ? y(d) : (n = d);
              },
              get width() {
                return xx();
              },
              get height() {
                return Tx();
              },
              alpha: 0,
            }),
          ];
        },
      })
    );
  },
  gG = u => {
    const n = Ra(),
      i = () => (n(-1), !0),
      o = S8(),
      l = j8();
    return (
      (l.debug = !1),
      (l.enabled = !1),
      Pd(() => {
        (uG(mT()), cG(o.pathname));
      }),
      Ae(pt, {
        ref(h) {
          var p = window.APP;
          typeof p == "function" ? p(h) : (window.APP = h);
        },
        onAnnouncer: () => (l.enabled = !l.enabled),
        onLast: () => history.back(),
        onBack: i,
        get children() {
          return [Ae(pG, {}), OD(() => u.children)];
        },
      })
    );
  },
  Dr = "static/",
  mG = [
    {
      type: "msdf",
      fontFamily: "Inter",
      descriptors: { weight: 400 },
      atlasDataUrl: Dr + "fonts/Inter_18pt-Regular.msdf.json",
      atlasUrl: Dr + "fonts/Inter_18pt-Regular.msdf.png",
    },
    {
      type: "msdf",
      fontFamily: "Inter",
      descriptors: { weight: 600 },
      atlasDataUrl: Dr + "fonts/Inter_18pt-SemiBold.msdf.json",
      atlasUrl: Dr + "fonts/Inter_18pt-SemiBold.msdf.png",
    },
    {
      type: "msdf",
      fontFamily: "Inter",
      descriptors: { weight: 700 },
      atlasDataUrl: Dr + "fonts/Inter_18pt-Bold.msdf.json",
      atlasUrl: Dr + "fonts/Inter_18pt-Bold.msdf.png",
    },
    {
      type: "msdf",
      fontFamily: "Roboto",
      descriptors: { weight: 700 },
      atlasDataUrl: Dr + "fonts/Roboto-Bold.msdf.json",
      atlasUrl: Dr + "fonts/Roboto-Bold.msdf.png",
    },
    {
      type: "msdf",
      fontFamily: "Roboto",
      descriptors: { weight: 400 },
      atlasDataUrl: Dr + "fonts/Roboto-Regular.msdf.json",
      atlasUrl: Dr + "fonts/Roboto-Regular.msdf.png",
    },
    {
      type: "msdf",
      fontFamily: "Arial",
      descriptors: { weight: 500 },
      atlasDataUrl: Dr + "fonts/Roboto-Regular.msdf.json",
      atlasUrl: Dr + "fonts/Roboto-Regular.msdf.png",
    },
  ];
var tk = typeof global == "object" && global && global.Object === Object && global,
  yG = typeof self == "object" && self && self.Object === Object && self,
  mu = tk || yG || Function("return this")(),
  Mg = mu.Symbol,
  nk = Object.prototype,
  vG = nk.hasOwnProperty,
  xG = nk.toString,
  qc = Mg ? Mg.toStringTag : void 0;
function TG(u) {
  var n = vG.call(u, qc),
    i = u[qc];
  try {
    u[qc] = void 0;
    var o = !0;
  } catch (h) {}
  var l = xG.call(u);
  return (o && (n ? (u[qc] = i) : delete u[qc]), l);
}
var SG = Object.prototype,
  EG = SG.toString;
function AG(u) {
  return EG.call(u);
}
var IG = "[object Null]",
  wG = "[object Undefined]",
  T_ = Mg ? Mg.toStringTag : void 0;
function em(u) {
  return u == null ? (u === void 0 ? wG : IG) : T_ && T_ in Object(u) ? TG(u) : AG(u);
}
function Bd(u) {
  return u != null && typeof u == "object";
}
var yT = Array.isArray;
function Ca(u) {
  var n = typeof u;
  return u != null && (n == "object" || n == "function");
}
function ik(u) {
  return u;
}
var RG = "[object AsyncFunction]",
  CG = "[object Function]",
  LG = "[object GeneratorFunction]",
  _G = "[object Proxy]";
function tS(u) {
  if (!Ca(u)) return !1;
  var n = em(u);
  return n == CG || n == LG || n == RG || n == _G;
}
var Sx = mu["__core-js_shared__"],
  S_ = (function () {
    var u = /[^.]+$/.exec((Sx && Sx.keys && Sx.keys.IE_PROTO) || "");
    return u ? "Symbol(src)_1." + u : "";
  })();
function bG(u) {
  return !!S_ && S_ in u;
}
var DG = Function.prototype,
  kG = DG.toString;
function MG(u) {
  if (u != null) {
    try {
      return kG.call(u);
    } catch (n) {}
    try {
      return u + "";
    } catch (n) {}
  }
  return "";
}
var PG = /[\\^$.*+?()[\]{}|]/g,
  OG = /^\[object .+?Constructor\]$/,
  NG = Function.prototype,
  FG = Object.prototype,
  UG = NG.toString,
  BG = FG.hasOwnProperty,
  $G = RegExp(
    "^" +
      UG.call(BG)
        .replace(PG, "\\$&")
        .replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g, "$1.*?") +
      "$",
  );
function GG(u) {
  if (!Ca(u) || bG(u)) return !1;
  var n = tS(u) ? $G : OG;
  return n.test(MG(u));
}
function jG(u, n) {
  return u == null ? void 0 : u[n];
}
function nS(u, n) {
  var i = jG(u, n);
  return GG(i) ? i : void 0;
}
var E_ = Object.create,
  VG = (function () {
    function u() {}
    return function (n) {
      if (!Ca(n)) return {};
      if (E_) return E_(n);
      u.prototype = n;
      var i = new u();
      return ((u.prototype = void 0), i);
    };
  })();
function HG(u, n, i) {
  switch (i.length) {
    case 0:
      return u.call(n);
    case 1:
      return u.call(n, i[0]);
    case 2:
      return u.call(n, i[0], i[1]);
    case 3:
      return u.call(n, i[0], i[1], i[2]);
  }
  return u.apply(n, i);
}
function KG(u, n) {
  var i = -1,
    o = u.length;
  for (n || (n = Array(o)); ++i < o; ) n[i] = u[i];
  return n;
}
var WG = 800,
  zG = 16,
  YG = Date.now;
function XG(u) {
  var n = 0,
    i = 0;
  return function () {
    var o = YG(),
      l = zG - (o - i);
    if (((i = o), l > 0)) {
      if (++n >= WG) return arguments[0];
    } else n = 0;
    return u.apply(void 0, arguments);
  };
}
function qG(u) {
  return function () {
    return u;
  };
}
var Pg = (function () {
    try {
      var u = nS(Object, "defineProperty");
      return (u({}, "", {}), u);
    } catch (n) {}
  })(),
  QG = Pg
    ? function (u, n) {
        return Pg(u, "toString", { configurable: !0, enumerable: !1, value: qG(n), writable: !0 });
      }
    : ik,
  JG = XG(QG),
  ZG = 9007199254740991,
  e6 = /^(?:0|[1-9]\d*)$/;
function rk(u, n) {
  var i = typeof u;
  return (
    (n = n == null ? ZG : n),
    !!n && (i == "number" || (i != "symbol" && e6.test(u))) && u > -1 && u % 1 == 0 && u < n
  );
}
function iS(u, n, i) {
  n == "__proto__" && Pg
    ? Pg(u, n, { configurable: !0, enumerable: !0, value: i, writable: !0 })
    : (u[n] = i);
}
function tm(u, n) {
  return u === n || (u !== u && n !== n);
}
var t6 = Object.prototype,
  n6 = t6.hasOwnProperty;
function i6(u, n, i) {
  var o = u[n];
  (!(n6.call(u, n) && tm(o, i)) || (i === void 0 && !(n in u))) && iS(u, n, i);
}
function r6(u, n, i, o) {
  var l = !i;
  i || (i = {});
  for (var h = -1, p = n.length; ++h < p; ) {
    var d = n[h],
      y = void 0;
    (y === void 0 && (y = u[d]), l ? iS(i, d, y) : i6(i, d, y));
  }
  return i;
}
var A_ = Math.max;
function s6(u, n, i) {
  return (
    (n = A_(n === void 0 ? u.length - 1 : n, 0)),
    function () {
      for (var o = arguments, l = -1, h = A_(o.length - n, 0), p = Array(h); ++l < h; ) p[l] = o[n + l];
      l = -1;
      for (var d = Array(n + 1); ++l < n; ) d[l] = o[l];
      return ((d[n] = i(p)), HG(u, this, d));
    }
  );
}
function o6(u, n) {
  return JG(s6(u, n, ik), u + "");
}
var a6 = 9007199254740991;
function sk(u) {
  return typeof u == "number" && u > -1 && u % 1 == 0 && u <= a6;
}
function rS(u) {
  return u != null && sk(u.length) && !tS(u);
}
function l6(u, n, i) {
  if (!Ca(i)) return !1;
  var o = typeof n;
  return (o == "number" ? rS(i) && rk(n, i.length) : o == "string" && n in i) ? tm(i[n], u) : !1;
}
function u6(u) {
  return o6(function (n, i) {
    var o = -1,
      l = i.length,
      h = l > 1 ? i[l - 1] : void 0,
      p = l > 2 ? i[2] : void 0;
    for (
      h = u.length > 3 && typeof h == "function" ? (l--, h) : void 0,
        p && l6(i[0], i[1], p) && ((h = l < 3 ? void 0 : h), (l = 1)),
        n = Object(n);
      ++o < l;
    ) {
      var d = i[o];
      d && u(n, d, o, h);
    }
    return n;
  });
}
var c6 = Object.prototype;
function ok(u) {
  var n = u && u.constructor,
    i = (typeof n == "function" && n.prototype) || c6;
  return u === i;
}
function d6(u, n) {
  for (var i = -1, o = Array(u); ++i < u; ) o[i] = n(i);
  return o;
}
var h6 = "[object Arguments]";
function I_(u) {
  return Bd(u) && em(u) == h6;
}
var ak = Object.prototype,
  f6 = ak.hasOwnProperty,
  p6 = ak.propertyIsEnumerable,
  vT = I_(
    (function () {
      return arguments;
    })(),
  )
    ? I_
    : function (u) {
        return Bd(u) && f6.call(u, "callee") && !p6.call(u, "callee");
      };
function g6() {
  return !1;
}
var lk = typeof exports == "object" && exports && !exports.nodeType && exports,
  w_ = lk && typeof module == "object" && module && !module.nodeType && module,
  m6 = w_ && w_.exports === lk,
  R_ = m6 ? mu.Buffer : void 0,
  y6 = R_ ? R_.isBuffer : void 0,
  uk = y6 || g6,
  v6 = "[object Arguments]",
  x6 = "[object Array]",
  T6 = "[object Boolean]",
  S6 = "[object Date]",
  E6 = "[object Error]",
  A6 = "[object Function]",
  I6 = "[object Map]",
  w6 = "[object Number]",
  R6 = "[object Object]",
  C6 = "[object RegExp]",
  L6 = "[object Set]",
  _6 = "[object String]",
  b6 = "[object WeakMap]",
  D6 = "[object ArrayBuffer]",
  k6 = "[object DataView]",
  M6 = "[object Float32Array]",
  P6 = "[object Float64Array]",
  O6 = "[object Int8Array]",
  N6 = "[object Int16Array]",
  F6 = "[object Int32Array]",
  U6 = "[object Uint8Array]",
  B6 = "[object Uint8ClampedArray]",
  $6 = "[object Uint16Array]",
  G6 = "[object Uint32Array]",
  gn = {};
gn[M6] = gn[P6] = gn[O6] = gn[N6] = gn[F6] = gn[U6] = gn[B6] = gn[$6] = gn[G6] = !0;
gn[v6] =
  gn[x6] =
  gn[D6] =
  gn[T6] =
  gn[k6] =
  gn[S6] =
  gn[E6] =
  gn[A6] =
  gn[I6] =
  gn[w6] =
  gn[R6] =
  gn[C6] =
  gn[L6] =
  gn[_6] =
  gn[b6] =
    !1;
function j6(u) {
  return Bd(u) && sk(u.length) && !!gn[em(u)];
}
function V6(u) {
  return function (n) {
    return u(n);
  };
}
var ck = typeof exports == "object" && exports && !exports.nodeType && exports,
  cd = ck && typeof module == "object" && module && !module.nodeType && module,
  H6 = cd && cd.exports === ck,
  Ex = H6 && tk.process,
  C_ = (function () {
    try {
      var u = cd && cd.require && cd.require("util").types;
      return u || (Ex && Ex.binding && Ex.binding("util"));
    } catch (n) {}
  })(),
  L_ = C_ && C_.isTypedArray,
  dk = L_ ? V6(L_) : j6;
function K6(u, n) {
  var i = yT(u),
    o = !i && vT(u),
    l = !i && !o && uk(u),
    h = !i && !o && !l && dk(u),
    p = i || o || l || h,
    d = p ? d6(u.length, String) : [],
    y = d.length;
  for (var v in u)
    (p &&
      (v == "length" ||
        (l && (v == "offset" || v == "parent")) ||
        (h && (v == "buffer" || v == "byteLength" || v == "byteOffset")) ||
        rk(v, y))) ||
      d.push(v);
  return d;
}
function W6(u, n) {
  return function (i) {
    return u(n(i));
  };
}
function z6(u) {
  var n = [];
  if (u != null) for (var i in Object(u)) n.push(i);
  return n;
}
var Y6 = Object.prototype,
  X6 = Y6.hasOwnProperty;
function q6(u) {
  if (!Ca(u)) return z6(u);
  var n = ok(u),
    i = [];
  for (var o in u) (o == "constructor" && (n || !X6.call(u, o))) || i.push(o);
  return i;
}
function hk(u) {
  return rS(u) ? K6(u) : q6(u);
}
var wd = nS(Object, "create");
function Q6() {
  ((this.__data__ = wd ? wd(null) : {}), (this.size = 0));
}
function J6(u) {
  var n = this.has(u) && delete this.__data__[u];
  return ((this.size -= n ? 1 : 0), n);
}
var Z6 = "__lodash_hash_undefined__",
  ej = Object.prototype,
  tj = ej.hasOwnProperty;
function nj(u) {
  var n = this.__data__;
  if (wd) {
    var i = n[u];
    return i === Z6 ? void 0 : i;
  }
  return tj.call(n, u) ? n[u] : void 0;
}
var ij = Object.prototype,
  rj = ij.hasOwnProperty;
function sj(u) {
  var n = this.__data__;
  return wd ? n[u] !== void 0 : rj.call(n, u);
}
var oj = "__lodash_hash_undefined__";
function aj(u, n) {
  var i = this.__data__;
  return ((this.size += this.has(u) ? 0 : 1), (i[u] = wd && n === void 0 ? oj : n), this);
}
function Ea(u) {
  var n = -1,
    i = u == null ? 0 : u.length;
  for (this.clear(); ++n < i; ) {
    var o = u[n];
    this.set(o[0], o[1]);
  }
}
Ea.prototype.clear = Q6;
Ea.prototype.delete = J6;
Ea.prototype.get = nj;
Ea.prototype.has = sj;
Ea.prototype.set = aj;
function lj() {
  ((this.__data__ = []), (this.size = 0));
}
function nm(u, n) {
  for (var i = u.length; i--; ) if (tm(u[i][0], n)) return i;
  return -1;
}
var uj = Array.prototype,
  cj = uj.splice;
function dj(u) {
  var n = this.__data__,
    i = nm(n, u);
  if (i < 0) return !1;
  var o = n.length - 1;
  return (i == o ? n.pop() : cj.call(n, i, 1), --this.size, !0);
}
function hj(u) {
  var n = this.__data__,
    i = nm(n, u);
  return i < 0 ? void 0 : n[i][1];
}
function fj(u) {
  return nm(this.__data__, u) > -1;
}
function pj(u, n) {
  var i = this.__data__,
    o = nm(i, u);
  return (o < 0 ? (++this.size, i.push([u, n])) : (i[o][1] = n), this);
}
function Qs(u) {
  var n = -1,
    i = u == null ? 0 : u.length;
  for (this.clear(); ++n < i; ) {
    var o = u[n];
    this.set(o[0], o[1]);
  }
}
Qs.prototype.clear = lj;
Qs.prototype.delete = dj;
Qs.prototype.get = hj;
Qs.prototype.has = fj;
Qs.prototype.set = pj;
var fk = nS(mu, "Map");
function gj() {
  ((this.size = 0), (this.__data__ = { hash: new Ea(), map: new (fk || Qs)(), string: new Ea() }));
}
function mj(u) {
  var n = typeof u;
  return n == "string" || n == "number" || n == "symbol" || n == "boolean" ? u !== "__proto__" : u === null;
}
function im(u, n) {
  var i = u.__data__;
  return mj(n) ? i[typeof n == "string" ? "string" : "hash"] : i.map;
}
function yj(u) {
  var n = im(this, u).delete(u);
  return ((this.size -= n ? 1 : 0), n);
}
function vj(u) {
  return im(this, u).get(u);
}
function xj(u) {
  return im(this, u).has(u);
}
function Tj(u, n) {
  var i = im(this, u),
    o = i.size;
  return (i.set(u, n), (this.size += i.size == o ? 0 : 1), this);
}
function yu(u) {
  var n = -1,
    i = u == null ? 0 : u.length;
  for (this.clear(); ++n < i; ) {
    var o = u[n];
    this.set(o[0], o[1]);
  }
}
yu.prototype.clear = gj;
yu.prototype.delete = yj;
yu.prototype.get = vj;
yu.prototype.has = xj;
yu.prototype.set = Tj;
var pk = W6(Object.getPrototypeOf, Object),
  Sj = "[object Object]",
  Ej = Function.prototype,
  Aj = Object.prototype,
  gk = Ej.toString,
  Ij = Aj.hasOwnProperty,
  wj = gk.call(Object);
function Rj(u) {
  if (!Bd(u) || em(u) != Sj) return !1;
  var n = pk(u);
  if (n === null) return !0;
  var i = Ij.call(n, "constructor") && n.constructor;
  return typeof i == "function" && i instanceof i && gk.call(i) == wj;
}
function Cj() {
  ((this.__data__ = new Qs()), (this.size = 0));
}
function Lj(u) {
  var n = this.__data__,
    i = n.delete(u);
  return ((this.size = n.size), i);
}
function _j(u) {
  return this.__data__.get(u);
}
function bj(u) {
  return this.__data__.has(u);
}
var Dj = 200;
function kj(u, n) {
  var i = this.__data__;
  if (i instanceof Qs) {
    var o = i.__data__;
    if (!fk || o.length < Dj - 1) return (o.push([u, n]), (this.size = ++i.size), this);
    i = this.__data__ = new yu(o);
  }
  return (i.set(u, n), (this.size = i.size), this);
}
function vu(u) {
  var n = (this.__data__ = new Qs(u));
  this.size = n.size;
}
vu.prototype.clear = Cj;
vu.prototype.delete = Lj;
vu.prototype.get = _j;
vu.prototype.has = bj;
vu.prototype.set = kj;
var mk = typeof exports == "object" && exports && !exports.nodeType && exports,
  __ = mk && typeof module == "object" && module && !module.nodeType && module,
  Mj = __ && __.exports === mk,
  b_ = Mj ? mu.Buffer : void 0;
b_ && b_.allocUnsafe;
function Pj(u, n) {
  return u.slice();
}
var D_ = mu.Uint8Array;
function Oj(u) {
  var n = new u.constructor(u.byteLength);
  return (new D_(n).set(new D_(u)), n);
}
function Nj(u, n) {
  var i = Oj(u.buffer);
  return new u.constructor(i, u.byteOffset, u.length);
}
function Fj(u) {
  return typeof u.constructor == "function" && !ok(u) ? VG(pk(u)) : {};
}
function Uj(u) {
  return function (n, i, o) {
    for (var l = -1, h = Object(n), p = o(n), d = p.length; d--; ) {
      var y = p[++l];
      if (i(h[y], y, h) === !1) break;
    }
    return n;
  };
}
var Bj = Uj();
function xT(u, n, i) {
  ((i !== void 0 && !tm(u[n], i)) || (i === void 0 && !(n in u))) && iS(u, n, i);
}
function $j(u) {
  return Bd(u) && rS(u);
}
function TT(u, n) {
  if (!(n === "constructor" && typeof u[n] == "function") && n != "__proto__") return u[n];
}
function Gj(u) {
  return r6(u, hk(u));
}
function jj(u, n, i, o, l, h, p) {
  var d = TT(u, i),
    y = TT(n, i),
    v = p.get(y);
  if (v) {
    xT(u, i, v);
    return;
  }
  var T = h ? h(d, y, i + "", u, n, p) : void 0,
    S = T === void 0;
  if (S) {
    var w = yT(y),
      C = !w && uk(y),
      L = !w && !C && dk(y);
    ((T = y),
      w || C || L
        ? yT(d)
          ? (T = d)
          : $j(d)
            ? (T = KG(d))
            : C
              ? ((S = !1), (T = Pj(y)))
              : L
                ? ((S = !1), (T = Nj(y)))
                : (T = [])
        : Rj(y) || vT(y)
          ? ((T = d), vT(d) ? (T = Gj(d)) : (!Ca(d) || tS(d)) && (T = Fj(y)))
          : (S = !1));
  }
  (S && (p.set(y, T), l(T, y, o, h, p), p.delete(y)), xT(u, i, T));
}
function yk(u, n, i, o, l) {
  u !== n &&
    Bj(
      n,
      function (h, p) {
        if ((l || (l = new vu()), Ca(h))) jj(u, n, p, i, yk, o, l);
        else {
          var d = o ? o(TT(u, p), h, p + "", u, n, l) : void 0;
          (d === void 0 && (d = h), xT(u, p, d));
        }
      },
      hk,
    );
}
var Vj = u6(function (u, n, i) {
  yk(u, n, i);
});
const Hj = 24;
function Kj(u, n, i, o, l, h, p, d, y) {
  const v = Math.min(Math.max(p.firstLineIdx, 0), d.length),
    T = 0,
    { metrics: S } = i;
  i.data;
  const w = (S.ascender - S.descender) * u;
  let C = 0;
  o === "middle" ? (C = (n - w) / 2) : o === "bottom" && (C = n - w);
  const L = l / h,
    k = i.data.common.base,
    B = S.ascender * u - k,
    N = L + B + v * n + C;
  if (!(y && N >= y / h)) return { sdfX: T, sdfY: N, lineIndex: v };
}
class nd {
  constructor(n, i = 0) {
    j(this, "iterator");
    j(this, "peekBuffer", []);
    j(this, "_lastIndex");
    ((this.iterator = n), (this.iterator = n), (this._lastIndex = i - 1), (this.peekBuffer = []));
  }
  next() {
    const n = this.peekBuffer.length > 0 ? this.peekBuffer.pop() : this.iterator.next();
    return (n.done ? (this._lastIndex = -1) : this._lastIndex++, n);
  }
  peek() {
    if (this.peekBuffer.length > 0) return this.peekBuffer[0];
    const n = this.iterator.next();
    return (this.peekBuffer.push(n), n);
  }
  get lastIndex() {
    return this._lastIndex;
  }
}
function* id(u, n = 0) {
  let i = n;
  for (; i < u.length; ) {
    const o = u.codePointAt(i);
    if (o === void 0) throw new Error("Invalid Unicode code point");
    (yield o, (i += o <= 65535 ? 1 : 2));
  }
}
function Wj(u, n, i) {
  const o = i.shapeText(n, new nd(id(u, 0), 0));
  let l = 0;
  for (const h of o) h.mapped && h.codepoint !== 8203 && (l += h.xAdvance);
  return l;
}
function zj(u, n, i, o, l, h, p, d, y, v, T, S, w, C, L, k, O, B, N) {
  (L.loaded, L.data, L.shaper);
  const $ = d / L.data.info.size,
    I = y / $,
    V = h / $,
    oe = v / $,
    Y = w[u],
    te = (Y == null ? void 0 : Y.codepointIndex) || 0,
    _ = (Y == null ? void 0 : Y.maxX) || 0,
    K = (Y == null ? void 0 : Y.maxY) || 0;
  let q = _,
    ce = K,
    he = n,
    ae = i,
    ye = 0;
  const ve = { codepointIndex: -1, bufferOffset: -1, xStart: -1 },
    we = L.shaper,
    Le = { letterSpacing: oe };
  o.endsWith(" ") && (o += " ");
  let ke = we.shapeText(Le, new nd(id(o, te), te)),
    Ne,
    Re = -1;
  const Ce = [],
    W = p / $,
    Qe = Wj(B, Le, we);
  let ot = !0;
  for (; ot; ) {
    const Je = (N === 0 || u + 1 < N) && (S !== "both" || O || ae + I + L.maxCharHeight <= W),
      Ut = Je ? V : V - Qe;
    let St = 0;
    const Xt = ae + L.maxCharHeight >= C.y1,
      vn = ae <= C.y2,
      Rn = Xt && vn;
    for (; (Ne = ke.next()) && !Ne.done; ) {
      const Ee = Ne.value;
      if (u === w.length) w.push({ codepointIndex: Ee.cluster, maxY: ce, maxX: q });
      else if (u > w.length) throw new Error("Unexpected lineCache length");
      if (
        (Ee.codepoint === 32 || Ee.codepoint === 10 || Ee.codepoint === 8203
          ? ve.codepointIndex !== -1 && ((ve.codepointIndex = -1), (St = he))
          : ve.codepointIndex === -1 &&
            ((ve.codepointIndex = Ee.cluster), (ve.bufferOffset = ye), (ve.xStart = St)),
        Ee.mapped)
      ) {
        const Di = he + Ee.xOffset + Ee.width;
        if (S !== "none" && Di >= Ut && ve.codepointIndex !== -1 && ve.xStart > 0)
          if (Je) {
            ((ke = we.shapeText(Le, new nd(id(o, ve.codepointIndex), ve.codepointIndex))),
              (ye = ve.bufferOffset));
            break;
          } else
            ((ke = we.shapeText(Le, new nd(id(B, 0), 0))),
              (he = ve.xStart),
              (ye = ve.bufferOffset),
              (S = "none"));
        else {
          const ai = he + Ee.xOffset,
            xi = ae + Ee.yOffset;
          if (Rn) {
            Re === -1 && (Re = ye);
            const Et = L.getAtlasEntry(Ee.glyphId),
              Bt = Et.x / L.data.common.scaleW,
              He = Et.y / L.data.common.scaleH,
              Cn = Et.width / L.data.common.scaleW,
              Vn = Et.height / L.data.common.scaleH;
            ((T[ye++] = ai),
              (T[ye++] = xi),
              (T[ye++] = Bt),
              (T[ye++] = He),
              (T[ye++] = ai + Ee.width),
              (T[ye++] = xi),
              (T[ye++] = Bt + Cn),
              (T[ye++] = He),
              (T[ye++] = ai),
              (T[ye++] = xi + Ee.height),
              (T[ye++] = Bt),
              (T[ye++] = He + Vn),
              (T[ye++] = ai + Ee.width),
              (T[ye++] = xi + Ee.height),
              (T[ye++] = Bt + Cn),
              (T[ye++] = He + Vn));
          }
          ((ce = Math.max(ce, xi + Ee.height)), (q = Math.max(q, ai + Ee.width)), (he += Ee.xAdvance));
        }
      } else if (Ee.codepoint === 10) {
        if (Je) break;
        ((ke = we.shapeText(Le, new nd(id(B, 0), 0))), (S = "none"));
      }
    }
    (Re !== -1 && (Ce.push({ bufferStart: Re, bufferEnd: ye }), (Re = -1)),
      (he = 0),
      (ae += I),
      u++,
      (ve.codepointIndex = -1),
      (St = 0),
      (!k && S === "both" && ae > C.y2) || (Ne && Ne.done) ? (ot = !1) : Je || (ot = !1));
  }
  if (l === "center") {
    const Je = S === "none" ? q : V;
    for (let Ut = 0; Ut < Ce.length; Ut++) {
      const St = Ce[Ut],
        Xt = T[St.bufferEnd - 4] - T[St.bufferStart],
        vn = (Je - Xt) / 2;
      for (let Rn = St.bufferStart; Rn < St.bufferEnd; Rn += 4) T[Rn] += vn;
    }
  } else if (l === "right") {
    const Je = S === "none" ? q : V;
    for (let Ut = 0; Ut < Ce.length; Ut++) {
      const St = Ce[Ut],
        Xt = St.bufferEnd === St.bufferStart ? 0 : T[St.bufferEnd - 4] - T[St.bufferStart],
        vn = Je - Xt;
      for (let Rn = St.bufferStart; Rn < St.bufferEnd; Rn += 4) T[Rn] += vn;
    }
  }
  return {
    bufferNumFloats: ye,
    bufferNumQuads: ye / 16,
    layoutNumCharacters: Ne.done ? o.length - te : Ne.value.cluster - te + 1,
    fullyProcessed: !!Ne.done,
    maxX: q,
    maxY: ce,
    numLines: w.length,
  };
}
function Yj(u, n) {
  return Math.ceil(u / n) * n;
}
function Xj(u, n) {
  return Math.floor(u / n) * n;
}
function qj(u, n, i, o, l, h, p, d) {
  const { screen: y, sdf: v } = u;
  if (!c$(p))
    ((y.x1 = 0),
      (y.y1 = 0),
      (y.x2 = 0),
      (y.y2 = 0),
      (v.x1 = 0),
      (v.y1 = 0),
      (v.x2 = 0),
      (v.y2 = 0),
      (u.numLines = 0),
      (u.firstLineIdx = 0));
  else {
    const T = p.x1 - n,
      S = T + (p.x2 - p.x1),
      w = p.y1 - i + o,
      C = Xj(w - h, l || 1),
      L = Yj(w + (p.y2 - p.y1) + h, l || 1);
    ((y.x1 = T),
      (y.y1 = C),
      (y.x2 = S),
      (y.y2 = L),
      (v.x1 = T / d),
      (v.y1 = C / d),
      (v.x2 = S / d),
      (v.y2 = L / d),
      (u.numLines = Math.ceil((L - C) / l)),
      (u.firstLineIdx = l ? Math.floor(C / l) : 0));
  }
  u.valid = !0;
}
function Qj(u, n) {
  return n * (u.ascender - u.descender + u.lineGap);
}
const Jj = { x: 0, y: 0, width: 0, height: 0 };
class Zj extends gD {
  constructor(i) {
    super(i);
    j(this, "ssdfFontFamilies", {});
    j(this, "msdfFontFamilies", {});
    j(this, "fontFamilyArray", [this.ssdfFontFamilies, this.msdfFontFamilies]);
    j(this, "sdfShader");
    j(this, "rendererBounds");
    j(this, "type", "sdf");
    ((this.sdfShader = this.stage.shManager.loadShader("SdfShader", {
      transform: new Float32Array(),
      color: 0,
      size: 0,
      scrollY: 0,
      distanceRange: 0,
      debug: !1,
    }).shader),
      (this.rendererBounds = {
        x1: 0,
        y1: 0,
        x2: this.stage.options.appWidth,
        y2: this.stage.options.appHeight,
      }));
  }
  getPropertySetters() {
    return {
      fontFamily: (i, o) => {
        ((i.props.fontFamily = o), this.releaseFontFace(i), this.invalidateLayoutCache(i));
      },
      fontWeight: (i, o) => {
        ((i.props.fontWeight = o), this.releaseFontFace(i), this.invalidateLayoutCache(i));
      },
      fontStyle: (i, o) => {
        ((i.props.fontStyle = o), this.releaseFontFace(i), this.invalidateLayoutCache(i));
      },
      fontStretch: (i, o) => {
        ((i.props.fontStretch = o), this.releaseFontFace(i), this.invalidateLayoutCache(i));
      },
      fontSize: (i, o) => {
        ((i.props.fontSize = o), this.invalidateLayoutCache(i));
      },
      text: (i, o) => {
        ((i.props.text = o), this.invalidateLayoutCache(i));
      },
      textAlign: (i, o) => {
        ((i.props.textAlign = o), this.invalidateLayoutCache(i));
      },
      color: (i, o) => {
        i.props.color = o;
      },
      x: (i, o) => {
        ((i.props.x = o),
          i.elementBounds.valid &&
            (this.setElementBoundsX(i),
            !i.renderWindow.valid &&
              nx(i.elementBounds, this.rendererBounds) &&
              this.scheduleUpdateState(i)));
      },
      y: (i, o) => {
        ((i.props.y = o),
          i.elementBounds.valid &&
            (this.setElementBoundsY(i),
            !i.renderWindow.valid &&
              nx(i.elementBounds, this.rendererBounds) &&
              this.scheduleUpdateState(i)));
      },
      contain: (i, o) => {
        ((i.props.contain = o), this.invalidateLayoutCache(i));
      },
      width: (i, o) => {
        ((i.props.width = o), i.props.contain !== "none" && this.invalidateLayoutCache(i));
      },
      height: (i, o) => {
        ((i.props.height = o), i.props.contain === "both" && this.invalidateLayoutCache(i));
      },
      offsetY: (i, o) => {
        ((i.props.offsetY = o), this.invalidateLayoutCache(i));
      },
      scrollable: (i, o) => {
        ((i.props.scrollable = o), this.invalidateLayoutCache(i));
      },
      scrollY: (i, o) => {
        ((i.props.scrollY = o), this.scheduleUpdateState(i));
      },
      letterSpacing: (i, o) => {
        ((i.props.letterSpacing = o), this.invalidateLayoutCache(i));
      },
      lineHeight: (i, o) => {
        ((i.props.lineHeight = o), (i.resLineHeight = void 0), this.invalidateLayoutCache(i));
      },
      maxLines: (i, o) => {
        ((i.props.maxLines = o), this.invalidateLayoutCache(i));
      },
      textBaseline: (i, o) => {
        ((i.props.textBaseline = o), this.invalidateLayoutCache(i));
      },
      verticalAlign: (i, o) => {
        ((i.props.verticalAlign = o), this.invalidateLayoutCache(i));
      },
      overflowSuffix: (i, o) => {
        ((i.props.overflowSuffix = o), this.invalidateLayoutCache(i));
      },
      debug: (i, o) => {
        i.props.debug = o;
      },
    };
  }
  canRenderFont(i) {
    const { fontFamily: o } = i;
    return o in this.ssdfFontFamilies || o in this.msdfFontFamilies || o === "$$SDF_FAILURE_TEST$$";
  }
  isFontFaceSupported(i) {
    return i instanceof xD;
  }
  addFontFace(i) {
    const o = i.fontFamily,
      l = i.type === "ssdf" ? this.ssdfFontFamilies : i.type === "msdf" ? this.msdfFontFamilies : void 0;
    if (!l) {
      console.warn("Invalid font face type: ".concat(i.type));
      return;
    }
    let h = l[o];
    (h || ((h = new Set()), (l[o] = h)), h.add(i));
  }
  createState(i) {
    return {
      props: i,
      status: "initialState",
      updateScheduled: !1,
      emitter: new Fo(),
      lineCache: [],
      forceFullLayoutCalc: !1,
      renderWindow: {
        screen: { x1: 0, y1: 0, x2: 0, y2: 0 },
        sdf: { x1: 0, y1: 0, x2: 0, y2: 0 },
        firstLineIdx: 0,
        numLines: 0,
        valid: !1,
      },
      elementBounds: { x1: 0, y1: 0, x2: 0, y2: 0, valid: !1 },
      clippingRect: { x: 0, y: 0, width: 0, height: 0, valid: !1 },
      bufferNumFloats: 0,
      bufferNumQuads: 0,
      vertexBuffer: void 0,
      webGlBuffers: null,
      bufferUploaded: !1,
      textH: void 0,
      textW: void 0,
      distanceRange: 0,
      trFontFace: void 0,
      isRenderable: !1,
      resLineHeight: void 0,
      debugData: {
        updateCount: 0,
        layoutCount: 0,
        lastLayoutNumCharacters: 0,
        layoutSum: 0,
        drawSum: 0,
        drawCount: 0,
        bufferSize: 0,
      },
    };
  }
  updateState(i) {
    let { trFontFace: o } = i;
    const { textH: l, lineCache: h, debugData: p, forceFullLayoutCalc: d } = i;
    if ((p.updateCount++, i.status === "initialState" && this.setStatus(i, "loading"), o === void 0)) {
      if (((o = this.resolveFontFace(i.props)), (i.trFontFace = o), o === void 0)) {
        const we = "SdfTextRenderer: Could not resolve font face for family: '".concat(
          i.props.fontFamily,
          "'",
        );
        (console.error(we), this.setStatus(i, "failed", new Error(we)));
        return;
      }
      o.texture.setRenderableOwner(i.props.fontFamily, !0);
    }
    if (o.loaded === !1) {
      o.once("loaded", () => {
        this.scheduleUpdateState(i);
      });
      return;
    }
    (o.data, o.metrics);
    const {
        text: y,
        fontSize: v,
        x: T,
        y: S,
        contain: w,
        width: C,
        height: L,
        verticalAlign: k,
        scrollable: O,
        overflowSuffix: B,
        maxLines: N,
      } = i.props,
      $ = w === "both" && O ? i.props.scrollY : 0,
      { renderWindow: I } = i,
      V = o.data.info.size,
      oe = v / V;
    let Y = i.resLineHeight;
    if (Y === void 0) {
      const we = i.props.lineHeight;
      (we === void 0 ? (Y = Qj(o.metrics, v)) : (Y = we), (i.resLineHeight = Y));
    }
    const te = Y / oe;
    i.distanceRange = oe * o.data.distanceField.distanceRange;
    const _ = y.length * Hj;
    let K = i.vertexBuffer;
    (!K || K.length < _) && (K = new Float32Array(_ * 2));
    const q = i.elementBounds;
    if ((q.valid || (this.setElementBoundsX(i), this.setElementBoundsY(i), (q.valid = !0)), !d && I.valid)) {
      const we = I.screen;
      if (T + we.x1 <= q.x1 && T + we.x2 >= q.x2 && S - $ + we.y1 <= q.y1 && S - $ + we.y2 >= q.y2) {
        this.setStatus(i, "loaded");
        return;
      }
      ((I.valid = !1), this.setStatus(i, "loading"));
    }
    const { offsetY: ce, textAlign: he } = i.props;
    if (!I.valid) {
      if (!nx(q, this.rendererBounds)) return;
      qj(I, T, S, $, Y, w === "both" ? q.y2 - q.y1 : 0, q, oe);
    }
    const ae = Kj(V, te, o, k, ce, oe, I, h, l);
    if (!ae) {
      this.setStatus(i, "loaded");
      return;
    }
    const { letterSpacing: ye } = i.props,
      ve = zj(ae.lineIndex, ae.sdfX, ae.sdfY, y, he, C, L, v, Y, ye, K, w, h, I.sdf, o, d, O, B, N);
    ((i.bufferUploaded = !1),
      (i.bufferNumFloats = ve.bufferNumFloats),
      (i.bufferNumQuads = ve.bufferNumQuads),
      (i.vertexBuffer = K),
      (i.renderWindow = I),
      (p.lastLayoutNumCharacters = ve.layoutNumCharacters),
      (p.bufferSize = K.byteLength),
      ve.fullyProcessed && ((i.textW = ve.maxX * oe), (i.textH = ve.numLines * te * oe)),
      this.setStatus(i, "loaded"));
  }
  renderQuads(i, o, l, h, p, d) {
    var q, ce, he;
    if (!i.vertexBuffer) return;
    const y = this.stage.renderer,
      { fontSize: v, color: T, contain: S, scrollable: w, zIndex: C, debug: L } = i.props,
      k = S === "both" && w ? i.props.scrollY : 0,
      {
        textW: O = 0,
        textH: B = 0,
        distanceRange: N,
        vertexBuffer: $,
        bufferUploaded: I,
        trFontFace: V,
        elementBounds: oe,
      } = i;
    let { webGlBuffers: Y } = i;
    if (!Y) {
      const ae = y.glw,
        ye = 4 * Float32Array.BYTES_PER_ELEMENT,
        ve = ae.createBuffer();
      ((i.webGlBuffers = new vD([
        {
          buffer: ve,
          attributes: {
            a_position: {
              name: "a_position",
              size: 2,
              type: ae.FLOAT,
              normalized: !1,
              stride: ye,
              offset: 0,
            },
            a_textureCoordinate: {
              name: "a_textureCoordinate",
              size: 2,
              type: ae.FLOAT,
              normalized: !1,
              stride: ye,
              offset: 2 * Float32Array.BYTES_PER_ELEMENT,
            },
          },
        },
      ])),
        (i.bufferUploaded = !1),
        i.webGlBuffers,
        (Y = i.webGlBuffers));
    }
    if (!I) {
      const ae = y.glw,
        ye = (q = Y == null ? void 0 : Y.getBuffer("a_textureCoordinate")) != null ? q : null;
      (ae.arrayBufferData(ye, $, ae.STATIC_DRAW), (i.bufferUploaded = !0));
    }
    if (w && S === "both") {
      oe.valid;
      const ae = o$(oe, Jj);
      l.valid
        ? ((i.clippingRect.valid = !0), (l = sD(l, ae, i.clippingRect)))
        : ((i.clippingRect.valid = !0), (l = oD(ae, i.clippingRect)));
    }
    const te = new yD(
        y.glw,
        y.options,
        Y,
        this.sdfShader,
        {
          transform: o.getFloatArr(),
          color: e$(T, h),
          size: v / (((ce = V.data) == null ? void 0 : ce.info.size) || 0),
          scrollY: k,
          distanceRange: N,
          debug: L.sdfShaderDebug,
        },
        h,
        l,
        { height: B, width: O },
        0,
        C,
        !1,
        p,
        d,
      ),
      K = ((he = i.trFontFace) == null ? void 0 : he.texture).ctxTexture;
    (te.addTexture(K), (te.length = i.bufferNumFloats), (te.numQuads = i.bufferNumQuads), y.addRenderOp(te));
  }
  setIsRenderable(i, o) {
    var l;
    (super.setIsRenderable(i, o),
      (l = i.trFontFace) == null || l.texture.setRenderableOwner(i.props.fontFamily, o));
  }
  destroyState(i) {
    var o;
    (super.destroyState(i),
      (o = i.trFontFace) == null || o.texture.setRenderableOwner(i.props.fontFamily, !1));
  }
  resolveFontFace(i) {
    return this.stage.fontManager.resolveFontFace(this.fontFamilyArray, i, "sdf");
  }
  releaseFontFace(i) {
    ((i.resLineHeight = void 0),
      i.trFontFace &&
        (i.trFontFace.texture.setRenderableOwner(i.props.fontFamily, !1), (i.trFontFace = void 0)));
  }
  invalidateLayoutCache(i) {
    ((i.renderWindow.valid = !1),
      (i.elementBounds.valid = !1),
      (i.textH = void 0),
      (i.textW = void 0),
      (i.lineCache = []),
      this.setStatus(i, "loading"),
      this.scheduleUpdateState(i));
  }
  setElementBoundsX(i) {
    const { x: o, contain: l, width: h } = i.props,
      { elementBounds: p } = i;
    ((p.x1 = o), (p.x2 = l !== "none" ? o + h : 1 / 0));
  }
  setElementBoundsY(i) {
    const { y: o, contain: l, height: h } = i.props,
      { elementBounds: p } = i;
    ((p.y1 = o), (p.y2 = l === "both" ? o + h : 1 / 0));
  }
}
var eV =
    typeof globalThis < "u"
      ? globalThis
      : typeof window < "u"
        ? window
        : typeof global < "u"
          ? global
          : typeof self < "u"
            ? self
            : {},
  Ax = {};
/*
 @license
 Shaka Player
 Copyright 2016 Google LLC
 SPDX-License-Identifier: Apache-2.0
*/ var k_;
function tV() {
  return (
    k_ ||
      ((k_ = 1),
      (function (u) {
        (function () {
          var n = typeof window < "u" ? window : eV,
            i = {};
          (function (l, h, p) {
            var d,
              y =
                typeof Object.create == "function"
                  ? Object.create
                  : function (e) {
                      function t() {}
                      return ((t.prototype = e), new t());
                    },
              v =
                typeof Object.defineProperties == "function"
                  ? Object.defineProperty
                  : function (e, t, r) {
                      return (e == Array.prototype || e == Object.prototype || (e[t] = r.value), e);
                    };
            function T(e) {
              e = [
                typeof globalThis == "object" && globalThis,
                e,
                typeof l == "object" && l,
                typeof self == "object" && self,
                typeof h == "object" && h,
              ];
              for (var t = 0; t < e.length; ++t) {
                var r = e[t];
                if (r && r.Math == Math) return r;
              }
              throw Error("Cannot find global object");
            }
            var S = T(this);
            function w(e, t) {
              if (t)
                e: {
                  var r = S;
                  e = e.split(".");
                  for (var s = 0; s < e.length - 1; s++) {
                    var a = e[s];
                    if (!(a in r)) break e;
                    r = r[a];
                  }
                  ((e = e[e.length - 1]),
                    (s = r[e]),
                    (t = t(s)),
                    t != s && t != null && v(r, e, { configurable: !0, writable: !0, value: t }));
                }
            }
            var C;
            if (typeof Object.setPrototypeOf == "function") C = Object.setPrototypeOf;
            else {
              var L;
              e: {
                var k = { a: !0 },
                  O = {};
                try {
                  ((O.__proto__ = k), (L = O.a));
                  break e;
                } catch (e) {}
                L = !1;
              }
              C = L
                ? function (e, t) {
                    if (((e.__proto__ = t), e.__proto__ !== t)) throw new TypeError(e + " is not extensible");
                    return e;
                  }
                : null;
            }
            var B = C;
            function N(e, t) {
              if (((e.prototype = y(t.prototype)), (e.prototype.constructor = e), B)) B(e, t);
              else
                for (var r in t)
                  if (r != "prototype")
                    if (Object.defineProperties) {
                      var s = Object.getOwnPropertyDescriptor(t, r);
                      s && Object.defineProperty(e, r, s);
                    } else e[r] = t[r];
              e.Im = t.prototype;
            }
            function $(e) {
              var t = 0;
              return function () {
                return t < e.length ? { done: !1, value: e[t++] } : { done: !0 };
              };
            }
            function I(e) {
              var t = typeof Symbol < "u" && Symbol.iterator && e[Symbol.iterator];
              if (t) return t.call(e);
              if (typeof e.length == "number") return { next: $(e) };
              throw Error(String(e) + " is not an iterable or ArrayLike");
            }
            function V(e) {
              if (!(e instanceof Array)) {
                e = I(e);
                for (var t, r = []; !(t = e.next()).done; ) r.push(t.value);
                e = r;
              }
              return e;
            }
            function oe() {
              ((this.o = !1),
                (this.l = null),
                (this.h = void 0),
                (this.g = 1),
                (this.j = this.m = 0),
                (this.B = this.i = null));
            }
            function Y(e) {
              if (e.o) throw new TypeError("Generator is already running");
              e.o = !0;
            }
            oe.prototype.u = function (e) {
              this.h = e;
            };
            function te(e, t) {
              ((e.i = { bi: t, si: !0 }), (e.g = e.m || e.j));
            }
            oe.prototype.return = function (e) {
              ((this.i = { return: e }), (this.g = this.j));
            };
            function _(e, t, r) {
              return ((e.g = r), { value: t });
            }
            oe.prototype.A = function (e) {
              this.g = e;
            };
            function K(e) {
              e.g = 0;
            }
            function q(e, t, r) {
              ((e.m = t), r != null && (e.j = r));
            }
            function ce(e, t) {
              ((e.m = 0), (e.j = t || 0));
            }
            function he(e, t, r) {
              ((e.g = t), (e.m = r || 0));
            }
            function ae(e, t) {
              return ((e.m = t || 0), (t = e.i.bi), (e.i = null), t);
            }
            function ye(e) {
              ((e.B = [e.i]), (e.m = 0), (e.j = 0));
            }
            function ve(e, t) {
              var r = e.B.splice(0)[0];
              (r = e.i = e.i || r)
                ? r.si
                  ? (e.g = e.m || e.j)
                  : r.A != null && e.j < r.A
                    ? ((e.g = r.A), (e.i = null))
                    : (e.g = e.j)
                : (e.g = t);
            }
            function we(e) {
              ((this.g = new oe()), (this.h = e));
            }
            function Le(e, t) {
              Y(e.g);
              var r = e.g.l;
              return r
                ? ke(
                    e,
                    "return" in r
                      ? r.return
                      : function (s) {
                          return { value: s, done: !0 };
                        },
                    t,
                    e.g.return,
                  )
                : (e.g.return(t), Ne(e));
            }
            function ke(e, t, r, s) {
              try {
                var a = t.call(e.g.l, r);
                if (!(a instanceof Object)) throw new TypeError("Iterator result " + a + " is not an object");
                if (!a.done) return ((e.g.o = !1), a);
                var c = a.value;
              } catch (f) {
                return ((e.g.l = null), te(e.g, f), Ne(e));
              }
              return ((e.g.l = null), s.call(e.g, c), Ne(e));
            }
            function Ne(e) {
              for (; e.g.g; )
                try {
                  var t = e.h(e.g);
                  if (t) return ((e.g.o = !1), { value: t.value, done: !1 });
                } catch (r) {
                  ((e.g.h = void 0), te(e.g, r));
                }
              if (((e.g.o = !1), e.g.i)) {
                if (((t = e.g.i), (e.g.i = null), t.si)) throw t.bi;
                return { value: t.return, done: !0 };
              }
              return { value: void 0, done: !0 };
            }
            function Re(e) {
              ((this.next = function (t) {
                return (Y(e.g), e.g.l ? (t = ke(e, e.g.l.next, t, e.g.u)) : (e.g.u(t), (t = Ne(e))), t);
              }),
                (this.throw = function (t) {
                  return (Y(e.g), e.g.l ? (t = ke(e, e.g.l.throw, t, e.g.u)) : (te(e.g, t), (t = Ne(e))), t);
                }),
                (this.return = function (t) {
                  return Le(e, t);
                }),
                (this[Symbol.iterator] = function () {
                  return this;
                }));
            }
            function Ce(e) {
              function t(s) {
                return e.next(s);
              }
              function r(s) {
                return e.throw(s);
              }
              return new Promise(function (s, a) {
                function c(f) {
                  f.done ? s(f.value) : Promise.resolve(f.value).then(t, r).then(c, a);
                }
                c(e.next());
              });
            }
            function W(e) {
              return Ce(new Re(new we(e)));
            }
            function Qe() {
              for (var e = Number(this), t = [], r = e; r < arguments.length; r++) t[r - e] = arguments[r];
              return t;
            }
            (w("Symbol", function (e) {
              function t(c) {
                if (this instanceof t) throw new TypeError("Symbol is not a constructor");
                return new r(s + (c || "") + "_" + a++, c);
              }
              function r(c, f) {
                ((this.g = c), v(this, "description", { configurable: !0, writable: !0, value: f }));
              }
              if (e) return e;
              r.prototype.toString = function () {
                return this.g;
              };
              var s = "jscomp_symbol_" + ((Math.random() * 1e9) >>> 0) + "_",
                a = 0;
              return t;
            }),
              w("Symbol.iterator", function (e) {
                return (
                  e ||
                  ((e = Symbol("Symbol.iterator")),
                  v(Array.prototype, e, {
                    configurable: !0,
                    writable: !0,
                    value: function () {
                      return ot($(this));
                    },
                  }),
                  e)
                );
              }));
            function ot(e) {
              return (
                (e = { next: e }),
                (e[Symbol.iterator] = function () {
                  return this;
                }),
                e
              );
            }
            w("Promise", function (e) {
              function t(f) {
                ((this.h = 0), (this.i = void 0), (this.g = []), (this.o = !1));
                var g = this.j();
                try {
                  f(g.resolve, g.reject);
                } catch (m) {
                  g.reject(m);
                }
              }
              function r() {
                this.g = null;
              }
              function s(f) {
                return f instanceof t
                  ? f
                  : new t(function (g) {
                      g(f);
                    });
              }
              if (e) return e;
              r.prototype.h = function (f) {
                if (this.g == null) {
                  this.g = [];
                  var g = this;
                  this.i(function () {
                    g.l();
                  });
                }
                this.g.push(f);
              };
              var a = S.setTimeout;
              ((r.prototype.i = function (f) {
                a(f, 0);
              }),
                (r.prototype.l = function () {
                  for (; this.g && this.g.length; ) {
                    var f = this.g;
                    this.g = [];
                    for (var g = 0; g < f.length; ++g) {
                      var m = f[g];
                      f[g] = null;
                      try {
                        m();
                      } catch (x) {
                        this.j(x);
                      }
                    }
                  }
                  this.g = null;
                }),
                (r.prototype.j = function (f) {
                  this.i(function () {
                    throw f;
                  });
                }),
                (t.prototype.j = function () {
                  function f(x) {
                    return function (E) {
                      m || ((m = !0), x.call(g, E));
                    };
                  }
                  var g = this,
                    m = !1;
                  return { resolve: f(this.G), reject: f(this.l) };
                }),
                (t.prototype.G = function (f) {
                  if (f === this) this.l(new TypeError("A Promise cannot resolve to itself"));
                  else if (f instanceof t) this.I(f);
                  else {
                    e: switch (typeof f) {
                      case "object":
                        var g = f != null;
                        break e;
                      case "function":
                        g = !0;
                        break e;
                      default:
                        g = !1;
                    }
                    g ? this.F(f) : this.m(f);
                  }
                }),
                (t.prototype.F = function (f) {
                  var g = void 0;
                  try {
                    g = f.then;
                  } catch (m) {
                    this.l(m);
                    return;
                  }
                  typeof g == "function" ? this.J(g, f) : this.m(f);
                }),
                (t.prototype.l = function (f) {
                  this.u(2, f);
                }),
                (t.prototype.m = function (f) {
                  this.u(1, f);
                }),
                (t.prototype.u = function (f, g) {
                  if (this.h != 0)
                    throw Error(
                      "Cannot settle(" + f + ", " + g + "): Promise already settled in state" + this.h,
                    );
                  ((this.h = f), (this.i = g), this.h === 2 && this.H(), this.B());
                }),
                (t.prototype.H = function () {
                  var f = this;
                  a(function () {
                    if (f.C()) {
                      var g = S.console;
                      typeof g < "u" && g.error(f.i);
                    }
                  }, 1);
                }),
                (t.prototype.C = function () {
                  if (this.o) return !1;
                  var f = S.CustomEvent,
                    g = S.Event,
                    m = S.dispatchEvent;
                  return typeof m > "u"
                    ? !0
                    : (typeof f == "function"
                        ? (f = new f("unhandledrejection", { cancelable: !0 }))
                        : typeof g == "function"
                          ? (f = new g("unhandledrejection", { cancelable: !0 }))
                          : ((f = S.document.createEvent("CustomEvent")),
                            f.initCustomEvent("unhandledrejection", !1, !0, f)),
                      (f.promise = this),
                      (f.reason = this.i),
                      m(f));
                }),
                (t.prototype.B = function () {
                  if (this.g != null) {
                    for (var f = 0; f < this.g.length; ++f) c.h(this.g[f]);
                    this.g = null;
                  }
                }));
              var c = new r();
              return (
                (t.prototype.I = function (f) {
                  var g = this.j();
                  f.Te(g.resolve, g.reject);
                }),
                (t.prototype.J = function (f, g) {
                  var m = this.j();
                  try {
                    f.call(g, m.resolve, m.reject);
                  } catch (x) {
                    m.reject(x);
                  }
                }),
                (t.prototype.then = function (f, g) {
                  function m(R, b) {
                    return typeof R == "function"
                      ? function (D) {
                          try {
                            x(R(D));
                          } catch (M) {
                            E(M);
                          }
                        }
                      : b;
                  }
                  var x,
                    E,
                    A = new t(function (R, b) {
                      ((x = R), (E = b));
                    });
                  return (this.Te(m(f, x), m(g, E)), A);
                }),
                (t.prototype.catch = function (f) {
                  return this.then(void 0, f);
                }),
                (t.prototype.Te = function (f, g) {
                  function m() {
                    switch (x.h) {
                      case 1:
                        f(x.i);
                        break;
                      case 2:
                        g(x.i);
                        break;
                      default:
                        throw Error("Unexpected state: " + x.h);
                    }
                  }
                  var x = this;
                  (this.g == null ? c.h(m) : this.g.push(m), (this.o = !0));
                }),
                (t.resolve = s),
                (t.reject = function (f) {
                  return new t(function (g, m) {
                    m(f);
                  });
                }),
                (t.race = function (f) {
                  return new t(function (g, m) {
                    for (var x = I(f), E = x.next(); !E.done; E = x.next()) s(E.value).Te(g, m);
                  });
                }),
                (t.all = function (f) {
                  var g = I(f),
                    m = g.next();
                  return m.done
                    ? s([])
                    : new t(function (x, E) {
                        function A(D) {
                          return function (M) {
                            ((R[D] = M), b--, b == 0 && x(R));
                          };
                        }
                        var R = [],
                          b = 0;
                        do (R.push(void 0), b++, s(m.value).Te(A(R.length - 1), E), (m = g.next()));
                        while (!m.done);
                      });
                }),
                t
              );
            });
            function Je(e, t) {
              return Object.prototype.hasOwnProperty.call(e, t);
            }
            (w("WeakMap", function (e) {
              function t(m) {
                if (((this.g = (g += Math.random() + 1).toString()), m)) {
                  m = I(m);
                  for (var x; !(x = m.next()).done; ) ((x = x.value), this.set(x[0], x[1]));
                }
              }
              function r() {}
              function s(m) {
                var x = typeof m;
                return (x === "object" && m !== null) || x === "function";
              }
              function a(m) {
                if (!Je(m, f)) {
                  var x = new r();
                  v(m, f, { value: x });
                }
              }
              function c(m) {
                var x = Object[m];
                x &&
                  (Object[m] = function (E) {
                    return E instanceof r ? E : (Object.isExtensible(E) && a(E), x(E));
                  });
              }
              if (
                (function () {
                  if (!e || !Object.seal) return !1;
                  try {
                    var m = Object.seal({}),
                      x = Object.seal({}),
                      E = new e([
                        [m, 2],
                        [x, 3],
                      ]);
                    return E.get(m) != 2 || E.get(x) != 3
                      ? !1
                      : (E.delete(m), E.set(x, 4), !E.has(m) && E.get(x) == 4);
                  } catch (A) {
                    return !1;
                  }
                })()
              )
                return e;
              var f = "$jscomp_hidden_" + Math.random();
              (c("freeze"), c("preventExtensions"), c("seal"));
              var g = 0;
              return (
                (t.prototype.set = function (m, x) {
                  if (!s(m)) throw Error("Invalid WeakMap key");
                  if ((a(m), !Je(m, f))) throw Error("WeakMap key fail: " + m);
                  return ((m[f][this.g] = x), this);
                }),
                (t.prototype.get = function (m) {
                  return s(m) && Je(m, f) ? m[f][this.g] : void 0;
                }),
                (t.prototype.has = function (m) {
                  return s(m) && Je(m, f) && Je(m[f], this.g);
                }),
                (t.prototype.delete = function (m) {
                  return s(m) && Je(m, f) && Je(m[f], this.g) ? delete m[f][this.g] : !1;
                }),
                t
              );
            }),
              w("Map", function (e) {
                function t() {
                  var g = {};
                  return (g.xc = g.next = g.head = g);
                }
                function r(g, m) {
                  var x = g[1];
                  return ot(function () {
                    if (x) {
                      for (; x.head != g[1]; ) x = x.xc;
                      for (; x.next != x.head; ) return ((x = x.next), { done: !1, value: m(x) });
                      x = null;
                    }
                    return { done: !0, value: void 0 };
                  });
                }
                function s(g, m) {
                  var x = m && typeof m;
                  x == "object" || x == "function"
                    ? c.has(m)
                      ? (x = c.get(m))
                      : ((x = "" + ++f), c.set(m, x))
                    : (x = "p_" + m);
                  var E = g[0][x];
                  if (E && Je(g[0], x))
                    for (g = 0; g < E.length; g++) {
                      var A = E[g];
                      if ((m !== m && A.key !== A.key) || m === A.key)
                        return { id: x, list: E, index: g, entry: A };
                    }
                  return { id: x, list: E, index: -1, entry: void 0 };
                }
                function a(g) {
                  if (((this[0] = {}), (this[1] = t()), (this.size = 0), g)) {
                    g = I(g);
                    for (var m; !(m = g.next()).done; ) ((m = m.value), this.set(m[0], m[1]));
                  }
                }
                if (
                  (function () {
                    if (
                      !e ||
                      typeof e != "function" ||
                      !e.prototype.entries ||
                      typeof Object.seal != "function"
                    )
                      return !1;
                    try {
                      var g = Object.seal({ x: 4 }),
                        m = new e(I([[g, "s"]]));
                      if (
                        m.get(g) != "s" ||
                        m.size != 1 ||
                        m.get({ x: 4 }) ||
                        m.set({ x: 4 }, "t") != m ||
                        m.size != 2
                      )
                        return !1;
                      var x = m.entries(),
                        E = x.next();
                      return E.done || E.value[0] != g || E.value[1] != "s"
                        ? !1
                        : ((E = x.next()),
                          !(E.done || E.value[0].x != 4 || E.value[1] != "t" || !x.next().done));
                    } catch (A) {
                      return !1;
                    }
                  })()
                )
                  return e;
                var c = new WeakMap();
                ((a.prototype.set = function (g, m) {
                  g = g === 0 ? 0 : g;
                  var x = s(this, g);
                  return (
                    x.list || (x.list = this[0][x.id] = []),
                    x.entry
                      ? (x.entry.value = m)
                      : ((x.entry = { next: this[1], xc: this[1].xc, head: this[1], key: g, value: m }),
                        x.list.push(x.entry),
                        (this[1].xc.next = x.entry),
                        (this[1].xc = x.entry),
                        this.size++),
                    this
                  );
                }),
                  (a.prototype.delete = function (g) {
                    return (
                      (g = s(this, g)),
                      g.entry && g.list
                        ? (g.list.splice(g.index, 1),
                          g.list.length || delete this[0][g.id],
                          (g.entry.xc.next = g.entry.next),
                          (g.entry.next.xc = g.entry.xc),
                          (g.entry.head = null),
                          this.size--,
                          !0)
                        : !1
                    );
                  }),
                  (a.prototype.clear = function () {
                    ((this[0] = {}), (this[1] = this[1].xc = t()), (this.size = 0));
                  }),
                  (a.prototype.has = function (g) {
                    return !!s(this, g).entry;
                  }),
                  (a.prototype.get = function (g) {
                    return (g = s(this, g).entry) && g.value;
                  }),
                  (a.prototype.entries = function () {
                    return r(this, function (g) {
                      return [g.key, g.value];
                    });
                  }),
                  (a.prototype.keys = function () {
                    return r(this, function (g) {
                      return g.key;
                    });
                  }),
                  (a.prototype.values = function () {
                    return r(this, function (g) {
                      return g.value;
                    });
                  }),
                  (a.prototype.forEach = function (g, m) {
                    for (var x = this.entries(), E; !(E = x.next()).done; )
                      ((E = E.value), g.call(m, E[1], E[0], this));
                  }),
                  (a.prototype[Symbol.iterator] = a.prototype.entries));
                var f = 0;
                return a;
              }),
              w("Set", function (e) {
                function t(r) {
                  if (((this.g = new Map()), r)) {
                    r = I(r);
                    for (var s; !(s = r.next()).done; ) this.add(s.value);
                  }
                  this.size = this.g.size;
                }
                return (function () {
                  if (
                    !e ||
                    typeof e != "function" ||
                    !e.prototype.entries ||
                    typeof Object.seal != "function"
                  )
                    return !1;
                  try {
                    var r = Object.seal({ x: 4 }),
                      s = new e(I([r]));
                    if (
                      !s.has(r) ||
                      s.size != 1 ||
                      s.add(r) != s ||
                      s.size != 1 ||
                      s.add({ x: 4 }) != s ||
                      s.size != 2
                    )
                      return !1;
                    var a = s.entries(),
                      c = a.next();
                    return c.done || c.value[0] != r || c.value[1] != r
                      ? !1
                      : ((c = a.next()),
                        c.done || c.value[0] == r || c.value[0].x != 4 || c.value[1] != c.value[0]
                          ? !1
                          : a.next().done);
                  } catch (f) {
                    return !1;
                  }
                })()
                  ? e
                  : ((t.prototype.add = function (r) {
                      return ((r = r === 0 ? 0 : r), this.g.set(r, r), (this.size = this.g.size), this);
                    }),
                    (t.prototype.delete = function (r) {
                      return ((r = this.g.delete(r)), (this.size = this.g.size), r);
                    }),
                    (t.prototype.clear = function () {
                      (this.g.clear(), (this.size = 0));
                    }),
                    (t.prototype.has = function (r) {
                      return this.g.has(r);
                    }),
                    (t.prototype.entries = function () {
                      return this.g.entries();
                    }),
                    (t.prototype.values = function () {
                      return this.g.values();
                    }),
                    (t.prototype.keys = t.prototype.values),
                    (t.prototype[Symbol.iterator] = t.prototype.values),
                    (t.prototype.forEach = function (r, s) {
                      var a = this;
                      this.g.forEach(function (c) {
                        return r.call(s, c, c, a);
                      });
                    }),
                    t);
              }));
            function Ut(e, t, r) {
              e instanceof String && (e = String(e));
              for (var s = e.length, a = 0; a < s; a++) {
                var c = e[a];
                if (t.call(r, c, a, e)) return { ni: a, v: c };
              }
              return { ni: -1, v: void 0 };
            }
            w("Array.prototype.findIndex", function (e) {
              return (
                e ||
                function (t, r) {
                  return Ut(this, t, r).ni;
                }
              );
            });
            function St(e, t) {
              e instanceof String && (e += "");
              var r = 0,
                s = !1,
                a = {
                  next: function () {
                    if (!s && r < e.length) {
                      var c = r++;
                      return { value: t(c, e[c]), done: !1 };
                    }
                    return ((s = !0), { done: !0, value: void 0 });
                  },
                };
              return (
                (a[Symbol.iterator] = function () {
                  return a;
                }),
                a
              );
            }
            (w("Array.prototype.values", function (e) {
              return (
                e ||
                function () {
                  return St(this, function (t, r) {
                    return r;
                  });
                }
              );
            }),
              w("Array.from", function (e) {
                return (
                  e ||
                  function (t, r, s) {
                    r =
                      r != null
                        ? r
                        : function (g) {
                            return g;
                          };
                    var a = [],
                      c = typeof Symbol < "u" && Symbol.iterator && t[Symbol.iterator];
                    if (typeof c == "function") {
                      t = c.call(t);
                      for (var f = 0; !(c = t.next()).done; ) a.push(r.call(s, c.value, f++));
                    } else for (c = t.length, f = 0; f < c; f++) a.push(r.call(s, t[f], f));
                    return a;
                  }
                );
              }),
              w("Array.prototype.keys", function (e) {
                return (
                  e ||
                  function () {
                    return St(this, function (t) {
                      return t;
                    });
                  }
                );
              }));
            function Xt(e, t, r) {
              if (e == null)
                throw new TypeError(
                  "The 'this' value for String.prototype." + r + " must not be null or undefined",
                );
              if (t instanceof RegExp)
                throw new TypeError(
                  "First argument to String.prototype." + r + " must not be a regular expression",
                );
              return e + "";
            }
            (w("String.prototype.startsWith", function (e) {
              return (
                e ||
                function (t, r) {
                  var s = Xt(this, t, "startsWith"),
                    a = s.length,
                    c = t.length;
                  r = Math.max(0, Math.min(r | 0, s.length));
                  for (var f = 0; f < c && r < a; ) if (s[r++] != t[f++]) return !1;
                  return f >= c;
                }
              );
            }),
              w("Object.is", function (e) {
                return (
                  e ||
                  function (t, r) {
                    return t === r ? t !== 0 || 1 / t === 1 / r : t !== t && r !== r;
                  }
                );
              }),
              w("Array.prototype.includes", function (e) {
                return (
                  e ||
                  function (t, r) {
                    var s = this;
                    s instanceof String && (s = String(s));
                    var a = s.length;
                    for (r = r || 0, r < 0 && (r = Math.max(r + a, 0)); r < a; r++) {
                      var c = s[r];
                      if (c === t || Object.is(c, t)) return !0;
                    }
                    return !1;
                  }
                );
              }),
              w("String.prototype.includes", function (e) {
                return (
                  e ||
                  function (t, r) {
                    return Xt(this, t, "includes").indexOf(t, r || 0) !== -1;
                  }
                );
              }),
              w("String.fromCodePoint", function (e) {
                return (
                  e ||
                  function (t) {
                    for (var r = "", s = 0; s < arguments.length; s++) {
                      var a = Number(arguments[s]);
                      if (a < 0 || a > 1114111 || a !== Math.floor(a))
                        throw new RangeError("invalid_code_point " + a);
                      a <= 65535
                        ? (r += String.fromCharCode(a))
                        : ((a -= 65536),
                          (r += String.fromCharCode(((a >>> 10) & 1023) | 55296)),
                          (r += String.fromCharCode((a & 1023) | 56320)));
                    }
                    return r;
                  }
                );
              }),
              w("WeakSet", function (e) {
                function t(r) {
                  if (((this.g = new WeakMap()), r)) {
                    r = I(r);
                    for (var s; !(s = r.next()).done; ) this.add(s.value);
                  }
                }
                return (function () {
                  if (!e || !Object.seal) return !1;
                  try {
                    var r = Object.seal({}),
                      s = Object.seal({}),
                      a = new e([r]);
                    return !a.has(r) || a.has(s) ? !1 : (a.delete(r), a.add(s), !a.has(r) && a.has(s));
                  } catch (c) {
                    return !1;
                  }
                })()
                  ? e
                  : ((t.prototype.add = function (r) {
                      return (this.g.set(r, !0), this);
                    }),
                    (t.prototype.has = function (r) {
                      return this.g.has(r);
                    }),
                    (t.prototype.delete = function (r) {
                      return this.g.delete(r);
                    }),
                    t);
              }),
              w("Array.prototype.find", function (e) {
                return (
                  e ||
                  function (t, r) {
                    return Ut(this, t, r).v;
                  }
                );
              }),
              w("Object.entries", function (e) {
                return (
                  e ||
                  function (t) {
                    var r = [],
                      s;
                    for (s in t) Je(t, s) && r.push([s, t[s]]);
                    return r;
                  }
                );
              }));
            var vn =
              typeof Object.assign == "function"
                ? Object.assign
                : function (e, t) {
                    if (e == null) throw new TypeError("No nullish arg");
                    e = Object(e);
                    for (var r = 1; r < arguments.length; r++) {
                      var s = arguments[r];
                      if (s) for (var a in s) Je(s, a) && (e[a] = s[a]);
                    }
                    return e;
                  };
            (w("Object.assign", function (e) {
              return e || vn;
            }),
              w("Promise.prototype.finally", function (e) {
                return (
                  e ||
                  function (t) {
                    return this.then(
                      function (r) {
                        return Promise.resolve(t()).then(function () {
                          return r;
                        });
                      },
                      function (r) {
                        return Promise.resolve(t()).then(function () {
                          throw r;
                        });
                      },
                    );
                  }
                );
              }),
              w("Array.prototype.entries", function (e) {
                return (
                  e ||
                  function () {
                    return St(this, function (t, r) {
                      return [t, r];
                    });
                  }
                );
              }),
              w("Number.isNaN", function (e) {
                return (
                  e ||
                  function (t) {
                    return typeof t == "number" && isNaN(t);
                  }
                );
              }),
              w("String.prototype.repeat", function (e) {
                return (
                  e ||
                  function (t) {
                    var r = Xt(this, null, "repeat");
                    if (t < 0 || t > 1342177279) throw new RangeError("Invalid count value");
                    t |= 0;
                    for (var s = ""; t; ) (t & 1 && (s += r), (t >>>= 1) && (r += r));
                    return s;
                  }
                );
              }),
              w("Number.EPSILON", function () {
                return 2220446049250313e-31;
              }),
              w("Number.MAX_SAFE_INTEGER", function () {
                return 9007199254740991;
              }),
              w("Number.isFinite", function (e) {
                return (
                  e ||
                  function (t) {
                    return typeof t != "number" ? !1 : !isNaN(t) && t !== 1 / 0 && t !== -1 / 0;
                  }
                );
              }),
              w("Object.values", function (e) {
                return (
                  e ||
                  function (t) {
                    var r = [],
                      s;
                    for (s in t) Je(t, s) && r.push(t[s]);
                    return r;
                  }
                );
              }),
              w("Math.log2", function (e) {
                return (
                  e ||
                  function (t) {
                    return Math.log(t) / Math.LN2;
                  }
                );
              }),
              w("String.prototype.endsWith", function (e) {
                return (
                  e ||
                  function (t, r) {
                    var s = Xt(this, t, "endsWith");
                    (r === void 0 && (r = s.length), (r = Math.max(0, Math.min(r | 0, s.length))));
                    for (var a = t.length; a > 0 && r > 0; ) if (s[--r] != t[--a]) return !1;
                    return a <= 0;
                  }
                );
              }),
              w("Math.trunc", function (e) {
                return (
                  e ||
                  function (t) {
                    if (((t = Number(t)), isNaN(t) || t === 1 / 0 || t === -1 / 0 || t === 0)) return t;
                    var r = Math.floor(Math.abs(t));
                    return t < 0 ? -r : r;
                  }
                );
              }));
            var Rn = this || self;
            function Ee(e, t) {
              e = e.split(".");
              var r = Rn;
              e[0] in r || typeof r.execScript > "u" || r.execScript("var " + e[0]);
              for (var s; e.length && (s = e.shift()); )
                e.length || t === void 0
                  ? r[s] && r[s] !== Object.prototype[s]
                    ? (r = r[s])
                    : (r = r[s] = {})
                  : (r[s] = t);
            }
            function Di(e) {
              ((this.g = Math.exp(Math.log(0.5) / e)), (this.i = this.h = 0));
            }
            Di.prototype.sample = function (e, t) {
              var r = Math.pow(this.g, e);
              ((t = t * (1 - r) + r * this.h), isNaN(t) || ((this.h = t), (this.i += e)));
            };
            function ai(e) {
              return e.h / (1 - Math.pow(e.g, e.i));
            }
            function xi() {
              ((this.h = new Di(2)), (this.j = new Di(5)), (this.g = 0), (this.i = 128e3), (this.l = 16e3));
            }
            ((xi.prototype.configure = function (e) {
              ((this.i = e.minTotalBytes),
                (this.l = e.minBytes),
                (this.h.g = Math.exp(Math.log(0.5) / e.fastHalfLife)),
                (this.j.g = Math.exp(Math.log(0.5) / e.slowHalfLife)));
            }),
              (xi.prototype.sample = function (e, t) {
                if (!(t < this.l)) {
                  var r = (8e3 * t) / e;
                  ((e /= 1e3), (this.g += t), this.h.sample(e, r), this.j.sample(e, r));
                }
              }),
              (xi.prototype.getBandwidthEstimate = function (e) {
                return this.g < this.i ? e : Math.min(ai(this.h), ai(this.j));
              }));
            function Et() {}
            function Bt() {}
            function He() {}
            function Cn(e) {
              var t = Qe.apply(1, arguments);
              Js.has(e) || (Js.add(e), He.apply(Et, V(t)));
            }
            function Vn() {}
            function Wr() {}
            function Or() {}
            var Js = new Set();
            l.console &&
              (new Map()
                .set(1, function () {
                  return console.error.apply(console, V(Qe.apply(0, arguments)));
                })
                .set(2, function () {
                  return console.warn.apply(console, V(Qe.apply(0, arguments)));
                })
                .set(3, function () {
                  return console.info.apply(console, V(Qe.apply(0, arguments)));
                })
                .set(4, function () {
                  return console.log.apply(console, V(Qe.apply(0, arguments)));
                })
                .set(5, function () {
                  return console.debug.apply(console, V(Qe.apply(0, arguments)));
                })
                .set(6, function () {
                  return console.debug.apply(console, V(Qe.apply(0, arguments)));
                }),
              (He = function () {
                return console.warn.apply(console, V(Qe.apply(0, arguments)));
              }),
              (Bt = function () {
                console.error.apply(console, V(Qe.apply(0, arguments)));
              }));
            function zr(e, t) {
              return typeof e == "number" && typeof t == "number" && isNaN(e) && isNaN(t) ? !0 : e === t;
            }
            function ki(e, t) {
              ((t = e.indexOf(t)), t > -1 && e.splice(t, 1));
            }
            function nr(e, t, r) {
              if ((r || (r = zr), e.length != t.length)) return !1;
              ((t = t.slice()), (e = I(e)));
              for (var s = e.next(), a = {}; !s.done; a = { ui: void 0 }, s = e.next()) {
                if (
                  ((a.ui = s.value),
                  (s = t.findIndex(
                    (function (c) {
                      return function (f) {
                        return r(c.ui, f);
                      };
                    })(a),
                  )),
                  s == -1)
                )
                  return !1;
                ((t[s] = t[t.length - 1]), t.pop());
              }
              return t.length == 0;
            }
            function Nr(e, t, r) {
              if (e === t) return !0;
              if (!e || !t) return e == t;
              if ((r || (r = zr), e.length != t.length)) return !1;
              for (var s = 0; s < e.length; s++) if (!r(e[s], t[s])) return !1;
              return !0;
            }
            function La() {
              this.g = new Map();
            }
            ((d = La.prototype),
              (d.push = function (e, t) {
                this.g.has(e) ? this.g.get(e).push(t) : this.g.set(e, [t]);
              }),
              (d.get = function (e) {
                return this.g.has(e) ? this.g.get(e).slice() : null;
              }),
              (d.remove = function (e, t) {
                if (this.g.has(e)) {
                  var r = this.g.get(e).filter(function (s) {
                    return s != t;
                  });
                  (this.g.set(e, r), r.length || this.g.delete(e));
                }
              }),
              (d.forEach = function (e) {
                this.g.forEach(function (t, r) {
                  e(r, t);
                });
              }),
              (d.size = function () {
                return this.g.size;
              }),
              (d.keys = function () {
                return Array.from(this.g.keys());
              }));
            function gt() {
              this.g = new La();
            }
            ((d = gt.prototype),
              (d.release = function () {
                (this.Qa(), (this.g = null));
              }),
              (d.D = function (e, t, r, s) {
                this.g && ((e = new xu(e, t, r, s)), this.g.push(t, e));
              }),
              (d.Aa = function (e, t, r, s) {
                function a(f) {
                  (c.Ma(e, t, a), r(f));
                }
                var c = this;
                this.D(e, t, a, s);
              }),
              (d.Ma = function (e, t, r) {
                if (this.g) {
                  var s = this.g.get(t) || [];
                  s = I(s);
                  for (var a = s.next(); !a.done; a = s.next())
                    ((a = a.value), a.target != e || (r != a.listener && r) || (a.Ma(), this.g.remove(t, a)));
                }
              }),
              (d.Qa = function () {
                if (this.g) {
                  for (var e = [], t = I(this.g.g.values()), r = t.next(); !r.done; r = t.next())
                    e.push.apply(e, V(r.value));
                  for (e = I(e), t = e.next(); !t.done; t = e.next()) t.value.Ma();
                  this.g.g.clear();
                }
              }),
              Ee("shaka.util.EventManager", gt),
              (gt.prototype.removeAll = gt.prototype.Qa),
              (gt.prototype.unlisten = gt.prototype.Ma),
              (gt.prototype.listenOnce = gt.prototype.Aa),
              (gt.prototype.listen = gt.prototype.D),
              (gt.prototype.release = gt.prototype.release));
            function xu(e, t, r, s) {
              ((this.target = e),
                (this.type = t),
                (this.listener = r),
                (this.g = Uo(e, s)),
                this.target.addEventListener(t, r, this.g));
            }
            xu.prototype.Ma = function () {
              (this.target.removeEventListener(this.type, this.listener, this.g),
                (this.listener = this.target = null),
                (this.g = !1));
            };
            function Uo(e, t) {
              if (t == null) return !1;
              if (typeof t == "boolean") return t;
              var r = new Set(["passive", "capture"]);
              return (
                Object.keys(t).filter(function (s) {
                  return !r.has(s);
                }),
                tP(e) ? t : t.capture || !1
              );
            }
            function tP(e) {
              var t = DS;
              if (t == null) {
                t = !1;
                try {
                  var r = {},
                    s = {
                      get: function () {
                        return ((t = !0), !1);
                      },
                    };
                  (Object.defineProperty(r, "passive", s),
                    Object.defineProperty(r, "capture", s),
                    (s = function () {}),
                    e.addEventListener("test", s, r),
                    e.removeEventListener("test", s, r));
                } catch (a) {
                  t = !1;
                }
                DS = t;
              }
              return t || !1;
            }
            var DS = void 0;
            Ee("shaka.config.AutoShowText", {
              NEVER: 0,
              ALWAYS: 1,
              IF_PREFERRED_TEXT_LANGUAGE: 2,
              IF_SUBTITLES_MAY_BE_NEEDED: 3,
            });
            function Kt(e) {
              ((this.h = e), (this.g = void 0));
            }
            Kt.prototype.value = function () {
              return (this.g === void 0 && (this.g = this.h()), this.g);
            };
            /*
 @license
 Shaka Player
 Copyright 2025 Google LLC
 SPDX-License-Identifier: Apache-2.0
*/ function tt() {
              return nP.value();
            }
            var Fr = null,
              am = null,
              nP = new Kt(function () {
                var e = void 0;
                return (Fr && (e = Fr()), !e && am && (e = am()), e);
              });
            function lm(e, t) {
              ((this.g = e), (this.h = t));
            }
            lm.prototype.toString = function () {
              return "v" + this.g + "." + this.h;
            };
            function ft(e, t) {
              var r = new lm(5, 0),
                s = kS,
                a = s.g,
                c = r.h - a.h;
              ((r.g - a.g || c) > 0 ? s.i : s.h)(s.g, r, e, t);
            }
            function iP(e, t, r, s) {
              He(
                [
                  r,
                  "has been deprecated and will be removed in",
                  t,
                  ". We are currently at version",
                  e,
                  ". Additional information:",
                  s,
                ].join(" "),
              );
            }
            function rP(e, t, r, s) {
              Bt(
                [
                  r,
                  "has been deprecated and has been removed in",
                  t,
                  ". We are now at version",
                  e,
                  ". Additional information:",
                  s,
                ].join(" "),
              );
            }
            var kS = null;
            /*
 @license
 Copyright 2008 The Closure Library Authors
 SPDX-License-Identifier: Apache-2.0
*/ var sP = RegExp(
              "^(?:([^:/?#.]+):)?(?://(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#(.*))?$",
            );
            /*
 @license
 Copyright 2006 The Closure Library Authors
 SPDX-License-Identifier: Apache-2.0
*/ function un(e) {
              var t;
              e instanceof un
                ? (Gd(this, e.fc),
                  (this.hd = e.hd),
                  jd(this, e.Db),
                  um(this, e.Dd),
                  (this.Sb = e.Sb),
                  Bo(this, e.g.clone()),
                  (this.Rc = e.Rc))
                : e && (t = String(e).match(sP))
                  ? (Gd(this, t[1] || "", !0),
                    (this.hd = _a(t[2] || "")),
                    jd(this, t[3] || "", !0),
                    um(this, t[4]),
                    (this.Sb = _a(t[5] || "", !0)),
                    Bo(this, t[6] || "", !0),
                    (this.Rc = _a(t[7] || "")))
                  : (this.g = new ba(null));
            }
            ((d = un.prototype),
              (d.fc = ""),
              (d.hd = ""),
              (d.Db = ""),
              (d.Dd = null),
              (d.Sb = ""),
              (d.Rc = ""),
              (d.toString = function () {
                var e = [],
                  t = this.fc;
                if ((t && e.push(Tu(t, MS, !0), ":"), (t = this.Db))) {
                  e.push("//");
                  var r = this.hd;
                  (r && e.push(Tu(r, MS, !0), "@"),
                    e.push(encodeURIComponent(t).replace(/%25([0-9a-fA-F]{2})/g, "%$1")),
                    (t = this.Dd),
                    t != null && e.push(":", String(t)));
                }
                return (
                  (t = this.Sb) &&
                    (this.Db && t.charAt(0) != "/" && e.push("/"),
                    e.push(Tu(t, t.charAt(0) == "/" ? lP : aP, !0))),
                  (t = this.g.toString()) && e.push("?", t),
                  (t = this.Rc) && e.push("#", Tu(t, cP)),
                  e.join("")
                );
              }),
              (d.resolve = function (e) {
                var t = this.clone();
                t.fc === "data" && (t = new un());
                var r = !!e.fc;
                (r ? Gd(t, e.fc) : (r = !!e.hd),
                  r ? (t.hd = e.hd) : (r = !!e.Db),
                  r ? jd(t, e.Db) : (r = e.Dd != null));
                var s = e.Sb;
                if (r) um(t, e.Dd);
                else if ((r = !!e.Sb)) {
                  if (s.charAt(0) != "/")
                    if (this.Db && !this.Sb) s = "/" + s;
                    else {
                      var a = t.Sb.lastIndexOf("/");
                      a != -1 && (s = t.Sb.substr(0, a + 1) + s);
                    }
                  if (s == ".." || s == ".") s = "";
                  else if (s.indexOf("./") != -1 || s.indexOf("/.") != -1) {
                    ((a = s.lastIndexOf("/", 0) == 0), (s = s.split("/")));
                    for (var c = [], f = 0; f < s.length; ) {
                      var g = s[f++];
                      g == "."
                        ? a && f == s.length && c.push("")
                        : g == ".."
                          ? ((c.length > 1 || (c.length == 1 && c[0] != "")) && c.pop(),
                            a && f == s.length && c.push(""))
                          : (c.push(g), (a = !0));
                    }
                    s = c.join("/");
                  }
                }
                return (
                  r ? (t.Sb = s) : (r = e.g.toString() !== ""),
                  r ? Bo(t, e.g.clone()) : (r = !!e.Rc),
                  r && (t.Rc = e.Rc),
                  t
                );
              }),
              (d.clone = function () {
                return new un(this);
              }));
            function Gd(e, t, r) {
              ((e.fc = r ? _a(t, !0) : t), e.fc && (e.fc = e.fc.replace(/:$/, "")));
            }
            function jd(e, t, r) {
              e.Db = r ? _a(t, !0) : t;
            }
            function um(e, t) {
              if (t) {
                if (((t = Number(t)), isNaN(t) || t < 0)) throw Error("Bad port number " + t);
                e.Dd = t;
              } else e.Dd = null;
            }
            function Bo(e, t, r) {
              t instanceof ba ? (e.g = t) : (r || (t = Tu(t, uP)), (e.g = new ba(t)));
            }
            function _a(e, t) {
              return e ? (t ? decodeURI(e) : decodeURIComponent(e)) : "";
            }
            function Tu(e, t, r) {
              return e != null
                ? ((e = encodeURI(e).replace(t, oP)), r && (e = e.replace(/%25([0-9a-fA-F]{2})/g, "%$1")), e)
                : null;
            }
            function oP(e) {
              return ((e = e.charCodeAt(0)), "%" + ((e >> 4) & 15).toString(16) + (e & 15).toString(16));
            }
            var MS = /[#\/\?@]/g,
              aP = /[#\?:]/g,
              lP = /[#\?]/g,
              uP = /[#\?@]/g,
              cP = /#/g;
            function ba(e) {
              this.g = e || null;
            }
            function Vd(e) {
              if (!e.fb && ((e.fb = new Map()), (e.Vd = 0), e.g))
                for (var t = e.g.split("&"), r = 0; r < t.length; r++) {
                  var s = t[r].indexOf("="),
                    a = null;
                  if (s >= 0) {
                    var c = t[r].substring(0, s);
                    a = t[r].substring(s + 1);
                  } else c = t[r];
                  ((c = decodeURIComponent(c)), (a = a || ""), e.add(c, decodeURIComponent(a)));
                }
            }
            ((d = ba.prototype), (d.fb = null), (d.Vd = null));
            function PS(e) {
              return (Vd(e), e.Vd);
            }
            ((d.add = function (e, t) {
              (Vd(this), (this.g = null));
              var r = this.fb.has(e) ? this.fb.get(e) : null;
              return (r || this.fb.set(e, (r = [])), r.push(t), this.Vd++, this);
            }),
              (d.set = function (e, t) {
                return (
                  Vd(this),
                  (this.g = null),
                  this.fb.has(e) ? this.fb.set(e, [t]) : this.add(e, t),
                  this
                );
              }),
              (d.get = function (e) {
                return (Vd(this), this.fb.get(e) || []);
              }),
              (d.toString = function () {
                if (this.g) return this.g;
                if (!this.fb || !this.fb.size) return "";
                for (var e = [], t = I(this.fb.keys()), r = t.next(); !r.done; r = t.next()) {
                  var s = r.value;
                  ((r = encodeURIComponent(s)), (s = this.fb.get(s)));
                  for (var a = 0; a < s.length; a++) {
                    var c = r;
                    (s[a] !== "" && (c += "=" + encodeURIComponent(s[a])), e.push(c));
                  }
                }
                return (this.g = e.join("&"));
              }),
              (d.clone = function () {
                var e = new ba();
                if (((e.g = this.g), this.fb)) {
                  for (var t = new Map(), r = I(this.fb), s = r.next(); !s.done; s = r.next()) {
                    var a = I(s.value);
                    ((s = a.next().value), (a = a.next().value), t.set(s, a.concat()));
                  }
                  ((e.fb = t), (e.Vd = this.Vd));
                }
                return e;
              }));
            function Da() {}
            function fs(e, t) {
              if (!e && !t) return !0;
              if (!e || !t || e.byteLength != t.byteLength) return !1;
              if (
                (ArrayBuffer.isView(e) ? e.buffer : e) == (ArrayBuffer.isView(t) ? t.buffer : t) &&
                (e.byteOffset || 0) == (t.byteOffset || 0)
              )
                return !0;
              var r = We(e);
              t = We(t);
              for (var s = 0; s < e.byteLength; s++) if (r[s] != t[s]) return !1;
              return !0;
            }
            function ir(e) {
              return ArrayBuffer.isView(e)
                ? e.byteOffset == 0 && e.byteLength == e.buffer.byteLength
                  ? e.buffer
                  : new Uint8Array(e).buffer
                : e;
            }
            function We(e, t, r) {
              return ((r = r === void 0 ? 1 / 0 : r), cm(e, t === void 0 ? 0 : t, r, Uint8Array));
            }
            function OS(e, t, r) {
              return ((r = r === void 0 ? 1 / 0 : r), cm(e, t === void 0 ? 0 : t, r, Uint16Array));
            }
            function Ti(e, t, r) {
              return ((r = r === void 0 ? 1 / 0 : r), cm(e, t === void 0 ? 0 : t, r, DataView));
            }
            function cm(e, t, r, s) {
              var a = ArrayBuffer.isView(e) ? e.buffer : e,
                c = 1;
              "BYTES_PER_ELEMENT" in s && (c = s.BYTES_PER_ELEMENT);
              var f = ((e.byteOffset || 0) + e.byteLength) / c;
              return (
                (e = Math.floor(Math.max(0, Math.min(((e.byteOffset || 0) + t) / c, f)))),
                new s(a, e, Math.floor(Math.min(e + Math.max(r, 0), f)) - e)
              );
            }
            (Ee("shaka.util.BufferUtils", Da),
              (Da.toDataView = Ti),
              (Da.toUint16 = OS),
              (Da.toUint8 = We),
              (Da.toArrayBuffer = ir),
              (Da.equal = fs));
            function NS(e, t) {
              if (e === t || !e.length || !t.length) return !0;
              e = I(e);
              for (var r = e.next(); !r.done; r = e.next()) {
                if (((r = r.value), Hd(r))) return !0;
                for (var s = I(t), a = s.next(); !a.done; a = s.next())
                  if (((a = a.value), r.keySystem === a.keySystem || Hd(a))) return !0;
              }
              return !1;
            }
            function FS(e, t) {
              if (!e.length) return t;
              if (!t.length) return e;
              var r = [];
              e = I(e);
              for (var s = e.next(); !s.done; s = e.next()) {
                s = s.value;
                for (var a = I(t), c = a.next(); !c.done; c = a.next())
                  if (((c = c.value), s.keySystem == c.keySystem)) {
                    a = new Map();
                    for (
                      var f = I((s.initData || []).concat(c.initData || [])), g = f.next();
                      !g.done;
                      g = f.next()
                    )
                      ((g = g.value), a.set(g.keyId, g));
                    ((a = Array.from(a.values())),
                      (f =
                        s.keyIds && c.keyIds
                          ? new Set([].concat(V(s.keyIds), V(c.keyIds)))
                          : s.keyIds || c.keyIds),
                      r.push({
                        keySystem: s.keySystem,
                        licenseServerUri: s.licenseServerUri || c.licenseServerUri,
                        distinctiveIdentifierRequired:
                          s.distinctiveIdentifierRequired || c.distinctiveIdentifierRequired,
                        persistentStateRequired: s.persistentStateRequired || c.persistentStateRequired,
                        videoRobustness: s.videoRobustness || c.videoRobustness,
                        audioRobustness: s.audioRobustness || c.audioRobustness,
                        serverCertificate: s.serverCertificate || c.serverCertificate,
                        serverCertificateUri: s.serverCertificateUri || c.serverCertificateUri,
                        initData: a,
                        keyIds: f,
                      }));
                    break;
                  } else Hd(s) ? r.push(s) : Hd(c) && r.push(c);
              }
              return r;
            }
            function dm(e) {
              return e ? !!e.match(/^com\.(microsoft|chromecast)\.playready/) : !1;
            }
            function Su(e) {
              return e ? !!e.match(/^com\.apple\.fps/) : !1;
            }
            function Hd(e) {
              return (e = e.licenseServerUri) ? e.startsWith("data:application/json;base64,") : !1;
            }
            function hm(e, t, r, s) {
              return (
                (s = []
                  .concat(V(new Set(s)))
                  .sort()
                  .join("#")),
                e + "#" + t + "#" + r + "#" + s
              );
            }
            var Kd = new Kt(function () {
                return ir(new Uint8Array([0]));
              }),
              ka = new Map();
            function ee(e, t, r) {
              var s = Qe.apply(3, arguments);
              ((this.severity = e),
                (this.category = t),
                (this.code = r),
                (this.data = s),
                (this.handled = !1),
                (this.message = "Shaka Error " + this.code));
              try {
                throw Error(this.message || "Shaka Error");
              } catch (a) {
                this.stack = a.stack;
              }
            }
            ((ee.prototype.toString = function () {
              return "shaka.util.Error " + JSON.stringify(this, null, "  ");
            }),
              Ee("shaka.util.Error", ee),
              (ee.Severity = { RECOVERABLE: 1, CRITICAL: 2 }),
              (ee.Category = {
                NETWORK: 1,
                TEXT: 2,
                MEDIA: 3,
                MANIFEST: 4,
                STREAMING: 5,
                DRM: 6,
                PLAYER: 7,
                CAST: 8,
                STORAGE: 9,
                ADS: 10,
              }),
              (ee.Code = {
                UNSUPPORTED_SCHEME: 1e3,
                BAD_HTTP_STATUS: 1001,
                HTTP_ERROR: 1002,
                TIMEOUT: 1003,
                MALFORMED_DATA_URI: 1004,
                REQUEST_FILTER_ERROR: 1006,
                RESPONSE_FILTER_ERROR: 1007,
                MALFORMED_TEST_URI: 1008,
                UNEXPECTED_TEST_REQUEST: 1009,
                ATTEMPTS_EXHAUSTED: 1010,
                SEGMENT_MISSING: 1011,
                INVALID_TEXT_HEADER: 2e3,
                INVALID_TEXT_CUE: 2001,
                UNABLE_TO_DETECT_ENCODING: 2003,
                BAD_ENCODING: 2004,
                INVALID_XML: 2005,
                INVALID_MP4_TTML: 2007,
                INVALID_MP4_VTT: 2008,
                UNABLE_TO_EXTRACT_CUE_START_TIME: 2009,
                INVALID_MP4_CEA: 2010,
                TEXT_COULD_NOT_GUESS_MIME_TYPE: 2011,
                CANNOT_ADD_EXTERNAL_TEXT_TO_SRC_EQUALS: 2012,
                TEXT_ONLY_WEBVTT_SRC_EQUALS: 2013,
                MISSING_TEXT_PLUGIN: 2014,
                UNSUPPORTED_EXTERNAL_THUMBNAILS_URI: 2017,
                BUFFER_READ_OUT_OF_BOUNDS: 3e3,
                JS_INTEGER_OVERFLOW: 3001,
                EBML_OVERFLOW: 3002,
                EBML_BAD_FLOATING_POINT_SIZE: 3003,
                MP4_SIDX_WRONG_BOX_TYPE: 3004,
                MP4_SIDX_INVALID_TIMESCALE: 3005,
                MP4_SIDX_TYPE_NOT_SUPPORTED: 3006,
                WEBM_CUES_ELEMENT_MISSING: 3007,
                WEBM_EBML_HEADER_ELEMENT_MISSING: 3008,
                WEBM_SEGMENT_ELEMENT_MISSING: 3009,
                WEBM_INFO_ELEMENT_MISSING: 3010,
                WEBM_DURATION_ELEMENT_MISSING: 3011,
                WEBM_CUE_TRACK_POSITIONS_ELEMENT_MISSING: 3012,
                WEBM_CUE_TIME_ELEMENT_MISSING: 3013,
                MEDIA_SOURCE_OPERATION_FAILED: 3014,
                MEDIA_SOURCE_OPERATION_THREW: 3015,
                VIDEO_ERROR: 3016,
                QUOTA_EXCEEDED_ERROR: 3017,
                TRANSMUXING_FAILED: 3018,
                CONTENT_TRANSFORMATION_FAILED: 3019,
                MSS_MISSING_DATA_FOR_TRANSMUXING: 3020,
                MSS_TRANSMUXING_FAILED: 3022,
                TRANSMUXING_NO_VIDEO_DATA: 3023,
                STREAMING_NOT_ALLOWED: 3024,
                UNABLE_TO_GUESS_MANIFEST_TYPE: 4e3,
                DASH_INVALID_XML: 4001,
                DASH_NO_SEGMENT_INFO: 4002,
                DASH_EMPTY_ADAPTATION_SET: 4003,
                DASH_EMPTY_PERIOD: 4004,
                DASH_WEBM_MISSING_INIT: 4005,
                DASH_UNSUPPORTED_CONTAINER: 4006,
                DASH_PSSH_BAD_ENCODING: 4007,
                DASH_NO_COMMON_KEY_SYSTEM: 4008,
                DASH_MULTIPLE_KEY_IDS_NOT_SUPPORTED: 4009,
                DASH_CONFLICTING_KEY_IDS: 4010,
                RESTRICTIONS_CANNOT_BE_MET: 4012,
                HLS_PLAYLIST_HEADER_MISSING: 4015,
                INVALID_HLS_TAG: 4016,
                HLS_INVALID_PLAYLIST_HIERARCHY: 4017,
                DASH_DUPLICATE_REPRESENTATION_ID: 4018,
                HLS_MULTIPLE_MEDIA_INIT_SECTIONS_FOUND: 4020,
                HLS_REQUIRED_ATTRIBUTE_MISSING: 4023,
                HLS_REQUIRED_TAG_MISSING: 4024,
                HLS_COULD_NOT_GUESS_CODECS: 4025,
                HLS_KEYFORMATS_NOT_SUPPORTED: 4026,
                DASH_UNSUPPORTED_XLINK_ACTUATE: 4027,
                DASH_XLINK_DEPTH_LIMIT: 4028,
                CONTENT_UNSUPPORTED_BY_BROWSER: 4032,
                CANNOT_ADD_EXTERNAL_TEXT_TO_LIVE_STREAM: 4033,
                NO_VARIANTS: 4036,
                PERIOD_FLATTENING_FAILED: 4037,
                INCONSISTENT_DRM_ACROSS_PERIODS: 4038,
                HLS_VARIABLE_NOT_FOUND: 4039,
                HLS_MSE_ENCRYPTED_MP2T_NOT_SUPPORTED: 4040,
                HLS_MSE_ENCRYPTED_LEGACY_APPLE_MEDIA_KEYS_NOT_SUPPORTED: 4041,
                NO_WEB_CRYPTO_API: 4042,
                CANNOT_ADD_EXTERNAL_THUMBNAILS_TO_LIVE_STREAM: 4045,
                MSS_INVALID_XML: 4046,
                MSS_LIVE_CONTENT_NOT_SUPPORTED: 4047,
                AES_128_INVALID_IV_LENGTH: 4048,
                AES_128_INVALID_KEY_LENGTH: 4049,
                DASH_CONFLICTING_AES_128: 4050,
                DASH_UNSUPPORTED_AES_128: 4051,
                DASH_INVALID_PATCH: 4052,
                HLS_EMPTY_MEDIA_PLAYLIST: 4053,
                DASH_MSE_ENCRYPTED_LEGACY_APPLE_MEDIA_KEYS_NOT_SUPPORTED: 4054,
                CANNOT_ADD_EXTERNAL_CHAPTERS_TO_LIVE_STREAM: 4055,
                STREAMING_ENGINE_STARTUP_INVALID_STATE: 5006,
                NO_RECOGNIZED_KEY_SYSTEMS: 6e3,
                REQUESTED_KEY_SYSTEM_CONFIG_UNAVAILABLE: 6001,
                FAILED_TO_CREATE_CDM: 6002,
                FAILED_TO_ATTACH_TO_VIDEO: 6003,
                INVALID_SERVER_CERTIFICATE: 6004,
                FAILED_TO_CREATE_SESSION: 6005,
                FAILED_TO_GENERATE_LICENSE_REQUEST: 6006,
                LICENSE_REQUEST_FAILED: 6007,
                LICENSE_RESPONSE_REJECTED: 6008,
                ENCRYPTED_CONTENT_WITHOUT_DRM_INFO: 6010,
                NO_LICENSE_SERVER_GIVEN: 6012,
                OFFLINE_SESSION_REMOVED: 6013,
                EXPIRED: 6014,
                SERVER_CERTIFICATE_REQUIRED: 6015,
                INIT_DATA_TRANSFORM_ERROR: 6016,
                SERVER_CERTIFICATE_REQUEST_FAILED: 6017,
                MIN_HDCP_VERSION_NOT_MATCH: 6018,
                ERROR_CHECKING_HDCP_VERSION: 6019,
                MISSING_EME_SUPPORT: 6020,
                LOAD_INTERRUPTED: 7e3,
                OPERATION_ABORTED: 7001,
                NO_VIDEO_ELEMENT: 7002,
                OBJECT_DESTROYED: 7003,
                CONTENT_NOT_LOADED: 7004,
                SRC_EQUALS_PRELOAD_NOT_SUPPORTED: 7005,
                PRELOAD_DESTROYED: 7006,
                QUEUE_INDEX_OUT_OF_BOUNDS: 7007,
                CAST_API_UNAVAILABLE: 8e3,
                NO_CAST_RECEIVERS: 8001,
                ALREADY_CASTING: 8002,
                UNEXPECTED_CAST_ERROR: 8003,
                CAST_CANCELED_BY_USER: 8004,
                CAST_CONNECTION_TIMED_OUT: 8005,
                CAST_RECEIVER_APP_UNAVAILABLE: 8006,
                STORAGE_NOT_SUPPORTED: 9e3,
                INDEXED_DB_ERROR: 9001,
                DEPRECATED_OPERATION_ABORTED: 9002,
                REQUESTED_ITEM_NOT_FOUND: 9003,
                MALFORMED_OFFLINE_URI: 9004,
                CANNOT_STORE_LIVE_OFFLINE: 9005,
                NO_INIT_DATA_FOR_OFFLINE: 9007,
                LOCAL_PLAYER_INSTANCE_REQUIRED: 9008,
                NEW_KEY_OPERATION_NOT_SUPPORTED: 9011,
                KEY_NOT_FOUND: 9012,
                MISSING_STORAGE_CELL: 9013,
                STORAGE_LIMIT_REACHED: 9014,
                DOWNLOAD_SIZE_CALLBACK_ERROR: 9015,
                MODIFY_OPERATION_NOT_SUPPORTED: 9016,
                INDEXED_DB_INIT_TIMED_OUT: 9017,
                CS_IMA_SDK_MISSING: 1e4,
                CS_AD_MANAGER_NOT_INITIALIZED: 10001,
                SS_IMA_SDK_MISSING: 10002,
                SS_AD_MANAGER_NOT_INITIALIZED: 10003,
                CURRENT_DAI_REQUEST_NOT_FINISHED: 10004,
                MT_AD_MANAGER_NOT_INITIALIZED: 10005,
                INTERSTITIAL_AD_MANAGER_NOT_INITIALIZED: 10006,
                VAST_INVALID_XML: 10007,
              }));
            function $o() {}
            function zt(e) {
              if (!e) return "";
              if (
                ((e = We(e)),
                e[0] == 239 && e[1] == 187 && e[2] == 191 && (e = e.subarray(3)),
                l.TextDecoder && !tt().xh())
              )
                return (
                  (e = new TextDecoder().decode(e)),
                  e.includes("") &&
                    Bt(
                      'Decoded string contains an "unknown character" codepoint.  That probably means the UTF8 encoding was incorrect!',
                    ),
                  e
                );
              for (var t = "", r = 0; r < e.length; ++r) {
                var s = 65533;
                if (
                  ((e[r] & 128) == 0
                    ? (s = e[r])
                    : e.length >= r + 2 && (e[r] & 224) == 192 && (e[r + 1] & 192) == 128
                      ? ((s = ((e[r] & 31) << 6) | (e[r + 1] & 63)), (r += 1))
                      : e.length >= r + 3 &&
                          (e[r] & 240) == 224 &&
                          (e[r + 1] & 192) == 128 &&
                          (e[r + 2] & 192) == 128
                        ? ((s = ((e[r] & 15) << 12) | ((e[r + 1] & 63) << 6) | (e[r + 2] & 63)), (r += 2))
                        : e.length >= r + 4 &&
                          (e[r] & 241) == 240 &&
                          (e[r + 1] & 192) == 128 &&
                          (e[r + 2] & 192) == 128 &&
                          (e[r + 3] & 192) == 128 &&
                          ((s =
                            ((e[r] & 7) << 18) |
                            ((e[r + 1] & 63) << 12) |
                            ((e[r + 2] & 63) << 6) |
                            (e[r + 3] & 63)),
                          (r += 3)),
                  s <= 65535)
                )
                  t += String.fromCharCode(s);
                else {
                  s -= 65536;
                  var a = s & 1023;
                  ((t += String.fromCharCode(55296 + (s >> 10))), (t += String.fromCharCode(56320 + a)));
                }
              }
              return t;
            }
            function Zs(e, t, r) {
              if (!e) return "";
              if (!r && e.byteLength % 2 != 0) throw new ee(2, 2, 2004);
              r = Math.floor(e.byteLength / 2);
              var s = new Uint16Array(r);
              e = Ti(e);
              for (var a = 0; a < r; a++) s[a] = e.getUint16(a * 2, t);
              return Wd.value()(s);
            }
            function Yr(e) {
              function t(s) {
                return r.byteLength <= s || (r[s] >= 9 && r[s] <= 126);
              }
              if (!e) return "";
              var r = We(e);
              if (r[0] == 239 && r[1] == 187 && r[2] == 191) return zt(r);
              if (r[0] == 254 && r[1] == 255) return Zs(r.subarray(2), !1);
              if (r[0] == 255 && r[1] == 254) return Zs(r.subarray(2), !0);
              if (r[0] == 0 && r[2] == 0) return Zs(e, !1);
              if (r[1] == 0 && r[3] == 0) return Zs(e, !0);
              if (t(0) && t(1) && t(2) && t(3)) return zt(e);
              throw new ee(2, 2, 2003);
            }
            function Er(e) {
              if (l.TextEncoder && !tt().xh()) {
                var t = new TextEncoder();
                return ir(t.encode(e));
              }
              ((e = encodeURIComponent(e)), (e = unescape(e)), (t = new Uint8Array(e.length)));
              for (var r = 0; r < e.length; r++) t[r] = e[r].charCodeAt(0);
              return ir(t);
            }
            function fm(e, t) {
              for (var r = new ArrayBuffer(e.length * 2), s = new DataView(r), a = 0; a < e.length; ++a)
                s.setUint16(a * 2, e.charCodeAt(a), t);
              return r;
            }
            function li(e) {
              var t = {
                  "&amp;": "&",
                  "&lt;": "<",
                  "&gt;": ">",
                  "&quot;": '"',
                  "&apos;": "'",
                  "&nbsp;": "",
                  "&lrm;": "",
                  "&rlm;": "",
                },
                r = /&(?:amp|lt|gt|quot|apos|nbsp|lrm|rlm|#[xX]?[0-9a-fA-F]+);/g,
                s = RegExp(r.source);
              return e && s.test(e)
                ? e.replace(r, function (a) {
                    return a[1] == "#"
                      ? ((a =
                          a[2] == "x" || a[2] == "X"
                            ? parseInt(a.substring(3), 16)
                            : parseInt(a.substring(2), 10)),
                        a >= 0 && a <= 1114111 ? String.fromCodePoint(a) : "")
                      : t[a] || "'";
                  })
                : e || "";
            }
            (Ee("shaka.util.StringUtils", $o),
              ($o.resetFromCharCode = function () {
                Wd.g = void 0;
              }),
              ($o.toUTF16 = fm),
              ($o.toUTF8 = Er),
              ($o.fromBytesAutoDetect = Yr),
              ($o.fromUTF16 = Zs),
              ($o.fromUTF8 = zt));
            var Wd = new Kt(function () {
              function e(r) {
                try {
                  var s = new Uint8Array(r);
                  return String.fromCharCode.apply(null, s).length > 0;
                } catch (a) {
                  return !1;
                }
              }
              for (var t = { Pc: 65536 }; t.Pc > 0; t = { Pc: t.Pc }, t.Pc /= 2)
                if (e(t.Pc))
                  return (function (r) {
                    return function (s) {
                      for (var a = "", c = 0; c < s.length; c += r.Pc)
                        a += String.fromCharCode.apply(null, s.subarray(c, c + r.Pc));
                      return a;
                    };
                  })(t);
              return null;
            });
            function Hn() {}
            function zd(e) {
              return (
                (e = We(e)),
                Uint8Array.prototype.toBase64
                  ? e.toBase64({ alphabet: "base64", omitPadding: !1 })
                  : ((e = Wd.value()(e)), btoa(e))
              );
            }
            function ps(e, t) {
              return (
                (t = t == null ? !0 : t),
                Uint8Array.prototype.toBase64
                  ? We(e).toBase64({ alphabet: "base64url", omitPadding: !t })
                  : ((e = zd(e).replace(/\+/g, "-").replace(/\//g, "_")), t ? e : e.replace(/[=]*$/, ""))
              );
            }
            function rr(e) {
              if (!("fromBase64" in Uint8Array)) {
                e = l.atob(e.replace(/-/g, "+").replace(/_/g, "/"));
                for (var t = new Uint8Array(e.length), r = 0; r < e.length; ++r) t[r] = e.charCodeAt(r);
                return t;
              }
              return (
                (e = e.replace(/\s+/g, "")),
                Uint8Array.fromBase64(e, { alphabet: /[-_]/.test(e) ? "base64url" : "base64" })
              );
            }
            function Go(e) {
              if (!("fromHex" in Uint8Array)) {
                for (var t = e.length / 2, r = new Uint8Array(t), s = 0; s < t; s++)
                  r[s] = l.parseInt(e.substr(s * 2, 2), 16);
                return r;
              }
              return Uint8Array.fromHex(e);
            }
            function gs(e) {
              var t = We(e);
              if (!Uint8Array.prototype.toHex) {
                ((e = ""), (t = I(t)));
                for (var r = t.next(); !r.done; r = t.next())
                  ((r = r.value), (r = r.toString(16)), r.length == 1 && (r = "0" + r), (e += r));
                return e;
              }
              return t.toHex();
            }
            function dn() {
              for (var e = Qe.apply(0, arguments), t = 0, r = 0; r < e.length; ++r) t += e[r].byteLength;
              t = new Uint8Array(t);
              for (var s = (r = 0); s < e.length; ++s) {
                var a = e[s];
                (ArrayBuffer.isView(a) && a.BYTES_PER_ELEMENT === 1 ? t.set(a, r) : t.set(We(a), r),
                  (r += a.byteLength));
              }
              return t;
            }
            (Ee("shaka.util.Uint8ArrayUtils", Hn),
              (Hn.concat = dn),
              (Hn.toHex = gs),
              (Hn.fromHex = Go),
              (Hn.fromBase64 = rr),
              (Hn.toBase64 = ps),
              (Hn.toStandardBase64 = zd));
            function Ln(e, t, r) {
              if (((r = r === void 0 ? "" : r), t.length == 0)) return e;
              if (e.length == 1 && t.length == 1) {
                var s = new un(e[0]);
                return ((t = new un(t[0])), (t = s.resolve(t)), r && Bo(t, r), [t.toString()]);
              }
              ((t = t.map(function (g) {
                return new un(g);
              })),
                (s = []),
                (e = I(e)));
              for (var a = e.next(); !a.done; a = e.next()) {
                a = new un(a.value);
                for (var c = I(t), f = c.next(); !f.done; f = c.next())
                  ((f = a.resolve(f.value)), r && Bo(f, r), s.push(f.toString()));
              }
              return s;
            }
            function ms(e, t, r, s, a) {
              return (
                (t = {
                  keySystem: e,
                  encryptionScheme: t,
                  licenseServerUri: "",
                  distinctiveIdentifierRequired: !1,
                  persistentStateRequired: !1,
                  audioRobustness: "",
                  videoRobustness: "",
                  serverCertificate: null,
                  serverCertificateUri: "",
                  sessionType: "",
                  initData: r || [],
                  keyIds: new Set(),
                  mediaTypes: a,
                }),
                s && (t.keySystemUris = new Set([s])),
                !r &&
                  Su(e) &&
                  t.initData.push({ initDataType: "sinf", initData: new Uint8Array(0), keyId: null }),
                t
              );
            }
            function US(e, t) {
              t = t === void 0 ? "cenc" : t;
              var r = [],
                s = [],
                a = [];
              (e.forEach(function (f, g) {
                var m = g;
                m.length != 22 && (m = ps(Go(g), !1));
                var x = f;
                (x.length != 22 && (x = ps(Go(f), !1)),
                  (f = { kty: "oct", kid: m, k: x }),
                  r.push(f),
                  s.push(f.kid),
                  a.push(g));
              }),
                (e = JSON.stringify({ keys: r })));
              var c = JSON.stringify({ kids: s });
              return (
                (c = [{ initData: We(Er(c)), initDataType: "keyids" }]),
                {
                  keySystem: "org.w3.clearkey",
                  encryptionScheme: t,
                  licenseServerUri: "data:application/json;base64," + l.btoa(e),
                  distinctiveIdentifierRequired: !1,
                  persistentStateRequired: !1,
                  audioRobustness: "",
                  videoRobustness: "",
                  serverCertificate: null,
                  serverCertificateUri: "",
                  sessionType: "",
                  initData: c,
                  keyIds: new Set(a),
                }
              );
            }
            function Ma(e, t) {
              if (t.length == 1) return t[0];
              if (((e = Si(e, t)), e != null)) return e;
              throw new ee(2, 4, 4025, t);
            }
            function Si(e, t) {
              var r = $S.get(e);
              r = I(r);
              for (var s = r.next(); !s.done; s = r.next()) {
                s = s.value;
                for (var a = I(t), c = a.next(); !c.done; c = a.next())
                  if (((c = c.value), s.test(c.trim()))) return c.trim();
              }
              return e == nt ? "" : null;
            }
            function pm(e, t) {
              var r = [];
              ((e = $S.get(e)), (e = I(e)));
              for (var s = e.next(); !s.done; s = e.next()) {
                s = s.value;
                for (var a = I(t), c = a.next(); !c.done; c = a.next())
                  ((c = c.value), s.test(c.trim()) && r.push(c.trim()));
              }
              return r;
            }
            var nt = "text",
              hn = { wa: "video", aa: "audio", Na: nt, Yf: "image", ul: "application" },
              BS = 1 / 15,
              $S = new Map()
                .set("audio", [
                  /^vorbis$/,
                  /^Opus$/,
                  /^opus$/,
                  /^fLaC$/,
                  /^flac$/,
                  /^mp4a/,
                  /^[ae]c-3$/,
                  /^ac-4/,
                  /^dts[cex]$/,
                  /^iamf/,
                  /^mhm[12]/,
                  /^ac3$/,
                  /^eac3$/,
                  /^apac$/,
                ])
                .set("video", [
                  /^avc/,
                  /^hev/,
                  /^hvc/,
                  /^vvc/,
                  /^vvi/,
                  /^vp0?[89]/,
                  /^av01/,
                  /^dvh/,
                  /^dva/,
                  /^dav/,
                ])
                .set("text", [/^vtt$/, /^wvtt/, /^stpp/]);
            function Eu(e, t, r, s) {
              ((this.g = null), (this.l = e), (this.i = t), (this.m = r), (this.o = s), (this.j = !1));
              e: {
                if (
                  (typeof libDPIModule > "u" && He("Could not find LCEVC Library dependencies on this page"),
                  typeof LCEVCdec < "u")
                )
                  this.h = LCEVCdec;
                else if (typeof LcevcDil < "u")
                  ((this.h = LcevcDil),
                    (this.j = !0),
                    ft("LcevcDil", "lcevc_dil.js is deprecated, please use lcevc_dec.js instead"));
                else {
                  (He("Could not find LCEVC Library on this page"), (e = !1));
                  break e;
                }
                typeof this.h.SupportObject > "u"
                  ? (He("Could not find LCEVC Library on this page"), (e = !1))
                  : (this.h.SupportObject.SupportStatus || He(this.h.SupportObject.SupportError),
                    (e =
                      typeof this.h < "u" &&
                      typeof libDPIModule < "u" &&
                      this.i instanceof HTMLCanvasElement &&
                      this.h.SupportObject.SupportStatus));
              }
              e &&
                !this.g &&
                this.h.SupportObject.webGLSupport(this.i) &&
                (this.i.classList.remove("shaka-hidden"),
                (this.g = this.j
                  ? new this.h.LcevcDil(this.l, this.i, this.m)
                  : new this.h.LCEVCdec(this.l, this.i, this.m)));
            }
            function Yd(e, t, r, s) {
              s.type !== "video" ||
                (e.o && !s.baseOriginalId) ||
                (e.g && e.g.appendBuffer(t, "video", s.id, -r, !e.o));
            }
            function GS(e) {
              e.g && e.i.classList.add("shaka-hidden");
            }
            Eu.prototype.release = function () {
              this.g && (this.g.close(), (this.g = null));
            };
            function jS(e) {
              return e && typeof LCEVCdec < "u" ? e.codecs == "lvc1" : !1;
            }
            (Ee("shaka.lcevc.Dec", Eu), (Eu.prototype.release = Eu.prototype.release));
            function Au() {}
            function jo(e, t) {
              Pa.set(e, t);
            }
            function dP() {
              var e = {};
              if ((tt(), es()))
                for (var t = I(Pa.keys()), r = t.next(); !r.done; r = t.next()) e[r.value] = !0;
              for (
                t = I([
                  "application/dash+xml",
                  "application/x-mpegurl",
                  "application/vnd.apple.mpegurl",
                  "application/vnd.ms-sstr+xml",
                ]),
                  r = t.next();
                !r.done;
                r = t.next()
              )
                ((r = r.value), (e[r] = es() ? Pa.has(r) : na().canPlayType(r) != ""));
              return e;
            }
            function VS(e, t) {
              if (t) {
                var r = Pa.get(t.toLowerCase());
                if (r) return r;
              }
              throw new ee(2, 4, 4e3, e, t);
            }
            (Ee("shaka.media.ManifestParser", Au),
              (Au.unregisterParserByMime = function (e) {
                Pa.delete(e);
              }),
              (Au.registerParserByMime = jo),
              (Au.registerParserByExtension = function () {
                ft(
                  "ManifestParser.registerParserByExtension",
                  "Please use an ManifestParser with registerParserByMime function.",
                );
              }),
              (Au.AccessibilityPurpose = {
                Cm: "visually impaired",
                Nl: "hard of hearing",
                jm: "spoken subtitles",
              }));
            var Pa = new Map();
            function Iu() {}
            ((Iu.prototype.extract = function () {}),
              (Iu.prototype.decode = function () {
                return [];
              }),
              (Iu.prototype.clear = function () {}),
              (Iu.prototype.getStreams = function () {
                return [];
              }));
            function gm() {}
            ((gm.prototype.init = function () {}),
              (gm.prototype.parse = function () {
                return [];
              }));
            function HS() {}
            ((d = HS.prototype),
              (d.init = function () {}),
              (d.Af = function () {}),
              (d.Pd = function () {}),
              (d.remove = function () {}),
              (d.Zf = function () {}),
              Ee("shaka.media.IClosedCaptionParser", HS));
            function Ur(e) {
              ((this.h = new Map()),
                (this.i = 0),
                (this.j = new gm()),
                (e = KS(e.toLowerCase())) && (this.j = e()),
                (this.g = new Iu()),
                (e = Vo) && ((this.g = e()), this.h.set(this.i, this.g)));
            }
            ((d = Ur.prototype),
              (d.init = function (e, t, r) {
                if (((t = t === void 0 ? !1 : t), (r = r === void 0 ? -1 : r), r != -1 && this.i != r)) {
                  t = r;
                  var s = this.h.get(t);
                  (this.h.set(this.i, this.g),
                    s ? (this.g = s) : ((s = Vo) && (this.g = s()), this.h.set(t, this.g)));
                } else t || this.Pd();
                (this.j.init(e), r != -1 && (this.i = r));
              }),
              (d.Af = function (e) {
                ((e = this.j.parse(e)), (e = I(e)));
                for (var t = e.next(); !t.done; t = e.next()) {
                  t = t.value;
                  var r = We(t.packet);
                  r.length > 0 && this.g.extract(r, t.pts);
                }
                return this.g.decode();
              }),
              (d.Pd = function () {
                this.g.clear();
              }),
              (d.remove = function (e) {
                ((e = e === void 0 ? [] : e), (e = new Set(e)));
                for (var t = I(this.h.keys()), r = t.next(); !r.done; r = t.next())
                  if (((r = r.value), !e.has(r))) {
                    var s = this.h.get(r);
                    (s && s.clear(), this.h.delete(r));
                  }
              }),
              (d.Zf = function () {
                return this.g.getStreams();
              }));
            function mm(e, t) {
              ym.set(e, t);
            }
            function KS(e) {
              return ym.get(e);
            }
            (Ee("shaka.media.ClosedCaptionParser", Ur),
              (Ur.findDecoder = function () {
                return Vo;
              }),
              (Ur.unregisterDecoder = function () {
                Vo = null;
              }),
              (Ur.registerDecoder = function (e) {
                Vo = e;
              }),
              (Ur.findParser = KS),
              (Ur.unregisterParser = function (e) {
                ym.delete(e);
              }),
              (Ur.registerParser = mm));
            var ym = new Map(),
              Vo = null;
            function Ho() {
              ((this.id = ""),
                (this.regionAnchorY = this.regionAnchorX = this.viewportAnchorY = this.viewportAnchorX = 0),
                (this.height = this.width = 100),
                (this.viewportAnchorUnits = this.widthUnits = this.heightUnits = Mi),
                (this.scroll = WS));
            }
            Ee("shaka.text.CueRegion", Ho);
            var Mi = 1;
            Ho.units = { PX: 0, PERCENTAGE: Mi, LINES: 2 };
            var WS = "";
            Ho.scrollMode = { NONE: WS, UP: "up" };
            function Oa(e) {
              ((this.h = e || ""), (this.g = 0));
            }
            function Na(e) {
              eo(e, /[ \t]+/gm);
            }
            function eo(e, t) {
              return (
                (t.lastIndex = e.g),
                (t = t.exec(e.h)),
                (t = t == null ? null : { position: t.index, length: t[0].length, results: t }),
                e.g == e.h.length || t == null || t.position != e.g ? null : ((e.g += t.length), t.results)
              );
            }
            function Ko(e) {
              return e.g == e.h.length ? null : (e = eo(e, /[^ \t\n]*/gm)) ? e[0] : null;
            }
            function wu(e) {
              if (((e = eo(e, hP)), e == null)) return null;
              var t = Number(e[2]),
                r = Number(e[3]);
              return t > 59 || r > 59
                ? null
                : (Number(e[6]) || 0) / 1e3 + r + t * 60 + (Number(e[1]) || 0) * 3600;
            }
            function Fa(e) {
              return e ? wu(new Oa(e)) : null;
            }
            var hP = /(?:(\d{1,}):)?(\d{2}):(\d{2})((\.(\d{1,3})))?/g;
            function Xd() {}
            function Ar(e) {
              function t(s) {
                switch (typeof s) {
                  case "undefined":
                  case "boolean":
                  case "number":
                  case "string":
                  case "symbol":
                  case "function":
                    return s;
                  default:
                    if (!s || ArrayBuffer.isView(s)) return s;
                    if (r.has(s)) return null;
                    var a = Array.isArray(s);
                    if (s.constructor != Object && !a) return null;
                    r.add(s);
                    var c = a ? [] : {},
                      f;
                    for (f in s) c[f] = t(s[f]);
                    return (a && (c.length = s.length), c);
                }
              }
              var r = new WeakSet();
              return t(e);
            }
            function to(e) {
              var t = {},
                r;
              for (r in e) t[r] = e[r];
              return t;
            }
            function qd(e) {
              if (Array.isArray(e)) {
                for (var t = [], r = 0; r < e.length; r++) {
                  var s = r.toString(),
                    a = e[r];
                  a !== void 0 && (a = qd(a)) && t.push(s + ":" + a);
                }
                e = "[" + t.join(",") + "]";
              } else if (typeof e == "function") e = "";
              else if (e instanceof Object) {
                for (r = Object.keys(e), r.sort(), t = [], r = I(r), s = r.next(); !s.done; s = r.next())
                  ((a = s.value),
                    (s = JSON.stringify(a)),
                    (a = e[a]),
                    a !== void 0 && (a = qd(a)) && t.push(s + ":" + a));
                e = "{" + t.join(",") + "}";
              } else e = JSON.stringify(e);
              return e;
            }
            (Ee("shaka.util.ObjectUtils", Xd),
              (Xd.alphabeticalKeyOrderStringify = qd),
              (Xd.shallowCloneObject = to),
              (Xd.cloneObject = Ar));
            /*
 @license
 tXml
 Copyright 2015 Tobias Nickel
 SPDX-License-Identifier: MIT
*/ function Ru(e, t) {
              var r = r === void 0 ? !1 : r;
              return ((e = Yr(e)), Wo(e, t, r));
            }
            function Wo(e, t, r) {
              return (
                (e = fP(e, r === void 0 ? !1 : r)),
                !t && e.length
                  ? e[0]
                  : (e = e.find(function (s) {
                        return t.split(",").includes(s.tagName);
                      }))
                    ? e
                    : null
              );
            }
            function vm(e) {
              return Tm.has(e) ? Tm.get(e) : "";
            }
            function fP(e, t) {
              function r(c, f) {
                f = f === void 0 ? !1 : f;
                for (var g = []; e[a]; )
                  if (e.charCodeAt(a) == 60) {
                    if (e.charCodeAt(a + 1) === 47) {
                      ((f = a + 2), (a = e.indexOf(">", a)), (f = e.substring(f, a)));
                      var m = f.indexOf(c);
                      if (m == -1) {
                        var x = c.indexOf(".");
                        x > 0 && (m = f.indexOf(c.substring(0, x)));
                      }
                      if (m == -1)
                        throw (
                          (c = e.substring(0, a).split("\n")),
                          Error(
                            "Unexpected close tag\nLine: " +
                              (c.length - 1) +
                              "\nColumn: " +
                              (c[c.length - 1].length + 1) +
                              "\nChar: " +
                              e[a],
                          )
                        );
                      a + 1 && (a += 1);
                      break;
                    } else if (e.charCodeAt(a + 1) === 33) {
                      if (e.charCodeAt(a + 2) == 45) {
                        for (
                          ;
                          a !== -1 &&
                          (e.charCodeAt(a) !== 62 ||
                            e.charCodeAt(a - 1) != 45 ||
                            e.charCodeAt(a - 2) != 45 ||
                            a == -1);
                        )
                          a = e.indexOf(">", a + 1);
                        a === -1 && (a = e.length);
                      } else if (
                        e.charCodeAt(a + 2) === 91 &&
                        e.charCodeAt(a + 8) === 91 &&
                        e.substr(a + 3, 5).toLowerCase() === "cdata"
                      ) {
                        ((m = e.indexOf("]]>", a)),
                          m == -1
                            ? (g.push(e.substr(a + 9)), (a = e.length))
                            : (g.push(e.substring(a + 9, m)), (a = m + 3)));
                        continue;
                      }
                      a++;
                      continue;
                    }
                    e: {
                      ((x = f), a++);
                      var E = s(),
                        A = {};
                      for (m = []; e.charCodeAt(a) !== 62 && e[a]; ) {
                        var R = e.charCodeAt(a);
                        if ((R > 64 && R < 91) || (R > 96 && R < 123)) {
                          R = s();
                          for (
                            var b = e.charCodeAt(a);
                            b &&
                            b !== 39 &&
                            b !== 34 &&
                            !((b > 64 && b < 91) || (b > 96 && b < 123)) &&
                            b !== 62;
                          )
                            (a++, (b = e.charCodeAt(a)));
                          var D = a + 1;
                          if (
                            ((a = e.indexOf(e[a], D)),
                            (D = (" " + e.slice(D, a)).slice(1)),
                            b === 39 || b === 34)
                          ) {
                            if (a === -1) {
                              if (((x = { tagName: E, attributes: A, children: m, parent: null }), t))
                                for (E = 0; E < m.length; E++) typeof m[E] != "string" && (m[E].parent = x);
                              m = x;
                              break e;
                            }
                          } else ((D = null), a--);
                          if (R.startsWith("xmlns:")) {
                            b = D;
                            var M = R.split(":")[1];
                            (Tm.set(b, M), Sm.set(M, b));
                          }
                          (E === "tt" && R === "xml:space" && D === "preserve" && (x = !0), (A[R] = D));
                        }
                        a++;
                      }
                      for (
                        e.charCodeAt(a - 1) !== 47 ? (a++, (m = r(E, x))) : a++,
                          x = { tagName: E, attributes: A, children: m, parent: null },
                          E = m.length,
                          A = 0;
                        A < E;
                        A++
                      )
                        ((R = m[A]),
                          typeof R != "string" ? t && (R.parent = x) : A == E - 1 && R == "\n" && m.pop());
                      m = x;
                    }
                    if ((g.push(m), typeof m == "string")) break;
                    m.tagName[0] === "?" && m.children && (g.push.apply(g, V(m.children)), (m.children = []));
                  } else
                    ((m = a),
                      (a = e.indexOf("<", a) - 1),
                      a === -2 && (a = e.length),
                      (m = (" " + e.slice(m, a + 1)).slice(1)),
                      f
                        ? m.length > 0 && g.push(m)
                        : ((g.length && m.length == 1 && m[0] == "\n") || m.trim().length > 0) && g.push(m),
                      a++);
                return g;
              }
              function s() {
                for (var c = a; "\r\n	>/= ".indexOf(e[a]) === -1 && e[a]; ) a++;
                return (" " + e.slice(c, a)).slice(1);
              }
              var a = 0;
              return r("");
            }
            function Qd(e) {
              return typeof e == "string";
            }
            function zS(e) {
              var t = [];
              if (!e.children) return [];
              e = I(e.children);
              for (var r = e.next(); !r.done; r = e.next())
                ((r = r.value), typeof r != "string" && t.push(r));
              return t;
            }
            function Rt(e, t) {
              var r = [];
              if (!e.children) return [];
              e = I(e.children);
              for (var s = e.next(); !s.done; s = e.next()) ((s = s.value), s.tagName === t && r.push(s));
              return r;
            }
            function cn(e) {
              return typeof e == "string"
                ? li(e)
                : ((e = e.children.reduce(function (t, r) {
                    return typeof r == "string" ? t + r : t;
                  }, "")),
                  e === "" ? null : li(e));
            }
            function ui(e) {
              return Array.from(e.children).every(function (t) {
                return typeof t == "string";
              })
                ? ((e = cn(e)) && (e = e.trim()), e)
                : null;
            }
            function Br(e, t, r) {
              if (((r = r === void 0 ? [] : r), e.tagName === t && r.push(e), e.children)) {
                e = I(e.children);
                for (var s = e.next(); !s.done; s = e.next()) Br(s.value, t, r);
              }
              return r;
            }
            function jt(e, t) {
              return ((e = Rt(e, t)), e.length != 1 ? null : e[0]);
            }
            function sr(e, t, r) {
              return ((e = YS(e, t, r)), e.length != 1 ? null : e[0]);
            }
            function ze(e, t, r, s) {
              s = s === void 0 ? null : s;
              var a = null;
              return ((e = e.attributes[t]), e != null && (a = r(e)), a == null ? s : a);
            }
            function ys(e, t, r) {
              return ((t = vm(t)), e.attributes[t + ":" + r] || null);
            }
            function YS(e, t, r) {
              var s = vm(t);
              if (((t = []), e.children))
                for (r = s ? s + ":" + r : r, e = I(e.children), s = e.next(); !s.done; s = e.next())
                  (s = s.value) && s.tagName === r && t.push(s);
              return t;
            }
            function Xr(e, t, r) {
              t = I(t);
              for (var s = t.next(); !s.done; s = t.next()) if ((s = ys(e, s.value, r))) return s;
              return null;
            }
            function vs(e) {
              return e
                ? (/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(e) && (e += "Z"),
                  (e = Date.parse(e)),
                  isNaN(e) ? null : e / 1e3)
                : null;
            }
            function qr(e) {
              return !e ||
                ((e = RegExp(
                  "^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$",
                  "i",
                ).exec(e)),
                !e)
                ? null
                : ((e =
                    31536e3 * Number(e[1] || null) +
                    2592e3 * Number(e[2] || null) +
                    86400 * Number(e[3] || null) +
                    3600 * Number(e[4] || null) +
                    60 * Number(e[5] || null) +
                    Number(e[6] || null)),
                  isFinite(e) ? e : null);
            }
            function Jd(e) {
              var t = /([0-9]+)-([0-9]+)/.exec(e);
              return !t || ((e = Number(t[1])), !isFinite(e))
                ? null
                : ((t = Number(t[2])), isFinite(t) ? { start: e, end: t } : null);
            }
            function Nn(e) {
              return ((e = Number(e)), e % 1 === 0 ? e : null);
            }
            function Qr(e) {
              return ((e = Number(e)), e % 1 === 0 && e > 0 ? e : null);
            }
            function Fn(e) {
              return ((e = Number(e)), e % 1 === 0 && e >= 0 ? e : null);
            }
            function Zd(e) {
              return ((e = Number(e)), isNaN(e) ? null : e);
            }
            function eh(e) {
              return e ? e.toLowerCase() === "true" : !1;
            }
            function pP(e) {
              var t,
                r = (t = e.match(/^(\d+)\/(\d+)$/)) ? Number(t[1]) / Number(t[2]) : Number(e);
              return isNaN(r) ? null : r;
            }
            function th(e) {
              var t = [];
              ((e = li(e).split(/\/+(?=(?:[^'"]*['"][^'"]*['"])*[^'"]*$)/)), (e = I(e)));
              for (var r = e.next(); !r.done; r = e.next()) {
                r = r.value;
                var s = r.match(/^([\w]+)/);
                if (s) {
                  var a = r.match(/(@id='(.*?)')/),
                    c = r.match(/(@t='(\d+)')/),
                    f = r.match(/(@n='(\d+)')/),
                    g = r.match(/\[(\d+)\]/);
                  t.push({
                    name: s[0],
                    id: a ? a[0].match(/'(.*?)'/)[0].replace(/'/gm, "") : null,
                    t: c ? Number(c[0].match(/'(.*?)'/)[0].replace(/'/gm, "")) : null,
                    n: f ? Number(f[0].match(/'(.*?)'/)[0].replace(/'/gm, "")) : null,
                    position: g ? Number(g[1]) - 1 : null,
                    Dc: r.split("/@")[1] || null,
                  });
                } else r.startsWith("@") && t.length && (t[t.length - 1].Dc = r.slice(1));
              }
              return t;
            }
            function XS(e, t) {
              var r = th(t.attributes.sel || "");
              if (r.length) {
                var s = r[r.length - 1],
                  a = t.attributes.pos || null;
                ((r = s.position),
                  r == null && (s.t !== null && (r = qS(e, "t", s.t)), s.n !== null && (r = qS(e, "n", s.n))),
                  r === null
                    ? (r = a === "prepend" ? 0 : e.length)
                    : a === "prepend"
                      ? --r
                      : a === "after" && ++r,
                  (a = t.tagName),
                  (s = s.Dc) && e[r]
                    ? QS(e[r], a, s, ui(t) || "")
                    : ((a !== "remove" && a !== "replace") || e.splice(r, 1),
                      (a !== "add" && a !== "replace") || e.splice.apply(e, [r, 0].concat(V(t.children)))));
              }
            }
            function qS(e, t, r) {
              var s = 0;
              e = I(e);
              for (var a = e.next(); !a.done; a = e.next()) {
                if (Number(a.value.attributes[t]) === r) return s;
                s++;
              }
              return null;
            }
            function QS(e, t, r, s) {
              t === "remove"
                ? delete e.attributes[r]
                : (t === "add" || t === "replace") && (e.attributes[r] = s);
            }
            function JS(e) {
              var t = "",
                r = e.tagName.split(":");
              (r.length > 0 && ((t = r[0]), (t = Sm.has(t) ? Sm.get(t) : "")),
                (t = document.createElementNS(t, e.tagName)));
              for (var s in e.attributes) t.setAttribute(s, e.attributes[s]);
              for (e = I(e.children), s = e.next(); !s.done; s = e.next())
                ((s = s.value),
                  (r = void 0),
                  typeof s == "string" ? (r = new Text(s)) : (r = JS(s)),
                  t.appendChild(r));
              return t;
            }
            function xm(e) {
              if (!e) return null;
              var t = { tagName: e.tagName, attributes: to(e.attributes), children: [], parent: null };
              e = I(e.children);
              for (var r = e.next(); !r.done; r = e.next())
                ((r = r.value), typeof r == "string" || ((r = xm(r)), (r.parent = t)), t.children.push(r));
              return t;
            }
            var Tm = new Map(),
              Sm = new Map();
            function $t(e, t, r) {
              ((this.startTime = e),
                (this.endTime = t),
                (this.payload = r),
                (this.region = new Ho()),
                (this.position = null),
                (this.positionAlign = rh),
                (this.size = 0),
                (this.textAlign = Jr),
                (this.direction = _u),
                (this.writingMode = zo),
                (this.lineInterpretation = bu),
                (this.line = null),
                (this.lineHeight = ""),
                (this.lineAlign = Yo),
                (this.displayAlign = Lu),
                (this.fontSize = this.border = this.backgroundImage = this.backgroundColor = this.color = ""),
                (this.fontWeight = sE),
                (this.fontStyle = Im),
                (this.linePadding = this.letterSpacing = this.fontFamily = ""),
                (this.opacity = 1),
                (this.textCombineUpright = ""),
                (this.textDecoration = []),
                (this.textStrokeWidth = this.textStrokeColor = this.textShadow = ""),
                (this.wrapLine = !0),
                (this.id = ""),
                (this.nestedCues = []),
                (this.lineBreak = this.isContainer = !1),
                (this.rubyTag = null),
                (this.cellResolution = { columns: 32, rows: 15 }));
            }
            function ZS(e, t) {
              return ((e = new $t(e, t, "")), (e.lineBreak = !0), e);
            }
            $t.prototype.clone = function () {
              var e = new $t(0, 0, ""),
                t;
              for (t in this) ((e[t] = this[t]), Array.isArray(e[t]) && (e[t] = e[t].slice()));
              return e;
            };
            function nh(e, t) {
              if (
                e.payload != t.payload ||
                !(Math.abs(e.startTime - t.startTime) < 0.001 && Math.abs(e.endTime - t.endTime) < 0.001)
              )
                return !1;
              for (var r in e)
                if (r != "startTime" && r != "endTime" && r != "payload") {
                  if (r == "nestedCues") {
                    if (!Nr(e.nestedCues, t.nestedCues, nh)) return !1;
                  } else if (r == "region" || r == "cellResolution") {
                    for (var s in e[r]) if (e[r][s] != t[r][s]) return !1;
                  } else if (Array.isArray(e[r])) {
                    if (!Nr(e[r], t[r])) return !1;
                  } else if (e[r] != t[r]) return !1;
                }
              return !0;
            }
            function ih(e, t) {
              t = t === void 0 ? new Map() : t;
              var r = e.payload;
              if (r.includes("<")) {
                t.size === 0 && eE(t);
                var s = r;
                r = [];
                for (var a = -1, c = 0; c < s.length; c++)
                  s[c] === "<"
                    ? (a = c + 1)
                    : s[c] === ">" && a > 0 && ((a = s.substr(a, c - a)), a.match(mP) && r.push(a), (a = -1));
                for (r = I(r), c = r.next(); !c.done; c = r.next())
                  ((c = c.value), (s = s.replace("<" + c + ">", '<div time="' + c + '">')), (s += "</div>"));
                e: {
                  ((c = s), (a = []));
                  var f = -1;
                  ((r = ""), (s = !1));
                  for (var g = 0; g < c.length; g++)
                    if (c[g] === "/") {
                      var m = c.indexOf(">", g);
                      if (m === -1) {
                        r = c;
                        break e;
                      }
                      if ((m = c.substring(g + 1, m)) && m == "v") {
                        s = !0;
                        var x = null;
                        if ((a.length && (x = a[a.length - 1]), x)) {
                          if (x === m) r += "/" + m + ">";
                          else {
                            if (!x.startsWith("v")) {
                              r += c[g];
                              continue;
                            }
                            r += "/" + x + ">";
                          }
                          g += m.length + 1;
                        } else r += c[g];
                      } else r += c[g];
                    } else
                      (c[g] === "<"
                        ? ((f = g + 1), c[f] != "v" && (f = -1))
                        : c[g] === ">" && f > 0 && (a.push(c.substr(f, g - f)), (f = -1)),
                        (r += c[g]));
                  for (c = I(a), a = c.next(); !a.done; a = c.next())
                    ((a = a.value),
                      (f = a.replace(" ", ".voice-")),
                      (r = r.replace("<" + a + ">", "<" + f + ">")),
                      (r = r.replace("</" + a + ">", "</" + f + ">")),
                      s || (r += "</" + f + ">"));
                }
                ((r = gP(r)), (e.payload = ""), (s = "<span>" + r.replace(/\n/g, "<br />") + "</span>"));
                try {
                  var E = Wo(s, "span");
                } catch (A) {}
                if (E)
                  if (((E = E.children), E.length != 1 || E[0].tagName))
                    for (E = I(E), r = E.next(); !r.done; r = E.next()) tE(r.value, e, t);
                  else e.payload = li(r);
                else e.payload = li(r);
              } else e.payload = li(r);
            }
            function eE(e) {
              for (var t = I(Object.entries(iE)), r = t.next(); !r.done; r = t.next()) {
                var s = I(r.value);
                ((r = s.next().value), (s = s.next().value));
                var a = new $t(0, 0, "");
                ((a.color = s), e.set("." + r, a));
              }
              for (t = I(Object.entries(rE)), r = t.next(); !r.done; r = t.next())
                ((s = I(r.value)),
                  (r = s.next().value),
                  (s = s.next().value),
                  (a = new $t(0, 0, "")),
                  (a.backgroundColor = s),
                  e.set("." + r, a));
            }
            function gP(e) {
              var t = { "< ": "", " >": " &gt;" },
                r = /(< +>|<\s|\s>)/g,
                s = RegExp(r.source);
              return e && s.test(e)
                ? e.replace(r, function (a) {
                    return t[a] || "";
                  })
                : e || "";
            }
            function tE(e, t, r) {
              var s = t.clone();
              if (
                ((s.nestedCues = []),
                (s.payload = ""),
                (s.rubyTag = ""),
                (s.line = null),
                (s.region = new Ho()),
                (s.position = null),
                (s.size = 0),
                (s.textAlign = Jr),
                e.tagName)
              )
                for (var a = I(e.tagName.split(/(?=[ .])+/g)), c = a.next(); !c.done; c = a.next()) {
                  var f = (c = c.value);
                  if (f.startsWith(".voice-")) {
                    var g = f.split("-").pop();
                    ((f = 'v[voice="' + g + '"]'), r.has(f) || (f = "v[voice=" + g + "]"));
                  }
                  switch (
                    (r.has(f) &&
                      ((g = s), (f = r.get(f))) &&
                      ((g.backgroundColor = Cu(f.backgroundColor, g.backgroundColor)),
                      (g.color = Cu(f.color, g.color)),
                      (g.fontFamily = Cu(f.fontFamily, g.fontFamily)),
                      (g.fontSize = Cu(f.fontSize, g.fontSize)),
                      (g.textShadow = Cu(f.textShadow, g.textShadow)),
                      (g.fontWeight = f.fontWeight),
                      (g.fontStyle = f.fontStyle),
                      (g.opacity = f.opacity),
                      (g.rubyTag = f.rubyTag),
                      (g.textCombineUpright = f.textCombineUpright),
                      (g.wrapLine = f.wrapLine)),
                    c)
                  ) {
                    case "br":
                      ((s = ZS(s.startTime, s.endTime)), t.nestedCues.push(s));
                      return;
                    case "b":
                      s.fontWeight = Ua;
                      break;
                    case "i":
                      s.fontStyle = Ba;
                      break;
                    case "u":
                      s.textDecoration.push(xs);
                      break;
                    case "font":
                      (c = e.attributes.color) && (s.color = c);
                      break;
                    case "div":
                      if (((c = e.attributes.time), !c)) break;
                      (c = Fa(c)) && (s.startTime = c);
                      break;
                    case "ruby":
                    case "rp":
                    case "rt":
                      s.rubyTag = c;
                  }
                }
              if (((a = e.children), Qd(e) || (a.length == 1 && Qd(a[0]))))
                for (r = cn(e).split("\n"), e = !0, r = I(r), a = r.next(); !a.done; a = r.next())
                  ((a = a.value),
                    e || ((e = ZS(s.startTime, s.endTime)), t.nestedCues.push(e)),
                    a.length > 0 && ((e = s.clone()), (e.payload = li(a)), t.nestedCues.push(e)),
                    (e = !1));
              else
                for (t.nestedCues.push(s), t = I(a), e = t.next(); !e.done; e = t.next()) tE(e.value, s, r);
            }
            function Cu(e, t) {
              return e && e.length > 0 ? e : t;
            }
            (Ee("shaka.text.Cue", $t),
              ($t.parseCuePayload = ih),
              ($t.equal = nh),
              ($t.prototype.clone = $t.prototype.clone));
            var rh = "auto";
            $t.positionAlign = { LEFT: "line-left", RIGHT: "line-right", CENTER: "center", AUTO: rh };
            var Jr = "center",
              Em = { LEFT: "left", RIGHT: "right", CENTER: Jr, START: "start", END: "end" };
            $t.textAlign = Em;
            var Lu = "after",
              nE = { BEFORE: "before", CENTER: "center", AFTER: Lu };
            $t.displayAlign = nE;
            var _u = "ltr";
            $t.direction = { HORIZONTAL_LEFT_TO_RIGHT: _u, HORIZONTAL_RIGHT_TO_LEFT: "rtl" };
            var zo = "horizontal-tb";
            $t.writingMode = {
              HORIZONTAL_TOP_TO_BOTTOM: zo,
              VERTICAL_LEFT_TO_RIGHT: "vertical-lr",
              VERTICAL_RIGHT_TO_LEFT: "vertical-rl",
            };
            var bu = 0;
            $t.lineInterpretation = { LINE_NUMBER: bu, PERCENTAGE: 1 };
            var Yo = "start",
              Am = { CENTER: "center", START: Yo, END: "end" };
            $t.lineAlign = Am;
            var iE = {
              white: "white",
              lime: "lime",
              cyan: "cyan",
              red: "red",
              yellow: "yellow",
              magenta: "magenta",
              blue: "blue",
              black: "black",
            };
            $t.defaultTextColor = iE;
            var rE = {
              bg_white: "white",
              bg_lime: "lime",
              bg_cyan: "cyan",
              bg_red: "red",
              bg_yellow: "yellow",
              bg_magenta: "magenta",
              bg_blue: "blue",
              bg_black: "black",
            };
            $t.defaultTextBackgroundColor = rE;
            var sE = 400,
              Ua = 700;
            $t.fontWeight = { NORMAL: sE, BOLD: Ua };
            var Im = "normal",
              Ba = "italic",
              oE = { NORMAL: Im, ITALIC: Ba, OBLIQUE: "oblique" };
            $t.fontStyle = oE;
            var xs = "underline";
            $t.textDecoration = { UNDERLINE: xs, LINE_THROUGH: "lineThrough", OVERLINE: "overline" };
            var mP = /(?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{2,3})/g;
            function no() {}
            no.prototype.destroy = function () {};
            function Ts(e, t, r) {
              wm.set(e.toLowerCase().split(";")[0] + "-" + r, { priority: r, Bf: t });
            }
            function $a(e, t) {
              for (
                var r = e.toLowerCase().split(";")[0], s = I([aE, Cm, Rm, io]), a = s.next();
                !a.done;
                a = s.next()
              )
                if ((a = wm.get(r + "-" + a.value))) {
                  var c = a.Bf(),
                    f = c.isSupported(e, t);
                  if ((c.destroy(), f)) return a.Bf;
                }
              return null;
            }
            (Ee("shaka.transmuxer.TransmuxerEngine", no),
              (no.findTransmuxer = $a),
              (no.unregisterTransmuxer = function (e, t) {
                wm.delete(e.toLowerCase().split(";")[0] + "-" + t);
              }),
              (no.registerTransmuxer = Ts),
              (no.prototype.destroy = no.prototype.destroy));
            var wm = new Map(),
              io = 1,
              Rm = 2,
              Cm = 3,
              aE = 4;
            no.PluginPriority = { FALLBACK: io, PREFERRED_SECONDARY: Rm, PREFERRED: Cm, APPLICATION: aE };
            function Lm() {}
            function tn(e, t) {
              var r = e;
              return (t && !Ss.includes(e) && (r += '; codecs="' + t + '"'), r);
            }
            function sh(e, t) {
              return (t && (e += '; codecs="' + t + '"'), e);
            }
            function _m(e, t, r) {
              var s = tn(e, t);
              return (
                (t = sh(e, t)),
                $a(t)
                  ? (e = $a(t))
                    ? ((e = e()), (r = e.convertCodecs(r, t)), e.destroy())
                    : (r = t)
                  : (r = e != "video/mp2t" && r == "audio" ? s.replace("video", "audio") : s),
                r
              );
            }
            function Du(e) {
              return e.split(";")[0].split("/")[1];
            }
            function Kn(e) {
              var t = lE(e);
              switch (((e = t[0].toLowerCase()), (t = t[1].toLowerCase()), !0)) {
                case e === "mp4a" && t === "69":
                case e === "mp4a" && t === "6b":
                case e === "mp4a" && t === "40.34":
                  return "mp3";
                case e === "mp4a" && t === "66":
                case e === "mp4a" && t === "67":
                case e === "mp4a" && t === "68":
                case e === "mp4a" && t === "40.2":
                case e === "mp4a" && t === "40.02":
                case e === "mp4a" && t === "40.5":
                case e === "mp4a" && t === "40.05":
                case e === "mp4a" && t === "40.29":
                case e === "mp4a" && t === "40.42":
                  return "aac";
                case e === "mp4a" && t === "a5":
                case e === "ac3":
                case e === "ac-3":
                  return "ac-3";
                case e === "mp4a" && t === "a6":
                case e === "eac3":
                case e === "ec-3":
                  return "ec-3";
                case e === "ac-4":
                  return "ac-4";
                case e === "mp4a" && t === "b2":
                  return "dtsx";
                case e === "mp4a" && t === "a9":
                  return "dtsc";
                case e === "vp09":
                case e === "vp9":
                  return "vp9";
                case e === "avc1":
                case e === "avc3":
                  return "avc";
                case e === "hvc1":
                case e === "hev1":
                  return "hevc";
                case e === "vvc1":
                case e === "vvi1":
                  return "vvc";
                case e === "dvh1":
                case e === "dvhe":
                  return t && t.startsWith("05") ? "dovi-p5" : "dovi-hevc";
                case e === "dvav":
                case e === "dva1":
                  return "dovi-avc";
                case e === "dav1":
                  return "dovi-av1";
                case e === "dvc1":
                case e === "dvi1":
                  return "dovi-vvc";
                case e === "lvc1":
                  return "lcevc";
              }
              return e;
            }
            function ro(e) {
              var t = [];
              e = I(e.split(","));
              for (var r = e.next(); !r.done; r = e.next()) ((r = lE(r.value)), t.push(r[0]));
              return t.sort().join(",");
            }
            function Pi(e) {
              return e.split(";")[0];
            }
            function Ei(e) {
              return (
                (e = e.split(/ *; */)),
                e.shift(),
                (e = e.find(function (t) {
                  return t.startsWith("codecs=");
                }))
                  ? e.split("=")[1].replace(/^"|"$/g, "")
                  : ""
              );
            }
            function oh(e) {
              return e === "application/x-mpegurl" || e === "application/vnd.apple.mpegurl";
            }
            function lE(e) {
              e = e.split(".");
              var t = e[0];
              return (e.shift(), [t, e.join(".")]);
            }
            (Ee("shaka.util.MimeUtils", Lm),
              (Lm.getFullTypeWithAllCodecs = sh),
              (Lm.getFullType = tn),
              new Map()
                .set("codecs", "codecs")
                .set("frameRate", "framerate")
                .set("bandwidth", "bitrate")
                .set("width", "width")
                .set("height", "height")
                .set("channelsCount", "channels"));
            var Ss = ["audio/aac", "audio/ac3", "audio/ec3", "audio/mpeg"];
            function Es(e) {
              ((this.i = null),
                (this.l = e),
                (this.C = !1),
                (this.m = this.u = 0),
                (this.o = 1 / 0),
                (this.h = this.g = null),
                (this.F = ""),
                (this.B = function () {}),
                (this.j = new Map()));
            }
            function Un(e, t) {
              Pu.set(e, t);
            }
            function ku(e) {
              return Pu.get(e);
            }
            function Mu(e) {
              return Pu.has(e) ? !0 : e == "application/cea-608" || e == "application/cea-708" ? !!Vo : !1;
            }
            Es.prototype.destroy = function () {
              return ((this.l = this.i = null), this.j.clear(), Promise.resolve());
            };
            function yP(e, t, r, s, a) {
              var c, f, g, m, x, E, A;
              return W(function (R) {
                if (R.g == 1) return _(R, Promise.resolve(), 2);
                if (!e.i || !e.l) return R.return();
                if (r == null || s == null) return (e.i.parseInit(We(t)), R.return());
                for (
                  c = e.C ? r : e.u,
                    f = { periodStart: e.u, segmentStart: r, segmentEnd: s, vttOffset: c },
                    g = e.i.parseMedia(We(t), f, a, []),
                    m = I(g),
                    x = m.next();
                  !x.done;
                  x = m.next()
                )
                  ((E = x.value), e.B(E, a || null, f));
                ((A = g.filter(function (b) {
                  return b.startTime >= e.m && b.startTime < e.o;
                })),
                  e.l.append(A),
                  e.g == null && (e.g = Math.max(r, e.m)),
                  (e.h = Math.min(s, e.o)),
                  K(R));
              });
            }
            Es.prototype.remove = function (e, t, r) {
              r = r === void 0 ? !1 : r;
              var s = this;
              return W(function (a) {
                if (a.g == 1) return _(a, Promise.resolve(), 2);
                if (e >= t) return a.return();
                (r && TP(s, e, t),
                  s.l &&
                    s.l.remove(e, t) &&
                    s.g != null &&
                    (t <= s.g ||
                      e >= s.h ||
                      (e <= s.g && t >= s.h
                        ? (s.g = s.h = null)
                        : e <= s.g && t < s.h
                          ? (s.g = t)
                          : e > s.g && t >= s.h && (s.h = e)),
                    dE(s)),
                  K(a));
              });
            };
            function vP(e, t, r) {
              ((e.m = t), (e.o = r));
            }
            function uE(e, t, r) {
              ((e.F = t),
                (t = e.j.get(t)) &&
                  ((t = t.filter(function (s) {
                    return s.endTime <= r;
                  })),
                  t.length && e.l.append(t)));
            }
            function cE(e, t, r) {
              ((t.startTime += r), (t.endTime += r), (t = I(t.nestedCues)));
              for (var s = t.next(); !s.done; s = t.next()) cE(e, s.value, r);
            }
            function xP(e, t, r) {
              var s = new Map();
              t = I(t);
              for (var a = t.next(); !a.done; a = t.next()) {
                var c = a.value;
                ((a = c.stream),
                  (c = c.cue),
                  s.has(a) || s.set(a, []),
                  cE(e, c, r),
                  c.startTime >= e.m && c.startTime < e.o && (s.get(a).push(c), a == e.F && e.l.append([c])));
              }
              for (r = I(s.keys()), t = r.next(); !t.done; t = r.next())
                for (
                  t = t.value, e.j.has(t) || e.j.set(t, []), a = I(s.get(t)), c = a.next();
                  !c.done;
                  c = a.next()
                )
                  ((c = c.value), e.j.get(t).push(c));
              dE(e);
            }
            function TP(e, t, r) {
              for (var s = I(e.j.keys()), a = s.next(); !a.done; a = s.next()) {
                a = a.value;
                var c = e.j.get(a);
                ((c = c.filter(function (f) {
                  return f.startTime < t || f.endTime >= r;
                })),
                  e.j.set(a, c));
              }
            }
            function dE(e) {
              for (var t = 1 / 0, r = -1 / 0, s = I(e.j.values()), a = s.next(); !a.done; a = s.next()) {
                a = I(a.value);
                for (var c = a.next(); !c.done; c = a.next())
                  ((c = c.value), (t = Math.min(t, c.startTime)), (r = Math.max(r, c.endTime)));
              }
              t !== 1 / 0 &&
                r !== -1 / 0 &&
                ((e.g = e.g == null ? Math.max(t, e.m) : Math.min(e.g, Math.max(t, e.m))),
                (e.h = Math.max(e.h, Math.min(r, e.o))));
            }
            (Ee("shaka.text.TextEngine", Es),
              (Es.prototype.destroy = Es.prototype.destroy),
              (Es.findParser = ku),
              (Es.unregisterParser = function (e) {
                Pu.delete(e);
              }),
              (Es.registerParser = Un));
            var Pu = new Map();
            function Ou(e) {
              ((this.h = e), (this.g = null));
            }
            ((Ou.prototype.ka = function (e) {
              var t = this;
              this.stop();
              var r = !0,
                s = null;
              return (
                (this.g = function () {
                  (l.clearTimeout(s), (r = !1));
                }),
                (s = l.setTimeout(function () {
                  r && t.h();
                }, e * 1e3)),
                this
              );
            }),
              (Ou.prototype.stop = function () {
                this.g && (this.g(), (this.g = null));
              }));
            function it(e) {
              ((this.h = e), (this.g = null));
            }
            ((it.prototype.Jb = function () {
              return (this.stop(), this.h(), this);
            }),
              (it.prototype.ka = function (e) {
                var t = this;
                return (
                  this.stop(),
                  (this.g = new Ou(function () {
                    t.h();
                  }).ka(e)),
                  this
                );
              }),
              (it.prototype.Ea = function (e) {
                var t = this;
                return (
                  this.stop(),
                  (this.g = new Ou(function () {
                    (t.g.ka(e), t.h());
                  }).ka(e)),
                  this
                );
              }),
              (it.prototype.stop = function () {
                this.g && (this.g.stop(), (this.g = null));
              }),
              Ee("shaka.util.Timer", it),
              (it.prototype.stop = it.prototype.stop),
              (it.prototype.tickEvery = it.prototype.Ea),
              (it.prototype.tickAfter = it.prototype.ka),
              (it.prototype.tickNow = it.prototype.Jb));
            function SP(e, t) {
              return e.concat(t);
            }
            function EP() {}
            function so(e) {
              return e != null;
            }
            function ah(e, t) {
              return Promise.race([
                t,
                new Promise(function (r, s) {
                  new it(s).ka(e);
                }),
              ]);
            }
            function Ir() {}
            function Ga(e, t) {
              return ((e = At(e)), (t = At(t)), e.split("-")[0] == t.split("-")[0]);
            }
            function Nu(e, t) {
              return (
                (e = At(e)),
                (t = At(t)),
                (e = e.split("-")),
                (t = t.split("-")),
                e[0] == t[0] && e.length == 1 && t.length == 2
              );
            }
            function bm(e, t) {
              return (
                (e = At(e)),
                (t = At(t)),
                (e = e.split("-")),
                (t = t.split("-")),
                e.length == 2 && t.length == 2 && e[0] == t[0]
              );
            }
            function At(e) {
              e = I(e.split("-x-"));
              var t = e.next().value;
              ((t = t === void 0 ? "" : t), (e = e.next().value), (e = e === void 0 ? "" : e));
              var r = I(t.split("-"));
              return (
                (t = r.next().value),
                (t = t === void 0 ? "" : t),
                (r = r.next().value),
                (r = r === void 0 ? "" : r),
                (e = e ? "x-" + e : ""),
                (t = t.toLowerCase()),
                (t = hE.get(t) || t),
                (r = r.toUpperCase()),
                (r ? t + "-" + r : t) + (e ? "-" + e : "")
              );
            }
            function Xo(e, t) {
              return ((e = At(e)), (t = At(t)), t == e ? 4 : Nu(t, e) ? 3 : bm(t, e) ? 2 : Nu(e, t) ? 1 : 0);
            }
            function lh(e) {
              var t = e.indexOf("-");
              return ((e = t >= 0 ? e.substring(0, t) : e), (e = e.toLowerCase()), (e = hE.get(e) || e));
            }
            function Dm(e) {
              return e.language
                ? At(e.language)
                : e.audio && e.audio.language
                  ? At(e.audio.language)
                  : e.video && e.video.language
                    ? At(e.video.language)
                    : "und";
            }
            function uh(e, t) {
              e = At(e);
              var r = new Set();
              t = I(t);
              for (var s = t.next(); !s.done; s = t.next()) r.add(At(s.value));
              for (t = I(r), s = t.next(); !s.done; s = t.next()) if (((s = s.value), s == e)) return s;
              for (t = I(r), s = t.next(); !s.done; s = t.next()) if (((s = s.value), Nu(s, e))) return s;
              for (t = I(r), s = t.next(); !s.done; s = t.next()) if (((s = s.value), bm(s, e))) return s;
              for (r = I(r), t = r.next(); !t.done; t = r.next()) if (((t = t.value), Nu(e, t))) return t;
              return null;
            }
            (Ee("shaka.util.LanguageUtils", Ir),
              (Ir.findClosestLocale = uh),
              (Ir.getLocaleForVariant = Dm),
              (Ir.getLocaleForText = function (e) {
                return At(e.language || "und");
              }),
              (Ir.getBase = lh),
              (Ir.relatedness = Xo),
              (Ir.areSiblings = function (e, t) {
                var r = lh(e),
                  s = lh(t);
                return e != r && t != s && r == s;
              }),
              (Ir.normalize = At),
              (Ir.isSiblingOf = bm),
              (Ir.isParentOf = Nu),
              (Ir.areLanguageCompatible = Ga),
              (Ir.areLocaleCompatible = function (e, t) {
                return ((e = At(e)), (t = At(t)), e == t);
              }));
            var hE = new Map([
              ["aar", "aa"],
              ["abk", "ab"],
              ["afr", "af"],
              ["aka", "ak"],
              ["alb", "sq"],
              ["amh", "am"],
              ["ara", "ar"],
              ["arg", "an"],
              ["arm", "hy"],
              ["asm", "as"],
              ["ava", "av"],
              ["ave", "ae"],
              ["aym", "ay"],
              ["aze", "az"],
              ["bak", "ba"],
              ["bam", "bm"],
              ["baq", "eu"],
              ["bel", "be"],
              ["ben", "bn"],
              ["bih", "bh"],
              ["bis", "bi"],
              ["bod", "bo"],
              ["bos", "bs"],
              ["bre", "br"],
              ["bul", "bg"],
              ["bur", "my"],
              ["cat", "ca"],
              ["ces", "cs"],
              ["cha", "ch"],
              ["che", "ce"],
              ["chi", "zh"],
              ["chu", "cu"],
              ["chv", "cv"],
              ["cor", "kw"],
              ["cos", "co"],
              ["cre", "cr"],
              ["cym", "cy"],
              ["cze", "cs"],
              ["dan", "da"],
              ["deu", "de"],
              ["div", "dv"],
              ["dut", "nl"],
              ["dzo", "dz"],
              ["ell", "el"],
              ["eng", "en"],
              ["epo", "eo"],
              ["est", "et"],
              ["eus", "eu"],
              ["ewe", "ee"],
              ["fao", "fo"],
              ["fas", "fa"],
              ["fij", "fj"],
              ["fin", "fi"],
              ["fra", "fr"],
              ["fre", "fr"],
              ["fry", "fy"],
              ["ful", "ff"],
              ["geo", "ka"],
              ["ger", "de"],
              ["gla", "gd"],
              ["gle", "ga"],
              ["glg", "gl"],
              ["glv", "gv"],
              ["gre", "el"],
              ["grn", "gn"],
              ["guj", "gu"],
              ["hat", "ht"],
              ["hau", "ha"],
              ["heb", "he"],
              ["her", "hz"],
              ["hin", "hi"],
              ["hmo", "ho"],
              ["hrv", "hr"],
              ["hun", "hu"],
              ["hye", "hy"],
              ["ibo", "ig"],
              ["ice", "is"],
              ["ido", "io"],
              ["iii", "ii"],
              ["iku", "iu"],
              ["ile", "ie"],
              ["ina", "ia"],
              ["ind", "id"],
              ["ipk", "ik"],
              ["isl", "is"],
              ["ita", "it"],
              ["jav", "jv"],
              ["jpn", "ja"],
              ["kal", "kl"],
              ["kan", "kn"],
              ["kas", "ks"],
              ["kat", "ka"],
              ["kau", "kr"],
              ["kaz", "kk"],
              ["khm", "km"],
              ["kik", "ki"],
              ["kin", "rw"],
              ["kir", "ky"],
              ["kom", "kv"],
              ["kon", "kg"],
              ["kor", "ko"],
              ["kua", "kj"],
              ["kur", "ku"],
              ["lao", "lo"],
              ["lat", "la"],
              ["lav", "lv"],
              ["lim", "li"],
              ["lin", "ln"],
              ["lit", "lt"],
              ["ltz", "lb"],
              ["lub", "lu"],
              ["lug", "lg"],
              ["mac", "mk"],
              ["mah", "mh"],
              ["mal", "ml"],
              ["mao", "mi"],
              ["mar", "mr"],
              ["may", "ms"],
              ["mkd", "mk"],
              ["mlg", "mg"],
              ["mlt", "mt"],
              ["mon", "mn"],
              ["mri", "mi"],
              ["msa", "ms"],
              ["mya", "my"],
              ["nau", "na"],
              ["nav", "nv"],
              ["nbl", "nr"],
              ["nde", "nd"],
              ["ndo", "ng"],
              ["nep", "ne"],
              ["nld", "nl"],
              ["nno", "nn"],
              ["nob", "nb"],
              ["nor", "no"],
              ["nya", "ny"],
              ["oci", "oc"],
              ["oji", "oj"],
              ["ori", "or"],
              ["orm", "om"],
              ["oss", "os"],
              ["pan", "pa"],
              ["per", "fa"],
              ["pli", "pi"],
              ["pol", "pl"],
              ["por", "pt"],
              ["pus", "ps"],
              ["que", "qu"],
              ["roh", "rm"],
              ["ron", "ro"],
              ["rum", "ro"],
              ["run", "rn"],
              ["rus", "ru"],
              ["sag", "sg"],
              ["san", "sa"],
              ["sin", "si"],
              ["slk", "sk"],
              ["slo", "sk"],
              ["slv", "sl"],
              ["sme", "se"],
              ["smo", "sm"],
              ["sna", "sn"],
              ["snd", "sd"],
              ["som", "so"],
              ["sot", "st"],
              ["spa", "es"],
              ["sqi", "sq"],
              ["srd", "sc"],
              ["srp", "sr"],
              ["ssw", "ss"],
              ["sun", "su"],
              ["swa", "sw"],
              ["swe", "sv"],
              ["tah", "ty"],
              ["tam", "ta"],
              ["tat", "tt"],
              ["tel", "te"],
              ["tgk", "tg"],
              ["tgl", "tl"],
              ["tha", "th"],
              ["tib", "bo"],
              ["tir", "ti"],
              ["ton", "to"],
              ["tsn", "tn"],
              ["tso", "ts"],
              ["tuk", "tk"],
              ["tur", "tr"],
              ["twi", "tw"],
              ["uig", "ug"],
              ["ukr", "uk"],
              ["urd", "ur"],
              ["uzb", "uz"],
              ["ven", "ve"],
              ["vie", "vi"],
              ["vol", "vo"],
              ["wel", "cy"],
              ["wln", "wa"],
              ["wol", "wo"],
              ["xho", "xh"],
              ["yid", "yi"],
              ["yor", "yo"],
              ["zha", "za"],
              ["zho", "zh"],
              ["zul", "zu"],
            ]);
            function fE() {}
            function pE(e, t, r, s, a) {
              if (a.length) {
                var c = e.textStreams;
                a = I(a);
                for (var f = a.next(), g = {}; !f.done; g = { Fh: void 0 }, f = a.next())
                  if (
                    ((g.Fh = f.value),
                    (f = c.filter(
                      (function (D) {
                        return function (M) {
                          return !!(M.codecs.startsWith(D.Fh) || M.mimeType.startsWith(D.Fh));
                        };
                      })(g),
                    )),
                    f.length)
                  ) {
                    c = f;
                    break;
                  }
                e.textStreams = c;
              }
              if (((c = e.variants), (t.length || r.length) && (c = AP(c, t, r)), s.length)) {
                for (t = new La(), c = I(c), r = c.next(); !r.done; r = c.next())
                  ((r = r.value), t.push(String(r.video.width || 0), r));
                var m = [];
                (t.forEach(function (D, M) {
                  D = 0;
                  var P = [];
                  M = I(M);
                  for (var G = M.next(), U = {}; !G.done; U = { Xf: void 0 }, G = M.next())
                    ((U.Xf = G.value),
                      (G = s.filter(
                        (function (H) {
                          return function (Q) {
                            return H.Xf.decodingInfos[0][Q];
                          };
                        })(U),
                      ).length),
                      G > D ? ((D = G), (P = [U.Xf])) : G == D && P.push(U.Xf));
                  m.push.apply(m, V(P));
                }),
                  (c = m));
              }
              for (t = new Set(), r = I(c), a = r.next(); !a.done; a = r.next())
                ((a = a.value), a.video && t.add(a.video));
              if (t.size) {
                var x = {
                  vp8: 1,
                  avc: 1,
                  "dovi-avc": 0.95,
                  vp9: 0.9,
                  vp09: 0.9,
                  hevc: 0.85,
                  "dovi-hevc": 0.8,
                  "dovi-p5": 0.75,
                  av01: 0.7,
                  "dovi-av1": 0.65,
                  vvc: 0.6,
                };
                a = Array.from(t).sort(function (D, M) {
                  return D.bandwidth && M.bandwidth && D.bandwidth != M.bandwidth
                    ? D.bandwidth - M.bandwidth
                    : D.width != M.width
                      ? D.width - M.width
                      : D.codecs && M.codecs
                        ? ((D = Kn(D.codecs)), (M = Kn(M.codecs)), (x[D] || 1) - (x[M] || 1))
                        : 0;
                });
                var E = [];
                for (
                  t = new Map(),
                    r = function (D) {
                      var M = [
                        String(D.width || ""),
                        String(D.height || ""),
                        String(Math.round(D.frameRate || 0)),
                        D.hdr || "",
                        D.fastSwitching,
                      ];
                      return (
                        D.dependencyStream && M.push(D.dependencyStream.baseOriginalId || ""),
                        D.roles && M.push(D.roles.sort().join("_")),
                        M.join(";")
                      );
                    },
                    a = I(a),
                    f = a.next();
                  !f.done;
                  f = a.next()
                ) {
                  ((f = f.value), (g = r(f)));
                  var A = t.get(g) || [];
                  if (A.length) {
                    var R = Kn(A[A.length - 1].codecs),
                      b = Kn(f.codecs);
                    R == b && (A.push(f), E.push(f.id));
                  } else (A.push(f), E.push(f.id));
                  t.set(g, A);
                }
                e.variants = c.filter(function (D) {
                  return !((D = D.video) && !E.includes(D.id));
                });
              } else e.variants = c;
            }
            function AP(e, t, r) {
              t = I(t);
              for (var s = t.next(), a = {}; !s.done; a = { lj: void 0 }, s = t.next())
                if (
                  ((a.lj = s.value),
                  (s = e.filter(
                    (function (c) {
                      return function (f) {
                        return f.video && f.video.codecs.startsWith(c.lj);
                      };
                    })(a),
                  )),
                  s.length)
                ) {
                  e = s;
                  break;
                }
              for (r = I(r), t = r.next(), s = {}; !t.done; s = { Rh: void 0 }, t = r.next())
                if (
                  ((s.Rh = t.value),
                  (t = e.filter(
                    (function (c) {
                      return function (f) {
                        return f.audio && f.audio.codecs.startsWith(c.Rh);
                      };
                    })(s),
                  )),
                  t.length)
                ) {
                  e = t;
                  break;
                }
              return e;
            }
            function IP(e, t, r) {
              e.variants = e.variants.filter(function (s) {
                return ch(s, t, r);
              });
            }
            function ch(e, t, r) {
              function s(f, g, m) {
                return f >= g && f <= m;
              }
              if (e && e.video && e.video.width && e.video.height) {
                var a = e.video.width,
                  c = e.video.height;
                if (
                  (c > a && ((c = I([c, a])), (a = c.next().value), (c = c.next().value)),
                  !s(a, t.minWidth, Math.min(t.maxWidth, r.width)) ||
                    !s(c, t.minHeight, Math.min(t.maxHeight, r.height)) ||
                    !s(a * c, t.minPixels, t.maxPixels))
                )
                  return !1;
              }
              return !(
                (e &&
                  e.video &&
                  e.video.frameRate &&
                  !s(e.video.frameRate, t.minFrameRate, t.maxFrameRate)) ||
                (e &&
                  e.audio &&
                  e.audio.channelsCount &&
                  !s(e.audio.channelsCount, t.minChannelsCount, t.maxChannelsCount)) ||
                !s(e.bandwidth, t.minBandwidth, t.maxBandwidth)
              );
            }
            function wP(e, t, r, s) {
              return (
                (r = r === void 0 ? [] : r),
                (s = s === void 0 ? {} : s),
                W(function (a) {
                  return a.g == 1
                    ? _(a, gE(e, t, t.offlineSessionIds.length > 0, r, s), 2)
                    : (_P(t), _(a, bP(t), 0));
                })
              );
            }
            function gE(e, t, r, s, a) {
              var c, f;
              return W(function (g) {
                if (g.g == 1) return (tt().$i() && RP(t.variants), _(g, km(t.variants, r, !1, s), 2));
                ((c = null),
                  e && (f = e.g) && (c = f.keySystem),
                  (t.variants = t.variants.filter(function (m) {
                    var x = CP(m, c, a);
                    if (!x) {
                      var E = [];
                      (m.audio && E.push(EE(m.audio)), m.video && E.push(EE(m.video)));
                    }
                    return x;
                  })),
                  K(g));
              });
            }
            function RP(e) {
              var t = new Map()
                  .set("dvav", "avc3")
                  .set("dva1", "avc1")
                  .set("dvhe", "hev1")
                  .set("dvh1", "hvc1")
                  .set("dvc1", "vvc1")
                  .set("dvi1", "vvi1"),
                r = new Set();
              e = I(e);
              for (var s = e.next(); !s.done; s = e.next()) ((s = s.value), s.video && r.add(s.video));
              for (r = I(r), e = r.next(); !e.done; e = r.next()) {
                ((e = e.value), (s = I(t)));
                for (var a = s.next(); !a.done; a = s.next()) {
                  var c = I(a.value);
                  if (((a = c.next().value), (c = c.next().value), e.codecs.includes(a))) {
                    e.codecs = e.codecs.replace(a, c);
                    break;
                  }
                }
              }
            }
            function CP(e, t, r) {
              if (
                !e.decodingInfos.some(function (m) {
                  return !(
                    !m.supported ||
                    (t && (m = m.keySystemAccess) && (r[m.keySystem] || m.keySystem) != t)
                  );
                })
              )
                return !1;
              var s = tt(),
                a = s.Nb() === "Xbox";
              s = s.Oa() === "MOBILE" && s.Ha() === "GECKO";
              var c = e.video,
                f = (c && c.width) || 0,
                g = (c && c.height) || 0;
              return (a &&
                c &&
                (f > 1920 || g > 1080) &&
                (c.codecs.includes("avc1.") || c.codecs.includes("avc3."))) ||
                ((a = c && c.dependencyStream) && !jS(a))
                ? !1
                : ((e = e.audio),
                  !(
                    (s && e && e.encrypted && e.codecs.toLowerCase().includes("opus")) ||
                    (e && e.dependencyStream)
                  ));
            }
            function mE(e, t) {
              var r, s, a, c, f, g, m;
              return W(function (x) {
                if (x.g == 1) {
                  for (
                    r = function (E, A) {
                      if (E) {
                        var R = to(E);
                        return (
                          (R.supported = E.supported && A.supported),
                          (R.powerEfficient = E.powerEfficient && A.powerEfficient),
                          (R.smooth = E.smooth && A.smooth),
                          A.keySystemAccess && !R.keySystemAccess && (R.keySystemAccess = A.keySystemAccess),
                          R
                        );
                      }
                      return A;
                    },
                      s = null,
                      a = [],
                      c = I(t),
                      f = c.next(),
                      g = {};
                    !f.done;
                    g = { cache: void 0, Se: void 0 }, f = c.next()
                  )
                    ((m = f.value),
                      (g.Se = qd(m)),
                      (g.cache = ph),
                      g.cache.has(g.Se)
                        ? (s = r(s, g.cache.get(g.Se)))
                        : a.push(
                            LP(m).then(
                              (function (E) {
                                return function (A) {
                                  var R = null;
                                  A = I(A || []);
                                  for (var b = A.next(); !b.done; b = A.next()) R = r(R, b.value);
                                  R && (E.cache.set(E.Se, R), (s = r(s, R)));
                                };
                              })(g),
                            ),
                          ));
                  return _(x, Promise.all(a), 2);
                }
                (s && e.decodingInfos.push(s), K(x));
              });
            }
            function LP(e) {
              var t = [""];
              e.video && (t = Ei(e.video.contentType).split(","));
              var r = [""];
              e.audio && (r = Ei(e.audio.contentType).split(","));
              var s = [];
              t = I(t);
              for (var a = t.next(); !a.done; a = t.next()) {
                a = a.value;
                for (var c = I(r), f = c.next(), g = {}; !f.done; g = { Qc: void 0 }, f = c.next())
                  ((f = f.value),
                    (g.Qc = Ar(e)),
                    e.video && (g.Qc.video.contentType = tn(Pi(g.Qc.video.contentType), a)),
                    e.audio && (g.Qc.audio.contentType = tn(Pi(g.Qc.audio.contentType), f)),
                    s.push(
                      new Promise(
                        (function (m) {
                          return function (x, E) {
                            (tt().Oa() == "MOBILE"
                              ? ah(5, navigator.mediaCapabilities.decodingInfo(m.Qc))
                              : navigator.mediaCapabilities.decodingInfo(m.Qc)
                            )
                              .then(function (A) {
                                x(A);
                              })
                              .catch(E);
                          };
                        })(g),
                      ),
                    ));
              }
              return Promise.all(s).catch(function () {
                return (JSON.stringify(e), null);
              });
            }
            function km(e, t, r, s) {
              var a, c, f, g, m, x, E, A, R, b, D, M, P, G, U, H, Q, ne;
              return W(function (z) {
                switch (z.g) {
                  case 1:
                    if (
                      e.some(function (J) {
                        return J.decodingInfos.length;
                      })
                    )
                      return z.return();
                    ((a = I(s)), (c = a.next()), (f = {}));
                  case 2:
                    if (c.done) {
                      z.A(4);
                      break;
                    }
                    ((f.Ji = c.value), (g = !1), (m = I(e)), (x = m.next()));
                  case 5:
                    if (x.done) {
                      z.A(7);
                      break;
                    }
                    ((E = x.value),
                      (A = yE(E, t, r).filter(
                        (function (J) {
                          return function (X) {
                            return (
                              (X = X[0]),
                              (X.keySystemConfiguration && X.keySystemConfiguration.keySystem) === J.Ji
                            );
                          };
                        })(f),
                      )),
                      (R = I(A)),
                      (b = R.next()));
                  case 8:
                    if (b.done) {
                      z.A(10);
                      break;
                    }
                    return ((D = b.value), _(z, mE(E, D), 9));
                  case 9:
                    ((b = R.next()), z.A(8));
                    break;
                  case 10:
                    (E.decodingInfos.some(function (J) {
                      return J.supported;
                    }) && (g = !0),
                      (x = m.next()),
                      z.A(5));
                    break;
                  case 7:
                    if (g) return z.return();
                    ((f = { Ji: void 0 }), (c = a.next()), z.A(2));
                    break;
                  case 4:
                    ((M = I(e)), (P = M.next()));
                  case 12:
                    if (P.done) {
                      z.A(0);
                      break;
                    }
                    ((G = P.value),
                      (U = yE(G, t, r).filter(function (J) {
                        return (
                          (J = J[0]),
                          (J = J.keySystemConfiguration && J.keySystemConfiguration.keySystem),
                          !J || !s.includes(J)
                        );
                      })),
                      (H = I(U)),
                      (Q = H.next()));
                  case 15:
                    if (Q.done) {
                      ((P = M.next()), z.A(12));
                      break;
                    }
                    return ((ne = Q.value), _(z, mE(G, ne), 16));
                  case 16:
                    ((Q = H.next()), z.A(15));
                }
              });
            }
            function yE(e, t, r) {
              var s = e.audio,
                a = e.video,
                c = [],
                f = [];
              if (a)
                for (var g = I(a.fullMimeTypes), m = g.next(); !m.done; m = g.next()) {
                  m = m.value;
                  var x = Ei(m);
                  if (x.includes(",") && !s) {
                    var E = x.split(","),
                      A = Pi(m);
                    ((x = Ma("video", E)),
                      (E = Ma("audio", E)),
                      (E = Fu(E, A)),
                      (A = _m(A, E, "audio")),
                      f.push({
                        contentType: A,
                        channels: 2,
                        bitrate: e.bandwidth || 1,
                        samplerate: 1,
                        spatialRendering: !1,
                      }));
                  }
                  if (
                    ((x = vE(x)),
                    (m = {
                      contentType: _m(Pi(m), x, "video"),
                      width: a.width || 64,
                      height: a.height || 64,
                      bitrate: a.bandwidth || e.bandwidth || 1,
                      framerate: a.frameRate || 30,
                    }),
                    a.hdr)
                  )
                    switch (a.hdr) {
                      case "PQ":
                        m.transferFunction = "pq";
                        break;
                      case "HLG":
                        m.transferFunction = "hlg";
                    }
                  (a.colorGamut && (m.colorGamut = a.colorGamut), c.push(m));
                }
              if (s)
                for (g = I(s.fullMimeTypes), m = g.next(); !m.done; m = g.next())
                  ((x = m.value),
                    (m = Pi(x)),
                    (x = Fu(Ei(x), m)),
                    (m = _m(m, x, "audio")),
                    f.push({
                      contentType: m,
                      channels: s.channelsCount || 2,
                      bitrate: s.bandwidth || e.bandwidth || 1,
                      samplerate: s.audioSamplingRate || 1,
                      spatialRendering: s.spatialAudio,
                    }));
              for (
                g = [], c.length == 0 && c.push(null), f.length == 0 && f.push(null), c = I(c), m = c.next();
                !m.done;
                m = c.next()
              )
                for (m = m.value, x = I(f), A = x.next(); !A.done; A = x.next())
                  ((A = A.value),
                    (E = { type: r ? "file" : "media-source" }),
                    m && (E.video = m),
                    A && (E.audio = A),
                    g.push(E));
              if (
                ((f = (e.video ? e.video.drmInfos : []).concat(e.audio ? e.audio.drmInfos : [])), !f.length)
              )
                return [g];
              for (e = [], r = new Map(), f = I(f), c = f.next(); !c.done; c = f.next())
                ((c = c.value), r.get(c.keySystem) || r.set(c.keySystem, []), r.get(c.keySystem).push(c));
              for (
                f = t ? "required" : "optional",
                  t = t ? ["persistent-license"] : ["temporary"],
                  c = I(r.keys()),
                  m = c.next();
                !m.done;
                m = c.next()
              ) {
                for (
                  m = m.value, A = r.get(m), x = new Map(), A = I(A), E = A.next();
                  !E.done;
                  E = A.next()
                ) {
                  E = E.value;
                  var R = E.videoRobustness + "," + E.audioRobustness;
                  (x.get(R) || x.set(R, []), x.get(R).push(E));
                }
                for (x = I(x.values()), A = x.next(); !A.done; A = x.next()) {
                  ((A = A.value), (E = []), (R = I(g)));
                  for (var b = R.next(); !b.done; b = R.next()) {
                    b = Object.assign({}, b.value);
                    for (
                      var D = {
                          keySystem: m,
                          initDataType: "cenc",
                          persistentState: f,
                          distinctiveIdentifier: "optional",
                          sessionTypes: t,
                        },
                        M = I(A),
                        P = M.next();
                      !P.done;
                      P = M.next()
                    ) {
                      if (((P = P.value), P.initData && P.initData.length)) {
                        for (var G = new Set(), U = I(P.initData), H = U.next(); !H.done; H = U.next())
                          G.add(H.value.initDataType);
                        D.initDataType = P.initData[0].initDataType;
                      }
                      (P.distinctiveIdentifierRequired && (D.distinctiveIdentifier = "required"),
                        P.persistentStateRequired && (D.persistentState = "required"),
                        P.sessionType && (D.sessionTypes = [P.sessionType]),
                        s &&
                          (D.audio
                            ? (P.encryptionScheme &&
                                (D.audio.encryptionScheme = D.audio.encryptionScheme || P.encryptionScheme),
                              (D.audio.robustness = D.audio.robustness || P.audioRobustness))
                            : ((D.audio = { robustness: P.audioRobustness }),
                              P.encryptionScheme && (D.audio.encryptionScheme = P.encryptionScheme)),
                          D.audio.robustness == "" && delete D.audio.robustness),
                        a &&
                          (D.video
                            ? (P.encryptionScheme &&
                                (D.video.encryptionScheme = D.video.encryptionScheme || P.encryptionScheme),
                              (D.video.robustness = D.video.robustness || P.videoRobustness))
                            : ((D.video = { robustness: P.videoRobustness }),
                              P.encryptionScheme && (D.video.encryptionScheme = P.encryptionScheme)),
                          D.video.robustness == "" && delete D.video.robustness));
                    }
                    ((b.keySystemConfiguration = D), E.push(b));
                  }
                  e.push(E);
                }
              }
              return e;
            }
            function Fu(e, t) {
              var r = tt();
              return e.toLowerCase() == "flac"
                ? r.Ha() != "WEBKIT"
                  ? "flac"
                  : "fLaC"
                : e.toLowerCase() === "opus"
                  ? r.Ha() != "WEBKIT"
                    ? "opus"
                    : Du(t) == "mp4"
                      ? "Opus"
                      : "opus"
                  : e.toLowerCase() == "ac-3" && r.se()
                    ? "ec-3"
                    : e;
            }
            function vE(e) {
              if (e.includes("avc1")) {
                var t = e.split(".");
                if (t.length == 3)
                  return (
                    (e = t.shift() + "."),
                    (e += parseInt(t.shift(), 10).toString(16)),
                    (e += ("000" + parseInt(t.shift(), 10).toString(16)).slice(-4))
                  );
              } else if (e == "vp9") return "vp09.00.41.08";
              return e;
            }
            function _P(e) {
              e.textStreams = e.textStreams.filter(function (t) {
                return ((t = tn(t.mimeType, t.codecs)), Mu(t));
              });
            }
            function bP(e) {
              var t, r, s, a, c, f, g;
              return W(function (m) {
                switch (m.g) {
                  case 1:
                    ((t = []), (r = I(e.imageStreams)), (s = r.next()));
                  case 2:
                    if (s.done) {
                      m.A(4);
                      break;
                    }
                    if (
                      ((a = s.value),
                      (c = a.mimeType),
                      c == "application/mp4" && a.codecs == "mjpg" && (c = "image/jpg"),
                      gh.has(c))
                    ) {
                      m.A(5);
                      break;
                    }
                    if (((f = PP.get(c)), !f)) {
                      (gh.set(c, !1), m.A(5));
                      break;
                    }
                    return _(m, DP(f), 7);
                  case 7:
                    ((g = m.h), gh.set(c, g));
                  case 5:
                    (gh.get(c) && t.push(a), (s = r.next()), m.A(2));
                    break;
                  case 4:
                    ((e.imageStreams = t), K(m));
                }
              });
            }
            function DP(e) {
              return new Promise(function (t) {
                var r = new Image();
                ((r.src = e),
                  "decode" in r
                    ? r
                        .decode()
                        .then(function () {
                          t(!0);
                        })
                        .catch(function () {
                          t(!1);
                        })
                    : (r.onload = r.onerror =
                        function () {
                          t(r.height === 2);
                        }));
              });
            }
            function qo(e) {
              var t = e.audio,
                r = e.video,
                s = t ? t.mimeType : null,
                a = r ? r.mimeType : null,
                c = t ? t.codecs : null,
                f = r ? r.codecs : null,
                g = t ? t.groupId : null,
                m = [];
              (r && m.push(r.mimeType), t && m.push(t.mimeType), (m = m[0] || null));
              var x = [];
              (t && x.push(t.kind), r && x.push(r.kind), (x = x[0] || null));
              var E = new Set();
              if (t) for (var A = I(t.roles), R = A.next(); !R.done; R = A.next()) E.add(R.value);
              if (r) for (A = I(r.roles), R = A.next(); !R.done; R = A.next()) E.add(R.value);
              if (
                ((e = {
                  id: e.id,
                  active: !1,
                  type: "variant",
                  bandwidth: e.bandwidth,
                  language: e.language,
                  label: null,
                  videoLabel: null,
                  kind: x,
                  width: null,
                  height: null,
                  frameRate: null,
                  pixelAspectRatio: null,
                  hdr: null,
                  colorGamut: null,
                  videoLayout: null,
                  mimeType: m,
                  audioMimeType: s,
                  videoMimeType: a,
                  codecs: "",
                  audioCodec: c,
                  videoCodec: f,
                  primary: e.primary,
                  roles: Array.from(E),
                  audioRoles: null,
                  videoRoles: null,
                  forced: !1,
                  videoId: null,
                  audioId: null,
                  audioGroupId: g,
                  channelsCount: null,
                  audioSamplingRate: null,
                  spatialAudio: !1,
                  tilesLayout: null,
                  audioBandwidth: null,
                  videoBandwidth: null,
                  originalVideoId: null,
                  originalAudioId: null,
                  originalTextId: null,
                  originalImageId: null,
                  accessibilityPurpose: null,
                  originalLanguage: null,
                }),
                r &&
                  ((e.videoId = r.id),
                  (e.originalVideoId = r.originalId),
                  (e.width = r.width || null),
                  (e.height = r.height || null),
                  (e.frameRate = r.frameRate || null),
                  (e.pixelAspectRatio = r.pixelAspectRatio || null),
                  (e.videoBandwidth = r.bandwidth || null),
                  (e.hdr = r.hdr || null),
                  (e.colorGamut = r.colorGamut || null),
                  (e.videoLayout = r.videoLayout || null),
                  (e.videoRoles = r.roles),
                  (e.videoLabel = r.label),
                  (s = r.dependencyStream) &&
                    ((e.width = s.width || e.width),
                    (e.height = s.height || e.height),
                    (e.videoCodec = s.codecs || e.videoCodec),
                    (e.pixelAspectRatio = s.pixelAspectRatio || e.pixelAspectRatio),
                    e.videoBandwidth && s.bandwidth && (e.videoBandwidth += s.bandwidth)),
                  f.includes(",")))
              ) {
                ((e.channelsCount = r.channelsCount),
                  (e.audioSamplingRate = r.audioSamplingRate),
                  (e.spatialAudio = r.spatialAudio),
                  (e.originalLanguage = r.originalLanguage),
                  (e.audioMimeType = a),
                  (a = f.split(",")));
                try {
                  ((e.videoCodec = Ma("video", a)), (e.audioCodec = Ma("audio", a)));
                } catch (b) {}
              }
              return (
                t &&
                  ((e.audioId = t.id),
                  (e.originalAudioId = t.originalId),
                  (e.channelsCount = t.channelsCount),
                  (e.audioSamplingRate = t.audioSamplingRate),
                  (e.audioBandwidth = t.bandwidth || null),
                  (e.spatialAudio = t.spatialAudio),
                  (e.label = t.label),
                  (e.audioRoles = t.roles),
                  (e.accessibilityPurpose = t.accessibilityPurpose),
                  (e.originalLanguage = t.originalLanguage),
                  (a = t.dependencyStream)) &&
                  ((e.audioCodec = a.codecs || e.audioCodec),
                  e.audioBandwidth && a.bandwidth && (e.audioBandwidth += a.bandwidth)),
                r &&
                  !e.videoBandwidth &&
                  (t
                    ? e.audioBandwidth && (e.videoBandwidth = e.bandwidth - e.audioBandwidth)
                    : (e.videoBandwidth = e.bandwidth)),
                t &&
                  !e.audioBandwidth &&
                  (r
                    ? e.videoBandwidth && (e.audioBandwidth = e.bandwidth - e.videoBandwidth)
                    : (e.audioBandwidth = e.bandwidth)),
                (t = []),
                e.videoCodec && t.push(e.videoCodec),
                e.audioCodec && t.push(e.audioCodec),
                (e.codecs = t.join(", ")),
                e
              );
            }
            function Qo(e) {
              return {
                id: e.id,
                active: !1,
                type: nt,
                bandwidth: e.bandwidth || 0,
                language: e.language,
                label: e.label,
                kind: e.kind || null,
                mimeType: e.mimeType,
                codecs: e.codecs || null,
                primary: e.primary,
                roles: e.roles,
                accessibilityPurpose: e.accessibilityPurpose,
                forced: e.forced,
                originalTextId: e.originalId,
                originalLanguage: e.originalLanguage,
              };
            }
            function Mm(e) {
              var t = e.width || null,
                r = e.height || null,
                s = null;
              e.segmentIndex && (s = $r(e.segmentIndex));
              var a = e.tilesLayout;
              return (
                s && (a = s.tilesLayout || a),
                a && t != null && (t /= Number(a.split("x")[0])),
                a && r != null && (r /= Number(a.split("x")[1])),
                {
                  id: e.id,
                  type: "image",
                  bandwidth: e.bandwidth || 0,
                  width: t,
                  height: r,
                  mimeType: e.mimeType,
                  codecs: e.codecs || null,
                  tilesLayout: a || null,
                  originalImageId: e.originalId,
                }
              );
            }
            function dh(e) {
              return (e.__shaka_id || (e.__shaka_id = MP++), e.__shaka_id);
            }
            function xE(e) {
              var t = {
                id: dh(e),
                active: e.mode != "disabled",
                type: nt,
                bandwidth: 0,
                language: At(e.language || "und"),
                label: e.label,
                kind: e.kind,
                mimeType: null,
                codecs: null,
                primary: !1,
                roles: [],
                accessibilityPurpose: null,
                forced: e.kind == "forced",
                originalTextId: e.id,
                originalLanguage: e.language,
              };
              return (
                e.kind == "captions" && (t.mimeType = "unknown"),
                e.kind == "subtitles" && (t.mimeType = "text/vtt"),
                e.kind && (t.roles = [e.kind]),
                t
              );
            }
            function hh(e, t) {
              var r = e ? e.language : null;
              if (
                ((r = {
                  id: dh(e || t),
                  active: e ? e.enabled : t.selected,
                  type: "variant",
                  bandwidth: 0,
                  language: At(r || "und"),
                  label: e ? e.label : null,
                  videoLabel: null,
                  kind: e ? e.kind : null,
                  width: null,
                  height: null,
                  frameRate: null,
                  pixelAspectRatio: null,
                  hdr: null,
                  colorGamut: null,
                  videoLayout: null,
                  mimeType: null,
                  audioMimeType: null,
                  videoMimeType: null,
                  codecs: null,
                  audioCodec: null,
                  videoCodec: null,
                  primary: e ? e.kind == "main" : !1,
                  roles: [],
                  forced: !1,
                  audioRoles: null,
                  videoRoles: null,
                  videoId: null,
                  audioId: null,
                  audioGroupId: null,
                  channelsCount: null,
                  audioSamplingRate: null,
                  spatialAudio: !1,
                  tilesLayout: null,
                  audioBandwidth: null,
                  videoBandwidth: null,
                  originalVideoId: t ? t.id : null,
                  originalAudioId: e ? e.id : null,
                  originalTextId: null,
                  originalImageId: null,
                  accessibilityPurpose: null,
                  originalLanguage: r,
                }),
                e && e.kind && ((r.roles = [e.kind]), (r.audioRoles = [e.kind])),
                e &&
                  e.configuration &&
                  (e.configuration.codec &&
                    ((r.audioCodec = e.configuration.codec), (r.codecs = r.audioCodec)),
                  e.configuration.bitrate &&
                    ((r.audioBandwidth = e.configuration.bitrate), (r.bandwidth += r.audioBandwidth)),
                  e.configuration.sampleRate && (r.audioSamplingRate = e.configuration.sampleRate),
                  e.configuration.numberOfChannels && (r.channelsCount = e.configuration.numberOfChannels)),
                t &&
                  t.configuration &&
                  (t.configuration.codec &&
                    ((r.videoCodec = t.configuration.codec),
                    (r.codecs = r.codecs ? r.codecs + ("," + r.videoCodec) : r.videoCodec)),
                  t.configuration.bitrate &&
                    ((r.videoBandwidth = t.configuration.bitrate), (r.bandwidth += r.videoBandwidth)),
                  t.configuration.framerate && (r.frameRate = t.configuration.framerate),
                  t.configuration.width && (r.width = t.configuration.width),
                  t.configuration.height && (r.height = t.configuration.height),
                  t.configuration.colorSpace && t.configuration.colorSpace.transfer))
              )
                switch (t.configuration.colorSpace.transfer) {
                  case "pq":
                    r.hdr = "PQ";
                    break;
                  case "hlg":
                    r.hdr = "HLG";
                    break;
                  case "bt709":
                    r.hdr = "SDR";
                }
              return r;
            }
            function Uu(e) {
              return e.allowedByApplication && e.allowedByKeySystem && e.disabledUntilTime == 0;
            }
            function fh(e) {
              return e.filter(function (t) {
                return Uu(t);
              });
            }
            function ja(e, t, r, s) {
              var a = e,
                c = e.filter(function (m) {
                  return m.primary;
                });
              c.length && (a = c);
              var f = a.length ? a[0].language : "";
              if (
                ((a = a.filter(function (m) {
                  return m.language == f;
                })),
                t)
              ) {
                var g = uh(
                  At(t),
                  e.map(function (m) {
                    return m.language;
                  }),
                );
                g &&
                  (a = e.filter(function (m) {
                    return At(m.language) == g;
                  }));
              }
              if (
                ((a = a.filter(function (m) {
                  return m.forced == s;
                })),
                r)
              ) {
                if (((e = TE(a, r)), e.length)) return e;
              } else if (
                ((e = a.filter(function (m) {
                  return m.roles.length == 0;
                })),
                e.length)
              )
                return e;
              return (
                (e = a
                  .map(function (m) {
                    return m.roles;
                  })
                  .reduce(SP, [])),
                e.length ? TE(a, e[0]) : a
              );
            }
            function TE(e, t) {
              return e.filter(function (r) {
                return r.roles.includes(t);
              });
            }
            function kP(e) {
              var t = [];
              return (e.audio && t.push(e.audio), e.video && t.push(e.video), t);
            }
            function SE(e, t) {
              t.length &&
                ((t = t
                  .filter(function (r) {
                    return Kn(e.codecs) == Kn(r.codecs);
                  })
                  .sort(function (r, s) {
                    return r.bandwidth && s.bandwidth && r.bandwidth != s.bandwidth
                      ? r.bandwidth - s.bandwidth
                      : (r.width || 0) - (s.width || 0);
                  })),
                (e.trickModeVideo = t[0]),
                t.length > 1 &&
                  (t = t.find(function (r) {
                    return e.width == r.width && e.height == r.height;
                  }))) &&
                (e.trickModeVideo = t);
            }
            function EE(e) {
              return e.type == "audio"
                ? "type=audio codecs=" +
                    e.codecs +
                    " bandwidth=" +
                    e.bandwidth +
                    " channelsCount=" +
                    e.channelsCount +
                    " audioSamplingRate=" +
                    e.audioSamplingRate
                : e.type == "video"
                  ? "type=video codecs=" +
                    e.codecs +
                    " bandwidth=" +
                    e.bandwidth +
                    " frameRate=" +
                    e.frameRate +
                    " width=" +
                    e.width +
                    " height=" +
                    e.height
                  : "unexpected stream type";
            }
            function AE(e, t, r) {
              if (r.autoShowText == 0) return !1;
              if (r.autoShowText == 1) return !0;
              var s = At(r.preferredTextLanguage);
              return (
                (t = At(t.language)),
                r.autoShowText == 2
                  ? Ga(t, s)
                  : r.autoShowText == 3
                    ? e
                      ? ((e = At(e.language)), Ga(t, s) && !Ga(e, t))
                      : !1
                    : (He("Invalid autoShowText setting!"), !1)
              );
            }
            function IE(e) {
              var t = {
                id: 0,
                language: "und",
                disabledUntilTime: 0,
                primary: !1,
                audio: null,
                video: null,
                bandwidth: 100,
                allowedByApplication: !0,
                allowedByKeySystem: !0,
                decodingInfos: [],
              };
              e = I(e);
              for (var r = e.next(); !r.done; r = e.next()) {
                r = r.value;
                var s = {
                  id: 0,
                  originalId: null,
                  groupId: null,
                  createSegmentIndex: function () {
                    return Promise.resolve();
                  },
                  segmentIndex: null,
                  mimeType: r ? Pi(r) : "",
                  codecs: r ? Ei(r) : "",
                  encrypted: !0,
                  drmInfos: [],
                  keyIds: new Set(),
                  language: "und",
                  originalLanguage: null,
                  label: null,
                  type: "video",
                  primary: !1,
                  trickModeVideo: null,
                  dependencyStream: null,
                  emsgSchemeIdUris: null,
                  roles: [],
                  forced: !1,
                  channelsCount: null,
                  audioSamplingRate: null,
                  spatialAudio: !1,
                  closedCaptions: null,
                  accessibilityPurpose: null,
                  external: !1,
                  fastSwitching: !1,
                  fullMimeTypes: new Set(),
                  isAudioMuxedInVideo: !1,
                  baseOriginalId: null,
                };
                (s.fullMimeTypes.add(tn(s.mimeType, s.codecs)),
                  r.startsWith("audio/") ? ((s.type = "audio"), (t.audio = s)) : (t.video = s));
              }
              return t;
            }
            (Ee("shaka.util.StreamUtils", fE), (fE.meetsRestrictions = ch));
            var ph = new Map(),
              MP = 0,
              gh = new Map()
                .set("image/svg+xml", !0)
                .set("image/png", !0)
                .set("image/jpeg", !0)
                .set("image/jpg", !0),
              PP = new Map()
                .set(
                  "image/webp",
                  "data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA",
                )
                .set(
                  "image/avif",
                  "data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=",
                );
            function qt() {
              var e = this;
              ((this.H = null),
                (this.G = !1),
                (this.u = new xi()),
                (this.j = new gt()),
                navigator.connection &&
                  navigator.connection.addEventListener &&
                  this.j.D(navigator.connection, "change", function () {
                    e.g.useNetworkInformation &&
                      navigator.onLine &&
                      ((e.u = new xi()), e.g && e.u.configure(e.g.advanced), e.trySuggestStreams());
                  }),
                (this.l = []),
                (this.I = 1),
                (this.J = !1),
                (this.h = this.o = this.g = this.B = null),
                (this.m = new it(function () {
                  if (e.G && (e.g.restrictToElementSize || e.g.restrictToScreenSize)) {
                    var t = e.chooseVariant();
                    t && e.H(t, e.g.clearBufferSwitch, e.g.safeMarginSwitch);
                  }
                })),
                (this.C = l),
                "documentPictureInPicture" in l &&
                  this.j.D(l.documentPictureInPicture, "enter", function () {
                    ((e.C = l.documentPictureInPicture.window),
                      e.m && e.m.Jb(),
                      e.j.Aa(e.C, "pagehide", function () {
                        ((e.C = l), e.m && e.m.Jb());
                      }));
                  }),
                (this.F = this.i = null));
            }
            ((d = qt.prototype),
              (d.stop = function () {
                ((this.H = null),
                  (this.G = !1),
                  (this.l = []),
                  (this.I = 1),
                  (this.o = this.B = null),
                  this.h && (this.h.disconnect(), (this.h = null)),
                  this.m && this.m.stop(),
                  (this.F = this.i = null));
              }),
              (d.release = function () {
                (this.stop(), this.j.release(), (this.m = null));
              }),
              (d.init = function (e) {
                this.H = e;
              }),
              (d.chooseVariant = function (e) {
                e = e === void 0 ? !1 : e;
                var t = 1 / 0,
                  r = 1 / 0;
                if (
                  (this.g.restrictToScreenSize &&
                    ((r = this.g.ignoreDevicePixelRatio ? 1 : this.C.devicePixelRatio),
                    (t = this.C.screen.height * r),
                    (r *= this.C.screen.width)),
                  this.h && this.g.restrictToElementSize)
                ) {
                  var s = this.g.ignoreDevicePixelRatio ? 1 : this.C.devicePixelRatio,
                    a = this.o.clientHeight,
                    c = this.o.clientWidth;
                  (this.i &&
                    document.pictureInPictureElement &&
                    document.pictureInPictureElement == this.o &&
                    ((a = this.i.height), (c = this.i.width)),
                    (t = Math.min(t, a * s)),
                    (r = Math.min(r, c * s)));
                }
                if (
                  ((a = this.l.filter(function (x) {
                    return x && !((x.audio && x.audio.fastSwitching) || (x.video && x.video.fastSwitching));
                  })),
                  a.length || (a = this.l),
                  (s = a),
                  e &&
                    a.length != this.l.length &&
                    (s = this.l.filter(function (x) {
                      return (
                        x && !!((x.audio && x.audio.fastSwitching) || (x.video && x.video.fastSwitching))
                      );
                    })),
                  (e = Pm(this, this.g.restrictions, s, 1 / 0, 1 / 0)),
                  t != 1 / 0 || r != 1 / 0)
                ) {
                  for (e = OP(e), e = I(e), a = e.next(); !a.done; a = e.next())
                    if (((a = a.value), a.height >= t && a.width >= r)) {
                      ((t = a.height), (r = a.width));
                      break;
                    }
                  e = Pm(this, this.g.restrictions, s, t, r);
                }
                for (
                  t = this.getBandwidthEstimate(),
                    s.length && !e.length && ((e = Pm(this, null, s, 1 / 0, 1 / 0)), (e = [e[0]])),
                    r = e[0] || null,
                    s = 0;
                  s < e.length;
                  s++
                ) {
                  a = e[s];
                  var f = isNaN(this.I) ? 1 : Math.abs(this.I);
                  c = (f * a.bandwidth) / this.g.bandwidthDowngradeTarget;
                  for (var g = { bandwidth: 1 / 0 }, m = s + 1; m < e.length; m++)
                    if (a.bandwidth != e[m].bandwidth) {
                      g = e[m];
                      break;
                    }
                  ((f = (f * g.bandwidth) / this.g.bandwidthUpgradeTarget),
                    r &&
                      a &&
                      t >= c &&
                      t <= f &&
                      (r.bandwidth != a.bandwidth ||
                        (r.bandwidth == a.bandwidth &&
                          r.video &&
                          a.video &&
                          (r.video.width < a.video.width || r.video.height < a.video.height))) &&
                      (r = a));
                }
                return ((this.B = Date.now()), r);
              }),
              (d.enable = function () {
                ((this.G = !0), this.l.length && this.trySuggestStreams());
              }),
              (d.disable = function () {
                this.G = !1;
              }),
              (d.segmentDownloaded = function (e, t, r, s) {
                var a = e;
                (this.g.removeLatencyFromFirstPacketTime &&
                  s &&
                  s.packetNumber === 1 &&
                  s.timeToFirstByte &&
                  (a = e - s.timeToFirstByte),
                  a >= this.g.cacheLoadThreshold && this.u.sample(a, t),
                  r && this.B != null && this.G && wE(this));
              }),
              (d.trySuggestStreams = function () {
                this.G && ((this.B = Date.now()), wE(this, !0));
              }),
              (d.getBandwidthEstimate = function () {
                var e = this.g.defaultBandwidthEstimate;
                return (
                  navigator.connection &&
                    navigator.connection.downlink &&
                    this.g.useNetworkInformation &&
                    (e = navigator.connection.downlink * 1e6),
                  navigator.connection &&
                  navigator.connection.downlink &&
                  this.g.useNetworkInformation &&
                  this.g.preferNetworkInformationBandwidth
                    ? e
                    : ((e = this.u.getBandwidthEstimate(e)), this.F ? this.F.getBandwidthEstimate(e) : e)
                );
              }),
              (d.setVariants = function (e) {
                return nr(e, this.l) ? !1 : ((this.l = e), !0);
              }),
              (d.playbackRateChanged = function (e) {
                this.I = e;
              }),
              (d.setMediaElement = function (e) {
                function t() {
                  r.m.ka(NP);
                }
                var r = this;
                ((this.o = e),
                  this.h && (this.h.disconnect(), (this.h = null)),
                  this.o &&
                    "ResizeObserver" in l &&
                    ((this.h = new ResizeObserver(t)), this.h.observe(this.o)),
                  this.j.D(e, "enterpictureinpicture", function (s) {
                    s.pictureInPictureWindow && ((r.i = s.pictureInPictureWindow), r.j.D(r.i, "resize", t));
                  }),
                  this.j.D(e, "leavepictureinpicture", function () {
                    (r.i && r.j.Ma(r.i, "resize", t), (r.i = null));
                  }));
              }),
              (d.setCmsdManager = function (e) {
                this.F = e;
              }),
              (d.configure = function (e) {
                ((this.g = e), this.u && this.g && this.u.configure(this.g.advanced));
              }));
            function wE(e, t) {
              if (t === void 0 || !t) {
                if (!e.J) {
                  if (((t = e.u), !(t.g >= t.i))) return;
                  ((e.J = !0), (e.B -= (e.g.switchInterval - e.g.minTimeToSwitch) * 1e3));
                }
                if (Date.now() - e.B < e.g.switchInterval * 1e3) return;
              }
              ((t = e.chooseVariant()),
                e.getBandwidthEstimate(),
                t && e.H(t, e.g.clearBufferSwitch, e.g.safeMarginSwitch));
            }
            function Pm(e, t, r, s, a) {
              if (e.F) {
                var c = e.F.ji();
                c &&
                  (r = r.filter(function (f) {
                    return f.bandwidth && c ? f.bandwidth <= c : !0;
                  }));
              }
              return (
                t &&
                  (r = r.filter(function (f) {
                    return ch(f, t, { width: a, height: s });
                  })),
                r.sort(function (f, g) {
                  return f.bandwidth - g.bandwidth;
                })
              );
            }
            function OP(e) {
              var t = [];
              e = I(e);
              for (var r = e.next(); !r.done; r = e.next())
                (r = r.value) &&
                  (r = r.video) &&
                  r.height &&
                  r.width &&
                  t.push({ height: r.height, width: r.width });
              return t.sort(function (s, a) {
                return s.width - a.width;
              });
            }
            (Ee("shaka.abr.SimpleAbrManager", qt),
              (qt.prototype.configure = qt.prototype.configure),
              (qt.prototype.setCmsdManager = qt.prototype.setCmsdManager),
              (qt.prototype.setMediaElement = qt.prototype.setMediaElement),
              (qt.prototype.playbackRateChanged = qt.prototype.playbackRateChanged),
              (qt.prototype.setVariants = qt.prototype.setVariants),
              (qt.prototype.getBandwidthEstimate = qt.prototype.getBandwidthEstimate),
              (qt.prototype.trySuggestStreams = qt.prototype.trySuggestStreams),
              (qt.prototype.segmentDownloaded = qt.prototype.segmentDownloaded),
              (qt.prototype.disable = qt.prototype.disable),
              (qt.prototype.enable = qt.prototype.enable),
              (qt.prototype.chooseVariant = qt.prototype.chooseVariant),
              (qt.prototype.init = qt.prototype.init),
              (qt.prototype.release = qt.prototype.release),
              (qt.prototype.stop = qt.prototype.stop));
            var NP = 1;
            function RE(e, t) {
              var r = wr();
              ((this.l = e.maxAttempts == null ? r.maxAttempts : e.maxAttempts),
                (this.j = e.baseDelay == null ? r.baseDelay : e.baseDelay),
                (this.o = e.fuzzFactor == null ? r.fuzzFactor : e.fuzzFactor),
                (this.m = e.backoffFactor == null ? r.backoffFactor : e.backoffFactor),
                (this.g = 0),
                (this.h = this.j),
                (this.i = t === void 0 ? !1 : t) && (this.g = 1));
            }
            function CE(e) {
              var t, r;
              return W(function (s) {
                if (s.g == 1) {
                  if (e.g >= e.l)
                    if (e.i) ((e.g = 1), (e.h = e.j));
                    else throw new ee(2, 7, 1010);
                  return (
                    (t = e.g),
                    e.g++,
                    t == 0
                      ? s.return()
                      : ((r = e.h * (1 + (Math.random() * 2 - 1) * e.o)),
                        _(
                          s,
                          new Promise(function (a) {
                            new it(a).ka(r / 1e3);
                          }),
                          2,
                        ))
                  );
                }
                ((e.h *= e.m), K(s));
              });
            }
            function wr() {
              return {
                maxAttempts: 2,
                baseDelay: 1e3,
                backoffFactor: 2,
                fuzzFactor: 0.5,
                timeout: 3e4,
                stallTimeout: 5e3,
                connectionTimeout: 1e4,
              };
            }
            function _t() {
              var e,
                t,
                r = new Promise(function (s, a) {
                  ((e = s), (t = a));
                });
              return ((r.resolve = e), (r.reject = t), r);
            }
            ((_t.prototype.resolve = function () {}), (_t.prototype.reject = function () {}));
            function sn(e, t) {
              ((this.promise = e), (this.i = t), (this.g = null));
            }
            function oo(e) {
              return new sn(Promise.reject(e), function () {
                return Promise.resolve();
              });
            }
            function Om() {
              var e = Promise.reject(new ee(2, 7, 7001));
              return (
                e.catch(function () {}),
                new sn(e, function () {
                  return Promise.resolve();
                })
              );
            }
            function Va(e) {
              return new sn(Promise.resolve(e), function () {
                return Promise.resolve();
              });
            }
            function LE(e) {
              return new sn(e, function () {
                return e.catch(function () {});
              });
            }
            sn.prototype.abort = function () {
              return (this.g || (this.g = this.i()), this.g);
            };
            function _E(e) {
              return new sn(
                Promise.all(
                  e.map(function (t) {
                    return t.promise;
                  }),
                ),
                function () {
                  return Promise.all(
                    e.map(function (t) {
                      return t.abort();
                    }),
                  );
                },
              );
            }
            ((sn.prototype.finally = function (e) {
              return (
                this.promise.then(
                  function () {
                    return e(!0);
                  },
                  function () {
                    return e(!1);
                  },
                ),
                this
              );
            }),
              (sn.prototype.Xa = function (e, t) {
                function r(g) {
                  return function (m) {
                    if (a.g && g) c.reject(f);
                    else {
                      var x = g ? e : t;
                      x ? (s = FP(x, m, c)) : (g ? c.resolve : c.reject)(m);
                    }
                  };
                }
                function s() {
                  return (c.reject(f), a.abort());
                }
                var a = this,
                  c = new _t();
                c.catch(function () {});
                var f = new ee(2, 7, 7001);
                return (
                  this.promise.then(r(!0), r(!1)),
                  new sn(c, function () {
                    return s();
                  })
                );
              }));
            function FP(e, t, r) {
              try {
                var s = e(t);
                return s && s.promise && s.abort
                  ? (r.resolve(s.promise),
                    function () {
                      return s.abort();
                    })
                  : (r.resolve(s),
                    function () {
                      return Promise.resolve(s).then(
                        function () {},
                        function () {},
                      );
                    });
              } catch (a) {
                return (
                  r.reject(a),
                  function () {
                    return Promise.resolve();
                  }
                );
              }
            }
            (S.Object.defineProperties(sn.prototype, {
              aborted: {
                configurable: !0,
                enumerable: !0,
                get: function () {
                  return this.g !== null;
                },
              },
            }),
              Ee("shaka.util.AbortableOperation", sn),
              (sn.prototype.chain = sn.prototype.Xa),
              (sn.prototype.finally = sn.prototype.finally),
              (sn.all = _E),
              (sn.prototype.abort = sn.prototype.abort),
              (sn.notAbortable = LE),
              (sn.completed = Va),
              (sn.aborted = Om),
              (sn.failed = oo));
            function Me(e, t) {
              if (t)
                if (t instanceof Map)
                  for (var r = I(t.keys()), s = r.next(); !s.done; s = r.next())
                    ((s = s.value),
                      Object.defineProperty(this, s, { value: t.get(s), writable: !0, enumerable: !0 }));
                else
                  for (r in t) Object.defineProperty(this, r, { value: t[r], writable: !0, enumerable: !0 });
              ((this.defaultPrevented = this.cancelable = this.bubbles = !1),
                (this.timeStamp = l.performance && l.performance.now ? l.performance.now() : Date.now()),
                (this.type = e),
                (this.isTrusted = !1),
                (this.target = this.currentTarget = null),
                (this.g = !1));
            }
            function bE(e) {
              var t = new Me(e.type),
                r;
              for (r in e) Object.defineProperty(t, r, { value: e[r], writable: !0, enumerable: !0 });
              return t;
            }
            ((Me.prototype.preventDefault = function () {
              this.cancelable && (this.defaultPrevented = !0);
            }),
              (Me.prototype.stopImmediatePropagation = function () {
                this.g = !0;
              }),
              (Me.prototype.stopPropagation = function () {}),
              Ee("shaka.util.FakeEvent", Me));
            var mh = {
              wl: "abrstatuschanged",
              xl: "adaptation",
              yl: "audiotrackchanged",
              zl: "audiotrackschanged",
              Al: "boundarycrossed",
              Bl: "buffering",
              Cl: "canupdatestarttime",
              Dl: "complete",
              El: "currentitemchanged",
              Fl: "downloadcompleted",
              Gl: "downloadfailed",
              Hl: "downloadheadersreceived",
              Il: "drmsessionupdate",
              Jl: "emsg",
              Pl: "itemsinserted",
              Ql: "itemsremoved",
              gm: "prft",
              Error: "error",
              Kl: "expirationupdated",
              Ll: "firstquartile",
              Ml: "gapjumped",
              Rl: "keystatuschanged",
              Ul: "loaded",
              Vl: "loading",
              Xl: "manifestparsed",
              Yl: "manifestupdated",
              Zl: "mediaqualitychanged",
              $l: "mediasourcerecovered",
              am: "metadataadded",
              Metadata: "metadata",
              bm: "midpoint",
              dm: "nospatialvideoinfo",
              fm: "onstatechange",
              hm: "ratechange",
              lm: "segmentappended",
              nm: "sessiondata",
              om: "spatialvideoinfo",
              pm: "stalldetected",
              qm: "started",
              rm: "statechanged",
              sm: "streaming",
              tm: "textchanged",
              um: "texttrackvisibility",
              vm: "thirdquartile",
              wm: "timelineregionadded",
              xm: "timelineregionenter",
              ym: "timelineregionexit",
              zm: "trackschanged",
              Bm: "unloading",
              Dm: "variantchanged",
            };
            function Lt() {
              ((this.ab = new La()), (this.Je = this));
            }
            ((Lt.prototype.addEventListener = function (e, t) {
              this.ab && this.ab.push(e, t);
            }),
              (Lt.prototype.removeEventListener = function (e, t) {
                this.ab && this.ab.remove(e, t);
              }),
              (Lt.prototype.dispatchEvent = function (e) {
                if (!this.ab) return !0;
                var t = this.ab.get(e.type) || [],
                  r = this.ab.get("All");
                for (r && (t = t.concat(r)), t = I(t), r = t.next(); !r.done; r = t.next()) {
                  ((r = r.value), (e.target = this.Je), (e.currentTarget = this.Je));
                  try {
                    r.handleEvent ? r.handleEvent(e) : r.call(this, e);
                  } catch (s) {}
                  if (e.g) break;
                }
                return e.defaultPrevented;
              }),
              (Lt.prototype.release = function () {
                this.ab = null;
              }));
            function Ha() {
              this.g = [];
            }
            function Jo(e, t) {
              e.g.push(
                t.finally(function () {
                  ki(e.g, t);
                }),
              );
            }
            Ha.prototype.destroy = function () {
              for (var e = [], t = I(this.g), r = t.next(); !r.done; r = t.next())
                ((r = r.value), r.promise.catch(function () {}), e.push(r.abort()));
              return ((this.g = []), Promise.all(e));
            };
            function Vt(e, t, r, s, a, c, f) {
              (Lt.call(this),
                (this.i = null),
                (this.j = !1),
                (this.u = new Ha()),
                (this.g = new Set()),
                (this.h = new Set()),
                (this.o = e || null),
                (this.m = t || null),
                (this.B = r || null),
                (this.C = s || null),
                (this.F = a || null),
                (this.H = c || null),
                (this.G = f || null),
                (this.l = new Map()));
            }
            (N(Vt, Lt),
              (d = Vt.prototype),
              (d.configure = function (e) {
                this.i = e;
              }));
            function As(e, t, r, s) {
              ((s = s === void 0 ? !1 : s), (r = r || OE));
              var a = vh.get(e);
              (!a || r >= a.priority) && vh.set(e, { priority: r, Bf: t, Ik: s });
            }
            function DE(e, t) {
              for (var r = I(e.g), s = r.next(); !s.done; s = r.next()) t.g.add(s.value);
              for (e = I(e.h), r = e.next(); !r.done; r = e.next()) t.h.add(r.value);
            }
            ((d.Lk = function (e) {
              this.g.add(e);
            }),
              (d.kl = function (e) {
                this.g.delete(e);
              }),
              (d.vj = function () {
                this.g.clear();
              }),
              (d.Mk = function (e) {
                this.h.add(e);
              }),
              (d.ll = function (e) {
                this.h.delete(e);
              }),
              (d.wj = function () {
                this.h.clear();
              }),
              (d.Wh = function () {
                this.l.clear();
              }));
            function fn(e, t, r) {
              return {
                uris: e,
                method: "GET",
                body: null,
                headers: {},
                allowCrossSiteCredentials: !1,
                retryParameters: t,
                licenseRequestType: null,
                sessionId: null,
                drmInfo: null,
                initData: null,
                initDataType: null,
                streamDataCallback: r === void 0 ? null : r,
              };
            }
            ((d.destroy = function () {
              return (
                (this.j = !0),
                this.g.clear(),
                this.h.clear(),
                this.l.clear(),
                Lt.prototype.release.call(this),
                this.u.destroy()
              );
            }),
              (d.request = function (e, t, r) {
                var s = this,
                  a = new PE();
                if (this.j) {
                  var c = Promise.reject(new ee(2, 7, 7001));
                  return (
                    c.catch(function () {}),
                    new yh(
                      c,
                      function () {
                        return Promise.resolve();
                      },
                      a,
                    )
                  );
                }
                ((t.method = t.method || "GET"),
                  (t.headers = t.headers || {}),
                  (t.retryParameters = t.retryParameters ? Ar(t.retryParameters) : wr()),
                  (t.uris = Ar(t.uris)),
                  (c = UP(this, e, t, r)));
                var f = c.Xa(function () {
                    return kE(s, e, t, r, new RE(t.retryParameters, !1), 0, null, a);
                  }),
                  g = f.Xa(function (R) {
                    return BP(s, e, R, r);
                  }),
                  m = Date.now(),
                  x = 0;
                c.promise.then(
                  function () {
                    x = Date.now() - m;
                  },
                  function () {},
                );
                var E = 0;
                f.promise.then(
                  function () {
                    E = Date.now();
                  },
                  function () {},
                );
                var A = g.Xa(
                  function (R) {
                    var b = Date.now() - E,
                      D = R.response;
                    return (
                      (D.timeMs += x),
                      (D.timeMs += b),
                      R.jk ||
                        !s.o ||
                        D.fromCache ||
                        t.method == "HEAD" ||
                        e != or ||
                        s.o(D.timeMs, D.data.byteLength, ME(r), t, r),
                      s.G && s.G(e, D, r),
                      D
                    );
                  },
                  function (R) {
                    throw (R && (R.severity = 2), R);
                  },
                );
                return (
                  (c = new yh(
                    A.promise,
                    function () {
                      return A.abort();
                    },
                    a,
                  )),
                  Jo(this.u, c),
                  c
                );
              }));
            function UP(e, t, r, s) {
              function a(g) {
                c = c.Xa(function () {
                  return (r.body && (r.body = ir(r.body)), g(t, r, s));
                });
              }
              var c = Va(void 0);
              (e.F && a(e.F), (e = I(e.g)));
              for (var f = e.next(); !f.done; f = e.next()) a(f.value);
              return c.Xa(void 0, function (g) {
                throw g instanceof ee && g.code == 7001 ? g : new ee(2, 1, 1006, g);
              });
            }
            function kE(e, t, r, s, a, c, f, g) {
              (e.i.forceHTTP && (r.uris[c] = r.uris[c].replace("https://", "http://")),
                e.i.forceHTTPS && (r.uris[c] = r.uris[c].replace("http://", "https://")),
                c > 0 && e.H && e.H(t, s, r.uris[c], r.uris[c - 1]));
              var m = new un(r.uris[c]),
                x = m.fc,
                E = !1;
              (x || ((x = location.protocol), (x = x.slice(0, -1)), Gd(m, x), (r.uris[c] = m.toString())),
                (x = x.toLowerCase()));
              var A = (x = vh.get(x)) ? x.Bf : null;
              if (!A) return oo(new ee(2, 1, 1e3, m));
              var R = x.Ik;
              (m = e.l.get(m.Db)) && (r.headers["common-access-token"] = m);
              var b = null,
                D = null,
                M = !1,
                P = !1,
                G;
              return LE(CE(a))
                .Xa(function () {
                  if (e.j) return Om();
                  G = Date.now();
                  var U = 0;
                  r.requestStartTime = Date.now();
                  var H = A(
                    r.uris[c],
                    r,
                    t,
                    function (z, J, X) {
                      (b && b.stop(),
                        D && D.ka(ne / 1e3),
                        e.o &&
                          t == or &&
                          (U++, (r.packetNumber = U), e.o(z, J, ME(s), r, s), (E = !0), (g.g = X)));
                    },
                    function (z) {
                      ((P = !0), (r.timeToFirstByte = Date.now() - r.requestStartTime), e.m && e.m(z, r, t));
                    },
                    { minBytesForProgressEvents: e.i.minBytesForProgressEvents },
                  );
                  if (!R) return H;
                  var Q = r.retryParameters.connectionTimeout;
                  Q &&
                    ((b = new it(function () {
                      ((M = !0), H.abort());
                    })),
                    b.ka(Q / 1e3));
                  var ne = r.retryParameters.stallTimeout;
                  return (
                    ne &&
                      (D = new it(function () {
                        ((M = !0), H.abort());
                      })),
                    H
                  );
                })
                .Xa(
                  function (U) {
                    (b && b.stop(), D && D.stop(), U.timeMs == null && (U.timeMs = Date.now() - G));
                    var H = U.headers["common-access-token"];
                    if (H) {
                      var Q = new un(U.uri);
                      e.l.set(Q.Db, H);
                    }
                    return (
                      (H = { response: U, jk: E }),
                      !P && e.m && e.m(U.headers, r, t),
                      e.B && e.B(r, U),
                      H
                    );
                  },
                  function (U) {
                    if ((b && b.stop(), D && D.stop(), e.C)) {
                      var H = null,
                        Q = 0;
                      (U instanceof ee && ((H = U), U.code == 1001 && (Q = U.data[1])), e.C(r, H, Q, M));
                    }
                    if (e.j) return Om();
                    if ((M && (U = new ee(1, 1, 1003, r.uris[c], t)), U instanceof ee)) {
                      if (U.code == 7001) throw U;
                      if (U.code == 1010) throw f;
                      if (U.severity == 1) {
                        if (
                          ((H = new Map().set("error", U)),
                          (H = new Me("retry", H)),
                          (H.cancelable = !0),
                          e.dispatchEvent(H),
                          H.defaultPrevented)
                        )
                          throw U;
                        return ((c = (c + 1) % r.uris.length), kE(e, t, r, s, a, c, U, g));
                      }
                    }
                    throw U;
                  },
                );
            }
            function BP(e, t, r, s) {
              var a = Va(void 0);
              e = I(e.h);
              for (var c = e.next(), f = {}; !c.done; f = { Pi: void 0 }, c = e.next())
                ((f.Pi = c.value),
                  (a = a.Xa(
                    (function (g) {
                      return function () {
                        var m = r.response;
                        return (m.data && (m.data = ir(m.data)), (0, g.Pi)(t, m, s));
                      };
                    })(f),
                  )));
              return a.Xa(
                function () {
                  return r;
                },
                function (g) {
                  var m = 2;
                  if (g instanceof ee) {
                    if (g.code == 7001) throw g;
                    m = g.severity;
                  }
                  throw new ee(m, 1, 1007, g);
                },
              );
            }
            function ME(e) {
              if (e) {
                var t = e.segment;
                if (((e = e.stream), t && e && e.fastSwitching && t.Xc)) return !1;
              }
              return !0;
            }
            (Ee("shaka.net.NetworkingEngine", Vt),
              (Vt.prototype.request = Vt.prototype.request),
              (Vt.prototype.destroy = Vt.prototype.destroy),
              (Vt.makeRequest = fn),
              (Vt.defaultRetryParameters = function () {
                return wr();
              }),
              (Vt.prototype.clearCommonAccessTokenMap = Vt.prototype.Wh),
              (Vt.prototype.clearAllResponseFilters = Vt.prototype.wj),
              (Vt.prototype.unregisterResponseFilter = Vt.prototype.ll),
              (Vt.prototype.registerResponseFilter = Vt.prototype.Mk),
              (Vt.prototype.clearAllRequestFilters = Vt.prototype.vj),
              (Vt.prototype.unregisterRequestFilter = Vt.prototype.kl),
              (Vt.prototype.registerRequestFilter = Vt.prototype.Lk),
              (Vt.unregisterScheme = function (e) {
                vh.delete(e);
              }),
              (Vt.registerScheme = As),
              (Vt.prototype.configure = Vt.prototype.configure));
            function PE() {
              this.g = 0;
            }
            Vt.NumBytesRemainingClass = PE;
            function yh(e, t, r) {
              (sn.call(this, e, t), (this.h = r));
            }
            (N(yh, sn), (Vt.PendingRequest = yh));
            var or = 1;
            ((Vt.RequestType = {
              MANIFEST: 0,
              SEGMENT: or,
              LICENSE: 2,
              APP: 3,
              TIMING: 4,
              SERVER_CERTIFICATE: 5,
              KEY: 6,
              ADS: 7,
              CONTENT_STEERING: 8,
              CMCD: 9,
            }),
              (Vt.AdvancedRequestType = {
                INIT_SEGMENT: 0,
                MEDIA_SEGMENT: 1,
                MEDIA_PLAYLIST: 2,
                MASTER_PLAYLIST: 3,
                MPD: 4,
                MSS: 5,
                MPD_PATCH: 6,
                MEDIATAILOR_SESSION_INFO: 7,
                MEDIATAILOR_TRACKING_INFO: 8,
                MEDIATAILOR_STATIC_RESOURCE: 9,
                MEDIATAILOR_TRACKING_EVENT: 10,
                INTERSTITIAL_ASSET_LIST: 11,
                INTERSTITIAL_AD_URL: 12,
              }));
            var OE = 3;
            Vt.PluginPriority = { FALLBACK: 1, PREFERRED: 2, APPLICATION: OE };
            var vh = new Map();
            function Ka(e) {
              ((this.g = !1), (this.h = new _t()), (this.i = e));
            }
            Ka.prototype.destroy = function () {
              var e = this;
              return this.g
                ? this.h
                : ((this.g = !0),
                  this.i().then(
                    function () {
                      e.h.resolve();
                    },
                    function () {
                      e.h.resolve();
                    },
                  ));
            };
            function Nt(e, t) {
              if (e.g) throw t instanceof ee && t.code == 7003 ? t : new ee(2, 7, 7003, t);
            }
            function Nm(e, t) {
              var r = [];
              e = I(e);
              for (var s = e.next(); !s.done; s = e.next()) r.push(t(s.value));
              return r;
            }
            function $P(e, t) {
              e = I(e);
              for (var r = e.next(); !r.done; r = e.next()) if (!t(r.value)) return !1;
              return !0;
            }
            function Wa(e) {
              for (var t = new Map(), r = I(Object.keys(e)), s = r.next(); !s.done; s = r.next())
                ((s = s.value), t.set(s, e[s]));
              return t;
            }
            function Fm(e) {
              var t = {};
              return (
                e.forEach(function (r, s) {
                  t[s] = r;
                }),
                t
              );
            }
            function Gt(e, t) {
              ((this.h = Ti(e)), (this.i = t == NE), (this.g = 0));
            }
            ((d = Gt.prototype),
              (d.Ia = function () {
                return this.g < this.h.byteLength;
              }),
              (d.Pa = function () {
                return this.g;
              }),
              (d.getLength = function () {
                return this.h.byteLength;
              }),
              (d.Y = function () {
                try {
                  var e = this.h.getUint8(this.g);
                  return ((this.g += 1), e);
                } catch (t) {
                  throw Is();
                }
              }),
              (d.Ca = function () {
                try {
                  var e = this.h.getUint16(this.g, this.i);
                  return ((this.g += 2), e);
                } catch (t) {
                  throw Is();
                }
              }),
              (d.U = function () {
                try {
                  var e = this.h.getUint32(this.g, this.i);
                  return ((this.g += 4), e);
                } catch (t) {
                  throw Is();
                }
              }),
              (d.dh = function () {
                try {
                  var e = this.h.getInt32(this.g, this.i);
                  return ((this.g += 4), e);
                } catch (t) {
                  throw Is();
                }
              }),
              (d.Ed = function () {
                try {
                  if (this.i)
                    var e = this.h.getUint32(this.g, !0),
                      t = this.h.getUint32(this.g + 4, !0);
                  else ((t = this.h.getUint32(this.g, !1)), (e = this.h.getUint32(this.g + 4, !1)));
                } catch (r) {
                  throw Is();
                }
                if (t > 2097151) throw new ee(2, 3, 3001);
                return ((this.g += 8), t * 4294967296 + e);
              }),
              (d.Tb = function (e, t) {
                if (this.g + e > this.h.byteLength) throw Is();
                var r = We(this.h, this.g, e);
                return ((this.g += e), t ? new Uint8Array(r) : r);
              }),
              (d.skip = function (e) {
                if (this.g + e > this.h.byteLength) throw Is();
                this.g += e;
              }),
              (d.Qi = function (e) {
                if (this.g < e) throw Is();
                this.g -= e;
              }),
              (d.seek = function (e) {
                if (e < 0 || e > this.h.byteLength) throw Is();
                this.g = e;
              }),
              (d.Yc = function () {
                for (var e = this.g; this.Ia() && this.h.getUint8(this.g) != 0; ) this.g += 1;
                return ((e = We(this.h, e, this.g - e)), (this.g += 1), zt(e));
              }));
            function Is() {
              return new ee(2, 3, 3e3);
            }
            (Ee("shaka.util.DataViewReader", Gt),
              (Gt.prototype.readTerminatedString = Gt.prototype.Yc),
              (Gt.prototype.seek = Gt.prototype.seek),
              (Gt.prototype.rewind = Gt.prototype.Qi),
              (Gt.prototype.skip = Gt.prototype.skip),
              (Gt.prototype.readBytes = Gt.prototype.Tb),
              (Gt.prototype.readUint64 = Gt.prototype.Ed),
              (Gt.prototype.readInt32 = Gt.prototype.dh),
              (Gt.prototype.readUint32 = Gt.prototype.U),
              (Gt.prototype.readUint16 = Gt.prototype.Ca),
              (Gt.prototype.readUint8 = Gt.prototype.Y),
              (Gt.prototype.getLength = Gt.prototype.getLength),
              (Gt.prototype.getPosition = Gt.prototype.Pa),
              (Gt.prototype.hasMoreData = Gt.prototype.Ia));
            var NE = 1;
            Gt.Endianness = { BIG_ENDIAN: 0, LITTLE_ENDIAN: NE };
            function bt() {
              ((this.i = new Map()), (this.h = new Map()), (this.g = !1));
            }
            ((d = bt.prototype),
              (d.box = function (e, t) {
                return ((e = FE(e)), this.i.set(e, GP), this.h.set(e, t), this);
              }),
              (d.S = function (e, t) {
                return ((e = FE(e)), this.i.set(e, UE), this.h.set(e, t), this);
              }),
              (d.stop = function () {
                this.g = !0;
              }),
              (d.parse = function (e, t, r) {
                for (e = new Gt(e, 0), this.g = !1; e.Ia() && !this.g; ) this.Bd(0, e, t, r);
              }),
              (d.Bd = function (e, t, r, s) {
                var a = t.Pa();
                if (s && a + 8 > t.getLength()) this.g = !0;
                else {
                  var c = t.U(),
                    f = t.U(),
                    g = Th(f),
                    m = !1;
                  switch (c) {
                    case 0:
                      c = t.getLength() - a;
                      break;
                    case 1:
                      if (s && t.Pa() + 8 > t.getLength()) {
                        this.g = !0;
                        return;
                      }
                      ((c = t.Ed()), (m = !0));
                  }
                  var x = this.h.get(f);
                  if (x) {
                    var E = null,
                      A = null;
                    if (this.i.get(f) == UE) {
                      if (s && t.Pa() + 4 > t.getLength()) {
                        this.g = !0;
                        return;
                      }
                      ((A = t.U()), (E = A >>> 24), (A &= 16777215));
                    }
                    ((f = a + c),
                      r && f > t.getLength() && (f = t.getLength()),
                      s && f > t.getLength()
                        ? (this.g = !0)
                        : ((f -= t.Pa()),
                          (t = f > 0 ? t.Tb(f, !1) : new Uint8Array(0)),
                          (t = new Gt(t, 0)),
                          x({
                            name: g,
                            parser: this,
                            partialOkay: r || !1,
                            stopOnPartial: s || !1,
                            version: E,
                            flags: A,
                            reader: t,
                            size: c,
                            start: a + e,
                            has64BitSize: m,
                          })));
                  } else t.skip(Math.min(a + c - t.Pa(), t.getLength() - t.Pa()));
                }
              }));
            function Ze(e) {
              for (var t = ao(e); e.reader.Ia() && !e.parser.g; )
                e.parser.Bd(e.start + t, e.reader, e.partialOkay, e.stopOnPartial);
            }
            function ws(e) {
              for (
                var t = ao(e), r = e.reader.U(), s = 0;
                s < r && (e.parser.Bd(e.start + t, e.reader, e.partialOkay, e.stopOnPartial), !e.parser.g);
                s++
              );
            }
            function Oi(e) {
              var t = ao(e);
              for (e.reader.skip(78); e.reader.Ia() && !e.parser.g; )
                e.parser.Bd(e.start + t, e.reader, e.partialOkay, e.stopOnPartial);
            }
            function xh(e) {
              var t = ao(e);
              e.reader.skip(8);
              var r = e.reader.Ca();
              for (
                e.reader.skip(6), r == 2 ? e.reader.skip(48) : e.reader.skip(12), r == 1 && e.reader.skip(16);
                e.reader.Ia() && !e.parser.g;
              )
                e.parser.Bd(e.start + t, e.reader, e.partialOkay, e.stopOnPartial);
            }
            function za(e, t) {
              return function (r) {
                e(r.reader.Tb(r.reader.getLength() - r.reader.Pa(), t));
              };
            }
            function FE(e) {
              var t = 0;
              e = I(e);
              for (var r = e.next(); !r.done; r = e.next()) t = (t << 8) | r.value.charCodeAt(0);
              return t;
            }
            function Th(e) {
              return String.fromCharCode((e >> 24) & 255, (e >> 16) & 255, (e >> 8) & 255, e & 255);
            }
            function ao(e) {
              return 8 + (e.has64BitSize ? 8 : 0) + (e.flags != null ? 4 : 0);
            }
            (Ee("shaka.util.Mp4Parser", bt),
              (bt.headerSize = ao),
              (bt.typeToString = Th),
              (bt.allData = za),
              (bt.audioSampleEntry = xh),
              (bt.visualSampleEntry = Oi),
              (bt.sampleDescription = ws),
              (bt.children = Ze),
              (bt.prototype.parseNext = bt.prototype.Bd),
              (bt.prototype.parse = bt.prototype.parse),
              (bt.prototype.stop = bt.prototype.stop),
              (bt.prototype.fullBox = bt.prototype.S),
              (bt.prototype.box = bt.prototype.box));
            var GP = 0,
              UE = 1;
            function Um(e) {
              var t = this;
              ((this.g = []),
                (this.h = []),
                (this.data = []),
                new bt()
                  .box("moov", Ze)
                  .box("moof", Ze)
                  .S("pssh", function (r) {
                    if (!(r.version > 1)) {
                      var s = We(r.reader.h, -12, r.size);
                      if ((t.data.push(s), (s = r.reader.Tb(16, !1)), t.g.push(gs(s)), r.version > 0)) {
                        s = r.reader.U();
                        for (var a = 0; a < s; a++) {
                          var c = r.reader.Tb(16, !1);
                          ((c = gs(c)), t.h.push(c));
                        }
                      }
                    }
                  })
                  .parse(e));
            }
            function Sh(e, t, r, s) {
              var a = e.length,
                c = 12 + t.length + 4 + a;
              s > 0 && (c += 4 + 16 * r.size);
              var f = new Uint8Array(c),
                g = Ti(f),
                m = 0;
              if (
                (g.setUint32(m, c),
                (m += 4),
                g.setUint32(m, 1886614376),
                (m += 4),
                s < 1 ? g.setUint32(m, 0) : g.setUint32(m, 16777216),
                (m += 4),
                f.set(t, m),
                (m += t.length),
                s > 0)
              )
                for (g.setUint32(m, r.size), m += 4, t = I(r), r = t.next(); !r.done; r = t.next())
                  ((r = Go(r.value)), f.set(r, m), (m += r.length));
              return (g.setUint32(m, a), f.set(e, m + 4), f);
            }
            function Eh(e) {
              var t = this;
              ((this.F = e),
                (this.l = this.B = null),
                (this.$ = this.T = !1),
                (this.J = 0),
                (this.g = null),
                (this.o = new gt()),
                (this.i = new Map()),
                (this.X = []),
                (this.C = new Map()),
                (this.K = !1),
                (this.m = new _t()),
                (this.h = null),
                (this.u = function (r) {
                  (r.severity == 2 && t.m.reject(r), e.onError(r));
                }),
                (this.ba = new Map()),
                (this.ma = new Map()),
                (this.M = new it(function () {
                  return JP(t);
                })),
                (this.R = !1),
                (this.N = []),
                (this.oa = !1),
                (this.G = new it(function () {
                  e2(t);
                })),
                this.m.catch(function () {}),
                (this.j = new Ka(function () {
                  return jP(t);
                })),
                (this.O = !1),
                (this.H = this.I = null),
                (this.V = function () {
                  return !1;
                }));
            }
            ((d = Eh.prototype),
              (d.destroy = function () {
                return this.j.destroy();
              }));
            function jP(e) {
              return W(function (t) {
                switch (t.g) {
                  case 1:
                    return (
                      e.o.release(),
                      (e.o = null),
                      e.m.reject(),
                      e.G.stop(),
                      (e.G = null),
                      e.M.stop(),
                      (e.M = null),
                      _(t, $u(e), 2)
                    );
                  case 2:
                    if (!e.l) {
                      t.A(3);
                      break;
                    }
                    return (q(t, 4), _(t, e.l.setMediaKeys(null), 6));
                  case 6:
                    he(t, 5);
                    break;
                  case 4:
                    ae(t);
                  case 5:
                    e.l = null;
                  case 3:
                    ((e.g = null),
                      (e.B = null),
                      (e.C = new Map()),
                      (e.h = null),
                      (e.u = function () {}),
                      (e.F = null),
                      (e.O = !1),
                      (e.I = null),
                      K(t));
                }
              });
            }
            d.configure = function (e, t) {
              ((this.h = e),
                t && (this.V = t),
                this.G && this.T && this.g && this.G.Ea(this.h.updateExpirationTime));
            };
            function VP(e, t, r) {
              return ((e.$ = !0), (e.C = new Map()), (e.R = r), $E(e, t, !1));
            }
            function BE(e, t, r, s) {
              ((s = s === void 0 ? !0 : s), (e.C = new Map()), (r = I(r)));
              for (var a = r.next(); !a.done; a = r.next())
                e.C.set(a.value, { initData: null, initDataType: null });
              for (r = I(e.h.persistentSessionsMetadata), a = r.next(); !a.done; a = r.next())
                ((a = a.value), e.C.set(a.sessionId, { initData: a.initData, initDataType: a.initDataType }));
              return ((e.R = e.C.size > 0), $E(e, t, s));
            }
            function HP(e, t, r, s, a, c) {
              var f, g, m, x, E;
              return W(function (A) {
                return A.g == 1
                  ? ((f = []),
                    c.length && f.push(c[0].contentType),
                    a.length && f.push(a[0].contentType),
                    (g = function (R) {
                      return (
                        (R = ms(t, R, null)),
                        (R.licenseServerUri = r),
                        (R.serverCertificate = s),
                        (R.persistentStateRequired = !0),
                        (R.sessionType = "persistent-license"),
                        R
                      );
                    }),
                    (m = IE(f)),
                    m.video && ((x = g(c[0].encryptionScheme || "")), m.video.drmInfos.push(x)),
                    m.audio && ((E = g(a[0].encryptionScheme || "")), m.audio.drmInfos.push(E)),
                    _(A, km([m], !0, e.O, []), 2))
                  : (Nt(e.j), A.return(HE(e, [m])));
              });
            }
            function $E(e, t, r) {
              var s, a, c, f, g, m, x, E, A, R, b, D, M, P, G, U, H, Q;
              return W(function (ne) {
                if (ne.g == 1) {
                  for (
                    qE(e.h.clearKeys, t),
                      s = t.some(function (z) {
                        return !!(
                          (z.video && z.video.drmInfos.length) ||
                          (z.audio && z.audio.drmInfos.length)
                        );
                      }),
                      a = Wa(e.h.servers),
                      c = Wa(e.h.advanced || {}),
                      !s && r && n2(t, a),
                      f = new WeakSet(),
                      g = I(t),
                      m = g.next();
                    !m.done;
                    m = g.next()
                  )
                    for (x = m.value, E = XE(x), A = I(E), R = A.next(); !R.done; R = A.next())
                      ((b = R.value), f.has(b) || (f.add(b), r2(b, a, c, e.h.keySystemsMapping)));
                  for (
                    D = function (z, J) {
                      var X = [];
                      z = I(z);
                      for (var ie = z.next(); !ie.done; ie = z.next()) {
                        ie = ie.value;
                        var Z = ie[J] || (c.has(ie.keySystem) && c.get(ie.keySystem)[J]) || "",
                          re;
                        if (
                          ((re = Z == "") &&
                            (re = (re = ie.keySystem) ? !!re.match(/^com\.widevine\.alpha/) : !1),
                          re &&
                            (J == "audioRobustness"
                              ? (Z = [e.h.defaultAudioRobustnessForWidevine])
                              : J == "videoRobustness" && (Z = [e.h.defaultVideoRobustnessForWidevine])),
                          typeof Z == "string")
                        )
                          X.push(ie);
                        else if (Array.isArray(Z))
                          for (
                            Z.length === 0 && (Z = [""]), Z = I(Z), re = Z.next();
                            !re.done;
                            re = Z.next()
                          ) {
                            var se = {};
                            X.push(Object.assign({}, ie, ((se[J] = re.value), se)));
                          }
                      }
                      return X;
                    },
                      M = new WeakSet(),
                      P = I(t),
                      G = P.next();
                    !G.done;
                    G = P.next()
                  )
                    ((U = G.value),
                      U.video &&
                        !M.has(U.video) &&
                        ((U.video.drmInfos = D(U.video.drmInfos, "videoRobustness")),
                        (U.video.drmInfos = D(U.video.drmInfos, "audioRobustness")),
                        M.add(U.video)),
                      U.audio &&
                        !M.has(U.audio) &&
                        ((U.audio.drmInfos = D(U.audio.drmInfos, "videoRobustness")),
                        (U.audio.drmInfos = D(U.audio.drmInfos, "audioRobustness")),
                        M.add(U.audio)));
                  return _(ne, km(t, e.R, e.O, e.h.preferredKeySystems), 2);
                }
                return (
                  Nt(e.j),
                  (H = s || a.size > 0),
                  H
                    ? ((Q = HE(e, t)), ne.return(s ? Q : Q.catch(function () {})))
                    : ((e.T = !0), ne.return(Promise.resolve()))
                );
              });
            }
            function GE(e) {
              var t;
              return W(function (r) {
                switch (r.g) {
                  case 1:
                    if (e.l.mediaKeys) return r.return();
                    if (!e.I) {
                      r.A(2);
                      break;
                    }
                    return _(r, e.I, 3);
                  case 3:
                    return (Nt(e.j), r.return());
                  case 2:
                    return (q(r, 4), (e.I = e.l.setMediaKeys(e.B)), _(r, e.I, 6));
                  case 6:
                    he(r, 5);
                    break;
                  case 4:
                    ((t = ae(r)), e.u(new ee(2, 6, 6003, t.message)));
                  case 5:
                    (Nt(e.j), K(r));
                }
              });
            }
            function KP(e, t) {
              return W(function (r) {
                if (r.g == 1) return _(r, GE(e), 2);
                (Bu(e, t.initDataType, We(t.initData)), K(r));
              });
            }
            d.Vb = function (e) {
              var t = this,
                r,
                s;
              return W(function (a) {
                if (a.g == 1)
                  return t.l === e
                    ? a.return()
                    : t.B
                      ? ((t.l = e),
                        t.h.delayLicenseRequestUntilPlayed &&
                          t.o.Aa(t.l, "play", function () {
                            for (var c = I(t.N), f = c.next(); !f.done; f = c.next()) Gm(t, f.value);
                            ((t.oa = !0), (t.N = []));
                          }),
                        t.l.remote
                          ? (t.o.D(t.l.remote, "connect", function () {
                              return $u(t);
                            }),
                            t.o.D(t.l.remote, "connecting", function () {
                              return $u(t);
                            }),
                            t.o.D(t.l.remote, "disconnect", function () {
                              return $u(t);
                            }))
                          : "webkitCurrentPlaybackTargetIsWireless" in t.l &&
                            t.o.D(t.l, "webkitcurrentplaybacktargetiswirelesschanged", function () {
                              return $u(t);
                            }),
                        (t.H =
                          (t.g &&
                            t.g.initData.find(function (c) {
                              return c.initData.length > 0;
                            })) ||
                          null),
                        (r = t.g.keySystem),
                        (s = tt().Vg(r)) || (!t.H && t.g.keySystem === "com.apple.fps" && !t.C.size)
                          ? a.A(2)
                          : _(a, GE(t), 2))
                      : (t.o.Aa(e, "encrypted", function () {
                          t.u(new ee(2, 6, 6010));
                        }),
                        a.return());
                (jE(t).catch(function () {}),
                  (!s && (t.H || t.C.size || t.h.parseInbandPsshEnabled)) ||
                    t.o.D(t.l, "encrypted", function (c) {
                      return KP(t, c);
                    }),
                  K(a));
              });
            };
            function WP(e) {
              var t, r, s, a, c;
              return W(function (f) {
                switch (f.g) {
                  case 1:
                    if (!e.B || !e.g) return f.return();
                    if (
                      !e.g.serverCertificateUri ||
                      (e.g.serverCertificate && e.g.serverCertificate.length)
                    ) {
                      f.A(2);
                      break;
                    }
                    return (
                      (t = fn([e.g.serverCertificateUri], e.h.retryParameters)),
                      q(f, 3),
                      (r = e.F.vc.request(5, t, { isPreload: e.V() })),
                      _(f, r.promise, 5)
                    );
                  case 5:
                    ((s = f.h), (e.g.serverCertificate = We(s.data)), he(f, 4));
                    break;
                  case 3:
                    throw ((a = ae(f)), new ee(2, 6, 6017, a));
                  case 4:
                    if (e.j.g) return f.return();
                  case 2:
                    return !e.g.serverCertificate || !e.g.serverCertificate.length
                      ? f.return()
                      : (q(f, 6), _(f, e.B.setServerCertificate(e.g.serverCertificate), 8));
                  case 8:
                    he(f, 0);
                    break;
                  case 6:
                    throw ((c = ae(f)), new ee(2, 6, 6004, c.message));
                }
              });
            }
            function zP(e, t) {
              var r, s, a;
              return W(function (c) {
                if (c.g == 1) return _(c, WE(e, t, { initData: null, initDataType: null }), 2);
                if (c.g != 3)
                  return (
                    (r = c.h),
                    r
                      ? ((s = []),
                        (a = e.i.get(r)) && ((a.Kb = new _t()), s.push(a.Kb)),
                        s.push(r.remove()),
                        _(c, Promise.all(s), 3))
                      : c.return()
                  );
                (e.i.delete(r), K(c));
              });
            }
            function jE(e) {
              var t, r, s, a, c;
              return W(function (f) {
                if (f.g == 1)
                  return e.C.size
                    ? (e.C.forEach(function (g, m) {
                        WE(e, m, g);
                      }),
                      _(f, e.m, 3))
                    : f.A(2);
                if (f.g != 2) {
                  if (((t = (e.g && e.g.keyIds) || new Set([])), t.size > 0 && t2(e))) return f.return(e.m);
                  ((e.K = !1), (e.m = new _t()), e.m.catch(function () {}));
                }
                for (r = (e.g ? e.g.initData : []) || [], s = I(r), a = s.next(); !a.done; a = s.next())
                  ((c = a.value), Bu(e, c.initDataType, c.initData));
                return (Gu(e) && e.m.resolve(), f.return(e.m));
              });
            }
            function Bu(e, t, r) {
              if (r.length) {
                try {
                  r = e.h.initDataTransform(r, t, e.g);
                } catch (f) {
                  ((t = f), f instanceof ee || (t = new ee(2, 6, 6016, f)), e.u(t));
                  return;
                }
                if (e.h.ignoreDuplicateInitData) {
                  var s = e.i.values();
                  s = I(s);
                  for (var a = s.next(); !a.done; a = s.next()) if (fs(r, a.value.initData)) return;
                  var c = !1;
                  if (
                    (e.C.forEach(function (f) {
                      !c && fs(r, f.initData) && (c = !0);
                    }),
                    c)
                  )
                    return;
                }
                ((e.K = !0),
                  e.i.size > 0 &&
                    Gu(e) &&
                    (e.m.resolve(), (e.K = !1), (e.m = new _t()), e.m.catch(function () {})),
                  qP(e, t, r, e.g.sessionType));
              }
            }
            function VE(e) {
              return (
                (e = e.i.keys()),
                (e = Nm(e, function (t) {
                  return t.sessionId;
                })),
                Array.from(e)
              );
            }
            ((d.Kg = function () {
              var e = this,
                t = this.i.keys();
              return (
                (t = Nm(t, function (r) {
                  var s = e.i.get(r);
                  return {
                    sessionId: r.sessionId,
                    sessionType: s.type,
                    initData: s.initData,
                    initDataType: s.initDataType,
                  };
                })),
                Array.from(t)
              );
            }),
              (d.Zd = function () {
                var e = 1 / 0,
                  t = this.i.keys();
                t = I(t);
                for (var r = t.next(); !r.done; r = t.next())
                  ((r = r.value), isNaN(r.expiration) || (e = Math.min(e, r.expiration)));
                return e;
              }));
            function YP(e) {
              return e.J ? e.J : NaN;
            }
            d.$e = function () {
              return Fm(this.ma);
            };
            function HE(e, t) {
              var r, s, a, c, f, g, m;
              return W(function (x) {
                switch (x.g) {
                  case 1:
                    if (((r = new Map()), (s = XP(e, t, r)), !s))
                      throw navigator.requestMediaKeySystemAccess ? new ee(2, 6, 6001) : new ee(2, 6, 6020);
                    (Nt(e.j), q(x, 2), s.getConfiguration());
                    var E = (a = e.h.keySystemsMapping[s.keySystem] || s.keySystem),
                      A = r.get(a),
                      R = [],
                      b = [],
                      D = [],
                      M = [],
                      P = [],
                      G = new Set(),
                      U = new Set();
                    i2(A, R, b, M, D, P, G, U);
                    var H = e.R ? "persistent-license" : "temporary";
                    for (
                      E = {
                        keySystem: E,
                        encryptionScheme: R[0],
                        licenseServerUri: b[0],
                        distinctiveIdentifierRequired: A[0].distinctiveIdentifierRequired,
                        persistentStateRequired: A[0].persistentStateRequired,
                        sessionType: A[0].sessionType || H,
                        audioRobustness: A[0].audioRobustness || "",
                        videoRobustness: A[0].videoRobustness || "",
                        serverCertificate: M[0],
                        serverCertificateUri: D[0],
                        initData: P,
                        keyIds: G,
                        mediaTypes: A[0].mediaTypes,
                      },
                        U.size > 0 && (E.keySystemUris = U),
                        A = I(A),
                        U = A.next();
                      !U.done;
                      U = A.next()
                    )
                      ((U = U.value),
                        U.distinctiveIdentifierRequired &&
                          (E.distinctiveIdentifierRequired = U.distinctiveIdentifierRequired),
                        U.persistentStateRequired && (E.persistentStateRequired = U.persistentStateRequired));
                    if (((e.g = E), !e.g.licenseServerUri)) throw new ee(2, 6, 6012, e.g.keySystem);
                    return _(x, s.createMediaKeys(), 4);
                  case 4:
                    if (
                      ((c = x.h),
                      Nt(e.j),
                      (e.B = c),
                      !(e.h.minHdcpVersion != "" && "getStatusForPolicy" in e.B))
                    ) {
                      x.A(5);
                      break;
                    }
                    return (q(x, 6), _(x, e.B.getStatusForPolicy({ minHdcpVersion: e.h.minHdcpVersion }), 8));
                  case 8:
                    if (((f = x.h), f != "usable")) throw new ee(2, 6, 6018);
                    (Nt(e.j), he(x, 5, 2));
                    break;
                  case 6:
                    throw ((g = ae(x, 2)), g instanceof ee ? g : new ee(2, 6, 6019, g.message));
                  case 5:
                    return ((e.T = !0), e.G.Ea(e.h.updateExpirationTime), _(x, WP(e), 9));
                  case 9:
                    (Nt(e.j), he(x, 0));
                    break;
                  case 2:
                    throw (
                      (m = ae(x)),
                      Nt(e.j, m),
                      (e.g = null),
                      m instanceof ee ? m : new ee(2, 6, 6002, m.message)
                    );
                }
              });
            }
            function XP(e, t, r) {
              for (var s = I(t), a = s.next(); !a.done; a = s.next()) {
                a = I(XE(a.value));
                for (var c = a.next(); !c.done; c = a.next())
                  ((c = c.value), r.has(c.keySystem) || r.set(c.keySystem, []), r.get(c.keySystem).push(c));
              }
              if (r.size == 1 && r.has("")) throw new ee(2, 6, 6e3);
              ((s = e.h.preferredKeySystems),
                s.length || ((a = Wa(e.h.servers)), a.size == 1 && (s = Array.from(a.keys()))),
                (a = I(s)));
              var f = a.next();
              for (c = {}; !f.done; c = { Ki: void 0 }, f = a.next()) {
                ((c.Ki = f.value), (f = I(t)));
                for (var g = f.next(); !g.done; g = f.next())
                  if (
                    (g = g.value.decodingInfos.find(
                      (function (A) {
                        return function (R) {
                          return (
                            R.supported && R.keySystemAccess != null && R.keySystemAccess.keySystem == A.Ki
                          );
                        };
                      })(c),
                    ))
                  )
                    return g.keySystemAccess;
              }
              for (a = I([!0, !1]), c = a.next(); !c.done; c = a.next())
                for (c = c.value, f = I(t), g = f.next(); !g.done; g = f.next()) {
                  g = I(g.value.decodingInfos);
                  for (var m = g.next(); !m.done; m = g.next())
                    if (((m = m.value), m.supported && m.keySystemAccess)) {
                      var x = m.keySystemAccess.keySystem;
                      if (!s.includes(x)) {
                        var E = r.get(x);
                        for (
                          !E && e.h.keySystemsMapping[x] && (E = r.get(e.h.keySystemsMapping[x])),
                            x = I(E),
                            E = x.next();
                          !E.done;
                          E = x.next()
                        )
                          if (!!E.value.licenseServerUri == c) return m.keySystemAccess;
                      }
                    }
                }
              return null;
            }
            function Bm(e) {
              Gu(e) && e.m.resolve();
            }
            function KE(e, t) {
              new it(function () {
                ((t.loaded = !0), Bm(e));
              }).ka(o2);
            }
            function WE(e, t, r) {
              var s, a, c, f, g, m, x;
              return W(function (E) {
                switch (E.g) {
                  case 1:
                    try {
                      s = e.B.createSession("persistent-license");
                    } catch (A) {
                      return ((a = new ee(2, 6, 6005, A.message)), e.u(a), E.return(Promise.reject(a)));
                    }
                    return (
                      e.o.D(s, "message", function (A) {
                        $m(e) ? e.N.push(A) : Gm(e, A);
                      }),
                      e.o.D(s, "keystatuseschange", function (A) {
                        return zE(e, A);
                      }),
                      (c = {
                        initData: r.initData,
                        initDataType: r.initDataType,
                        loaded: !1,
                        Yg: 1 / 0,
                        Kb: null,
                        type: "persistent-license",
                      }),
                      e.i.set(s, c),
                      q(E, 2),
                      _(E, s.load(t), 4)
                    );
                  case 4:
                    return (
                      (f = E.h),
                      Nt(e.j),
                      f ||
                        (e.i.delete(s),
                        (g = e.h.persistentSessionOnlinePlayback ? 1 : 2),
                        e.u(new ee(g, 6, 6013)),
                        (c.loaded = !0)),
                      KE(e, c),
                      Bm(e),
                      E.return(s)
                    );
                  case 2:
                    ((m = ae(E)),
                      Nt(e.j, m),
                      e.i.delete(s),
                      (x = e.h.persistentSessionOnlinePlayback ? 1 : 2),
                      e.u(new ee(x, 6, 6005, m.message)),
                      (c.loaded = !0),
                      Bm(e));
                  case 3:
                    return E.return(Promise.resolve());
                }
              });
            }
            function qP(e, t, r, s) {
              try {
                var a = e.B.createSession(s);
              } catch (c) {
                e.u(new ee(2, 6, 6005, c.message));
                return;
              }
              (e.o.D(a, "message", function (c) {
                $m(e) ? e.N.push(c) : Gm(e, c);
              }),
                e.o.D(a, "keystatuseschange", function (c) {
                  return zE(e, c);
                }),
                e.i.set(a, { initData: r, initDataType: t, loaded: !1, Yg: 1 / 0, Kb: null, type: s }),
                e.h.logLicenseExchange && ps(r),
                a.generateRequest(t, r).catch(function (c) {
                  if (!e.j.g) {
                    e.i.delete(a);
                    var f = c.errorCode;
                    if (f && f.systemCode) {
                      var g = f.systemCode;
                      (g < 0 && (g += 4294967296), (g = "0x" + g.toString(16)));
                    }
                    e.u(new ee(2, 6, 6006, c.message, c, g));
                  }
                }));
            }
            function $m(e) {
              return e.l
                ? e.h.delayLicenseRequestUntilPlayed && e.l.paused && !e.oa
                : !e.$ && e.h.delayLicenseRequestUntilPlayed;
            }
            function QP(e) {
              return W(function (t) {
                return t.g == 1
                  ? !e.K || $m(e)
                    ? t.A(0)
                    : _(t, e.m, 3)
                  : _(
                      t,
                      Promise.all(
                        e.X.map(function (r) {
                          return r.promise;
                        }),
                      ),
                      0,
                    );
              });
            }
            function Gm(e, t) {
              var r, s, a, c, f, g, m, x, E, A, R, b, D, M, P, G;
              W(function (U) {
                switch (U.g) {
                  case 1:
                    if (
                      ((r = t.target),
                      e.h.logLicenseExchange && ps(t.message),
                      (s = e.i.get(r)),
                      (a = e.g.licenseServerUri),
                      (c = e.h.advanced[e.g.keySystem]),
                      t.messageType == "individualization-request" &&
                        c &&
                        c.individualizationServer &&
                        (a = c.individualizationServer),
                      (f = fn([a], e.h.retryParameters)),
                      (f.body = t.message),
                      (f.method = "POST"),
                      (f.licenseRequestType = t.messageType),
                      (f.sessionId = r.sessionId),
                      (f.drmInfo = e.g),
                      s && ((f.initData = s.initData), (f.initDataType = s.initDataType)),
                      c && c.headers)
                    )
                      for (g in c.headers) f.headers[g] = c.headers[g];
                    if (e.g.keySystem === "org.w3.clearkey") {
                      var H = f,
                        Q = e.g;
                      try {
                        var ne = Yr(H.body);
                        if (ne) {
                          var z = JSON.parse(ne);
                          z.type || ((z.type = Q.sessionType), (H.body = Er(JSON.stringify(z))));
                        }
                      } catch (J) {}
                    }
                    if (dm(e.g.keySystem))
                      if (((H = Zs(f.body, !0, !0)), H.includes("PlayReadyKeyMessage"))) {
                        for (
                          H = Wo(H, "PlayReadyKeyMessage"), Q = Br(H, "HttpHeader"), Q = I(Q), ne = Q.next();
                          !ne.done;
                          ne = Q.next()
                        )
                          ((z = ne.value),
                            (ne = Br(z, "name")[0]),
                            (z = Br(z, "value")[0]),
                            (f.headers[cn(ne)] = cn(z)));
                        ((H = Br(H, "Challenge")[0]), (f.body = rr(cn(H))));
                      } else f.headers["Content-Type"] = "text/xml; charset=utf-8";
                    return (
                      (m = Date.now()),
                      q(U, 2),
                      (E = e.F.vc.request(2, f, { isPreload: e.V() })),
                      e.X.push(E),
                      _(U, E.promise, 4)
                    );
                  case 4:
                    ((x = U.h), ki(e.X, E), he(U, 3));
                    break;
                  case 2:
                    return (
                      (A = ae(U)),
                      e.j.g ||
                        ((R = {
                          sessionId: r.sessionId,
                          sessionType: s.type,
                          initData: s.initData,
                          initDataType: s.initDataType,
                        }),
                        (b = new ee(2, 6, 6007, A, R)),
                        e.i.size == 1
                          ? (e.u(b), s && s.Kb && s.Kb.reject(b))
                          : (s && s.Kb && s.Kb.reject(b),
                            e.i.delete(r),
                            Gu(e) && (e.m.resolve(), e.M.ka(0.1)))),
                      U.return()
                    );
                  case 3:
                    return e.j.g
                      ? U.return()
                      : ((e.J += (Date.now() - m) / 1e3),
                        e.h.logLicenseExchange && ps(x.data),
                        q(U, 5),
                        _(U, r.update(x.data), 7));
                  case 7:
                    he(U, 6);
                    break;
                  case 5:
                    return (
                      (M = ((D = ae(U)) && D.message) || String(D)),
                      (P = new ee(2, 6, 6008, M)),
                      e.u(P),
                      s && s.Kb && s.Kb.reject(P),
                      U.return()
                    );
                  case 6:
                    if (e.j.g) return U.return();
                    ((G = new Me("drmsessionupdate")),
                      e.F.onEvent(G),
                      s && (s.Kb && s.Kb.resolve(), KE(e, s)),
                      K(U));
                }
              });
            }
            function zE(e, t) {
              t = t.target;
              var r = e.i.get(t),
                s = !1;
              t.keyStatuses.forEach(function (c, f) {
                if (typeof f == "string") {
                  var g = f;
                  ((f = c), (c = g));
                }
                if (((g = tt()), dm(e.g.keySystem) && f.byteLength == 16 && g.Ff())) {
                  g = Ti(f);
                  var m = g.getUint32(0, !0),
                    x = g.getUint16(4, !0),
                    E = g.getUint16(6, !0);
                  (g.setUint32(0, m, !1), g.setUint16(4, x, !1), g.setUint16(6, E, !1));
                }
                (c != "status-pending" && (r.loaded = !0),
                  c == "expired" && (s = !0),
                  (f = gs(f).slice(0, 32)),
                  e.ba.set(f, c));
              });
              var a = t.expiration - Date.now();
              ((a < 0 || (s && a < 1e3)) && r && !r.Kb && (e.i.delete(t), YE(t)),
                Gu(e) && (e.m.resolve(), e.M.ka(a2)));
            }
            function JP(e) {
              var t = e.ba,
                r = e.ma;
              (r.clear(),
                t.forEach(function (s, a) {
                  return r.set(a, s);
                }),
                (t = Array.from(r.values())),
                t.length &&
                  t.every(function (s) {
                    return s == "expired";
                  }) &&
                  e.u(new ee(2, 6, 6014)),
                e.F.zf(Fm(r)));
            }
            function ZP() {
              var e, t, r, s, a, c, f, g, m, x, E, A, R, b, D, M, P, G, U, H, Q, ne, z, J, X, ie, Z, re, se;
              return W(function (me) {
                if (me.g == 1) {
                  if (
                    ((e =
                      "org.w3.clearkey com.widevine.alpha com.widevine.alpha.experiment com.microsoft.playready com.microsoft.playready.hardware com.microsoft.playready.recommendation com.microsoft.playready.recommendation.3000 com.microsoft.playready.recommendation.3000.clearlead com.chromecast.playready com.apple.fps.1_0 com.apple.fps com.huawei.wiseplay".split(
                        " ",
                      )),
                    !(
                      l.MediaKeys &&
                      l.navigator &&
                      l.navigator.requestMediaKeySystemAccess &&
                      l.MediaKeySystemAccess &&
                      l.MediaKeySystemAccess.prototype.getConfiguration
                    ))
                  ) {
                    for (t = {}, r = I(e), s = r.next(); !s.done; s = r.next())
                      ((a = s.value), (t[a] = null));
                    return me.return(t);
                  }
                  for (
                    c = "1.0 1.1 1.2 1.3 1.4 2.0 2.1 2.2 2.3".split(" "),
                      f = [
                        "SW_SECURE_CRYPTO",
                        "SW_SECURE_DECODE",
                        "HW_SECURE_CRYPTO",
                        "HW_SECURE_DECODE",
                        "HW_SECURE_ALL",
                      ],
                      g = ["150", "2000", "3000"],
                      m = {
                        "com.widevine.alpha": f,
                        "com.widevine.alpha.experiment": f,
                        "com.microsoft.playready.recommendation": g,
                      },
                      x = [
                        { contentType: 'video/mp4; codecs="avc1.42E01E"' },
                        { contentType: 'video/webm; codecs="vp8"' },
                      ],
                      E = [
                        { contentType: 'audio/mp4; codecs="mp4a.40.2"' },
                        { contentType: 'audio/webm; codecs="opus"' },
                      ],
                      A = {
                        videoCapabilities: x,
                        audioCapabilities: E,
                        initDataTypes: ["cenc", "sinf", "skd", "keyids"],
                      },
                      R = [null, "cenc", "cbcs"],
                      b = new Map(),
                      D = tt(),
                      M = function (fe, le, ue) {
                        var xe, Se, Ye, be, xt, qe, Ct, lt, rt, dt, yt, ht, st;
                        return W(function (ut) {
                          switch (ut.g) {
                            case 1:
                              return (q(ut, 2), _(ut, le.createMediaKeys(), 5));
                            case 5:
                              xe = ut.h;
                            case 4:
                              he(ut, 3);
                              break;
                            case 2:
                              return (ae(ut), ut.return());
                            case 3:
                              if (
                                ((Ye = (Se = le.getConfiguration().sessionTypes)
                                  ? Se.includes("persistent-license")
                                  : !1),
                                D.Ci() && (Ye = !1),
                                (be = le.getConfiguration().videoCapabilities),
                                (xt = le.getConfiguration().audioCapabilities),
                                (qe = {
                                  persistentState: Ye,
                                  encryptionSchemes: [],
                                  videoRobustnessLevels: [],
                                  audioRobustnessLevels: [],
                                  minHdcpVersions: [],
                                }),
                                b.get(fe) ? (qe = b.get(fe)) : b.set(fe, qe),
                                (Ct = be[0].encryptionScheme) &&
                                  !qe.encryptionSchemes.includes(Ct) &&
                                  qe.encryptionSchemes.push(Ct),
                                (lt = be[0].robustness) &&
                                  !qe.videoRobustnessLevels.includes(lt) &&
                                  qe.videoRobustnessLevels.push(lt),
                                (rt = xt[0].robustness) &&
                                  !qe.audioRobustnessLevels.includes(rt) &&
                                  qe.audioRobustnessLevels.push(rt),
                                !(ue && ("getStatusForPolicy" in xe)))
                              ) {
                                ut.A(0);
                                break;
                              }
                              ((dt = I(c)), (yt = dt.next()));
                            case 7:
                              if (yt.done) {
                                ut.A(0);
                                break;
                              }
                              if (((ht = yt.value), qe.minHdcpVersions.includes(ht))) {
                                ut.A(8);
                                break;
                              }
                              return _(ut, xe.getStatusForPolicy({ minHdcpVersion: ht }), 10);
                            case 10:
                              if (((st = ut.h), st == "usable"))
                                qe.minHdcpVersions.includes(ht) || qe.minHdcpVersions.push(ht);
                              else {
                                ut.A(0);
                                break;
                              }
                            case 8:
                              ((yt = dt.next()), ut.A(7));
                          }
                        });
                      },
                      P = function (fe, le, ue, xe, Se) {
                        Se = Se === void 0 ? !1 : Se;
                        var Ye, be, xt, qe, Ct, lt, rt, dt, yt, ht, st;
                        return W(function (ut) {
                          switch (ut.g) {
                            case 1:
                              for (
                                q(ut, 2), Ye = Ar(A), be = I(Ye.videoCapabilities), xt = be.next();
                                !xt.done;
                                xt = be.next()
                              )
                                ((qe = xt.value), (qe.encryptionScheme = le), (qe.robustness = ue));
                              for (Ct = I(Ye.audioCapabilities), lt = Ct.next(); !lt.done; lt = Ct.next())
                                ((rt = lt.value), (rt.encryptionScheme = le), (rt.robustness = xe));
                              return (
                                (dt = Ar(Ye)),
                                (dt.persistentState = "required"),
                                (dt.sessionTypes = ["persistent-license"]),
                                (yt = [dt, Ye]),
                                (st = tt()),
                                st.Oa() == "MOBILE"
                                  ? _(ut, ah(5, navigator.requestMediaKeySystemAccess(fe, yt)), 7)
                                  : _(ut, navigator.requestMediaKeySystemAccess(fe, yt), 6)
                              );
                            case 6:
                              ((ht = ut.h), ut.A(5));
                              break;
                            case 7:
                              ht = ut.h;
                            case 5:
                              return _(ut, M(fe, ht, Se), 8);
                            case 8:
                              he(ut, 0);
                              break;
                            case 2:
                              (ae(ut), K(ut));
                          }
                        });
                      },
                      G = function (fe) {
                        return !(tt().Ha() === "WEBKIT" && fe === "org.w3.clearkey");
                      },
                      U = [],
                      H = I(e),
                      Q = H.next();
                    !Q.done;
                    Q = H.next()
                  )
                    if (((ne = Q.value), b.set(ne, null), G(ne))) {
                      for (z = !0, J = I(R), X = J.next(); !X.done; X = J.next())
                        ((ie = X.value), U.push(P(ne, ie, "", "", z)), (z = !1));
                      for (Z = I(m[ne] || []), re = Z.next(); !re.done; re = Z.next())
                        ((se = re.value), U.push(P(ne, null, se, "")), U.push(P(ne, null, "", se)));
                    }
                  return _(me, Promise.all(U), 2);
                }
                return me.return(Fm(b));
              });
            }
            function YE(e) {
              return W(function (t) {
                if (t.g == 1)
                  return (q(t, 2), _(t, ah(s2, Promise.all([e.close().catch(function () {}), e.closed])), 4));
                if (t.g != 2) return he(t, 0);
                (ae(t), K(t));
              });
            }
            function $u(e) {
              var t;
              return W(function (r) {
                return (
                  (t = Array.from(e.i.entries())),
                  e.i.clear(),
                  _(
                    r,
                    Promise.all(
                      t.map(function (s) {
                        s = I(s);
                        var a = s.next().value,
                          c = s.next().value;
                        return W(function (f) {
                          if (f.g == 1)
                            return (
                              q(f, 2),
                              e.$ ||
                              e.C.has(a.sessionId) ||
                              c.type !== "persistent-license" ||
                              e.h.persistentSessionOnlinePlayback
                                ? _(f, YE(a), 5)
                                : _(f, a.remove(), 5)
                            );
                          if (f.g != 2) return he(f, 0);
                          (ae(f), K(f));
                        });
                      }),
                    ),
                    0,
                  )
                );
              });
            }
            function XE(e) {
              return (e.video ? e.video.drmInfos : []).concat(e.audio ? e.audio.drmInfos : []);
            }
            function e2(e) {
              e.i.forEach(function (t, r) {
                var s = t.Yg,
                  a = r.expiration;
                (isNaN(a) && (a = 1 / 0), a != s && (e.F.onExpirationUpdated(r.sessionId, a), (t.Yg = a)));
              });
            }
            function Gu(e) {
              return (
                (e = e.i.values()),
                $P(e, function (t) {
                  return t.loaded;
                })
              );
            }
            function t2(e) {
              for (var t = I((e.g && e.g.keyIds) || new Set([])), r = t.next(); !r.done; r = t.next())
                if (e.ba.get(r.value) !== "usable") return !1;
              return !0;
            }
            function n2(e, t) {
              var r = [];
              for (
                t.forEach(function (s, a) {
                  r.push({
                    keySystem: a,
                    licenseServerUri: s,
                    distinctiveIdentifierRequired: !1,
                    persistentStateRequired: !1,
                    audioRobustness: "",
                    videoRobustness: "",
                    serverCertificate: null,
                    serverCertificateUri: "",
                    initData: [],
                    keyIds: new Set(),
                  });
                }),
                  e = I(e),
                  t = e.next();
                !t.done;
                t = e.next()
              )
                ((t = t.value), t.video && (t.video.drmInfos = r), t.audio && (t.audio.drmInfos = r));
            }
            function i2(e, t, r, s, a, c, f, g) {
              var m = [];
              e = I(e);
              for (var x = e.next(), E = {}; !x.done; E = { La: void 0 }, x = e.next()) {
                if (
                  ((E.La = x.value),
                  t.includes(E.La.encryptionScheme) || t.push(E.La.encryptionScheme),
                  E.La.keySystem == "org.w3.clearkey" &&
                  E.La.licenseServerUri.startsWith("data:application/json;base64,")
                    ? m.includes(E.La.licenseServerUri) || m.push(E.La.licenseServerUri)
                    : r.includes(E.La.licenseServerUri) || r.push(E.La.licenseServerUri),
                  a.includes(E.La.serverCertificateUri) || a.push(E.La.serverCertificateUri),
                  E.La.serverCertificate &&
                    (s.some(
                      (function (b) {
                        return function (D) {
                          return fs(D, b.La.serverCertificate);
                        };
                      })(E),
                    ) ||
                      s.push(E.La.serverCertificate)),
                  E.La.initData)
                ) {
                  x = I(E.La.initData);
                  for (var A = x.next(), R = {}; !A.done; R = { Pg: void 0 }, A = x.next())
                    ((R.Pg = A.value),
                      c.some(
                        (function (b) {
                          return function (D) {
                            var M = b.Pg;
                            return D.keyId && D.keyId == M.keyId
                              ? !0
                              : D.initDataType == M.initDataType && fs(D.initData, M.initData);
                          };
                        })(R),
                      ) || c.push(R.Pg));
                }
                if (E.La.keyIds) for (x = I(E.La.keyIds), A = x.next(); !A.done; A = x.next()) f.add(A.value);
                if (E.La.keySystemUris && g)
                  for (E = I(E.La.keySystemUris), x = E.next(); !x.done; x = E.next()) g.add(x.value);
              }
              if (m.length == 1) r.push(m[0]);
              else if (m.length > 0) {
                for (t = [], m = I(m), s = m.next(); !s.done; s = m.next())
                  ((s = l.atob(s.value.split("data:application/json;base64,").pop())),
                    (s = JSON.parse(s)),
                    t.push.apply(t, V(s.keys)));
                ((m = JSON.stringify({ keys: t })), r.push("data:application/json;base64," + l.btoa(m)));
              }
            }
            function r2(e, t, r, s) {
              var a = e.keySystem;
              a &&
                (a != "org.w3.clearkey" || !e.licenseServerUri) &&
                (t.size && t.get(a) && ((t = t.get(a)), (e.licenseServerUri = t)),
                e.keyIds || (e.keyIds = new Set()),
                (r = r.get(a)) &&
                  (e.distinctiveIdentifierRequired ||
                    (e.distinctiveIdentifierRequired = r.distinctiveIdentifierRequired),
                  e.persistentStateRequired || (e.persistentStateRequired = r.persistentStateRequired),
                  e.serverCertificate || (e.serverCertificate = r.serverCertificate),
                  r.sessionType && (e.sessionType = r.sessionType),
                  e.serverCertificateUri || (e.serverCertificateUri = r.serverCertificateUri)),
                s[a] && (e.keySystem = s[a]),
                l.cast &&
                  l.cast.__platform__ &&
                  a == "com.microsoft.playready" &&
                  (e.keySystem = "com.chromecast.playready"));
            }
            function qE(e, t) {
              if (((e = Wa(e)), e.size != 0)) {
                ((e = US(e)), (t = I(t)));
                for (var r = t.next(); !r.done; r = t.next())
                  ((r = r.value), r.video && (r.video.drmInfos = [e]), r.audio && (r.audio.drmInfos = [e]));
              }
            }
            var s2 = 1,
              o2 = 5,
              a2 = 0.5;
            function l2() {
              ((this.g = ea), (this.j = new Map().set(ea, 2).set(Zo, 1)), (this.i = 0), (this.h = -1));
            }
            function jm(e, t) {
              var r = e.g !== t;
              return ((e.g = t), r && t === ea && (e.i = Date.now()), r);
            }
            var Zo = 0,
              ea = 1;
            /*
 @license
 Shaka Player
 Copyright 2023 Google LLC
 SPDX-License-Identifier: Apache-2.0
*/ function Vm(e, t, r) {
              ((this.h = e), (this.i = t), (this.g = r));
            }
            function QE(e, t) {
              return W(function (r) {
                if (r.g == 1)
                  return _(r, wP(e.g, t, e.h.drm.preferredKeySystems, e.h.drm.keySystemsMapping), 2);
                if (
                  (e.h.streaming.dontChooseCodecs ||
                    pE(
                      t,
                      e.h.preferredVideoCodecs,
                      e.h.preferredAudioCodecs,
                      e.h.preferredDecodingAttributes,
                      e.h.preferredTextFormats,
                    ),
                  !t.variants.some(Uu))
                )
                  throw new ee(2, 4, 4032);
                return r.return(ZE(e, t));
              });
            }
            function JE(e, t) {
              var r = e.h.restrictions;
              e = e.i;
              var s = !1;
              t = I(t.variants);
              for (var a = t.next(); !a.done; a = t.next()) {
                a = a.value;
                var c = a.allowedByApplication;
                ((a.allowedByApplication = ch(a, r, e)), c != a.allowedByApplication && (s = !0));
              }
              return s;
            }
            function ZE(e, t) {
              var r = JE(e, t);
              if (t) {
                var s = e.g ? e.g.g : null;
                if (s && e.g.B) {
                  for (var a = new Set(), c = I(t.variants), f = c.next(); !f.done; f = c.next())
                    ((f = f.value), f.audio && a.add(f.audio), f.video && a.add(f.video));
                  for (a = I(a), c = a.next(); !c.done; c = a.next()) eA(e, s.keySystem, c.value);
                }
                tA(e, t);
              }
              return r;
            }
            function eA(e, t, r) {
              r = I(r.drmInfos);
              for (var s = r.next(); !s.done; s = r.next())
                if (((s = s.value), s.keySystem == t)) {
                  for (var a = I(s.initData || []), c = a.next(); !c.done; c = a.next())
                    ((c = c.value), Bu(e.g, c.initDataType, c.initData));
                  ((a = e.g), a.g && a.g.mediaTypes !== s.mediaTypes && (a.g.mediaTypes = s.mediaTypes));
                }
            }
            function tA(e, t) {
              function r(x) {
                if (x && !g.has(x) && (g.add(x), x.keyIds.size)) {
                  x = I(x.keyIds);
                  for (var E = x.next(); !E.done; E = x.next()) {
                    E = E.value;
                    var A = s[a ? "00" : E];
                    A ? nA.includes(A) && f.add(A) : c.add(E);
                  }
                }
              }
              var s = e.g ? e.g.$e() : {};
              e = Object.keys(s);
              var a = e.length && e[0] == "00";
              e = !1;
              var c = new Set(),
                f = new Set(),
                g = new WeakSet();
              t = I(t.variants);
              for (var m = t.next(); !m.done; m = t.next()) {
                if (((m = m.value), !m.allowedByApplication)) e = !0;
                else if (m.allowedByKeySystem) return;
                (r(m.audio), r(m.video));
              }
              throw (
                (e = {
                  hasAppRestrictions: e,
                  missingKeys: Array.from(c),
                  restrictedKeyStatuses: Array.from(f),
                }),
                new ee(2, 4, 4012, e)
              );
            }
            var nA = ["output-restricted", "internal-error"];
            Ee("shaka.config.CodecSwitchingStrategy", { RELOAD: "reload", SMOOTH: "smooth" });
            function ti(e) {
              if (Hm.has(e)) return Hm.get(e);
              var t = l.ManagedMediaSource || l.MediaSource;
              return t ? ((t = t.isTypeSupported(e)), Hm.set(e, t), t) : !1;
            }
            function iA() {
              var e = l.ManagedMediaSource || l.MediaSource;
              return e && e.prototype
                ? !!e.prototype.setLiveSeekableRange && !!e.prototype.clearLiveSeekableRange
                : !1;
            }
            var Hm = new Map();
            function Ah(e, t) {
              var r = null,
                s = null,
                a = null,
                c = null,
                f = e.U();
              return (
                t & 1 && (a = e.Ed()),
                t & 2 && (c = e.U()),
                t & 8 && (r = e.U()),
                t & 16 && (s = e.U()),
                { trackId: f, Wd: r, Xd: s, rj: a, Ri: c }
              );
            }
            function Ih(e, t) {
              return t == 1
                ? ((t = e.U()), (e = e.U()), { baseMediaDecodeTime: t * 4294967296 + e })
                : { baseMediaDecodeTime: e.U() };
            }
            function wh(e, t) {
              return (
                t == 1 ? (e.skip(8), e.skip(8)) : (e.skip(4), e.skip(4)),
                (t = e.U()),
                e.skip(4),
                (e = e.Ca()),
                {
                  timescale: t,
                  language:
                    String.fromCharCode((e >> 10) + 96) +
                    String.fromCharCode(((e & 960) >> 5) + 96) +
                    String.fromCharCode((e & 31) + 96),
                }
              );
            }
            function Rh(e, t, r) {
              var s = e.U(),
                a = [],
                c = null;
              (r & 1 && (c = e.dh()), r & 4 && e.skip(4));
              for (var f = 0; f < s; f++) {
                var g = { nh: null, sampleSize: null, Gf: null };
                (r & 256 && (g.nh = e.U()),
                  r & 512 && (g.sampleSize = e.U()),
                  r & 1024 && e.skip(4),
                  r & 2048 && (g.Gf = t == 0 ? e.U() : e.dh()),
                  a.push(g));
              }
              return { Hm: s, mh: a, qg: c };
            }
            function rA(e) {
              (e.skip(6), e.skip(2), e.skip(8));
              var t = e.Ca();
              return (
                e.skip(2),
                e.skip(2),
                e.skip(2),
                (e = e.Ca() + e.Ca() / 65536),
                { channelCount: t, sampleRate: e }
              );
            }
            function Km(e) {
              return ((e = e.U()), { codec: Th(e) });
            }
            function u2(e) {
              var t = null,
                r = null,
                s = e.Tb(4, !1),
                a = String.fromCharCode(s[0]);
              if (
                ((a += String.fromCharCode(s[1])),
                (a += String.fromCharCode(s[2])),
                (a += String.fromCharCode(s[3])),
                a === "nclx")
              ) {
                switch (e.Ca()) {
                  case 1:
                  case 5:
                  case 6:
                  case 7:
                    t = "srgb";
                    break;
                  case 9:
                    t = "rec2020";
                    break;
                  case 11:
                  case 12:
                    t = "p3";
                }
                switch (((s = e.Ca()), e.Ca(), s)) {
                  case 1:
                  case 6:
                  case 13:
                  case 14:
                  case 15:
                    r = "SDR";
                    break;
                  case 16:
                    r = "PQ";
                    break;
                  case 18:
                    r = "HLG";
                }
              }
              return { colorGamut: t, ze: r };
            }
            function ju(e, t) {
              return (
                (t = t === void 0 ? !1 : t),
                (e = e.toString(16).toUpperCase()),
                t ? e : ("0" + e).slice(-2)
              );
            }
            function Ni(e) {
              return (e < 10 ? "0" : "") + e;
            }
            function Ya(e) {
              this.g = e;
            }
            function Xa(e) {
              for (var t = [], r = I(e.g), s = r.next(); !s.done; s = r.next()) {
                var a = t,
                  c = a.push,
                  f = s.value;
                s = ct;
                var g = f.id + 1,
                  m = f.stream.width || 0,
                  x = f.stream.height || 0;
                f.type == "audio" && (x = m = 0);
                var E = f.duration * f.timescale,
                  A = Math.floor(E / (lo + 1));
                switch (
                  ((E = Math.floor(E % (lo + 1))),
                  (g = new Uint8Array(
                    [1, 0, 0, 7, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 3].concat(
                      V(Yt(g, 4)),
                      [0, 0, 0, 0],
                      V(Yt(A, 4)),
                      V(Yt(E, 4)),
                      [
                        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                        0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 64, 0, 0, 0,
                      ],
                      V(Yt(m, 2)),
                      [0, 0],
                      V(Yt(x, 2)),
                      [0, 0],
                    ),
                  )),
                  (g = ct("tkhd", g)),
                  (m = ct),
                  (A = f.duration * f.timescale),
                  (x = Math.floor(A / (lo + 1))),
                  (A = Math.floor(A % (lo + 1))),
                  (E = f.stream.language),
                  (E =
                    ((E.charCodeAt(0) - 96) << 10) | ((E.charCodeAt(1) - 96) << 5) | (E.charCodeAt(2) - 96)),
                  (x = new Uint8Array(
                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 3].concat(
                      V(Yt(f.timescale, 4)),
                      V(Yt(x, 4)),
                      V(Yt(A, 4)),
                      V(Yt(E, 2)),
                      [0, 0],
                    ),
                  )),
                  (x = ct("mdhd", x)),
                  (A = f),
                  (E = new Uint8Array([])),
                  A.type)
                ) {
                  case "video":
                    E = d2.value();
                    break;
                  case "audio":
                    E = h2.value();
                }
                A = ct("hdlr", E);
                e: {
                  switch (f.type) {
                    case "video":
                      f = ct("minf", ct("vmhd", y2.value()), cA.value(), sA(f));
                      break e;
                    case "audio":
                      f = ct("minf", ct("smhd", v2.value()), cA.value(), sA(f));
                      break e;
                  }
                  f = new Uint8Array([]);
                }
                ((f = m("mdia", x, A, f)), (s = s("trak", g, f)), c.call(a, s));
              }
              for (
                t = dn.apply(Hn, V(t)),
                  c = e.g[0],
                  r = ct,
                  s = c.duration * c.timescale,
                  a = Math.floor(s / (lo + 1)),
                  s = Math.floor(s % (lo + 1)),
                  a = new Uint8Array(
                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 3].concat(
                      V(Yt(c.timescale, 4)),
                      V(Yt(a, 4)),
                      V(Yt(s, 4)),
                      [
                        0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                        0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 64, 0, 0, 0, 0, 0, 0, 0, 0,
                        0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 255, 255, 255, 255,
                      ],
                    ),
                  ),
                  a = ct("mvhd", a),
                  s = [],
                  e = I(e.g),
                  m = e.next();
                !m.done;
                m = e.next()
              )
                ((f = s),
                  (g = f.push),
                  (m = new Uint8Array(
                    [0, 0, 0, 0].concat(
                      V(Yt(m.value.id + 1, 4)),
                      [0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    ),
                  )),
                  (m = ct("trex", m)),
                  g.call(f, m));
              if (((e = dn.apply(Hn, V(s))), (e = ct("mvex", e)), (s = []), c.encrypted)) {
                for (c = I(c.stream.drmInfos), f = c.next(); !f.done; f = c.next())
                  if (((f = f.value), f.initData))
                    for (f = I(f.initData), g = f.next(); !g.done; g = f.next()) s.push(g.value.initData);
                c = dn.apply(Hn, V(s));
              } else c = new Uint8Array([]);
              return (
                (e = r("moov", a, t, e, c)),
                (t = T2.value()),
                (r = new Uint8Array(t.byteLength + e.byteLength)),
                r.set(t),
                r.set(e, t.byteLength),
                r
              );
            }
            function sA(e) {
              var t = ct,
                r = "aac";
              e.codecs.includes("mp3")
                ? (r = "mp3")
                : e.codecs.includes("ac-3")
                  ? (r = tt().se() ? "ec-3" : "ac-3")
                  : e.codecs.includes("ec-3")
                    ? (r = "ec-3")
                    : e.codecs.includes("opus") && (r = "opus");
              var s = new Uint8Array([]);
              switch (e.type) {
                case "video":
                  if (e.codecs.includes("avc1")) {
                    if (((r = e.stream.width || 0), (s = e.stream.height || 0), e.Sa.byteLength > 0))
                      var a = ct("avcC", e.Sa);
                    else {
                      a = ct;
                      for (var c = 7, f = [], g = [], m = 0, x = 0, E = 0, A = 0; A < e.Bb.length; A++) {
                        var R = aA(e.Bb[A]);
                        switch (R[0] & 31) {
                          case 7:
                            (f.push(R), (c += R.length + 2));
                            break;
                          case 8:
                            (g.push(R), (c += R.length + 2));
                        }
                      }
                      for (
                        f.length > 0 && ((m = f[0][1]), (E = f[0][2]), (x = f[0][3])),
                          c = new Uint8Array(c),
                          A = 0,
                          c[A++] = 1,
                          c[A++] = m,
                          c[A++] = E,
                          c[A++] = x,
                          c[A++] = 255,
                          c[A++] = 224 | f.length,
                          m = 0;
                        m < f.length;
                        m++
                      )
                        ((c[A++] = (f[m].length & 65280) >> 8),
                          (c[A++] = f[m].length & 255),
                          c.set(f[m], A),
                          (A += f[m].length));
                      for (c[A++] = g.length, f = 0; f < g.length; f++)
                        ((c[A++] = (g[f].length & 65280) >> 8),
                          (c[A++] = g[f].length & 255),
                          c.set(g[f], A),
                          (A += g[f].length));
                      a = a("avcC", c);
                    }
                    ((r = new Uint8Array(
                      [0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0].concat(
                        V(Yt(r, 2)),
                        V(Yt(s, 2)),
                        [
                          0, 72, 0, 0, 0, 72, 0, 0, 0, 0, 0, 0, 0, 1, 19, 118, 105, 100, 101, 111, 106, 115,
                          45, 99, 111, 110, 116, 114, 105, 98, 45, 104, 108, 115, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                          0, 0, 0, 0, 24, 17, 17,
                        ],
                      ),
                    )),
                      (s = "avc1"),
                      (g = oA(e)),
                      (f = new Uint8Array([])),
                      e.encrypted && ((f = ta(e.stream, e.codecs)), (s = "encv")),
                      (s = ct(s, r, a, g, f)));
                  } else
                    e.codecs.includes("hvc1") &&
                      ((s = e.stream.width || 0),
                      (a = e.stream.height || 0),
                      (r = new Uint8Array([])),
                      e.Sa.byteLength > 0 && (r = ct("hvcC", e.Sa)),
                      (s = new Uint8Array(
                        [0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0].concat(
                          V(Yt(s, 2)),
                          V(Yt(a, 2)),
                          [
                            0, 72, 0, 0, 0, 72, 0, 0, 0, 0, 0, 0, 0, 1, 19, 118, 105, 100, 101, 111, 106, 115,
                            45, 99, 111, 110, 116, 114, 105, 98, 45, 104, 108, 115, 0, 0, 0, 0, 0, 0, 0, 0, 0,
                            0, 0, 0, 0, 24, 17, 17,
                          ],
                        ),
                      )),
                      (a = "hvc1"),
                      (g = oA(e)),
                      (f = new Uint8Array([])),
                      e.encrypted && ((f = ta(e.stream, e.codecs)), (a = "encv")),
                      (s = ct(a, s, r, g, f)));
                  break;
                case "audio":
                  (r == "mp3"
                    ? (e = ct(".mp3", Vu(e)))
                    : r == "ac-3"
                      ? ((r = ct("dac3", e.Ga)),
                        (s = "ac-3"),
                        (a = new Uint8Array([])),
                        e.encrypted && ((a = ta(e.stream, e.codecs)), (s = "enca")),
                        (e = ct(s, Vu(e), r, a)))
                      : r == "ec-3"
                        ? ((r = ct("dec3", e.Ga)),
                          (s = "ec-3"),
                          (a = new Uint8Array([])),
                          e.encrypted && ((a = ta(e.stream, e.codecs)), (s = "enca")),
                          (e = ct(s, Vu(e), r, a)))
                        : r == "opus"
                          ? ((r = ct("dOps", e.Ga)),
                            (s = "Opus"),
                            (a = new Uint8Array([])),
                            e.encrypted && ((a = ta(e.stream, e.codecs)), (s = "enca")),
                            (e = ct(s, Vu(e), r, a)))
                          : (e.Ga.byteLength > 0
                              ? (r = ct("esds", e.Ga))
                              : ((r = ct),
                                (s = e.id + 1),
                                (a = e.stream.channelsCount || 2),
                                (f = e.stream.audioSamplingRate || 44100),
                                (m = Ma("audio", e.codecs.split(","))),
                                (x = {
                                  96e3: 0,
                                  88200: 1,
                                  64e3: 2,
                                  48e3: 3,
                                  44100: 4,
                                  32e3: 5,
                                  24e3: 6,
                                  22050: 7,
                                  16e3: 8,
                                  12e3: 9,
                                  11025: 10,
                                  8e3: 11,
                                  7350: 12,
                                }),
                                (g = x[f]),
                                (m === "mp4a.40.5" || m === "mp4a.40.29") && (g = x[f * 2]),
                                (f = parseInt(m.split(".").pop(), 10)),
                                (s = new Uint8Array(
                                  [0, 0, 0, 0, 3, 25].concat(V(Yt(s, 2)), [
                                    0,
                                    4,
                                    17,
                                    64,
                                    21,
                                    0,
                                    0,
                                    0,
                                    0,
                                    0,
                                    0,
                                    0,
                                    0,
                                    0,
                                    0,
                                    0,
                                    5,
                                    2,
                                    (f << 3) | (g >>> 1),
                                    (g << 7) | (a << 3),
                                    6,
                                    1,
                                    2,
                                  ]),
                                )),
                                (r = r("esds", s))),
                            (s = "mp4a"),
                            (a = new Uint8Array([])),
                            e.encrypted && ((a = ta(e.stream, e.codecs)), (s = "enca")),
                            (e = ct(s, Vu(e), r, a))),
                    (s = e));
              }
              return (
                (e = ct("stsd", x2.value(), s)),
                t(
                  "stbl",
                  e,
                  ct("stts", f2.value()),
                  ct("stsc", p2.value()),
                  ct("stsz", m2.value()),
                  ct("stco", g2.value()),
                )
              );
            }
            function oA(e) {
              if (!e.Za && !e.$a) return new Uint8Array([]);
              var t = e.$a;
              return ((e = new Uint8Array([].concat(V(Yt(e.Za, 4)), V(Yt(t, 4))))), ct("pasp", e));
            }
            function Vu(e) {
              return new Uint8Array(
                [
                  0,
                  0,
                  0,
                  0,
                  0,
                  0,
                  0,
                  1,
                  0,
                  0,
                  0,
                  0,
                  0,
                  0,
                  0,
                  0,
                  0,
                  e.stream.channelsCount || 2,
                  0,
                  16,
                  0,
                  0,
                  0,
                  0,
                ].concat(V(Yt(e.stream.audioSamplingRate || 44100, 2)), [0, 0]),
              );
            }
            function ta(e, t) {
              var r = ct;
              ((t = new Uint8Array([].concat(V(Yt(lA(t.split(".")[0]), 4))))), (t = ct("frma", t)));
              var s = "cenc",
                a = e.drmInfos[0];
              (a && a.encryptionScheme && (s = a.encryptionScheme),
                (s = new Uint8Array([0, 0, 0, 0].concat(V(Yt(lA(s), 4)), [0, 1, 0, 0]))),
                (s = ct("schm", s)),
                (a = ct));
              var c = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]);
              e = I(e.drmInfos);
              for (var f = e.next(); !f.done; f = e.next())
                if ((f = f.value) && f.keyIds && f.keyIds.size) {
                  f = I(f.keyIds);
                  for (var g = f.next(); !g.done; g = f.next()) c = aA(g.value);
                }
              return (
                (e = new Uint8Array([0, 0, 0, 0, 0, 0, 1, 8])),
                (c = ct("tenc", e, c)),
                r("sinf", t, s, a("schi", c))
              );
            }
            function Hu(e) {
              var t = [];
              e = I(e.g);
              for (var r = e.next(); !r.done; r = e.next()) {
                r = r.value;
                var s = t.push,
                  a = s.apply,
                  c = ct,
                  f = new Uint8Array([0, 0, 0, 0].concat(V(Yt(r.data ? r.data.sequenceNumber : 0, 4))));
                f = ct("mfhd", f);
                var g,
                  m = r.data ? r.data.zb : [],
                  x = new Uint8Array(4 + m.length);
                for (g = 0; g < m.length; g++) {
                  var E = m[g].flags;
                  x[g + 4] = (E.ib << 4) | (E.mb << 2) | E.jb;
                }
                m = ct("sdtp", x);
                var A = m.length + 32 + 20 + 8 + 16 + 8 + 8;
                ((x = ct),
                  (g = new Uint8Array(
                    [0, 0, 0, 58].concat(
                      V(Yt(r.id + 1, 4)),
                      [0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                    ),
                  )),
                  (g = ct("tfhd", g)),
                  (E = r.data ? r.data.baseMediaDecodeTime : 0));
                var R = Math.floor(E % (lo + 1));
                ((E = new Uint8Array([1, 0, 0, 0].concat(V(Yt(Math.floor(E / (lo + 1)), 4)), V(Yt(R, 4))))),
                  (E = ct("tfdt", E)));
                var b = A;
                ((A = r.data ? r.data.zb : []), (R = A.length));
                var D = 12 + 16 * R,
                  M = new Uint8Array(D);
                for (
                  b += 8 + D,
                    M.set([r.type === "video" ? 1 : 0, 0, 15, 1].concat(V(Yt(R, 4)), V(Yt(b, 4))), 0),
                    b = 0;
                  b < R;
                  b++
                ) {
                  var P = A[b];
                  D = Yt(P.duration, 4);
                  var G = Yt(P.size, 4),
                    U = P.flags;
                  ((P = Yt(P.sb, 4)),
                    M.set(
                      [].concat(
                        V(D),
                        V(G),
                        [(U.xb << 2) | U.ib, (U.mb << 6) | (U.jb << 4) | U.yb, U.hb & 61440, U.hb & 15],
                        V(P),
                      ),
                      12 + 16 * b,
                    ));
                }
                ((A = ct("trun", M)),
                  (m = x("traf", g, E, A, m)),
                  (c = c("moof", f, m)),
                  a.call(s, t, [c, c2(r)]));
              }
              return dn.apply(Hn, V(t));
            }
            function c2(e) {
              return (
                (e = (e.data ? e.data.zb : []).map(function (t) {
                  return t.data;
                })),
                (e = dn.apply(Hn, V(e))),
                ct("mdat", e)
              );
            }
            function Yt(e, t) {
              var r = [];
              for (--t; t >= 0; t--) r.push((e >> (8 * t)) & 255);
              return r;
            }
            function aA(e) {
              for (var t = new Uint8Array(e.length / 2), r = 0; r < e.length / 2; r += 1)
                t[r] = parseInt(String(e[r * 2] + e[r * 2 + 1]), 16);
              return t;
            }
            function lA(e) {
              for (var t = 0, r = 0; r < e.length; r += 1) t |= e.charCodeAt(r) << ((e.length - r - 1) * 8);
              return t;
            }
            function ct(e) {
              var t = Qe.apply(1, arguments),
                r = uA.get(e);
              r || ((r = [e.charCodeAt(0), e.charCodeAt(1), e.charCodeAt(2), e.charCodeAt(3)]), uA.set(e, r));
              for (var s = 8, a = t.length - 1; a >= 0; a--) s += t[a].byteLength;
              for (
                a = new Uint8Array(s),
                  a[0] = (s >> 24) & 255,
                  a[1] = (s >> 16) & 255,
                  a[2] = (s >> 8) & 255,
                  a[3] = s & 255,
                  a.set(r, 4),
                  r = 0,
                  s = 8;
                r < t.length;
                r++
              )
                (a.set(t[r], s), (s += t[r].byteLength));
              return a;
            }
            var lo = 4294967295,
              uA = new Map(),
              d2 = new Kt(function () {
                return new Uint8Array([
                  0, 0, 0, 0, 0, 0, 0, 0, 118, 105, 100, 101, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 86, 105,
                  100, 101, 111, 72, 97, 110, 100, 108, 101, 114, 0,
                ]);
              }),
              h2 = new Kt(function () {
                return new Uint8Array([
                  0, 0, 0, 0, 0, 0, 0, 0, 115, 111, 117, 110, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 83, 111,
                  117, 110, 100, 72, 97, 110, 100, 108, 101, 114, 0,
                ]);
              }),
              f2 = new Kt(function () {
                return new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]);
              }),
              p2 = new Kt(function () {
                return new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]);
              }),
              g2 = new Kt(function () {
                return new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]);
              }),
              m2 = new Kt(function () {
                return new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]);
              }),
              y2 = new Kt(function () {
                return new Uint8Array([0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0]);
              }),
              v2 = new Kt(function () {
                return new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]);
              }),
              x2 = new Kt(function () {
                return new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1]);
              }),
              T2 = new Kt(function () {
                var e = new Uint8Array([105, 115, 111, 109]),
                  t = new Uint8Array([97, 118, 99, 49]),
                  r = new Uint8Array([0, 0, 0, 1]);
                return ct("ftyp", e, r, e, t);
              }),
              cA = new Kt(function () {
                var e = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 12, 117, 114, 108, 32, 0, 0, 0, 1]);
                return ((e = ct("dref", e)), ct("dinf", e));
              });
            function S2(e) {
              e = We(e);
              var t = null;
              return (
                new bt()
                  .box("moov", Ze)
                  .box("trak", Ze)
                  .box("mdia", Ze)
                  .box("minf", Ze)
                  .box("stbl", Ze)
                  .S("stsd", ws)
                  .box("enca", function (r) {
                    return ((t = r.reader.h), xh(r));
                  })
                  .box("sinf", Ze)
                  .box("frma", function (r) {
                    (r.parser.stop(),
                      Km(r.reader).codec === "ec-3" && t && t.getUint16(16) !== 2 && t.setUint16(16, 2));
                  })
                  .parse(e),
                e
              );
            }
            function E2(e, t, r) {
              function s(b) {
                A.push({ box: b, Ei: 1701733217 });
              }
              function a(b) {
                A.push({ box: b, Ei: 1701733238 });
              }
              function c(b) {
                ((m = !0), b.parser.stop());
              }
              function f(b) {
                (E.push(b), Ze(b));
              }
              var g = (t = We(t)),
                m = !1,
                x,
                E = [],
                A = [];
              if (
                (new bt()
                  .box("moov", f)
                  .box("trak", f)
                  .box("mdia", f)
                  .box("minf", f)
                  .box("stbl", f)
                  .S("stsd", function (b) {
                    ((x = b), E.push(b), ws(b));
                  })
                  .S("encv", c)
                  .S("enca", c)
                  .S("dvav", a)
                  .S("dva1", a)
                  .S("dvh1", a)
                  .S("dvhe", a)
                  .S("dvc1", a)
                  .S("dvi1", a)
                  .S("hev1", a)
                  .S("hvc1", a)
                  .S("avc1", a)
                  .S("avc3", a)
                  .S("ac-3", s)
                  .S("ec-3", s)
                  .S("ac-4", s)
                  .S("Opus", s)
                  .S("fLaC", s)
                  .S("mp4a", s)
                  .parse(t),
                m)
              )
                return t;
              if (A.length == 0 || !x) throw (gs(t), new ee(2, 3, 3019, r));
              (A.reverse(), (r = I(A)));
              for (var R = r.next(); !R.done; R = r.next())
                ((R = R.value), (g = w2(e, g, x, R.box, E, R.Ei)));
              return tt().ih()
                ? ((e = new Uint8Array(t.byteLength + g.byteLength)), e.set(g), e.set(t, g.byteLength), e)
                : g;
            }
            function A2(e) {
              e = We(e);
              var t = [];
              new bt()
                .box("mdat", function (f) {
                  t.push(f);
                })
                .parse(e);
              for (var r = [], s = 0; s < t.length; s++) {
                var a = t[s - 1],
                  c = t[s];
                r.push(I2(e.subarray(a ? a.start + a.size : 0, c.start + c.size)));
              }
              return dn.apply(Hn, V(r));
            }
            function I2(e) {
              function t(A) {
                (f.push(A), Ze(A));
              }
              var r,
                s,
                a,
                c,
                f = [];
              if (
                (new bt()
                  .box("moof", t)
                  .box("traf", t)
                  .S("tfhd", function (A) {
                    ((r = A), (a = Ah(A.reader, A.flags)));
                  })
                  .S("trun", function (A) {
                    ((s = A), (c = Rh(A.reader, A.version, A.flags)));
                  })
                  .parse(e),
                a && a.Ri !== 2)
              ) {
                var g = r.start + ao(r) + 4 + (a.rj !== null ? 8 : 0),
                  m = Ti(e);
                if (a.Ri !== null) m.setUint32(g, 2);
                else {
                  Ch(e, r.start, r.size + 4);
                  var x = m.getUint32(r.start + 8);
                  (m.setUint32(r.start + 8, x | 2),
                    c && c.qg !== null && m.setInt32(s.start + ao(s) + 4, c.qg + 4),
                    (x = e.subarray(0, g)),
                    (m = e.subarray(g)),
                    (e = new Uint8Array(e.byteLength + 4)),
                    e.set(x),
                    (x = []));
                  for (var E = 3; E >= 0; E--) x.push((2 >> (8 * E)) & 255);
                  for (
                    e.set(new Uint8Array(x), g), e.set(m, g + 4), g = I(f), m = g.next();
                    !m.done;
                    m = g.next()
                  )
                    ((m = m.value), Ch(e, m.start, m.size + 4));
                }
              }
              return e;
            }
            function w2(e, t, r, s, a, c) {
              var f = ta(e, s.name),
                g = t.subarray(s.start, s.start + s.size);
              for (
                e = new Uint8Array(s.size + f.byteLength),
                  e.set(g, 0),
                  Ti(e).setUint32(4, c),
                  e.set(f, s.size),
                  Ch(e, 0, e.byteLength),
                  c = new Uint8Array(t.byteLength + e.byteLength),
                  s = tt().jf() ? s.start : s.start + s.size,
                  f = t.subarray(s),
                  c.set(t.subarray(0, s)),
                  c.set(e, s),
                  c.set(f, s + e.byteLength),
                  t = I(a),
                  a = t.next();
                !a.done;
                a = t.next()
              )
                ((a = a.value), Ch(c, a.start, a.size + e.byteLength));
              return ((e = Ti(c, r.start)), (r = ao(r)), (t = e.getUint32(r)), e.setUint32(r, t + 1), c);
            }
            function Ch(e, t, r) {
              ((e = Ti(e, t)),
                (t = e.getUint32(0)),
                t != 0 &&
                  (t == 1 ? (e.setUint32(8, r >> 32), e.setUint32(12, r & 4294967295)) : e.setUint32(0, r)));
            }
            function R2(e) {
              function t(a) {
                (s.push({ start: a.start, size: a.size }), Ze(a));
              }
              var r = We(e),
                s = [];
              return (
                new bt()
                  .box("moov", t)
                  .box("trak", t)
                  .box("mdia", t)
                  .box("minf", t)
                  .box("stbl", t)
                  .box("stsd", function (a) {
                    s.push({ start: a.start, size: a.size });
                    for (var c = Ti(r, a.start), f = 0; f < a.size - 3; f++) {
                      var g = c.getUint32(f);
                      g == 1633889587
                        ? c.setUint32(f, 1700998451)
                        : g == 1684103987 && c.setUint32(f, 1684366131);
                    }
                  })
                  .parse(r),
                r
              );
            }
            function Ai(e, t, r, s, a, c, f, g) {
              ((this.P = e),
                (this.startByte = t),
                (this.endByte = r),
                (this.xd = s === void 0 ? null : s),
                (this.timescale = a === void 0 ? null : a),
                (this.h = c === void 0 ? null : c),
                (this.aesKey = f === void 0 ? null : f),
                (this.g = this.mimeType = this.codecs = null),
                (this.encrypted = g === void 0 ? !1 : g));
            }
            ((Ai.prototype.Jc = function () {
              return this.startByte;
            }),
              (Ai.prototype.Hc = function () {
                return this.endByte;
              }),
              (Ai.prototype.ue = function (e) {
                this.h = e;
              }),
              (Ai.prototype.$b = function () {
                return this.h;
              }));
            function Ku(e, t) {
              return e === t
                ? !0
                : e && t
                  ? e.Jc() == t.Jc() &&
                    e.Hc() == t.Hc() &&
                    Nr(e.P().sort(), t.P().sort()) &&
                    fs(e.$b(), t.$b())
                  : e == t;
            }
            (Ee("shaka.media.InitSegmentReference", Ai),
              (Ai.prototype.getEndByte = Ai.prototype.Hc),
              (Ai.prototype.getStartByte = Ai.prototype.Jc));
            function Be(e, t, r, s, a, c, f, g, m, x, E, A, R, b, D, M) {
              for (
                x = x === void 0 ? [] : x,
                  b = b === void 0 ? Rs : b,
                  this.startTime = e,
                  this.j = this.endTime = t,
                  this.C = r,
                  this.startByte = s,
                  this.endByte = a,
                  this.ea = c,
                  this.timestampOffset = f,
                  this.appendWindowStart = g,
                  this.appendWindowEnd = m,
                  this.g = x,
                  this.tilesLayout = E === void 0 ? "" : E,
                  this.B = A === void 0 ? null : A,
                  this.h = R === void 0 ? null : R,
                  this.status = b,
                  this.preload = !1,
                  this.l = !0,
                  this.o = !1,
                  this.aesKey = D === void 0 ? null : D,
                  this.thumbnailSprite = null,
                  this.i = -1,
                  this.m = M === void 0 ? !1 : M,
                  this.je = this.Xc = !1,
                  e = I(this.g),
                  t = e.next();
                !t.done;
                t = e.next()
              )
                t.value.Ai();
              (this.m && this.g.length && this.g[this.g.length - 1].zi(),
                (this.u = this.bandwidth = this.mimeType = this.codecs = null),
                (this.F = !1));
            }
            ((d = Be.prototype),
              (d.P = function () {
                return this.C();
              }),
              (d.getStartTime = function () {
                return this.startTime;
              }),
              (d.Kj = function () {
                return this.endTime;
              }),
              (d.Jc = function () {
                return this.startByte;
              }),
              (d.Hc = function () {
                return this.endByte;
              }));
            function Wm(e) {
              if (e.endByte) return e.endByte + 1 - e.startByte;
              if (e.bandwidth) {
                var t = e.bandwidth * (e.endTime - e.startTime);
                if (!isNaN(t) && t > 0) return t;
              }
              if (e.g.length > 0 && e.m)
                for (e = I(e.g), e = e.next(); !e.done; e = e.next()) {
                  Wm(e.value);
                  break;
                }
              return null;
            }
            ((d.ek = function () {
              return this.tilesLayout;
            }),
              (d.dk = function () {
                return this.B;
              }),
              (d.Kc = function () {
                return this.status;
              }),
              (d.Ak = function () {
                this.status = hA;
              }),
              (d.Ug = function () {
                this.preload = !0;
              }),
              (d.isPreload = function () {
                return this.preload;
              }),
              (d.wd = function () {
                this.l = !1;
              }),
              (d.qk = function () {
                return this.l;
              }),
              (d.Ai = function () {
                this.Xc = !0;
              }),
              (d.tk = function () {
                return this.Xc;
              }),
              (d.zi = function () {
                this.je = !0;
              }),
              (d.rk = function () {
                return this.je;
              }),
              (d.xi = function () {
                this.o = !0;
              }),
              (d.kk = function () {
                return this.o;
              }),
              (d.Mf = function (e) {
                this.thumbnailSprite = e;
              }),
              (d.bk = function () {
                return this.thumbnailSprite;
              }),
              (d.offset = function (e) {
                ((this.startTime += e), (this.endTime += e), (this.j += e));
                for (var t = I(this.g), r = t.next(); !r.done; r = t.next())
                  ((r = r.value), (r.startTime += e), (r.endTime += e), (r.j += e));
              }),
              (d.Dh = function (e) {
                this.h == null
                  ? Bt("Sync attempted without sync time!")
                  : ((e = this.h - e - this.startTime), Math.abs(e) >= 0.001 && this.offset(e));
              }),
              (d.ue = function (e, t) {
                ((this.u = e), (this.F = t === void 0 ? !1 : t));
              }),
              (d.$b = function (e) {
                var t = this.u;
                return ((e === void 0 || e) && this.F && (this.u = null), t);
              }));
            function dA(e, t) {
              ((e.ea = t), (e = I(e.g)));
              for (var r = e.next(); !r.done; r = e.next()) dA(r.value, t);
            }
            (Ee("shaka.media.SegmentReference", Be),
              (Be.prototype.getSegmentData = Be.prototype.$b),
              (Be.prototype.setSegmentData = Be.prototype.ue),
              (Be.prototype.syncAgainst = Be.prototype.Dh),
              (Be.prototype.offset = Be.prototype.offset),
              (Be.prototype.getThumbnailSprite = Be.prototype.bk),
              (Be.prototype.setThumbnailSprite = Be.prototype.Mf),
              (Be.prototype.hasByterangeOptimization = Be.prototype.kk),
              (Be.prototype.markAsByterangeOptimization = Be.prototype.xi),
              (Be.prototype.isLastPartial = Be.prototype.rk),
              (Be.prototype.markAsLastPartial = Be.prototype.zi),
              (Be.prototype.isPartial = Be.prototype.tk),
              (Be.prototype.markAsPartial = Be.prototype.Ai),
              (Be.prototype.isIndependent = Be.prototype.qk),
              (Be.prototype.markAsNonIndependent = Be.prototype.wd),
              (Be.prototype.isPreload = Be.prototype.isPreload),
              (Be.prototype.markAsPreload = Be.prototype.Ug),
              (Be.prototype.markAsUnavailable = Be.prototype.Ak),
              (Be.prototype.getStatus = Be.prototype.Kc),
              (Be.prototype.getTileDuration = Be.prototype.dk),
              (Be.prototype.getTilesLayout = Be.prototype.ek),
              (Be.prototype.getEndByte = Be.prototype.Hc),
              (Be.prototype.getStartByte = Be.prototype.Jc),
              (Be.prototype.getEndTime = Be.prototype.Kj),
              (Be.prototype.getStartTime = Be.prototype.getStartTime),
              (Be.prototype.getUris = Be.prototype.P));
            var Rs = 0,
              hA = 1;
            Be.Status = { vl: Rs, Am: hA, Wl: 2 };
            function Wu(e) {
              return e.length == 1 && e.end(0) - e.start(0) < 1e-4;
            }
            function fA(e) {
              return !e || Wu(e) ? null : e.length == 1 && e.start(0) < 0 ? 0 : e.length ? e.start(0) : null;
            }
            function Lh(e) {
              return !e || Wu(e) ? null : e.length ? e.end(e.length - 1) : null;
            }
            function zm(e, t) {
              return !e || !e.length || Wu(e) || t > e.end(e.length - 1) ? !1 : t >= e.start(0);
            }
            function pA(e, t) {
              if (!e || !e.length || Wu(e)) return 0;
              var r = 0;
              e = I(Cs(e));
              for (var s = e.next(); !s.done; s = e.next()) {
                var a = s.value;
                ((s = a.start), (a = a.end), a > t && (r += a - Math.max(s, t)));
              }
              return r;
            }
            function C2(e, t, r) {
              return !e || !e.length || Wu(e)
                ? null
                : ((e = Cs(e).findIndex(function (s, a, c) {
                    return s.start > t && (a == 0 || c[a - 1].end - t <= r);
                  })),
                  e >= 0 ? e : null);
            }
            function Cs(e) {
              if (!e) return [];
              for (var t = [], r = 0; r < e.length; r++) t.push({ start: e.start(r), end: e.end(r) });
              return t;
            }
            function Ym() {}
            function gA(e, t) {
              var r = document.createElement("source");
              return ((r.src = e), (r.type = t === void 0 ? "" : t), r);
            }
            function _h(e) {
              for (var t = !1, r = e.getElementsByTagName("source"), s = r.length - 1; s >= 0; --s)
                (e.removeChild(r[s]), (t = !0));
              return (e.src && (e.removeAttribute("src"), (t = !0)), t);
            }
            function zu(e) {
              for (; e.firstChild; ) e.removeChild(e.firstChild);
            }
            function na() {
              return (
                qa ||
                (Xm ||
                  (Xm = new it(function () {
                    qa = null;
                  })),
                (qa =
                  document.getElementsByTagName("video")[0] || document.getElementsByTagName("audio")[0]) ||
                  (qa = document.createElement("video")),
                Xm.ka(1),
                qa)
              );
            }
            function L2(e, t) {
              var r, s, a, c, f;
              return W(function (g) {
                if (g.g == 1)
                  return "fonts" in document && "FontFace" in l ? _(g, document.fonts.ready, 2) : g.return();
                if (!("entries" in document.fonts)) return g.return();
                for (
                  r = function (m) {
                    m = m.entries();
                    for (var x = [], E = m.next(); E.done === !1; ) (x.push(E.value), (E = m.next()));
                    return x;
                  },
                    s = I(r(document.fonts)),
                    a = s.next();
                  !a.done;
                  a = s.next()
                )
                  if (((c = a.value), c.family === e && c.display === "swap")) return g.return();
                ((f = new FontFace(e, "url(" + t + ")", { display: "swap" })), document.fonts.add(f), K(g));
              });
            }
            (Ee("shaka.util.Dom", Ym), (Ym.removeAllChildren = zu), (Ym.clearSourceFromVideo = _h));
            var Xm = null,
              qa = null;
            /*
 @license
 Shaka Player
 Copyright 2022 Google LLC
 SPDX-License-Identifier: Apache-2.0
*/ function qm() {}
            function mA(e, t) {
              return (
                t + 10 <= e.length &&
                e[t] === 73 &&
                e[t + 1] === 68 &&
                e[t + 2] === 51 &&
                e[t + 3] < 255 &&
                e[t + 4] < 255 &&
                e[t + 6] < 128 &&
                e[t + 7] < 128 &&
                e[t + 8] < 128 &&
                e[t + 9] < 128
              );
            }
            function yA(e, t) {
              return (
                t + 10 <= e.length &&
                e[t] === 51 &&
                e[t + 1] === 68 &&
                e[t + 2] === 73 &&
                e[t + 3] < 255 &&
                e[t + 4] < 255 &&
                e[t + 6] < 128 &&
                e[t + 7] < 128 &&
                e[t + 8] < 128 &&
                e[t + 9] < 128
              );
            }
            function Qm(e, t) {
              var r = (e[t] & 127) << 21;
              return ((r |= (e[t + 1] & 127) << 14), (r |= (e[t + 2] & 127) << 7), (r |= e[t + 3] & 127));
            }
            function _2(e) {
              var t = { key: e.type, description: "", data: "", mimeType: null, pictureType: null };
              if (e.type === "APIC") {
                if (e.size < 2 || e.data[0] !== 3) return null;
                var r = e.data.subarray(1).indexOf(0);
                if (r === -1) return null;
                var s = zt(We(e.data, 1, r)),
                  a = e.data[2 + r],
                  c = e.data.subarray(3 + r).indexOf(0);
                if (c === -1) return null;
                var f = zt(We(e.data, 3 + r, c)),
                  g;
                return (
                  s === "-->" ? (g = zt(We(e.data, 4 + r + c))) : (g = ir(e.data.subarray(4 + r + c))),
                  (t.mimeType = s),
                  (t.pictureType = a),
                  (t.description = f),
                  (t.data = g),
                  t
                );
              }
              return e.type === "TXXX"
                ? e.size < 2 || e.data[0] !== 3 || ((s = e.data.subarray(1).indexOf(0)), s === -1)
                  ? null
                  : ((r = zt(We(e.data, 1, s))),
                    (e = zt(We(e.data, 2 + s)).replace(/\0*$/, "")),
                    (t.description = r),
                    (t.data = e),
                    t)
                : e.type === "WXXX"
                  ? e.size < 2 || e.data[0] !== 3 || ((s = e.data.subarray(1).indexOf(0)), s === -1)
                    ? null
                    : ((r = zt(We(e.data, 1, s))),
                      (e = zt(We(e.data, 2 + s)).replace(/\0*$/, "")),
                      (t.description = r),
                      (t.data = e),
                      t)
                  : e.type === "PRIV"
                    ? e.size < 2 || ((r = e.data.indexOf(0)), r === -1)
                      ? null
                      : ((r = zt(We(e.data, 0, r))),
                        (t.description = r),
                        r == "com.apple.streaming.transportStreamTimestamp"
                          ? ((r = e.data.subarray(r.length + 1)),
                            (e = r[3] & 1),
                            (r = (r[4] << 23) + (r[5] << 15) + (r[6] << 7) + r[7]),
                            (r /= 45),
                            e && (r += 4772185884e-2),
                            (t.data = r))
                          : ((e = ir(e.data.subarray(r.length + 1))), (t.data = e)),
                        t)
                    : e.type[0] === "T"
                      ? e.size < 2 || e.data[0] !== 3
                        ? null
                        : ((e = zt(e.data.subarray(1)).replace(/\0*$/, "")), (t.data = e), t)
                      : e.type[0] === "W"
                        ? ((e = zt(e.data).replace(/\0*$/, "")), (t.data = e), t)
                        : e.data
                          ? ((t.data = ir(e.data)), t)
                          : null;
            }
            function ia(e) {
              for (var t = 0, r = []; mA(e, t); ) {
                var s = Qm(e, t + 6);
                for ((e[t + 5] >> 6) & 1 && (t += 10), t += 10, s = t + s; t + 10 < s; ) {
                  var a = e.subarray(t),
                    c = Qm(a, 4);
                  ((a = {
                    type: String.fromCharCode(a[0], a[1], a[2], a[3]),
                    size: c,
                    data: a.subarray(10, 10 + c),
                  }),
                    (c = _2(a)) && r.push(c),
                    (t += a.size + 10));
                }
                yA(e, t) && (t += 10);
              }
              return r;
            }
            function Qa(e, t) {
              for (var r = (t = t === void 0 ? 0 : t), s = 0; mA(e, t); )
                ((e[t + 5] >> 6) & 1 && (s += 10),
                  (s += 10),
                  (s += Qm(e, t + 6)),
                  yA(e, t + 10) && (s += 10),
                  (t += s));
              return s > 0 ? e.subarray(r, r + s) : new Uint8Array([]);
            }
            (Ee("shaka.util.Id3Utils", qm), (qm.getID3Data = Qa), (qm.getID3Frames = ia));
            function vA(e) {
              return new Date(Date.UTC(1900, 0, 1, 0, 0, 0, 0) + e).getTime();
            }
            function Ls(e, t) {
              if (((this.j = e), t !== void 0 && t)) {
                t = new Uint8Array(e.byteLength);
                for (var r = 0, s = 0; s < e.byteLength; s++)
                  (s >= 2 && e[s] == 3 && e[s - 1] == 0 && e[s - 2] == 0) || ((t[r] = e[s]), r++);
                this.j = We(t, 0, r);
              }
              ((this.i = this.j.byteLength), (this.g = this.h = 0));
            }
            function Jm(e) {
              var t = e.j.byteLength - e.i,
                r = new Uint8Array(4),
                s = Math.min(4, e.i);
              s !== 0 && (r.set(e.j.subarray(t, t + s)), (e.h = new Gt(r, 0).U()), (e.g = s * 8), (e.i -= s));
            }
            function Fi(e, t) {
              if (e.g <= t) {
                t -= e.g;
                var r = Math.floor(t / 8);
                ((t -= r * 8), (e.g -= r), Jm(e));
              }
              ((e.h <<= t), (e.g -= t));
            }
            function at(e, t) {
              var r = Math.min(e.g, t),
                s = e.h >>> (32 - r);
              return (
                (e.g -= r),
                e.g > 0 ? (e.h <<= r) : e.i > 0 && Jm(e),
                (r = t - r),
                r > 0 ? (s << r) | at(e, r) : s
              );
            }
            function Zm(e) {
              var t;
              for (t = 0; t < e.g; ++t)
                if ((e.h & (2147483648 >>> t)) !== 0) return ((e.h <<= t), (e.g -= t), t);
              return (Jm(e), t + Zm(e));
            }
            function Bn(e) {
              Fi(e, 1 + Zm(e));
            }
            function De(e) {
              var t = Zm(e);
              return at(e, t + 1) - 1;
            }
            function Ja(e) {
              return ((e = De(e)), 1 & e ? (1 + e) >>> 1 : -1 * (e >>> 1));
            }
            function Oe(e) {
              return at(e, 1) === 1;
            }
            function It(e) {
              return at(e, 8);
            }
            function bh(e, t) {
              for (var r = 8, s = 8, a = 0; a < t; a++)
                (s !== 0 && ((s = Ja(e)), (s = (r + s + 256) % 256)), (r = s === 0 ? r : s));
            }
            function b2(e) {
              return (It(e), De(e), De(e));
            }
            Ee("shaka.util.ExpGolomb", Ls);
            function Ft() {
              ((this.I = null),
                (this.J = !1),
                (this.m = this.K = null),
                (this.j = []),
                (this.g = []),
                (this.C = this.F = null),
                (this.i = []),
                (this.h = []),
                (this.G = null),
                (this.l = []),
                (this.B = this.H = this.o = this.u = null));
            }
            ((d = Ft.prototype),
              (d.clearData = function () {
                ((this.j = []), (this.g = []), (this.i = []), (this.h = []), (this.l = []));
              }),
              (d.Kf = function (e) {
                (this.B != null && this.B != e && (this.o = this.u = null), (this.B = e));
              }),
              (d.parse = function (e) {
                if (e.length < 564) return this;
                for (
                  var t = Math.max(0, t0(e)), r = e.length - ((e.length + t) % 188), s = !1, a = t;
                  a < r;
                  a += 188
                )
                  if (e[a] == 71) {
                    var c = !!(e[a + 1] & 64),
                      f = ((e[a + 1] & 31) << 8) + e[a + 2];
                    if ((e[a + 3] & 48) >> 4 > 1) {
                      var g = a + 5 + e[a + 4];
                      if (g == a + 188) continue;
                    } else g = a + 4;
                    switch (f) {
                      case 0:
                        (c && (g += e[g] + 1), (this.I = ((e[g + 10] & 31) << 8) | e[g + 11]));
                        break;
                      case 17:
                      case 8191:
                        break;
                      case this.I:
                        (c && (g += e[g] + 1),
                          (c = e),
                          (f = { audio: -1, video: -1, gf: -1, audioCodec: "", videoCodec: "" }));
                        var m = g + 3 + (((c[g + 1] & 15) << 8) | c[g + 2]) - 4;
                        for (g += 12 + (((c[g + 10] & 15) << 8) | c[g + 11]); g < m; ) {
                          var x = ((c[g + 1] & 31) << 8) | c[g + 2],
                            E = ((c[g + 3] & 15) << 8) | c[g + 4];
                          switch (c[g]) {
                            case 6:
                              if (E > 0)
                                for (var A = g + 5, R = E; R > 2; ) {
                                  var b = c[A + 1] + 2;
                                  switch (c[A]) {
                                    case 5:
                                      var D = c.subarray(A + 2, A + b);
                                      ((D = Wd.value()(D)),
                                        f.audio == -1 && D === "Opus"
                                          ? ((f.audio = x), (f.audioCodec = "opus"))
                                          : f.video == -1 &&
                                            D === "AV01" &&
                                            ((f.video = x), (f.videoCodec = "av1")));
                                      break;
                                    case 106:
                                      f.audio == -1 && ((f.audio = x), (f.audioCodec = "ac3"));
                                      break;
                                    case 122:
                                      f.audio == -1 && ((f.audio = x), (f.audioCodec = "ec3"));
                                      break;
                                    case 124:
                                      f.audio == -1 && ((f.audio = x), (f.audioCodec = "aac"));
                                      break;
                                    case 127:
                                      f.audioCodec == "opus" &&
                                        ((D = null),
                                        c[A + 2] === 128 && (D = c[A + 3]),
                                        D != null &&
                                          (this.H = {
                                            channelCount: (D & 15) === 0 ? 2 : D & 15,
                                            uj: D,
                                            sampleRate: 48e3,
                                          }));
                                  }
                                  ((A += b), (R -= b));
                                }
                              break;
                            case 15:
                              f.audio == -1 && ((f.audio = x), (f.audioCodec = "aac"));
                              break;
                            case 17:
                              f.audio == -1 && ((f.audio = x), (f.audioCodec = "aac-loas"));
                              break;
                            case 21:
                              f.gf == -1 && (f.gf = x);
                              break;
                            case 27:
                              f.video == -1 && ((f.video = x), (f.videoCodec = "avc"));
                              break;
                            case 3:
                            case 4:
                              f.audio == -1 && ((f.audio = x), (f.audioCodec = "mp3"));
                              break;
                            case 36:
                              f.video == -1 && ((f.video = x), (f.videoCodec = "hvc"));
                              break;
                            case 129:
                              f.audio == -1 && ((f.audio = x), (f.audioCodec = "ac3"));
                              break;
                            case 132:
                            case 135:
                              f.audio == -1 && ((f.audio = x), (f.audioCodec = "ec3"));
                          }
                          g += E + 5;
                        }
                        ((c = f),
                          c.video != -1 && ((this.K = c.video), (this.m = c.videoCodec)),
                          c.audio != -1 && ((this.F = c.audio), (this.C = c.audioCodec)),
                          c.gf != -1 && (this.G = c.gf),
                          s && !this.J && ((s = !1), (a = t - 188)),
                          (this.J = !0));
                        break;
                      case this.K:
                        ((g = e.subarray(g, a + 188)),
                          c
                            ? this.j.push([g])
                            : this.j.length &&
                              this.j[this.j.length - 1] &&
                              this.j[this.j.length - 1].push(g));
                        break;
                      case this.F:
                        ((g = e.subarray(g, a + 188)),
                          c
                            ? this.i.push([g])
                            : this.i.length &&
                              this.i[this.i.length - 1] &&
                              this.i[this.i.length - 1].push(g));
                        break;
                      case this.G:
                        ((g = e.subarray(g, a + 188)),
                          c
                            ? this.l.push([g])
                            : this.l.length &&
                              this.l[this.l.length - 1] &&
                              this.l[this.l.length - 1].push(g));
                        break;
                      default:
                        s = !0;
                    }
                  }
                return this;
              }));
            function e0(e, t) {
              if (((t[0] << 16) | (t[1] << 8) | t[2]) !== 1) return null;
              var r = {
                data: new Uint8Array(0),
                packetLength: (t[4] << 8) | t[5],
                pts: null,
                dts: null,
                nalus: [],
              };
              if (r.packetLength && r.packetLength > t.byteLength - 6) return null;
              var s = t[7];
              if (s & 192) {
                var a =
                  (t[9] & 14) * 536870912 +
                  (t[10] & 255) * 4194304 +
                  (t[11] & 254) * 16384 +
                  (t[12] & 255) * 128 +
                  (t[13] & 254) / 2;
                (e.u == null && (e.u = a),
                  (r.pts = TA(a, e.u)),
                  (e.u = r.pts),
                  (r.dts = r.pts),
                  s & 64 &&
                    ((s =
                      (t[14] & 14) * 536870912 +
                      (t[15] & 255) * 4194304 +
                      (t[16] & 254) * 16384 +
                      (t[17] & 255) * 128 +
                      (t[18] & 254) / 2),
                    e.o == null && (e.o = s),
                    (r.dts = r.pts != a ? TA(s, e.o) : s)),
                  (e.o = r.dts));
              }
              return ((e = t[8] + 9), t.byteLength <= e ? null : ((r.data = t.subarray(e)), r));
            }
            ((d.Hk = function (e) {
              return (
                ft("TsParser.parseAvcNalus", "Please use parseNalus function instead."),
                this.$g(e, { le: null, state: null })
              );
            }),
              (d.$g = function (e, t) {
                var r = e.pts ? e.pts / 9e4 : null;
                e = e.data;
                var s = e.byteLength,
                  a = 1;
                this.m == "hvc" && (a = 2);
                var c = t.state || 0,
                  f = c,
                  g = 0,
                  m = [],
                  x = -1,
                  E = 0;
                for (
                  c == -1 &&
                  ((x = 0), (E = this.m == "hvc" ? (e[0] >> 1) & 63 : e[0] & 31), (c = 0), (g = 1));
                  g < s;
                ) {
                  var A = e[g++];
                  c
                    ? c === 1
                      ? (c = A ? 0 : 2)
                      : A
                        ? A == 1
                          ? ((A = g - c - 1),
                            x >= 0
                              ? m.push({
                                  data: e.subarray(x + a, A),
                                  fullData: e.subarray(x, A),
                                  type: E,
                                  time: r,
                                  state: null,
                                })
                              : (c = m.length ? m[m.length - 1] : t.le) &&
                                (f &&
                                  g <= 4 - f &&
                                  c.state &&
                                  ((c.data = c.data.subarray(0, c.data.byteLength - f)),
                                  (c.fullData = c.fullData.subarray(0, c.fullData.byteLength - f))),
                                A > 0 &&
                                  ((A = e.subarray(0, A)),
                                  (c.data = dn(c.data, A)),
                                  (c.fullData = dn(c.fullData, A)),
                                  (c.state = 0))),
                            g < s
                              ? ((E = this.m == "hvc" ? (e[g] >> 1) & 63 : e[g] & 31), (x = g), (c = 0))
                              : (c = -1))
                          : (c = 0)
                        : (c = 3)
                    : (c = A ? 0 : 1);
                }
                return (
                  x >= 0 &&
                    c >= 0 &&
                    m.push({
                      data: e.subarray(x + a, s),
                      fullData: e.subarray(x, s),
                      type: E,
                      time: r,
                      state: c,
                    }),
                  !m.length &&
                    t.le &&
                    (r = m.length ? m[m.length - 1] : t.le) &&
                    ((r.data = dn(r.data, e)), (r.fullData = dn(r.fullData, e))),
                  (t.state = c),
                  m
                );
              }),
              (d.getMetadata = function () {
                for (var e = [], t = I(this.l), r = t.next(); !r.done; r = t.next())
                  ((r = dn.apply(Hn, V(r.value))),
                    (r = e0(this, r)) &&
                      e.push({
                        cueTime: r.pts ? r.pts / 9e4 : null,
                        data: r.data,
                        frames: ia(r.data),
                        dts: r.dts,
                        pts: r.pts,
                      }));
                return e;
              }),
              (d.ub = function () {
                if (this.i.length && !this.h.length)
                  for (var e = I(this.i), t = e.next(); !t.done; t = e.next()) {
                    var r = dn.apply(Hn, V(t.value)),
                      s = e0(this, r);
                    ((t = this.h.length ? this.h[this.h.length - 1] : null),
                      s && s.pts != null && s.dts != null && (!t || (t.pts != s.pts && t.dts != s.dts))
                        ? this.h.push(s)
                        : this.h.length &&
                          (r = s ? s.data : r) &&
                          ((t = this.h.pop()), (t.data = dn(t.data, r)), this.h.push(t)));
                  }
                return this.h;
              }),
              (d.ud = function (e) {
                if (((e = e === void 0 ? !0 : e), this.j.length && !this.g.length)) {
                  for (var t = I(this.j), r = t.next(); !r.done; r = t.next()) {
                    var s = dn.apply(Hn, V(r.value)),
                      a = e0(this, s);
                    ((r = this.g.length ? this.g[this.g.length - 1] : null),
                      a && a.pts != null && a.dts != null && (!r || (r.pts != a.pts && r.dts != a.dts))
                        ? this.g.push(a)
                        : this.g.length &&
                          (s = a ? a.data : s) &&
                          ((r = this.g.pop()), (r.data = dn(r.data, s)), this.g.push(r)));
                  }
                  if (e) {
                    for (
                      t = { le: null, state: null }, r = [], s = I(this.g), a = s.next();
                      !a.done;
                      a = s.next()
                    )
                      ((a = a.value),
                        (a.nalus = this.$g(a, t)),
                        a.nalus.length && (r.push(a), (t.le = a.nalus[a.nalus.length - 1])));
                    this.g = r;
                  }
                }
                return e ? this.g : ((e = this.g), (this.g = []), e);
              }),
              (d.getStartTime = function (e) {
                if (e == "audio") {
                  e = null;
                  var t = this.ub();
                  return (t.length && ((e = t[0]), (e = Math.min(e.dts, e.pts) / 9e4)), e);
                }
                return e == "video"
                  ? ((e = null),
                    (t = this.ud(!1)),
                    t.length && ((e = t[0]), (e = Math.min(e.dts, e.pts) / 9e4)),
                    e)
                  : null;
              }),
              (d.Yd = function () {
                return { audio: this.C, video: this.m };
              }),
              (d.ef = function () {
                for (var e = [], t = I(this.ud()), r = t.next(); !r.done; r = t.next())
                  e.push.apply(e, V(r.value.nalus));
                return e;
              }),
              (d.hk = function () {
                ft("TsParser.getVideoResolution", "Please use getVideoInfo function instead.");
                var e = this.Ng();
                return { height: e.height, width: e.width };
              }),
              (d.Ng = function () {
                return this.m == "hvc" ? k2(this) : D2(this);
              }));
            function xA(e) {
              var t = e.ud();
              return t.length > 1 && ((e = t[0].pts), (t = t[1].pts), !isNaN(t - e))
                ? String(Math.abs((1 / (t - e)) * 9e4))
                : null;
            }
            function D2(e) {
              var t = { height: null, width: null, codec: null, frameRate: null },
                r = e.ef();
              if (
                !r.length ||
                ((r = r.find(function (b) {
                  return b.type == 7;
                })),
                !r)
              )
                return t;
              r = new Ls(r.data);
              var s = It(r),
                a = It(r),
                c = It(r);
              if ((Bn(r), M2.includes(s))) {
                var f = De(r);
                if ((f === 3 && Fi(r, 1), Bn(r), Bn(r), Fi(r, 1), Oe(r))) {
                  f = f !== 3 ? 8 : 12;
                  for (var g = 0; g < f; g++) Oe(r) && (g < 6 ? bh(r, 16) : bh(r, 64));
                }
              }
              if ((Bn(r), (f = De(r)), f === 0)) De(r);
              else if (f === 1) for (Fi(r, 1), Bn(r), Bn(r), f = De(r), g = 0; g < f; g++) Bn(r);
              (Bn(r), Fi(r, 1), (f = De(r)), (g = De(r)));
              var m = at(r, 1);
              (m === 0 && Fi(r, 1), Fi(r, 1));
              var x = 0,
                E = 0,
                A = 0,
                R = 0;
              return (
                Oe(r) && ((x = De(r)), (E = De(r)), (A = De(r)), (R = De(r))),
                (t.height = String((2 - m) * (g + 1) * 16 - A * 2 - R * 2)),
                (t.width = String((f + 1) * 16 - x * 2 - E * 2)),
                (t.codec =
                  "avc1." +
                  ("0" + s.toString(16).toUpperCase()).slice(-2) +
                  ("0" + a.toString(16).toUpperCase()).slice(-2) +
                  ("0" + c.toString(16).toUpperCase()).slice(-2)),
                (t.frameRate = xA(e)),
                t
              );
            }
            function k2(e) {
              var t = { height: null, width: null, codec: null, frameRate: null },
                r = e.ef();
              if (
                !r.length ||
                ((r = r.find(function (ne) {
                  return ne.type == 33;
                })),
                !r)
              )
                return t;
              var s = new Ls(r.fullData, !0);
              (It(s), It(s), at(s, 4));
              var a = at(s, 3);
              Oe(s);
              var c = at(s, 2),
                f = at(s, 1),
                g = at(s, 5),
                m = at(s, 32);
              r = It(s);
              for (
                var x = It(s), E = It(s), A = It(s), R = It(s), b = It(s), D = It(s), M = [], P = [], G = 0;
                G < a;
                G++
              )
                (M.push(Oe(s)), P.push(Oe(s)));
              if (a > 0) for (G = a; G < 8; G++) at(s, 2);
              for (G = 0; G < a; G++) (M[G] && at(s, 88), P[G] && It(s));
              (De(s), (a = De(s)), a == 3 && at(s, 1), (M = De(s)), (P = De(s)));
              var U = (G = 0),
                H = 0,
                Q = 0;
              return (
                Oe(s) && ((G += De(s)), (U += De(s)), (H += De(s)), (Q += De(s))),
                (t.width = String(M - (G + U) * (a === 1 || a === 2 ? 2 : 1))),
                (t.height = String(P - (H + Q) * (a === 1 ? 2 : 1))),
                (s = (function (ne) {
                  for (var z = 0, J = 0; J < 32; J++) z |= ((ne >> J) & 1) << (31 - J);
                  return z >>> 0;
                })(m)),
                (f = f == 1 ? "H" : "L"),
                (c = "hvc1" + ("." + ["", "A", "B", "C"][c] + g)),
                (c += "." + s.toString(16).toUpperCase()),
                (c += "." + f + D),
                b && (c += "." + b.toString(16).toUpperCase()),
                R && (c += "." + R.toString(16).toUpperCase()),
                A && (c += "." + A.toString(16).toUpperCase()),
                E && (c += "." + E.toString(16).toUpperCase()),
                x && (c += "." + x.toString(16).toUpperCase()),
                r && (c += "." + r.toString(16).toUpperCase()),
                (t.codec = c),
                (t.frameRate = xA(e)),
                t
              );
            }
            function TA(e, t) {
              var r = 1;
              for (e > t && (r = -1); Math.abs(t - e) > 4294967296; ) e += r * 8589934592;
              return e;
            }
            function Za(e) {
              return !(t0(e) < 0);
            }
            function t0(e) {
              for (var t = Math.min(1e3, e.length - 564), r = 0; r < t; ) {
                if (e[r] == 71 && e[r + 188] == 71 && e[r + 376] == 71) return r;
                r++;
              }
              return -1;
            }
            (Ee("shaka.util.TsParser", Ft),
              (Ft.syncOffset = t0),
              (Ft.probe = Za),
              (Ft.prototype.getVideoInfo = Ft.prototype.Ng),
              (Ft.prototype.getVideoResolution = Ft.prototype.hk),
              (Ft.prototype.getVideoNalus = Ft.prototype.ef),
              (Ft.prototype.getCodecs = Ft.prototype.Yd),
              (Ft.prototype.getStartTime = Ft.prototype.getStartTime),
              (Ft.prototype.getVideoData = Ft.prototype.ud),
              (Ft.prototype.getAudioData = Ft.prototype.ub),
              (Ft.prototype.getMetadata = Ft.prototype.getMetadata),
              (Ft.prototype.parseNalus = Ft.prototype.$g),
              (Ft.prototype.parseAvcNalus = Ft.prototype.Hk),
              (Ft.prototype.parse = Ft.prototype.parse),
              (Ft.prototype.setDiscontinuitySequence = Ft.prototype.Kf),
              (Ft.prototype.clearData = Ft.prototype.clearData),
              (Ft.Timescale = 9e4));
            var M2 = [100, 110, 122, 244, 44, 83, 86, 118, 128, 138, 139, 134];
            function SA(e, t, r, s, a) {
              var c = this;
              ((this.g = e),
                (this.O = r),
                (this.B = s),
                (this.ba = t),
                (this.l = new Map()),
                (this.G = new Map()),
                (this.Ta = new Map()),
                (this.h = null),
                (this.Fa = !1),
                (this.C = a || null),
                (this.o = new Map()),
                (this.u = new gt()),
                (this.j = new Map()),
                (this.K = null),
                (this.M = new _t()),
                (this.Da = ""),
                (this.ob = !1),
                (this.za = !0),
                (this.N = !1),
                (this.F = this.R = null),
                (this.i = n0(this, this.M)),
                (this.Ua = this.H = !1),
                (this.I = new Ka(function () {
                  return N2(c);
                })),
                (this.J = !1),
                (this.X = "UNKNOWN"),
                (this.eb = this.kb = !1),
                (this.ab = new _t()),
                (this.m = !1),
                (this.ya = null),
                (this.$ = new Map()),
                (this.oa = this.T = this.va = this.V = null),
                (this.ma = new _t()),
                this.g.remote &&
                  ((this.N = this.g.remote.state != "disconnected"),
                  this.u.D(this.g.remote, "connect", function () {
                    c.N = c.g.remote.state != "disconnected";
                  }),
                  this.u.D(this.g.remote, "connecting", function () {
                    c.N = c.g.remote.state != "disconnected";
                  }),
                  this.u.D(this.g.remote, "disconnect", function () {
                    c.N = c.g.remote.state != "disconnected";
                  })));
            }
            function n0(e, t) {
              if (((e.za = !0), l.ManagedMediaSource)) {
                e.F || (e.g.disableRemotePlayback = !0);
                var r = new ManagedMediaSource();
                (e.u.D(r, "startstreaming", function () {
                  e.za = !0;
                }),
                  e.u.D(r, "endstreaming", function () {
                    e.za = !1;
                  }));
              } else r = new MediaSource();
              return (
                e.u.Aa(r, "sourceopen", function () {
                  (URL.revokeObjectURL(e.Da), t.resolve());
                }),
                e.u.Aa(e.g, "playing", function () {
                  e.ob = !0;
                }),
                (e.Da = o0(r)),
                e.B.useSourceElements
                  ? (e.g.removeAttribute("src"),
                    e.R && e.g.removeChild(e.R),
                    e.F && e.g.removeChild(e.F),
                    (e.R = gA(e.Da)),
                    e.g.appendChild(e.R),
                    e.F && e.g.appendChild(e.F),
                    e.g.load())
                  : (e.g.src = e.Da),
                r
              );
            }
            function P2(e, t, r) {
              e.g &&
                l.ManagedMediaSource &&
                e.i &&
                e.B.useSourceElements &&
                (e.F && e.g.removeChild(e.F),
                (e.F = gA(t, r)),
                e.g.appendChild(e.F),
                (e.g.disableRemotePlayback = !1));
            }
            function O2() {
              var e =
                  'video/mp4; codecs="avc1.42E01E",video/mp4; codecs="avc3.42E01E",video/mp4; codecs="hev1.1.6.L93.90",video/mp4; codecs="hvc1.1.6.L93.90",video/mp4; codecs="hev1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="hvc1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="hvc1.2.20000000.L153.B0",video/mp4; codecs="hvc1.2.4.L120.b0",video/mp4; codecs="hvc1.2.4.L123.b0",video/mp4; codecs="vp9",video/mp4; codecs="vp09.00.10.08",video/mp4; codecs="av01.0.01M.08",video/mp4; codecs="av01.0.31M.10.0.111.09.16.09.0",video/mp4; codecs="av01.0.31M.10.0.112.09.18.09.0",video/mp4; codecs="dvh1.05.01",video/mp4; codecs="dvh1.08.01",video/mp4; codecs="dav1.10.01",video/mp4; codecs="dvh1.20.01",audio/mp4; codecs="mp4a.40.2",audio/mp4; codecs="ac-3",audio/mp4; codecs="ec-3",audio/mp4; codecs="ac-4.02.01.03",audio/mp4; codecs="opus",audio/mp4; codecs="flac",audio/mp4; codecs="dtsc",audio/mp4; codecs="dtse",audio/mp4; codecs="dtsx",audio/mp4; codecs="apac.31.00",video/webm; codecs="vp8",video/webm; codecs="vp9",video/webm; codecs="vp09.00.10.08",audio/webm; codecs="vorbis",audio/webm; codecs="opus",video/mp2t; codecs="avc1.42E01E",video/mp2t; codecs="avc3.42E01E",video/mp2t; codecs="hvc1.1.6.L93.90",video/mp2t; codecs="mp4a.40.2",video/mp2t; codecs="ac-3",video/mp2t; codecs="ec-3",text/vtt,application/mp4; codecs="wvtt",application/ttml+xml,application/mp4; codecs="stpp"'
                    .split(",")
                    .concat(V(Ss)),
                t = {};
              (tt(), (e = I(e)));
              for (var r = e.next(); !r.done; r = e.next()) {
                if (((r = r.value), Mu(r))) t[r] = !0;
                else if (es()) {
                  var s = Pi(r),
                    a = Fu(Ei(r), s);
                  ((s = tn(s, a)), (t[r] = ti(s) || !!$a(s)));
                } else t[r] = na().canPlayType(r) != "";
                ((s = r.split(";")[0]), (t[s] = t[s] || t[r]));
              }
              return t;
            }
            ((d = SA.prototype),
              (d.destroy = function () {
                return this.I.destroy();
              }));
            function N2(e) {
              var t, r, s, a, c, f, g, m, x, E, A, R, b, D, M;
              return W(function (P) {
                if (P.g == 1) {
                  for (t = [], r = I(e.o), s = r.next(); !s.done; s = r.next())
                    for (
                      a = s.value,
                        c = I(a),
                        f = c.next().value,
                        g = c.next().value,
                        m = g[0],
                        x = f,
                        e.o.set(x, g.slice(0, 1)),
                        m && t.push(m.p.catch(EP)),
                        E = I(g.slice(1)),
                        A = E.next();
                      !A.done;
                      A = E.next()
                    )
                      ((R = A.value), R.p.reject(new ee(2, 7, 7003, void 0)));
                  return (e.h && t.push(e.h.destroy()), _(P, Promise.all(t), 2));
                }
                for (b = I(e.j.values()), D = b.next(); !D.done; D = b.next()) ((M = D.value), M.destroy());
                (e.u && (e.u.release(), (e.u = null)),
                  e.g && e.F && e.g.removeChild(e.F),
                  e.g && e.R && (e.g.removeChild(e.R), e.g.load(), (e.g.disableRemotePlayback = !1)),
                  (e.g = null),
                  (e.R = null),
                  (e.F = null),
                  (e.B = null),
                  (e.i = null),
                  (e.h = null),
                  (e.ba = null),
                  e.l.clear(),
                  e.Ta.clear(),
                  e.j.clear(),
                  (e.K = null),
                  e.o.clear(),
                  (e.C = null),
                  e.$.clear(),
                  (e.O = null),
                  K(P));
              });
            }
            d.init = function (e, t, r, s) {
              ((t = t === void 0 ? !1 : t), (r = r === void 0 ? "UNKNOWN" : r), (s = s === void 0 ? !1 : s));
              var a = this,
                c,
                f,
                g,
                m,
                x,
                E;
              return W(function (A) {
                if (A.g == 1) return ((c = hn), _(A, a.M, 2));
                if (A.g != 3)
                  return !ra(a) && !uo(a)
                    ? A.A(3)
                    : (Bt("Expected MediaSource to be open during init(); reopening the media source."),
                      (a.M = new _t()),
                      (a.i = n0(a, a.M)),
                      _(A, a.M, 3));
                for (
                  a.J = t,
                    a.X = r,
                    a.kb = s,
                    a.eb = !a.J && a.X == "HLS" && !a.kb,
                    a.$.clear(),
                    a.V = null,
                    a.va = null,
                    a.T = null,
                    a.oa = null,
                    a.ma = new _t(),
                    f = I(e.keys()),
                    g = f.next();
                  !g.done;
                  g = f.next()
                )
                  ((m = g.value),
                    (x = e.get(m)),
                    Dh(a, m, x, x.codecs),
                    a.m ? (a.o.set(c.aa, []), a.o.set(c.wa, [])) : a.o.set(m, []));
                ((E = e.get(c.aa)) && E.isAudioMuxedInVideo && (a.m = !0), K(A));
              });
            };
            function Dh(e, t, r, s) {
              t == "audio" && s && (s = Fu(s, r.mimeType));
              var a = tn(r.mimeType, s);
              if (t == nt) kh(e, a, e.J, r.external);
              else {
                var c = e.B.forceTransmux;
                (!ti(a) || (!e.J && Ss.includes(a))) && (c = !0);
                var f = sh(r.mimeType, s);
                if (c) {
                  if (
                    ((c = Si("audio", (s || "").split(","))), (s = Si("video", (s || "").split(","))), c && s)
                  ) {
                    ((e.m = !0), Dh(e, "audio", r, c), Dh(e, "video", r, s));
                    return;
                  }
                  (s = $a(f)) && ((a = s()), e.j.set(t, a), (a = a.convertCodecs(t, f)));
                }
                ((f = a + e.B.addExtraFeaturesToSourceBuffer(a)), Nt(e.I));
                try {
                  var g = e.i.addSourceBuffer(f);
                } catch (m) {
                  throw new ee(
                    2,
                    3,
                    3015,
                    m,
                    "The mediaSource_ status was " + e.i.readyState + " expected 'open'",
                    null,
                  );
                }
                (e.J && (g.mode = X2),
                  e.u.D(g, "error", function () {
                    var m = e.o.get(t)[0];
                    m.p.reject(new ee(2, 3, 3014, e.g.error ? e.g.error.code : 0, m.uri));
                  }),
                  e.u.D(g, "updateend", function () {
                    return co(e, t);
                  }),
                  e.l.set(t, g),
                  e.G.set(t, a),
                  e.Ta.set(t, !!r.drmInfos.length));
              }
            }
            d.configure = function (e) {
              ((this.B = e), this.h && (this.h.B = e.modifyCueCallback));
            };
            function EA(e) {
              return e.za && !e.N && !e.H;
            }
            function kh(e, t, r, s) {
              e.h || ((e.h = new Es(e.ba)), e.h && (e.h.B = e.B.modifyCueCallback));
              var a = e.h;
              ((s = s || e.Fa),
                (e = e.X),
                t == "application/cea-608" || t == "application/cea-708"
                  ? (a.i = null)
                  : ((a.i = Pu.get(t)()),
                    a.i.setSequenceMode
                      ? a.i.setSequenceMode(r)
                      : ft(
                          "Text parsers w/ setSequenceMode",
                          'Text parsers should have a "setSequenceMode" method!',
                        ),
                    a.i.setManifestType
                      ? a.i.setManifestType(e)
                      : ft(
                          "Text parsers w/ setManifestType",
                          'Text parsers should have a "setManifestType" method!',
                        ),
                    (a.C = s)));
            }
            function ra(e) {
              return e.H ? !1 : e.i ? e.i.readyState == "ended" : !0;
            }
            function uo(e) {
              return e.H ? !1 : e.i ? e.i.readyState == "closed" : !0;
            }
            function i0(e, t) {
              return e.l.size ? (t == nt ? e.h.g : fA(el(e, t))) : null;
            }
            function sa(e, t) {
              return e.l.size ? (t == nt ? e.h.h : Lh(el(e, t))) : null;
            }
            function F2(e, t, r) {
              return t == nt
                ? ((e = e.h), e.h == null || e.h < r ? 0 : e.h - Math.max(r, e.g))
                : ((e = el(e, t)), pA(e, r));
            }
            d.Gc = function () {
              var e = {
                total: this.H ? [] : Cs(this.g.buffered),
                audio: Cs(el(this, "audio")),
                video: Cs(el(this, "video")),
                text: [],
              };
              if (this.h) {
                var t = this.h.g,
                  r = this.h.h;
                t != null && r != null && e.text.push({ start: t, end: r });
              }
              return e;
            };
            function el(e, t) {
              if (e.H || e.N || uo(e)) return null;
              try {
                return e.l.get(t).buffered;
              } catch (r) {
                return (e.l.has(t), null);
              }
            }
            function U2(e, t, r, s, a, c, f) {
              f = f === void 0 ? !1 : f;
              var g = null,
                m = [],
                x = We(r);
              if (Ss.includes(c))
                ((r = ia(x)),
                  r.length &&
                    s &&
                    ((f = r.find(function (D) {
                      return D.description === "com.apple.streaming.transportStreamTimestamp";
                    })) &&
                      typeof f.data == "number" &&
                      (g = Math.round(f.data) / 1e3),
                    e.O.onMetadata(
                      [{ cueTime: s.startTime, data: x, frames: r, dts: s.startTime, pts: s.startTime }],
                      0,
                      s.endTime,
                    )));
              else if (c.includes("/mp4") && s && s.ea) {
                x = new bt();
                var E =
                  (a.emsgSchemeIdUris != null && a.emsgSchemeIdUris.length > 0) || e.B.dispatchAllEmsgBoxes;
                E &&
                  x.S("emsg", function (D) {
                    var M = a.emsgSchemeIdUris;
                    if (D.version === 0)
                      var P = D.reader.Yc(),
                        G = D.reader.Yc(),
                        U = D.reader.U(),
                        H = D.reader.U(),
                        Q = D.reader.U(),
                        ne = D.reader.U(),
                        z = s.startTime + H / U;
                    else
                      ((U = D.reader.U()),
                        (z = D.reader.Ed() / U + s.timestampOffset),
                        (H = z - s.startTime),
                        (Q = D.reader.U()),
                        (ne = D.reader.U()),
                        (P = D.reader.Yc()),
                        (G = D.reader.Yc()));
                    ((D = D.reader.Tb(D.reader.getLength() - D.reader.Pa(), !0)),
                      ((M && M.includes(P)) || e.B.dispatchAllEmsgBoxes) &&
                        (P == "urn:mpeg:dash:event:2012"
                          ? e.O.Gk()
                          : ((M = z + Q / U),
                            e.O.Ek({
                              startTime: z,
                              endTime: M,
                              schemeIdUri: P,
                              value: G,
                              timescale: U,
                              presentationTimeDelta: H,
                              eventDuration: Q,
                              id: ne,
                              messageData: D,
                            }),
                            (P == "https://aomedia.org/emsg/ID3" ||
                              P == "https://developer.apple.com/streaming/emsg-id3") &&
                              ((U = ia(D)),
                              U.length &&
                                e.O.onMetadata(
                                  [{ cueTime: z, data: D, frames: U, dts: z, pts: z }],
                                  0,
                                  M,
                                )))));
                  });
                var A = s.ea.timescale;
                t = A && !isNaN(A);
                var R = 0,
                  b = !1;
                (t &&
                  x
                    .S("prft", function (D) {
                      var M = D.reader,
                        P = D.version;
                      (M.U(), (D = M.U()));
                      var G = M.U();
                      ((D = D * 1e3 + (G / 4294967296) * 1e3),
                        P === 0 ? (M = M.U()) : ((P = M.U()), (M = M.U()), (M = P * 4294967296 + M)),
                        (D = vA(D)),
                        (M = new Map().set("detail", {
                          wallClockTime: D,
                          programStartDate: new Date(D - (M / A) * 1e3),
                        })),
                        (M = new Me("prft", M)),
                        e.O.onEvent(M));
                    })
                    .box("moof", Ze)
                    .box("traf", Ze)
                    .S("tfdt", function (D) {
                      b ||
                        ((R = Ih(D.reader, D.version).baseMediaDecodeTime / A),
                        (b = !0),
                        E || D.parser.stop());
                    }),
                  (E || t) && x.parse(r, !1, f),
                  b && s.timestampOffset == 0 && (g = R));
              } else
                c.includes("/mp4") ||
                  c.includes("/webm") ||
                  !Za(x) ||
                  (e.$.has(t) || e.$.set(t, new Ft()),
                  (m = e.$.get(t)),
                  m.clearData(),
                  m.Kf(s.i),
                  m.parse(x),
                  (x = m.getStartTime(t)),
                  x != null && (g = x),
                  (m = m.getMetadata()));
              return { timestamp: g, metadata: m };
            }
            function Mh(e, t, r, s, a, c, f, g, m, x, E) {
              ((f = f === void 0 ? !1 : f),
                (g = g === void 0 ? !1 : g),
                (m = m === void 0 ? !1 : m),
                (x = x === void 0 ? !1 : x));
              var A, R, b, D, M, P, G, U, H, Q, ne, z, J, X, ie, Z, re, se, me, fe;
              return W(function (le) {
                switch (le.g) {
                  case 1:
                    if (((A = hn), t != A.Na)) {
                      le.A(2);
                      break;
                    }
                    if (e.X != "HLS") {
                      le.A(3);
                      break;
                    }
                    return _(le, e.ab, 4);
                  case 4:
                    ((R = le.h), (e.h.u = R));
                  case 3:
                    return _(
                      le,
                      yP(e.h, r, s ? s.startTime : null, s ? s.endTime : null, s ? s.P()[0] : null),
                      5,
                    );
                  case 5:
                    return le.return();
                  case 2:
                    if (x || !e.m) {
                      le.A(6);
                      break;
                    }
                    return _(le, Mh(e, A.aa, r, s, a, c, f, g, m, !0), 7);
                  case 7:
                    return _(le, Mh(e, A.wa, r, s, a, c, f, g, m, !0), 8);
                  case 8:
                    return le.return();
                  case 6:
                    if (!e.l.has(t)) return le.return();
                    if (
                      ((b = e.l.get(t).timestampOffset),
                      (D = e.G.get(t)),
                      e.j.has(t) && (D = e.j.get(t).getOriginalMimeType()),
                      s &&
                        ((M = U2(e, t, r, s, a, D, m)),
                        (P = M.timestamp),
                        (G = M.metadata),
                        P != null &&
                          (e.V == null &&
                            t == A.wa &&
                            ((e.V = P),
                            (e.va = s.startTime),
                            e.T != null && ((U = 0), e.va == e.oa && (U = e.V - e.T), e.ma.resolve(U))),
                          e.T == null &&
                            t == A.aa &&
                            ((e.T = P),
                            (e.oa = s.startTime),
                            e.V != null && ((H = 0), e.va == e.oa && (H = e.V - e.T), e.ma.resolve(H))),
                          (Q = P),
                          (ne = Ss),
                          !e.J && ne.includes(e.G.get(t)) && (Q = 0),
                          (z = s.startTime - Q),
                          (J = Math.abs(b - z)),
                          (J >= 0.001 || f || g) &&
                            (!m || z > 0 || !b) &&
                            ((b = z),
                            e.eb &&
                              (xn(
                                e,
                                t,
                                function () {
                                  return tl(e, t);
                                },
                                null,
                              ),
                              xn(
                                e,
                                t,
                                function () {
                                  return nl(e, t, b);
                                },
                                null,
                              ))),
                          (t == A.wa || !e.l.has(A.wa)) && e.ab.resolve(b)),
                        G.length) &&
                        e.O.onMetadata(G, b, s ? s.endTime : null),
                      c &&
                        t == A.wa &&
                        (e.h || kh(e, "application/cea-608", e.J, !1),
                        e.K || ((X = D.split(";", 1)[0]), (e.K = new Ur(X))),
                        s ? ((ie = e.K.Af(r)), ie.length && xP(e.h, ie, b)) : e.K.init(r, g, E)),
                      !e.j.has(t))
                    ) {
                      le.A(9);
                      break;
                    }
                    return _(le, e.j.get(t).transmux(r, a, s, e.i.duration, t), 10);
                  case 10:
                    ((Z = le.h),
                      ArrayBuffer.isView(Z)
                        ? (r = Z)
                        : ((re = Z),
                          re.init != null &&
                            ((se = re.init),
                            xn(
                              e,
                              t,
                              function () {
                                (e.C && Yd(e.C, se, b, a), e.l.get(t).appendBuffer(se));
                              },
                              s ? s.P()[0] : null,
                            )),
                          (r = re.data)));
                  case 9:
                    if (((r = H2(e, a, r, s, t)), !s || !e.J || t == A.Na)) {
                      le.A(11);
                      break;
                    }
                    if (!f && !g) {
                      le.A(11);
                      break;
                    }
                    if (((me = s.startTime), e.X != "HLS" || e.m || t != A.aa || !e.l.has(A.wa))) {
                      le.A(13);
                      break;
                    }
                    return _(le, e.ma, 14);
                  case 14:
                    ((fe = le.h), Math.abs(fe) > 0.15 && (me -= fe));
                  case 13:
                    (xn(
                      e,
                      t,
                      function () {
                        return tl(e, t);
                      },
                      null,
                    ),
                      xn(
                        e,
                        t,
                        function () {
                          return nl(e, t, me);
                        },
                        null,
                      ));
                  case 11:
                    return _(
                      le,
                      xn(
                        e,
                        t,
                        function () {
                          var ue = r;
                          (e.C && Yd(e.C, ue, b, a), e.l.get(t).appendBuffer(ue));
                        },
                        s ? s.P()[0] : null,
                      ),
                      15,
                    );
                  case 15:
                    K(le);
                }
              });
            }
            function B2(e, t) {
              var r = sa(e, "video") || 0;
              uE(e.h, t, r);
            }
            function $2(e) {
              e.h && uE(e.h, "", 0);
            }
            d.remove = function (e, t, r, s) {
              var a = this,
                c,
                f;
              return W(function (g) {
                return g.g == 1
                  ? ((c = hn),
                    e == c.wa && a.K && (a.K.remove(s), (f = a.h.g || 0), a.h.remove(f, r, !0)),
                    e == c.Na
                      ? _(g, a.h.remove(t, r), 0)
                      : r > t
                        ? _(
                            g,
                            xn(
                              a,
                              e,
                              function () {
                                return Ph(a, e, t, r);
                              },
                              null,
                            ),
                            5,
                          )
                        : g.A(0))
                  : a.m
                    ? _(
                        g,
                        xn(
                          a,
                          c.aa,
                          function () {
                            return Ph(a, c.aa, t, r);
                          },
                          null,
                        ),
                        0,
                      )
                    : g.A(0);
              });
            };
            function AA(e, t) {
              var r;
              return W(function (s) {
                return s.g == 1
                  ? ((r = hn),
                    t == r.Na
                      ? e.h
                        ? _(s, e.h.remove(0, 1 / 0), 0)
                        : s.return()
                      : t === r.wa && e.K && e.h
                        ? _(s, e.h.remove(0, 1 / 0, !0), 4)
                        : s.A(4))
                  : s.g != 6
                    ? _(
                        s,
                        xn(
                          e,
                          t,
                          function () {
                            return Ph(e, t, 0, e.i.duration);
                          },
                          null,
                        ),
                        6,
                      )
                    : e.m
                      ? _(
                          s,
                          xn(
                            e,
                            r.aa,
                            function () {
                              return Ph(e, r.aa, 0, e.i.duration);
                            },
                            null,
                          ),
                          0,
                        )
                      : s.A(0);
              });
            }
            d.flush = function (e) {
              var t = this,
                r;
              return W(function (s) {
                return s.g == 1
                  ? ((r = hn),
                    e == r.Na
                      ? s.return()
                      : _(
                          s,
                          xn(
                            t,
                            e,
                            function () {
                              ((t.g.currentTime -= 0.001), co(t, e));
                            },
                            null,
                          ),
                          2,
                        ))
                  : t.m
                    ? _(
                        s,
                        xn(
                          t,
                          r.aa,
                          function () {
                            var a = r.aa;
                            ((t.g.currentTime -= 0.001), co(t, a));
                          },
                          null,
                        ),
                        0,
                      )
                    : s.A(0);
              });
            };
            function IA(e, t, r, s, a, c, f, g, m) {
              var x, E, A;
              return W(function (R) {
                return R.g == 1
                  ? ((x = hn),
                    t == x.Na
                      ? (c || (e.h.u = r), vP(e.h, s, a), R.return())
                      : ((E = []), _(R, z2(e, t, f, g, m), 2)))
                  : ((A = R.h),
                    A ||
                      (E.push(
                        xn(
                          e,
                          t,
                          function () {
                            return tl(e, t);
                          },
                          null,
                        ),
                      ),
                      e.m &&
                        E.push(
                          xn(
                            e,
                            x.aa,
                            function () {
                              return tl(e, x.aa);
                            },
                            null,
                          ),
                        )),
                    c ||
                      (E.push(
                        xn(
                          e,
                          t,
                          function () {
                            return nl(e, t, r);
                          },
                          null,
                        ),
                      ),
                      e.m &&
                        E.push(
                          xn(
                            e,
                            x.aa,
                            function () {
                              return nl(e, x.aa, r);
                            },
                            null,
                          ),
                        )),
                    (s != 0 || a != 1 / 0) &&
                      (E.push(
                        xn(
                          e,
                          t,
                          function () {
                            return wA(e, t, s, a);
                          },
                          null,
                        ),
                      ),
                      e.m &&
                        E.push(
                          xn(
                            e,
                            x.aa,
                            function () {
                              return wA(e, x.aa, s, a);
                            },
                            null,
                          ),
                        )),
                    E.length ? _(R, Promise.all(E), 0) : R.A(0));
              });
            }
            function G2(e, t, r) {
              var s, a;
              return W(function (c) {
                return c.g == 1
                  ? ((s = hn),
                    t == s.Na ||
                    (t == s.wa && (e.ab = new _t()), !e.J || ((a = sa(e, t)) && Math.abs(a - r) < 0.15))
                      ? c.return()
                      : (xn(
                          e,
                          t,
                          function () {
                            return tl(e, t);
                          },
                          null,
                        ),
                        e.m &&
                          xn(
                            e,
                            s.aa,
                            function () {
                              return tl(e, s.aa);
                            },
                            null,
                          ),
                        _(
                          c,
                          xn(
                            e,
                            t,
                            function () {
                              return nl(e, t, r);
                            },
                            null,
                          ),
                          2,
                        )))
                  : e.m
                    ? _(
                        c,
                        xn(
                          e,
                          s.aa,
                          function () {
                            return nl(e, s.aa, r);
                          },
                          null,
                        ),
                        0,
                      )
                    : c.A(0);
              });
            }
            ((d.endOfStream = function (e) {
              var t = this;
              return W(function (r) {
                return _(
                  r,
                  Yu(t, function () {
                    ra(t) || uo(t) || (e ? t.i.endOfStream(e) : t.i.endOfStream());
                  }),
                  0,
                );
              });
            }),
              (d.Ab = function (e) {
                var t = this;
                return W(function (r) {
                  return _(
                    r,
                    Yu(t, function () {
                      if (t.B.durationReductionEmitsUpdateEnd && e < t.i.duration)
                        for (var s = I(t.l.keys()), a = s.next(); !a.done; a = s.next()) {
                          a = a.value;
                          var c = { start: function () {}, p: new _t(), uri: null };
                          t.o.get(a).unshift(c);
                        }
                      ((t.i.duration = e), (t.ya = e));
                    }),
                    0,
                  );
                });
              }),
              (d.getDuration = function () {
                return this.i.duration;
              }));
            function j2(e, t, r) {
              W(function (s) {
                return e.I.g || e.g.error || e.N || e.H || ra(e) || uo(e)
                  ? s.return()
                  : _(
                      s,
                      Yu(e, function () {
                        ra(e) || uo(e) || e.i.setLiveSeekableRange(t, r);
                      }),
                      0,
                    );
              });
            }
            function r0(e) {
              W(function (t) {
                return e.I.g || e.g.error || e.N || e.H || ra(e) || uo(e)
                  ? t.return()
                  : _(
                      t,
                      Yu(e, function () {
                        ra(e) || uo(e) || e.i.clearLiveSeekableRange();
                      }),
                      0,
                    );
              });
            }
            function Ph(e, t, r, s) {
              if (s <= r) co(e, t);
              else {
                if (e.C) {
                  var a = e.C;
                  t === "video" && a.g && a.g.flushBuffer(r, s);
                }
                e.l.get(t).remove(r, s);
              }
            }
            function tl(e, t) {
              var r = e.l.get(t),
                s = r.appendWindowStart,
                a = r.appendWindowEnd;
              (r.abort(), (r.appendWindowStart = s), (r.appendWindowEnd = a), co(e, t));
            }
            function nl(e, t, r) {
              (r < 0 && (r += 0.001), (e.l.get(t).timestampOffset = r), co(e, t));
            }
            function wA(e, t, r, s) {
              var a = e.l.get(t);
              ((a.appendWindowEnd !== s || a.appendWindowStart !== r) &&
                ((a.appendWindowStart = 0), (a.appendWindowEnd = s), (a.appendWindowStart = r)),
                co(e, t));
            }
            function co(e, t) {
              if (e.H || e.I.g) {
                var r = e.o.get(t);
                r && r.length && ((r = r[0]) && r.p && r.p.resolve(), e.o.set(t, []));
              } else (r = e.o.get(t)[0]) && (r.p.resolve(), s0(e, t));
            }
            function xn(e, t, r, s) {
              return (
                Nt(e.I),
                (r = { start: r, p: new _t(), uri: s }),
                e.o.get(t).push(r),
                e.o.get(t).length == 1 && RA(e, t),
                r.p
              );
            }
            function Yu(e, t) {
              var r, s, a, c, f, g, m, x, E, A, R, b, D;
              return W(function (M) {
                switch (M.g) {
                  case 1:
                    for (
                      Nt(e.I), r = [], s = Array.from(e.l.keys()), a = I(s), c = a.next(), f = {};
                      !c.done;
                      f = { ready: void 0 }, c = a.next()
                    )
                      ((g = c.value),
                        (f.ready = new _t()),
                        (m = {
                          start: (function (P) {
                            return function () {
                              return P.ready.resolve();
                            };
                          })(f),
                          p: f.ready,
                          uri: null,
                        }),
                        (x = e.o.get(g)),
                        x.push(m),
                        r.push(f.ready),
                        x.length == 1 && m.start());
                    return (q(M, 2), _(M, Promise.all(r), 4));
                  case 4:
                    he(M, 3);
                    break;
                  case 2:
                    throw ((E = ae(M)), E);
                  case 3:
                    return (q(M, 5, 6), _(M, t(), 6));
                  case 6:
                    for (ye(M), A = I(s), R = A.next(); !R.done; R = A.next()) ((b = R.value), s0(e, b));
                    ve(M, 0);
                    break;
                  case 5:
                    throw (
                      (D = ae(M)),
                      new ee(2, 3, 3015, D, e.g.error || "No error in the media element", null)
                    );
                }
              });
            }
            function s0(e, t) {
              (e.o.get(t).shift(), RA(e, t));
            }
            function RA(e, t) {
              var r = e.o.get(t)[0];
              if (r)
                try {
                  r.start();
                } catch (s) {
                  (s.name == "QuotaExceededError"
                    ? r.p.reject(new ee(2, 3, 3017, t))
                    : EA(e)
                      ? r.p.reject(new ee(2, 3, 3015, s, e.g.error || "No error in the media element", r.uri))
                      : r.p.reject(new ee(2, 3, 3024, t)),
                    s0(e, t));
                }
            }
            function V2(e, t) {
              ((e.ba = t), e.h && (e.h.l = t));
            }
            function H2(e, t, r, s, a) {
              if (Du(e.G.get(a)) != "mp4") return r;
              var c = s === null,
                f = e.Ta.get(a),
                g = e.O.Pj(),
                m = !1;
              (s && s.ea && (m = s.ea.encrypted), (s = s ? s.P()[0] : null));
              var x = tt();
              return (
                e.B.correctEc3Enca && c && a === "audio" && (r = S2(r)),
                e.B.insertFakeEncryptionInInit &&
                  f &&
                  x.Fd(g, a) &&
                  (c ? (r = E2(t, r, s)) : !m && x.Ni(a) && (r = A2(r))),
                c && x.se() && (r = R2(r)),
                r
              );
            }
            function K2(e, t, r, s) {
              return xn(
                e,
                t,
                function () {
                  if (t !== nt) {
                    if ((e.G.get(t), tt().Ib())) {
                      (e.j.has(t) && (e.j.get(t).destroy(), e.j.delete(t)), s && e.j.set(t, s));
                      var a = r + e.B.addExtraFeaturesToSourceBuffer(r);
                      (e.l.get(t).changeType(a), e.G.set(t, r));
                    }
                    co(e, t);
                  }
                },
                null,
              );
            }
            function W2(e, t) {
              var r, s, a, c, f, g, m, x, E, A, R, b, D, M, P, G, U, H, Q, ne;
              return W(function (z) {
                if (z.g == 1) {
                  if (e.H || e.N) return z.return();
                  for (
                    r = hn,
                      e.H = !0,
                      e.m = !1,
                      s = e.g.currentTime,
                      a = e.g.autoplay,
                      e.g.paused || (e.Ua = !0),
                      e.ob && (e.g.autoplay = !1),
                      ce(z, 2),
                      e.u.Qa(),
                      c = I(e.j.values()),
                      f = c.next();
                    !f.done;
                    f = c.next()
                  )
                    ((g = f.value), g.destroy());
                  for (m = I(e.l.values()), x = m.next(); !x.done; x = m.next()) {
                    E = x.value;
                    try {
                      e.i.removeSourceBuffer(E);
                    } catch (J) {}
                  }
                  return (
                    e.j.clear(),
                    e.l.clear(),
                    (A = e.i.duration),
                    (e.M = new _t()),
                    (e.i = n0(e, e.M)),
                    _(z, e.M, 4)
                  );
                }
                if (z.g != 2) {
                  for (
                    !isNaN(A) && A ? (e.i.duration = A) : !isNaN(e.ya) && e.ya && (e.i.duration = e.ya),
                      R = new _t(),
                      b = e.i.sourceBuffers,
                      D = t.size,
                      M = 0,
                      P = function () {
                        (M++, M === D && (R.resolve(), e.u.Ma(b, "addsourcebuffer", P)));
                      },
                      e.u.D(b, "addsourcebuffer", P),
                      G = I(t.keys()),
                      U = G.next();
                    !U.done;
                    U = G.next()
                  )
                    ((H = U.value), (Q = t.get(H)), Dh(e, H, Q, Q.codecs));
                  return (
                    (ne = t.get(r.aa)) && ne.isAudioMuxedInVideo && (e.m = !0),
                    e.m && !e.o.has(r.aa) && e.o.set(r.aa, []),
                    _(z, R, 2)
                  );
                }
                return (
                  ye(z),
                  (e.H = !1),
                  Nt(e.I),
                  e.u.Aa(e.g, "loadedmetadata", function () {
                    e.I.g || (e.g.currentTime = s);
                  }),
                  e.u.Aa(e.g, "canplaythrough", function () {
                    e.I.g || ((e.g.autoplay = a), e.Ua && ((e.Ua = !1), e.g.play()));
                  }),
                  ve(z, 0)
                );
              });
            }
            function CA(e, t) {
              return Yu(e, function () {
                return W2(e, t);
              });
            }
            function LA(e, t, r, s) {
              var a = !1,
                c = Si("audio", (s || "").split(",")),
                f = Si("video", (s || "").split(",")),
                g = f;
              (t == "audio" && (g = c), g || (g = s));
              var m = tn(r, g),
                x = Pi(e.G.get(t)),
                E = e.B.forceTransmux;
              if (
                (!ti(m) || (!e.J && Ss.includes(m))
                  ? (E = !0)
                  : E || r == x || (E = !tt().Nf() && Ss.includes(r)),
                E && ((e = sh(r, g)), (g = $a(e))))
              ) {
                var A = g();
                (c && f && (a = !0), (m = A.convertCodecs(t, e)));
              }
              return (
                !A && t === "video" && c && (m = tn(r, s)),
                (t = Kn(Ei(m))),
                { jc: A, jl: a, Th: Pi(m), codec: t, mimeType: m }
              );
            }
            function _A(e, t, r, s, a) {
              if (t == nt) return { type: a0, wf: r, jc: null };
              var c = Kn(Ei(e.G.get(t))),
                f = Pi(e.G.get(t)),
                g = LA(e, t, r, s),
                m = g.jc,
                x = g.jl,
                E = g.Th,
                A = g.codec;
              g = g.mimeType;
              var R = !0;
              return (
                x &&
                  e.G.has("audio") &&
                  ((r = LA(e, "audio", r, s)),
                  (s = Kn(Ei(e.G.get("audio")))),
                  (R = Pi(e.G.get("audio"))),
                  (R = s == r.codec && R == r.Th),
                  r.jc && r.jc.destroy()),
                c === A && f === E && R
                  ? { type: a0, wf: g, jc: m }
                  : ((c = !0),
                    ((e.m && !a.has("audio")) || (x && m && !e.j.has(t))) && (c = !1),
                    (t = tt()),
                    c && e.B.codecSwitchingStrategy === "smooth" && t.Ib()
                      ? { type: bA, wf: g, jc: m }
                      : (m && m.destroy(), { type: l0, wf: g, jc: null }))
              );
            }
            function z2(e, t, r, s, a) {
              var c, f, g, m, x, E;
              return W(function (A) {
                return A.g == 1
                  ? ((c = hn),
                    (f = _A(e, t, r, s, a)),
                    (g = f.type),
                    (m = f.jc),
                    (x = f.wf),
                    (E = a.get(c.aa)) && (e.m = E.isAudioMuxedInVideo),
                    g == a0
                      ? (e.j.has(t) && !m
                          ? (e.j.get(t).destroy(), e.j.delete(t))
                          : !e.j.has(t) && m
                            ? e.j.set(t, m)
                            : m &&
                              (e.j.has(t) && e.j.get(t).transmux !== m.transmux
                                ? (e.j.get(t).destroy(), e.j.set(t, m))
                                : m.destroy()),
                        A.return(!1))
                      : g == bA
                        ? _(A, K2(e, t, x, m), 3)
                        : g != l0
                          ? A.A(3)
                          : (m && m.destroy(), _(A, CA(e, a), 3)))
                  : A.return(!0);
              });
            }
            function Y2(e, t, r, s, a) {
              return ((e = _A(e, t, r, s, a)), e.jc && e.jc.destroy(), e.type == l0);
            }
            var o0 = l.URL.createObjectURL,
              X2 = "sequence",
              a0 = "none",
              l0 = "reset",
              bA = "changeType";
            function Ke(e, t, r) {
              ((this.i = e),
                (this.F = t),
                (this.u = this.l = 1 / 0),
                (this.h = 1),
                (this.g = this.j = null),
                (this.B = 0),
                (this.C = !0),
                (this.J = !1),
                (this.I = 0),
                (this.G = r === void 0 ? !0 : r),
                (this.H = 0),
                (this.o = !1),
                (this.m = e));
            }
            ((d = Ke.prototype),
              (d.getDuration = function () {
                return this.l;
              }),
              (d.Rj = function () {
                return this.h;
              }),
              (d.Wi = function (e) {
                this.i = e;
              }),
              (d.Ab = function (e) {
                this.l = e;
              }),
              (d.Wj = function () {
                return this.i;
              }),
              (d.Vi = function (e) {
                this.B = e;
              }),
              (d.cd = function (e) {
                (e && !this.C && (this.J = !0), (this.C = e));
              }),
              (d.Lf = function (e) {
                this.u = e;
              }),
              (d.df = function () {
                return this.u;
              }),
              (d.rh = function (e) {
                this.F = e;
              }),
              (d.Jj = function () {
                return this.F;
              }),
              (d.Hi = function (e, t) {
                if (e.length != 0) {
                  var r = (Date.now() + this.B) / 1e3;
                  if (
                    ((e = e.filter(function (a) {
                      return a.start + t < r;
                    })),
                    e.length != 0)
                  ) {
                    var s = e[e.length - 1].end + t;
                    (this.xf(e[0].start + t),
                      (this.h = e.reduce(function (a, c) {
                        return Math.max(a, c.end - c.start);
                      }, this.h)),
                      (this.g = Math.max(this.g, s)),
                      this.i != null && this.G && !this.o && (this.i = r - this.g - this.h));
                  }
                }
              }),
              (d.me = function (e) {
                if (e.length != 0) {
                  var t = e[0].startTime,
                    r = e[0].endTime,
                    s = (Date.now() + this.B) / 1e3;
                  e = I(e);
                  for (var a = e.next(); !a.done; a = e.next())
                    ((a = a.value),
                      s < a.startTime ||
                        ((t = Math.min(t, a.startTime)),
                        (r = Math.max(r, a.endTime)),
                        (this.h = Math.max(this.h, a.endTime - a.startTime))));
                  (this.xf(t),
                    (this.g = Math.max(this.g, r)),
                    this.i != null && this.G && !this.o && (this.i = s - this.g - this.h));
                }
              }),
              (d.Gi = function (e, t) {
                (this.xf(e), t == 1 / 0 || this.W() || (this.g = Math.max(this.g, t)));
              }),
              (d.Sj = function () {
                return this.g;
              }),
              (d.qf = function () {
                this.o = !0;
              }),
              (d.vk = function () {
                return this.o;
              }),
              (d.sh = function (e) {
                this.m = e;
              }),
              (d.Oj = function () {
                return this.m;
              }),
              (d.xf = function (e) {
                this.j == null ? (this.j = e) : this.J || (this.j = Math.min(this.j, e));
              }),
              (d.Wg = function (e) {
                this.h = Math.max(this.h, e);
              }),
              (d.offset = function (e) {
                (this.j != null && (this.j += e), this.g != null && (this.g += e));
              }),
              (d.W = function () {
                return this.l == 1 / 0 && !this.C;
              }),
              (d.Vc = function () {
                return this.l != 1 / 0 && !this.C;
              }),
              (d.Hb = function () {
                return Math.max(this.I, this.Ic() - this.u);
              }),
              (d.Yi = function (e) {
                this.I = e;
              }),
              (d.Ic = function () {
                return this.W() || this.Vc()
                  ? Math.min(Math.max(0, (Date.now() + this.B) / 1e3 - this.h - this.i) + this.H, this.l)
                  : this.g
                    ? Math.min(this.g, this.l)
                    : this.l;
              }),
              (d.ae = function (e) {
                var t = Math.max(this.j, this.I);
                return this.u == 1 / 0
                  ? Math.ceil(t * 1e3) / 1e3
                  : Math.max(t, Math.min(this.Ic() - this.u + e, this.Gb()));
              }),
              (d.Zb = function () {
                return this.ae(0);
              }),
              (d.Gb = function () {
                return Math.max(0, this.Ic() - (this.W() || this.Vc() ? this.F : 0));
              }),
              (d.kj = function () {
                return !(this.i == null || (this.g != null && this.G));
              }),
              (d.Ui = function (e) {
                this.H = e;
              }),
              (d.Ej = function () {
                return this.H;
              }),
              Ee("shaka.media.PresentationTimeline", Ke),
              (Ke.prototype.getAvailabilityTimeOffset = Ke.prototype.Ej),
              (Ke.prototype.setAvailabilityTimeOffset = Ke.prototype.Ui),
              (Ke.prototype.usingPresentationStartTime = Ke.prototype.kj),
              (Ke.prototype.getSeekRangeEnd = Ke.prototype.Gb),
              (Ke.prototype.getSeekRangeStart = Ke.prototype.Zb),
              (Ke.prototype.getSafeSeekRangeStart = Ke.prototype.ae),
              (Ke.prototype.getSegmentAvailabilityEnd = Ke.prototype.Ic),
              (Ke.prototype.setUserSeekStart = Ke.prototype.Yi),
              (Ke.prototype.getSegmentAvailabilityStart = Ke.prototype.Hb),
              (Ke.prototype.isInProgress = Ke.prototype.Vc),
              (Ke.prototype.isLive = Ke.prototype.W),
              (Ke.prototype.offset = Ke.prototype.offset),
              (Ke.prototype.notifyMaxSegmentDuration = Ke.prototype.Wg),
              (Ke.prototype.notifyMinSegmentStartTime = Ke.prototype.xf),
              (Ke.prototype.getInitialProgramDateTime = Ke.prototype.Oj),
              (Ke.prototype.setInitialProgramDateTime = Ke.prototype.sh),
              (Ke.prototype.isStartTimeLocked = Ke.prototype.vk),
              (Ke.prototype.lockStartTime = Ke.prototype.qf),
              (Ke.prototype.getMaxSegmentEndTime = Ke.prototype.Sj),
              (Ke.prototype.notifyPeriodDuration = Ke.prototype.Gi),
              (Ke.prototype.notifySegments = Ke.prototype.me),
              (Ke.prototype.notifyTimeRange = Ke.prototype.Hi),
              (Ke.prototype.getDelay = Ke.prototype.Jj),
              (Ke.prototype.setDelay = Ke.prototype.rh),
              (Ke.prototype.getSegmentAvailabilityDuration = Ke.prototype.df),
              (Ke.prototype.setSegmentAvailabilityDuration = Ke.prototype.Lf),
              (Ke.prototype.setStatic = Ke.prototype.cd),
              (Ke.prototype.setClockOffset = Ke.prototype.Vi),
              (Ke.prototype.getPresentationStartTime = Ke.prototype.Wj),
              (Ke.prototype.setDuration = Ke.prototype.Ab),
              (Ke.prototype.setPresentationStartTime = Ke.prototype.Wi),
              (Ke.prototype.getMaxSegmentDuration = Ke.prototype.Rj),
              (Ke.prototype.getDuration = Ke.prototype.getDuration));
            function u0(e, t, r, s) {
              var a = this;
              ((this.u = s),
                (this.g = e),
                (this.F = t),
                (this.h = r),
                (this.j = new gt()),
                (this.m = !1),
                (this.l = 0),
                (this.C = !1),
                (this.H = this.G = 0),
                (this.o = Q2(this)),
                (this.B = !1),
                this.j.D(e, "waiting", function () {
                  return Xu(a);
                }),
                (this.i = new it(function () {
                  Xu(a);
                }).Ea(this.h.gapJumpTimerTime)));
            }
            ((u0.prototype.release = function () {
              (this.j && (this.j.release(), (this.j = null)),
                this.i != null && (this.i.stop(), (this.i = null)),
                this.o && (this.o.release(), (this.o = null)),
                (this.g = this.F = this.u = null));
            }),
              (u0.prototype.zd = function () {
                ((this.B = !0), this.i && this.i.Ea(this.h.gapJumpTimerTime), Xu(this));
              }));
            function Xu(e) {
              if (e.g.readyState != 0) {
                if (e.g.seeking) {
                  if (!e.m) return;
                } else e.m = !1;
                if (!e.g.paused || (e.g.currentTime == e.l && (e.g.autoplay || e.g.currentTime != e.l))) {
                  var t;
                  if (!(t = !e.o)) {
                    t = e.o;
                    var r = t.h,
                      s = MA(r),
                      a = r.g.currentTime,
                      c = Date.now() / 1e3;
                    ((t.g != a || t.m != s) && ((t.l = c), (t.g = a), (t.m = s), (t.i = !1)),
                      (a = c - t.l),
                      (s = a >= t.o && s && !t.i) &&
                        (t.j && t.j(t.g, a), (t.i = !0), (t.g = r.g.currentTime)),
                      (t = !s));
                  }
                  t &&
                    ((t = e.g.currentTime),
                    (r = e.g.buffered),
                    (s = C2(r, t, e.h.gapDetectionThreshold)),
                    s == null ||
                      (s == 0 && !e.B) ||
                      ((a = r.start(s)),
                      (c = e.h.gapPadding) && (a = Math.ceil((a + c) * 100) / 100),
                      a >= e.F.Gb() ||
                        a - t < 0.001 ||
                        (s != 0 && r.end(s - 1),
                        q2(e, a),
                        t == e.l && (e.l = a),
                        e.G++,
                        e.u(new Me("gapjumped")))));
                }
              }
            }
            function q2(e, t) {
              ((e.C = !0),
                e.j.Aa(e.g, "seeked", function () {
                  e.C = !1;
                }),
                (e.g.currentTime = t));
            }
            function Q2(e) {
              if (!e.h.stallEnabled) return null;
              var t = e.h.stallThreshold,
                r = e.h.stallSkip;
              return new DA(new kA(e.g), t, function () {
                var s;
                return W(function (a) {
                  if (a.g == 1)
                    return (
                      (s = Cs(e.g.buffered)),
                      s.length ? (r ? ((e.g.currentTime += r), a.A(2)) : _(a, e.g.play(), 3)) : a.return()
                    );
                  if (a.g != 2) {
                    if (!e.g) return a.return();
                    (e.g.pause(), e.g.play());
                  }
                  (e.H++, e.u(new Me("stalldetected")), K(a));
                });
              });
            }
            function DA(e, t, r) {
              ((this.h = e),
                (this.m = MA(e)),
                (this.g = e.g.currentTime),
                (this.l = Date.now() / 1e3),
                (this.i = !1),
                (this.o = t),
                (this.j = r));
            }
            DA.prototype.release = function () {
              (this.h && this.h.release(), (this.j = this.h = null));
            };
            function kA(e) {
              var t = this;
              ((this.g = e),
                (this.h = new gt()),
                (this.i = !1),
                this.h.D(this.g, "audiofocuspaused", function () {
                  t.i = !0;
                }),
                this.h.D(this.g, "audiofocusgranted", function () {
                  t.i = !1;
                }),
                this.h.D(this.g, "audiofocuslost", function () {
                  t.i = !0;
                }));
            }
            function MA(e) {
              if (e.g.paused || e.g.playbackRate == 0 || e.i || e.g.buffered.length == 0) var t = !1;
              else
                e: {
                  ((t = e.g.currentTime), (e = I(Cs(e.g.buffered))));
                  for (var r = e.next(); !r.done; r = e.next())
                    if (((r = r.value), !(t < r.start - 0.1 || t > r.end - 0.5))) {
                      t = !0;
                      break e;
                    }
                  t = !1;
                }
              return t;
            }
            kA.prototype.release = function () {
              (this.h && this.h.release(), (this.h = null));
            };
            function il(e, t, r, s) {
              t == HTMLMediaElement.HAVE_NOTHING || e.readyState >= t
                ? s()
                : ((t = J2.value().get(t)), r.Aa(e, t, s));
            }
            var J2 = new Kt(function () {
              return new Map([
                [HTMLMediaElement.HAVE_METADATA, "loadedmetadata"],
                [HTMLMediaElement.HAVE_CURRENT_DATA, "loadeddata"],
                [HTMLMediaElement.HAVE_FUTURE_DATA, "canplay"],
                [HTMLMediaElement.HAVE_ENOUGH_DATA, "canplaythrough"],
              ]);
            });
            function PA(e, t, r, s) {
              var a = this;
              ((this.g = e),
                (this.m = t),
                (this.u = r),
                (this.l = null),
                (this.j = function () {
                  return (a.l == null && (a.l = s()), a.l);
                }),
                (this.o = !1),
                (this.h = new gt()),
                (this.i = new UA(e)),
                il(this.g, HTMLMediaElement.HAVE_METADATA, this.h, function () {
                  NA(a, a.j());
                }));
            }
            PA.prototype.release = function () {
              (this.h && (this.h.release(), (this.h = null)),
                this.i != null && (this.i.release(), (this.i = null)),
                (this.m = function () {}),
                (this.g = null));
            };
            function c0(e) {
              return e.o ? e.g.currentTime : e.j();
            }
            function OA(e, t) {
              e.g.readyState > 0
                ? BA(e.i, t)
                : il(e.g, HTMLMediaElement.HAVE_METADATA, e.h, function () {
                    NA(e, e.j());
                  });
            }
            function NA(e, t) {
              Math.abs(e.g.currentTime - t) < 0.001
                ? FA(e)
                : (e.h.Aa(e.g, "seeking", function () {
                    FA(e);
                  }),
                  BA(e.i, e.g.currentTime && e.g.currentTime != 0 ? e.g.currentTime : t));
            }
            function FA(e) {
              ((e.o = !0),
                e.h.D(e.g, "seeking", function () {
                  return e.m();
                }),
                e.u(e.g.currentTime));
            }
            function UA(e) {
              var t = this;
              ((this.g = e),
                (this.m = 10),
                (this.j = this.l = this.i = 0),
                (this.h = new it(function () {
                  t.i <= 0 || t.g.currentTime != t.l || t.g.currentTime === t.j
                    ? t.h.stop()
                    : ((t.g.currentTime = t.j), t.i--);
                })));
            }
            UA.prototype.release = function () {
              (this.h && (this.h.stop(), (this.h = null)), (this.g = null));
            };
            function BA(e, t) {
              ((e.l = e.g.currentTime), (e.j = t), (e.i = e.m), (e.g.currentTime = t), e.h.Ea(0.1));
            }
            function $A(e) {
              ((this.g = e), (this.i = !1), (this.h = null), (this.j = new gt()));
            }
            ((d = $A.prototype),
              (d.ready = function () {
                function e() {
                  if (t.h == null || (t.h == 0 && t.g.duration != 1 / 0)) t.i = !0;
                  else {
                    var r = t.g.currentTime,
                      s = null;
                    if (typeof t.h == "number") s = t.h;
                    else if (t.h instanceof Date) {
                      var a = GA(t);
                      a !== null && ((s = t.h.getTime() / 1e3 - a), (s = jA(t, s)));
                    }
                    s == null
                      ? (t.i = !0)
                      : (s < 0 && (s = Math.max(0, r + s)),
                        r != s
                          ? (t.j.Aa(t.g, "seeking", function () {
                              t.i = !0;
                            }),
                            (t.g.currentTime = s))
                          : (t.i = !0));
                  }
                }
                var t = this;
                il(this.g, HTMLMediaElement.HAVE_FUTURE_DATA, this.j, function () {
                  e();
                });
              }),
              (d.release = function () {
                (this.j && (this.j.release(), (this.j = null)), (this.g = null));
              }),
              (d.$f = function (e) {
                this.h = this.i ? this.h : e;
              }),
              (d.Qd = function () {
                var e = this.i ? this.g.currentTime : this.h;
                return (
                  e instanceof Date && ((e = e.getTime() / 1e3 - (GA(this) || 0)), (e = jA(this, e))),
                  e || 0
                );
              }),
              (d.Nh = function () {
                return 0;
              }),
              (d.Lh = function () {
                return 0;
              }),
              (d.Mh = function () {
                return !1;
              }),
              (d.Fi = function () {}),
              (d.ri = function () {
                var e = Lh(this.g.buffered);
                return e != null && e >= this.g.duration - 1;
              }));
            function GA(e) {
              return e.g.getStartDate && ((e = e.g.getStartDate().getTime()), !isNaN(e)) ? e / 1e3 : null;
            }
            function jA(e, t) {
              return (
                (e = e.g.seekable),
                e.length > 0 && ((t = Math.max(e.start(0), t)), (t = Math.min(e.end(e.length - 1), t))),
                t
              );
            }
            function VA(e, t, r, s, a, c) {
              var f = this;
              ((this.h = e),
                (this.g = t.presentationTimeline),
                (this.l = r),
                (this.u = a),
                (this.o = null),
                (this.i = new u0(e, t.presentationTimeline, r, c)),
                (this.j = new PA(
                  e,
                  function () {
                    e: {
                      var g = f.i;
                      ((g.m = !0), (g.B = !1), g.i && g.i.Ea(g.h.gapJumpTimerTime), Xu(g));
                      var m = c0(f.j);
                      if (((g = WA(f, m)), !iA() && Math.abs(g - m) > 0.001)) {
                        m = !1;
                        var x = tt().Si();
                        if (x) {
                          var E = Date.now() / 1e3;
                          (!f.o || f.o < E - x) && ((f.o = E), (m = !0));
                        } else m = !0;
                        if (m) {
                          (OA(f.j, g), (g = void 0));
                          break e;
                        }
                      }
                      (f.u(), (g = void 0));
                    }
                    return g;
                  },
                  function (g) {
                    var m = f.i;
                    (m.g.seeking && !m.m && ((m.m = !0), (m.l = g)),
                      m.i && m.i.Ea(m.h.gapJumpTimerTime),
                      Xu(m));
                  },
                  function () {
                    return HA(f, s);
                  },
                )),
                (this.m = new it(function () {
                  if (f.h.readyState != 0 && !f.h.paused) {
                    var g = c0(f.j),
                      m = f.g.Zb(),
                      x = f.g.Gb();
                    (x - m < 3 && (m = x - 3), g < m && ((g = WA(f, g)), (f.h.currentTime = g)));
                  }
                })));
            }
            ((d = VA.prototype),
              (d.ready = function () {
                this.m.Ea(0.25);
              }),
              (d.release = function () {
                (this.j && (this.j.release(), (this.j = null)),
                  this.i && (this.i.release(), (this.i = null)),
                  this.m && (this.m.stop(), (this.m = null)),
                  (this.h = this.j = this.g = this.l = null),
                  (this.u = function () {}));
              }),
              (d.$f = function (e) {
                OA(this.j, HA(this, e));
              }),
              (d.Qd = function () {
                var e = c0(this.j);
                return this.h.readyState > 0 && !this.h.paused ? zA(this, e) : e;
              }),
              (d.Nh = function () {
                return this.i.H;
              }),
              (d.Lh = function () {
                return this.i.G;
              }),
              (d.Mh = function () {
                return this.i.C;
              }));
            function HA(e, t) {
              return (
                t == null
                  ? (t = e.g.getDuration() < 1 / 0 ? e.g.Zb() : e.g.Gb())
                  : t instanceof Date
                    ? (t = t.getTime() / 1e3 - (e.g.m || e.g.i))
                    : t < 0 && (t = e.g.Gb() + t),
                KA(e, zA(e, t))
              );
            }
            ((d.Fi = function () {
              this.i.zd();
            }),
              (d.ri = function () {
                if (this.g.W()) {
                  var e = this.g.Ic(),
                    t = Lh(this.h.buffered);
                  if (t != null && t >= e) return !0;
                }
                return !1;
              }));
            function KA(e, t) {
              var r = e.g.getDuration();
              return t >= r ? r - e.l.durationBackoff : t;
            }
            function WA(e, t) {
              var r = e.l.rebufferingGoal,
                s = e.l.safeSeekOffset,
                a = e.g.Zb(),
                c = e.g.Gb(),
                f = e.g.getDuration();
              c - a < 3 && (a = c - 3);
              var g = e.g.ae(r),
                m = e.g.ae(s);
              return (
                (r = e.g.ae(r + s)),
                t >= f
                  ? KA(e, t)
                  : t > c
                    ? c - e.l.safeSeekEndOffset
                    : t < a
                      ? e.g.W() && e.l.returnToEndOfLiveWindowWhenOutside
                        ? c - e.l.safeSeekEndOffset
                        : zm(e.h.buffered, m)
                          ? m
                          : r
                      : t >= g || zm(e.h.buffered, t)
                        ? t
                        : r
              );
            }
            function zA(e, t) {
              var r = e.g.Zb();
              return t < r ? r : ((e = e.g.Gb()), t > e ? e : t);
            }
            function mt(e) {
              ((this.g = e), (this.m = null), (this.i = 0), (this.o = !1));
            }
            ((d = mt.prototype),
              (d.getNumReferences = function () {
                return this.g.length;
              }),
              (d.getNumEvicted = function () {
                return this.i;
              }),
              (d.release = function () {
                this.o || ((this.g = []), this.m && this.m.stop(), (this.m = null));
              }),
              (d.Bk = function () {
                this.o = !0;
              }),
              (d.Fb = function (e) {
                for (var t = I(this.g), r = t.next(); !r.done; r = t.next()) e(r.value);
              }));
            function $r(e) {
              return e.g[0] || null;
            }
            ((d.find = function (e) {
              for (var t = this.g.length - 1, r = t; r >= 0; --r) {
                var s = this.g[r],
                  a = r < t ? this.g[r + 1].startTime : s.endTime;
                if (e >= s.startTime && e < a) return r + this.i;
              }
              return this.g.length && e < this.g[0].startTime ? this.i : null;
            }),
              (d.get = function (e) {
                return this.g.length == 0
                  ? null
                  : ((e -= this.i), e < 0 || e >= this.g.length ? null : this.g[e]);
              }),
              (d.offset = function (e) {
                if (!this.o) for (var t = I(this.g), r = t.next(); !r.done; r = t.next()) r.value.offset(e);
              }),
              (d.tf = function (e) {
                if (!this.o && e.length) {
                  var t = Math.round(e[0].startTime * 1e3) / 1e3;
                  ((this.g = this.g.filter(function (r) {
                    return Math.round(r.startTime * 1e3) / 1e3 < t;
                  })),
                    this.g.push.apply(this.g, V(e)));
                }
              }),
              (d.ke = function (e, t) {
                var r = this;
                ((e = e.filter(function (s) {
                  return s.endTime > t && (r.g.length == 0 || s.endTime > r.g[0].startTime);
                })),
                  this.tf(e),
                  this.Ya(t));
              }),
              (d.Ya = function (e) {
                if (!this.o) {
                  var t = this.g.length;
                  ((this.g = this.g.filter(function (r) {
                    return r.endTime > e;
                  })),
                    (this.i += t - this.g.length));
                }
              }),
              (d.pd = function (e, t, r) {
                if (((r = r === void 0 ? !1 : r), !this.o)) {
                  for (; this.g.length && this.g[this.g.length - 1].startTime >= t; ) this.g.pop();
                  for (; this.g.length && this.g[0].endTime <= e; ) (this.g.shift(), r || this.i++);
                  this.g.length != 0 &&
                    ((e = this.g[this.g.length - 1]),
                    (t = new Be(
                      e.startTime,
                      t,
                      e.C,
                      e.startByte,
                      e.endByte,
                      e.ea,
                      e.timestampOffset,
                      e.appendWindowStart,
                      e.appendWindowEnd,
                      e.g,
                      e.tilesLayout,
                      e.B,
                      e.h,
                      e.status,
                      e.aesKey,
                    )),
                    (t.mimeType = e.mimeType),
                    (t.codecs = e.codecs),
                    (t.i = e.i),
                    (this.g[this.g.length - 1] = t));
                }
              }),
              (d.Rf = function (e, t) {
                var r = this;
                this.o ||
                  (this.m && this.m.stop(),
                  (this.m = new it(function () {
                    var s = t();
                    s ? r.g.push.apply(r.g, V(s)) : (r.m.stop(), (r.m = null));
                  })),
                  this.m.Ea(e));
              }),
              (mt.prototype[Symbol.iterator] = function () {
                return this.Xb(0);
              }),
              (mt.prototype.Xb = function (e, t, r) {
                ((t = t === void 0 ? !1 : t), (r = r === void 0 ? !1 : r));
                var s = this.find(e);
                if (s == null) return null;
                var a = this.get(s);
                r ? s++ : s--;
                var c = -1;
                if (a && a.g.length > 0)
                  for (var f = a.g.length - 1; f >= 0; --f) {
                    var g = a.g[f];
                    if (e >= g.startTime && e < g.endTime) {
                      if (!t) {
                        for (; f && !g.l; ) (f--, (g = a.g[f]));
                        if (!g.l) return (Bt("No independent partial segment found!"), null);
                      }
                      (r ? s-- : s++, (c = f - 1));
                      break;
                    }
                  }
                return new ar(this, s, c, r);
              }),
              (mt.prototype.We = function () {
                return -1;
              }));
            function Oh(e, t, r) {
              return (
                (e = new Be(
                  e,
                  e + t,
                  function () {
                    return r;
                  },
                  0,
                  null,
                  null,
                  e,
                  e,
                  e + t,
                )),
                new mt([e])
              );
            }
            (Ee("shaka.media.SegmentIndex", mt),
              (mt.forSingleSegment = Oh),
              (mt.prototype.getIteratorForTime = mt.prototype.Xb),
              (mt.prototype.updateEvery = mt.prototype.Rf),
              (mt.prototype.fit = mt.prototype.pd),
              (mt.prototype.evict = mt.prototype.Ya),
              (mt.prototype.mergeAndEvict = mt.prototype.ke),
              (mt.prototype.offset = mt.prototype.offset),
              (mt.prototype.get = mt.prototype.get),
              (mt.prototype.find = mt.prototype.find),
              (mt.prototype.markImmutable = mt.prototype.Bk),
              (mt.prototype.release = mt.prototype.release),
              (mt.prototype.getNumEvicted = mt.prototype.getNumEvicted),
              (mt.prototype.getNumReferences = mt.prototype.getNumReferences));
            function ar(e, t, r, s) {
              ((this.i = e), (this.h = t), (this.g = r), (this.reverse = s));
            }
            ((d = ar.prototype),
              (d.Jd = function (e) {
                this.reverse = e;
              }),
              (d.zj = function () {
                return this.h;
              }),
              (d.current = function () {
                var e = this.i.get(this.h);
                return (
                  e &&
                    e.g.length > 0 &&
                    e.m &&
                    this.g >= e.g.length &&
                    (this.h++, (this.g = 0), (e = this.i.get(this.h))),
                  e && e.g.length > 0 ? e.g[this.g] : e
                );
              }),
              (d.next = function () {
                var e = this.i.get(this.h);
                return (
                  this.reverse
                    ? e && e.g.length > 0
                      ? (this.g--,
                        this.g < 0 &&
                          (this.h--,
                          (this.g = (e = this.i.get(this.h)) && e.g.length > 0 ? e.g.length - 1 : 0)))
                      : (this.h--, (this.g = 0))
                    : e && e.g.length > 0
                      ? (this.g++, e.m && this.g == e.g.length && (this.h++, (this.g = 0)))
                      : (this.h++, (this.g = 0)),
                  (e = this.current()),
                  { value: e, done: !e }
                );
              }),
              (d.jh = function () {
                var e = this.current();
                if (e && e.Xc && !e.l && (e = this.i.get(this.h)) && e.g.length > 0)
                  for (var t = e.g[this.g]; t.l && !(this.g <= 0); ) (this.g--, (t = e.g[this.g]));
              }),
              Ee("shaka.media.SegmentIterator", ar),
              (ar.prototype.resetToLastIndependent = ar.prototype.jh),
              (ar.prototype.next = ar.prototype.next),
              (ar.prototype.current = ar.prototype.current),
              (ar.prototype.currentPosition = ar.prototype.zj),
              (ar.prototype.setReverse = ar.prototype.Jd));
            function Qt() {
              (mt.call(this, []), (this.h = []));
            }
            (N(Qt, mt),
              (d = Qt.prototype),
              (d.clone = function () {
                var e = new Qt();
                return ((e.h = this.h.slice()), (e.i = this.i), e);
              }),
              (d.release = function () {
                this.h = [];
              }),
              (d.Fb = function (e) {
                for (var t = I(this.h), r = t.next(); !r.done; r = t.next()) r.value.Fb(e);
              }));
            function Z2(e, t) {
              e = I(e.h);
              for (var r = e.next(); !r.done; r = e.next()) t(r.value);
            }
            d.find = function (e) {
              for (var t = this.i, r = I(this.h), s = r.next(); !s.done; s = r.next()) {
                s = s.value;
                var a = s.find(e);
                if (a != null) return a + t;
                t += s.getNumEvicted() + s.getNumReferences();
              }
              return null;
            };
            function eO(e, t) {
              e = I(e.h);
              for (var r = e.next(); !r.done; r = e.next())
                if (((r = r.value), r.find(t) != null)) return r.We();
              return -1;
            }
            ((d.get = function (e) {
              for (var t = this.i, r = I(this.h), s = r.next(); !s.done; s = r.next()) {
                s = s.value;
                var a = s.get(e - t);
                if (a) return a;
                ((a = s.getNumReferences()), (t += s.getNumEvicted() + a));
              }
              return null;
            }),
              (d.offset = function () {}),
              (d.tf = function () {}),
              (d.Ya = function (e) {
                if (this.h.length) {
                  var t = this.h[0];
                  (t.Ya(e),
                    t.getNumReferences() == 0 &&
                      (this.h.shift(), (this.i += t.getNumEvicted()), t.release(), this.Ya(e)));
                }
              }),
              (d.ke = function () {}),
              (d.pd = function () {}),
              (d.Rf = function () {}),
              Ee("shaka.media.MetaSegmentIndex", Qt),
              (Qt.prototype.updateEvery = Qt.prototype.Rf),
              (Qt.prototype.fit = Qt.prototype.pd),
              (Qt.prototype.mergeAndEvict = Qt.prototype.ke),
              (Qt.prototype.evict = Qt.prototype.Ya),
              (Qt.prototype.merge = Qt.prototype.tf),
              (Qt.prototype.offset = Qt.prototype.offset),
              (Qt.prototype.get = Qt.prototype.get),
              (Qt.prototype.find = Qt.prototype.find),
              (Qt.prototype.forEachTopLevelReference = Qt.prototype.Fb),
              (Qt.prototype.release = Qt.prototype.release));
            function qu(e) {
              var t = this;
              ((this.g = e),
                (this.j = !1),
                (this.i = this.g.cf()),
                (this.h = new it(function () {
                  t.g.Di(t.i * 0.25);
                })));
            }
            ((qu.prototype.release = function () {
              (this.set(this.Tc()), this.h && (this.h.stop(), (this.h = null)), (this.g = null));
            }),
              (qu.prototype.set = function (e) {
                ((this.i = e), d0(this));
              }),
              (qu.prototype.Tc = function () {
                return this.g.Tc();
              }));
            function d0(e) {
              e.h.stop();
              var t = e.j ? 0 : e.i;
              if (t >= 0)
                try {
                  e.g.cf() != t && e.g.uh(t);
                  return;
                } catch (r) {}
              (e.h.Ea(0.25), e.g.cf() != 0 && e.g.uh(0));
            }
            function h0(e) {
              var t = this;
              ((this.j = e),
                (this.h = new gt()),
                (this.g = new Set()),
                (this.i = new it(function () {
                  YA(t, !1);
                }).Jb()),
                e.paused || this.i.Ea(0.25),
                this.h.D(e, "playing", function () {
                  t.i.Jb().Ea(0.25);
                }),
                this.h.D(e, "pause", function () {
                  t.i.stop();
                }));
            }
            h0.prototype.release = function () {
              (this.h && (this.h.release(), (this.h = null)), this.i.stop());
              for (var e = I(this.g), t = e.next(); !t.done; t = e.next()) t.value.release();
              this.g.clear();
            };
            function YA(e, t) {
              var r = e.j.currentTime;
              e = I(e.g);
              for (var s = e.next(); !s.done; s = e.next()) s.value.j(r, t);
            }
            function Nh(e) {
              (Lt.call(this), (this.g = new Map()), (this.h = e));
            }
            (N(Nh, Lt),
              (Nh.prototype.release = function () {
                (this.g.clear(), Lt.prototype.release.call(this));
              }));
            function tO(e, t) {
              var r = e.g.get(t);
              return (r || ((r = { re: [], pg: null, contentType: t }), e.g.set(t, r)), r);
            }
            function nO(e, t, r) {
              var s = tO(e, t.contentType);
              (iO(e, s),
                (e = { xd: t, position: r }),
                (s = s.re),
                (t = s.findIndex(function (a) {
                  return a.position >= r;
                })),
                t >= 0 ? s.splice(t, s[t].position == r ? 1 : 0, e) : s.push(e));
            }
            Nh.prototype.j = function (e) {
              for (var t = I(this.g.values()), r = t.next(); !r.done; r = t.next()) {
                r = r.value;
                var s = r.pg;
                e: {
                  for (var a = r.re, c = a.length - 1; c >= 0; c--) {
                    var f = a[c];
                    if (f.position <= e) {
                      a = f.xd;
                      break e;
                    }
                  }
                  a = null;
                }
                ((c =
                  a &&
                  !(
                    s === a ||
                    (s &&
                      a &&
                      s.bandwidth == a.bandwidth &&
                      s.audioSamplingRate == a.audioSamplingRate &&
                      s.codecs == a.codecs &&
                      s.contentType == a.contentType &&
                      s.frameRate == a.frameRate &&
                      s.height == a.height &&
                      s.mimeType == a.mimeType &&
                      s.channelsCount == a.channelsCount &&
                      s.pixelAspectRatio == a.pixelAspectRatio &&
                      s.width == a.width)
                  )),
                  (f = a && s && a.label && s.label && s.label !== a.label));
                var g = a && s && a.language && s.language && s.language !== a.language;
                ((s = a && s && a.roles && s.roles && !Nr(s.roles, a.roles)),
                  (f || g || s) &&
                    XA(this, e, a.contentType) &&
                    ((r.pg = a),
                    (s = new Me(
                      "audiotrackchange",
                      new Map([
                        ["quality", a],
                        ["position", e],
                      ]),
                    )),
                    this.dispatchEvent(s)),
                  c &&
                    XA(this, e, a.contentType) &&
                    ((r.pg = a),
                    JSON.stringify(a),
                    (r = new Me(
                      "qualitychange",
                      new Map([
                        ["quality", a],
                        ["position", e],
                      ]),
                    )),
                    this.dispatchEvent(r)));
              }
            };
            function XA(e, t, r) {
              return !!(
                (e = e.h()[r]) &&
                e.length > 0 &&
                ((r = e[e.length - 1].end), t >= e[0].start && t < r)
              );
            }
            function iO(e, t) {
              if ((e = e.h()[t.contentType]) && e.length > 0) {
                var r = e[0].start,
                  s = e[e.length - 1].end,
                  a = t.re;
                t.re = a.filter(function (c, f) {
                  return !(
                    (c.position <= r && f + 1 < a.length && a[f + 1].position <= r) ||
                    c.position >= s
                  );
                });
              } else t.re = [];
            }
            function Fh(e) {
              var t = {
                bandwidth: e.bandwidth || 0,
                audioSamplingRate: null,
                codecs: e.codecs,
                contentType: e.type,
                frameRate: null,
                height: null,
                mimeType: e.mimeType,
                channelsCount: null,
                pixelAspectRatio: null,
                width: null,
                label: null,
                roles: e.roles,
                language: null,
              };
              return (
                e.type == "video" &&
                  ((t.frameRate = e.frameRate || null),
                  (t.height = e.height || null),
                  (t.pixelAspectRatio = e.pixelAspectRatio || null),
                  (t.width = e.width || null)),
                e.type == "audio" &&
                  ((t.audioSamplingRate = e.audioSamplingRate),
                  (t.channelsCount = e.channelsCount),
                  (t.label = e.label || null),
                  (t.language = e.language)),
                t
              );
            }
            function Qu(e) {
              (Lt.call(this), (this.h = new Map()), (this.i = e), (this.g = null));
            }
            (N(Qu, Lt),
              (Qu.prototype.release = function () {
                (this.h.clear(), this.g && (this.g.stop(), (this.g = null)), Lt.prototype.release.call(this));
              }));
            function f0(e, t) {
              var r =
                t.schemeIdUri + "_" + t.id + "_" + (t.startTime.toFixed(1) + "_" + t.endTime.toFixed(1));
              e.h.has(r) ||
                (e.h.set(r, t),
                (t = new Me("regionadd", new Map([["region", t]]))),
                e.dispatchEvent(t),
                rO(e));
            }
            function rO(e) {
              e.g ||
                (e.g = new it(function () {
                  for (var t = e.i(), r = I(e.h), s = r.next(); !s.done; s = r.next()) {
                    var a = I(s.value);
                    ((s = a.next().value),
                      (a = a.next().value),
                      a.endTime < t.start &&
                        (e.h.delete(s),
                        (s = new Me("regionremove", new Map([["region", a]]))),
                        e.dispatchEvent(s)));
                  }
                  !e.h.size && e.g && (e.g.stop(), (e.g = null));
                }).Ea(2));
            }
            function Uh(e, t, r, s, a) {
              function c(f, g) {
                return !(g.fastSwitching && f.Xc && f.je);
              }
              ((this.m = e),
                (this.i = t),
                (this.l = r),
                (this.g = new Map()),
                (this.j = new Map()),
                (this.h = null),
                (this.o = s),
                (this.u = a || c));
            }
            function sO(e, t) {
              ((e.l = t), (e = I(e.g.values())));
              for (var r = e.next(); !r.done; r = e.next()) r.value.g = t;
            }
            function Ju(e, t, r) {
              if (
                ((r = r === void 0 ? !1 : r),
                !e.i.segmentIndex || (e.h || (e.h = e.i.segmentIndex.Xb(t, !0, e.o)), !e.h))
              )
                return Promise.resolve();
              for (r && e.h.next(), t = []; e.g.size < e.m && ((r = e.h.next().value), !!r); ) {
                var s = !0;
                if (
                  (r.isPreload() && r.endByte != null && (s = !1),
                  r.Kc() == 2 && (s = !1),
                  r.$b(!1) && (s = !1),
                  s && r.ea && t.push(qA(e, r.ea)),
                  s && !e.g.has(r) && ((s = new g0(e.l)), t.push(ZA(s, r, e.i)), e.g.set(r, s)),
                  !e.u(r, e.i))
                )
                  break;
              }
              return (p0(e), Promise.all(t));
            }
            function qA(e, t) {
              if (
                !e.i.segmentIndex ||
                t.$b() ||
                Array.from(e.j.keys()).some(function (a) {
                  return Ku(a, t);
                })
              )
                return Promise.resolve();
              var r = new g0(e.l),
                s = ZA(r, t, e.i);
              return (e.j.set(t, r), s);
            }
            function QA(e, t) {
              t = I(t.keys());
              for (var r = t.next(); !r.done; r = t.next()) (r = r.value) && Zu(e, r);
            }
            function Gr(e) {
              (QA(e, e.g), QA(e, e.j), (e.h = null));
            }
            ((Uh.prototype.Ya = function (e, t) {
              t = t === void 0 ? !1 : t;
              for (var r = I(this.g.keys()), s = r.next(); !s.done; s = r.next())
                ((s = s.value), e > s.endTime && Zu(this, s));
              t && p0(this);
            }),
              (Uh.prototype.Jd = function (e) {
                ((this.o = e), this.h && this.h.Jd(e));
              }));
            function p0(e) {
              if (e.g.size)
                for (
                  var t = Array.from(e.g.keys()), r = I(e.j.keys()), s = r.next(), a = {};
                  !s.done;
                  a = { Qg: void 0 }, s = r.next()
                )
                  ((a.Qg = s.value),
                    t.some(
                      (function (c) {
                        return function (f) {
                          return Ku(f.ea, c.Qg);
                        };
                      })(a),
                    ) || Zu(e, a.Qg));
            }
            function JA(e, t) {
              e.m = t;
              for (var r = Array.from(e.g.keys()); r.length > t; ) {
                var s = r.pop();
                s && Zu(e, s);
              }
              p0(e);
            }
            function oO(e, t) {
              t && t !== e.i && (Gr(e), (e.i = t));
            }
            function Zu(e, t) {
              var r = e.g;
              (t instanceof Ai && (r = e.j), (e = r.get(t)), r.delete(t), e && e.abort());
            }
            function g0(e) {
              ((this.g = e), (this.oe = this.Bh = null));
            }
            function ZA(e, t, r) {
              var s = new Uint8Array(0);
              return (
                (e.oe = e.g(t, r, function (a) {
                  return W(function (c) {
                    if (c.g == 1)
                      return (s.byteLength > 0 ? (s = dn(s, a)) : (s = a), e.Bh ? _(c, e.Bh(s), 3) : c.A(0));
                    ((s = new Uint8Array(0)), K(c));
                  });
                })),
                e.oe.promise.catch(function (a) {
                  return a instanceof ee && a.code == 7001 ? Promise.resolve() : Promise.reject(a);
                })
              );
            }
            ((g0.prototype.abort = function () {
              this.oe && this.oe.abort();
            }),
              Ee("shaka.config.CrossBoundaryStrategy", {
                KEEP: "keep",
                RESET: "reset",
                RESET_TO_ENCRYPTED: "reset_to_encrypted",
                RESET_ON_ENCRYPTION_CHANGE: "RESET_ON_ENCRYPTION_CHANGE",
              }));
            function m0(e) {
              var t = Pi(e),
                r = t.split("/")[0];
              return (
                (e = Ei(e)),
                {
                  type: r,
                  mimeType: t,
                  codecs: e,
                  language: null,
                  height: null,
                  width: null,
                  channelCount: null,
                  sampleRate: null,
                  closedCaptions: new Map(),
                  ze: null,
                  colorGamut: null,
                  frameRate: null,
                  timescale: null,
                }
              );
            }
            function aO(e, t, r) {
              function s(X) {
                U = X.name;
                var ie = X.reader;
                ie.skip(24);
                var Z = ie.Ca(),
                  re = ie.Ca();
                (ie.skip(50), (R = String(Z)), (A = String(re)), X.reader.Ia() && Ze(X));
              }
              function a(X) {
                var ie = rA(X.reader);
                ((b = ie.channelCount), (D = ie.sampleRate), c(X.name));
              }
              function c(X) {
                switch (((X = X.toLowerCase()), X)) {
                  case "avc1":
                  case "avc3":
                    (g.push(X + ".42E01E"), (x = !0));
                    break;
                  case "hev1":
                  case "hvc1":
                    (g.push(X + ".1.6.L93.90"), (x = !0));
                    break;
                  case "dvh1":
                  case "dvhe":
                    (g.push(X + ".05.04"), (x = !0));
                    break;
                  case "vp09":
                    (g.push(X + ".00.10.08"), (x = !0));
                    break;
                  case "av01":
                    (g.push(X + ".0.01M.08"), (x = !0));
                    break;
                  case "mp4a":
                    (f.push("mp4a.40.2"), (m = !0));
                    break;
                  case "ac-3":
                  case "ec-3":
                  case "ac-4":
                  case "opus":
                  case "flac":
                    (f.push(X), (m = !0));
                    break;
                  case "apac":
                    (f.push("apac.31.00"), (m = !0));
                }
              }
              var f = [],
                g = [],
                m = !1,
                x = !1,
                E = null,
                A = null,
                R = null,
                b = null,
                D = null,
                M = null,
                P = null,
                G = null,
                U;
              if (
                (new bt()
                  .box("moov", Ze)
                  .box("trak", Ze)
                  .box("mdia", Ze)
                  .S("mdhd", function (X) {
                    ((X = wh(X.reader, X.version)), (E = X.language), (G = X.timescale));
                  })
                  .box("minf", Ze)
                  .box("stbl", Ze)
                  .S("stsd", ws)
                  .box("mp4a", function (X) {
                    var ie = rA(X.reader);
                    ((b = ie.channelCount), (D = ie.sampleRate), X.reader.Ia() ? Ze(X) : c(X.name));
                  })
                  .box("esds", function (X) {
                    X = X.reader;
                    for (var ie = "mp4a", Z, re; X.Ia(); ) {
                      Z = X.Y();
                      for (var se = X.Y(); se & 128; ) se = X.Y();
                      if (Z == 3)
                        (X.Ca(),
                          (se = X.Y()),
                          se & 128 && X.Ca(),
                          se & 64 && X.skip(X.Y()),
                          se & 32 && X.Ca());
                      else if (Z == 4) ((re = X.Y()), X.skip(12));
                      else if (Z == 5) break;
                    }
                    (re &&
                      ((ie += "." + ju(re)),
                      Z == 5 &&
                        X.Ia() &&
                        ((Z = X.Y()),
                        (re = (Z & 248) >> 3),
                        re === 31 && X.Ia() && (re = 32 + ((Z & 7) << 3) + ((X.Y() & 224) >> 5)),
                        (ie += "." + re))),
                      f.push(ie),
                      (m = !0));
                  })
                  .box("ac-3", a)
                  .box("ec-3", a)
                  .box("ac-4", a)
                  .box("Opus", a)
                  .box("fLaC", a)
                  .box("apac", a)
                  .box("avc1", s)
                  .box("avc3", s)
                  .box("hev1", s)
                  .box("hvc1", s)
                  .box("dva1", s)
                  .box("dvav", s)
                  .box("dvh1", s)
                  .box("dvhe", s)
                  .box("vp09", s)
                  .box("av01", s)
                  .box("avcC", function (X) {
                    var ie = U || "";
                    switch (U) {
                      case "dvav":
                        ie = "avc3";
                        break;
                      case "dva1":
                        ie = "avc1";
                    }
                    ((X = X.reader),
                      X.skip(1),
                      (X = ie + "." + ju(X.Y()) + ju(X.Y()) + ju(X.Y())),
                      g.push(X),
                      (x = !0));
                  })
                  .box("hvcC", function (X) {
                    var ie = U || "";
                    switch (U) {
                      case "dvh1":
                        ie = "hvc1";
                        break;
                      case "dvhe":
                        ie = "hev1";
                    }
                    var Z = X.reader;
                    (Z.skip(1), (X = Z.Y()));
                    var re = ["", "A", "B", "C"][X >> 6],
                      se = X & 31,
                      me = Z.U(),
                      fe = (X & 32) >> 5 ? "H" : "L";
                    ((X = [Z.Y(), Z.Y(), Z.Y(), Z.Y(), Z.Y(), Z.Y()]), (Z = Z.Y()));
                    for (var le = 0, ue = 0; ue < 32 && ((le |= me & 1), ue != 31); ue++)
                      ((le <<= 1), (me >>= 1));
                    for (
                      ie = ie + ("." + re + se) + ("." + ju(le, !0)),
                        ie += "." + fe + Z,
                        re = "",
                        se = X.length;
                      se--;
                    )
                      ((fe = X[se]) || re) && (re = "." + fe.toString(16).toUpperCase() + re);
                    ((ie += re), g.push(ie), (x = !0));
                  })
                  .box("dvcC", function (X) {
                    var ie = U || "";
                    switch (U) {
                      case "hvc1":
                        ie = "dvh1";
                        break;
                      case "hev1":
                        ie = "dvhe";
                        break;
                      case "avc1":
                        ie = "dva1";
                        break;
                      case "avc3":
                        ie = "dvav";
                        break;
                      case "av01":
                        ie = "dav1";
                    }
                    var Z = X.reader;
                    (Z.skip(2),
                      (X = Z.Y()),
                      (Z = Z.Y()),
                      g.push(ie + "." + Ni((X >> 1) & 127) + "." + Ni(((X << 5) & 32) | ((Z >> 3) & 31))),
                      (x = !0));
                  })
                  .box("dvvC", function (X) {
                    var ie = U || "";
                    switch (U) {
                      case "hvc1":
                        ie = "dvh1";
                        break;
                      case "hev1":
                        ie = "dvhe";
                        break;
                      case "avc1":
                        ie = "dva1";
                        break;
                      case "avc3":
                        ie = "dvav";
                        break;
                      case "av01":
                        ie = "dav1";
                    }
                    var Z = X.reader;
                    (Z.skip(2),
                      (X = Z.Y()),
                      (Z = Z.Y()),
                      g.push(ie + "." + Ni((X >> 1) & 127) + "." + Ni(((X << 5) & 32) | ((Z >> 3) & 31))),
                      (x = !0));
                  })
                  .S("vpcC", function (X) {
                    var ie = U || "",
                      Z = X.reader;
                    X = Z.Y();
                    var re = Z.Y();
                    ((Z = (Z.Y() >> 4) & 15),
                      g.push(ie + "." + Ni(X) + "." + Ni(re) + "." + Ni(Z)),
                      (x = !0));
                  })
                  .box("av1C", function (X) {
                    var ie = U || "";
                    switch (U) {
                      case "dav1":
                        ie = "av01";
                    }
                    var Z = X.reader;
                    (Z.skip(1), (X = Z.Y()), (Z = Z.Y()));
                    var re = X >>> 5,
                      se = (Z & 64) >> 6;
                    (g.push(
                      ie +
                        "." +
                        re +
                        "." +
                        Ni(X & 31) +
                        (Z >>> 7 ? "H" : "M") +
                        "." +
                        Ni(re === 2 && se ? ((Z & 32) >> 5 ? 12 : 10) : se ? 10 : 8) +
                        "." +
                        ((Z & 16) >> 4) +
                        "." +
                        ((Z & 8) >> 3) +
                        ((Z & 4) >> 2) +
                        (Z & 3) +
                        "." +
                        Ni(1) +
                        "." +
                        Ni(1) +
                        "." +
                        Ni(1) +
                        ".0",
                    ),
                      (x = !0));
                  })
                  .box("enca", xh)
                  .box("encv", Oi)
                  .box("sinf", Ze)
                  .box("frma", function (X) {
                    ((X = Km(X.reader).codec), c(X));
                  })
                  .box("colr", function (X) {
                    g = g.map(function (re) {
                      if (re.startsWith("av01.")) {
                        var se = X.reader,
                          me = se.Pa(),
                          fe = se.Tb(4, !1),
                          le = String.fromCharCode(fe[0]);
                        if (
                          ((le += String.fromCharCode(fe[1])),
                          (le += String.fromCharCode(fe[2])),
                          (le += String.fromCharCode(fe[3])),
                          le === "nclx")
                        ) {
                          ((fe = se.Ca()), (le = se.Ca()));
                          var ue = se.Ca(),
                            xe = se.Y() >> 7,
                            Se = re.split(".");
                          Se.length == 10 &&
                            ((Se[6] = Ni(fe)),
                            (Se[7] = Ni(le)),
                            (Se[8] = Ni(ue)),
                            (Se[9] = String(xe)),
                            (re = Se.join(".")));
                        }
                        se.seek(me);
                      }
                      return re;
                    });
                    var ie = u2(X.reader),
                      Z = ie.colorGamut;
                    ((M = ie.ze), (P = Z));
                  })
                  .parse(e || t, !0, !0),
                !f.length && !g.length)
              )
                return null;
              var H = m && !x,
                Q = new Map();
              if (x && !r) {
                ((r = new Ur("video/mp4")), e && r.init(e));
                try {
                  r.Af(t);
                  for (var ne = I(r.Zf()), z = ne.next(); !z.done; z = ne.next()) {
                    var J = z.value;
                    Q.set(J, J);
                  }
                } catch (X) {}
                r.Pd();
              }
              return {
                type: H ? "audio" : "video",
                mimeType: H ? "audio/mp4" : "video/mp4",
                codecs: y0(f.concat(g)).join(", "),
                language: E,
                height: A,
                width: R,
                channelCount: b,
                sampleRate: D,
                closedCaptions: Q,
                ze: M,
                colorGamut: P,
                frameRate: null,
                timescale: G,
              };
            }
            function y0(e) {
              var t = new Set(),
                r = [];
              e = I(e);
              for (var s = e.next(); !s.done; s = e.next()) {
                s = s.value;
                var a = ro(s);
                t.has(a) || (r.push(s), t.add(a));
              }
              return (
                (t = pm("audio", r)),
                (s = pm("video", r)),
                (e = pm(nt, r)),
                (s = lO(s)),
                (t = t.concat(s).concat(e)),
                r.length && !t.length ? r : t
              );
            }
            function lO(e) {
              if (e.length <= 1) return e;
              var t = e.find(function (r) {
                return (
                  r.startsWith("dvav.") ||
                  r.startsWith("dva1.") ||
                  r.startsWith("dvh1.") ||
                  r.startsWith("dvhe.") ||
                  r.startsWith("dav1.") ||
                  r.startsWith("dvc1.") ||
                  r.startsWith("dvi1.")
                );
              });
              return t
                ? ti('video/mp4; codecs="' + t + '"')
                  ? [t]
                  : e.filter(function (r) {
                      return r != t;
                    })
                : e;
            }
            function uO(e) {
              var t = null;
              return (
                new bt()
                  .box("moov", Ze)
                  .box("trak", Ze)
                  .box("mdia", Ze)
                  .box("minf", Ze)
                  .box("stbl", Ze)
                  .S("stsd", ws)
                  .box("encv", Oi)
                  .box("enca", xh)
                  .box("sinf", Ze)
                  .box("schi", Ze)
                  .S("tenc", function (r) {
                    ((r = r.reader), r.Y(), r.Y(), r.Y(), r.Y(), (r = r.Tb(16, !1)), (t = gs(r)));
                  })
                  .parse(e, !0),
                t
              );
            }
            function v0(e, t, r) {
              var s, a, c, f, g;
              return W(function (m) {
                if (m.g == 1) return ((s = t), s.cryptoKey ? m.A(2) : _(m, s.fetchKey(), 3));
                if (((a = s.iv), !a))
                  for (
                    a = We(new ArrayBuffer(16)), c = s.firstMediaSequenceNumber + r, f = a.byteLength - 1;
                    f >= 0;
                    f--
                  )
                    ((a[f] = c & 255), (c >>= 8));
                return (
                  t.blockCipherMode == "CBC"
                    ? (g = { name: "AES-CBC", iv: a })
                    : (g = { name: "AES-CTR", counter: a, length: 64 }),
                  m.return(l.crypto.subtle.decrypt(g, s.cryptoKey, e))
                );
              });
            }
            function rl(e, t, r) {
              var s, a, c, f, g, m, x;
              return W(function (E) {
                switch (E.g) {
                  case 1:
                    return (
                      (s = sl(e)),
                      (a = cO.get(s))
                        ? E.return(a)
                        : ((c = 0),
                          (f = fn([e], r)),
                          q(E, 2),
                          (f.method = "HEAD"),
                          _(E, t.request(c, f).promise, 4))
                    );
                  case 4:
                    ((g = E.h), (a = g.headers["content-type"]), he(E, 3));
                    break;
                  case 2:
                    if (((m = ae(E)), !m || (m.code != 1002 && m.code != 1001))) {
                      E.A(3);
                      break;
                    }
                    return ((f.method = "GET"), _(E, t.request(c, f).promise, 6));
                  case 6:
                    ((x = E.h), (a = x.headers["content-type"]));
                  case 3:
                    return E.return(a ? a.toLowerCase().split(";").shift() : "");
                }
              });
            }
            function sl(e) {
              return (
                (e = new un(e).Sb.split("/").pop().split(".")),
                e.length == 1 ? "" : e.pop().toLowerCase()
              );
            }
            function ec(e, t, r, s, a) {
              return (
                (e = fn(e, s, a)),
                (t != 0 || r != null) && (e.headers.Range = r ? "bytes=" + t + "-" + r : "bytes=" + t + "-"),
                e
              );
            }
            var cO = new Map()
              .set("mp4", "video/mp4")
              .set("m4v", "video/mp4")
              .set("m4a", "audio/mp4")
              .set("webm", "video/webm")
              .set("weba", "audio/webm")
              .set("mkv", "video/webm")
              .set("ts", "video/mp2t")
              .set("ogv", "video/ogg")
              .set("ogg", "audio/ogg")
              .set("mpg", "video/mpeg")
              .set("mpeg", "video/mpeg")
              .set("mov", "video/quicktime")
              .set("m3u8", "application/x-mpegurl")
              .set("mpd", "application/dash+xml")
              .set("ism", "application/vnd.ms-sstr+xml")
              .set("mp3", "audio/mpeg")
              .set("aac", "audio/aac")
              .set("flac", "audio/flac")
              .set("wav", "audio/wav")
              .set("sbv", "text/x-subviewer")
              .set("srt", "text/srt")
              .set("vtt", "text/vtt")
              .set("webvtt", "text/vtt")
              .set("ttml", "application/ttml+xml")
              .set("lrc", "application/x-subtitle-lrc")
              .set("ssa", "text/x-ssa")
              .set("ass", "text/x-ssa")
              .set("jpeg", "image/jpeg")
              .set("jpg", "image/jpeg")
              .set("png", "image/png")
              .set("svg", "image/svg+xml")
              .set("webp", "image/webp")
              .set("avif", "image/avif")
              .set("html", "text/html")
              .set("htm", "text/html");
            function e1(e, t) {
              var r = this;
              ((this.g = t),
                (this.j = e),
                (this.i = null),
                (this.M = new Map()),
                (this.C = 1),
                (this.B = this.o = null),
                (this.V = 0),
                (this.h = new Map()),
                (this.N = !1),
                (this.X = null),
                (this.F = !1),
                (this.l = new Ka(function () {
                  return dO(r);
                })),
                (this.R = Date.now() / 1e3),
                (this.m = new Map()),
                (this.T = { projection: null, hfov: null }),
                (this.ba = 0),
                (this.$ = 1 / 0),
                (this.H = null),
                (this.O = []),
                (this.u = new it(function () {
                  if (r.j && r.g)
                    if (r.j.presentationTimeline.W()) {
                      var s = r.j.presentationTimeline.Zb(),
                        a = r.j.presentationTimeline.Gb();
                      a - s > 1 ? j2(r.g.Z, s, a) : r0(r.g.Z);
                    } else (r0(r.g.Z), r.u && r.u.stop());
                  else r.u && r.u.stop();
                })),
                (this.I = null),
                (this.J = !1),
                (this.K = new it(function () {
                  var s = r.g.video;
                  !s.ended && r.I && ((r.J = !0), (s.currentTime = r.I), (r.I = null));
                })),
                (this.G = new gt()));
            }
            ((d = e1.prototype),
              (d.destroy = function () {
                return this.l.destroy();
              }));
            function dO(e) {
              var t, r, s, a, c, f, g;
              return W(function (m) {
                if (m.g == 1) {
                  for (
                    e.u && e.u.stop(),
                      e.u = null,
                      e.K && e.K.stop(),
                      e.K = null,
                      e.G && (e.G.release(), (e.G = null)),
                      t = [],
                      r = I(e.h.values()),
                      s = r.next();
                    !s.done;
                    s = r.next()
                  )
                    ((a = s.value), _s(a), t.push(Vh(a)), a.ia && (Gr(a.ia), (a.ia = null)));
                  for (c = I(e.m.values()), f = c.next(); !f.done; f = c.next()) ((g = f.value), Gr(g));
                  return _(m, Promise.all(t), 2);
                }
                (e.h.clear(), e.m.clear(), (e.g = null), (e.j = null), (e.i = null), (e.I = null), K(m));
              });
            }
            d.configure = function (e) {
              if (
                ((this.i = e),
                (this.X = new RE(
                  {
                    maxAttempts: Math.max(e.retryParameters.maxAttempts, 2),
                    baseDelay: e.retryParameters.baseDelay,
                    backoffFactor: e.retryParameters.backoffFactor,
                    fuzzFactor: e.retryParameters.fuzzFactor,
                  },
                  !0,
                )),
                e.disableAudioPrefetch)
              ) {
                var t = this.h.get("audio");
                (t && t.ia && (Gr(t.ia), (t.ia = null)), (t = I(this.m.keys())));
                for (var r = t.next(); !r.done; r = t.next())
                  ((r = r.value), Gr(this.m.get(r)), this.m.delete(r));
              }
              for (
                e.disableTextPrefetch && (t = this.h.get(nt)) && t.ia && (Gr(t.ia), (t.ia = null)),
                  e.disableVideoPrefetch && (t = this.h.get("video")) && t.ia && (Gr(t.ia), (t.ia = null)),
                  t = I(this.h.keys()),
                  r = t.next();
                !r.done;
                r = t.next()
              )
                ((r = this.h.get(r.value)),
                  r.ia
                    ? (JA(r.ia, e.segmentPrefetchLimit),
                      e.segmentPrefetchLimit > 0 || (Gr(r.ia), (r.ia = null)))
                    : e.segmentPrefetchLimit > 0 && (r.ia = T0(this, r.stream)));
              e.disableAudioPrefetch || vO(this);
            };
            function hO(e, t, r) {
              e.j.presentationTimeline.W() || ((e.ba = t), (e.$ = r));
            }
            d.start = function (e) {
              var t = this;
              return W(function (r) {
                if (r.g == 1) return _(r, yO(t, e || new Map()), 2);
                (Nt(t.l), (t.N = !0), K(r));
              });
            };
            function fO(e, t) {
              var r, s, a, c, f, g;
              W(function (m) {
                switch (m.g) {
                  case 1:
                    return ((r = hn), e.V++, (s = e.V), q(m, 2), _(m, AA(e.g.Z, r.Na), 4));
                  case 4:
                    he(m, 3);
                    break;
                  case 2:
                    ((a = ae(m)), e.g && e.g.onError(a));
                  case 3:
                    ((c = tn(t.mimeType, t.codecs)),
                      kh(e.g.Z, c, e.j.sequenceMode, t.external),
                      (f = e.g.Z.ba),
                      (f.isTextVisible() || e.i.alwaysStreamText) &&
                        e.V == s &&
                        ((g = $h(e, t)), e.h.set(r.Na, g), ni(e, g, 0)),
                      K(m));
                }
              });
            }
            function pO(e) {
              var t = e.h.get(nt);
              (t &&
                (_s(t),
                Vh(t).catch(function () {}),
                (e.H = e.h.get(nt)),
                e.h.delete(nt),
                t.stream && t.stream.closeSegmentIndex && t.stream.closeSegmentIndex()),
                (e.B = null));
            }
            function t1(e, t) {
              for (var r = e.g.Ob() < 0, s = I(e.h.values()), a = s.next(); !a.done; a = s.next())
                ((a = a.value), a.ua && a.ua.Jd(r), a.ia && a.ia.Jd(r));
              for (s = I(e.m.values()), a = s.next(); !a.done; a = s.next()) a.value.Jd(r);
              (r = e.h.get("video")) &&
                (s = r.stream) &&
                (t
                  ? (t = s.trickModeVideo) && !r.Nc && (ol(e, t, !1, 0, !1), (r.Nc = s))
                  : (t = r.Nc) && ((r.Nc = null), ol(e, t, !0, 0, !1)));
            }
            function n1(e, t, r, s, a, c) {
              ((r = r === void 0 ? !1 : r),
                (s = s === void 0 ? 0 : s),
                (a = a === void 0 ? !1 : a),
                (c = c === void 0 ? !1 : c),
                (e.o = t),
                e.N && (t.video && ol(e, t.video, r, s, a, c), t.audio && ol(e, t.audio, r, s, a, c)));
            }
            function Bh(e, t) {
              W(function (r) {
                if (r.g == 1)
                  return (
                    (e.H = null),
                    (e.B = t),
                    e.N ? (t.segmentIndex ? r.A(2) : _(r, t.createSegmentIndex(), 2)) : r.return()
                  );
                (ol(e, t, !0, 0, !1), K(r));
              });
            }
            function gO(e) {
              var t = e.h.get(nt);
              t && ol(e, t.stream, !0, 0, !0);
            }
            function mO(e, t) {
              for (var r = I(e.M.entries()), s = r.next(); !s.done; s = r.next()) {
                var a = I(s.value);
                ((s = a.next().value), (a = a.next().value), s.includes(t.type) && (a(), e.M.delete(s)));
              }
            }
            function ol(e, t, r, s, a, c) {
              var f = e.h.get(t.type);
              f || t.type != nt
                ? f &&
                  (f.Nc && (t.trickModeVideo ? ((f.Nc = t), (t = t.trickModeVideo)) : (f.Nc = null)),
                  f.stream != t || a) &&
                  (e.m.has(t) ? (f.ia = e.m.get(t)) : f.ia && oO(f.ia, t),
                  t.type == nt &&
                    f.stream != t &&
                    ((a = tn(t.mimeType, t.codecs)), kh(e.g.Z, a, e.j.sequenceMode, t.external)),
                  !e.m.has(f.stream) &&
                    f.stream.closeSegmentIndex &&
                    (f.Ka
                      ? ((a = "(" + f.type + ":" + f.stream.id + ")"),
                        e.M.has(a) || e.M.set(a, f.stream.closeSegmentIndex))
                      : f.stream.closeSegmentIndex()),
                  (a = f.stream.isAudioMuxedInVideo != t.isAudioMuxedInVideo),
                  (f.stream = t),
                  (f.ua = null),
                  (f.gg = !!c),
                  t.dependencyStream ? (f.Fc = $h(e, t.dependencyStream)) : (f.Fc = null),
                  a1(e),
                  a &&
                    ((f.pb = null),
                    (f.tc = null),
                    (f.sc = null),
                    t.isAudioMuxedInVideo &&
                      ((t = null),
                      f.type === "video"
                        ? (t = e.h.get("audio"))
                        : f.type === "audio" && (t = e.h.get("video")),
                      t &&
                        (Vh(t).catch(function () {}),
                        (t.pb = null),
                        (t.tc = null),
                        (t.sc = null),
                        x0(e, t),
                        i1(e, t).catch(function (g) {
                          e.g && e.g.onError(g);
                        })))),
                  r
                    ? f.Wb
                      ? (f.Md = !0)
                      : f.Ka
                        ? ((f.Ub = !0), (f.ld = s), (f.Md = !0))
                        : (_s(f),
                          A0(e, f, !0, s).catch(function (g) {
                            e.g && e.g.onError(g);
                          }))
                    : f.Ka || f.qb || ni(e, f, 0),
                  i1(e, f).catch(function (g) {
                    e.g && e.g.onError(g);
                  }))
                : fO(e, t);
            }
            function i1(e, t) {
              var r, s, a;
              return W(function (c) {
                if (c.g == 1)
                  return t.Va
                    ? ((r = t.stream), (s = t.Va), r.segmentIndex ? c.A(2) : _(c, r.createSegmentIndex(), 2))
                    : c.return();
                if (c.g != 4)
                  return (
                    (a = r.dependencyStream),
                    !a || a.segmentIndex ? c.A(4) : _(c, a.createSegmentIndex(), 4)
                  );
                if (t.Va != s || t.stream != r) return c.return();
                var f = e.g.nc(),
                  g = sa(e.g.Z, t.type),
                  m = t.stream.segmentIndex.find(t.Ja ? t.Ja.endTime : f),
                  x = m == null ? null : t.stream.segmentIndex.get(m);
                ((m = x ? Wm(x) : null),
                  x &&
                    !m &&
                    (m = ((x.endTime - x.getStartTime()) * (t.stream.bandwidth || e.o.bandwidth)) / 8),
                  m
                    ? ((x = x.ea) && (m += (x.endByte ? x.endByte + 1 - x.startByte : null) || 0),
                      (x = e.g.getBandwidthEstimate()),
                      (f = (m * 8) / x < (g || 0) - f - e.i.rebufferingGoal || t.Va.h.g > m))
                    : (f = !0),
                  f && t.Va.abort(),
                  K(c));
              });
            }
            d.bd = function () {
              if (this.g) {
                for (var e = this.g.nc(), t = I(this.h.keys()), r = t.next(); !r.done; r = t.next()) {
                  var s = r.value;
                  r = this.h.get(s);
                  var a;
                  if (
                    ((a = !this.J) &&
                      ((a = this.g.Z),
                      s == nt
                        ? ((a = a.h), (a = a.g == null || a.h == null ? !1 : e >= a.g && e < a.h))
                        : ((a = el(a, s)), (a = zm(a, e))),
                      (a = !a)),
                    a)
                  ) {
                    if (((this.R = 0), r.ia && (r.ia.h = null), r.type === "audio")) {
                      a = I(this.m.values());
                      for (var c = a.next(); !c.done; c = a.next()) c.value.h = null;
                    }
                    ((r.ua = null),
                      (sa(this.g.Z, s) != null || r.Ka) && x0(this, r),
                      r.Va && (r.Va.abort(), (r.Va = null)),
                      s === nt && ((s = this.g.Z), s.K && s.K.Pd()),
                      (r.bd = !0));
                  }
                  !this.J || r.Wb || r.Ka || r.qb || ni(this, r, 0);
                }
                nc(this) && R0(this);
              }
            };
            function x0(e, t) {
              t.Wb ||
                t.Ub ||
                (t.Ka
                  ? ((t.Ub = !0), (t.ld = 0))
                  : i0(e.g.Z, t.type) == null
                    ? t.qb == null && ni(e, t, 0)
                    : (_s(t),
                      A0(e, t, !1, 0).catch(function (r) {
                        e.g && e.g.onError(r);
                      })));
            }
            function yO(e, t) {
              var r, s, a, c, f, g, m, x;
              return W(function (E) {
                if (E.g == 1) {
                  if (!e.o) throw new ee(2, 5, 5006);
                  return (
                    (r = Kh(e, !0)),
                    (s = e.g.Z),
                    _(E, s.init(r, e.j.sequenceMode, e.j.type, e.j.ignoreManifestTimestampsInSegmentsMode), 2)
                  );
                }
                for (Nt(e.l), e.updateDuration(), a = I(r.keys()), c = a.next(); !c.done; c = a.next())
                  ((f = c.value),
                    (g = r.get(f)),
                    e.h.has(f) ||
                      ((m = $h(e, g)),
                      t.has(g.id) &&
                        ((x = t.get(g.id)),
                        sO(x, function (A, R, b) {
                          return jh(A, R, b || null, e.i.retryParameters, e.g.vc);
                        }),
                        (m.ia = x)),
                      e.h.set(f, m),
                      ni(e, m, 0)));
                (a1(e), K(E));
              });
            }
            function $h(e, t) {
              var r = {
                stream: t,
                type: t.type,
                ua: null,
                ia: T0(e, t),
                Ja: null,
                pb: null,
                pf: null,
                tc: null,
                sc: null,
                mf: null,
                nf: null,
                Nc: null,
                endOfStream: !1,
                Ka: !1,
                qb: null,
                Ub: !1,
                ld: 0,
                Md: !1,
                Wb: !1,
                bd: !0,
                gg: !1,
                fh: !1,
                ce: !1,
                Va: null,
                Fc: null,
              };
              return (t.dependencyStream && (r.Fc = $h(e, t.dependencyStream)), r);
            }
            function T0(e, t) {
              if (
                (t.type === "video" && e.i.disableVideoPrefetch) ||
                (t.type === "audio" && e.i.disableAudioPrefetch) ||
                (t.type === nt &&
                  (t.mimeType == "application/cea-608" || t.mimeType == "application/cea-708")) ||
                (t.type === nt && e.i.disableTextPrefetch)
              )
                return null;
              if (e.m.has(t)) return e.m.get(t);
              var r = e.h.get(t.type);
              return (r = r && r.ia) && t === r.i
                ? r
                : e.i.segmentPrefetchLimit > 0
                  ? new Uh(
                      e.i.segmentPrefetchLimit,
                      t,
                      function (s, a, c) {
                        return jh(s, a, c || null, e.i.retryParameters, e.g.vc);
                      },
                      e.g.Ob() < 0,
                      e.g.hl,
                    )
                  : null;
            }
            function vO(e) {
              for (
                var t = e.i.segmentPrefetchLimit,
                  r = e.i.prefetchAudioLanguages,
                  s = I(e.j.variants),
                  a = s.next(),
                  c = {};
                !a.done;
                c = { Mb: void 0 }, a = s.next()
              )
                if (((c.Mb = a.value), c.Mb.audio))
                  if (e.m.has(c.Mb.audio)) {
                    if (
                      ((a = e.m.get(c.Mb.audio)),
                      JA(a, t),
                      !(
                        t > 0 &&
                        r.some(
                          (function (g) {
                            return function (m) {
                              return Ga(g.Mb.audio.language, m);
                            };
                          })(c),
                        )
                      ))
                    ) {
                      var f = e.h.get(c.Mb.audio.type);
                      (a !== (f && f.ia) && Gr(a), e.m.delete(c.Mb.audio));
                    }
                  } else
                    t <= 0 ||
                      !r.some(
                        (function (g) {
                          return function (m) {
                            return Ga(g.Mb.audio.language, m);
                          };
                        })(c),
                      ) ||
                      !(a = T0(e, c.Mb.audio)) ||
                      (c.Mb.audio.segmentIndex || c.Mb.audio.createSegmentIndex(), e.m.set(c.Mb.audio, a));
            }
            d.updateDuration = function () {
              var e = iA(),
                t = this.j.presentationTimeline.getDuration();
              t < 1 / 0
                ? (e && (this.u && this.u.stop(), r0(this.g.Z)), this.g.Z.Ab(t))
                : e
                  ? (this.u && this.u.Ea(0.5), this.g.Z.Ab(1 / 0))
                  : this.g.Z.Ab(4294967296);
            };
            function xO(e, t) {
              var r, s, a, c, f, g, m, x, E;
              return W(function (A) {
                switch (A.g) {
                  case 1:
                    if ((Nt(e.l), (r = hn), t.Ka || t.qb == null || t.Wb)) return A.return();
                    if (((t.qb = null), !t.Ub)) {
                      A.A(2);
                      break;
                    }
                    return _(A, A0(e, t, t.Md, t.ld), 3);
                  case 3:
                    return A.return();
                  case 2:
                    if ((mO(e, t), t.stream.segmentIndex)) {
                      A.A(4);
                      break;
                    }
                    return ((s = t.stream), q(A, 5), _(A, t.stream.createSegmentIndex(), 7));
                  case 7:
                    he(A, 6);
                    break;
                  case 5:
                    return ((a = ae(A)), _(A, I0(e, t, a), 8));
                  case 8:
                    return A.return();
                  case 6:
                    if (s != t.stream)
                      return (
                        s.closeSegmentIndex && s.closeSegmentIndex(),
                        t.Ka || t.qb || ni(e, t, 0),
                        A.return()
                      );
                  case 4:
                    if (!t.Fc) {
                      A.A(9);
                      break;
                    }
                    if (t.Fc.stream.segmentIndex) {
                      A.A(9);
                      break;
                    }
                    return (q(A, 11), _(A, t.Fc.stream.createSegmentIndex(), 13));
                  case 13:
                    he(A, 9);
                    break;
                  case 11:
                    ae(A);
                  case 9:
                    (q(A, 14), (c = TO(e, t)), c != null && (ni(e, t, c), (t.ce = !1)), he(A, 15));
                    break;
                  case 14:
                    return ((f = ae(A)), _(A, I0(e, t, f), 16));
                  case 16:
                    return A.return();
                  case 15:
                    if (t.type === r.Na) return A.return();
                    if (
                      ((g = []),
                      t.stream && !t.stream.isAudioMuxedInVideo && g.push(t),
                      (m = t.type === r.aa ? r.wa : r.aa),
                      (x = e.h.get(m)) && x.stream && !x.stream.isAudioMuxedInVideo && g.push(x),
                      !e.N ||
                        !g.every(function (R) {
                          return R.endOfStream;
                        }))
                    ) {
                      A.A(0);
                      break;
                    }
                    return _(A, e.g.Z.endOfStream(), 18);
                  case 18:
                    (Nt(e.l),
                      (E = e.g.Z.getDuration()),
                      E != 0 && E < e.j.presentationTimeline.getDuration() && e.j.presentationTimeline.Ab(E),
                      K(A));
                }
              });
            }
            function TO(e, t) {
              if (E0(t)) return (B2(e.g.Z, t.stream.originalId || ""), null);
              if ((t.type == nt && $2(e.g.Z), t.stream.isAudioMuxedInVideo && t.type == "audio")) return null;
              if (t.type != nt && uo(e.g.Z)) return (Hh(e, !0), null);
              var r = e.i.updateIntervalSeconds / Math.max(1, Math.abs(e.g.Ob()));
              if (!EA(e.g.Z) && t.type != nt) return r / 2;
              var s = e.g.nc();
              if (t.type === "audio")
                for (var a = I(e.m.keys()), c = a.next(); !c.done; c = a.next())
                  ((c = e.m.get(c.value)), c.Ya(s, !0), Ju(c, s));
              a = t.Ja ? t.Ja.endTime : s;
              var f = F2(e.g.Z, t.type, s);
              c = Math.max(1, Math.max(e.i.rebufferingGoal, e.i.bufferingGoal) * e.C);
              var g = e.j.presentationTimeline.getDuration() - a,
                m = sa(e.g.Z, t.type);
              if (g < 1e-6 && m)
                return (
                  (t.endOfStream = !0),
                  t.type == "video" && (r = e.h.get(nt)) && E0(r) && (r.endOfStream = !0),
                  null
                );
              if (((t.endOfStream = !1), f >= c)) return r / 2;
              if (((g = !t.ua), (m = r1(e, t, s, m)), !m))
                return ((e = 1 / 0), (t = t.Ja) && (e = t.endTime - t.startTime), Math.min(e / 2, r));
              f = t.pb;
              var x = m.ea;
              (f && x && Ku(x, f) && (f.g = x.g),
                (f = !1),
                g && t.gg && ((f = !0), (t.gg = !1)),
                (g = 1 / 0),
                (x = Array.from(e.h.values())),
                (x = I(x)));
              for (var E = x.next(); !E.done; E = x.next())
                ((E = E.value),
                  E0(E) || (E.ua && !E.ua.current()) || (g = Math.min(g, E.Ja ? E.Ja.endTime : s)));
              return a >= g + e.j.presentationTimeline.h
                ? r
                : (t.ia &&
                    t.ua &&
                    !e.m.has(t.stream) &&
                    (t.ia.Ya(m.startTime + 0.001), Ju(t.ia, m.startTime).catch(function () {})),
                  (nc(e) && wO(e, t, m)) ||
                    (SO(e, t, s, m, f).catch(function () {}), t.Fc && s1(e, t.Fc, s, c)),
                  null);
            }
            function r1(e, t, r, s) {
              if (t.ua)
                return (
                  (r = t.ua.current()) &&
                    t.Ja &&
                    Math.abs(t.Ja.startTime - r.startTime) < 0.001 &&
                    (r = t.ua.next().value),
                  r
                );
              if (t.Ja || s)
                return (
                  (r = t.Ja ? t.Ja.endTime : s),
                  (e = e.g.Ob() < 0),
                  t.stream.segmentIndex && (t.ua = t.stream.segmentIndex.Xb(r, !1, e)),
                  t.ua && t.ua.next().value
                );
              s = e.j.sequenceMode || nc(e) ? 0 : e.i.inaccurateManifestTolerance;
              var a = Math.max(r - s, 0);
              e = e.g.Ob() < 0;
              var c = null;
              return (
                s &&
                  (t.stream.segmentIndex && (t.ua = t.stream.segmentIndex.Xb(a, !1, e)),
                  (c = t.ua && t.ua.next().value)),
                c ||
                  (t.stream.segmentIndex && (t.ua = t.stream.segmentIndex.Xb(r, !1, e)),
                  (c = t.ua && t.ua.next().value)),
                c
              );
            }
            function SO(e, t, r, s, a) {
              var c, f, g, m, x, E, A, R, b, D, M, P, G, U, H, Q, ne;
              return W(function (z) {
                switch (z.g) {
                  case 1:
                    if (((c = hn), (f = t.stream), (g = t.ua), (t.Ka = !0), q(z, 2), s.Kc() == 2))
                      throw new ee(1, 1, 1011);
                    return _(z, AO(e, t, s, a), 4);
                  case 4:
                    return (
                      Nt(e.l),
                      e.F
                        ? z.return()
                        : ((m = f.mimeType == "video/mp4" || f.mimeType == "audio/mp4"),
                          (x = l.ReadableStream),
                          e.i.lowLatencyMode && e.j.isLowLatency && x && m && (e.j.type != "HLS" || s.o)
                            ? ((R = new Uint8Array(0)),
                              (D = b = !1),
                              (P = function (J) {
                                var X, ie, Z;
                                return W(function (re) {
                                  switch (re.g) {
                                    case 1:
                                      if (b || ((D = !0), Nt(e.l), e.F)) return re.return();
                                      if (
                                        (q(re, 2),
                                        (R = dn(R, J)),
                                        (X = !1),
                                        (ie = 0),
                                        new bt()
                                          .box("mdat", function (se) {
                                            ((ie = se.size + se.start), (X = !0));
                                          })
                                          .parse(R, !1, !0),
                                        !X)
                                      ) {
                                        re.A(4);
                                        break;
                                      }
                                      return (
                                        (Z = R.subarray(0, ie)),
                                        (R = R.subarray(ie)),
                                        _(re, S0(e, t, r, f, s, Z, !0, a), 5)
                                      );
                                    case 5:
                                      t.ia && t.ua && Ju(t.ia, s.startTime, !0);
                                    case 4:
                                      he(re, 0);
                                      break;
                                    case 2:
                                      ((M = ae(re)), K(re));
                                  }
                                });
                              }),
                              _(z, tc(e, t, s, P), 9))
                            : ((E = tc(e, t, s)), _(z, E, 7)))
                    );
                  case 7:
                    return (
                      (A = z.h),
                      Nt(e.l),
                      e.F
                        ? z.return()
                        : (Nt(e.l),
                          t.Ub
                            ? ((t.Ka = !1), ni(e, t, 0), z.return())
                            : _(z, S0(e, t, r, f, s, A, !1, a), 6))
                    );
                  case 9:
                    if (((G = z.h), M)) throw M;
                    if (D) {
                      z.A(10);
                      break;
                    }
                    return (
                      (b = !0),
                      Nt(e.l),
                      e.F
                        ? z.return()
                        : t.Ub
                          ? ((t.Ka = !1), ni(e, t, 0), z.return())
                          : _(z, S0(e, t, r, f, s, G, !1, a), 10)
                    );
                  case 10:
                    t.ia && t.ua && Ju(t.ia, s.startTime, !0);
                  case 6:
                    if ((Nt(e.l), e.F)) return z.return();
                    ((t.Ja = s),
                      g.next(),
                      (t.Ka = !1),
                      (t.fh = !1),
                      (U = e.g.Z.Gc()),
                      (H = U[t.type]),
                      JSON.stringify(H),
                      t.Ub ||
                        ((Q = null),
                        t.type === c.wa ? (Q = e.h.get(c.aa)) : t.type === c.aa && (Q = e.h.get(c.wa)),
                        Q && Q.type == c.aa
                          ? e.g.zd(s, t.stream, Q.stream.isAudioMuxedInVideo, !1)
                          : e.g.zd(s, t.stream, t.stream.codecs.includes(","), !1)),
                      _s(t),
                      ni(e, t, 0),
                      he(z, 0));
                    break;
                  case 2:
                    if (((ne = ae(z)), Nt(e.l, ne), e.F)) return z.return();
                    if (((t.Ka = !1), ne.code == 7001)) ((t.Ka = !1), _s(t), ni(e, t, 0), z.A(0));
                    else if (t.type == c.Na && e.i.ignoreTextStreamFailures) (e.h.delete(c.Na), z.A(0));
                    else
                      return ne.code == 3017
                        ? _(z, EO(e, t, ne), 0)
                        : ((t.ce = !0),
                          ne.category == 1 && t.ia && Zu(t.ia, s),
                          (ne.severity = 2),
                          _(z, I0(e, t, ne), 0));
                }
              });
            }
            function s1(e, t, r, s) {
              var a, c, f, g, m, x, E, A, R, b, D, M, P;
              return W(function (G) {
                switch (G.g) {
                  case 1:
                    for (
                      a = hn, c = t.stream, m = (g = (f = c.segmentIndex) && f.Xb(r)) && g.next().value;
                      m && e.O.includes(m.startTime);
                    )
                      m = g && g.next().value;
                    if (!m) {
                      G.A(0);
                      break;
                    }
                    if (((x = m.ea), !x || Ku(x, t.pb))) {
                      G.A(3);
                      break;
                    }
                    return ((t.pb = x), q(G, 4), _(G, tc(e, t, x), 6));
                  case 6:
                    E = G.h;
                    var U = e.g.Z;
                    (U.C && Yd(U.C, E, 0, c), (e.O = []), he(G, 3));
                    break;
                  case 4:
                    throw ((A = ae(G)), (t.pb = null), A);
                  case 3:
                    if (t.Ja && t.Ja == m) {
                      G.A(0);
                      break;
                    }
                    return ((t.Ja = m), q(G, 8), _(G, tc(e, t, m), 10));
                  case 10:
                    ((R = G.h), (U = e.g.Z), U.C && Yd(U.C, R, 0, c), e.O.push(m.startTime), he(G, 9));
                    break;
                  case 8:
                    throw ((b = ae(G)), (t.Ja = null), b);
                  case 9:
                    if (
                      (t.Ub ||
                        ((D = null),
                        t.type === a.wa ? (D = e.h.get(a.aa)) : t.type === a.aa && (D = e.h.get(a.wa)),
                        D && D.type == a.aa
                          ? e.g.zd(m, t.stream, D.stream.isAudioMuxedInVideo, !0)
                          : e.g.zd(m, t.stream, t.stream.codecs.includes(","), !0)),
                      (M = Math.max.apply(Math, [0].concat(V(e.O)))),
                      (P = e.g.nc()),
                      P + s > M)
                    )
                      return _(G, s1(e, t, m.startTime, s), 0);
                    G.A(0);
                }
              });
            }
            function EO(e, t, r) {
              var s, a, c, f, g, m, x;
              return W(function (E) {
                switch (E.g) {
                  case 1:
                    if (
                      ((s = Array.from(e.h.values())),
                      s.some(function (A) {
                        return A != t && A.fh;
                      }))
                    ) {
                      E.A(2);
                      break;
                    }
                    if (e.i.avoidEvictionOnQuotaExceededError)
                      return ((a = w0(e, r)), e.g.disableStream(t.stream, a) || ni(e, t, 4), E.return());
                    if (((c = Math.round(100 * e.C)), c > 20)) {
                      ((e.C -= 0.2), E.A(3));
                      break;
                    }
                    if (c > 4) {
                      ((e.C -= 0.04), E.A(3));
                      break;
                    }
                    if (((f = w0(e, r)), (g = e.g.disableStream(t.stream, f)), !g)) {
                      ((t.ce = !0), (e.F = !0), e.g.onError(r), E.A(5));
                      break;
                    }
                    return ((e.C = 1), (m = e.g.nc()), _(E, Gh(e, t, m), 5));
                  case 5:
                    return E.return();
                  case 3:
                    return ((t.fh = !0), (x = e.g.nc()), _(E, Gh(e, t, x), 2));
                  case 2:
                    (ni(e, t, 4), K(E));
                }
              });
            }
            function AO(e, t, r, s) {
              var a, c, f, g, m, x, E, A, R, b, D, M, P, G, U, H;
              return W(function (Q) {
                switch (Q.g) {
                  case 1:
                    if (
                      ((a = hn),
                      (c = t.Ja == null),
                      (f = []),
                      (g = Math.max(0, Math.max(r.appendWindowStart, e.ba) - 0.1)),
                      (m = Math.min(r.appendWindowEnd, e.$) + 0.1),
                      (x = r.codecs || t.stream.codecs),
                      (E = ro(x)),
                      (A = Pi(r.mimeType || t.stream.mimeType)),
                      (R = r.timestampOffset),
                      R == t.pf && g == t.tc && m == t.sc && E == t.mf && A == t.nf)
                    ) {
                      Q.A(2);
                      break;
                    }
                    if (((b = t.mf && t.nf && Y2(e.g.Z, t.type, A, x, Kh(e))), !b)) {
                      Q.A(3);
                      break;
                    }
                    if (
                      ((D = null),
                      t.type === a.wa ? (D = e.h.get(a.aa)) : t.type === a.aa && (D = e.h.get(a.wa)),
                      !D)
                    ) {
                      Q.A(3);
                      break;
                    }
                    return _(
                      Q,
                      Vh(D).catch(function () {}),
                      5,
                    );
                  case 5:
                    ((D.pb = null), (D.tc = null), (D.sc = null), x0(e, D));
                  case 3:
                    return _(Q, o1(e, t, R, g, m, r, E, A), 2);
                  case 2:
                    return (
                      Ku(r.ea, t.pb) ||
                        ((t.pb = r.ea),
                        r.l &&
                          r.ea &&
                          ((M = tc(e, t, r.ea)),
                          (P = function () {
                            var ne, z, J, X, ie, Z, re, se, me, fe, le;
                            return W(function (ue) {
                              switch (ue.g) {
                                case 1:
                                  return (q(ue, 2), _(ue, M, 4));
                                case 4:
                                  return (
                                    (ne = ue.h),
                                    Nt(e.l),
                                    (z = null),
                                    (J = new Map()),
                                    (X = { projection: null, hfov: null }),
                                    t.stream &&
                                      (ie = t.stream.videoLayout) &&
                                      ((Z = ie.split("/")),
                                      Z.includes("PROJ-RECT")
                                        ? (X.projection = "rect")
                                        : Z.includes("PROJ-EQUI")
                                          ? (X.projection = "equi")
                                          : Z.includes("PROJ-HEQU")
                                            ? (X.projection = "hequ")
                                            : Z.includes("PROJ-PRIM")
                                              ? (X.projection = "prim")
                                              : Z.includes("PROJ-AIV") && (X.projection = "hequ")),
                                    (re = new bt()),
                                    re
                                      .box("moov", Ze)
                                      .box("trak", Ze)
                                      .box("mdia", Ze)
                                      .S("mdhd", function (xe) {
                                        z = wh(xe.reader, xe.version).timescale;
                                      })
                                      .box("hdlr", function (xe) {
                                        switch (((xe = xe.reader), xe.skip(8), xe.Yc())) {
                                          case "soun":
                                            J.set(a.aa, z);
                                            break;
                                          case "vide":
                                            J.set(a.wa, z);
                                        }
                                        z = null;
                                      }),
                                    t.type !== a.wa ||
                                      X.projection ||
                                      re
                                        .box("minf", Ze)
                                        .box("stbl", Ze)
                                        .S("stsd", ws)
                                        .box("encv", Oi)
                                        .box("avc1", Oi)
                                        .box("avc3", Oi)
                                        .box("hev1", Oi)
                                        .box("hvc1", Oi)
                                        .box("dvav", Oi)
                                        .box("dva1", Oi)
                                        .box("dvh1", Oi)
                                        .box("dvhe", Oi)
                                        .box("dvc1", Oi)
                                        .box("dvi1", Oi)
                                        .box("vexu", Ze)
                                        .box("proj", Ze)
                                        .S("prji", function (xe) {
                                          ((xe = xe.reader.Yc()), (X.projection = xe));
                                        })
                                        .box("hfov", function (xe) {
                                          ((xe = xe.reader.U() / 1e3), (X.hfov = xe));
                                        }),
                                    re.parse(ne, !0, !0),
                                    t.type === a.wa && IO(e, X),
                                    J.has(t.type)
                                      ? (r.ea.timescale = J.get(t.type))
                                      : z != null && (r.ea.timescale = z),
                                    (se = t.stream.segmentIndex),
                                    se instanceof Qt && (me = eO(se, r.startTime)),
                                    (fe = t.stream.closedCaptions && t.stream.closedCaptions.size > 0),
                                    _(ue, e.g.Uh(t.type, ne), 5)
                                  );
                                case 5:
                                  return _(
                                    ue,
                                    Mh(e.g.Z, t.type, ne, null, t.stream, fe, t.bd, s, !1, !1, me),
                                    6,
                                  );
                                case 6:
                                  he(ue, 0);
                                  break;
                                case 2:
                                  throw ((le = ae(ue)), (t.pb = null), le);
                              }
                            });
                          }),
                          (G = r.startTime),
                          c && ((U = sa(e.g.Z, t.type)), U != null && (G = U)),
                          e.g.Fk(G, r.ea),
                          f.push(P()))),
                      (H = t.Ja ? t.Ja.i : -1),
                      r.i != H && f.push(G2(e.g.Z, t.type, r.startTime)),
                      _(Q, Promise.all(f), 0)
                    );
                }
              });
            }
            function o1(e, t, r, s, a, c, f, g) {
              var m, x, E, A, R;
              return W(function (b) {
                switch (b.g) {
                  case 1:
                    if (
                      ((m = hn),
                      (x = Kh(e)),
                      q(b, 2),
                      (t.tc = s),
                      (t.sc = a),
                      f && (t.mf = f),
                      g && (t.nf = g),
                      (t.pf = r),
                      (E = e.j.sequenceMode || e.j.type == "HLS"),
                      (A = null),
                      t.type === m.wa ? (A = e.h.get(m.aa)) : t.type === m.aa && (A = e.h.get(m.wa)),
                      !(A && A.stream && A.stream.isAudioMuxedInVideo))
                    ) {
                      b.A(4);
                      break;
                    }
                    return _(b, IA(e.g.Z, A.type, r, s, a, E, A.stream.mimeType, A.stream.codecs, x), 4);
                  case 4:
                    return _(
                      b,
                      IA(
                        e.g.Z,
                        t.type,
                        r,
                        s,
                        a,
                        E,
                        c.mimeType || t.stream.mimeType,
                        c.codecs || t.stream.codecs,
                        x,
                      ),
                      6,
                    );
                  case 6:
                    he(b, 0);
                    break;
                  case 2:
                    throw (
                      (R = ae(b)),
                      (t.tc = null),
                      (t.sc = null),
                      (t.mf = null),
                      (t.nf = null),
                      (t.pf = null),
                      R
                    );
                }
              });
            }
            function S0(e, t, r, s, a, c, f, g) {
              ((f = f === void 0 ? !1 : f), (g = g === void 0 ? !1 : g));
              var m, x, E, A;
              return W(function (R) {
                switch (R.g) {
                  case 1:
                    return (
                      (m = s.closedCaptions && s.closedCaptions.size > 0),
                      e.i.shouldFixTimestampOffset &&
                        ((x = s.mimeType == "video/mp4" || s.mimeType == "audio/mp4"),
                        (E = null),
                        a.ea && (E = a.ea.timescale),
                        x &&
                          E &&
                          s.type === "video" &&
                          e.j.type == "DASH" &&
                          new bt()
                            .box("moof", Ze)
                            .box("traf", Ze)
                            .S("tfdt", function (b) {
                              var D, M, P, G, U, H;
                              return W(function (Q) {
                                return (
                                  (D = Ih(b.reader, b.version)),
                                  (M = D.baseMediaDecodeTime),
                                  M
                                    ? ((P = -M / E),
                                      (G = Number(t.pf) || 0),
                                      G < P
                                        ? ((U = t.tc), (H = t.sc), _(Q, o1(e, t, P, U, H, a), 0))
                                        : Q.A(0))
                                    : Q.return()
                                );
                              });
                            })
                            .parse(c, !1, f)),
                      _(R, Gh(e, t, r), 2)
                    );
                  case 2:
                    return (Nt(e.l), (A = t.bd), (t.bd = !1), _(R, e.g.Uh(t.type, c), 3));
                  case 3:
                    return _(R, Mh(e.g.Z, t.type, c, a, s, m, A, g, f), 4);
                  case 4:
                    (Nt(e.l), K(R));
                }
              });
            }
            function Gh(e, t, r) {
              var s, a, c, f, g, m, x, E, A;
              return W(function (R) {
                if (R.g == 1)
                  return (
                    e.H == t && (e.H = null),
                    (s = t.stream.segmentIndex),
                    s instanceof Qt &&
                      (s.Ya(e.j.presentationTimeline.Hb()),
                      (a = []),
                      Z2(s, function (b) {
                        a.push(b.We());
                      })),
                    (c = Math.max(e.i.bufferBehind * e.C, e.j.presentationTimeline.h)),
                    (f = i0(e.g.Z, t.type)),
                    f == null
                      ? R.return()
                      : ((g = r - f),
                        (m = e.i.evictionGoal),
                        (x = e.j.presentationTimeline.Zb()),
                        (E = e.j.presentationTimeline.Gb()),
                        (A = g - c),
                        E - x > m && (A = Math.max(g - c, x - m - f)),
                        A <= m ? R.return() : _(R, e.g.Z.remove(t.type, f, f + A, a), 2))
                  );
                if (R.g != 4) return (Nt(e.l), e.H ? _(R, Gh(e, e.H, r), 4) : R.A(0));
                (Nt(e.l), K(R));
              });
            }
            function E0(e) {
              return (
                e &&
                e.type == nt &&
                (e.stream.mimeType == "application/cea-608" || e.stream.mimeType == "application/cea-708")
              );
            }
            function tc(e, t, r, s) {
              var a, c, f, g, m;
              return W(function (x) {
                switch (x.g) {
                  case 1:
                    if ((a = r.$b())) return x.return(a);
                    if (((c = null), t.ia)) {
                      var E = t.ia,
                        A = E.g;
                      (r instanceof Ai && (A = E.j),
                        A.has(r) ? ((E = A.get(r)), s && (E.Bh = s), (c = E.oe)) : (c = null));
                    }
                    return (
                      c || (c = jh(r, t.stream, s || null, e.i.retryParameters, e.g.vc)),
                      (f = 0),
                      t.ua && (f = t.ua.h),
                      (t.Va = c),
                      _(x, c.promise, 2)
                    );
                  case 2:
                    if (((g = x.h), (t.Va = null), (m = g.data), !r.aesKey)) {
                      x.A(3);
                      break;
                    }
                    return _(x, v0(m, r.aesKey, f), 4);
                  case 4:
                    m = x.h;
                  case 3:
                    return x.return(m);
                }
              });
            }
            function jh(e, t, r, s, a, c) {
              c = c === void 0 ? !1 : c;
              var f = e instanceof Be ? e : void 0,
                g = f ? 1 : 0;
              return (
                (e = ec(e.P(), e.startByte, e.endByte, s, r)),
                (e.contentType = t.type),
                a.request(or, e, { type: g, stream: t, segment: f, isPreload: c })
              );
            }
            function A0(e, t, r, s) {
              var a, c;
              return W(function (f) {
                if (f.g == 1)
                  return (
                    (t.Ub = !1),
                    (t.Md = !1),
                    (t.ld = 0),
                    (t.Wb = !0),
                    (t.Ja = null),
                    (t.ua = null),
                    t.ia && !e.m.has(t.stream) && Gr(t.ia),
                    s
                      ? ((a = e.g.nc()), (c = e.g.Z.getDuration()), _(f, e.g.Z.remove(t.type, a + s, c), 3))
                      : _(f, AA(e.g.Z, t.type), 4)
                  );
                if (f.g != 3) return (Nt(e.l), r ? _(f, e.g.Z.flush(t.type), 3) : f.A(3));
                (Nt(e.l), (t.Wb = !1), (t.endOfStream = !1), t.Ka || t.qb || ni(e, t, 0), K(f));
              });
            }
            function ni(e, t, r) {
              var s = t.type;
              (s != nt || e.h.has(s)) &&
                (t.qb = new Ou(function () {
                  var a;
                  return W(function (c) {
                    if (c.g == 1) return (q(c, 2), _(c, xO(e, t), 4));
                    if (c.g != 2) return he(c, 0);
                    ((a = ae(c)), e.g && e.g.onError(a), K(c));
                  });
                }).ka(r));
            }
            function _s(e) {
              e.qb != null && (e.qb.stop(), (e.qb = null));
            }
            function Vh(e) {
              return W(function (t) {
                return e.Va ? _(t, e.Va.abort(), 0) : t.A(0);
              });
            }
            function I0(e, t, r) {
              var s;
              return W(function (a) {
                if (a.g == 1)
                  return r.code == 3024 ? ((t.Ka = !1), _s(t), ni(e, t, 0), a.return()) : _(a, CE(e.X), 2);
                if ((Nt(e.l), r.category === 1 && r.code != 1003)) {
                  if (t.Nc) return (t1(e, !1), a.return());
                  ((s = w0(e, r)),
                    (r.handled = e.g.disableStream(t.stream, s)),
                    r.handled && (r.severity = 1));
                }
                ((!r.handled || r.code != 1011) && e.g.onError(r), r.handled || e.i.failureCallback(r), K(a));
              });
            }
            function w0(e, t) {
              return e.i.maxDisabledTime === 0 && t.code == 1011 ? 1 : e.i.maxDisabledTime;
            }
            function Hh(e, t) {
              t = t === void 0 ? !1 : t;
              var r, s, a, c, f, g;
              return W(function (m) {
                if (m.g == 1) {
                  if (((r = Date.now() / 1e3), (s = e.i.minTimeBetweenRecoveries), !t)) {
                    if (!e.i.allowMediaSourceRecoveries || r - e.R < s) return m.return(!1);
                    e.R = r;
                  }
                  return (
                    (a = hn),
                    (c = e.h.get(a.aa)) &&
                      (_s(c),
                      c.Va && (c.Va.abort(), (c.Va = null)),
                      (c.pb = null),
                      (c.tc = null),
                      (c.sc = null),
                      (c.Ka = !1),
                      (c.Ub = !1),
                      (c.ld = 0),
                      (c.Md = !1),
                      (c.Wb = !1),
                      c.ua && c.ua.jh()),
                    (f = e.h.get(a.wa)) &&
                      (_s(f),
                      f.Va && (f.Va.abort(), (f.Va = null)),
                      (f.pb = null),
                      (f.tc = null),
                      (f.sc = null),
                      (f.Ka = !1),
                      (f.Ub = !1),
                      (f.ld = 0),
                      (f.Md = !1),
                      (f.Wb = !1),
                      f.ua && f.ua.jh()),
                    (g = e.g.video.paused),
                    _(m, CA(e.g.Z, Kh(e)), 2)
                  );
                }
                return (
                  !f || f.Wb || f.Ka || f.qb || ni(e, f, 0),
                  !c || c.Wb || c.Ka || c.qb || ni(e, c, 0),
                  g || e.g.video.play(),
                  m.return(!0)
                );
              });
            }
            function IO(e, t) {
              if (e.T.projection != t.projection || e.T.hfov != t.hfov) {
                if (t.projection != null || t.hfov != null) {
                  var r = new Map().set("detail", t);
                  r = new Me("spatialvideoinfo", r);
                } else r = new Me("nospatialvideoinfo");
                ((r.cancelable = !0), e.g.onEvent(r), (e.T = t));
              }
            }
            function nc(e) {
              if (e.i.crossBoundaryStrategy !== "keep") return !0;
              var t = tt();
              if (t.Ib()) {
                if (!t.Nf()) {
                  for (t = I(e.h.keys()), r = t.next(); !r.done; r = t.next())
                    if (
                      ((r = e.h.get(r.value)),
                      r.type !== hn.Na && (r = r.stream) && r.fullMimeTypes && r.fullMimeTypes.size > 1)
                    ) {
                      for (e = new Set(), t = I(r.fullMimeTypes), r = t.next(); !r.done; r = t.next())
                        e.add(Du(r.value));
                      return e.size > 1;
                    }
                }
              } else {
                t = I(e.h.keys());
                for (var r = t.next(); !r.done; r = t.next())
                  if (
                    ((r = e.h.get(r.value)),
                    r.type !== hn.Na && (r = r.stream) && r.fullMimeTypes && r.fullMimeTypes.size > 1)
                  )
                    return !0;
              }
              return !1;
            }
            function a1(e) {
              (e.G.Qa(),
                nc(e) &&
                  (e.G.D(e.g.video, "waiting", function () {
                    return R0(e);
                  }),
                  e.G.D(e.g.video, "timeupdate", function () {
                    return R0(e);
                  })));
            }
            function R0(e) {
              if (nc(e)) {
                e.K.stop();
                var t = e.g.nc(),
                  r = e.h.get("video") || e.h.get("audio");
                r &&
                  (r = r.pb) &&
                  r.g !== null &&
                  ((t = r.g - t), t < 0 || t > 1 || ((e.I = r.g + 0.1), e.K.ka(t)));
              }
            }
            function wO(e, t, r) {
              if (t.type === nt) return !1;
              var s = t.pb;
              if (!s) return !1;
              var a = r.ea;
              if (
                ((r = s.g !== a.g),
                e.i.crossBoundaryStrategy === "reset_to_encrypted" &&
                  (s.encrypted || a.encrypted || (r = !1),
                  s.encrypted && (e.i.crossBoundaryStrategy = "keep")),
                e.i.crossBoundaryStrategy === "RESET_ON_ENCRYPTION_CHANGE" &&
                  s.encrypted == a.encrypted &&
                  (r = !1),
                e.i.crossBoundaryStrategy === "keep" && s.mimeType && a.mimeType)
              ) {
                var c = Kn(Ei(s.mimeType)),
                  f = Kn(Ei(s.mimeType));
                s.mimeType == a.mimeType && c == f && (r = !1);
              }
              return (
                r &&
                  (e.J || t.bd) &&
                  ((e.J = !1),
                  Hh(e, !0).then(function () {
                    var g = new Map().set("oldEncrypted", s.encrypted).set("newEncrypted", a.encrypted);
                    e.g.onEvent(new Me("boundarycrossed", g));
                  })),
                r
              );
            }
            function Kh(e, t) {
              function r(c) {
                if (c.fullMimeTypes && c.fullMimeTypes.size > 1 && e.h.has(c.type)) {
                  var f = e.h.get(c.type),
                    g = sa(e.g.Z, f.type),
                    m = e.g.nc();
                  (f = r1(e, f, m, g)) &&
                    f.codecs &&
                    f.mimeType &&
                    ((c.codecs = f.codecs), (c.mimeType = f.mimeType));
                }
              }
              t = t === void 0 ? !1 : t;
              var s = new Map(),
                a = e.o.audio;
              return (
                a && (r(a), s.set("audio", a)),
                (a = e.o.video) && (r(a), s.set("video", a)),
                t && e.B && s.set(nt, e.B),
                s
              );
            }
            function Wh() {}
            function C0(e, t, r, s, a) {
              var c = a in s,
                f = c
                  ? r.constructor == Object && Object.keys(s).length == 0
                  : r.constructor == Object && Object.keys(r).length == 0,
                g = c || f,
                m = !0,
                x;
              for (x in t) {
                var E = a + "." + x,
                  A = c ? s[a] : r[x];
                g || x in r
                  ? t[x] === void 0
                    ? A === void 0 || g
                      ? delete e[x]
                      : (e[x] = Ar(A))
                    : f
                      ? (e[x] = t[x])
                      : A.constructor == Object && t[x] && t[x].constructor == Object
                        ? (e[x] || (e[x] = Ar(A)), (E = C0(e[x], t[x], A, s, E)), (m = m && E))
                        : typeof t[x] != typeof A ||
                            t[x] == null ||
                            (typeof t[x] != "function" && t[x].constructor != A.constructor)
                          ? (Bt("Invalid config, wrong type for " + E), (m = !1))
                          : typeof r[x] == "function" && r[x].length != t[x].length
                            ? (He("Unexpected number of arguments for " + E), (e[x] = t[x]))
                            : (e[x] = Array.isArray(e[x]) ? t[x].slice() : t[x])
                  : (Bt("Invalid config, unrecognized key " + E), (m = !1));
              }
              return m;
            }
            function zh(e, t) {
              for (var r = {}, s = r, a = 0, c = 0; (a = e.indexOf(".", a)), !(a < 0); )
                ((a == 0 || e[a - 1] != "\\") &&
                  ((c = e.substring(c, a).replace(/\\\./g, ".")), (s[c] = {}), (s = s[c]), (c = a + 1)),
                  (a += 1));
              return ((s[e.substring(c).replace(/\\\./g, ".")] = t), r);
            }
            function al(e, t) {
              return e && t;
            }
            function l1(e, t) {
              function r(c) {
                for (var f = I(Object.keys(c)), g = f.next(); !g.done; g = f.next())
                  if (((g = g.value), !(c[g] instanceof HTMLElement)))
                    if (a(c[g]) && Object.keys(c[g]).length === 0) delete c[g];
                    else {
                      var m = c[g];
                      (Array.isArray(m) && m.length === 0) || typeof c[g] == "function"
                        ? delete c[g]
                        : a(c[g]) && (r(c[g]), Object.keys(c[g]).length === 0 && delete c[g]);
                    }
              }
              function s(c, f) {
                return Object.keys(c).reduce(function (g, m) {
                  var x = c[m];
                  return (
                    f.hasOwnProperty(m)
                      ? x instanceof HTMLElement && f[m] instanceof HTMLElement
                        ? x.isEqualNode(f[m]) || (g[m] = x)
                        : a(x) && a(f[m])
                          ? ((x = s(x, f[m])), (Object.keys(x).length > 0 || !a(x)) && (g[m] = x))
                          : Array.isArray(x) && Array.isArray(f[m])
                            ? nr(x, f[m]) || (g[m] = x)
                            : (Number.isNaN(x) && Number.isNaN(f[m])) || (x !== f[m] && (g[m] = x))
                      : (g[m] = x),
                    g
                  );
                }, {});
              }
              function a(c) {
                return c && typeof c == "object" && !Array.isArray(c);
              }
              return ((e = s(e, t)), r(e), e);
            }
            (Ee("shaka.util.ConfigUtils", Wh),
              (Wh.getDifferenceFromConfigObjects = l1),
              (Wh.convertToConfigObject = zh),
              (Wh.mergeConfigObjects = C0),
              Ee("shaka.config.RepeatMode", { OFF: 0, ALL: 1, SINGLE: 2 }));
            function Ii() {}
            function u1(e) {
              return ((e = Yr(e)), new un(e).Db);
            }
            function ic(e, t, r) {
              function s(g) {
                (Ti(c).setUint32(f, g.byteLength, !0), (f += 4), c.set(We(g), f), (f += g.byteLength));
              }
              if (!r || !r.byteLength) throw new ee(2, 6, 6015);
              var a;
              (typeof t == "string" ? (a = fm(t, !0)) : (a = t), (e = Yr(e)), (e = fm(e, !0)));
              var c = new Uint8Array(12 + e.byteLength + a.byteLength + r.byteLength),
                f = 0;
              return (s(e), s(a), s(r), c);
            }
            function L0(e, t, r) {
              return t !== "skd"
                ? e
                : ((t = r.serverCertificate), (r = Yr(e).split("skd://").pop()), ic(e, r, t));
            }
            function Yh(e, t) {
              e === 2 &&
                (e = t.drmInfo) &&
                Su(e.keySystem) &&
                (t.headers["Content-Type"] = "application/octet-stream");
            }
            (Ee("shaka.drm.FairPlay", Ii),
              (Ii.commonFairPlayResponse = function (e, t) {
                if (e === 2 && (e = t.originalRequest.drmInfo) && Su(e.keySystem)) {
                  try {
                    var r = zt(t.data);
                  } catch (a) {
                    return;
                  }
                  if (
                    ((e = !1),
                    (r = r.trim()),
                    r.substr(0, 5) === "<ckc>" &&
                      r.substr(-6) === "</ckc>" &&
                      ((r = r.slice(5, -6)), (e = !0)),
                    !e)
                  )
                    try {
                      var s = JSON.parse(r);
                      (s.ckc && ((r = s.ckc), (e = !0)),
                        s.CkcMessage && ((r = s.CkcMessage), (e = !0)),
                        s.License && ((r = s.License), (e = !0)));
                    } catch (a) {}
                  e && (t.data = ir(rr(r)));
                }
              }),
              (Ii.muxFairPlayRequest = function (e, t) {
                Yh(e, t);
              }),
              (Ii.expressplayFairPlayRequest = function (e, t) {
                if (e === 2) {
                  var r = t.drmInfo;
                  r && Su(r.keySystem) && Yh(e, t);
                }
              }),
              (Ii.conaxFairPlayRequest = function (e, t) {
                Yh(e, t);
              }),
              (Ii.ezdrmFairPlayRequest = function (e, t) {
                Yh(e, t);
              }),
              (Ii.verimatrixFairPlayRequest = function (e, t) {
                e === 2 &&
                  (e = t.drmInfo) &&
                  Su(e.keySystem) &&
                  ((e = We(t.body)),
                  (e = ps(e)),
                  (t.headers["Content-Type"] = "application/x-www-form-urlencoded"),
                  (t.body = Er("spc=" + e)));
              }),
              (Ii.muxInitDataTransform = function (e, t, r) {
                return L0(e, t, r);
              }),
              (Ii.expressplayInitDataTransform = function (e, t, r) {
                return L0(e, t, r);
              }),
              (Ii.conaxInitDataTransform = function (e, t, r) {
                if (t !== "skd") return e;
                ((t = r.serverCertificate),
                  (r = Yr(e).split("skd://").pop().split("?").shift()),
                  (r = l.atob(r)));
                var s = new ArrayBuffer(r.length * 2);
                s = OS(s);
                for (var a = 0, c = r.length; a < c; a++) s[a] = r.charCodeAt(a);
                return ic(e, s, t);
              }),
              (Ii.ezdrmInitDataTransform = function (e, t, r) {
                return t !== "skd"
                  ? e
                  : ((t = r.serverCertificate), (r = Yr(e).split(";").pop()), ic(e, r, t));
              }),
              (Ii.verimatrixInitDataTransform = function (e, t, r) {
                return L0(e, t, r);
              }),
              (Ii.initDataTransform = ic),
              (Ii.defaultGetContentId = u1),
              (Ii.isFairPlaySupported = function () {
                var e;
                return W(function (t) {
                  return t.g == 1
                    ? ((e = {
                        initDataTypes: ["cenc", "sinf", "skd"],
                        videoCapabilities: [{ contentType: 'video/mp4; codecs="avc1.42E01E"' }],
                      }),
                      q(t, 2),
                      _(t, navigator.requestMediaKeySystemAccess("com.apple.fps", [e]), 4))
                    : t.g != 2
                      ? t.return(!0)
                      : (ae(t), t.return(!1));
                });
              }));
            function Xh(e, t, r) {
              for (
                r = r === void 0 ? !0 : r,
                  this.h = e,
                  this.g = new Set([e]),
                  t = t || [],
                  e = I(t),
                  t = e.next();
                !t.done;
                t = e.next()
              )
                this.add(t.value, r);
            }
            ((Xh.prototype.add = function (e, t) {
              var r = this.h;
              t = t === void 0 ? !0 : t;
              var s;
              if (
                !(s = !!r.audio != !!e.audio || !!r.video != !!e.video || r.language != e.language) &&
                (s = r.audio && e.audio)
              ) {
                s = r.audio;
                var a = e.audio;
                s = !(
                  !(
                    ((!s.channelsCount || !a.channelsCount || s.channelsCount > 2 || a.channelsCount > 2) &&
                      s.channelsCount != a.channelsCount) ||
                    s.spatialAudio !== a.spatialAudio ||
                    (t && !c1(s, a))
                  ) &&
                  nr(s.roles, a.roles) &&
                  s.groupId === a.groupId
                );
              }
              return (
                !s &&
                  (s = r.video && e.video) &&
                  ((r = r.video), (s = e.video), (s = !((!t || c1(r, s)) && nr(r.roles, s.roles)))),
                s ? !1 : (this.g.add(e), !0)
              );
            }),
              (Xh.prototype.values = function () {
                return this.g.values();
              }));
            function c1(e, t) {
              return e.mimeType != t.mimeType
                ? !1
                : ((e = e.codecs.split(",").map(function (r) {
                    return ro(r);
                  })),
                  (t = t.codecs.split(",").map(function (r) {
                    return ro(r);
                  })),
                  nr(e, t));
            }
            Ee("shaka.media.AdaptationSet", Xh);
            function rc() {
              this.h = this.g = null;
            }
            ((rc.prototype.configure = function (e) {
              this.g = e;
            }),
              (rc.prototype.getConfiguration = function () {
                return this.g;
              }),
              (rc.prototype.create = function (e) {
                var t;
                if (this.g.language) {
                  var r = RO(e, this.g.language);
                  r.length && (t = r);
                }
                (t ||
                  ((t = e.filter(function (c) {
                    return c.primary;
                  })),
                  (t = t.length ? t : e)),
                  (e = CO(t, this.g.role)),
                  e.length && (t = e),
                  (e = LO(t, this.g.videoRole)),
                  e.length && (t = e),
                  this.g.videoLayout && ((e = MO(t, this.g.videoLayout)), e.length && (t = e)),
                  this.g.hdrLevel && ((e = kO(t, this.g.hdrLevel)), e.length && (t = e)));
                var s = [this.g.channelCount, this.g.preferredAudioChannelCount];
                if (
                  ((e = s.filter(function (c, f) {
                    return c && s.indexOf(c) === f;
                  })),
                  e.length)
                ) {
                  for (e = I(e), r = e.next(); !r.done; r = e.next())
                    if (((r = DO(t, r.value)), r.length)) {
                      t = r;
                      break;
                    }
                }
                (this.g.audioLabel && ((e = _O(t, this.g.audioLabel)), e.length && (t = e)),
                  this.g.videoLabel && ((e = bO(t, this.g.videoLabel)), e.length && (t = e)),
                  (e = PO(t, this.g.spatialAudio)),
                  e.length && (t = e));
                var a = [this.g.audioCodec, this.g.activeAudioCodec].concat(V(this.g.preferredAudioCodecs));
                if (
                  ((e = a.filter(function (c, f) {
                    return c && a.indexOf(c) === f;
                  })),
                  e.length)
                ) {
                  for (e = I(e), r = e.next(); !r.done; r = e.next())
                    if (((r = OO(t, r.value)), r.length)) {
                      t = r;
                      break;
                    }
                }
                return (
                  (e = tt()),
                  (e = this.g.codecSwitchingStrategy == "smooth" && e.Ib()),
                  (this.h = new Xh(t[0], t, !e))
                );
              }),
              (rc.prototype.getLastAdaptationSet = function () {
                return this.h;
              }));
            function RO(e, t) {
              t = At(t);
              var r = uh(
                t,
                e.map(function (s) {
                  return Dm(s);
                }),
              );
              return r
                ? e.filter(function (s) {
                    return r == Dm(s);
                  })
                : [];
            }
            function CO(e, t) {
              return e.filter(function (r) {
                return r.audio ? (t ? r.audio.roles.includes(t) : r.audio.roles.length == 0) : !1;
              });
            }
            function LO(e, t) {
              return e.filter(function (r) {
                return r.video ? (t ? r.video.roles.includes(t) : r.video.roles.length == 0) : !1;
              });
            }
            function _O(e, t) {
              return e.filter(function (r) {
                return r.audio && r.audio.label ? r.audio.label.toLowerCase() == t.toLowerCase() : !1;
              });
            }
            function bO(e, t) {
              return e.filter(function (r) {
                return r.video && r.video.label ? r.video.label.toLowerCase() == t.toLowerCase() : !1;
              });
            }
            function DO(e, t) {
              return e
                .filter(function (r) {
                  return !(r.audio && r.audio.channelsCount && r.audio.channelsCount > t);
                })
                .sort(function (r, s) {
                  return r.audio || s.audio
                    ? r.audio
                      ? s.audio
                        ? (s.audio.channelsCount || 0) - (r.audio.channelsCount || 0)
                        : 1
                      : -1
                    : 0;
                });
            }
            function kO(e, t) {
              if (t == "AUTO") {
                var r = e.some(function (s) {
                  return !!(s.video && s.video.hdr && s.video.hdr == "HLG");
                });
                t = tt().sd(r);
              }
              return e.filter(function (s) {
                return !(s.video && s.video.hdr && s.video.hdr != t);
              });
            }
            function MO(e, t) {
              return e.filter(function (r) {
                return !(r.video && r.video.videoLayout && r.video.videoLayout != t);
              });
            }
            function PO(e, t) {
              return e.filter(function (r) {
                return !(r.audio && r.audio.spatialAudio != t);
              });
            }
            function OO(e, t) {
              return e.filter(function (r) {
                return !(r.audio && r.audio.codecs != t);
              });
            }
            function qh() {}
            function ll() {
              var e = 1 / 0,
                t = tt();
              navigator.connection && navigator.connection.saveData && (e = 360);
              var r = {
                  retryParameters: wr(),
                  servers: {},
                  clearKeys: {},
                  advanced: {},
                  delayLicenseRequestUntilPlayed: !1,
                  persistentSessionOnlinePlayback: !1,
                  persistentSessionsMetadata: [],
                  initDataTransform: function (g, m, x) {
                    return (
                      l.shakaMediaKeysPolyfill === "apple" &&
                        m == "skd" &&
                        ((m = x.serverCertificate), (x = u1(g)), (g = ic(g, x, m))),
                      g
                    );
                  },
                  logLicenseExchange: !1,
                  updateExpirationTime: 1,
                  preferredKeySystems: [],
                  keySystemsMapping: {},
                  parseInbandPsshEnabled: !1,
                  minHdcpVersion: "",
                  ignoreDuplicateInitData: !0,
                  defaultAudioRobustnessForWidevine: "SW_SECURE_CRYPTO",
                  defaultVideoRobustnessForWidevine: "SW_SECURE_DECODE",
                },
                s = "reload";
              t.Ib() && (s = "smooth");
              var a = {
                  retryParameters: wr(),
                  availabilityWindowOverride: NaN,
                  disableAudio: !1,
                  disableVideo: !1,
                  disableText: !1,
                  disableThumbnails: !1,
                  disableIFrames: !1,
                  defaultPresentationDelay: 0,
                  segmentRelativeVttTiming: !1,
                  raiseFatalErrorOnManifestUpdateRequestFailure: !1,
                  continueLoadingWhenPaused: !0,
                  ignoreSupplementalCodecs: !1,
                  updatePeriod: -1,
                  ignoreDrmInfo: !1,
                  enableAudioGroups: !0,
                  dash: {
                    clockSyncUri: "",
                    disableXlinkProcessing: !0,
                    xlinkFailGracefully: !1,
                    ignoreMinBufferTime: !1,
                    autoCorrectDrift: !0,
                    initialSegmentLimit: 1e3,
                    ignoreSuggestedPresentationDelay: !1,
                    ignoreEmptyAdaptationSet: !1,
                    ignoreMaxSegmentDuration: !1,
                    keySystemsByURI: {
                      "urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b": "org.w3.clearkey",
                      "urn:uuid:e2719d58-a985-b3c9-781a-b030af78d30e": "org.w3.clearkey",
                      "urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed": "com.widevine.alpha",
                      "urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95": "com.microsoft.playready",
                      "urn:uuid:79f0049a-4098-8642-ab92-e65be0885f95": "com.microsoft.playready",
                      "urn:uuid:94ce86fb-07ff-4f43-adb8-93d2fa968ca2": "com.apple.fps",
                      "urn:uuid:3d5e6d35-9b9a-41e8-b843-dd3c6e72c42c": "com.huawei.wiseplay",
                    },
                    manifestPreprocessor: Qh,
                    manifestPreprocessorTXml: Jh,
                    sequenceMode: !1,
                    useStreamOnceInPeriodFlattening: !1,
                    enableFastSwitching: !0,
                  },
                  hls: {
                    ignoreTextStreamFailures: !1,
                    ignoreImageStreamFailures: !1,
                    defaultAudioCodec: "mp4a.40.2",
                    defaultVideoCodec: "avc1.42E01E",
                    ignoreManifestProgramDateTime: !1,
                    ignoreManifestProgramDateTimeForTypes: [],
                    mediaPlaylistFullMimeType: 'video/mp2t; codecs="avc1.42E01E, mp4a.40.2"',
                    liveSegmentsDelay: 3,
                    sequenceMode: t.fd(),
                    ignoreManifestTimestampsInSegmentsMode: !1,
                    disableCodecGuessing: !1,
                    disableClosedCaptionsDetection: !1,
                    allowLowLatencyByteRangeOptimization: !0,
                    allowRangeRequestsToGuessMimeType: !1,
                  },
                  mss: {
                    manifestPreprocessor: Qh,
                    manifestPreprocessorTXml: Jh,
                    sequenceMode: !1,
                    keySystemsBySystemId: {
                      "9a04f079-9840-4286-ab92-e65be0885f95": "com.microsoft.playready",
                      "79f0049a-4098-8642-ab92-e65be0885f95": "com.microsoft.playready",
                    },
                  },
                },
                c = {
                  trackSelectionCallback: function (g) {
                    return W(function (m) {
                      return m.return(g);
                    });
                  },
                  downloadSizeCallback: function (g) {
                    var m;
                    return W(function (x) {
                      return x.g == 1
                        ? navigator.storage && navigator.storage.estimate
                          ? _(x, navigator.storage.estimate(), 3)
                          : x.return(!0)
                        : ((m = x.h), x.return(m.usage + g < m.quota * 0.95));
                    });
                  },
                  progressCallback: function (g, m) {
                    return al([g, m]);
                  },
                  usePersistentLicense: !0,
                  numberOfParallelDownloads: 5,
                },
                f = {
                  drm: r,
                  manifest: a,
                  streaming: {
                    retryParameters: wr(),
                    failureCallback: function (g) {
                      return al([g]);
                    },
                    rebufferingGoal: 0,
                    bufferingGoal: 10,
                    bufferBehind: 30,
                    evictionGoal: 1,
                    ignoreTextStreamFailures: !1,
                    alwaysStreamText: !1,
                    startAtSegmentBoundary: !1,
                    gapDetectionThreshold: 0.5,
                    gapPadding: 0,
                    gapJumpTimerTime: 0.25,
                    durationBackoff: 1,
                    safeSeekOffset: 5,
                    safeSeekEndOffset: 0,
                    stallEnabled: !0,
                    stallThreshold: 1,
                    stallSkip: 0.1,
                    useNativeHlsForFairPlay: !0,
                    inaccurateManifestTolerance: 2,
                    lowLatencyMode: !0,
                    preferNativeDash: !1,
                    preferNativeHls: !1,
                    updateIntervalSeconds: 1,
                    observeQualityChanges: !1,
                    maxDisabledTime: 30,
                    segmentPrefetchLimit: 1,
                    prefetchAudioLanguages: [],
                    disableAudioPrefetch: !1,
                    disableTextPrefetch: !1,
                    disableVideoPrefetch: !1,
                    liveSync: {
                      enabled: !1,
                      targetLatency: 0.5,
                      targetLatencyTolerance: 0.5,
                      maxPlaybackRate: 1.1,
                      minPlaybackRate: 0.95,
                      panicMode: !1,
                      panicThreshold: 60,
                      dynamicTargetLatency: {
                        enabled: !1,
                        stabilityThreshold: 60,
                        rebufferIncrement: 0.5,
                        maxAttempts: 10,
                        maxLatency: 4,
                        minLatency: 1,
                      },
                    },
                    allowMediaSourceRecoveries: !0,
                    minTimeBetweenRecoveries: 5,
                    vodDynamicPlaybackRate: !1,
                    vodDynamicPlaybackRateLowBufferRate: 0.95,
                    vodDynamicPlaybackRateBufferRatio: 0.5,
                    preloadNextUrlWindow: 30,
                    loadTimeout: 30,
                    clearDecodingCache: !1,
                    dontChooseCodecs: !1,
                    shouldFixTimestampOffset: !1,
                    avoidEvictionOnQuotaExceededError: !1,
                    crossBoundaryStrategy: "keep",
                    returnToEndOfLiveWindowWhenOutside: !1,
                  },
                  networking: { forceHTTP: !1, forceHTTPS: !1, minBytesForProgressEvents: 16e3 },
                  mediaSource: {
                    codecSwitchingStrategy: s,
                    addExtraFeaturesToSourceBuffer: function (g) {
                      return al([g], "");
                    },
                    forceTransmux: !1,
                    insertFakeEncryptionInInit: !0,
                    correctEc3Enca: !1,
                    modifyCueCallback: function (g, m, x) {
                      return al([g, m, x]);
                    },
                    dispatchAllEmsgBoxes: !1,
                    useSourceElements: !0,
                    durationReductionEmitsUpdateEnd: !0,
                  },
                  offline: c,
                  abrFactory: function () {
                    return new qt();
                  },
                  adaptationSetCriteriaFactory: function () {
                    return new (Function.prototype.bind.apply(
                      rc,
                      [null].concat(V(Qe.apply(0, arguments))),
                    ))();
                  },
                  abr: {
                    enabled: !0,
                    useNetworkInformation: !0,
                    defaultBandwidthEstimate: 1e6,
                    switchInterval: 8,
                    bandwidthUpgradeTarget: 0.85,
                    bandwidthDowngradeTarget: 0.95,
                    restrictions: {
                      minWidth: 0,
                      maxWidth: 1 / 0,
                      minHeight: 0,
                      maxHeight: e,
                      minPixels: 0,
                      maxPixels: 1 / 0,
                      minFrameRate: 0,
                      maxFrameRate: 1 / 0,
                      minBandwidth: 0,
                      maxBandwidth: 1 / 0,
                      minChannelsCount: 0,
                      maxChannelsCount: 1 / 0,
                    },
                    advanced: { minTotalBytes: 128e3, minBytes: 16e3, fastHalfLife: 2, slowHalfLife: 5 },
                    restrictToElementSize: !1,
                    restrictToScreenSize: !1,
                    ignoreDevicePixelRatio: !1,
                    clearBufferSwitch: !1,
                    safeMarginSwitch: 0,
                    cacheLoadThreshold: 5,
                    minTimeToSwitch: 0,
                    preferNetworkInformationBandwidth: !1,
                    removeLatencyFromFirstPacketTime: !1,
                  },
                  autoShowText: 3,
                  preferredAudioLanguage: "",
                  preferredAudioLabel: "",
                  preferredTextLanguage: "",
                  preferredAudioRole: "",
                  preferredVideoRole: "",
                  preferredTextRole: "",
                  preferredAudioChannelCount: 2,
                  preferredVideoHdrLevel: "AUTO",
                  preferredVideoLayout: "",
                  preferredVideoLabel: "",
                  preferredVideoCodecs: [],
                  preferredAudioCodecs: [],
                  preferredTextFormats: [],
                  preferForcedSubs: !1,
                  preferSpatialAudio: !1,
                  preferredDecodingAttributes: [],
                  restrictions: {
                    minWidth: 0,
                    maxWidth: 1 / 0,
                    minHeight: 0,
                    maxHeight: 1 / 0,
                    minPixels: 0,
                    maxPixels: 1 / 0,
                    minFrameRate: 0,
                    maxFrameRate: 1 / 0,
                    minBandwidth: 0,
                    maxBandwidth: 1 / 0,
                    minChannelsCount: 0,
                    maxChannelsCount: 1 / 0,
                  },
                  playRangeStart: 0,
                  playRangeEnd: 1 / 0,
                  textDisplayer: { captionsUpdatePeriod: 0.25, fontScaleFactor: 1 },
                  textDisplayFactory: function () {
                    return null;
                  },
                  cmcd: {
                    enabled: !1,
                    sessionId: "",
                    contentId: "",
                    rtpSafetyFactor: 5,
                    useHeaders: !1,
                    includeKeys: [],
                    version: 1,
                    targets: [],
                  },
                  cmsd: {
                    enabled: !0,
                    applyMaximumSuggestedBitrate: !0,
                    estimatedThroughputWeightRatio: 0.5,
                  },
                  lcevc: {
                    enabled: !1,
                    dynamicPerformanceScaling: !0,
                    logLevel: 0,
                    drawLogo: !1,
                    poster: !0,
                  },
                  ads: {
                    customPlayheadTracker: !1,
                    skipPlayDetection: !1,
                    supportsMultipleMediaElements: !0,
                    disableHLSInterstitial: !1,
                    disableDASHInterstitial: !1,
                    allowPreloadOnDomElements: !0,
                    allowStartInMiddleOfInterstitial: !0,
                  },
                  ignoreHardwareResolution: !1,
                  queue: { preloadNextUrlWindow: 1 / 0, preloadPrevItem: !0, repeatMode: 0 },
                };
              return (
                (c.trackSelectionCallback = function (g) {
                  return W(function (m) {
                    return m.return(NO(g, f.preferredAudioLanguage, f.preferredVideoHdrLevel));
                  });
                }),
                t.Wa(f)
              );
            }
            function d1() {
              return {
                streaming: {
                  inaccurateManifestTolerance: 0,
                  segmentPrefetchLimit: 2,
                  updateIntervalSeconds: 0.1,
                  maxDisabledTime: 1,
                  retryParameters: { baseDelay: 100 },
                },
                manifest: { dash: { autoCorrectDrift: !1 }, retryParameters: { baseDelay: 100 } },
                drm: { retryParameters: { baseDelay: 100 } },
              };
            }
            function bs(e, t, r) {
              var s = {
                ".drm.keySystemsMapping": "",
                ".drm.servers": "",
                ".drm.clearKeys": "",
                ".drm.advanced": {
                  distinctiveIdentifierRequired: !1,
                  persistentStateRequired: !1,
                  videoRobustness: [],
                  audioRobustness: [],
                  sessionType: "",
                  serverCertificate: new Uint8Array(0),
                  serverCertificateUri: "",
                  individualizationServer: "",
                  headers: {},
                },
              };
              return C0(e, t, r || ll(), s, "");
            }
            function NO(e, t, r) {
              var s = r;
              s == "AUTO" &&
                ((r = e.some(function (g) {
                  return !!(g.hdr && g.hdr == "HLG");
                })),
                (s = tt().sd(r)));
              var a = e.filter(function (g) {
                return !(g.type != "variant" || (g.hdr && g.hdr != s));
              });
              r = [];
              var c = uh(
                t,
                a.map(function (g) {
                  return g.language;
                }),
              );
              (c &&
                (r = a.filter(function (g) {
                  return At(g.language) == c;
                })),
                r.length == 0 &&
                  (r = a.filter(function (g) {
                    return g.primary;
                  })),
                r.length == 0 &&
                  (a.map(function (g) {
                    return g.language;
                  }),
                  (r = a)));
              var f = r.filter(function (g) {
                return g.height && g.height <= 480;
              });
              for (
                f.length &&
                  (f.sort(function (g, m) {
                    return m.height - g.height;
                  }),
                  (r = f.filter(function (g) {
                    return g.height == f[0].height;
                  }))),
                  t = [],
                  r.length &&
                    ((a = Math.floor(r.length / 2)),
                    r.sort(function (g, m) {
                      return g.bandwidth - m.bandwidth;
                    }),
                    t.push(r[a])),
                  e = I(e),
                  r = e.next();
                !r.done;
                r = e.next()
              )
                ((r = r.value), (r.type != nt && r.type != "image") || t.push(r));
              return t;
            }
            function Qh(e) {
              return al([e], e);
            }
            function Jh(e) {
              return al([e], e);
            }
            (Ee("shaka.util.PlayerConfiguration", qh),
              (qh.mergeConfigObjects = bs),
              (qh.createDefaultForLL = d1),
              (qh.createDefault = ll));
            function FO() {
              ((this.g = null), (this.h = []));
            }
            function _0(e, t) {
              var r = 0;
              (e.g && e.g.state == t && (r += e.g.duration), (e = I(e.h)));
              for (var s = e.next(); !s.done; s = e.next())
                ((s = s.value), (r += s.state == t ? s.duration : 0));
              return r;
            }
            function UO(e) {
              function t(c) {
                return { timestamp: c.timestamp, state: c.state, duration: c.duration };
              }
              for (var r = [], s = I(e.h), a = s.next(); !a.done; a = s.next()) r.push(t(a.value));
              return (e.g && r.push(t(e.g)), r);
            }
            function BO() {
              ((this.i = this.h = null), (this.g = []));
            }
            function b0(e, t, r) {
              e.i != t &&
                ((e.i = t),
                e.g.push({
                  timestamp: Date.now() / 1e3,
                  id: t.id,
                  type: "text",
                  fromAdaptation: r,
                  bandwidth: null,
                }));
            }
            function Zh() {
              ((this.C = this.X = NaN),
                (this.l = ""),
                (this.j =
                  this.wi =
                  this.u =
                  this.B =
                  this.K =
                  this.F =
                  this.o =
                  this.m =
                  this.J =
                  this.G =
                  this.i =
                  this.T =
                  this.V =
                  this.N =
                  this.O =
                  this.R =
                    NaN),
                (this.M = 0),
                (this.H = this.I = NaN),
                (this.g = new FO()),
                (this.h = new BO()));
            }
            function $O(e, t, r) {
              ((e.R = t), (e.O = r));
            }
            function h1(e, t, r) {
              ((e.X = t), (e.C = r));
            }
            function GO(e, t) {
              e.i = isNaN(e.i) ? t : Math.max(e.i, t);
            }
            function f1(e, t) {
              e.j = isNaN(e.j) ? t : e.j + t;
            }
            function jO(e) {
              var t = e.X,
                r = e.C,
                s = e.l,
                a = e.B,
                c = e.O,
                f = e.R,
                g = e.N,
                m = e.V,
                x = e.T,
                E = e.u,
                A = e.i,
                R = e.G,
                b = e.J,
                D = e.m,
                M = _0(e.g, "playing"),
                P = _0(e.g, "paused"),
                G = _0(e.g, "buffering"),
                U = e.o,
                H = e.F,
                Q = e.K,
                ne = e.wi,
                z = e.j,
                J = e.M,
                X = e.I,
                ie = e.H,
                Z = UO(e.g),
                re = [];
              e = I(e.h.g);
              for (var se = e.next(); !se.done; se = e.next())
                ((se = se.value),
                  re.push({
                    timestamp: se.timestamp,
                    id: se.id,
                    type: se.type,
                    fromAdaptation: se.fromAdaptation,
                    bandwidth: se.bandwidth,
                  }));
              return {
                width: t,
                height: r,
                currentCodecs: s,
                streamBandwidth: a,
                decodedFrames: c,
                droppedFrames: f,
                corruptedFrames: g,
                stallsDetected: m,
                gapsJumped: x,
                estimatedBandwidth: E,
                completionPercent: A,
                loadLatency: R,
                manifestTimeSeconds: b,
                drmTimeSeconds: D,
                playTime: M,
                pauseTime: P,
                bufferingTime: G,
                licenseTime: U,
                liveLatency: H,
                maxSegmentDuration: Q,
                manifestSizeBytes: ne,
                bytesDownloaded: z,
                nonFatalErrorCount: J,
                manifestPeriodCount: X,
                manifestGapCount: ie,
                stateHistory: Z,
                switchHistory: re,
              };
            }
            function lr(e, t, r, s) {
              (Lt.call(this),
                (this.N = e),
                (this.V = t),
                (this.Da = s.networkingEngine),
                (this.o = r),
                (this.C = null),
                (this.za = 0),
                (this.Ta = s.md),
                (this.G = s.yk),
                (this.Ua = s.zk),
                (this.g = s.config),
                (this.m = this.H = this.h = null),
                (this.oa = !1),
                (this.I = s.Kk),
                (this.va = !1),
                (this.j = null),
                (this.ba = !1),
                (this.u = null),
                (this.M = new Map()),
                (this.ya = !1),
                (this.Fa = s.Jk),
                (this.X = new Zh()),
                (this.ma = new _t()),
                (this.B = new _t()),
                (this.O = null),
                (this.l = !1),
                (this.$ = s.pj),
                (this.T = this.i = null),
                (this.R = !1),
                (this.K = []),
                (this.J = []),
                (this.F = !0));
            }
            N(lr, Lt);
            function sc(e, t, r) {
              (e = t ? e.J : e.K) ? e.push(r) : r();
            }
            function VO(e) {
              if (e.J) for (var t = I(e.J), r = t.next(); !r.done; r = t.next()) ((r = r.value), r());
              e.J = null;
            }
            function p1(e, t) {
              if (((e.O = t), (e.R = !0), e.K)) {
                t = I(e.K);
                for (var r = t.next(); !r.done; r = t.next()) ((r = r.value), r());
              }
              e.K = null;
            }
            ((d = lr.prototype),
              (d.getStartTime = function () {
                return this.o;
              }),
              (d.rd = function () {
                return this.N;
              }),
              (d.Lg = function () {
                return this.h;
              }));
            function HO(e) {
              return ((e.va = !0), e.I);
            }
            d.getStats = function () {
              return this.X;
            };
            function KO(e) {
              return ((e.ba = !0), e.j);
            }
            ((d.Vj = function () {
              return this.i ? qo(this.i) : null;
            }),
              (d.Uj = function () {
                return this.T ? Qo(this.T) : null;
              }));
            function WO(e) {
              return ((e.ya = !0), e.M);
            }
            ((d.start = function () {
              var e = this;
              (function () {
                var t;
                return W(function (r) {
                  switch (r.g) {
                    case 1:
                      return _(r, Promise.resolve(), 2);
                    case 2:
                      return (q(r, 3), _(r, zO(e), 5));
                    case 5:
                      if ((ho(e), l.shakaMediaKeysPolyfill === "webkit")) {
                        r.A(6);
                        break;
                      }
                      return _(r, g1(e), 7);
                    case 7:
                      ho(e);
                    case 6:
                      return _(r, XO(e), 8);
                    case 8:
                      if ((ho(e), !e.$)) {
                        r.A(9);
                        break;
                      }
                      return _(r, qO(e), 10);
                    case 10:
                      ho(e);
                    case 9:
                      if (!e.$ || !e.j) {
                        r.A(11);
                        break;
                      }
                      return _(r, QP(e.j), 12);
                    case 12:
                      ho(e);
                    case 11:
                      (e.B.resolve(), he(r, 0));
                      break;
                    case 3:
                      ((t = ae(r)),
                        (t instanceof ee && (t.code == 7001 || t.code == 7003)) || e.B.reject(t),
                        K(r));
                  }
                });
              })();
            }),
              (d.dispatchEvent = function (e) {
                return this.O ? this.O.dispatchEvent(e) : Lt.prototype.dispatchEvent.call(this, e);
              }),
              (d.onError = function (e) {
                e.severity === 2 && (this.B.reject(e), this.destroy());
                var t = new Map().set("detail", e);
                ((t = new Me("error", t)), this.dispatchEvent(t), t.defaultPrevented && (e.handled = !0));
              }));
            function ho(e) {
              if (e.l) throw new ee(2, 7, 7003);
            }
            function D0(e, t) {
              e.dispatchEvent(new Me("onstatechange", new Map().set("state", t)));
            }
            function zO(e) {
              var t, r, s, a, c, f;
              return W(function (g) {
                switch (g.g) {
                  case 1:
                    if (
                      (D0(e, "manifest-parser"),
                      e.m ||
                        ((e.H = VS(e.N, e.V)),
                        (e.m = e.H()),
                        e.m.configure(e.g.manifest, function () {
                          return e.F;
                        })),
                      (t = Date.now() / 1e3),
                      D0(e, "manifest"),
                      e.h)
                    ) {
                      g.A(2);
                      break;
                    }
                    return _(g, e.m.start(e.N, e.Ua), 3);
                  case 3:
                    return ((e.h = g.h), y1(e.h), _(g, YO(e), 2));
                  case 2:
                    return (
                      e.ma.resolve(),
                      (r = new Me("manifestparsed", void 0)),
                      _(g, Promise.resolve(), 5)
                    );
                  case 5:
                    if ((e.dispatchEvent(r), e.h.variants.length == 0)) throw new ee(2, 4, 4036);
                    if ((y1(e.h), (s = JE(e.G, e.h)), !s)) {
                      g.A(6);
                      break;
                    }
                    return ((a = new Me("trackschanged", void 0)), _(g, Promise.resolve(), 7));
                  case 7:
                    (ho(e), e.dispatchEvent(a));
                  case 6:
                    ((c = Date.now() / 1e3), (f = c - t), (e.X.J = f), K(g));
                }
              });
            }
            function g1(e, t) {
              var r, s, a, c;
              return W(function (f) {
                switch (f.g) {
                  case 1:
                    return !e.h || e.j
                      ? f.return()
                      : (D0(e, "drm-engine"),
                        (e.za = Date.now() / 1e3),
                        (e.j = e.Ta()),
                        (e.G.g = e.j),
                        e.j.configure(e.g.drm, function () {
                          return e.F;
                        }),
                        (r = fh(e.h.variants)),
                        (s = !0),
                        e.h && e.h.presentationTimeline && (s = e.h.presentationTimeline.W()),
                        _(f, BE(e.j, r, e.h.offlineSessionIds, s), 2));
                  case 2:
                    if ((ho(e), !t)) {
                      f.A(3);
                      break;
                    }
                    return _(f, e.j.Vb(t), 4);
                  case 4:
                    ho(e);
                  case 3:
                    return _(f, QE(e.G, e.h), 5);
                  case 5:
                    if (((a = f.h), !a)) {
                      f.A(0);
                      break;
                    }
                    return ((c = new Me("trackschanged", void 0)), _(f, Promise.resolve(), 7));
                  case 7:
                    (e.dispatchEvent(c), K(f));
                }
              });
            }
            ((d.configure = function (e, t) {
              ((e = zh(e, t)), bs(this.g, e));
            }),
              (d.getConfiguration = function () {
                return Ar(this.g);
              }));
            function YO(e) {
              return W(function (t) {
                return (
                  e.C ||
                    ((e.C = e.g.adaptationSetCriteriaFactory()),
                    e.C.configure({
                      language: e.g.preferredAudioLanguage,
                      role: e.g.preferredAudioRole,
                      videoRole: e.g.preferredVideoRole,
                      channelCount: 0,
                      hdrLevel: e.g.preferredVideoHdrLevel,
                      spatialAudio: e.g.preferSpatialAudio,
                      videoLayout: e.g.preferredVideoLayout,
                      audioLabel: e.g.preferredAudioLabel,
                      videoLabel: e.g.preferredVideoLabel,
                      codecSwitchingStrategy: e.g.mediaSource.codecSwitchingStrategy,
                      audioCodec: "",
                      activeAudioCodec: "",
                      activeAudioChannelCount: 0,
                      preferredAudioCodecs: e.g.preferredAudioCodecs,
                      preferredAudioChannelCount: e.g.preferredAudioChannelCount,
                    })),
                  e.i || !e.h.variants.length || (e.h.variants.length != 1 && e.h.type != "HLS")
                    ? t.A(0)
                    : ((e.i = k0(e)), e.i ? _(t, m1(e.i), 0) : t.A(0))
                );
              });
            }
            function XO(e) {
              return W(function (t) {
                return t.g == 1
                  ? !e.i || e.h.variants.includes(e.i)
                    ? t.A(0)
                    : _(t, QO(e.i), 3)
                  : ((e.i = k0(e)), e.i ? _(t, m1(e.i), 0) : t.A(0));
              });
            }
            function qO(e) {
              var t, r, s, a, c;
              return W(function (f) {
                return (
                  !e.i && (t = k0(e)) && (e.i = t),
                  e.i
                    ? ((r = e.h.presentationTimeline.W()),
                      (s = []),
                      (a = e.i),
                      a.video && s.push(M0(e, a.video, r)),
                      a.audio && s.push(M0(e, a.audio, r)),
                      (c =
                        ja(
                          e.h.textStreams,
                          e.g.preferredTextLanguage,
                          e.g.preferredTextRole,
                          e.g.preferForcedSubs,
                        )[0] || null) &&
                        AE(a.audio, c, e.g) &&
                        (s.push(M0(e, c, r)), (e.T = c)),
                      _(f, Promise.all(s), 0))
                    : f.A(0)
                );
              });
            }
            function k0(e) {
              if (!e.u) {
                var t = e.g.abrFactory;
                ((e.u = t()), e.u.configure(e.g.abr));
              }
              return (
                (t = fh(e.h.variants)),
                (t = e.C.create(t)),
                e.u.setVariants(Array.from(t.values())),
                e.u.chooseVariant(!0)
              );
            }
            function M0(e, t, r) {
              var s, a, c, f, g;
              return W(function (m) {
                return m.g == 1
                  ? ((s = e.g.streaming.segmentPrefetchLimit || 2),
                    (a = new Uh(
                      s,
                      t,
                      function (x, E, A) {
                        return jh(x, E, A || null, e.g.streaming.retryParameters, e.Da, e.F);
                      },
                      !1,
                    )),
                    e.M.set(t.id, a),
                    t.segmentIndex ? m.A(2) : _(m, t.createSegmentIndex(), 2))
                  : ((c = typeof e.o == "number" ? e.o : 0),
                    (f = t.segmentIndex.Xb(c)),
                    (g = null),
                    f && ((g = f.current()), g || (g = f.next().value)),
                    g || (g = $r(t.segmentIndex)),
                    g ? (r ? (g.ea ? _(m, qA(a, g.ea), 0) : m.A(0)) : _(m, Ju(a, g.startTime), 0)) : m.A(0));
              });
            }
            function m1(e) {
              var t, r, s, a;
              return W(function (c) {
                for (t = [], r = I([e.video, e.audio]), s = r.next(); !s.done; s = r.next())
                  (a = s.value) && !a.segmentIndex && t.push(a.createSegmentIndex());
                return t.length > 0 ? _(c, Promise.all(t), 0) : c.A(0);
              });
            }
            function QO(e) {
              var t, r, s, a;
              return W(function (c) {
                for (t = [], r = I([e.video, e.audio]), s = r.next(); !s.done; s = r.next())
                  (a = s.value) && a.segmentIndex && a.closeSegmentIndex && t.push(a.closeSegmentIndex());
                return t.length > 0 ? _(c, Promise.all(t), 0) : c.A(0);
              });
            }
            ((d.rl = function () {
              return this.B;
            }),
              (d.destroy = function () {
                var e = this,
                  t,
                  r,
                  s;
                return W(function (a) {
                  if (a.g == 1) return ((e.l = !0), !e.m || e.oa ? a.A(2) : _(a, e.m.stop(), 2));
                  if (a.g != 4)
                    return (
                      e.u && e.u.release(),
                      e.I && !e.va && e.I.release(),
                      !e.j || e.ba ? a.A(4) : _(a, e.j.destroy(), 4)
                    );
                  if (e.M.size > 0 && !e.ya)
                    for (t = I(e.M.values()), r = t.next(); !r.done; r = t.next()) ((s = r.value), Gr(s));
                  K(a);
                });
              }));
            function y1(e) {
              function t(r) {
                return (r.video && r.audio) || (r.video && r.video.codecs.includes(","));
              }
              e.variants.some(t) && (e.variants = e.variants.filter(t));
            }
            (Ee("shaka.media.PreloadManager", lr),
              (lr.prototype.destroy = lr.prototype.destroy),
              (lr.prototype.waitForFinish = lr.prototype.rl),
              (lr.prototype.getPrefetchedTextTrack = lr.prototype.Uj),
              (lr.prototype.getPrefetchedVariantTrack = lr.prototype.Vj));
            function oa(e, t) {
              Lt.call(this);
              var r = this;
              ((this.i = e),
                (this.l = t),
                (this.g = new Map()),
                (this.m = [
                  {
                    kd: null,
                    jd: ul,
                    Uc: function (s, a) {
                      return Ds(r, "enter", s, a);
                    },
                  },
                  {
                    kd: oc,
                    jd: ul,
                    Uc: function (s, a) {
                      return Ds(r, "enter", s, a);
                    },
                  },
                  {
                    kd: ac,
                    jd: ul,
                    Uc: function (s, a) {
                      return Ds(r, "enter", s, a);
                    },
                  },
                  {
                    kd: ul,
                    jd: oc,
                    Uc: function (s, a) {
                      return Ds(r, "exit", s, a);
                    },
                  },
                  {
                    kd: ul,
                    jd: ac,
                    Uc: function (s, a) {
                      return Ds(r, "exit", s, a);
                    },
                  },
                  {
                    kd: oc,
                    jd: ac,
                    Uc: function (s, a) {
                      a ? Ds(r, "skip", s, a) : (Ds(r, "enter", s, a), Ds(r, "exit", s, a));
                    },
                  },
                  {
                    kd: ac,
                    jd: oc,
                    Uc: function (s, a) {
                      return Ds(r, "skip", s, a);
                    },
                  },
                ]),
                (this.h = new gt()),
                this.h.D(this.i, "regionremove", function (s) {
                  r.g.delete(s.region);
                }));
            }
            (N(oa, Lt),
              (oa.prototype.release = function () {
                ((this.i = null),
                  this.g.clear(),
                  this.h.release(),
                  (this.h = null),
                  Lt.prototype.release.call(this));
              }),
              (oa.prototype.j = function (e, t) {
                if (!this.l || e != 0) {
                  this.l = !1;
                  for (var r = I(this.i.h.values()), s = r.next(); !s.done; s = r.next()) {
                    s = s.value;
                    var a = this.g.get(s),
                      c = e < s.startTime ? oc : e > s.endTime ? ac : ul;
                    this.g.set(s, c);
                    for (var f = I(this.m), g = f.next(); !g.done; g = f.next())
                      ((g = g.value), g.kd == a && g.jd == c && g.Uc(s, t));
                  }
                }
              }));
            function Ds(e, t, r, s) {
              ((t = new Me(
                t,
                new Map([
                  ["region", r],
                  ["seeking", s],
                ]),
              )),
                e.dispatchEvent(t));
            }
            var oc = 1,
              ul = 2,
              ac = 3;
            /*
		 @license
		 Copyright 2013 Ali Al Dallal

		 Licensed under the MIT license.

		 Permission is hereby granted, free of charge, to any person obtaining a copy
		 of this software and associated documentation files (the "Software"), to deal
		 in the Software without restriction, including without limitation the rights
		 to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
		 copies of the Software, and to permit persons to whom the Software is
		 furnished to do so, subject to the following conditions:

		 The above copyright notice and this permission notice shall be included in
		 all copies or substantial portions of the Software.

		 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
		 IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
		 FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
		 AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
		 LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
		 OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
		 SOFTWARE.
		*/ for (
              var fo = {
                  ach: "Lwo",
                  ady: "",
                  af: "Afrikaans",
                  "af-NA": "Afrikaans (Namibia)",
                  "af-ZA": "Afrikaans (South Africa)",
                  ak: "Ti",
                  ar: "",
                  "ar-AR": "",
                  "ar-MA": "",
                  "ar-SA": " ()",
                  "ay-BO": "Aymar aru",
                  az: "Azrbaycan dili",
                  "az-AZ": "Azrbaycan dili",
                  "be-BY": "",
                  bg: "",
                  "bg-BG": "",
                  bn: "",
                  "bn-IN": " ()",
                  "bn-BD": "()",
                  "bs-BA": "Bosanski",
                  ca: "Catal",
                  "ca-ES": "Catal",
                  cak: "Maya Kaqchikel",
                  "ck-US": " (tsalagi)",
                  cs: "etina",
                  "cs-CZ": "etina",
                  cy: "Cymraeg",
                  "cy-GB": "Cymraeg",
                  da: "Dansk",
                  "da-DK": "Dansk",
                  de: "Deutsch",
                  "de-AT": "Deutsch (sterreich)",
                  "de-DE": "Deutsch (Deutschland)",
                  "de-CH": "Deutsch (Schweiz)",
                  dsb: "Dolnoserbina",
                  el: "",
                  "el-GR": "",
                  en: "English",
                  "en-GB": "English (UK)",
                  "en-AU": "English (Australia)",
                  "en-CA": "English (Canada)",
                  "en-IE": "English (Ireland)",
                  "en-IN": "English (India)",
                  "en-PI": "English (Pirate)",
                  "en-UD": "English (Upside Down)",
                  "en-US": "English (US)",
                  "en-ZA": "English (South Africa)",
                  "en@pirate": "English (Pirate)",
                  eo: "Esperanto",
                  "eo-EO": "Esperanto",
                  es: "Espaol",
                  "es-AR": "Espaol (Argentine)",
                  "es-419": "Espaol (Latinoamrica)",
                  "es-CL": "Espaol (Chile)",
                  "es-CO": "Espaol (Colombia)",
                  "es-EC": "Espaol (Ecuador)",
                  "es-ES": "Espaol (Espaa)",
                  "es-LA": "Espaol (Latinoamrica)",
                  "es-NI": "Espaol (Nicaragua)",
                  "es-MX": "Espaol (Mxico)",
                  "es-US": "Espaol (Estados Unidos)",
                  "es-VE": "Espaol (Venezuela)",
                  et: "eesti keel",
                  "et-EE": "Eesti (Estonia)",
                  eu: "Euskara",
                  "eu-ES": "Euskara",
                  fa: "",
                  "fa-IR": "",
                  "fb-LT": "Leet Speak",
                  ff: "Fulah",
                  fi: "Suomi",
                  "fi-FI": "Suomi",
                  "fo-FO": "Froyskt",
                  fr: "Franais",
                  "fr-CA": "Franais (Canada)",
                  "fr-FR": "Franais (France)",
                  "fr-BE": "Franais (Belgique)",
                  "fr-CH": "Franais (Suisse)",
                  "fy-NL": "Frysk",
                  ga: "Gaeilge",
                  "ga-IE": "Gaeilge (Gaelic)",
                  gl: "Galego",
                  "gl-ES": "Galego",
                  "gn-PY": "Avae'",
                  "gu-IN": "",
                  "gx-GR": " ",
                  he: "",
                  "he-IL": "",
                  hi: "",
                  "hi-IN": "",
                  hr: "Hrvatski",
                  "hr-HR": "Hrvatski",
                  hsb: "Hornjoserbina",
                  ht: "Kreyl",
                  hu: "Magyar",
                  "hu-HU": "Magyar",
                  "hy-AM": "",
                  id: "Bahasa Indonesia",
                  "id-ID": "Bahasa Indonesia",
                  is: "slenska",
                  "is-IS": "slenska (Iceland)",
                  it: "Italiano",
                  "it-IT": "Italiano",
                  ja: "",
                  "ja-JP": "",
                  "jv-ID": "Basa Jawa",
                  "ka-GE": "",
                  "kk-KZ": "",
                  km: "",
                  "km-KH": "",
                  kab: "Taqbaylit",
                  kn: "",
                  "kn-IN": " (India)",
                  ko: "",
                  "ko-KR": " ()",
                  ku: "Kurd",
                  "ku-TR": "Kurd",
                  la: "Latin",
                  "la-VA": "Latin",
                  lb: "Ltzebuergesch",
                  "li-NL": "Lmbrgs",
                  lt: "Lietuvi",
                  "lt-LT": "Lietuvi",
                  lv: "Latvieu",
                  "lv-LV": "Latvieu",
                  mai: ", ",
                  "mg-MG": "Malagasy",
                  mk: "",
                  "mk-MK": " ()",
                  ml: "",
                  "ml-IN": "",
                  "mn-MN": "",
                  mr: "",
                  "mr-IN": "",
                  ms: "Bahasa Melayu",
                  "ms-MY": "Bahasa Melayu",
                  mt: "Malti",
                  "mt-MT": "Malti",
                  my: "",
                  nb: "Norsk (bokml)",
                  "nb-NO": "Norsk (bokml)",
                  ne: "",
                  "ne-NP": "",
                  nl: "Nederlands",
                  "nl-BE": "Nederlands (Belgi)",
                  "nl-NL": "Nederlands (Nederland)",
                  "nn-NO": "Norsk (nynorsk)",
                  no: "Norsk",
                  oc: "Occitan",
                  "or-IN": "",
                  pa: "",
                  "pa-IN": " ( )",
                  pl: "Polski",
                  "pl-PL": "Polski",
                  "ps-AF": "",
                  pt: "Portugus",
                  "pt-BR": "Portugus (Brasil)",
                  "pt-PT": "Portugus (Portugal)",
                  "qu-PE": "Qhichwa",
                  "rm-CH": "Rumantsch",
                  ro: "Romn",
                  "ro-RO": "Romn",
                  ru: "",
                  "ru-RU": "",
                  "sa-IN": "",
                  "se-NO": "Davvismegiella",
                  "si-LK": "",
                  sk: "Slovenina",
                  "sk-SK": "Slovenina (Slovakia)",
                  sl: "Slovenina",
                  "sl-SI": "Slovenina",
                  "so-SO": "Soomaaliga",
                  sq: "Shqip",
                  "sq-AL": "Shqip",
                  sr: "",
                  "sr-RS": " (Serbia)",
                  su: "Basa Sunda",
                  sv: "Svenska",
                  "sv-SE": "Svenska",
                  sw: "Kiswahili",
                  "sw-KE": "Kiswahili",
                  ta: "",
                  "ta-IN": "",
                  te: "",
                  "te-IN": "",
                  tg: " ",
                  "tg-TJ": "",
                  th: "",
                  "th-TH": " ()",
                  tl: "Filipino",
                  "tl-PH": "Filipino",
                  tlh: "tlhIngan-Hol",
                  tr: "Trke",
                  "tr-TR": "Trke",
                  "tt-RU": "",
                  uk: "",
                  "uk-UA": "",
                  ur: "",
                  "ur-PK": "",
                  uz: "O'zbek",
                  "uz-UZ": "O'zbek",
                  vi: "Ting Vit",
                  "vi-VN": "Ting Vit",
                  "xh-ZA": "isiXhosa",
                  yi: "",
                  "yi-DE": " (German)",
                  zh: "",
                  "zh-HANS": "",
                  "zh-HANT": "",
                  "zh-CN": "",
                  "zh-HK": "",
                  "zh-SG": "",
                  "zh-TW": "",
                  "zu-ZA": "isiZulu",
                },
                v1 = I(Object.keys(fo)),
                P0 = v1.next();
              !P0.done;
              P0 = v1.next()
            ) {
              var x1 = P0.value;
              fo[x1.toLowerCase()] = fo[x1];
            }
            function T1(e, t) {
              if (e.lineBreak) return "\n";
              if (e.nestedCues.length)
                return e.nestedCues
                  .map(function (f) {
                    return T1(f, e);
                  })
                  .join("");
              if (!e.payload) return e.payload;
              var r = [],
                s = e.fontWeight >= Ua,
                a = e.fontStyle == Ba,
                c = e.textDecoration.includes(xs);
              return (
                s && r.push(["b"]),
                a && r.push(["i"]),
                c && r.push(["u"]),
                (a = e.color),
                a == "" && t && (a = t.color),
                (s = ""),
                (a = S1(a)) && (s += "." + a),
                (a = e.backgroundColor),
                a == "" && t && (a = t.backgroundColor),
                (t = S1(a)) && (s += ".bg_" + t),
                s && r.push(["c", s]),
                r.reduceRight(function (f, g) {
                  var m = I(g);
                  return (
                    (g = m.next().value),
                    (m = m.next().value),
                    "<" + g + (m === void 0 ? "" : m) + ">" + f + "</" + g + ">"
                  );
                }, e.payload)
              );
            }
            function S1(e) {
              e = e.toLowerCase();
              var t = e.replace(/\s/g, "").match(/^rgba?\((\d+),(\d+),(\d+),?([^,\s)]+)?/i);
              switch (
                (t
                  ? (e =
                      "#" +
                      (parseInt(t[1], 10) | 256).toString(16).slice(1) +
                      (parseInt(t[2], 10) | 256).toString(16).slice(1) +
                      (parseInt(t[3], 10) | 256).toString(16).slice(1))
                  : e.startsWith("#") && e.length > 7 && (e = e.slice(0, 7)),
                e)
              ) {
                case "white":
                case "#fff":
                case "#ffffff":
                  return "white";
                case "lime":
                case "#0f0":
                case "#00ff00":
                  return "lime";
                case "cyan":
                case "#0ff":
                case "#00ffff":
                  return "cyan";
                case "red":
                case "#f00":
                case "#ff0000":
                  return "red";
                case "yellow":
                case "#ff0":
                case "#ffff00":
                  return "yellow";
                case "magenta":
                case "#f0f":
                case "#ff00ff":
                  return "magenta";
                case "blue":
                case "#00f":
                case "#0000ff":
                  return "blue";
                case "black":
                case "#000":
                case "#000000":
                  return "black";
              }
              return null;
            }
            function O0(e, t) {
              var r = [];
              e = I(E1(e));
              for (var s = e.next(); !s.done; s = e.next())
                if (((s = s.value), s.isContainer)) r.push.apply(r, V(O0(s.nestedCues, s)));
                else {
                  var a = s.clone();
                  ((a.nestedCues = []), (a.payload = T1(s, t)), r.push(a));
                }
              return r;
            }
            function E1(e) {
              var t = [];
              e = I(e);
              for (var r = e.next(), s = {}; !r.done; s = { mg: void 0 }, r = e.next())
                ((s.mg = r.value),
                  t.some(
                    (function (a) {
                      return function (c) {
                        return nh(a.mg, c);
                      };
                    })(s),
                  ) || t.push(s.mg));
              return t;
            }
            function JO(e) {
              function t(s) {
                for (var a = 5381, c = s.length; c; ) a = (a * 33) ^ s.charCodeAt(--c);
                return (a >>> 0).toString();
              }
              if (e.startTime >= e.endTime) return null;
              var r = new VTTCue(e.startTime, e.endTime, e.payload);
              ((r.id = t(e.startTime.toString()) + t(e.endTime.toString()) + t(e.payload)),
                (r.lineAlign = e.lineAlign),
                (r.positionAlign = e.positionAlign),
                e.size && (r.size = e.size));
              try {
                r.align = e.textAlign;
              } catch (s) {}
              return (
                e.textAlign == "center" && r.align != "center" && (r.align = "middle"),
                e.writingMode == "vertical-lr"
                  ? (r.vertical = "lr")
                  : e.writingMode == "vertical-rl" && (r.vertical = "rl"),
                e.lineInterpretation == 1 && (r.snapToLines = !1),
                e.line != null && (r.line = e.line),
                e.position != null && (r.position = e.position),
                r
              );
            }
            function A1(e, t) {
              var r = O0(t),
                s = [];
              ((t = e.cues ? Array.from(e.cues) : []), (r = I(r)));
              for (var a = r.next(), c = {}; !a.done; c = { vd: void 0 }, a = r.next())
                ((c.vd = a.value),
                  !t.some(
                    (function (f) {
                      return function (g) {
                        return (
                          g.startTime == f.vd.startTime && g.endTime == f.vd.endTime && g.text == f.vd.payload
                        );
                      };
                    })(c),
                  ) &&
                    c.vd.payload &&
                    (a = JO(c.vd)) &&
                    s.push(a));
              for (
                t = s.slice().sort(function (f, g) {
                  return f.startTime != g.startTime
                    ? f.startTime - g.startTime
                    : f.endTime != g.endTime
                      ? f.endTime - g.startTime
                      : ("line" in VTTCue.prototype)
                        ? s.indexOf(g) - s.indexOf(f)
                        : s.indexOf(f) - s.indexOf(g);
                }),
                  t = I(t),
                  r = t.next();
                !r.done;
                r = t.next()
              )
                e.addCue(r.value);
            }
            function N0(e, t) {
              var r = !1;
              e.mode === "disabled" && ((r = !0), (e.mode = "hidden"));
              for (var s = 0; s < e.cues.length; ) {
                var a = e.cues[s];
                t(a) ? e.removeCue(a) : s++;
              }
              r && (e.mode = "disabled");
            }
            function Tn(e) {
              var t = this;
              ((this.i = e),
                (this.l = new gt()),
                (this.j = null),
                (this.h = new Map()),
                (this.g = -1),
                (this.u = !1),
                (this.o = null),
                (this.C = function () {
                  (t.l.Ma(t.i, "textchanged", t.m), t.l.Ma(t.j.textTracks, "change", t.B));
                  for (var r = I(t.h.values()), s = r.next(); !s.done; s = r.next()) s.value.remove();
                  (t.h.clear(), (t.g = -1), (t.j = null));
                }),
                (this.m = function () {
                  var r = new Map(),
                    s = t.i.Lc();
                  s = I(s);
                  for (var a = s.next(); !a.done; a = s.next()) {
                    if (((a = a.value), t.h.has(a.id))) {
                      var c = t.h.get(a.id);
                      (a.active || c.track.mode === "disabled" || (c.track.mode = "disabled"),
                        t.h.delete(a.id));
                    } else {
                      ((c = t.j.ownerDocument.createElement("track")), (c.kind = ZO(a)));
                      var f = c,
                        g = void 0;
                      if (a.label) g = a.label;
                      else if (a.language)
                        if (a.language in fo) g = fo[a.language];
                        else {
                          var m = lh(a.language);
                          m in fo && (g = fo[m] + " (" + a.language + ")");
                        }
                      (g ||
                        ((g = a.originalTextId),
                        a.language && a.language !== a.originalTextId && (g += " (" + a.language + ")")),
                        (f.label = g),
                        a.language in fo && (c.srclang = a.language),
                        (c.src = "data:,WEBVTT"),
                        (c.track.mode = "disabled"),
                        t.j.appendChild(c));
                    }
                    (r.set(a.id, c), a.active && (t.g = a.id));
                  }
                  for (s = I(t.h.values()), a = s.next(); !a.done; a = s.next()) a.value.remove();
                  (t.g > -1 &&
                    (r.has(t.g)
                      ? ((s = r.get(t.g).track),
                        s.mode === "disabled" && (s.mode = t.u ? "showing" : "hidden"))
                      : (t.g = -1)),
                    (t.h = r));
                }),
                (this.B = function () {
                  if (!t.o) {
                    var r = t.j;
                    t.o = new it(function () {
                      if (((t.o = null), t.j === r)) {
                        var s = -1,
                          a = !1;
                        if (t.h.has(t.g)) {
                          var c = t.h.get(t.g);
                          c.track.mode === "showing"
                            ? ((s = t.g), (a = !0))
                            : c.track.mode === "hidden" && (s = t.g);
                        }
                        if (!a)
                          for (a = I(t.h), c = a.next(); !c.done; c = a.next()) {
                            var f = I(c.value);
                            if (((c = f.next().value), (f = f.next().value), f.track.mode === "showing")) {
                              s = c;
                              break;
                            } else s < 0 && f.track.mode === "hidden" && (s = c);
                          }
                        for (a = I(t.h), c = a.next(); !c.done; c = a.next())
                          ((f = I(c.value)),
                            (c = f.next().value),
                            (f = f.next().value),
                            c !== s && f.track.mode !== "disabled" && (f.track.mode = "disabled"));
                        (t.g !== s && ((t.g = s), s > -1 && t.i.ph({ id: s })),
                          t.i.wh(s > -1 && t.h.get(s).track.mode === "showing"));
                      }
                    }).ka(0);
                  }
                }),
                this.l.D(e, "loaded", function () {
                  return t.enableTextDisplayer();
                }),
                this.enableTextDisplayer());
            }
            ((d = Tn.prototype),
              (d.configure = function () {}),
              (d.remove = function (e, t) {
                if (this.i)
                  this.h.has(this.g) &&
                    N0(this.h.get(this.g).track, function (r) {
                      return r.startTime < t && r.endTime > e;
                    });
                else return !1;
                return !0;
              }),
              (d.append = function (e) {
                this.h.has(this.g) && A1(this.h.get(this.g).track, e);
              }),
              (d.destroy = function () {
                return (
                  this.i && (this.j && this.C(), (this.i = null)),
                  this.l && (this.l.release(), (this.l = null)),
                  Promise.resolve()
                );
              }),
              (d.isTextVisible = function () {
                return this.u;
              }),
              (d.setTextVisibility = function (e) {
                if (((this.u = e), this.h.has(this.g))) {
                  var t = this.h.get(this.g).track;
                  t.mode !== "disabled" && ((e = e ? "showing" : "hidden"), t.mode !== e && (t.mode = e));
                } else if (this.i && this.i.$d() === 3)
                  if (
                    ((t = Array.from(this.i.bf().textTracks).filter(function (s) {
                      return ["captions", "subtitles", "forced"].includes(s.kind);
                    })),
                    e)
                  ) {
                    ((e = null), (t = I(t)));
                    for (var r = t.next(); !r.done; r = t.next())
                      if (((r = r.value), r.mode === "showing")) {
                        e = null;
                        break;
                      } else e || r.mode !== "hidden" || (e = r);
                    e && (e.mode = "showing");
                  } else
                    for (e = I(t), t = e.next(); !t.done; t = e.next())
                      ((t = t.value), t.mode === "showing" && (t.mode = "hidden"));
              }),
              (d.setTextLanguage = function () {}),
              (d.enableTextDisplayer = function () {
                !this.j &&
                  this.i &&
                  this.i.$d() === 2 &&
                  ((this.j = this.i.bf()),
                  this.l.Aa(this.i, "unloading", this.C),
                  this.l.D(this.i, "textchanged", this.m),
                  this.l.D(this.j.textTracks, "change", this.B),
                  this.m());
              }));
            function ZO(e) {
              var t = tt();
              return e.forced && t.Ha() === "WEBKIT"
                ? "forced"
                : e.kind === "caption" ||
                    (e.roles &&
                      e.roles.some(function (r) {
                        return r.includes("transcribes-spoken-dialog");
                      }) &&
                      e.roles.some(function (r) {
                        return r.includes("describes-music-and-sound");
                      }))
                  ? "captions"
                  : "subtitles";
            }
            (Ee("shaka.text.NativeTextDisplayer", Tn),
              (Tn.prototype.enableTextDisplayer = Tn.prototype.enableTextDisplayer),
              (Tn.prototype.setTextLanguage = Tn.prototype.setTextLanguage),
              (Tn.prototype.setTextVisibility = Tn.prototype.setTextVisibility),
              (Tn.prototype.isTextVisible = Tn.prototype.isTextVisible),
              (Tn.prototype.destroy = Tn.prototype.destroy),
              (Tn.prototype.append = Tn.prototype.append),
              (Tn.prototype.remove = Tn.prototype.remove),
              (Tn.prototype.configure = Tn.prototype.configure));
            function Wn(e, t) {
              for (
                ft("SimpleTextDisplayer", "Please migrate to NativeTextDisplayer"),
                  this.h = e,
                  this.i = t,
                  this.g = null,
                  e = I(Array.from(this.h.textTracks)),
                  t = e.next();
                !t.done;
                t = e.next()
              )
                ((t = t.value),
                  t.kind !== "metadata" &&
                    t.kind !== "chapters" &&
                    ((t.mode = "disabled"), t.label == this.i && (this.g = t)));
              this.g && (this.g.mode = "hidden");
            }
            ((d = Wn.prototype),
              (d.configure = function () {}),
              (d.remove = function (e, t) {
                return this.g
                  ? (N0(this.g, function (r) {
                      return r.startTime < t && r.endTime > e;
                    }),
                    !0)
                  : !1;
              }),
              (d.append = function (e) {
                this.g && A1(this.g, e);
              }),
              (d.destroy = function () {
                return (
                  this.g &&
                    (N0(this.g, function () {
                      return !0;
                    }),
                    (this.g.mode = "disabled")),
                  (this.g = this.h = null),
                  Promise.resolve()
                );
              }),
              (d.isTextVisible = function () {
                return this.g ? this.g.mode == "showing" : !1;
              }),
              (d.setTextVisibility = function (e) {
                (e && !this.g && I1(this), this.g && (this.g.mode = e ? "showing" : "hidden"));
              }),
              (d.setTextLanguage = function () {}),
              (d.enableTextDisplayer = function () {
                I1(this);
              }));
            function I1(e) {
              e.h && !e.g && ((e.g = e.h.addTextTrack("subtitles", e.i)), (e.g.mode = "hidden"));
            }
            (Ee("shaka.text.SimpleTextDisplayer", Wn),
              (Wn.prototype.enableTextDisplayer = Wn.prototype.enableTextDisplayer),
              (Wn.prototype.setTextLanguage = Wn.prototype.setTextLanguage),
              (Wn.prototype.setTextVisibility = Wn.prototype.setTextVisibility),
              (Wn.prototype.isTextVisible = Wn.prototype.isTextVisible),
              (Wn.prototype.destroy = Wn.prototype.destroy),
              (Wn.prototype.append = Wn.prototype.append),
              (Wn.prototype.remove = Wn.prototype.remove),
              (Wn.prototype.configure = Wn.prototype.configure));
            function zn() {}
            ((d = zn.prototype),
              (d.configure = function () {}),
              (d.remove = function () {}),
              (d.append = function () {}),
              (d.destroy = function () {}),
              (d.isTextVisible = function () {
                return !1;
              }),
              (d.setTextVisibility = function () {}),
              (d.setTextLanguage = function () {}),
              (d.enableTextDisplayer = function () {}),
              Ee("shaka.text.StubTextDisplayer", zn),
              (zn.prototype.enableTextDisplayer = zn.prototype.enableTextDisplayer),
              (zn.prototype.setTextLanguage = zn.prototype.setTextLanguage),
              (zn.prototype.setTextVisibility = zn.prototype.setTextVisibility),
              (zn.prototype.isTextVisible = zn.prototype.isTextVisible),
              (zn.prototype.destroy = zn.prototype.destroy),
              (zn.prototype.append = zn.prototype.append),
              (zn.prototype.remove = zn.prototype.remove),
              (zn.prototype.configure = zn.prototype.configure));
            function Yn(e, t) {
              var r = this;
              ((this.m = !1),
                (this.h = []),
                (this.j = e),
                (this.o = t),
                (this.C = this.u = null),
                (this.g = document.createElement("div")),
                this.g.classList.add("shaka-text-container"),
                (this.g.style.textAlign = "center"),
                (this.g.style.display = "flex"),
                (this.g.style.flexDirection = "column"),
                (this.g.style.alignItems = "center"),
                (this.g.style.justifyContent = "flex-end"),
                (this.B = new it(function () {
                  r.j.paused || po(r);
                })),
                lc(this),
                (this.l = new Map()),
                (this.i = new gt()),
                this.i.D(document, "fullscreenchange", function () {
                  po(r, !0);
                }),
                this.i.D(this.j, "seeking", function () {
                  po(r, !0);
                }),
                this.i.D(this.j, "ratechange", function () {
                  lc(r);
                }),
                this.i.D(this.j, "resize", function () {
                  var s = r.j,
                    a = s.videoWidth;
                  ((s = s.videoHeight), a && s ? (r.u = a / s) : (r.u = null));
                }),
                (this.F = null),
                "ResizeObserver" in l &&
                  ((this.F = new ResizeObserver(function () {
                    po(r, !0);
                  })),
                  this.F.observe(this.g)),
                (this.G = new Map()));
            }
            ((d = Yn.prototype),
              (d.configure = function (e) {
                ((this.C = e), lc(this), po(this, !0));
              }),
              (d.append = function (e) {
                var t = [].concat(V(this.h));
                e = I(E1(e));
                for (var r = e.next(), s = {}; !r.done; s = { ng: void 0 }, r = e.next())
                  ((s.ng = r.value),
                    t.some(
                      (function (a) {
                        return function (c) {
                          return nh(c, a.ng);
                        };
                      })(s),
                    ) || this.h.push(s.ng));
                (this.h.length && lc(this), po(this));
              }),
              (d.destroy = function () {
                return (
                  this.g &&
                    (this.g.parentElement && this.o.removeChild(this.g),
                    (this.g = null),
                    (this.m = !1),
                    (this.h = []),
                    this.B && (this.B.stop(), (this.B = null)),
                    this.l.clear(),
                    this.i && (this.i.release(), (this.i = null)),
                    this.F && (this.F.disconnect(), (this.F = null))),
                  Promise.resolve()
                );
              }),
              (d.remove = function (e, t) {
                if (!this.g) return !1;
                var r = this.h.length;
                return (
                  (this.h = this.h.filter(function (s) {
                    return s.startTime < e || s.endTime >= t;
                  })),
                  po(this, r > this.h.length),
                  this.h.length || lc(this),
                  !0
                );
              }),
              (d.isTextVisible = function () {
                return this.m;
              }),
              (d.setTextVisibility = function (e) {
                (this.m = e)
                  ? (this.g.parentElement || this.o.appendChild(this.g), po(this, !0))
                  : this.g.parentElement && this.o.removeChild(this.g);
              }),
              (d.setTextLanguage = function (e) {
                e && e != "und" ? this.g.setAttribute("lang", e) : this.g.setAttribute("lang", "");
              }),
              (d.enableTextDisplayer = function () {}));
            function lc(e) {
              e.B &&
                (e.h.length
                  ? e.B.Ea((e.C ? e.C.captionsUpdatePeriod : 0.25) / Math.max(1, Math.abs(e.j.playbackRate)))
                  : e.B.stop());
            }
            function eN(e, t) {
              for (; t != null; ) {
                if (t == e.g) return !0;
                t = t.parentElement;
              }
              return !1;
            }
            function w1(e, t, r, s, a) {
              var c = !1,
                f = [],
                g = [];
              t = I(t);
              for (var m = t.next(); !m.done; m = t.next()) {
                ((m = m.value), a.push(m));
                var x = e.l.get(m),
                  E = m.startTime <= s && m.endTime > s,
                  A = x ? x.nj : null;
                (x && (f.push(x.og), x.$c && f.push(x.$c), E || ((c = !0), e.l.delete(m), (x = null))),
                  E &&
                    (g.push(m),
                    x ? eN(e, A) || (c = !0) : (tN(e, m, a), (x = e.l.get(m)), (A = x.nj), (c = !0))),
                  m.nestedCues.length > 0 && A && w1(e, m.nestedCues, A, s, a),
                  a.pop());
              }
              if (c) {
                for (s = I(f), a = s.next(); !a.done; a = s.next())
                  ((a = a.value), a.parentElement && a.parentElement.removeChild(a));
                for (
                  g.sort(function (R, b) {
                    return R.startTime != b.startTime ? R.startTime - b.startTime : R.endTime - b.endTime;
                  }),
                    g = I(g),
                    s = g.next();
                  !s.done;
                  s = g.next()
                )
                  ((s = e.l.get(s.value)),
                    s.$c
                      ? (s.$c.contains(r) && s.$c.removeChild(r), r.appendChild(s.$c), s.$c.appendChild(s.og))
                      : r.appendChild(s.og));
              }
            }
            function po(e, t) {
              if (e.g) {
                var r = e.j.currentTime;
                if (!e.m || (t !== void 0 && t)) {
                  t = I(e.G.values());
                  for (var s = t.next(); !s.done; s = t.next()) zu(s.value);
                  (zu(e.g), e.l.clear(), e.G.clear());
                }
                e.m && w1(e, e.h, e.g, r, []);
              }
            }
            function tN(e, t, r) {
              var s = r.length > 1,
                a = s ? "span" : "div";
              (t.lineBreak && (a = "br"), t.rubyTag && (a = t.rubyTag), (s = !s && t.nestedCues.length > 0));
              var c = document.createElement(a);
              if ((a != "br" && iN(e, c, t, r, s), (r = null), t.region && t.region.id)) {
                var f = t.region,
                  g = e.u === 4 / 3 ? 2.5 : 1.9;
                if (
                  ((r =
                    f.id +
                    "_" +
                    f.width +
                    "x" +
                    f.height +
                    (f.heightUnits == Mi ? "%" : "px") +
                    "-" +
                    f.viewportAnchorX +
                    "x" +
                    f.viewportAnchorY +
                    (f.viewportAnchorUnits == Mi ? "%" : "px")),
                  e.G.has(r))
                )
                  r = e.G.get(r);
                else {
                  a = document.createElement("span");
                  var m = f.heightUnits == Mi ? "%" : "px",
                    x = f.widthUnits == Mi ? "%" : "px",
                    E = f.viewportAnchorUnits == Mi ? "%" : "px";
                  ((a.id = "shaka-text-region---" + r),
                    a.classList.add("shaka-text-region"),
                    (a.style.position = "absolute"));
                  var A = f.height,
                    R = f.width;
                  (f.heightUnits === 2 && ((A = f.height * 5.33), (m = "%")),
                    f.widthUnits === 2 && ((R = f.width * g), (x = "%")),
                    (a.style.height = A + m),
                    (a.style.width = R + x),
                    f.viewportAnchorUnits === 2
                      ? ((g = (f.viewportAnchorY / 75) * 100),
                        (m = (f.viewportAnchorX / (e.u === 4 / 3 ? 160 : 210)) * 100),
                        (g -= (f.regionAnchorY * A) / 100),
                        (m -= (f.regionAnchorX * R) / 100),
                        (a.style.top = g + "%"),
                        (a.style.left = m + "%"))
                      : ((a.style.top = f.viewportAnchorY - (f.regionAnchorY * A) / 100 + E),
                        (a.style.left = f.viewportAnchorX - (f.regionAnchorX * R) / 100 + E)),
                    f.heightUnits !== 0 &&
                      f.widthUnits !== 0 &&
                      f.viewportAnchorUnits !== 0 &&
                      ((f = Math.max(
                        0,
                        Math.min(
                          100 - (parseInt(a.style.width.slice(0, -1), 10) || 0),
                          parseInt(a.style.left.slice(0, -1), 10) || 0,
                        ),
                      )),
                      (a.style.top =
                        Math.max(
                          0,
                          Math.min(
                            100 - (parseInt(a.style.height.slice(0, -1), 10) || 0),
                            parseInt(a.style.top.slice(0, -1), 10) || 0,
                          ),
                        ) + "%"),
                      (a.style.left = f + "%")),
                    (a.style.display = "flex"),
                    (a.style.flexDirection = "column"),
                    (a.style.alignItems = "center"),
                    (a.style.justifyContent =
                      t.displayAlign == "before"
                        ? "flex-start"
                        : t.displayAlign == "center"
                          ? "center"
                          : "flex-end"),
                    e.G.set(r, a),
                    (r = a));
                }
              }
              ((a = c),
                s &&
                  ((a = document.createElement("span")),
                  a.classList.add("shaka-text-wrapper"),
                  (a.style.backgroundColor = t.backgroundColor),
                  (a.style.lineHeight = "normal"),
                  c.appendChild(a)),
                e.l.set(t, { og: c, nj: a, $c: r }));
            }
            function nN(e) {
              var t = e.direction,
                r = e.positionAlign;
              return (
                (e = e.textAlign),
                r !== rh
                  ? r
                  : e === "left" || (e === "start" && t === _u) || (e === "end" && t === "rtl")
                    ? "line-left"
                    : e === "right" || (e === "start" && t === "rtl") || (e === "end" && t === _u)
                      ? "line-right"
                      : "center"
              );
            }
            function iN(e, t, r, s, a) {
              var c = t.style,
                f = r.nestedCues.length == 0,
                g = s.length > 1;
              c.whiteSpace = "pre-wrap";
              var m = r.payload.replace(/\s+$/g, function (E) {
                return "".repeat(E.length);
              });
              if (
                ((c.webkitTextStrokeColor = r.textStrokeColor),
                (c.webkitTextStrokeWidth = r.textStrokeWidth),
                (c.color = r.color),
                (c.direction = r.direction),
                (c.opacity = r.opacity),
                (c.paddingLeft = F0(r.linePadding, r, e.o)),
                (c.paddingRight = F0(r.linePadding, r, e.o)),
                (c.textCombineUpright = r.textCombineUpright),
                (c.textShadow = r.textShadow),
                r.backgroundImage)
              )
                ((c.backgroundImage = "url('" + r.backgroundImage + "')"),
                  (c.backgroundRepeat = "no-repeat"),
                  (c.backgroundSize = "contain"),
                  (c.backgroundPosition = "center"),
                  r.backgroundColor && (c.backgroundColor = r.backgroundColor),
                  (c.width = "100%"),
                  (c.height = "100%"));
              else {
                if (r.nestedCues.length) var x = t;
                else ((x = document.createElement("span")), t.appendChild(x));
                (r.border && (x.style.border = r.border),
                  a ||
                    ((t = rN(s, function (E) {
                      return E.backgroundColor;
                    }))
                      ? (x.style.backgroundColor = t)
                      : m && (x.style.backgroundColor = "rgba(0, 0, 0, 0.8)")),
                  m && (x.setAttribute("translate", "no"), (x.textContent = m)));
              }
              (g && !s[s.length - 1].isContainer
                ? (c.display = "inline")
                : ((c.display = "flex"),
                  (c.flexDirection = "column"),
                  (c.alignItems = "center"),
                  r.textAlign == "left" || r.textAlign == "start"
                    ? ((c.width = "100%"), (c.alignItems = "start"))
                    : (r.textAlign == "right" || r.textAlign == "end") &&
                      ((c.width = "100%"), (c.alignItems = "end")),
                  (c.justifyContent =
                    r.displayAlign == "before"
                      ? "flex-start"
                      : r.displayAlign == "center"
                        ? "center"
                        : "flex-end")),
                f || (c.margin = "0"),
                (c.fontFamily = r.fontFamily),
                (c.fontWeight = r.fontWeight.toString()),
                (c.fontStyle = r.fontStyle),
                (c.letterSpacing = r.letterSpacing),
                (s = e.C ? e.C.fontScaleFactor : 1),
                (s !== 1 || r.fontSize) && (c.fontSize = F0(r.fontSize || "1em", r, e.o, s)),
                (s = r.line),
                s != null &&
                  ((f = r.lineInterpretation),
                  f == bu &&
                    ((f = 1),
                    (g = 16),
                    e.u && e.u < 1 && (g = 32),
                    (s = s < 0 ? 100 + (s / g) * 100 : (s / g) * 100)),
                  f == 1 &&
                    ((c.position = "absolute"),
                    r.writingMode == zo
                      ? ((c.width = "100%"),
                        r.lineAlign == Yo
                          ? (c.top = s + "%")
                          : r.lineAlign == "end" && (c.bottom = 100 - s + "%"))
                      : r.writingMode == "vertical-lr"
                        ? ((c.height = "100%"),
                          r.lineAlign == Yo
                            ? (c.left = s + "%")
                            : r.lineAlign == "end" && (c.right = 100 - s + "%"))
                        : ((c.height = "100%"),
                          r.lineAlign == Yo
                            ? (c.right = s + "%")
                            : r.lineAlign == "end" && (c.left = 100 - s + "%")))),
                (c.lineHeight = r.lineHeight),
                (e = nN(r)),
                e == "line-left"
                  ? ((c.cssFloat = "left"),
                    r.position !== null &&
                      ((c.position = "absolute"),
                      r.writingMode == zo
                        ? ((c.left = r.position + "%"), (c.width = "auto"))
                        : (c.top = r.position + "%")))
                  : e == "line-right"
                    ? ((c.cssFloat = "right"),
                      r.position !== null &&
                        ((c.position = "absolute"),
                        r.writingMode == zo
                          ? ((c.right = 100 - r.position + "%"), (c.width = "auto"))
                          : (c.bottom = r.position + "%")))
                    : r.position !== null &&
                      r.position != 50 &&
                      ((c.position = "absolute"),
                      r.writingMode == zo
                        ? ((c.left = r.position + "%"), (c.width = "auto"))
                        : (c.top = r.position + "%"),
                      r.size && (c.transform = "translateX(-50%)")),
                (c.textAlign = r.textAlign),
                (c.textDecoration = r.textDecoration.join(" ")),
                (c.writingMode = r.writingMode),
                ("writingMode" in document.documentElement.style && c.writingMode == r.writingMode) ||
                  (c.webkitWritingMode = r.writingMode),
                r.size && (r.writingMode == zo ? (c.width = r.size + "%") : (c.height = r.size + "%")));
            }
            function F0(e, t, r, s) {
              s = s === void 0 ? 1 : s;
              var a = (a = new RegExp(/(\d*\.?\d+)([a-z]+|%+)/).exec(e))
                ? { value: Number(a[1]), unit: a[2] }
                : null;
              if (!a) return e;
              switch (((e = a.unit), (s *= a.value), e)) {
                case "%":
                  return ((s / 100) * r.clientHeight) / t.cellResolution.rows + "px";
                case "c":
                  return (r.clientHeight * s) / t.cellResolution.rows + "px";
                default:
                  return s + e;
              }
            }
            function rN(e, t) {
              for (var r = e.length - 1; r >= 0; r--) {
                var s = t(e[r]);
                if (s || s === 0) return s;
              }
              return null;
            }
            (Ee("shaka.text.UITextDisplayer", Yn),
              (Yn.prototype.enableTextDisplayer = Yn.prototype.enableTextDisplayer),
              (Yn.prototype.setTextLanguage = Yn.prototype.setTextLanguage),
              (Yn.prototype.setTextVisibility = Yn.prototype.setTextVisibility),
              (Yn.prototype.isTextVisible = Yn.prototype.isTextVisible),
              (Yn.prototype.remove = Yn.prototype.remove),
              (Yn.prototype.destroy = Yn.prototype.destroy),
              (Yn.prototype.append = Yn.prototype.append),
              (Yn.prototype.configure = Yn.prototype.configure));
            function sN(e, t) {
              function r(c) {
                for (var f = c, g = I(t), m = g.next(); !m.done; m = g.next())
                  ((m = m.value), m.end && m.start < c && (f += m.end - m.start));
                return (
                  (c = Math.floor(f / 3600)),
                  (g = Math.floor((f / 60) % 60)),
                  (m = Math.floor(f % 60)),
                  (f = Math.floor((f * 1e3) % 1e3)),
                  (c < 10 ? "0" : "") +
                    c +
                    ":" +
                    (g < 10 ? "0" : "") +
                    g +
                    ":" +
                    (m < 10 ? "0" : "") +
                    m +
                    "." +
                    (f < 100 ? (f < 10 ? "00" : "0") : "") +
                    f
                );
              }
              var s = O0(e);
              ((e = "WEBVTT\n\n"), (s = I(s)));
              for (var a = s.next(); !a.done; a = s.next())
                ((a = a.value),
                  (e +=
                    r(a.startTime) +
                    " --> " +
                    r(a.endTime) +
                    (function (c) {
                      var f = [];
                      switch (c.textAlign) {
                        case "left":
                          f.push("align:left");
                          break;
                        case "right":
                          f.push("align:right");
                          break;
                        case Jr:
                          f.push("align:middle");
                          break;
                        case "start":
                          f.push("align:start");
                          break;
                        case "end":
                          f.push("align:end");
                      }
                      switch (c.writingMode) {
                        case "vertical-lr":
                          f.push("vertical:lr");
                          break;
                        case "vertical-rl":
                          f.push("vertical:rl");
                      }
                      return f.length ? " " + f.join(" ") : "";
                    })(a) +
                    "\n"),
                  (e += a.payload + "\n\n"));
              return e;
            }
            Ee("shaka.text.WebVttGenerator", function () {});
            function U0(e, t) {
              ((this.g = t),
                (this.j = e),
                (this.m = new Map()),
                (this.l = void 0),
                (this.F = !1),
                (this.J = !0),
                (this.u = this.I = !1),
                (this.C = this.B = void 0),
                (this.H = 0),
                (this.K = { request: !1, response: !1, event: !1 }),
                (this.o = {}),
                (this.i = new gt()),
                (this.G = []),
                (this.h = null));
            }
            ((U0.prototype.setMediaElement = function (e) {
              ((this.h = e), cN(this));
            }),
              (U0.prototype.configure = function (e) {
                ((this.g = e), dN(this));
              }));
            function oN(e) {
              (e.m.clear(),
                (e.F = !1),
                (e.J = !0),
                (e.I = !1),
                (e.u = !1),
                (e.B = 0),
                (e.C = 0),
                (e.H = 0),
                (e.K = { request: !1, response: !1, event: !1 }),
                R1(e),
                (e.o = {}),
                (e.h = null),
                e.i.Qa());
            }
            function aN(e, t) {
              ((e.u = t),
                e.u
                  ? e.l == of
                    ? (e.l = af)
                    : e.l == lf && (e.l = uf)
                  : e.l == af
                    ? (e.l = of)
                    : e.l == uf && (e.l = lf));
            }
            function lN(e, t) {
              if (e.g && e.g.enabled && (Xn(e, "ps", { dd: "d" }), e.h && e.h.autoplay)) {
                var r = e.h.play();
                r &&
                  r
                    .then(function () {
                      e.H = t;
                    })
                    .catch(function () {
                      e.H = 0;
                    });
              }
            }
            function uN(e, t, r) {
              try {
                if (!e.g.enabled) return t;
                var s = $0(e);
                e: {
                  switch (r.toLowerCase()) {
                    case "audio/mp4":
                    case "audio/webm":
                    case "audio/ogg":
                    case "audio/mpeg":
                    case "audio/aac":
                    case "audio/flac":
                    case "audio/wav":
                      var a = tf;
                      break e;
                    case "video/webm":
                    case "video/mp4":
                    case "video/mpeg":
                    case "video/mp2t":
                      a = rf;
                      break e;
                    case "application/x-mpegurl":
                    case "application/vnd.apple.mpegurl":
                    case "application/dash+xml":
                    case "video/vnd.mpeg.dash.mpd":
                    case "application/vnd.ms-sstr+xml":
                      a = M1;
                      break e;
                  }
                  a = void 0;
                }
                ((s.ot = a), (s.su = !0));
                var c = uc(s);
                return ef(t, c);
              } catch (f) {
                return (Cn("CMCD_SRC_ERROR", "Could not generate src CMCD data.", f), t);
              }
            }
            function cN(e) {
              (e.i.D(e.h, "playing", function () {
                (e.C || (e.C = Date.now()), Xn(e, "ps", { dd: "p" }));
              }),
                e.i.D(e.h, "volumechange", function () {
                  Xn(e, e.h.muted ? "m" : "um");
                }),
                e.i.D(e.h, "play", function () {
                  e.B || ((e.B = Date.now()), Xn(e, "ps", { dd: "s" }));
                }),
                e.i.D(e.h, "pause", function () {
                  Xn(e, "ps", { dd: "a" });
                }),
                e.i.D(e.j, "buffering", function () {
                  Xn(e, "ps", { dd: "w" });
                }),
                e.i.D(e.h, "seeking", function () {
                  return Xn(e, "ps", { dd: "k" });
                }),
                e.i.D(document, "fullscreenchange", function () {
                  Xn(e, document.fullscreenElement ? "pe" : "pc");
                }));
              var t = e.h;
              ((t.webkitPresentationMode || t.webkitSupportsFullscreen) &&
                e.i.D(t, "webkitpresentationmodechanged", function () {
                  t.webkitPresentationMode
                    ? Xn(e, t.webkitPresentationMode !== "inline" ? "pe" : "pc")
                    : t.webkitSupportsFullscreen && Xn(e, t.webkitDisplayingFullscreen ? "pe" : "pc");
                }),
                e.i.D(e.h, "enterpictureinpicture", function () {
                  Xn(e, "pe");
                }),
                e.i.D(e.h, "leavepictureinpicture", function () {
                  Xn(e, "pc");
                }),
                "documentPictureInPicture" in l &&
                  e.i.D(l.documentPictureInPicture, "enter", function (r) {
                    (Xn(e, "pe"),
                      e.i.Aa(r.window, "pagehide", function () {
                        Xn(e, "pc");
                      }));
                  }),
                e.i.D(document, "visibilitychange", function () {
                  document.hidden ? Xn(e, "b", { bg: !0 }) : Xn(e, "b");
                }),
                e.i.D(e.j, "complete", function () {
                  Xn(e, "ps", { dd: "e" });
                }));
            }
            function dN(e) {
              R1(e);
              var t = C1(e);
              t = I(t);
              for (var r = t.next(); !r.done; r = t.next())
                if (((r = r.value.timeInterval), r === void 0 && (r = IN), r >= 1)) {
                  var s = new it(function () {
                    return Xn(e, wN);
                  });
                  (s.Ea(r), e.G.push(s));
                }
            }
            function R1(e) {
              if (e.G) for (var t = I(e.G), r = t.next(); !r.done; r = t.next()) r.value.stop();
              e.G = [];
            }
            function C1(e) {
              return (e = e.g.targets)
                ? e.filter(function (t) {
                    return t.mode === U1 && t.enabled;
                  })
                : [];
            }
            function B0(e) {
              return (e = e.g.targets)
                ? e.filter(function (t) {
                    return t.mode === F1 && t.enabled === !0;
                  })
                : [];
            }
            function $0(e) {
              return (
                e.g.sessionId || (e.g.sessionId = l.crypto.randomUUID()),
                {
                  v: e.g.version,
                  sf: e.l,
                  sid: e.g.sessionId,
                  cid: e.g.contentId,
                  mtp: e.j.getBandwidthEstimate() / 1e3,
                }
              );
            }
            function Xn(e, t, r) {
              if (
                ((r = r === void 0 ? {} : r),
                (t = Object.assign({ e: t, ts: Date.now() }, r)),
                (t = V0(e, t, U1)),
                (r = e.g.targets),
                !(e.g.version < K0) && r)
              ) {
                var s = C1(e);
                ((r = Array.from(new Set([].concat(V(W0), V(SN))))), (s = I(s)));
                for (var a = s.next(); !a.done; a = s.next()) {
                  a = a.value;
                  var c = G0(a.includeKeys || [], r);
                  (c.includes(O1) || c.push(O1), (c = j0(t, c)));
                  var f = a.events || [],
                    g = c.e,
                    m = c.sta;
                  (g &&
                    (!EN.includes(g) ||
                      !(g !== "ps" || (m && AN.includes(m))) ||
                      (f && f.length > 0 && !f.includes(g)))) ||
                    L1(e, c, a);
                }
              }
            }
            function cl(e, t, r) {
              if (e.g.enabled) {
                r = V0(e, r, N1);
                var s = _1({ mode: N1, useHeaders: e.g.useHeaders, includeKeys: e.g.includeKeys || [] });
                (e.o[s] || (e.o[s] = { request: 1, response: 1 }),
                  (r.sn = e.o[s].request++),
                  (s = e.g.includeKeys || []));
                var a = e.g.version == K0 ? Array.from(new Set([].concat(V(W0), V(xN)))) : P1;
                ((s = G0(s, a)), (r = j0(r, s)), hN(e, r, t, e.g.useHeaders));
              }
            }
            function L1(e, t, r, s) {
              var a = wr(),
                c = r.url;
              if (r.useHeaders) {
                if (((t = k1(t)), !Object.keys(t).length)) return;
                (s && Object.assign(s.headers, t), (s = fn([c], a)), Object.assign(s.headers, t));
              } else {
                if (((t = uc(t)), !t)) return;
                ((c = ef(c, t)), s && (s.uri = c), (s = fn([c], a)));
              }
              e.j.Yb().request(9, s);
            }
            function hN(e, t, r, s) {
              if (s) {
                if (((t = k1(t)), !Object.keys(t).length)) return;
                Object.assign(r.headers, t);
              } else {
                var a = uc(t);
                if (!a) return;
                r.uris = r.uris.map(function (c) {
                  return ef(c, a);
                });
              }
              B0(e).length > 0 || !e.m.has(r) || e.m.delete(r);
            }
            function G0(e, t) {
              if (!e || e.length === 0) return t;
              for (var r = I(e), s = r.next(); !s.done; s = r.next()) t.includes(s.value);
              return (e = e.filter(function (a) {
                return t.includes(a);
              }));
            }
            function j0(e, t) {
              return Object.keys(e).reduce(function (r, s) {
                return (t.includes(s) && (r[s] = e[s]), r);
              }, {});
            }
            function fN(e) {
              if (e.type === 0) return mN;
              if ((e = e.stream)) {
                var t = e.type;
                if (t == "video") return e.codecs && e.codecs.includes(",") ? rf : nf;
                if (t == "audio") return tf;
                if (t == "text") return e.mimeType === "application/mp4" ? sf : H0;
              }
            }
            function _1(e) {
              var t = Object.keys(e)
                .sort()
                .reduce(function (r, s) {
                  return (s !== "enabled" && (r[s] = e[s]), r);
                }, {});
              return JSON.stringify(t);
            }
            function pN(e, t) {
              if (((t = e.j.Gc()[t]), !t.length)) return NaN;
              var r = e.h ? e.h.currentTime : 0;
              return (e = t.find(function (s) {
                return s.start <= r && s.end >= r;
              }))
                ? (e.end - r) * 1e3
                : NaN;
            }
            function b1(e, t) {
              if (((t = e.j.Gc()[t]), !t.length)) return 0;
              var r = e.h ? e.h.currentTime : 0;
              return (e = t.find(function (s) {
                return s.start <= r && s.end >= r;
              }))
                ? (e.end - r) * 1e3
                : 0;
            }
            function gN(e, t) {
              var r = e.j.qc();
              if (!r.length) return NaN;
              ((e = r[0]), (r = I(r)));
              for (var s = r.next(); !s.done; s = r.next())
                ((s = s.value), s.type === "variant" && s.bandwidth > e.bandwidth && (e = s));
              switch (t) {
                case nf:
                  return e.videoBandwidth || NaN;
                case tf:
                  return e.audioBandwidth || NaN;
                default:
                  return e.bandwidth;
              }
            }
            function D1(e, t, r) {
              var s = t.segment,
                a = 0;
              (s && (a = s.endTime - s.startTime),
                (a = { d: a * 1e3, st: e.j.W() ? vN : yN }),
                (a.ot = fN(t)));
              var c = a.ot === nf || a.ot === tf || a.ot === rf || a.ot === sf;
              if ((t = t.stream)) {
                var f = e.j.Ob();
                if (c && ((a.bl = pN(e, t.type)), a.ot !== sf)) {
                  var g = b1(e, t.type);
                  a.dl = f ? g / Math.abs(f) : g;
                }
                if ((t.bandwidth && (a.br = t.bandwidth / 1e3), t.segmentIndex && s)) {
                  if ((f = t.segmentIndex.Xb(s.endTime, !0, f < 0)) && (f = f.next().value) && f != s) {
                    if (r && !Nr(s.P(), f.P())) {
                      var m = f.P()[0];
                      g = new URL(m);
                      var x = new URL(r);
                      if (g.origin !== x.origin) r = m;
                      else {
                        ((r = g.pathname.split("/").slice(1)),
                          (m = x.pathname.split("/").slice(1, -1)),
                          (x = Math.min(r.length, m.length)));
                        for (var E = 0; E < x && r[E] === m[E]; E++) (r.shift(), m.shift());
                        for (; m.length; ) (m.shift(), r.unshift(".."));
                        r = r.join("/") + g.search + g.hash;
                      }
                      a.nor = r;
                    }
                    (!f.startByte && !f.endByte) ||
                      (s.startByte == f.startByte && s.endByte == f.endByte) ||
                      ((r = f.startByte + "-"), f.endByte && (r += f.endByte), (a.nrr = r));
                  }
                  ((f = e.j.Ob() || 1),
                    (r = b1(e, t.type) || 500),
                    (s = (t = t.bandwidth)
                      ? ((t * (s.endTime - s.startTime)) / 1e3 / (r / f / 1e3)) * e.g.rtpSafetyFactor
                      : NaN),
                    isNaN(s) || (a.rtp = s));
                }
              }
              return (c && a.ot !== sf && (a.tb = gN(e, a.ot) / 1e3), a);
            }
            function V0(e, t, r) {
              (Object.assign(t, $0(e)), (t.pr = e.j.Ob()));
              var s = t.ot === nf || t.ot === rf;
              return (
                e.I && s && ((t.bs = !0), (t.su = !0), (e.I = !1)),
                t.su == null && (t.su = e.J),
                e.j.W() && ((s = oI(e.j)), (t.ltc = s || void 0)),
                document.hidden && (t.bg = !0),
                (s = e.C && e.B ? e.C - (e.H || e.B) : void 0),
                s == null || e.K[r] || ((t.msd = s), (e.K[r] = !0)),
                t
              );
            }
            function uc(e) {
              function t(A) {
                return r(A / 100) * 100;
              }
              function r(A) {
                return Math.round(A);
              }
              function s(A) {
                return !Number.isNaN(A) && A != null && A !== "" && A !== !1;
              }
              var a = [],
                c = {
                  br: r,
                  d: r,
                  bl: t,
                  dl: t,
                  mtp: t,
                  nor: function (A) {
                    return encodeURIComponent(A);
                  },
                  rtp: t,
                  tb: r,
                  ttfb: r,
                  ttlb: r,
                },
                f = Object.keys(e || {}).sort();
              f = I(f);
              for (var g = f.next(); !g.done; g = f.next()) {
                g = g.value;
                var m = e[g];
                if (s(m) && (g !== "v" || m !== 1) && (g != "pr" || m !== 1)) {
                  var x = c[g];
                  (x && (m = x(m)), (x = typeof m));
                  var E = void 0;
                  ((E =
                    x === "string" && g !== "ot" && g !== "sf" && g !== "st"
                      ? g + "=" + JSON.stringify(m)
                      : x === "boolean"
                        ? g
                        : x === "symbol"
                          ? g + "=" + m.description
                          : g + "=" + m),
                    a.push(E));
                }
              }
              return a.join(",");
            }
            function k1(e) {
              var t = Object.keys(e),
                r = {},
                s = ["Object", "Request", "Session", "Status"],
                a = [{}, {}, {}, {}],
                c = {
                  br: 0,
                  d: 0,
                  ot: 0,
                  tb: 0,
                  url: 0,
                  bl: 1,
                  dl: 1,
                  mtp: 1,
                  nor: 1,
                  nrr: 1,
                  su: 1,
                  ltc: 1,
                  ttfb: 1,
                  ttlb: 1,
                  ts: 1,
                  rc: 1,
                  cmsdd: 1,
                  cmsds: 1,
                  sn: 1,
                  cid: 2,
                  pr: 2,
                  sf: 2,
                  sid: 2,
                  st: 2,
                  v: 2,
                  msd: 2,
                  bs: 3,
                  rtp: 3,
                  bg: 3,
                };
              t = I(t);
              for (var f = t.next(); !f.done; f = t.next())
                ((f = f.value), (a[c[f] != null ? c[f] : 1][f] = e[f]));
              for (e = 0; e < a.length; e++) (c = uc(a[e])) && (r["CMCD-" + s[e]] = c);
              return r;
            }
            function ef(e, t) {
              return !t || e.includes("offline:") ? e : ((e = new un(e)), e.g.set("CMCD", t), e.toString());
            }
            var M1 = "m",
              tf = "a",
              nf = "v",
              rf = "av",
              mN = "i",
              H0 = "c",
              sf = "tt",
              K0 = 2,
              yN = "v",
              vN = "l",
              of = "d",
              af = "ld",
              lf = "h",
              uf = "lh";
            Ee("shaka.util.CmcdManager.StreamingFormat", {
              DASH: of,
              Sl: af,
              HLS: lf,
              Tl: uf,
              im: "s",
              OTHER: "o",
            });
            var P1 = "br bl bs cid d dl mtp nor nrr ot pr rtp sf sid st su tb v".split(" "),
              W0 =
                "br ab bl tbl bs cdn cid ltc mtp pr sf sid bg sta st ts tpb tb lb tab lab pt ec msd v sn".split(
                  " ",
                ),
              xN =
                "ab bl tbl bs cdn cid d dl ltc mtp nor ot pr rtp sf sid bg sta st su ts tpb tb lb tab lab pt ec msd v".split(
                  " ",
                ),
              TN = "d dl nor ot rtp rc su ttfb ttfbb ttlb url cmsdd cmsds".split(" "),
              SN = ["e", "sta"],
              EN = "ps e t c b m um pe pc".split(" "),
              AN = "spawkrfeqd".split(""),
              IN = 10,
              O1 = "ts",
              wN = "t",
              N1 = "request",
              F1 = "response",
              U1 = "event";
            function ur(e) {
              ((this.h = e), (this.g = null));
            }
            ((d = ur.prototype),
              (d.configure = function (e) {
                this.h = e;
              }),
              (d.ji = function () {
                return this.h.enabled && this.h.applyMaximumSuggestedBitrate && this.g && this.g.has(G1)
                  ? this.g.get(G1) * 1e3
                  : null;
              }),
              (d.gi = function () {
                return this.h.enabled && this.g && this.g.has($1) ? this.g.get($1) * 1e3 : null;
              }),
              (d.Xj = function () {
                return this.h.enabled && this.g && this.g.has(j1) ? this.g.get(j1) : null;
              }),
              (d.Yj = function () {
                return this.h.enabled && this.g && this.g.has(V1) ? this.g.get(V1) : null;
              }),
              (d.getBandwidthEstimate = function (e) {
                var t = this.gi();
                if (!t) return e;
                var r = this.h.estimatedThroughputWeightRatio;
                return r > 0 && r <= 1 ? e * (1 - r) + t * r : e;
              }));
            function B1(e) {
              return e
                ? e.toLowerCase() === "false"
                  ? !1
                  : /^[-0-9]/.test(e)
                    ? parseInt(e, 10)
                    : e.replace(/["]+/g, "")
                : !0;
            }
            (Ee("shaka.util.CmsdManager", ur),
              (ur.prototype.getBandwidthEstimate = ur.prototype.getBandwidthEstimate),
              (ur.prototype.getRoundTripTime = ur.prototype.Yj),
              (ur.prototype.getResponseDelay = ur.prototype.Xj),
              (ur.prototype.getEstimatedThroughput = ur.prototype.gi),
              (ur.prototype.getMaxBitrate = ur.prototype.ji));
            var $1 = "etp",
              G1 = "mb",
              j1 = "rd",
              V1 = "rtt";
            function H1() {
              ((this.g = null), (this.h = []));
            }
            function z0(e, t) {
              return W(function (r) {
                if (r.g == 1)
                  return e.g
                    ? _(
                        r,
                        new Promise(function (s) {
                          return e.h.push(s);
                        }),
                        2,
                      )
                    : r.A(2);
                ((e.g = t), K(r));
              });
            }
            H1.prototype.release = function () {
              this.h.length > 0 ? this.h.shift()() : (this.g = null);
            };
            function K1(e, t, r) {
              return (
                (r = r === void 0 ? Number.EPSILON : r),
                e === t
                  ? !0
                  : ((e = Math.abs(e - t)),
                    e <= r ? !0 : r !== Number.EPSILON ? Math.abs(e - r) <= Number.EPSILON : !1)
              );
            }
            function de(e, t, r) {
              ((t = t === void 0 ? null : t), Lt.call(this));
              var s = this;
              ((this.m = mf),
                (this.h = null),
                (this.Be = t),
                (this.$ = !1),
                (this.Le = new gt()),
                (this.Ce = new gt()),
                (this.j = new gt()),
                (this.dc = new gt()),
                (this.Gd = new gt()),
                (this.G = this.H = this.F = this.N = null),
                (this.Me = 0),
                (this.ba = new H1()),
                (this.O =
                  this.Fa =
                  this.X =
                  this.i =
                  this.zc =
                  this.I =
                  this.l =
                  this.ye =
                  this.T =
                  this.Ph =
                  this.va =
                  this.K =
                  this.kb =
                  this.za =
                  this.Ae =
                  this.R =
                  this.Ta =
                  this.M =
                  this.ac =
                    null),
                (this.Ua = !1),
                (this.Ge = this.o = null),
                (this.Fe = 1e9),
                (this.Ke = []),
                (this.yc = new Map()),
                (this.ob = []),
                (this.ag = -1),
                (this.g = jr(this)),
                (this.dg = d1()),
                (this.V = null),
                (this.Ne = -1),
                (this.cc = null),
                (this.ya = { width: 1 / 0, height: 1 / 0 }),
                (this.Ee = new Vm(this.g, this.ya, null)),
                (this.Ie = []),
                (this.B = null),
                (this.J = this.g.adaptationSetCriteriaFactory()),
                this.J.configure({
                  language: this.g.preferredAudioLanguage,
                  role: this.g.preferredAudioRole,
                  videoRole: this.g.preferredVideoRole,
                  channelCount: 0,
                  hdrLevel: this.g.preferredVideoHdrLevel,
                  spatialAudio: this.g.preferSpatialAudio,
                  videoLayout: this.g.preferredVideoLayout,
                  audioLabel: this.g.preferredAudioLabel,
                  videoLabel: this.g.preferredVideoLabel,
                  codecSwitchingStrategy: this.g.mediaSource.codecSwitchingStrategy,
                  audioCodec: "",
                  activeAudioCodec: "",
                  activeAudioChannelCount: 0,
                  preferredAudioCodecs: this.g.preferredAudioCodecs,
                  preferredAudioChannelCount: this.g.preferredAudioChannelCount,
                }),
                (this.Kd = this.g.preferredTextLanguage),
                (this.Od = this.g.preferredTextRole),
                (this.Nd = this.g.preferForcedSubs),
                (this.De = []),
                r && r(this),
                (this.K = new U0(this, this.g.cmcd)),
                (this.va = new ur(this.g.cmsd)),
                (this.N = J1(this)),
                (this.ma = this.oa = this.Da = this.C = null),
                (this.fg = !1),
                (this.cg = []),
                (this.eg = new it(function () {
                  return W(function (a) {
                    if (a.g == 1) return s.oa ? _(a, s.Vb(s.ma, !0), 3) : a.A(0);
                    if (a.g != 4) return _(a, s.load(s.oa), 4);
                    (s.fg ? s.ma.pause() : s.ma.play(), (s.oa = null), (s.fg = !1), K(a));
                  });
                })),
                yf &&
                  ((this.C = yf()),
                  this.C.configure(this.g.ads),
                  this.Gd.D(this.C, "ad-content-pause-requested", function (a) {
                    var c, f;
                    return W(function (g) {
                      if (g.g == 1)
                        return (
                          s.eg.stop(),
                          s.oa
                            ? g.A(0)
                            : ((s.ma = s.h),
                              (s.fg = s.ge()),
                              (c = a.saveLivePosition || !1),
                              (f = !0),
                              s.W() && (f = c),
                              _(g, s.$h(!0, f), 3))
                        );
                      ((s.oa = g.h), K(g));
                    });
                  }),
                  this.Gd.D(this.C, "ad-content-resume-requested", function (a) {
                    if (((a = a.offset || 0), s.oa)) {
                      var c = s.oa;
                      c.o &&
                        a &&
                        (typeof c.o == "number" ? (c.o += a) : c.o.setTime(c.o.getTime() + a * 1e3));
                    }
                    s.eg.ka(0.1);
                  }),
                  this.Gd.D(this.C, "ad-content-attach-requested", function () {
                    return W(function (a) {
                      if (a.g == 1) return s.h || !s.ma ? a.A(0) : _(a, s.Vb(s.ma, !0), 3);
                      ((s.ma = null), K(a));
                    });
                  })),
                vf && ((this.Da = vf(this)), this.Da.configure(this.g.queue)),
                this.Le.D(l, "online", function () {
                  (ey(s), s.kh());
                }),
                (this.He = new it(function () {
                  for (
                    var a = Date.now() / 1e3, c = !1, f = !0, g = I(s.i.variants), m = g.next();
                    !m.done;
                    m = g.next()
                  )
                    ((m = m.value),
                      m.disabledUntilTime > 0 &&
                        m.disabledUntilTime <= a &&
                        ((m.disabledUntilTime = 0), (c = !0)),
                      m.disabledUntilTime > 0 && (f = !1));
                  (f && s.He.stop(), c && mo(s, !1, void 0, !1, !1));
                })),
                (this.eb = null),
                e &&
                  (ft(
                    "Player w/ mediaElement",
                    "Please migrate from initializing Player with a mediaElement; use the attach method instead.",
                  ),
                  this.Vb(e, !0)),
                (this.u = null));
            }
            N(de, Lt);
            function cf(e) {
              e.T != null && (GS(e.T), e.T.release(), (e.T = null));
            }
            function RN(e, t, r) {
              r || t.lcevc.enabled
                ? (cf(e), e.T == null && ((e.T = new Eu(e.h, e.Ph, t.lcevc, r)), e.H && (e.H.C = e.T)))
                : cf(e);
            }
            function Pt(e, t) {
              return new Me(e, t);
            }
            ((d = de.prototype),
              (d.destroy = function () {
                var e = this,
                  t;
                return W(function (r) {
                  switch (r.g) {
                    case 1:
                      return e.m == Rr ? r.return() : (cf(e), (t = e.detach()), (e.m = Rr), _(r, t, 2));
                    case 2:
                      return _(r, e.rg(), 3);
                    case 3:
                      if (
                        (e.Le && (e.Le.release(), (e.Le = null)),
                        e.Ce && (e.Ce.release(), (e.Ce = null)),
                        e.j && (e.j.release(), (e.j = null)),
                        e.dc && (e.dc.release(), (e.dc = null)),
                        e.Gd && (e.Gd.release(), (e.Gd = null)),
                        (e.Ge = null),
                        (e.g = null),
                        (e.B = null),
                        (e.Be = null),
                        (e.K = null),
                        (e.va = null),
                        !e.N)
                      ) {
                        r.A(4);
                        break;
                      }
                      return _(r, e.N.destroy(), 5);
                    case 5:
                      e.N = null;
                    case 4:
                      (e.o && (e.o.release(), (e.o = null)),
                        e.Da && (e.Da.destroy(), (e.Da = null)),
                        Lt.prototype.release.call(e),
                        K(r));
                  }
                });
              }));
            function W1(e, t) {
              SI.set(e, t);
            }
            function dl(e, t) {
              e.dispatchEvent(Pt("onstatechange", new Map().set("state", t)));
            }
            ((d.Vb = function (e, t) {
              t = t === void 0 ? !0 : t;
              var r = this,
                s,
                a,
                c;
              return W(function (f) {
                switch (f.g) {
                  case 1:
                    if (r.m == Rr) throw new ee(2, 7, 7e3);
                    if (((s = r.h && r.h == e), !r.h || r.h == e)) {
                      f.A(2);
                      break;
                    }
                    return _(f, r.detach(), 2);
                  case 2:
                    return _(f, Y0(r, "attach"), 4);
                  case 4:
                    if (f.h) return f.return();
                    if (
                      (q(f, 5, 6),
                      s ||
                        (dl(r, "attach"),
                        (a = function () {
                          var g = ty(r, !1);
                          g && hl(r, g);
                        }),
                        r.Ce.D(e, "error", a),
                        (r.h = e),
                        r.K && r.K.setMediaElement(e)),
                      tt(),
                      !t || !es() || r.H)
                    ) {
                      f.A(6);
                      break;
                    }
                    return _(f, X0(r), 6);
                  case 6:
                    (ye(f), r.ba.release(), ve(f, 0));
                    break;
                  case 5:
                    return ((c = ae(f)), _(f, r.detach(), 10));
                  case 10:
                    throw c;
                }
              });
            }),
              (d.qj = function (e) {
                this.Ph = e;
              }),
              (d.detach = function (e) {
                e = e === void 0 ? !1 : e;
                var t = this;
                return W(function (r) {
                  if (r.g == 1) {
                    if (t.m == Rr) throw new ee(2, 7, 7e3);
                    return _(r, t.Cc(!1, e), 2);
                  }
                  if (r.g != 3) return _(r, Y0(t, "detach"), 3);
                  if (r.h) return r.return();
                  try {
                    (t.h && (t.Ce.Qa(), (t.h = null)), dl(t, "detach"), t.C && !e && t.C.release());
                  } finally {
                    t.ba.release();
                  }
                  K(r);
                });
              }));
            function Y0(e, t) {
              var r;
              return W(function (s) {
                return s.g == 1
                  ? ((r = ++e.Me), _(s, z0(e.ba, t), 2))
                  : r != e.Me
                    ? (e.ba.release(), s.return(!0))
                    : s.return(!1);
              });
            }
            ((d.Cc = function (e, t) {
              ((e = e === void 0 ? !0 : e), (t = t === void 0 ? !1 : t));
              var r = this,
                s,
                a,
                c,
                f,
                g,
                m,
                x,
                E,
                A,
                R,
                b,
                D,
                M,
                P,
                G,
                U;
              return W(function (H) {
                switch (H.g) {
                  case 1:
                    return (r.m != Rr && (r.m = mf), _(H, Y0(r, "unload"), 2));
                  case 2:
                    return H.h
                      ? H.return()
                      : (ce(H, 3),
                        (r.Ua = !1),
                        dl(r, "unload"),
                        cf(r),
                        (s = r.De.map(function (Q) {
                          return Q();
                        })),
                        (r.De = []),
                        _(H, Promise.all(s), 5));
                  case 5:
                    if (
                      (r.dispatchEvent(Pt("unloading")),
                      r.Ae && (r.Ae.release(), (r.Ae = null)),
                      r.za && (r.za.release(), (r.za = null)),
                      r.kb && (r.kb.release(), (r.kb = null)),
                      r.h && (r.j.Qa(), r.dc.Qa()),
                      r.He.stop(),
                      r.ac && (r.ac.release(), (r.ac = null)),
                      r.Ta && (r.Ta.stop(), (r.Ta = null)),
                      !r.I)
                    ) {
                      H.A(6);
                      break;
                    }
                    return _(H, r.I.stop(), 7);
                  case 7:
                    ((r.I = null), (r.zc = null));
                  case 6:
                    if ((r.o && r.o.stop(), !r.l)) {
                      H.A(8);
                      break;
                    }
                    return _(H, r.l.destroy(), 9);
                  case 9:
                    r.l = null;
                  case 8:
                    if (
                      (r.M && (r.M.release(), (r.M = null)),
                      r.G && (r.G.release(), (r.G = null)),
                      l.shakaMediaKeysPolyfill !== "webkit" || !r.F)
                    ) {
                      H.A(10);
                      break;
                    }
                    return _(H, r.F.destroy(), 11);
                  case 11:
                    r.F = null;
                  case 10:
                    if (!r.H) {
                      H.A(12);
                      break;
                    }
                    return _(H, r.H.destroy(), 13);
                  case 13:
                    r.H = null;
                  case 12:
                    if (
                      (r.C && !t && r.C.onAssetUnload(),
                      r.oa && !t && (r.oa.destroy(), (r.oa = null)),
                      t || r.eg.stop(),
                      r.K && oN(r.K),
                      r.va && (r.va.g = null),
                      !r.u)
                    ) {
                      H.A(14);
                      break;
                    }
                    return _(H, r.u.destroy(), 15);
                  case 15:
                    r.u = null;
                  case 14:
                    if (((r.$ = !1), r.h)) {
                      for (a = I(r.cg), c = a.next(); !c.done; c = a.next())
                        ((f = c.value), f.src.startsWith("blob:") && URL.revokeObjectURL(f.src), f.remove());
                      ((r.cg = []), _h(r.h) && r.h.load());
                    }
                    if (!r.F) {
                      H.A(16);
                      break;
                    }
                    return _(H, r.F.destroy(), 17);
                  case 17:
                    r.F = null;
                  case 16:
                    if (
                      (r.eb && r.X != r.eb.rd() && (r.eb.l || r.eb.destroy(), (r.eb = null)),
                      (r.X = null),
                      (r.Fa = null),
                      (r.R = null),
                      r.i)
                    ) {
                      for (g = I(r.i.variants), m = g.next(); !m.done; m = g.next())
                        for (x = m.value, E = I([x.audio, x.video]), A = E.next(); !A.done; A = E.next())
                          (R = A.value) && R.segmentIndex && R.segmentIndex.release();
                      for (b = I(r.i.textStreams), D = b.next(); !D.done; D = b.next())
                        ((M = D.value), M.segmentIndex && M.segmentIndex.release());
                    }
                    for (
                      r.g && r.g.streaming.clearDecodingCache && (ph.clear(), ka.clear()),
                        r.i = null,
                        r.B = new Zh(),
                        r.Oh = null,
                        r.cc = null,
                        r.V = null,
                        r.Ne = -1,
                        r.Ke = [],
                        P = I(r.yc.values()),
                        G = P.next();
                      !G.done;
                      G = P.next()
                    )
                      ((U = G.value), U.stop());
                    (r.yc.clear(), (r.ob = []), (r.ag = -1), r.N && r.N.Wh(), cc(r));
                  case 3:
                    (ye(H), r.ba.release(), ve(H, 4));
                    break;
                  case 4:
                    if ((tt(), e && es() && !r.H && r.h)) return _(H, X0(r), 0);
                    H.A(0);
                }
              });
            }),
              (d.ql = function (e) {
                this.O = e;
              }),
              (d.load = function (e, t, r) {
                t = t === void 0 ? null : t;
                var s = this,
                  a,
                  c,
                  f,
                  g,
                  m,
                  x,
                  E,
                  A,
                  R,
                  b,
                  D,
                  M,
                  P,
                  G;
                return W(function (U) {
                  switch (U.g) {
                    case 1:
                      if (s.m == Rr) throw new ee(2, 7, 7e3);
                      if (s.h || !s.ma) {
                        U.A(2);
                        break;
                      }
                      return _(U, s.Vb(s.ma, !0), 3);
                    case 3:
                      s.ma = null;
                    case 2:
                      if (((a = null), (c = ""), e instanceof lr)) {
                        if (e.l) throw new ee(2, 7, 7006);
                        ((a = e), (c = a.rd() || ""));
                      } else c = e || "";
                      return _(U, z0(s.ba, "load"), 4);
                    case 4:
                      if ((s.ba.release(), !s.h)) throw new ee(2, 7, 7002);
                      if (!s.X) {
                        U.A(5);
                        break;
                      }
                      return ((s.X = c), _(U, s.Cc(!1), 5));
                    case 5:
                      if (
                        ((f = ++s.Me),
                        (g = function () {
                          return W(function (H) {
                            if (H.g == 1) return s.Me == f ? H.A(0) : a ? _(H, a.destroy(), 3) : H.A(3);
                            throw new ee(2, 7, 7e3);
                          });
                        }),
                        (m = function (H, Q) {
                          return W(function (ne) {
                            switch (ne.g) {
                              case 1:
                                return (ce(ne, 2), _(ne, z0(s.ba, Q), 4));
                              case 4:
                                return _(ne, g(), 5);
                              case 5:
                                return _(ne, H(), 6);
                              case 6:
                                return _(ne, g(), 7);
                              case 7:
                                a && s.g && (a.g = s.g);
                              case 2:
                                (ye(ne), s.ba.release(), ve(ne, 0));
                            }
                          });
                        }),
                        q(U, 7, 8),
                        t == null && a && (t = a.getStartTime()),
                        (s.O = t),
                        (s.Ua = !1),
                        s.dispatchEvent(Pt("loading")),
                        a)
                      ) {
                        ((r = a.V), U.A(10));
                        break;
                      }
                      if (r) {
                        U.A(10);
                        break;
                      }
                      return _(
                        U,
                        m(function () {
                          return W(function (H) {
                            if (H.g == 1) return _(H, q1(s, c), 2);
                            ((r = H.h), K(H));
                          });
                        }, "guessMimeType_"),
                        10,
                      );
                    case 10:
                      if (((x = !!a), a)) {
                        (p1(a, s), (s.B = a.getStats()), U.A(13));
                        break;
                      }
                      return _(U, Y1(s, c, t, r, !0, s.g), 14);
                    case 14:
                      (a = U.h)
                        ? ((a.F = !1), p1(a, s), (s.B = a.getStats()), a.start(), a.B.catch(function () {}))
                        : (s.B = new Zh());
                    case 13:
                      return (
                        (E = !a),
                        (A = Date.now() / 1e3),
                        (s.B = a ? a.getStats() : new Zh()),
                        (s.X = c),
                        (s.Fa = r || null),
                        cc(s),
                        (R = function () {
                          var H = s.h ? s.h.buffered : null;
                          return { start: fA(H) || 0, end: Lh(H) || 0 };
                        }),
                        (s.za = new Qu(R)),
                        s.za.addEventListener("regionadd", function (H) {
                          q0(s, H.region, "metadataadded");
                        }),
                        E
                          ? _(
                              U,
                              m(function () {
                                return W(function (H) {
                                  return _(H, bN(s, r), 0);
                                });
                              }, "initializeSrcEqualsDrmInner_"),
                              25,
                            )
                          : ((s.kb = new Qu(R)),
                            _(
                              U,
                              m(function () {
                                return W(function (H) {
                                  if (H.g == 1) return _(H, Promise.race([a.ma, a.B]), 2);
                                  s.zc = a.H;
                                  var Q = a;
                                  ((Q.oa = !0), (s.I = Q.m), (s.i = a.Lg()), K(H));
                                });
                              }, "waitForFinish"),
                              17,
                            ))
                      );
                    case 17:
                      if (s.H) {
                        U.A(18);
                        break;
                      }
                      return _(
                        U,
                        m(function () {
                          return W(function (H) {
                            return _(H, X0(s), 0);
                          });
                        }, "initializeMediaSourceEngineInner_"),
                        18,
                      );
                    case 18:
                      return (
                        s.i &&
                          s.i.textStreams.length &&
                          (s.u.enableTextDisplayer
                            ? s.u.enableTextDisplayer()
                            : ft(
                                "Text displayer w/ enableTextDisplayer",
                                'Text displayer should have a "enableTextDisplayer" method!',
                              )),
                        _(
                          U,
                          m(function () {
                            return W(function (H) {
                              return _(H, a.B, 0);
                            });
                          }, "waitForFinish"),
                          20,
                        )
                      );
                    case 20:
                      if (
                        ((s.g = a.getConfiguration()),
                        (s.Ee = a.G),
                        s.I && s.I.setMediaElement && s.h && s.I.setMediaElement(s.h),
                        (s.Ae = HO(a)),
                        (s.ye = a.Fa),
                        (b = a.C) && (s.J = b),
                        x &&
                          s.h &&
                          s.h.nodeName === "AUDIO" &&
                          (CN(s), s.configure("manifest.disableVideo", !0)),
                        a.j)
                      ) {
                        U.A(21);
                        break;
                      }
                      return _(
                        U,
                        m(function () {
                          return W(function (H) {
                            return _(H, g1(a, s.h), 0);
                          });
                        }, "drmEngine_.init"),
                        21,
                      );
                    case 21:
                      return (
                        (s.F = KO(a)),
                        _(
                          U,
                          m(function () {
                            return W(function (H) {
                              return _(H, s.F.Vb(s.h), 0);
                            });
                          }, "drmEngine_.attach"),
                          23,
                        )
                      );
                    case 23:
                      return (
                        (D = s.g.abrFactory),
                        (s.o && s.Ge == D) ||
                          ((s.Ge = D),
                          s.o && s.o.release(),
                          (s.o = D()),
                          typeof s.o.setMediaElement != "function" &&
                            (ft(
                              "AbrManager w/o setMediaElement",
                              "Please use an AbrManager with setMediaElement function.",
                            ),
                            (s.o.setMediaElement = function () {})),
                          typeof s.o.setCmsdManager != "function" &&
                            (ft(
                              "AbrManager w/o setCmsdManager",
                              "Please use an AbrManager with setCmsdManager function.",
                            ),
                            (s.o.setCmsdManager = function () {})),
                          typeof s.o.trySuggestStreams != "function" &&
                            (ft(
                              "AbrManager w/o trySuggestStreams",
                              "Please use an AbrManager with trySuggestStreams function.",
                            ),
                            (s.o.trySuggestStreams = function () {})),
                          s.o.configure(s.g.abr)),
                        (M = WO(a)),
                        (P = a.i),
                        _(
                          U,
                          m(function () {
                            return W(function (H) {
                              return _(H, _N(s, A, P, M), 0);
                            });
                          }, "loadInner_"),
                          24,
                        )
                      );
                    case 24:
                      (VO(a), s.Fa && tt().gj() && oh(s.Fa) && P2(s.H, s.X, s.Fa), U.A(16));
                      break;
                    case 25:
                      return _(
                        U,
                        m(function () {
                          return W(function (H) {
                            return _(H, DN(s, A, r), 0);
                          });
                        }, "srcEqualsInner_"),
                        16,
                      );
                    case 16:
                      s.dispatchEvent(Pt("loaded"));
                    case 8:
                      if ((ye(U), !a)) {
                        U.A(27);
                        break;
                      }
                      return _(U, a.destroy(), 27);
                    case 27:
                      ((s.eb = null), ve(U, 0));
                      break;
                    case 7:
                      if (((G = ae(U)), !G || G.code == 7e3)) {
                        U.A(29);
                        break;
                      }
                      return _(U, s.Cc(!1), 29);
                    case 29:
                      throw G;
                  }
                });
              }));
            function CN(e) {
              for (var t = I(e.i.variants), r = t.next(); !r.done; r = t.next())
                ((r = r.value),
                  r.video && (r.video.closeSegmentIndex(), (r.video = null)),
                  (r.bandwidth = r.audio && r.audio.bandwidth ? r.audio.bandwidth : 0));
              e.i.variants = e.i.variants.filter(function (s) {
                return s.audio;
              });
            }
            ((d.jj = function (e, t, r) {
              ((e = e === void 0 ? !0 : e), (t = t === void 0 ? !1 : t), (r = r === void 0 ? !1 : r));
              var s = this,
                a;
              return W(function (c) {
                return c.g == 1
                  ? _(c, z1(s, r), 2)
                  : c.g != 3
                    ? ((a = c.h), _(c, s.Cc(e, t), 3))
                    : c.return(a);
              });
            }),
              (d.$h = function (e, t) {
                ((e = e === void 0 ? !1 : e), (t = t === void 0 ? !1 : t));
                var r = this,
                  s;
                return W(function (a) {
                  return a.g == 1
                    ? _(a, z1(r, t), 2)
                    : a.g != 3
                      ? ((s = a.h), _(a, r.detach(e), 3))
                      : a.return(s);
                });
              }));
            function z1(e, t) {
              t = t === void 0 ? !1 : t;
              var r, s, a;
              return W(function (c) {
                if (c.g == 1)
                  return (
                    (r = null),
                    e.i && e.I && e.zc && e.X && e.g
                      ? ((s = e.h.currentTime), t || (s = null), _(c, X1(e, e.X, s, e.Fa, e.g, !0, !1), 3))
                      : c.A(2)
                  );
                if (c.g != 2) {
                  ((r = c.h),
                    e.Ie.push(r),
                    e.I && e.I.setMediaElement && e.I.setMediaElement(null),
                    (a = e.l ? e.l.o : null) && (r.i = a));
                  var f = r,
                    g = e.I,
                    m = e.zc;
                  ((f.h = e.i),
                    (f.m = g),
                    (f.H = m),
                    (r.C = e.J),
                    r.start(),
                    (e.i = null),
                    (e.I = null),
                    (e.zc = null),
                    (e.o = null),
                    (e.Ge = null));
                }
                return c.return(r);
              });
            }
            ((d.preload = function (e, t, r, s) {
              t = t === void 0 ? null : t;
              var a = this,
                c,
                f;
              return W(function (g) {
                return g.g == 1
                  ? ((c = jr(a)), bs(c, s || a.g, jr(a)), _(g, Y1(a, e, t, r, !1, c), 2))
                  : ((f = g.h) ? f.start() : hl(a, new ee(2, 7, 7005)), g.return(f));
              });
            }),
              (d.rg = function () {
                var e = this,
                  t,
                  r,
                  s,
                  a;
                return W(function (c) {
                  for (t = [], r = I(e.Ie), s = r.next(); !s.done; s = r.next())
                    ((a = s.value), a.l || t.push(a.destroy()));
                  return ((e.Ie = []), _(c, Promise.all(t), 0));
                });
              }));
            function Y1(e, t, r, s, a, c) {
              a = a === void 0 ? !1 : a;
              var f, g, m;
              return W(function (x) {
                return x.g == 1
                  ? s
                    ? x.A(2)
                    : _(x, q1(e, t), 3)
                  : (x.g != 2 && (s = x.h),
                    LN(e, s)
                      ? x.return(null)
                      : ((f = c || e.g),
                        (g = !1),
                        a && e.h && e.h.nodeName === "AUDIO" && (g = !0),
                        (m = X1(e, t, r, s || null, f, !a, g)),
                        (m = a
                          ? m.then(function (E) {
                              return ((E.F = !1), E);
                            })
                          : m.then(function (E) {
                              return (e.Ie.push(E), E);
                            })),
                        x.return(m)));
              });
            }
            function X1(e, t, r, s, a, c, f) {
              ((c = c === void 0 ? !0 : c), (f = f === void 0 ? !1 : f));
              var g, m, x, E, A, R, b, D, M, P, G, U, H, Q, ne;
              return W(function (z) {
                return z.g == 1
                  ? ((g = null),
                    (m = Ar(a)),
                    f && (m.manifest.disableVideo = !0),
                    (x = function () {
                      return g.R && g.l ? null : g;
                    }),
                    (E = function () {
                      return x() ? x().getConfiguration() : e.g;
                    }),
                    e.ya.width != 1 / 0 || e.ya.height != 1 / 0 || e.g.ignoreHardwareResolution
                      ? z.A(2)
                      : ((A = tt()), _(z, A.lc(), 3)))
                  : (z.g != 2 && ((R = z.h), (e.ya.width = R.width), (e.ya.height = R.height)),
                    (b = new Vm(m, e.ya, null)),
                    (D = {
                      networkingEngine: e.N,
                      filter: function (J) {
                        var X, ie;
                        return W(function (Z) {
                          if (Z.g == 1) return _(Z, QE(b, J), 2);
                          if (Z.g != 4)
                            return (
                              (X = Z.h),
                              X ? ((ie = Pt("trackschanged")), _(Z, Promise.resolve(), 4)) : Z.A(0)
                            );
                          (g.dispatchEvent(ie), K(Z));
                        });
                      },
                      makeTextStreamsForClosedCaptions: function (J) {
                        return HN(e, J);
                      },
                      onTimelineRegionAdded: function (J) {
                        f0(g.I, J);
                      },
                      onEvent: function (J) {
                        return g.dispatchEvent(J);
                      },
                      onError: function (J) {
                        return g.onError(J);
                      },
                      isLowLatencyMode: function () {
                        return E().streaming.lowLatencyMode;
                      },
                      updateDuration: function () {
                        e.l && g.R && e.l.updateDuration();
                      },
                      newDrmInfo: function (J) {
                        var X = g.j,
                          ie = X ? X.g : null;
                        ie && X.B && eA(b, ie.keySystem, J);
                      },
                      onManifestUpdated: function () {
                        var J = new Map().set("isLive", e.W());
                        (g.dispatchEvent(Pt("manifestupdated", J)),
                          sc(g, !1, function () {
                            e.C && e.C.onManifestUpdated(e.W());
                          }));
                      },
                      getBandwidthEstimate: function () {
                        return e.o.getBandwidthEstimate();
                      },
                      onMetadata: function (J, X, ie, Z) {
                        var re = J;
                        ((J == "com.apple.hls.interstitial" || J == "com.apple.hls.overlay") &&
                          ((re = "com.apple.quicktime.HLS"),
                          (J = { startTime: X, endTime: ie, values: Z }),
                          e.C && e.C.onHLSInterstitialMetadata(e, e.h, J)),
                          (Z = I(Z)),
                          (J = Z.next()));
                        for (var se = {}; !J.done; se = { bh: void 0 }, J = Z.next())
                          ((se.bh = J.value),
                            se.bh.name != "ID" &&
                              sc(
                                g,
                                !1,
                                (function (me) {
                                  return function () {
                                    Q0(e, X, ie, re, me.bh);
                                  };
                                })(se),
                              ));
                      },
                      disableStream: function (J) {
                        return e.disableStream(J, e.g.streaming.maxDisabledTime);
                      },
                      addFont: function (J, X) {
                        return e.addFont(J, X);
                      },
                    }),
                    (M = new Qu(function () {
                      return e.Ra();
                    })),
                    M.addEventListener("regionadd", function (J) {
                      var X = J.region;
                      (fc(e, "timelineregionadded", X, g),
                        sc(g, !1, function () {
                          e.C && (e.C.onDashTimedMetadata(X), e.C.onDASHInterstitialMetadata(e, e.h, X));
                        }));
                    }),
                    (P = null),
                    m.streaming.observeQualityChanges &&
                      ((P = new Nh(function () {
                        return e.Gc();
                      })),
                      P.addEventListener("qualitychange", function (J) {
                        yI(e, J.quality, J.position);
                      }),
                      P.addEventListener("audiotrackchange", function (J) {
                        yI(e, J.quality, J.position, !0);
                      })),
                    (G = !0),
                    (U = {
                      vc: e.N,
                      onError: function (J) {
                        return g.onError(J);
                      },
                      zf: function (J) {
                        sc(g, !0, function () {
                          e.F && WN(e, J);
                        });
                      },
                      onExpirationUpdated: function (J, X) {
                        var ie = Pt("expirationupdated");
                        (g.dispatchEvent(ie),
                          (ie = g.m) && ie.onExpirationUpdated && ie.onExpirationUpdated(J, X));
                      },
                      onEvent: function (J) {
                        (g.dispatchEvent(J),
                          J.type == "drmsessionupdate" &&
                            G &&
                            ((G = !1),
                            (J = Date.now() / 1e3 - g.za),
                            ((e.B || g.getStats()).m = J),
                            e.T && GS(e.T)));
                      },
                    }),
                    (H = J1(e, x)),
                    DE(e.N, H),
                    (Q = function () {
                      return e.md(U);
                    }),
                    (ne = { config: m, zk: D, Kk: M, Jk: P, md: Q, yk: b, networkingEngine: H, pj: c }),
                    (g = new lr(t, s, r, ne)),
                    z.return(g));
              });
            }
            function q1(e, t) {
              var r, s, a, c;
              return W(function (f) {
                return f.g == 1
                  ? ((r = e.g.manifest.retryParameters), _(f, rl(t, e.N, r), 2))
                  : ((s = f.h),
                    s == "application/x-mpegurl" &&
                      ((a = tt()), a.Ha() === "WEBKIT" && (s = "application/vnd.apple.mpegurl")),
                    s == "video/quicktime" && ((c = tt()), c.Ha() === "CHROMIUM" && (s = "video/mp4")),
                    f.return(s));
              });
            }
            function LN(e, t) {
              if (!es(tt())) return !0;
              if (t) {
                if ((e.h || na()).canPlayType(t) == "") return !1;
                if (!es(tt()) || !Pa.has(t.toLowerCase())) return !0;
                if (oh(t))
                  return tt().Ha() === "WEBKIT" &&
                    (e.g.drm.servers["com.apple.fps"] || e.g.drm.servers["com.apple.fps.1_0"])
                    ? e.g.streaming.useNativeHlsForFairPlay
                    : e.g.streaming.preferNativeHls;
                if (t === "application/dash+xml" || t === "video/vnd.mpeg.dash.mpd")
                  return e.g.streaming.preferNativeDash;
              }
              return !1;
            }
            function df(e, t) {
              var r = e.g.textDisplayFactory;
              e.Oh !== r || (t !== void 0 && t)
                ? ((t = e.u),
                  (e.u = r()),
                  e.u.configure
                    ? e.u.configure(e.g.textDisplayer)
                    : ft("Text displayer w/ configure", 'Text displayer should have a "configure" method!'),
                  e.u.setTextLanguage ||
                    ft(
                      "Text displayer w/ setTextLanguage",
                      'Text displayer should have a "setTextLanguage" method!',
                    ),
                  t
                    ? (e.u.setTextVisibility(t.isTextVisible()), t.destroy().catch(function () {}))
                    : e.u.setTextVisibility(e.$),
                  e.H && V2(e.H, e.u),
                  (e.Oh = r),
                  e.l && gO(e.l))
                : e.u && e.u.configure && e.u.configure(e.g.textDisplayer);
            }
            function X0(e) {
              var t, r, s;
              return W(function (a) {
                if (a.g == 1)
                  return (
                    tt(),
                    dl(e, "media-source"),
                    e.g.mediaSource.useSourceElements && _h(e.h),
                    df(e),
                    (t = BN(
                      e.h,
                      e.u,
                      {
                        Pj: function () {
                          return e.keySystem();
                        },
                        onMetadata: function (c, f, g) {
                          c = I(c);
                          for (var m = c.next(); !m.done; m = c.next())
                            if (((m = m.value), m.data && typeof m.cueTime == "number" && m.frames)) {
                              var x = m.cueTime + f,
                                E = g;
                              E && x > E && (E = x);
                              for (var A = I(m.frames), R = A.next(); !R.done; R = A.next())
                                Q0(e, x, E, "org.id3", R.value);
                              e.C && e.C.onHlsTimedMetadata(m, x);
                            }
                        },
                        Ek: function (c) {
                          e.kb &&
                            f0(e.kb, {
                              schemeIdUri: c.schemeIdUri,
                              startTime: c.startTime,
                              endTime: c.endTime,
                              id: String(c.id),
                              emsg: c,
                            });
                        },
                        onEvent: function (c) {
                          return e.dispatchEvent(c);
                        },
                        Gk: function () {
                          e.I && e.I.update && e.I.update();
                        },
                      },
                      e.T,
                      e.g.mediaSource,
                    )),
                    (r = e.g.manifest),
                    (s = r.segmentRelativeVttTiming),
                    (t.Fa = s),
                    _(a, t.M, 2)
                  );
                ((e.H = t), K(a));
              });
            }
            function Q1(e, t, r) {
              function s() {
                return J0(e);
              }
              if (
                (e.j.D(t, "playing", s),
                e.j.D(t, "pause", s),
                e.j.D(t, "ended", s),
                e.j.D(t, "ratechange", function () {
                  var c = e.h.playbackRate;
                  c != 0 &&
                    (e.M && (e.M.set(c), e.m == $n && e.o.playbackRateChanged(c), lI(e, c)),
                    (c = Pt("ratechange")),
                    e.dispatchEvent(c));
                }),
                t.remote &&
                  (e.j.D(t.remote, "connect", function () {
                    (e.l && t.remote.state == "connected" && ks(e), ci(e));
                  }),
                  e.j.D(t.remote, "connecting", function () {
                    return ci(e);
                  }),
                  e.j.D(t.remote, "disconnect", function () {
                    return W(function (c) {
                      if (c.g == 1)
                        return e.l && t.remote.state == "disconnected" ? _(c, Hh(e.l), 3) : c.A(2);
                      (c.g != 2 && ks(e), ci(e), K(c));
                    });
                  })),
                t.audioTracks &&
                  (e.j.D(t.audioTracks, "addtrack", function () {
                    return ci(e);
                  }),
                  e.j.D(t.audioTracks, "removetrack", function () {
                    return ci(e);
                  }),
                  e.j.D(t.audioTracks, "change", function () {
                    return ci(e);
                  })),
                t.videoTracks &&
                  (e.j.D(t.videoTracks, "addtrack", function () {
                    return ci(e);
                  }),
                  e.j.D(t.videoTracks, "removetrack", function () {
                    return ci(e);
                  }),
                  e.j.D(t.videoTracks, "change", function () {
                    return ci(e);
                  })),
                (t.webkitPresentationMode || t.webkitSupportsFullscreen) &&
                  e.j.D(t, "webkitpresentationmodechanged", function () {
                    e.Be && df(e, !0);
                  }),
                t.textTracks)
              ) {
                var a = function () {
                  (e.m === Ui && e.u instanceof Tn && ks(e), ci(e));
                };
                (e.j.D(t.textTracks, "addtrack", function (c) {
                  if (c.track)
                    switch (((c = c.track), c.kind)) {
                      case "metadata":
                        PN(e, c);
                        break;
                      case "chapters":
                        ON(e, c);
                        break;
                      default:
                        a();
                    }
                }),
                  e.j.D(t.textTracks, "removetrack", a),
                  e.j.D(t.textTracks, "change", a));
              }
              t.preload != "none" &&
                e.j.Aa(t, "loadedmetadata", function () {
                  e.B.G = Date.now() / 1e3 - r;
                });
            }
            function _N(e, t, r, s) {
              var a, c, f, g, m, x, E, A, R, b, D, M, P, G, U, H, Q, ne, z, J, X, ie, Z, re, se, me, fe, le;
              return W(function (ue) {
                switch (ue.g) {
                  case 1:
                    for (
                      dl(e, "load"),
                        a = e.h,
                        e.M = new qu({
                          cf: function () {
                            return a.playbackRate;
                          },
                          Tc: function () {
                            return a.defaultPlaybackRate;
                          },
                          uh: function (xe) {
                            a.playbackRate = xe;
                          },
                          Di: function (xe) {
                            a.currentTime += xe;
                          },
                        }),
                        Q1(e, a, t),
                        ("onchange" in l.screen) &&
                          e.j.D(l.screen, "change", function () {
                            if (e.J.getConfiguration) {
                              var xe = e.J.getConfiguration();
                              xe.hdrLevel == "AUTO"
                                ? go(e)
                                : e.g.preferredVideoHdrLevel == "AUTO" &&
                                  e.g.abr.enabled &&
                                  ((xe.hdrLevel = "AUTO"), e.J.configure(xe), go(e));
                            }
                          }),
                        c = !1,
                        f = I(e.i.variants),
                        g = f.next();
                      !g.done;
                      g = f.next()
                    )
                      ((m = g.value), (x = m.video && m.video.dependencyStream) && (c = jS(x)));
                    (RN(e, e.g, c),
                      (e.Kd = e.g.preferredTextLanguage),
                      (e.Od = e.g.preferredTextRole),
                      (e.Nd = e.g.preferForcedSubs),
                      ny(e.i.presentationTimeline, e.g.playRangeStart, e.g.playRangeEnd),
                      e.o.init(function (xe, Se, Ye) {
                        e.i &&
                          e.l &&
                          xe != e.l.o &&
                          dc(e, xe, !0, Se === void 0 ? !1 : Se, Ye === void 0 ? 0 : Ye);
                      }),
                      e.o.setMediaElement(a),
                      e.o.setCmsdManager(e.va),
                      (e.l = $N(e)),
                      e.l.configure(e.g.streaming),
                      (e.m = $n),
                      e.dispatchEvent(Pt("streaming")),
                      (E = r));
                  case 2:
                    for (
                      (R = e.l.o) || E || (E = cI(e, !0)),
                        b = [],
                        A = R || E,
                        D = I([A.video, A.audio]),
                        M = D.next();
                      !M.done;
                      M = D.next()
                    )
                      (P = M.value) &&
                        !P.segmentIndex &&
                        (b.push(P.createSegmentIndex()),
                        P.dependencyStream && b.push(P.dependencyStream.createSegmentIndex()));
                    if (!(b.length > 0)) {
                      ue.A(4);
                      break;
                    }
                    return _(ue, Promise.all(b), 4);
                  case 4:
                    if (!A || A.disabledUntilTime != 0) {
                      ue.A(2);
                      break;
                    }
                    if (
                      (go(e),
                      e.I && e.I.onInitialVariantChosen && e.I.onInitialVariantChosen(A),
                      e.i.isLowLatency &&
                        (e.g.streaming.lowLatencyMode
                          ? e.configure(e.dg)
                          : He(
                              "Low-latency live stream detected, but low-latency streaming mode is not enabled in Shaka Player. Set streaming.lowLatencyMode configuration to true, and see https://bit.ly/3clctcj for details.",
                            )),
                      e.K && (aN(e.K, e.i.isLowLatency && e.g.streaming.lowLatencyMode), lN(e.K, t * 1e3)),
                      ny(e.i.presentationTimeline, e.g.playRangeStart, e.g.playRangeEnd),
                      hO(e.l, e.g.playRangeStart, e.g.playRangeEnd),
                      (e.Ua = !0),
                      e.dispatchEvent(Pt("canupdatestarttime")),
                      (G = function (xe) {
                        ((e.G = NN(e, xe)), (e.ac = FN(e, xe)), Z1(e, a, !1));
                      }),
                      e.g.streaming.startAtSegmentBoundary ||
                        ((U = e.O), U == null && e.i.startTime && (U = e.i.startTime), G(U)),
                      R)
                    ) {
                      ue.A(7);
                      break;
                    }
                    if (!e.g.streaming.startAtSegmentBoundary) {
                      ue.A(8);
                      break;
                    }
                    return (
                      (H = e.i.presentationTimeline),
                      e.O instanceof Date &&
                        ((ne = H.m || H.i), (z = e.O.getTime() / 1e3 - ne), z != null && (Q = z)),
                      Q == null && (Q = typeof e.O == "number" ? e.O : e.h.currentTime),
                      e.O == null && e.i.startTime && (Q = e.i.startTime),
                      (J = H.Zb()),
                      (X = H.Gb()),
                      Q < J ? (Q = J) : Q > X && (Q = X),
                      _(ue, KN(E, Q), 9)
                    );
                  case 9:
                    ((ie = ue.h), G(ie));
                  case 8:
                    dc(e, E, !0, !1, 0);
                  case 7:
                    return (
                      e.G.ready(),
                      (Z = e.Lc().find(function (xe) {
                        return xe.active;
                      })),
                      Z ||
                        ((re = ja(e.i.textStreams, e.Kd, e.Od, e.Nd)[0] || null) && b0(e.B.h, re, !0),
                        E &&
                          (re
                            ? (AE(E.audio, re, e.g) && (e.$ = !0), e.$ && e.u.setTextVisibility(!0))
                            : ((e.$ = !1), e.u.setTextVisibility(!1)),
                          gI(e)),
                        re && (e.g.streaming.alwaysStreamText || e.Sg()) && (Bh(e.l, re), hc(e))),
                      _(ue, e.l.start(s), 10)
                    );
                  case 10:
                    (e.g.abr.enabled && (e.o.enable(), mI(e)),
                      ci(e),
                      e.i.variants.some(function (xe) {
                        return xe.primary;
                      }),
                      (((se = e.W()) &&
                        ((e.g.streaming.liveSync && e.g.streaming.liveSync.enabled) ||
                          e.i.serviceDescription ||
                          e.g.streaming.liveSync.panicMode)) ||
                        e.g.streaming.vodDynamicPlaybackRate) &&
                        ((me = function () {
                          return uI(e);
                        }),
                        e.j.D(a, "timeupdate", me)),
                      se ||
                        ((fe = function () {
                          return gf(e);
                        }),
                        e.j.D(a, "timeupdate", fe),
                        gf(e),
                        e.i.nextUrl &&
                          (e.g.streaming.preloadNextUrlWindow > 0 &&
                            ((le = function () {
                              var xe;
                              return W(function (Se) {
                                if (Se.g == 1)
                                  return (
                                    (xe = e.Ra().end - e.h.currentTime),
                                    isNaN(xe) || !(xe <= e.g.streaming.preloadNextUrlWindow)
                                      ? Se.A(0)
                                      : (e.j.Ma(a, "timeupdate", le), _(Se, e.preload(e.i.nextUrl), 4))
                                  );
                                ((e.eb = Se.h), K(Se));
                              });
                            }),
                            e.j.D(a, "timeupdate", le)),
                          e.j.D(a, "ended", function () {
                            e.load(e.eb || e.i.nextUrl);
                          }))),
                      e.C && e.C.onManifestUpdated(se),
                      K(ue));
                }
              });
            }
            function bN(e, t) {
              var r, s, a;
              return W(function (c) {
                return c.g == 1
                  ? ((r = Date.now() / 1e3),
                    (s = !0),
                    (e.F = e.md({
                      vc: e.N,
                      onError: function (f) {
                        hl(e, f);
                      },
                      zf: function () {},
                      onExpirationUpdated: function () {
                        var f = Pt("expirationupdated");
                        e.dispatchEvent(f);
                      },
                      onEvent: function (f) {
                        (e.dispatchEvent(f),
                          f.type == "drmsessionupdate" && s && ((s = !1), (e.B.m = Date.now() / 1e3 - r)));
                      },
                    })),
                    e.F.configure(e.g.drm),
                    (a = IE([t])),
                    (e.F.O = !0),
                    _(c, BE(e.F, [a], []), 2))
                  : _(c, e.F.Vb(e.h), 0);
              });
            }
            function DN(e, t, r) {
              var s, a, c, f, g, m, x, E, A, R, b, D;
              return W(function (M) {
                switch (M.g) {
                  case 1:
                    if (
                      (dl(e, "src-equals"),
                      (s = e.h),
                      (e.G = new $A(s)),
                      (a = !1),
                      e.De.push(function () {
                        a = !0;
                      }),
                      e.dispatchEvent(Pt("canupdatestarttime")),
                      e.O != null && e.G.$f(e.O),
                      (e.ac = UN(e, e.O || 0)),
                      (e.M = new qu({
                        cf: function () {
                          return s.playbackRate;
                        },
                        Tc: function () {
                          return s.defaultPlaybackRate;
                        },
                        uh: function (P) {
                          s.playbackRate = P;
                        },
                        Di: function (P) {
                          s.currentTime += P;
                        },
                      })),
                      Z1(e, s, !0),
                      s.textTracks &&
                        (df(e),
                        (c = function (P) {
                          if (!(e.u instanceof Tn)) {
                            var G = hf(e).find(function (U) {
                              return U.mode !== "disabled";
                            });
                            (G && (G.mode = P ? "showing" : "hidden"),
                              e.u instanceof Wn &&
                                (G = GN(e)) &&
                                (G.mode = !P && e.u.isTextVisible() ? "showing" : "hidden"));
                          }
                        }),
                        e.j.D(s, "enterpictureinpicture", function () {
                          return c(!0);
                        }),
                        e.j.D(s, "leavepictureinpicture", function () {
                          return c(!1);
                        }),
                        s.remote
                          ? (e.j.D(s.remote, "connect", function () {
                              return c(!1);
                            }),
                            e.j.D(s.remote, "connecting", function () {
                              return c(!1);
                            }),
                            e.j.D(s.remote, "disconnect", function () {
                              return c(!1);
                            }))
                          : "webkitCurrentPlaybackTargetIsWireless" in s &&
                            e.j.D(s, "webkitcurrentplaybacktargetiswirelesschanged", function () {
                              return c(!1);
                            }),
                        (f = s),
                        (f.webkitPresentationMode || f.webkitSupportsFullscreen) &&
                          e.j.D(f, "webkitpresentationmodechanged", function () {
                            f.webkitPresentationMode
                              ? c(f.webkitPresentationMode !== "inline")
                              : f.webkitSupportsFullscreen && c(f.webkitDisplayingFullscreen);
                          })),
                      Q1(e, s, t),
                      (g = uN(e.K, e.X, r)),
                      !g.includes("#t=") &&
                        (e.g.playRangeStart > 0 || isFinite(e.g.playRangeEnd)) &&
                        ((g += "#t="),
                        e.g.playRangeStart > 0 && (g += e.g.playRangeStart),
                        isFinite(e.g.playRangeEnd) && (g += "," + e.g.playRangeEnd)),
                      !e.H)
                    ) {
                      M.A(2);
                      break;
                    }
                    return _(M, e.H.destroy(), 3);
                  case 3:
                    e.H = null;
                  case 2:
                    return (
                      _h(s),
                      (s.src = g),
                      (m = tt()),
                      m.Oa() == "TV" && s.load(),
                      s.preload != "none" && !s.autoplay && oh(r) && m.Ha() === "WEBKIT" && s.load(),
                      (e.m = Ui),
                      e.dispatchEvent(Pt("streaming")),
                      (x = function () {
                        return new Promise(function (P) {
                          var G = new it(P);
                          (e.j.D(s.textTracks, "change", function () {
                            return G.ka(0.5);
                          }),
                            G.ka(0.5));
                        });
                      }),
                      (E = new _t()),
                      il(s, HTMLMediaElement.HAVE_METADATA, e.j, function () {
                        return W(function (P) {
                          if (P.g == 1)
                            return (e.G.ready(), e.Fa && oh(e.Fa) ? _(P, x(), 3) : (E.resolve(), P.A(0)));
                          (E.resolve(), K(P));
                        });
                      }),
                      il(s, HTMLMediaElement.HAVE_CURRENT_DATA, e.j, function () {
                        var P, G, U, H, Q;
                        return W(function (ne) {
                          if (ne.g == 1) return _(ne, x(), 2);
                          if (a) return ne.return();
                          if (
                            (kN(e),
                            (P = hf(e)),
                            P.some(function (z) {
                              return z.mode === "showing";
                            }) && ((e.$ = !0), e.u.setTextVisibility(!0)),
                            !(e.u instanceof Tn))
                          )
                            for (
                              P.length &&
                                (e.u.enableTextDisplayer
                                  ? e.u.enableTextDisplayer()
                                  : ft(
                                      "Text displayer w/ enableTextDisplayer",
                                      'Text displayer should have a "enableTextDisplayer" method',
                                    )),
                                G = !1,
                                U = I(P),
                                H = U.next();
                              !H.done;
                              H = U.next()
                            )
                              ((Q = H.value),
                                Q.mode !== "disabled" &&
                                  (G
                                    ? ((Q.mode = "disabled"),
                                      He("Found more than one enabled text track, disabling it", Q))
                                    : (sI(e, Q), (G = !0))));
                          (MN(e), K(ne));
                        });
                      }),
                      s.error
                        ? E.reject(ty(e))
                        : s.preload == "none" &&
                          (He(
                            'With <video preload="none">, the browser will not load anything until play() is called. We are unable to measure load latency in a meaningful way, and we cannot provide track info yet. Please do not use preload="none" with Shaka Player.',
                          ),
                          E.resolve()),
                      e.j.Aa(s, "error", function () {
                        E.reject(ty(e));
                      }),
                      _(M, ah(e.g.streaming.loadTimeout, E), 4)
                    );
                  case 4:
                    ((((A = e.W()) &&
                      ((e.g.streaming.liveSync && e.g.streaming.liveSync.enabled) ||
                        e.g.streaming.liveSync.panicMode)) ||
                      e.g.streaming.vodDynamicPlaybackRate) &&
                      ((R = function () {
                        return uI(e);
                      }),
                      e.j.D(s, "timeupdate", R)),
                      A ||
                        ((b = function () {
                          return gf(e);
                        }),
                        e.j.D(s, "timeupdate", b),
                        gf(e)),
                      e.C &&
                        (e.C.onManifestUpdated(A),
                        A &&
                          ((D = e.Ra().end),
                          e.j.D(s, "progress", function () {
                            var P = e.Ra().end;
                            D != P && (e.C.onManifestUpdated(e.W()), (D = P));
                          }))),
                      (e.Ua = !0),
                      K(M));
                }
              });
            }
            function kN(e) {
              var t = e.g.preferredAudioLanguage;
              t != "" && e.Ti(t, e.g.preferredAudioRole);
            }
            function MN(e) {
              var t = e.g.preferredTextLanguage;
              t != "" && e.oh(t, e.g.preferredTextRole, e.g.preferForcedSubs);
            }
            function PN(e, t) {
              if (t.kind == "metadata") {
                ((t.mode = "hidden"),
                  e.j.D(t, "cuechange", function () {
                    if (t.activeCues)
                      for (var s = I(t.activeCues), a = s.next(); !a.done; a = s.next())
                        ((a = a.value),
                          Q0(e, a.startTime, a.endTime, a.type, a.value),
                          e.C && e.C.onCueMetadataChange(a.value));
                    if (t.cues) {
                      ((s = []), (a = I(t.cues)));
                      for (var c = a.next(), f = {}; !c.done; f = { Ec: void 0 }, c = a.next())
                        ((f.Ec = c.value),
                          f.Ec.type == "com.apple.quicktime.HLS" &&
                            f.Ec.startTime != null &&
                            ((c = s.find(
                              (function (g) {
                                return function (m) {
                                  return m.startTime == g.Ec.startTime && m.endTime == g.Ec.endTime;
                                };
                              })(f),
                            )),
                            c ||
                              ((c = { startTime: f.Ec.startTime, endTime: f.Ec.endTime, values: [] }),
                              s.push(c)),
                            c.values.push(f.Ec.value)));
                      for (s = I(s), a = s.next(); !a.done; a = s.next())
                        ((a = a.value),
                          a.values.some(function (g) {
                            return g.key == "X-ASSET-URI" || g.key == "X-ASSET-LIST";
                          }) &&
                            e.C &&
                            (a.values.push({
                              key: "CUE",
                              description: "",
                              data: a.startTime != 0 || e.W() ? "ONCE" : "ONCE,PRE",
                              mimeType: null,
                              pictureType: null,
                            }),
                            e.C.onHLSInterstitialMetadata(e, e.h, a)));
                    }
                  }));
                var r = new it(function () {
                  var s = jN(e);
                  s = I(s);
                  for (var a = s.next(); !a.done; a = s.next()) a.value.mode = "hidden";
                })
                  .Jb()
                  .ka(0.5);
                e.De.push(function () {
                  r.stop();
                });
              }
            }
            function q0(e, t, r) {
              ((t = new Map()
                .set("startTime", t.startTime)
                .set("endTime", t.endTime)
                .set("metadataType", t.schemeIdUri)
                .set("payload", t.payload)),
                e.dispatchEvent(Pt(r, t)));
            }
            function Q0(e, t, r, s, a) {
              e.za &&
                ((t = { schemeIdUri: s, startTime: t, endTime: r || 1 / 0, id: "", payload: a }),
                (t.id = JSON.stringify(t)),
                f0(e.za, t));
            }
            function ON(e, t) {
              if (t && t.kind == "chapters") {
                t.mode = "hidden";
                var r = new it(function () {
                  t.mode = "hidden";
                })
                  .Jb()
                  .ka(0.5);
                e.De.push(function () {
                  r.stop();
                });
              }
            }
            ((d.Ok = function () {
              for (var e = this.ba; e.g; ) e.release();
            }),
              (d.md = function (e) {
                return new Eh(e);
              }));
            function J1(e, t) {
              function r(c) {
                t() ? t().dispatchEvent(c) : e.dispatchEvent(c);
              }
              function s(c) {
                t() ? sc(t(), !0, c) : c();
              }
              t ||
                (t = function () {
                  return null;
                });
              var a = new Vt(
                function (c, f, g, m, x) {
                  s(function () {
                    e.o && e.o.segmentDownloaded(c, f, g, m, x);
                  });
                },
                function (c, f, g) {
                  ((f = new Map().set("headers", c).set("request", f).set("requestType", g)),
                    r(Pt("downloadheadersreceived", f)),
                    s(function () {
                      if (e.va) {
                        var m = e.va;
                        if (m.h.enabled) {
                          var x = c["cmsd-static"];
                          if (x)
                            try {
                              var E = new Map(),
                                A = x.split(",");
                              for (x = 0; x < A.length; x++) {
                                var R = A[x].split("=");
                                E.set(R[0], B1(R[1]));
                              }
                            } catch (G) {}
                          if ((E = c["cmsd-dynamic"])) {
                            e: {
                              try {
                                var b = new Map(),
                                  D = E.split(";");
                                for (E = 1; E < D.length; E++) {
                                  var M = D[E].split("=");
                                  b.set(M[0], B1(M[1]));
                                }
                                var P = b;
                                break e;
                              } catch (G) {
                                P = null;
                                break e;
                              }
                              P = void 0;
                            }
                            P && (m.g = P);
                          }
                        }
                      }
                    }));
                },
                function (c, f) {
                  ((c = new Map().set("request", c).set("response", f)), r(Pt("downloadcompleted", c)));
                },
                function (c, f, g, m) {
                  ((c = new Map()
                    .set("request", c)
                    .set("error", f)
                    .set("httpResponseCode", g)
                    .set("aborted", m)),
                    r(Pt("downloadfailed", c)));
                },
                function (c, f, g) {
                  s(function () {
                    if (e.K) {
                      var m = e.K,
                        x = g;
                      if (((x = x === void 0 ? {} : x), m.g.enabled))
                        if (f.method === "HEAD") cl(m, f, {});
                        else
                          switch (c) {
                            case 0:
                              try {
                                if (m.g.enabled) {
                                  if (x.type) {
                                    e: {
                                      switch (x.type) {
                                        case 4:
                                          var E = m.u ? af : of;
                                          break e;
                                        case 3:
                                        case 2:
                                          E = m.u ? uf : lf;
                                          break e;
                                        case 5:
                                          E = "s";
                                          break e;
                                      }
                                      E = void 0;
                                    }
                                    m.l = E;
                                  }
                                  cl(m, f, { ot: M1, su: !m.F });
                                }
                              } catch (R) {
                                Cn("CMCD_MANIFEST_ERROR", "Could not generate manifest CMCD data.", R);
                              }
                              break;
                            case or:
                              try {
                                if (m.g.enabled) {
                                  var A = D1(m, x, f.uris[0]);
                                  ((A.ts = Date.now()),
                                    m.m.has(f) && m.m.delete(f),
                                    m.m.set(f, A.ts),
                                    cl(m, f, A));
                                }
                              } catch (R) {
                                Cn("CMCD_SEGMENT_ERROR", "Could not generate segment CMCD data.", R);
                              }
                              break;
                            case 2:
                            case 5:
                            case 6:
                              cl(m, f, { ot: "k" });
                              break;
                            case 4:
                              cl(m, f, { ot: "o" });
                          }
                    }
                  });
                },
                function (c, f, g, m) {
                  (c = t() ? t().m : e.I) && c.banLocation && c.banLocation(m);
                },
                function (c, f, g) {
                  if (f.data) {
                    var m = f.data.byteLength,
                      x = t() ? t().getStats() : e.B;
                    if (
                      (x && (f1(x, m), c === 0 && (x.wi = m)),
                      (m = e.K),
                      (g = g === void 0 ? {} : g),
                      B0(m).length !== 0)
                    )
                      switch (c) {
                        case or:
                          try {
                            var E = D1(m, g, f.uri);
                            (f.originalRequest &&
                              f.originalRequest.timeToFirstByte != null &&
                              (E.ttfb = f.originalRequest.timeToFirstByte),
                              f.timeMs != null && (E.ttlb = f.timeMs));
                            var A = f.originalUri || f.uri;
                            if (A.includes("CMCD="))
                              try {
                                var R = new URL(A);
                                R.searchParams.delete("CMCD");
                                var b = R.toString();
                              } catch (J) {
                                b = A;
                              }
                            else b = A;
                            ((E.url = b),
                              m.m.has(f.originalRequest)
                                ? ((E.ts = m.m.get(f.originalRequest)), m.m.delete(f.originalRequest))
                                : E.ts || (E.ts = Date.now()));
                            var D = B0(m);
                            if (D.length !== 0) {
                              var M = m.g.version == K0 ? Array.from(new Set([].concat(V(W0), V(TN)))) : P1;
                              E.rc = f.status || 0;
                              var P = V0(m, E, F1);
                              (f.headers &&
                                f.headers["CMSD-Static"] &&
                                (P.cmsds = btoa(f.headers["CMSD-Static"])),
                                f.headers &&
                                  f.headers["CMSD-Dynamic"] &&
                                  (P.cmsdd = btoa(f.headers["CMSD-Dynamic"])));
                              for (var G = I(D), U = G.next(); !U.done; U = G.next()) {
                                var H = U.value,
                                  Q = G0(H.includeKeys || [], M),
                                  ne = _1(H);
                                (m.o[ne] || (m.o[ne] = { request: 1, response: 1 }),
                                  (P.sn = m.o[ne].response++));
                                var z = j0(P, Q);
                                L1(m, z, H, f);
                              }
                            }
                          } catch (J) {
                            Cn("CMCD_SEGMENT_ERROR", "Could not generate response segment CMCD data.", J);
                          }
                      }
                  }
                },
              );
              return (a.configure(e.g.networking), a);
            }
            function NN(e, t) {
              return new VA(
                e.h,
                e.i,
                e.g.streaming,
                t,
                function () {
                  (e.ac && YA(e.ac, !e.G.Mh()), e.l && e.l.bd(), e.R && Zr(e, "seeking"));
                },
                function (r) {
                  return e.dispatchEvent(r);
                },
              );
            }
            function FN(e, t) {
              var r = e.W() || (typeof t == "number" && t > 0);
              ((t = new oa(e.Ae, r)),
                t.addEventListener("enter", function (c) {
                  fc(e, "timelineregionenter", c.region);
                }),
                t.addEventListener("exit", function (c) {
                  fc(e, "timelineregionexit", c.region);
                }),
                t.addEventListener("skip", function (c) {
                  var f = c.region;
                  c.seeking || (fc(e, "timelineregionenter", f), fc(e, "timelineregionexit", f));
                }));
              var s = new oa(e.za, r);
              (s.addEventListener("enter", function (c) {
                q0(e, c.region, "metadata");
              }),
                (r = new oa(e.kb, r)),
                r.addEventListener("enter", function (c) {
                  ((c = new Map().set("detail", c.region.emsg)), e.dispatchEvent(Pt("emsg", c)));
                }));
              var a = new h0(e.h);
              return (a.g.add(t), a.g.add(s), a.g.add(r), e.ye && a.g.add(e.ye), a);
            }
            function UN(e, t) {
              ((t = new oa(e.za, t instanceof Date || t > 0)),
                t.addEventListener("enter", function (s) {
                  q0(e, s.region, "metadata");
                }));
              var r = new h0(e.h);
              return (r.g.add(t), r);
            }
            function Z1(e, t, r) {
              ((e.R = new l2()),
                jm(e.R, Zo),
                eI(e),
                cc(e),
                (e.Ta = new it(function () {
                  Zr(e);
                })),
                e.g.streaming.rebufferingGoal && e.Ta.Ea(0.25),
                e.j.D(t, "waiting", function () {
                  return Zr(e, "waiting");
                }),
                e.j.D(t, "canplaythrough", function () {
                  return Zr(e, "canplaythrough");
                }),
                e.j.D(t, "playing", function () {
                  return Zr(e, "playing");
                }),
                e.j.D(t, "seeked", function () {
                  return Zr(e, "seeked");
                }),
                e.j.D(t, "timeupdate", function () {
                  return Zr(e, "timeupdate");
                }),
                r &&
                  (e.j.D(t, "progress", function () {
                    return Zr(e, "progress");
                  }),
                  e.j.D(t, "stalled", function () {
                    return Zr(e, "stalled");
                  })));
            }
            function eI(e) {
              var t = e.g.streaming.rebufferingGoal;
              e.R.j.set(ea, Math.min(0.5, t / 2)).set(Zo, t);
            }
            function Zr(e, t) {
              if (e.g.streaming.rebufferingGoal) {
                ((t = e.H ? ra(e.H) : !1), (t = e.ge() || t || e.G.ri()));
                var r = pA(e.h.buffered, e.h.currentTime),
                  s = e.R,
                  a = s.j.get(s.g);
                jm(s, t || (r >= a && r > 0) ? ea : Zo) && cc(e);
              } else if (t) {
                ((r = e.R), (s = e.h.currentTime), (a = r.h), (r.h = s));
                var c = void 0;
                switch (t) {
                  case "seeking":
                  case "waiting":
                    ((r.h = -1), (c = Zo));
                    break;
                  case "canplaythrough":
                  case "playing":
                  case "seeked":
                    c = ea;
                    break;
                  case "timeupdate":
                    a >= 0 && s - a > 0.01 && (c = ea);
                }
                c !== void 0 && jm(r, c) && cc(e);
              }
            }
            function BN(e, t, r, s, a) {
              return new SA(e, t, r, a, s);
            }
            function $N(e) {
              return new e1(e.i, {
                nc: function () {
                  return e.G ? e.G.Qd() : 0;
                },
                getBandwidthEstimate: function () {
                  return e.o.getBandwidthEstimate();
                },
                Ob: function () {
                  return e.Ob();
                },
                video: e.h,
                Z: e.H,
                vc: e.N,
                onError: function (t) {
                  return hl(e, t);
                },
                onEvent: function (t) {
                  return e.dispatchEvent(t);
                },
                zd: function (t, r, s, a) {
                  var c = t.startTime,
                    f = t.endTime,
                    g = r.type;
                  if (g != nt) {
                    if (e.G) {
                      e.G.Fi();
                      var m = i0(e.H, g);
                      !e.W() &&
                        e.h.paused &&
                        !e.h.seeking &&
                        m != null &&
                        m > 0 &&
                        e.G.Qd() < m &&
                        !K1(e.G.Qd(), m, 0.001) &&
                        e.G.$f(m);
                    }
                    Zr(e);
                  }
                  ((s = new Map()
                    .set("start", c)
                    .set("end", f)
                    .set("contentType", g)
                    .set("isMuxed", s)
                    .set("isDependency", a)),
                    e.dispatchEvent(Pt("segmentappended", s)),
                    e.o && r.fastSwitching && t.Xc && t.je && e.o.trySuggestStreams());
                },
                Fk: function (t, r) {
                  (r = r.xd) && e.ye && nO(e.ye, r, t);
                },
                Uh: function (t, r) {
                  var s = e.F;
                  if (s.h.parseInbandPsshEnabled && !s.H && ["audio", "video"].includes(t)) {
                    ((t = new Um(We(r))), (r = 0));
                    for (var a = I(t.data), c = a.next(); !c.done; c = a.next()) r += c.value.length;
                    if (r == 0) s = Promise.resolve();
                    else {
                      for (r = new Uint8Array(r), a = 0, t = I(t.data), c = t.next(); !c.done; c = t.next())
                        ((c = c.value), r.set(c, a), (a += c.length));
                      (Bu(s, "cenc", r), (s = s.m));
                    }
                  } else s = Promise.resolve();
                  return s;
                },
                disableStream: function (t, r) {
                  return e.disableStream(t, r);
                },
                hl: function (t, r) {
                  return !(e.g.abr.enabled && r.fastSwitching && t.Xc && t.je);
                },
              });
            }
            ((d.configure = function (e, t) {
              var r = this.getConfiguration();
              if (
                (arguments.length == 2 && typeof e == "string" && (e = zh(e, t)),
                "preferredVariantRole" in e &&
                  (ft("preferredVariantRole configuration", "Please Use preferredAudioRole instead."),
                  (e.preferredAudioRole = e.preferredVariantRole),
                  delete e.preferredVariantRole),
                e.streaming &&
                  "forceTransmuxTS" in e.streaming &&
                  (ft(
                    "streaming.forceTransmuxTS configuration",
                    "Please Use mediaSource.forceTransmux instead.",
                  ),
                  (e.mediaSource = e.mediaSource || {}),
                  (e.mediaSource.mediaSource = e.streaming.forceTransmuxTS),
                  delete e.streaming.forceTransmuxTS),
                e.streaming &&
                  "forceTransmux" in e.streaming &&
                  (ft(
                    "streaming.forceTransmux configuration",
                    "Please Use mediaSource.forceTransmux instead.",
                  ),
                  (e.mediaSource = e.mediaSource || {}),
                  (e.mediaSource.mediaSource = e.streaming.forceTransmux),
                  delete e.streaming.forceTransmux),
                e.streaming && "useNativeHlsOnSafari" in e.streaming)
              ) {
                ft(
                  "streaming.useNativeHlsOnSafari configuration",
                  "Please Use streaming.useNativeHlsForFairPlay or streaming.preferNativeHls instead.",
                );
                var s = tt();
                ((e.streaming.preferNativeHls = e.streaming.useNativeHlsOnSafari && s.Ha() === "WEBKIT"),
                  delete e.streaming.useNativeHlsOnSafari);
              }
              if (
                (e.streaming &&
                  typeof e.streaming.liveSync == "boolean" &&
                  (ft("streaming.liveSync", "Please Use streaming.liveSync.enabled instead."),
                  (s = e.streaming.liveSync),
                  (e.streaming.liveSync = {}),
                  (e.streaming.liveSync.enabled = s)),
                e.streaming &&
                  !(e.streaming.liveSync && "targetLatency" in e.streaming.liveSync) &&
                  ("liveSyncMinLatency" in e.streaming || "liveSyncMaxLatency" in e.streaming))
              ) {
                s = e.streaming.liveSyncMinLatency || 0;
                var a = Math.abs((e.streaming.liveSyncMaxLatency || 1) - s) / 2;
                ((e.streaming.liveSync = e.streaming.liveSync || {}),
                  (e.streaming.liveSync.targetLatency = s + a),
                  (e.streaming.liveSync.targetLatencyTolerance = a));
              }
              if (
                (e.streaming &&
                  "liveSyncMaxLatency" in e.streaming &&
                  (ft(
                    "streaming.liveSyncMaxLatency",
                    "Please Use streaming.liveSync.targetLatency and streaming.liveSync.targetLatencyTolerance instead. Or, set the values in your DASH manifest",
                  ),
                  delete e.streaming.liveSyncMaxLatency),
                e.streaming &&
                  "liveSyncMinLatency" in e.streaming &&
                  (ft(
                    "streaming.liveSyncMinLatency",
                    "Please Use streaming.liveSync.targetLatency and streaming.liveSync.targetLatencyTolerance instead. Or, set the values in your DASH manifest",
                  ),
                  delete e.streaming.liveSyncMinLatency),
                e.streaming &&
                  "liveSyncTargetLatency" in e.streaming &&
                  (ft(
                    "streaming.liveSyncTargetLatency",
                    "Please Use streaming.liveSync.targetLatency instead.",
                  ),
                  (e.streaming.liveSync = e.streaming.liveSync || {}),
                  (e.streaming.liveSync.targetLatency = e.streaming.liveSyncTargetLatency),
                  delete e.streaming.liveSyncTargetLatency),
                e.streaming &&
                  "liveSyncTargetLatencyTolerance" in e.streaming &&
                  (ft(
                    "streaming.liveSyncTargetLatencyTolerance",
                    "Please Use streaming.liveSync.targetLatencyTolerance instead.",
                  ),
                  (e.streaming.liveSync = e.streaming.liveSync || {}),
                  (e.streaming.liveSync.targetLatencyTolerance = e.streaming.liveSyncTargetLatencyTolerance),
                  delete e.streaming.liveSyncTargetLatencyTolerance),
                e.streaming &&
                  "liveSyncPlaybackRate" in e.streaming &&
                  (ft(
                    "streaming.liveSyncPlaybackRate",
                    "Please Use streaming.liveSync.maxPlaybackRate instead.",
                  ),
                  (e.streaming.liveSync = e.streaming.liveSync || {}),
                  (e.streaming.liveSync.maxPlaybackRate = e.streaming.liveSyncPlaybackRate),
                  delete e.streaming.liveSyncPlaybackRate),
                e.streaming &&
                  "liveSyncMinPlaybackRate" in e.streaming &&
                  (ft(
                    "streaming.liveSyncMinPlaybackRate",
                    "Please Use streaming.liveSync.minPlaybackRate instead.",
                  ),
                  (e.streaming.liveSync = e.streaming.liveSync || {}),
                  (e.streaming.liveSync.minPlaybackRate = e.streaming.liveSyncMinPlaybackRate),
                  delete e.streaming.liveSyncMinPlaybackRate),
                e.streaming &&
                  "liveSyncPanicMode" in e.streaming &&
                  (ft("streaming.liveSyncPanicMode", "Please Use streaming.liveSync.panicMode instead."),
                  (e.streaming.liveSync = e.streaming.liveSync || {}),
                  (e.streaming.liveSync.panicMode = e.streaming.liveSyncPanicMode),
                  delete e.streaming.liveSyncPanicMode),
                e.streaming &&
                  "liveSyncPanicThreshold" in e.streaming &&
                  (ft(
                    "streaming.liveSyncPanicThreshold",
                    "Please Use streaming.liveSync.panicThreshold instead.",
                  ),
                  (e.streaming.liveSync = e.streaming.liveSync || {}),
                  (e.streaming.liveSync.panicThreshold = e.streaming.liveSyncPanicThreshold),
                  delete e.streaming.liveSyncPanicThreshold),
                e.mediaSource && "sourceBufferExtraFeatures" in e.mediaSource)
              ) {
                ft(
                  "mediaSource.sourceBufferExtraFeatures configuration",
                  "Please Use mediaSource.addExtraFeaturesToSourceBuffer() instead.",
                );
                var c = e.mediaSource.sourceBufferExtraFeatures;
                ((e.mediaSource.addExtraFeaturesToSourceBuffer = function () {
                  return c;
                }),
                  delete e.mediaSource.sourceBufferExtraFeatures);
              }
              if (
                (e.manifest &&
                  e.manifest.hls &&
                  "useSafariBehaviorForLive" in e.manifest.hls &&
                  (ft(
                    "manifest.hls.useSafariBehaviorForLive configuration",
                    "Please Use liveSync config to keep on live Edge instead.",
                  ),
                  delete e.manifest.hls.useSafariBehaviorForLive),
                e.streaming &&
                  "parsePrftBox" in e.streaming &&
                  (ft("streaming.parsePrftBox configuration", "Now fired without needing a configuration."),
                  delete e.streaming.parsePrftBox),
                e.manifest &&
                  e.manifest.dash &&
                  "enableAudioGroups" in e.manifest.dash &&
                  (ft(
                    "manifest.dash.enableAudioGroups configuration",
                    "Please Use manifest.enableAudioGroups instead.",
                  ),
                  (e.manifest.enableAudioGroups = e.manifest.dash.enableAudioGroups),
                  delete e.manifest.dash.enableAudioGroups),
                e.streaming &&
                  "dispatchAllEmsgBoxes" in e.streaming &&
                  (ft(
                    "streaming.dispatchAllEmsgBoxes configuration",
                    "Please Use mediaSource.dispatchAllEmsgBoxes instead.",
                  ),
                  (e.mediaSource = e.mediaSource || {}),
                  (e.mediaSource.dispatchAllEmsgBoxes = e.streaming.dispatchAllEmsgBoxes),
                  delete e.streaming.dispatchAllEmsgBoxes),
                e.streaming &&
                  "autoLowLatencyMode" in e.streaming &&
                  (ft(
                    "streaming.autoLowLatencyMode configuration",
                    "Please Use streaming.lowLatencyMode instead.",
                  ),
                  (e.streaming.lowLatencyMode = e.streaming.autoLowLatencyMode),
                  delete e.streaming.autoLowLatencyMode),
                e.manifest &&
                  e.manifest.dash &&
                  "ignoreSupplementalCodecs" in e.manifest.dash &&
                  (ft(
                    "manifest.dash.ignoreSupplementalCodecs configuration",
                    "Please Use manifest.ignoreSupplementalCodecs instead.",
                  ),
                  (e.manifest.ignoreSupplementalCodecs = e.manifest.dash.ignoreSupplementalCodecs),
                  delete e.manifest.dash.ignoreSupplementalCodecs),
                e.manifest &&
                  e.manifest.hls &&
                  "ignoreSupplementalCodecs" in e.manifest.hls &&
                  (ft(
                    "manifest.hls.ignoreSupplementalCodecs configuration",
                    "Please Use manifest.ignoreSupplementalCodecs instead.",
                  ),
                  (e.manifest.ignoreSupplementalCodecs = e.manifest.hls.ignoreSupplementalCodecs),
                  delete e.manifest.hls.ignoreSupplementalCodecs),
                e.manifest &&
                  e.manifest.dash &&
                  "updatePeriod" in e.manifest.dash &&
                  (ft(
                    "manifest.dash.updatePeriod configuration",
                    "Please Use manifest.updatePeriod instead.",
                  ),
                  (e.manifest.updatePeriod = e.manifest.dash.updatePeriod),
                  delete e.manifest.dash.updatePeriod),
                e.manifest &&
                  e.manifest.hls &&
                  "updatePeriod" in e.manifest.hls &&
                  (ft("manifest.hls.updatePeriod configuration", "Please Use manifest.updatePeriod instead."),
                  (e.manifest.updatePeriod = e.manifest.hls.updatePeriod),
                  delete e.manifest.hls.updatePeriod),
                e.manifest &&
                  e.manifest.dash &&
                  "ignoreDrmInfo" in e.manifest.dash &&
                  (ft(
                    "manifest.dash.ignoreDrmInfo configuration",
                    "Please Use manifest.ignoreDrmInfo instead.",
                  ),
                  (e.manifest.ignoreDrmInfo = e.manifest.dash.ignoreDrmInfo),
                  delete e.manifest.dash.ignoreDrmInfo),
                e.drm && e.drm.advanced)
              ) {
                s = !1;
                for (var f in e.drm.advanced) {
                  var g = e.drm.advanced[f];
                  ((a = g.videoRobustness),
                    (g = g.audioRobustness),
                    "videoRobustness" in e.drm.advanced[f] &&
                      !Array.isArray(e.drm.advanced[f].videoRobustness) &&
                      ((e.drm.advanced[f].videoRobustness = [a]), (s = !0)),
                    "audioRobustness" in e.drm.advanced[f] &&
                      !Array.isArray(e.drm.advanced[f].audioRobustness) &&
                      ((e.drm.advanced[f].audioRobustness = [g]), (s = !0)));
                }
                s &&
                  ft(
                    "AdvancedDrmConfiguration's videoRobustness and audioRobustness",
                    "These properties are no longer strings but array of strings, please update your usage of these properties.",
                  );
              }
              return (
                e.streaming &&
                  "forceHTTP" in e.streaming &&
                  (ft("streaming.forceHTTP configuration", "Please Use networking.forceHTTP instead."),
                  (e.networking = e.networking || {}),
                  (e.networking.forceHTTP = e.streaming.forceHTTP),
                  delete e.streaming.forceHTTP),
                e.streaming &&
                  "forceHTTPS" in e.streaming &&
                  (ft("streaming.forceHTTPS configuration", "Please Use networking.forceHTTP instead."),
                  (e.networking = e.networking || {}),
                  (e.networking.forceHTTPS = e.streaming.forceHTTPS),
                  delete e.streaming.forceHTTPS),
                e.streaming &&
                  "minBytesForProgressEvents" in e.streaming &&
                  (ft(
                    "streaming.minBytesForProgressEvents configuration",
                    "Please Use networking.minBytesForProgressEvents instead.",
                  ),
                  (e.networking = e.networking || {}),
                  (e.networking.minBytesForProgressEvents = e.streaming.minBytesForProgressEvents),
                  delete e.streaming.minBytesForProgressEvents),
                (f = bs(this.g, e, jr(this))),
                tI(this, r),
                f
              );
            }),
              (d.yj = function (e) {
                this.dg = e;
              }));
            function tI(e, t) {
              if (((e.Ee = new Vm(e.g, e.ya, e.F)), e.I)) {
                var r = Ar(e.g.manifest);
                (e.h && e.h.nodeName === "AUDIO" && (r.disableVideo = !0), e.I.configure(r));
              }
              if ((e.F && e.F.configure(e.g.drm), e.l)) {
                e.l.configure(e.g.streaming);
                try {
                  e.m != Rr && ZE(e.Ee, e.i) && ci(e);
                } catch (a) {
                  hl(e, a);
                }
                (e.o && go(e), (r = e.l.o), !r || (r.allowedByApplication && r.allowedByKeySystem) || mo(e));
              }
              if (
                (e.N && e.N.configure(e.g.networking),
                e.H && (e.H.configure(e.g.mediaSource), (e.H.Fa = e.g.manifest.segmentRelativeVttTiming)),
                e.u && df(e),
                e.o && (e.o.configure(e.g.abr), e.g.abr.enabled ? e.o.enable() : e.o.disable(), mI(e)),
                e.R && eI(e),
                e.Ta && (e.g.streaming.rebufferingGoal ? e.Ta.Ea(0.25) : e.Ta.stop()),
                e.i && ny(e.i.presentationTimeline, e.g.playRangeStart, e.g.playRangeEnd),
                e.C && e.C.configure(e.g.ads),
                e.K && e.K.configure(e.g.cmcd),
                e.va && e.va.configure(e.g.cmsd),
                e.Da && e.Da.configure(e.g.queue),
                e.m == $n && e.J.getConfiguration)
              ) {
                r = e.J.getConfiguration();
                var s = !1;
                (t.preferredVideoHdrLevel != e.g.preferredVideoHdrLevel &&
                  r.hdrLevel != e.g.preferredVideoHdrLevel &&
                  ((r.hdrLevel = e.g.preferredVideoHdrLevel), (s = !0)),
                  t.preferredVideoLayout != e.g.preferredVideoLayout &&
                    r.videoLayout != e.g.preferredVideoLayout &&
                    ((r.videoLayout = e.g.preferredVideoLayout), (s = !0)),
                  t.preferSpatialAudio != e.g.preferSpatialAudio &&
                    r.spatialAudio != e.g.preferSpatialAudio &&
                    ((r.spatialAudio = e.g.preferSpatialAudio), (s = !0)),
                  t.preferredVideoRole != e.g.preferredVideoRole &&
                    r.videoRole != e.g.preferredVideoRole &&
                    ((r.videoRole = e.g.preferredVideoRole), (s = !0)),
                  s && (e.J.configure(r), mo(e)));
              }
            }
            ((d.getConfiguration = function () {
              var e = jr(this);
              return (bs(e, this.g, jr(this)), e);
            }),
              (d.Ij = function () {
                return this.dg;
              }),
              (d.ki = function () {
                var e = jr(this);
                return (bs(e, this.g, jr(this)), l1(this.g, jr(this)));
              }),
              (d.ei = function () {
                if (this.h) {
                  var e = this.h.buffered.length;
                  e = e ? this.h.buffered.end(e - 1) : 0;
                  var t = this.getConfiguration().streaming.bufferingGoal;
                  if (((t = Math.min(this.h.currentTime + t, this.Ra().end)), e >= t)) return 1;
                  if (!(e <= this.h.currentTime) && e < t)
                    return (e - this.h.currentTime) / (t - this.h.currentTime);
                }
                return 0;
              }),
              (d.Oi = function () {
                var e = this.getConfiguration(),
                  t;
                for (t in this.g) delete this.g[t];
                (bs(this.g, jr(this), jr(this)), tI(this, e));
              }),
              (d.$d = function () {
                return this.m;
              }),
              (d.ii = function () {
                return this.i ? this.i.type : null;
              }),
              (d.bf = function () {
                return this.h;
              }),
              (d.Yb = function () {
                return this.N;
              }),
              (d.rd = function () {
                return this.X;
              }),
              (d.di = function () {
                return this.C ? this.C : null;
              }),
              (d.mi = function () {
                return this.Da ? this.Da : null;
              }),
              (d.W = function () {
                return this.i && !this.xa()
                  ? this.i.presentationTimeline.W()
                  : this.h && (this.h.src || this.xa())
                    ? this.h.duration == 1 / 0
                    : !1;
              }),
              (d.Vc = function () {
                return this.i ? this.i.presentationTimeline.Vc() : !1;
              }),
              (d.lk = function () {
                if (this.i && !this.xa()) {
                  var e = this.i.variants;
                  return e.length ? !e[0].video : !1;
                }
                return this.h && (this.h.src || this.xa())
                  ? this.h.videoTracks
                    ? this.h.videoTracks.length == 0
                    : this.h.videoHeight == 0
                  : !1;
              }),
              (d.ti = function () {
                if (this.i && !this.xa()) {
                  var e = this.i.variants;
                  return e.length
                    ? ((e = e[0]), e.audio || !e.video ? !1 : !e.video.codecs.includes(","))
                    : !1;
                }
                return this.h && (this.h.src || this.xa()) && this.h.audioTracks
                  ? this.h.audioTracks.length == 0
                  : !1;
              }),
              (d.Ra = function () {
                if (this.i && !this.xa()) {
                  if (!this.Ua && this.i.type == "HLS") return { start: 0, end: 0 };
                  var e = this.i.presentationTimeline;
                  return { start: e.Zb(), end: e.Gb() };
                }
                if (this.h && (this.h.src || this.xa()) && (e = this.h.seekable) && e.length) {
                  var t = this.g ? this.g.playRangeStart : 0;
                  t = Math.max(e.start(0), t);
                  var r = this.g ? this.g.playRangeEnd : 1 / 0;
                  return ((e = Math.min(e.end(e.length - 1), r)), { start: t, end: e });
                }
                return { start: 0, end: 0 };
              }),
              (d.ik = function () {
                this.W() && (this.h.currentTime = this.Ra().end);
              }),
              (d.nk = function () {
                return this.Ua;
              }),
              (d.keySystem = function () {
                var e = this.drmInfo();
                return e ? e.keySystem : "";
              }),
              (d.drmInfo = function () {
                return this.F ? this.F.g : null;
              }),
              (d.Zd = function () {
                return this.F ? this.F.Zd() : 1 / 0;
              }),
              (d.Kg = function () {
                return this.F ? this.F.Kg() : [];
              }),
              (d.$e = function () {
                return this.F ? this.F.$e() : {};
              }),
              (d.Rg = function () {
                return this.R ? this.R.g == Zo : !!this.X;
              }),
              (d.Ob = function () {
                return this.h ? (this.M ? this.M.i : 1) : 0;
              }),
              (d.Kh = function (e) {
                this.m == $n && this.l && t1(this.l, e);
              }),
              (d.xe = function (e, t) {
                ((t = t === void 0 ? !0 : t),
                  e == 0
                    ? He("A trick play rate of 0 is unsupported!")
                    : (this.M.set(e),
                      this.m == $n && (this.o.playbackRateChanged(e), this.Kh(t && e != 1)),
                      lI(this, e)));
              }),
              (d.Sd = function () {
                var e = this.M.Tc();
                (this.m == Ui && this.M.set(e),
                  this.m == $n && (this.M.set(e), this.o.playbackRateChanged(e), this.Kh(!1)),
                  this.dc.Qa());
              }),
              (d.qc = function () {
                if (this.i && !this.xa()) {
                  for (
                    var e = this.l ? this.l.o : null, t = [], r = 0, s = I(this.i.variants), a = s.next();
                    !a.done;
                    a = s.next()
                  )
                    if (((a = a.value), Uu(a))) {
                      var c = qo(a);
                      ((c.active = a == e),
                        c.active ||
                          r == 1 ||
                          e == null ||
                          a.video != e.video ||
                          a.audio != e.audio ||
                          (c.active = !0),
                        c.active && r++,
                        t.push(c));
                    }
                  return t;
                }
                if (this.h && this.h.audioTracks) {
                  var f = dI(this);
                  return (
                    (e = Array.from(this.h.audioTracks)),
                    e.length
                      ? e.map(function (g) {
                          return hh(g, f);
                        })
                      : f
                        ? [hh(null, f)]
                        : []
                  );
                }
                return [];
              }),
              (d.Lc = function () {
                if (this.i) {
                  if (this.xa()) return [];
                  for (
                    var e = this.l ? this.l.B : null, t = [], r = I(this.i.textStreams), s = r.next();
                    !s.done;
                    s = r.next()
                  ) {
                    s = s.value;
                    var a = Qo(s);
                    ((a.active = s == e), t.push(a));
                  }
                  return t;
                }
                return this.h && this.h.src && this.h.textTracks
                  ? hf(this).map(function (c) {
                      return xE(c);
                    })
                  : [];
              }),
              (d.Nj = function () {
                var e = this.Ke;
                return (
                  this.i && (e = this.i.imageStreams),
                  e.map(function (t) {
                    return Mm(t);
                  })
                );
              }),
              (d.Bj = function (e) {
                var t = this,
                  r,
                  s;
                return W(function (a) {
                  return a.g == 1
                    ? _(a, iI(t, e), 2)
                    : ((r = a.h),
                      r
                        ? ((s = []),
                          r.segmentIndex.Fb(function (c) {
                            var f = nI(c.tilesLayout || r.tilesLayout);
                            if (f)
                              for (var g = f.rows * f.columns, m = c.j - c.startTime, x = 0; x < g; x++) {
                                var E = rI(c, r, c.startTime + (m * x) / g, f);
                                s.push(E);
                              }
                          }),
                          r.closeSegmentIndex && r.closeSegmentIndex(),
                          a.return(s))
                        : a.return(null));
                });
              }));
            function nI(e) {
              return e && (e = /(\d+)x(\d+)/.exec(e))
                ? { columns: parseInt(e[1], 10), rows: parseInt(e[2], 10) }
                : null;
            }
            d.ck = function (e, t) {
              var r = this,
                s,
                a,
                c,
                f,
                g,
                m;
              return W(function (x) {
                return x.g == 1
                  ? _(x, iI(r, e), 2)
                  : ((s = x.h),
                    !s ||
                    (s.closeSegmentIndex &&
                      (r.yc.has(s) ||
                        ((a = new it(function () {
                          (s.closeSegmentIndex(), r.yc.delete(s));
                        })),
                        r.yc.set(s, a)),
                      (c = r.yc.get(s)),
                      c.ka(5)),
                    (f = s.segmentIndex.find(t)),
                    f == null)
                      ? x.return(null)
                      : ((g = s.segmentIndex.get(f)),
                        (m = nI(g.tilesLayout || s.tilesLayout))
                          ? x.return(rI(g, s, t, m))
                          : x.return(null)));
              });
            };
            function iI(e, t) {
              var r, s;
              return W(function (a) {
                return a.g == 1
                  ? (e.m != $n && e.m != Ui) || ((r = e.Ke), e.i && (r = e.i.imageStreams), (s = r[0]), !s)
                    ? a.return(null)
                    : (t != null &&
                        (s = r.find(function (c) {
                          return c.id == t;
                        })),
                      s ? (s.segmentIndex ? a.A(2) : _(a, s.createSegmentIndex(), 2)) : a.return(null))
                  : a.return(s);
              });
            }
            function rI(e, t, r, s) {
              var a = t.width || 0,
                c = t.height || 0,
                f = a / s.columns,
                g = c / s.rows,
                m = s.columns * s.rows,
                x = e.j - e.startTime;
              x = e.B || x / m;
              var E = e.startTime,
                A = 0,
                R = 0;
              return (
                m > 1 &&
                  ((R = Math.floor((r - e.startTime) / x)),
                  (E = e.startTime + R * x),
                  (A = (R % s.columns) * f),
                  (R = Math.floor(R / s.columns) * g)),
                (s = !1),
                (r = e.thumbnailSprite) &&
                  ((s = !0), (g = r.height), (A = r.positionX), (R = r.positionY), (f = r.width)),
                {
                  segment: e,
                  imageHeight: c,
                  imageWidth: a,
                  height: g,
                  positionX: A,
                  positionY: R,
                  startTime: E,
                  duration: x,
                  uris: e.P(),
                  startByte: e.Jc(),
                  endByte: e.Hc(),
                  width: f,
                  sprite: s,
                  mimeType: e.mimeType || t.mimeType,
                  codecs: e.codecs || t.codecs,
                }
              );
            }
            d.ph = function (e) {
              function t() {
                var s = r.i.textStreams.find(function (a) {
                  return a.id == e.id;
                });
                s && s != r.l.B && (b0(r.B.h, s, !1), Bh(r.l, s), ks(r), hc(r), (r.Kd = s.language));
              }
              var r = this;
              (this.i && this.G && (t(), !this.xa())) ||
                (function () {
                  if (r.h && r.h.textTracks) {
                    var s = hf(r),
                      a = s.find(function (g) {
                        return dh(g) === e.id;
                      });
                    if (a) {
                      if (r.u instanceof Tn) {
                        s = I(s);
                        for (var c = s.next(); !c.done; c = s.next()) {
                          c = c.value;
                          var f = c === a ? (r.$ ? "showing" : "hidden") : "disabled";
                          c.mode !== f && (c.mode = f);
                        }
                      } else
                        ((s = s.find(function (g) {
                          return g.mode !== "disabled";
                        })),
                          s !== a &&
                            (s && ((s.mode = "disabled"), r.j.Ma(s, "cuechange"), r.u.remove(0, 1 / 0)),
                            a && sI(r, a)));
                      (ks(r), hc(r));
                    }
                  }
                })();
            };
            function sI(e, t) {
              (e.j.D(t, "cuechange", function () {
                e.u.remove(0, Math.max(0, e.h.currentTime - e.g.streaming.bufferBehind));
                var r = { periodStart: 0, segmentStart: 0, segmentEnd: e.h.duration, vttOffset: 0 },
                  s = [],
                  a = Array.from(t.activeCues || []);
                a = I(a);
                for (var c = a.next(); !c.done; c = a.next()) {
                  if (((c = c.value), c.endTime === 1 / 0 || c.endTime < c.startTime)) c = null;
                  else {
                    var f = new $t(c.startTime, c.endTime, c.text);
                    ((f.line = typeof c.line == "number" ? c.line : null),
                      c.lineAlign && (f.lineAlign = c.lineAlign),
                      (f.lineInterpretation = c.snapToLines ? bu : 1),
                      (f.position = typeof c.position == "number" ? c.position : null),
                      c.positionAlign && (f.positionAlign = c.positionAlign),
                      (f.size = c.size),
                      (f.textAlign = c.align),
                      c.vertical === "lr"
                        ? (f.writingMode = "vertical-lr")
                        : c.vertical === "rl" && (f.writingMode = "vertical-rl"),
                      c.region &&
                        ((f.region.id = c.region.id),
                        (f.region.height = c.region.lines),
                        (f.region.heightUnits = 2),
                        (f.region.regionAnchorX = c.region.regionAnchorX),
                        (f.region.regionAnchorY = c.region.regionAnchorY),
                        (f.region.scroll = c.region.scroll),
                        (f.region.viewportAnchorX = c.region.viewportAnchorX),
                        (f.region.viewportAnchorY = c.region.viewportAnchorY),
                        (f.region.viewportAnchorUnits = Mi),
                        (f.region.width = c.region.width),
                        (f.region.widthUnits = Mi)),
                      ih(f),
                      (c = f));
                  }
                  c && ((f = e.g.mediaSource.modifyCueCallback) && f(c, null, r), s.push(c));
                }
                e.u.append(s);
              }),
                (t.mode = document.pictureInPictureElement ? "showing" : "hidden"));
            }
            ((d.Jf = function (e, t, r) {
              function s() {
                var c = a.i.variants.find(function (g) {
                  return g.id == e.id;
                });
                if (c && Uu(c)) {
                  var f = a.l.o;
                  (a.g.abr.enabled &&
                    (f.video != c.video ||
                      (f.audio &&
                        c.audio &&
                        f.audio.language == c.audio.language &&
                        f.audio.channelsCount == c.audio.channelsCount &&
                        f.audio.label == c.audio.label)) &&
                    He(
                      "Changing tracks while abr manager is enabled will likely result in the selected track being overridden. Consider disabling abr before calling selectVariantTrack().",
                    ),
                    a.xa() ? dc(a, c, !1, !1, 0) : dc(a, c, !1, t || !1, r || 0),
                    a.J.configure({
                      language: c.language,
                      role: (c.audio && c.audio.roles && c.audio.roles[0]) || "",
                      videoRole: (c.video && c.video.roles && c.video.roles[0]) || "",
                      channelCount: c.audio && c.audio.channelsCount ? c.audio.channelsCount : 0,
                      hdrLevel: c.video && c.video.hdr ? c.video.hdr : "",
                      spatialAudio: c.audio && c.audio.spatialAudio ? c.audio.spatialAudio : !1,
                      videoLayout: c.video && c.video.videoLayout ? c.video.videoLayout : "",
                      audioLabel: c.audio && c.audio.label ? c.audio.label : "",
                      videoLabel: c.video && c.video.label ? c.video.label : "",
                      codecSwitchingStrategy: a.g.mediaSource.codecSwitchingStrategy,
                      audioCodec: c.audio && c.audio.codecs ? c.audio.codecs : "",
                      activeAudioCodec: f.audio && f.audio.codecs ? f.audio.codecs : "",
                      activeAudioChannelCount: f.audio && f.audio.channelsCount ? f.audio.channelsCount : 0,
                      preferredAudioCodecs: a.g.preferredAudioCodecs,
                      preferredAudioChannelCount: a.g.preferredAudioChannelCount,
                    }),
                    go(a));
                }
              }
              var a = this;
              ((t = t === void 0 ? !1 : t),
                (r = r === void 0 ? 0 : r),
                !(this.i && this.G && (s(), !this.xa())) &&
                  (function () {
                    if (e.originalAudioId && a.h && a.h.audioTracks) {
                      var c = Array.from(a.h.audioTracks);
                      c = I(c);
                      for (var f = c.next(); !f.done; f = c.next())
                        if (((f = f.value), dh(f) == e.id)) {
                          Z0(a, f);
                          break;
                        }
                    }
                  })());
            }),
              (d.Wk = function (e, t) {
                function r() {
                  var a = s.J.getConfiguration();
                  ((a.audioCodec = e.codecs || ""),
                    (a.audioLabel = e.label || ""),
                    (a.channelCount = e.channelsCount || 0),
                    (a.language = e.language),
                    (a.role = e.roles[0] || ""),
                    (a.spatialAudio = e.spatialAudio));
                  var c = s.l.o;
                  ((c = c && c.audio) &&
                    ((a.activeAudioCodec = c.codecs || ""),
                    (a.activeAudioChannelCount = c.channelsCount || 0)),
                    s.J.configure(a),
                    mo(s, !0, t, !1, !1));
                }
                var s = this;
                ((t = t === void 0 ? 0 : t),
                  !(this.i && this.G && (r(), !this.xa())) &&
                    (function () {
                      if (s.h && s.h.audioTracks) {
                        var a = At(e.language),
                          c = Array.from(s.h.audioTracks),
                          f = null;
                        c = I(c);
                        for (var g = c.next(); !g.done; g = c.next()) {
                          g = g.value;
                          var m = g.language || "und";
                          if (g.label == e.label && At(m) == a && g.kind == e.roles[0]) {
                            f = g;
                            break;
                          }
                        }
                        f && Z0(s, f);
                      }
                    })());
              }),
              (d.getAudioTracks = function () {
                if (this.i && !this.xa()) {
                  var e = this.qc();
                  if (!e.length) return [];
                  var t = e.find(function (c) {
                    return c.active;
                  });
                  if (!t) return [];
                  var r = e;
                  if (
                    (this.m != $n ||
                      this.xa() ||
                      (r = e.filter(function (c) {
                        return (
                          c.originalVideoId === t.originalVideoId &&
                          (c.audioCodec || Ss.includes(c.audioMimeType || ""))
                        );
                      })),
                    !r.length)
                  )
                    return [];
                  ((e = new Map()), (r = I(r)));
                  for (var s = r.next(); !s.done; s = r.next()) {
                    s = s.value;
                    var a = s.originalAudioId;
                    (a || s.audioId == null || (a = String(s.audioId)),
                      !a && s.codecs.includes(",") && s.audioCodec && (a = "muxed-in-video"),
                      a &&
                        ((a += [
                          s.language,
                          s.label,
                          s.channelsCount,
                          s.spatialAudio,
                          s.audioCodec || "",
                        ].join("_")),
                        e.set(a, {
                          active: s.active,
                          language: s.language,
                          label: s.label,
                          mimeType: s.audioMimeType,
                          codecs: s.audioCodec,
                          primary: s.primary,
                          roles: s.audioRoles || [],
                          accessibilityPurpose: s.accessibilityPurpose,
                          channelsCount: s.channelsCount,
                          audioSamplingRate: s.audioSamplingRate,
                          spatialAudio: s.spatialAudio,
                          originalLanguage: s.originalLanguage,
                        })));
                  }
                  return Array.from(e.values());
                }
                return this.h && this.h.audioTracks
                  ? Array.from(this.h.audioTracks).map(function (c) {
                      var f = c.language;
                      return (
                        (f = {
                          active: c.enabled,
                          language: At(f || "und"),
                          label: c.label,
                          mimeType: null,
                          codecs: null,
                          primary: c.kind == "main",
                          roles: [],
                          accessibilityPurpose: null,
                          channelsCount: null,
                          audioSamplingRate: null,
                          spatialAudio: !1,
                          originalLanguage: f,
                        }),
                        c.kind &&
                          (c.kind == "description" && (f.accessibilityPurpose = "visually impaired"),
                          f.roles.push(c.kind)),
                        c.configuration &&
                          (c.configuration.codec && (f.codecs = c.configuration.codec),
                          c.configuration.sampleRate && (f.audioSamplingRate = c.configuration.sampleRate),
                          c.configuration.numberOfChannels &&
                            (f.channelsCount = c.configuration.numberOfChannels)),
                        f
                      );
                    })
                  : [];
              }),
              (d.Yk = function (e, t, r) {
                ((t = t === void 0 ? !1 : t), (r = r === void 0 ? 0 : r));
                var s = this.qc();
                if (s.length) {
                  var a = s.find(function (f) {
                    return f.active;
                  });
                  if (a) {
                    s = s.filter(function (f) {
                      return (
                        (f.videoBandwidth || f.bandwidth) == e.bandwidth &&
                        f.width == e.width &&
                        f.height == e.height &&
                        f.frameRate == e.frameRate &&
                        f.pixelAspectRatio == e.pixelAspectRatio &&
                        f.hdr == e.hdr &&
                        f.colorGamut == e.colorGamut &&
                        f.videoLayout == e.videoLayout &&
                        f.videoMimeType == e.mimeType &&
                        f.videoCodec == e.codecs &&
                        Nr(f.videoRoles, e.roles) &&
                        f.videoLabel == e.label
                      );
                    });
                    var c;
                    (s.length == 1
                      ? (c = s[0])
                      : (c = s.find(function (f) {
                          return f.audioId === a.audioId;
                        })),
                      c ||
                        (c = s.find(function (f) {
                          return (
                            f.language == a.language &&
                            f.label === a.label &&
                            f.channelsCount === a.channelsCount &&
                            f.spatialAudio === a.spatialAudio &&
                            f.audioMimeType === a.audioMimeType &&
                            Kn(f.audioCodec || "") === Kn(a.audioCodec || "") &&
                            Nr(f.audioRoles, a.audioRoles)
                          );
                        })),
                      c && !c.active && this.Jf(c, t, r));
                  }
                }
              }),
              (d.getVideoTracks = function () {
                if (this.m == Ui || this.xa()) return [];
                var e = this.qc();
                if (!e.length) return [];
                var t = e.find(function (c) {
                  return c.active;
                });
                if (!t) return [];
                var r = e;
                if (
                  (this.ti() ||
                    (r = e.filter(function (c) {
                      return c.videoCodec &&
                        c.audioGroupId === t.audioGroupId &&
                        c.originalAudioId === t.originalAudioId
                        ? c.audioId === t.audioId
                          ? !0
                          : c.language === t.language &&
                            c.label === t.label &&
                            c.channelsCount === t.channelsCount &&
                            c.spatialAudio === t.spatialAudio &&
                            c.audioMimeType === t.audioMimeType &&
                            Kn(c.audioCodec || "") === Kn(t.audioCodec || "") &&
                            Nr(c.audioRoles, t.audioRoles)
                        : !1;
                    })),
                  !r.length)
                )
                  return [];
                ((e = new Map()), (r = I(r)));
                for (var s = r.next(); !s.done; s = r.next()) {
                  s = s.value;
                  var a = s.originalVideoId;
                  (a || s.videoId == null || (a = String(s.videoId)),
                    a &&
                      e.set(a, {
                        active: s.active,
                        bandwidth: s.videoBandwidth || s.bandwidth,
                        width: s.width,
                        height: s.height,
                        frameRate: s.frameRate,
                        pixelAspectRatio: s.pixelAspectRatio,
                        hdr: s.hdr,
                        colorGamut: s.colorGamut,
                        videoLayout: s.videoLayout,
                        mimeType: s.videoMimeType,
                        codecs: s.videoCodec,
                        roles: s.videoRoles || [],
                        label: s.videoLabel,
                      }));
                }
                return Array.from(e.values());
              }),
              (d.Dj = function () {
                return xI(this.qc());
              }),
              (d.$j = function () {
                return xI(this.Lc());
              }),
              (d.Cj = function () {
                return Array.from(vI(this.qc()));
              }),
              (d.Zj = function () {
                return Array.from(vI(this.Lc()));
              }),
              (d.Ti = function (e, t, r, s, a, c, f) {
                function g() {
                  function x(D, M) {
                    return D.video || M.video
                      ? D.video && M.video
                        ? Math.abs((D.video.height || 0) - (M.video.height || 0)) +
                          Math.abs((D.video.width || 0) - (M.video.width || 0))
                        : 1 / 0
                      : 0;
                  }
                  var E = m.l.o;
                  ((m.J = m.g.adaptationSetCriteriaFactory()),
                    m.J.configure({
                      language: e,
                      role: t || "",
                      videoRole: (E.video && E.video.roles && E.video.roles[0]) || "",
                      channelCount: r || 0,
                      hdrLevel: "",
                      spatialAudio: c || !1,
                      videoLayout: "",
                      audioLabel: f || "",
                      videoLabel: "",
                      codecSwitchingStrategy: m.g.mediaSource.codecSwitchingStrategy,
                      audioCodec: a || "",
                      activeAudioCodec: E.audio && E.audio.codecs ? E.audio.codecs : "",
                      activeAudioChannelCount: E.audio && E.audio.channelsCount ? E.audio.channelsCount : 0,
                      preferredAudioCodecs: m.g.preferredAudioCodecs,
                      preferredAudioChannelCount: m.g.preferredAudioChannelCount,
                    }));
                  var A = m.J.create(m.i.variants),
                    R = null;
                  A = I(A.values());
                  for (var b = A.next(); !b.done; b = A.next())
                    ((b = b.value), Uu(b) && (!R || x(R, E) > x(b, E)) && (R = b));
                  R != E && (R ? ((E = qo(R)), m.Jf(E, !0, s || 0)) : mo(m));
                }
                var m = this;
                ((r = r === void 0 ? 0 : r),
                  (s = s === void 0 ? 0 : s),
                  (a = a === void 0 ? "" : a),
                  (c = c === void 0 ? !1 : c),
                  (f = f === void 0 ? "" : f),
                  !(this.i && this.G && (g(), !this.xa())) &&
                    (function () {
                      if (m.h && m.h.audioTracks) {
                        var x = ja(m.qc(), e, t || "", !1)[0];
                        x && m.Jf(x);
                      }
                    })());
              }),
              (d.oh = function (e, t, r) {
                function s() {
                  ((a.Kd = e), (a.Od = t || ""), (a.Nd = r || !1));
                  var c = ja(a.i.textStreams, a.Kd, a.Od, a.Nd)[0] || null;
                  c &&
                    c != a.l.B &&
                    (b0(a.B.h, c, !1), a.g.streaming.alwaysStreamText || a.Sg()) &&
                    (Bh(a.l, c), ks(a), hc(a));
                }
                var a = this;
                ((r = r === void 0 ? !1 : r),
                  !(this.i && this.G && (s(), !this.xa())) &&
                    (function () {
                      var c = ja(a.Lc(), e, t || "", r || !1)[0];
                      c && a.ph(c);
                    })());
              }),
              (d.Xk = function (e, t, r) {
                function s() {
                  for (var c = null, f = I(a.i.variants), g = f.next(); !g.done; g = f.next())
                    if (((g = g.value), g.audio.label == e)) {
                      c = g;
                      break;
                    }
                  c != null &&
                    ((a.J = a.g.adaptationSetCriteriaFactory()),
                    a.J.configure({
                      language: c.language,
                      role: "",
                      videoRole: "",
                      channelCount: 0,
                      hdrLevel: "",
                      spatialAudio: !1,
                      videoLayout: "",
                      videoLabel: "",
                      audioLabel: e,
                      codecSwitchingStrategy: a.g.mediaSource.codecSwitchingStrategy,
                      audioCodec: "",
                      activeAudioCodec: "",
                      activeAudioChannelCount: 0,
                      preferredAudioCodecs: a.g.preferredAudioCodecs,
                      preferredAudioChannelCount: a.g.preferredAudioChannelCount,
                    }),
                    mo(a, t, r));
                }
                var a = this;
                ((t = t === void 0 ? !0 : t),
                  (r = r === void 0 ? 0 : r),
                  !(this.i && this.G && (s(), !this.xa())) &&
                    (function () {
                      if (a.h && a.h.audioTracks) {
                        var c = Array.from(a.h.audioTracks),
                          f = null;
                        c = I(c);
                        for (var g = c.next(); !g.done; g = c.next())
                          ((g = g.value), g.label == e && (f = g));
                        f && Z0(a, f);
                      }
                    })());
              }),
              (d.Sg = function () {
                var e = this.$;
                return this.u ? this.u.isTextVisible() : e;
              }),
              (d.Hj = function () {
                return this.ob.map(function (e) {
                  return Qo(e);
                });
              }),
              (d.Fj = function (e) {
                if ((ft("getChapters", "Please use an getChaptersAsync."), !this.ob.length)) return [];
                var t = At(e);
                if (
                  ((e = this.ob.filter(function (c) {
                    return At(c.language) == t;
                  })),
                  !e.length)
                )
                  return [];
                var r = [],
                  s = new Set();
                e = I(e);
                for (var a = e.next(); !a.done; a = e.next())
                  ((a = a.value),
                    a.segmentIndex &&
                      a.segmentIndex.Fb(function (c) {
                        var f = c.P()[0],
                          g = c.startTime + "-" + c.endTime + "-" + f;
                        ((c = { id: g, title: f, startTime: c.startTime, endTime: c.endTime }),
                          s.has(g) || (r.push(c), s.add(g)));
                      }));
                return r;
              }),
              (d.Gj = function (e) {
                var t = this,
                  r,
                  s,
                  a,
                  c,
                  f,
                  g,
                  m;
                return W(function (x) {
                  switch (x.g) {
                    case 1:
                      if (!t.ob.length) return x.return([]);
                      if (
                        ((r = At(e)),
                        (s = t.ob.filter(function (E) {
                          return At(E.language) == r;
                        })),
                        !s.length)
                      )
                        return x.return([]);
                      ((a = []), (c = new Set()), (f = I(s)), (g = f.next()));
                    case 2:
                      if (g.done) {
                        x.A(4);
                        break;
                      }
                      if (((m = g.value), m.segmentIndex)) {
                        x.A(5);
                        break;
                      }
                      return _(x, m.createSegmentIndex(), 5);
                    case 5:
                      (m.segmentIndex.Fb(function (E) {
                        var A = E.P()[0],
                          R = E.startTime + "-" + E.endTime + "-" + A;
                        ((E = { id: R, title: A, startTime: E.startTime, endTime: E.endTime }),
                          c.has(R) || (a.push(E), c.add(R)));
                      }),
                        (g = f.next()),
                        x.A(2));
                      break;
                    case 4:
                      return x.return(a);
                  }
                });
              }));
            function hf(e) {
              return Array.from(e.h.textTracks).filter(function (t) {
                return t.kind != "metadata" && t.kind != "chapters" && t.label != "Shaka Player TextTrack";
              });
            }
            function GN(e) {
              return Array.from(e.h.textTracks).find(function (t) {
                return t.label == "Shaka Player TextTrack";
              });
            }
            function jN(e) {
              return Array.from(e.h.textTracks).filter(function (t) {
                return t.kind == "metadata";
              });
            }
            ((d.wh = function (e) {
              ((e = !!e),
                this.$ != e &&
                  ((this.$ = e),
                  this.m == $n
                    ? (this.u.setTextVisibility(e),
                      this.g.streaming.alwaysStreamText ||
                        (e
                          ? this.l.B ||
                            ((e = ja(this.i.textStreams, this.Kd, this.Od, this.Nd)),
                            e.length > 0 && (Bh(this.l, e[0]), ks(this), hc(this)))
                          : pO(this.l)))
                    : this.h && this.h.src && this.h.textTracks && this.u.setTextVisibility(e),
                  gI(this)));
            }),
              (d.Tj = function () {
                if (this.G) var e = this.G.Qd();
                else {
                  if (this.O == null) return new Date();
                  if (this.O instanceof Date) return this.O;
                  e = this.O;
                }
                if (this.i && !this.xa()) {
                  var t = this.i.presentationTimeline;
                  return new Date(((t.m || t.i) + e) * 1e3);
                }
                return this.h && this.h.getStartDate
                  ? ((t = this.h.getStartDate()), isNaN(t.getTime()) ? null : new Date(t.getTime() + e * 1e3))
                  : null;
              }),
              (d.li = function () {
                if (this.i && !this.xa()) {
                  var e = this.i.presentationTimeline;
                  return ((e = e.m || e.i), e === null ? null : new Date(e * 1e3));
                }
                return this.h && this.h.getStartDate
                  ? ((e = this.h.getStartDate()), isNaN(e.getTime()) ? null : e)
                  : null;
              }),
              (d.df = function () {
                return this.W() && this.i ? this.i.presentationTimeline.df() : null;
              }),
              (d.Gc = function () {
                if (this.m == $n) return this.H.Gc();
                var e = { total: [], audio: [], video: [], text: [] };
                return (this.m == Ui && (e.total = Cs(this.h.buffered)), e);
              }));
            function oI(e) {
              if (!e.h || !e.h.currentTime) return null;
              var t = e.li();
              return t ? Math.floor(Date.now() - (t.getTime() + e.h.currentTime * 1e3)) : null;
            }
            ((d.getBandwidthEstimate = function () {
              return this.o ? this.o.getBandwidthEstimate() : NaN;
            }),
              (d.getStats = function () {
                if (this.m != $n && this.m != Ui)
                  return {
                    width: NaN,
                    height: NaN,
                    currentCodecs: "",
                    streamBandwidth: NaN,
                    decodedFrames: NaN,
                    droppedFrames: NaN,
                    corruptedFrames: NaN,
                    stallsDetected: NaN,
                    gapsJumped: NaN,
                    estimatedBandwidth: NaN,
                    completionPercent: NaN,
                    loadLatency: NaN,
                    manifestTimeSeconds: NaN,
                    drmTimeSeconds: NaN,
                    playTime: NaN,
                    pauseTime: NaN,
                    bufferingTime: NaN,
                    licenseTime: NaN,
                    liveLatency: NaN,
                    maxSegmentDuration: NaN,
                    manifestSizeBytes: NaN,
                    bytesDownloaded: NaN,
                    nonFatalErrorCount: NaN,
                    manifestPeriodCount: NaN,
                    manifestGapCount: NaN,
                    switchHistory: [],
                    stateHistory: [],
                  };
                J0(this);
                var e = this.h,
                  t = e.currentTime / e.duration;
                if (
                  (isNaN(t) || this.W() || GO(this.B, Math.round(100 * t)),
                  this.G && ((this.B.T = this.G.Lh()), (this.B.V = this.G.Nh())),
                  e.getVideoPlaybackQuality &&
                    ((t = e.getVideoPlaybackQuality()),
                    $O(this.B, Number(t.droppedVideoFrames), Number(t.totalVideoFrames)),
                    (this.B.N = Number(t.corruptedVideoFrames))),
                  (this.B.o = this.F ? YP(this.F) : NaN),
                  h1(this.B, e.videoWidth || NaN, e.videoHeight || NaN),
                  (this.B.l = ""),
                  this.W() && ((e = oI(this)), e != null && (this.B.F = e / 1e3)),
                  (t = this.qc().find(function (a) {
                    return a.active;
                  })),
                  (e = this.Lc().find(function (a) {
                    return a.active;
                  })),
                  t)
                ) {
                  if (t.bandwidth) {
                    var r = this.M ? this.M.i : 1,
                      s = r * t.bandwidth;
                    (e && e.bandwidth && (s += r * e.bandwidth), (this.B.B = s));
                  }
                  (t.width && t.height && h1(this.B, t.width || NaN, t.height || NaN),
                    (t = t.codecs),
                    e && (t += "," + (e.codecs || e.mimeType)),
                    t && (this.B.l = t));
                }
                return (
                  this.m != $n ||
                    this.xa() ||
                    (this.i &&
                      ((this.B.I = this.i.periodCount),
                      (this.B.H = this.i.gapCount),
                      this.i.presentationTimeline && (this.B.K = this.i.presentationTimeline.h)),
                    (e = this.o.getBandwidthEstimate()),
                    (this.B.u = e)),
                  this.m == Ui && f1(this.B, NaN),
                  jO(this.B)
                );
              }),
              (d.Rd = function (e, t, r, s, a, c, f) {
                f = f === void 0 ? !1 : f;
                var g = this,
                  m,
                  x,
                  E,
                  A,
                  R,
                  b,
                  D,
                  M,
                  P,
                  G,
                  U,
                  H;
                return W(function (Q) {
                  switch (Q.g) {
                    case 1:
                      if (g.m != $n && g.m != Ui) throw new ee(1, 7, 7004);
                      if (
                        (r != "subtitles" &&
                          r != "captions" &&
                          He(
                            "Using a kind value different of `subtitles` or `captions` can cause unwanted issues.",
                          ),
                        s)
                      ) {
                        Q.A(2);
                        break;
                      }
                      return _(Q, ff(g, e), 3);
                    case 3:
                      s = Q.h;
                    case 2:
                      if (((m = []), g.C && (m = g.C.getCuePoints()), g.m != Ui)) {
                        Q.A(4);
                        break;
                      }
                      return (
                        (x = tt()),
                        f && x.Ha() === "WEBKIT" && (r = "forced"),
                        _(Q, VN(g, e, t, r, s, c || "", m), 5)
                      );
                    case 5:
                      if (((E = Q.h), E.track)) return (ci(g), ks(g), Q.return(xE(E.track)));
                      throw new ee(1, 2, 2012);
                    case 4:
                      if (
                        ((A = hn),
                        (R = g.Ra()),
                        (b = R.end - R.start),
                        g.i && (b = g.i.presentationTimeline.getDuration()),
                        b == 1 / 0)
                      )
                        throw new ee(1, 4, 4033);
                      if (!m.length) {
                        Q.A(6);
                        break;
                      }
                      return _(Q, pf(g, e), 7);
                    case 7:
                      ((D = Q.h),
                        (M = aI(g, D, s, m)),
                        (P = new Blob([M], { type: "text/vtt" })),
                        (e = o0(P)),
                        (s = "text/vtt"));
                    case 6:
                      if (
                        ((G = {
                          id: g.Fe++,
                          originalId: null,
                          groupId: null,
                          createSegmentIndex: function () {
                            return Promise.resolve();
                          },
                          segmentIndex: Oh(0, b, [e]),
                          mimeType: s || "",
                          codecs: a || "",
                          kind: r,
                          encrypted: !1,
                          drmInfos: [],
                          keyIds: new Set(),
                          language: t,
                          originalLanguage: t,
                          label: c || null,
                          type: A.Na,
                          primary: !1,
                          trickModeVideo: null,
                          dependencyStream: null,
                          emsgSchemeIdUris: null,
                          roles: [],
                          forced: !!f,
                          channelsCount: null,
                          audioSamplingRate: null,
                          spatialAudio: !1,
                          closedCaptions: null,
                          accessibilityPurpose: null,
                          external: !0,
                          fastSwitching: !1,
                          fullMimeTypes: new Set([tn(s || "", a || "")]),
                          isAudioMuxedInVideo: !1,
                          baseOriginalId: null,
                        }),
                        (U = tn(G.mimeType, G.codecs)),
                        (H = Mu(U)),
                        !H)
                      )
                        throw new ee(2, 2, 2014, s);
                      return (g.i.textStreams.push(G), ci(g), ks(g), Q.return(Qo(G)));
                  }
                });
              }),
              (d.Pe = function (e, t) {
                var r = this,
                  s,
                  a,
                  c,
                  f,
                  g,
                  m,
                  x,
                  E,
                  A,
                  R,
                  b,
                  D,
                  M,
                  P,
                  G,
                  U,
                  H,
                  Q;
                return W(function (ne) {
                  switch (ne.g) {
                    case 1:
                      if (r.m != $n && r.m != Ui) throw new ee(1, 7, 7004);
                      if (t) {
                        ne.A(2);
                        break;
                      }
                      return _(ne, ff(r, e), 3);
                    case 3:
                      t = ne.h;
                    case 2:
                      if (t != "text/vtt") throw new ee(1, 2, 2017, e);
                      if (
                        ((s = hn),
                        (a = r.Ra()),
                        (c = a.end - a.start),
                        r.i && (c = r.i.presentationTimeline.getDuration()),
                        c == 1 / 0)
                      )
                        throw new ee(1, 4, 4045);
                      return _(ne, pf(r, e), 4);
                    case 4:
                      if (((f = ne.h), (g = ku(t)), !g)) throw new ee(2, 2, 2014, t);
                      for (
                        m = g(),
                          x = { periodStart: 0, segmentStart: 0, segmentEnd: c, vttOffset: 0 },
                          E = We(f),
                          A = m.parseMedia(E, x, e, []),
                          R = [],
                          b = I(A),
                          D = b.next(),
                          M = {};
                        !D.done;
                        M = { Wf: void 0, nd: void 0 }, D = b.next()
                      )
                        ((M.nd = D.value),
                          (M.Wf = null),
                          (P = (function (z) {
                            return function () {
                              return (z.Wf == null && (z.Wf = Ln([e], [z.nd.payload])), z.Wf || []);
                            };
                          })(M)),
                          (G = new Be(M.nd.startTime, M.nd.endTime, P, 0, null, null, 0, 0, 1 / 0)),
                          M.nd.payload.includes("#xywh") &&
                            ((U = M.nd.payload.split("#xywh=")[1].split(",")),
                            U.length === 4 &&
                              G.Mf({
                                height: parseInt(U[3], 10),
                                positionX: parseInt(U[0], 10),
                                positionY: parseInt(U[1], 10),
                                width: parseInt(U[2], 10),
                              })),
                          R.push(G));
                      if (((H = t), !R.length)) {
                        ne.A(5);
                        break;
                      }
                      return _(ne, ff(r, R[0].P()[0]), 6);
                    case 6:
                      H = ne.h;
                    case 5:
                      return (
                        (Q = {
                          id: r.Fe++,
                          originalId: null,
                          groupId: null,
                          createSegmentIndex: function () {
                            return Promise.resolve();
                          },
                          segmentIndex: new mt(R),
                          mimeType: H || "",
                          codecs: "",
                          kind: "",
                          encrypted: !1,
                          drmInfos: [],
                          keyIds: new Set(),
                          language: "und",
                          originalLanguage: null,
                          label: null,
                          type: s.Yf,
                          primary: !1,
                          trickModeVideo: null,
                          dependencyStream: null,
                          emsgSchemeIdUris: null,
                          roles: [],
                          forced: !1,
                          channelsCount: null,
                          audioSamplingRate: null,
                          spatialAudio: !1,
                          closedCaptions: null,
                          tilesLayout: "1x1",
                          accessibilityPurpose: null,
                          external: !0,
                          fastSwitching: !1,
                          fullMimeTypes: new Set([tn(H || "", "")]),
                          isAudioMuxedInVideo: !1,
                          baseOriginalId: null,
                        }),
                        r.m == Ui ? r.Ke.push(Q) : r.i.imageStreams.push(Q),
                        ci(r),
                        ne.return(Mm(Q))
                      );
                  }
                });
              }),
              (d.Oe = function (e, t, r) {
                var s = this,
                  a,
                  c,
                  f,
                  g,
                  m,
                  x,
                  E,
                  A,
                  R,
                  b,
                  D,
                  M,
                  P,
                  G,
                  U;
                return W(function (H) {
                  switch (H.g) {
                    case 1:
                      if (s.m != $n && s.m != Ui) throw new ee(1, 7, 7004);
                      if (r) {
                        H.A(2);
                        break;
                      }
                      return _(H, ff(s, e), 3);
                    case 3:
                      r = H.h;
                    case 2:
                      if (
                        ((a = hn),
                        (c = s.Ra()),
                        (f = c.end - c.start),
                        s.i && (f = s.i.presentationTimeline.getDuration()),
                        f == 1 / 0)
                      )
                        throw new ee(1, 4, 4055);
                      if (((g = ku(r)), !g)) throw new ee(2, 2, 2014, r);
                      return _(H, pf(s, e), 4);
                    case 4:
                      for (
                        m = H.h,
                          x = g(),
                          E = { periodStart: 0, segmentStart: 0, segmentEnd: f, vttOffset: 0 },
                          A = We(m),
                          R = x.parseMedia(A, E, e, []),
                          b = [],
                          D = I(R),
                          M = D.next(),
                          P = {};
                        !M.done;
                        P = { Xe: void 0 }, M = D.next()
                      )
                        ((P.Xe = M.value),
                          (G = new Be(
                            P.Xe.startTime,
                            P.Xe.endTime,
                            (function (Q) {
                              return function () {
                                return [Q.Xe.payload];
                              };
                            })(P),
                            0,
                            null,
                            null,
                            0,
                            0,
                            1 / 0,
                          )),
                          b.push(G));
                      return (
                        (U = {
                          id: s.Fe++,
                          originalId: null,
                          groupId: null,
                          createSegmentIndex: function () {
                            return Promise.resolve();
                          },
                          segmentIndex: new mt(b),
                          mimeType: "text/plain",
                          codecs: "",
                          kind: "",
                          encrypted: !1,
                          drmInfos: [],
                          keyIds: new Set(),
                          language: t,
                          originalLanguage: t,
                          label: null,
                          type: a.Na,
                          primary: !1,
                          trickModeVideo: null,
                          dependencyStream: null,
                          emsgSchemeIdUris: null,
                          roles: [],
                          forced: !1,
                          channelsCount: null,
                          audioSamplingRate: null,
                          spatialAudio: !1,
                          closedCaptions: null,
                          accessibilityPurpose: null,
                          external: !0,
                          fastSwitching: !1,
                          fullMimeTypes: new Set([tn("text/plain", "")]),
                          isAudioMuxedInVideo: !1,
                          baseOriginalId: null,
                        }),
                        s.ob.push(U),
                        ci(s),
                        H.return(Qo(U))
                      );
                  }
                });
              }));
            function ff(e, t) {
              var r;
              return W(function (s) {
                switch (s.g) {
                  case 1:
                    return (q(s, 2), _(s, rl(t, e.N, e.g.streaming.retryParameters), 4));
                  case 4:
                    ((r = s.h), he(s, 3));
                    break;
                  case 2:
                    ae(s);
                  case 3:
                    if (r) return s.return(r);
                    throw new ee(1, 2, 2011, t);
                }
              });
            }
            function VN(e, t, r, s, a, c, f) {
              var g, m, x, E;
              return W(function (A) {
                if (A.g == 1) return a != "text/vtt" || f.length ? _(A, pf(e, t), 3) : A.A(2);
                (A.g != 2 &&
                  ((g = A.h),
                  (m = aI(e, g, a, f)),
                  (x = new Blob([m], { type: "text/vtt" })),
                  (t = o0(x)),
                  (a = "text/vtt")),
                  (E = document.createElement("track")));
                e: {
                  var R = e.K,
                    b = t;
                  try {
                    if (!R.g.enabled) {
                      var D = b;
                      break e;
                    }
                    var M = $0(R);
                    ((M.ot = H0), (M.su = !0));
                    var P = uc(M);
                    D = ef(b, P);
                    break e;
                  } catch (G) {
                    (Cn("CMCD_TEXT_TRACK_ERROR", "Could not generate text track CMCD data.", G), (D = b));
                    break e;
                  }
                  D = void 0;
                }
                return (
                  (E.src = D),
                  (E.label = c),
                  (E.kind = s),
                  (E.srclang = r),
                  e.h.getAttribute("crossorigin") || e.h.setAttribute("crossorigin", "anonymous"),
                  e.h.appendChild(E),
                  e.cg.push(E),
                  A.return(E)
                );
              });
            }
            function pf(e, t) {
              var r, s, a, c;
              return W(function (f) {
                if (f.g == 1) {
                  ((r = or), (s = e.g.streaming.retryParameters), (a = fn([t], s)), (a.method = "GET"));
                  var g = e.K;
                  try {
                    g.g.enabled && cl(g, a, { ot: H0, su: !0 });
                  } catch (m) {
                    Cn("CMCD_TEXT_ERROR", "Could not generate text CMCD data.", m);
                  }
                  return _(f, e.N.request(r, a).promise, 2);
                }
                return ((c = f.h), f.return(c.data));
              });
            }
            function aI(e, t, r, s) {
              var a = ku(r);
              if (a)
                return (
                  (r = a()),
                  (e = { periodStart: 0, segmentStart: 0, segmentEnd: e.h.duration, vttOffset: 0 }),
                  (t = We(t)),
                  (t = r.parseMedia(t, e, null, [])),
                  sN(t, s)
                );
              throw new ee(2, 2, 2014, r);
            }
            ((d.fl = function (e, t) {
              ((this.ya.width = e), (this.ya.height = t));
            }),
              (d.kh = function (e) {
                if (this.m == $n) {
                  var t = this.l;
                  if (((e = e === void 0 ? 0.1 : e), t.l.g)) t = !1;
                  else if (t.F) t = !1;
                  else {
                    for (var r = I(t.h.values()), s = r.next(); !s.done; s = r.next())
                      ((s = s.value), !s.ce || s.Ka || s.qb || ((s.ce = !1), ni(t, s, e)));
                    t = !0;
                  }
                } else t = !1;
                return t;
              }),
              (d.Lg = function () {
                return (
                  He(
                    "Shaka Player's internal Manifest structure is NOT covered by semantic versioning compatibility guarantees.  It may change at any time!  Please consider filing a feature request for whatever you use getManifest() for.",
                  ),
                  this.i
                );
              }),
              (d.Qj = function () {
                return this.zc;
              }),
              (d.Lj = function () {
                var e = { video: null, audio: null, text: null };
                if (this.m != $n) return e;
                var t = this.l.o,
                  r = this.h.currentTime;
                t = I([t.video, t.audio, this.l.B]);
                for (var s = t.next(); !s.done; s = t.next())
                  if ((s = s.value) && s.segmentIndex) {
                    var a = s.segmentIndex.find(r);
                    ((a = s.segmentIndex.get(a)),
                      (a = {
                        codecs: a.codecs || s.codecs,
                        mimeType: a.mimeType || s.mimeType,
                        bandwidth: a.bandwidth || s.bandwidth,
                      }),
                      s.type == "video"
                        ? ((a.width = s.width), (a.height = s.height), (e.video = a))
                        : s.type == "audio"
                          ? (e.audio = a)
                          : s.type == nt && (e.text = a));
                  }
                return e;
              }));
            function jr(e) {
              var t = ll();
              return (
                (t.streaming.failureCallback = function (r) {
                  if (e.W()) {
                    var s = null;
                    (r.code == 1001 || r.code == 1002
                      ? ((s = 1), e.g.streaming.lowLatencyMode && (s = 0.1))
                      : r.code == 1003 && (s = 0.1),
                      s != null && ((r.severity = 1), e.kh(s)));
                  }
                }),
                (t.textDisplayFactory = function () {
                  if (e.Be) {
                    var r = e.h;
                    r = !(
                      r.webkitDisplayingFullscreen ||
                      (r.webkitPresentationMode && r.webkitPresentationMode != "inline")
                    );
                  } else r = !1;
                  return r
                    ? new Yn(e.h, e.Be)
                    : "track" in document.createElement("track")
                      ? new Tn(e)
                      : new zn();
                }),
                t
              );
            }
            d.Zi = function (e) {
              this.Be = e;
            };
            function HN(e, t) {
              for (var r = new Set(), s = I(t.textStreams), a = s.next(); !a.done; a = s.next())
                ((a = a.value),
                  (a.mimeType != "application/cea-608" && a.mimeType != "application/cea-708") ||
                    r.add(a.originalId));
              for (s = I(t.variants), a = s.next(); !a.done; a = s.next())
                if ((a = a.value.video) && a.closedCaptions) {
                  for (var c = I(a.closedCaptions.keys()), f = c.next(); !f.done; f = c.next())
                    if (((f = f.value), !r.has(f))) {
                      var g = f.startsWith("CC") ? "application/cea-608" : "application/cea-708",
                        m = new Qt(),
                        x = a.closedCaptions.get(f);
                      ((g = {
                        id: e.Fe++,
                        originalId: f,
                        groupId: null,
                        createSegmentIndex: function () {
                          return Promise.resolve();
                        },
                        segmentIndex: m,
                        mimeType: g,
                        codecs: "",
                        kind: "caption",
                        encrypted: !1,
                        drmInfos: [],
                        keyIds: new Set(),
                        language: x,
                        originalLanguage: x,
                        label: null,
                        type: nt,
                        primary: !1,
                        trickModeVideo: null,
                        dependencyStream: null,
                        emsgSchemeIdUris: null,
                        roles: a.roles,
                        forced: !1,
                        channelsCount: null,
                        audioSamplingRate: null,
                        spatialAudio: !1,
                        closedCaptions: null,
                        accessibilityPurpose: null,
                        external: !1,
                        fastSwitching: !1,
                        fullMimeTypes: new Set([tn(g, "")]),
                        isAudioMuxedInVideo: !1,
                        baseOriginalId: null,
                      }),
                        t.textStreams.push(g),
                        r.add(f));
                    }
                }
            }
            function KN(e, t) {
              var r, s, a, c, f;
              return W(function (g) {
                return g.g == 1
                  ? ((r = e.audio),
                    (s = e.video),
                    (a = function (m, x) {
                      var E, A, R;
                      return W(function (b) {
                        return b.g == 1
                          ? m
                            ? m.segmentIndex
                              ? b.A(2)
                              : _(b, m.createSegmentIndex(), 2)
                            : b.return(null)
                          : ((A = (E = m.segmentIndex.Xb(x)) ? E.next().value : null),
                            A ? ((R = A.startTime), b.return(R)) : b.return(null));
                      });
                    }),
                    _(g, a(r, t), 2))
                  : g.g != 3
                    ? ((c = g.h), _(g, a(s, t), 3))
                    : ((f = g.h),
                      f != null && c != null
                        ? g.return(Math.max(f, c))
                        : f != null
                          ? g.return(f)
                          : c != null
                            ? g.return(c)
                            : g.return(t));
              });
            }
            function cc(e) {
              var t = e.Rg();
              if (e.B && e.R && e.G) {
                if (e.g.streaming.rebufferingGoal == 0) {
                  var r = e.M;
                  ((r.j = !1), d0(r));
                } else ((r = e.M), (r.j = t), d0(r));
                if (
                  (e.K &&
                    ((r = e.K),
                    t || r.F || (r.F = !0),
                    r.F && t && ((r.I = !0), Xn(r, "ps", { dd: "r" })),
                    (r.J = t)),
                  J0(e),
                  (r = e.g.streaming.liveSync.dynamicTargetLatency.maxAttempts),
                  e.g.streaming.liveSync.dynamicTargetLatency.enabled && t && e.Ne < r)
                ) {
                  r = e.g.streaming.liveSync.dynamicTargetLatency.maxLatency;
                  var s = e.g.streaming.liveSync.targetLatencyTolerance,
                    a = e.g.streaming.liveSync.dynamicTargetLatency.rebufferIncrement;
                  e.V && (e.V = Math.min(e.V + ++e.Ne * a, r - s));
                }
              }
              ((t = new Map().set("buffering", t)), e.dispatchEvent(Pt("buffering", t)));
            }
            function lI(e, t) {
              (e.dc.Qa(),
                e.dc.D(e.h, "timeupdate", function () {
                  var r = e.h.currentTime,
                    s = e.Ra(),
                    a = e.W(),
                    c = a ? e.g.streaming.safeSeekOffset : 0;
                  t > 0
                    ? a && t > 1 && Math.floor(r) >= Math.floor(s.end) && e.Sd()
                    : Math.floor(r) <= Math.floor(s.start + c) && e.Sd();
                }));
            }
            function J0(e) {
              if (e.B && e.R) {
                var t = e.B.g,
                  r = "playing";
                e.R.g == Zo ? (r = "buffering") : e.ge() ? (r = "ended") : e.h.paused && (r = "paused");
                var s = r;
                if (t.g == null) ((t.g = { timestamp: Date.now() / 1e3, state: s, duration: 0 }), (t = !0));
                else {
                  var a = Date.now() / 1e3;
                  ((t.g.duration = a - t.g.timestamp),
                    t.g.state == s
                      ? (t = !1)
                      : (t.h.push(t.g), (t.g = { timestamp: a, state: s, duration: 0 }), (t = !0)));
                }
                t && ((r = new Map().set("newstate", r)), e.dispatchEvent(Pt("statechanged", r)));
              }
            }
            function uI(e) {
              var t = e.h.playbackRate,
                r = e.W();
              if (e.g.streaming.vodDynamicPlaybackRate && !r) {
                var s = e.g.streaming.vodDynamicPlaybackRateLowBufferRate,
                  a = e.ei();
                a <= e.g.streaming.vodDynamicPlaybackRateBufferRatio
                  ? t != s && e.xe(s, !1)
                  : a == 1 && t !== e.M.Tc() && e.Sd();
              }
              if (r && ((r = e.Ra()), Number.isFinite(r.end) && !(e.h.currentTime < r.start || e.h.paused))) {
                ((s = e.g.streaming.liveSync.targetLatencyTolerance),
                  (a = e.g.streaming.liveSync.dynamicTargetLatency.enabled));
                var c = e.g.streaming.liveSync.dynamicTargetLatency.stabilityThreshold;
                if (e.g.streaming.liveSync && e.g.streaming.liveSync.enabled)
                  var f = e.g.streaming.liveSync.targetLatency,
                    g = f + s,
                    m = Math.max(0, f - s),
                    x = e.g.streaming.liveSync.maxPlaybackRate,
                    E = e.g.streaming.liveSync.minPlaybackRate;
                else
                  e.i &&
                    e.i.serviceDescription &&
                    ((f = e.i.serviceDescription.targetLatency),
                    e.i.serviceDescription.targetLatency != null
                      ? (g = e.i.serviceDescription.targetLatency + s)
                      : e.i.serviceDescription.maxLatency != null && (g = e.i.serviceDescription.maxLatency),
                    e.i.serviceDescription.targetLatency != null
                      ? (m = Math.max(0, e.i.serviceDescription.targetLatency - s))
                      : e.i.serviceDescription.minLatency != null && (m = e.i.serviceDescription.minLatency),
                    (x = e.i.serviceDescription.maxPlaybackRate || e.g.streaming.liveSync.maxPlaybackRate),
                    (E = e.i.serviceDescription.minPlaybackRate || e.g.streaming.liveSync.minPlaybackRate));
                e.V || typeof f != "number" || (e.V = f);
                var A = e.g.streaming.liveSync.dynamicTargetLatency.maxAttempts;
                (a &&
                  e.cc &&
                  e.V !== null &&
                  typeof f == "number" &&
                  e.Ne < A &&
                  Date.now() - e.cc > c * 1e3 &&
                  ((c = e.g.streaming.liveSync.dynamicTargetLatency.minLatency),
                  (e.V = Math.max(e.V - (f - c) / 2, c + s)),
                  (e.cc = Date.now())),
                  a && e.V !== null && ((g = e.V + s), (m = e.V - s)),
                  (f = r.end - e.h.currentTime),
                  (s = 0),
                  e.m == Ui &&
                    ((a = e.h.buffered),
                    a.length > 0 && ((s = a.end(a.length - 1)), (s = Math.max(x, s - r.end)))),
                  (r = e.g.streaming.liveSync.panicMode),
                  (a = e.g.streaming.liveSync.panicThreshold * 1e3),
                  (c = Date.now() - e.R.i),
                  r && !E && (E = e.g.streaming.liveSync.minPlaybackRate),
                  r && E && c <= a
                    ? t != E && e.xe(E, !1)
                    : g != null && x && f - s > g
                      ? (t != x && e.xe(x, !1), (e.cc = null))
                      : m != null && E && f - s < m
                        ? (t != E && e.xe(E, !1), (e.cc = null))
                        : t !== e.M.Tc() && (e.Sd(), (e.cc = Date.now())));
              }
            }
            function gf(e) {
              if (e.h) {
                var t = function (a, c) {
                    return (K1(a, c, 0.01) || c > a) && e.ag < a ? ((e.ag = a), !0) : !1;
                  },
                  r = e.Ra();
                if (((r = r.end - r.start), (r = r > 0 ? e.h.currentTime / r : 0), !isNaN(r))) {
                  if (((r *= 100), t(0, r))) var s = Pt("started");
                  else
                    t(25, r)
                      ? (s = Pt("firstquartile"))
                      : t(50, r)
                        ? (s = Pt("midpoint"))
                        : t(75, r)
                          ? (s = Pt("thirdquartile"))
                          : ((t(100, r) || r > 100) && (s = Pt("complete")),
                            e.g && e.g.playRangeEnd != 1 / 0 && e.ge() && e.h.pause());
                  s && e.dispatchEvent(s);
                }
              }
            }
            function go(e) {
              try {
                tA(e.Ee, e.i);
              } catch (r) {
                return (hl(e, r), !1);
              }
              var t = fh(e.i.variants);
              return (
                (t = e.J.create(t)),
                (e = e.o.setVariants(Array.from(t.values()))),
                typeof e == "boolean" ? e : !0
              );
            }
            function cI(e, t) {
              if (((t = t === void 0 ? !1 : t), go(e))) {
                if (!e.g.abr.enabled) {
                  var r = e.J;
                  if (
                    (typeof r.getLastAdaptationSet != "function" &&
                      (ft(
                        "AdaptationSetCriteria w/o getLastAdaptationSet",
                        "Please use an AdaptationSetCriteria with getLastAdaptationSet.",
                      ),
                      (r.getLastAdaptationSet = function () {
                        return null;
                      })),
                    (r = r.getLastAdaptationSet()) && ((r = Array.from(r.values())), r.length))
                  ) {
                    var s = e.l.o;
                    if (
                      s &&
                      s.video &&
                      (r = r.find(function (a) {
                        return a.video == s.video;
                      }))
                    )
                      return r;
                  }
                }
                return e.o.chooseVariant(t);
              }
              return null;
            }
            function mo(e, t, r, s, a) {
              ((t = t === void 0 ? !0 : t),
                (r = r === void 0 ? 0 : r),
                (s = s === void 0 ? !1 : s),
                (a = a === void 0 ? !0 : a));
              var c = cI(e);
              c && dc(e, c, a, t, r, s);
            }
            function dc(e, t, r, s, a, c) {
              c = c === void 0 ? !1 : c;
              var f = e.l.o;
              if (t == f) s && n1(e.l, t, s, a, !0);
              else {
                var g = e.B.h;
                if (
                  (g.h != t &&
                    ((g.h = t),
                    g.g.push({
                      timestamp: Date.now() / 1e3,
                      id: t.id,
                      type: "variant",
                      fromAdaptation: r,
                      bandwidth: t.bandwidth,
                    })),
                  n1(e.l, t, s, a, c, r),
                  (s = null),
                  f && (s = qo(f)),
                  (f = qo(t)),
                  (f.active = !0),
                  e.T && ((a = e.T), (t = t.video)))
                ) {
                  switch ((t.dependencyStream && (t = t.dependencyStream), (c = 0), (g = -1), t.mimeType)) {
                    case "video/webm":
                      c = 1;
                      break;
                    case "video/mp4":
                      c = 2;
                  }
                  switch (e.ii()) {
                    case "DASH":
                      g = 1;
                      break;
                    case "HLS":
                      g = 0;
                  }
                  a.g &&
                    (a.g.setLevelSwitching(t.id, !0),
                    a.g.setContainerFormat(c),
                    a.j || a.g.setStreamingFormat(g));
                }
                (r
                  ? ((r = new Map().set("oldTrack", s).set("newTrack", f)),
                    (r = Pt("adaptation", r)),
                    aa(e, r))
                  : hI(e, s, f),
                  fI(e, s, f));
              }
            }
            function Z0(e, t) {
              var r = Array.from(e.h.audioTracks).find(function (a) {
                return a.enabled;
              });
              if (((t.enabled = !0), r)) {
                t.id !== r.id && (r.enabled = !1);
                var s = dI(e);
                ((r = hh(r, s)), (t = hh(t, s)), hI(e, r, t), fI(e, r, t));
              }
            }
            function dI(e) {
              return e.h && e.h.videoTracks
                ? Array.from(e.h.videoTracks).find(function (t) {
                    return t.selected;
                  })
                : null;
            }
            function ci(e) {
              var t = Pt("trackschanged");
              (aa(e, t), pI(e));
            }
            function hI(e, t, r) {
              ((t = new Map().set("oldTrack", t).set("newTrack", r)),
                (t = Pt("variantchanged", t)),
                aa(e, t));
            }
            function fI(e, t, r) {
              var s = !1;
              ((t && t.audioId == r.audioId && t.audioGroupId == r.audioGroupId) || (s = !0), s && pI(e));
            }
            function pI(e) {
              var t = Pt("audiotrackschanged");
              aa(e, t);
            }
            function ks(e) {
              var t = Pt("textchanged");
              aa(e, t);
            }
            function gI(e) {
              var t = Pt("texttrackvisibility");
              aa(e, t);
            }
            function mI(e) {
              e.g.abr.enabled || ey(e);
              var t = new Map().set("newStatus", e.g.abr.enabled);
              aa(e, Pt("abrstatuschanged", t));
            }
            function hc(e) {
              var t = e.Lc().find(function (r) {
                return r.active;
              });
              t && e.u && e.u.setTextLanguage && e.u.setTextLanguage(t.language);
            }
            function ey(e, t) {
              if (((t = t === void 0 ? !0 : t), e.m == $n)) {
                e.He.stop();
                for (var r = I(e.i.variants), s = r.next(); !s.done; s = r.next())
                  s.value.disabledUntilTime = 0;
                t && go(e);
              }
            }
            d.disableStream = function (e, t) {
              if (!this.g.abr.enabled || this.m === Rr || !navigator.onLine || t == 0 || !this.i) return !1;
              if (
                this.i.variants.some(function (g) {
                  var m = g[e.type];
                  return m && m.id !== e.id && !g.disabledUntilTime
                    ? e.type == "audio"
                      ? e.language === m.language
                      : !0
                    : !1;
                })
              ) {
                for (var r = !1, s = !1, a = I(this.i.variants), c = a.next(); !c.done; c = a.next()) {
                  c = c.value;
                  var f = c[e.type];
                  f &&
                    (f.id === e.id
                      ? ((c.disabledUntilTime = Date.now() / 1e3 + t), (r = !0))
                      : f.trickModeVideo && f.trickModeVideo.id == e.id && (s = !0));
                }
                return !r && s
                  ? !1
                  : (this.He.Ea(1),
                    (t = this.Gc().video.reduce(function (g, m) {
                      return g + m.end - m.start;
                    }, 0)),
                    mo(this, !1, t, !0, !1),
                    !0);
              }
              return !1;
            };
            function hl(e, t) {
              var r, s, a, c, f;
              return W(function (g) {
                switch (g.g) {
                  case 1:
                    if (e.m == Rr) return g.return();
                    if (
                      (t.severity === 1 && e.B.M++,
                      (r = !0),
                      !(e.Ua && e.i && e.l) ||
                        (t.code != 3016 &&
                          t.code != 3014 &&
                          t.code != 3015 &&
                          t.code != 3024 &&
                          t.code != 3018))
                    ) {
                      g.A(2);
                      break;
                    }
                    return (
                      (s = tt()),
                      s.Ha() === "WEBKIT" && t.code == 3016 ? g.return() : (q(g, 3), _(g, Hh(e.l), 5))
                    );
                  case 5:
                    ((a = g.h),
                      (r = !a),
                      a && ((c = Pt("mediasourcerecovered")), e.dispatchEvent(c)),
                      he(g, 2));
                    break;
                  case 3:
                    (ae(g), (r = !0));
                  case 2:
                    if (!r) return g.return();
                    (t.severity === 2 && ey(e, !1),
                      (f = Pt("error", new Map().set("detail", t))),
                      e.dispatchEvent(f),
                      f.defaultPrevented && (t.handled = !0),
                      K(g));
                }
              });
            }
            d.addFont = function (e, t) {
              return L2(e, t);
            };
            function fc(e, t, r, s) {
              ((s = s === void 0 ? e : s),
                (e = new Map().set("detail", {
                  schemeIdUri: r.schemeIdUri,
                  value: r.value,
                  startTime: r.startTime,
                  endTime: r.endTime,
                  id: r.id,
                  timescale: r.timescale,
                  eventElement: r.eventElement,
                  eventNode: r.eventNode,
                })),
                s.dispatchEvent(Pt(t, e)));
            }
            function yI(e, t, r, s) {
              ((s = s === void 0 ? !1 : s),
                (t = new Map()
                  .set("mediaQuality", {
                    bandwidth: t.bandwidth,
                    audioSamplingRate: t.audioSamplingRate,
                    codecs: t.codecs,
                    contentType: t.contentType,
                    frameRate: t.frameRate,
                    height: t.height,
                    mimeType: t.mimeType,
                    channelsCount: t.channelsCount,
                    pixelAspectRatio: t.pixelAspectRatio,
                    width: t.width,
                    label: t.label,
                    roles: t.roles,
                    language: t.language,
                  })
                  .set("position", r)),
                e.dispatchEvent(Pt(s ? "audiotrackchanged" : "mediaqualitychanged", t)));
            }
            function ty(e, t) {
              if (((t = t === void 0 ? !0 : t), !e.h.error)) return t ? new ee(2, 3, 3016) : null;
              var r = e.h.error.code;
              return !t && r == 1
                ? null
                : ((t = e.h.error.msExtendedCode) && (t < 0 && (t += 4294967296), (t = t.toString(16))),
                  new ee(2, 3, 3016, r, t, e.h.error.message));
            }
            function WN(e, t) {
              var r = Pt("keystatuschanged");
              e.dispatchEvent(r);
              var s = Object.keys(t);
              s.length == 1 && s[0] == "" && ((s = ["00"]), (t = { "00": t[""] }));
              var a = s.length == 1 && s[0] == "00";
              if (((r = !1), s.length)) {
                s = e.keySystem();
                for (
                  var c = Wa(e.g.drm.clearKeys),
                    f = function (D, M) {
                      ((D.allowedByKeySystem = !0), (M = I(M)));
                      for (var P = M.next(); !P.done; P = M.next())
                        ((P = P.value),
                          ((P = t[a ? "00" : P]) || e.F.H) &&
                            (D.allowedByKeySystem = D.allowedByKeySystem && !!P && !nA.includes(P)));
                    },
                    g = I(e.i.variants),
                    m = g.next();
                  !m.done;
                  m = g.next()
                ) {
                  m = m.value;
                  var x = kP(m);
                  x = I(x);
                  for (var E = x.next(); !E.done; E = x.next()) {
                    E = E.value;
                    var A = m.allowedByKeySystem;
                    if (E.keyIds.size)
                      if (E.drmInfos.length && !c.size && e.i.type == "HLS")
                        for (var R = I(E.drmInfos), b = R.next(); !b.done; b = R.next())
                          ((b = b.value),
                            b.keySystem == s && (b.keyIds.size ? f(m, b.keyIds) : f(m, E.keyIds)));
                      else f(m, E.keyIds);
                    A != m.allowedByKeySystem && (r = !0);
                  }
                }
              }
              r && (ci(e), (r = e.l.o) && !r.allowedByKeySystem ? mo(e) : go(e));
            }
            function ny(e, t, r) {
              (t > 0 && (e.W() || e.Yi(t)), (t = e.getDuration()), r < t && (e.W() || e.Ab(r)));
            }
            function aa(e, t) {
              W(function (r) {
                if (r.g == 1) return _(r, Promise.resolve(), 2);
                (e.m != Rr && e.dispatchEvent(t), K(r));
              });
            }
            function vI(e) {
              var t = new Set();
              e = I(e);
              for (var r = e.next(); !r.done; r = e.next())
                ((r = r.value), r.language ? t.add(At(r.language)) : t.add("und"));
              return t;
            }
            function xI(e) {
              for (var t = new Map(), r = new Map(), s = 0; s < e.length; s++) {
                var a = e[s],
                  c = "und",
                  f = [];
                (a.language && (c = At(a.language)),
                  a.type == "variant" ? (f = a.audioRoles) : (f = a.roles),
                  (f && f.length) || (f = [""]),
                  t.has(c) || t.set(c, new Set()),
                  (f = I(f)));
                for (var g = f.next(); !g.done; g = f.next())
                  ((g = g.value),
                    t.get(c).add(g),
                    a.label && (r.has(c) || r.set(c, new Map()), r.get(c).set(g, a.label)));
              }
              var m = [];
              return (
                t.forEach(function (x, E) {
                  x = I(x);
                  for (var A = x.next(); !A.done; A = x.next()) {
                    A = A.value;
                    var R = null;
                    (r.has(E) && r.get(E).has(A) && (R = r.get(E).get(A)),
                      m.push({ language: E, role: A, label: R }));
                  }
                }),
                m
              );
            }
            ((d.xa = function () {
              return this.h && this.h.remote ? this.h.remote.state != "disconnected" : !1;
            }),
              (d.ge = function () {
                return !this.h || this.h.ended
                  ? !0
                  : this.Ua && !this.W() && this.h.currentTime >= this.Ra().end;
              }),
              Ee("shaka.Player", de),
              (de.prototype.isEnded = de.prototype.ge),
              (de.prototype.isRemotePlayback = de.prototype.xa),
              (de.prototype.addFont = de.prototype.addFont),
              (de.prototype.setVideoContainer = de.prototype.Zi),
              (de.prototype.getFetchedPlaybackInfo = de.prototype.Lj),
              (de.prototype.getManifestParserFactory = de.prototype.Qj),
              (de.prototype.getManifest = de.prototype.Lg),
              (de.prototype.retryStreaming = de.prototype.kh),
              (de.prototype.setMaxHardwareResolution = de.prototype.fl),
              (de.prototype.addChaptersTrack = de.prototype.Oe),
              (de.prototype.addThumbnailsTrack = de.prototype.Pe),
              (de.prototype.addTextTrackAsync = de.prototype.Rd),
              (de.prototype.getStats = de.prototype.getStats),
              (de.prototype.getBufferedInfo = de.prototype.Gc),
              (de.prototype.getSegmentAvailabilityDuration = de.prototype.df),
              (de.prototype.getPresentationStartTimeAsDate = de.prototype.li),
              (de.prototype.getPlayheadTimeAsDate = de.prototype.Tj),
              (de.prototype.setTextTrackVisibility = de.prototype.wh),
              (de.prototype.getChaptersAsync = de.prototype.Gj),
              (de.prototype.getChapters = de.prototype.Fj),
              (de.prototype.getChaptersTracks = de.prototype.Hj),
              (de.prototype.isTextTrackVisible = de.prototype.Sg),
              (de.prototype.selectVariantsByLabel = de.prototype.Xk),
              (de.prototype.selectTextLanguage = de.prototype.oh),
              (de.prototype.selectAudioLanguage = de.prototype.Ti),
              (de.prototype.getTextLanguages = de.prototype.Zj),
              (de.prototype.getAudioLanguages = de.prototype.Cj),
              (de.prototype.getTextLanguagesAndRoles = de.prototype.$j),
              (de.prototype.getAudioLanguagesAndRoles = de.prototype.Dj),
              (de.prototype.getVideoTracks = de.prototype.getVideoTracks),
              (de.prototype.selectVideoTrack = de.prototype.Yk),
              (de.prototype.getAudioTracks = de.prototype.getAudioTracks),
              (de.prototype.selectAudioTrack = de.prototype.Wk),
              (de.prototype.selectVariantTrack = de.prototype.Jf),
              (de.prototype.selectTextTrack = de.prototype.ph),
              (de.prototype.getThumbnails = de.prototype.ck),
              (de.prototype.getAllThumbnails = de.prototype.Bj),
              (de.prototype.getImageTracks = de.prototype.Nj),
              (de.prototype.getTextTracks = de.prototype.Lc),
              (de.prototype.getVariantTracks = de.prototype.qc),
              (de.prototype.cancelTrickPlay = de.prototype.Sd),
              (de.prototype.trickPlay = de.prototype.xe),
              (de.prototype.useTrickPlayTrackIfAvailable = de.prototype.Kh),
              (de.prototype.getPlaybackRate = de.prototype.Ob),
              (de.prototype.isBuffering = de.prototype.Rg),
              (de.prototype.getKeyStatuses = de.prototype.$e),
              (de.prototype.getActiveSessionsMetadata = de.prototype.Kg),
              (de.prototype.getExpiration = de.prototype.Zd),
              (de.prototype.drmInfo = de.prototype.drmInfo),
              (de.prototype.keySystem = de.prototype.keySystem),
              (de.prototype.isFullyLoaded = de.prototype.nk),
              (de.prototype.goToLive = de.prototype.ik),
              (de.prototype.seekRange = de.prototype.Ra),
              (de.prototype.isVideoOnly = de.prototype.ti),
              (de.prototype.isAudioOnly = de.prototype.lk),
              (de.prototype.isInProgress = de.prototype.Vc),
              (de.prototype.isLive = de.prototype.W),
              (de.prototype.getQueueManager = de.prototype.mi),
              (de.prototype.getAdManager = de.prototype.di),
              (de.prototype.getAssetUri = de.prototype.rd),
              (de.prototype.getNetworkingEngine = de.prototype.Yb),
              (de.prototype.getMediaElement = de.prototype.bf),
              (de.prototype.getManifestType = de.prototype.ii),
              (de.prototype.getLoadMode = de.prototype.$d),
              (de.prototype.resetConfiguration = de.prototype.Oi),
              (de.prototype.getBufferFullness = de.prototype.ei),
              (de.prototype.getNonDefaultConfiguration = de.prototype.ki),
              (de.prototype.getConfigurationForLowLatency = de.prototype.Ij),
              (de.prototype.getConfiguration = de.prototype.getConfiguration),
              (de.prototype.configurationForLowLatency = de.prototype.yj),
              (de.prototype.configure = de.prototype.configure),
              (de.prototype.releaseAllMutexes = de.prototype.Ok),
              (de.prototype.destroyAllPreloads = de.prototype.rg),
              (de.prototype.preload = de.prototype.preload),
              (de.prototype.detachAndSavePreload = de.prototype.$h),
              (de.prototype.unloadAndSavePreload = de.prototype.jj),
              (de.prototype.load = de.prototype.load),
              (de.prototype.updateStartTime = de.prototype.ql),
              (de.prototype.unload = de.prototype.Cc),
              (de.prototype.detach = de.prototype.detach),
              (de.prototype.attachCanvas = de.prototype.qj),
              (de.prototype.attach = de.prototype.Vb),
              (de.probeSupport = function (e) {
                e = e === void 0 ? !0 : e;
                var t, r, s, a, c, f, g;
                return W(function (m) {
                  switch (m.g) {
                    case 1:
                      if (((t = {}), !e)) {
                        m.A(2);
                        break;
                      }
                      return _(m, ZP(), 3);
                    case 3:
                      t = m.h;
                    case 2:
                      return ((r = dP()), (s = O2()), (a = tt()), _(m, a.lc(), 4));
                    case 4:
                      return (
                        (c = m.h),
                        (f = { manifest: r, media: s, drm: t, hardwareResolution: c }),
                        (g = SI),
                        g.forEach(function (x, E) {
                          f[E] = x();
                        }),
                        m.return(f)
                      );
                  }
                });
              }),
              (de.isBrowserSupported = function () {
                return (
                  l.Promise || He("A Promise implementation or polyfill is required"),
                  !(l.Promise && l.Uint8Array && Array.prototype.forEach) ||
                  (navigator.userAgent || "").includes("Trident/")
                    ? !1
                    : (tt(), es() ? !0 : na().canPlayType("application/x-mpegurl") != "")
                );
              }),
              (de.setQueueManagerFactory = function (e) {
                vf = e;
              }),
              (de.setAdManagerFactory = function (e) {
                yf = e;
              }),
              (de.registerSupportPlugin = W1),
              (de.prototype.destroy = de.prototype.destroy));
            var Rr = 0,
              mf = 1,
              $n = 2,
              Ui = 3;
            ((de.LoadMode = { DESTROYED: Rr, NOT_LOADED: mf, MEDIA_SOURCE: $n, SRC_EQUALS: Ui }),
              (de.version = "v4.16.12"));
            var TI = ["4", "16"];
            kS = new (function (e) {
              ((this.g = e), (this.i = iP), (this.h = rP));
            })(new lm(Number(TI[0]), Number(TI[1])));
            var SI = new Map(),
              yf = null,
              vf = null;
            function EI() {
              ((this.g = []), (this.i = this.m = this.l = this.j = this.h = 0));
            }
            function zN(e) {
              return e.g.length
                ? e.g.reduce(function (t, r) {
                    return t + r;
                  }, 0) / e.g.length
                : 0;
            }
            function $e(e, t, r) {
              var s = this;
              ((this.g = e),
                (this.h = t),
                (this.m = r),
                (this.i = !1),
                (this.j = this.h.getVolume()),
                (this.l = new gt()),
                this.l.D(this.h, google.ima.AdEvent.Type.PAUSED, function () {
                  s.i = !0;
                }),
                this.l.D(this.h, google.ima.AdEvent.Type.RESUMED, function () {
                  s.i = !1;
                }));
            }
            ((d = $e.prototype),
              (d.needsSkipUI = function () {
                return !1;
              }),
              (d.isClientRendering = function () {
                return !0;
              }),
              (d.hasCustomClick = function () {
                return !0;
              }),
              (d.isUsingAnotherMediaElement = function () {
                return !0;
              }),
              (d.getDuration = function () {
                return this.g.getDuration();
              }),
              (d.getMinSuggestedDuration = function () {
                return this.g.getMinSuggestedDuration();
              }),
              (d.getRemainingTime = function () {
                return this.h.getRemainingTime();
              }),
              (d.isPaused = function () {
                return this.i;
              }),
              (d.isSkippable = function () {
                return this.g.getSkipTimeOffset() >= 0;
              }),
              (d.getTimeUntilSkippable = function () {
                var e = this.g.getSkipTimeOffset();
                return ((e = this.getRemainingTime() - e), Math.max(e, 0));
              }),
              (d.canSkipNow = function () {
                return this.h.getAdSkippableState();
              }),
              (d.skip = function () {
                return this.h.skip();
              }),
              (d.pause = function () {
                return this.h.pause();
              }),
              (d.play = function () {
                return this.h.resume();
              }),
              (d.getVolume = function () {
                return this.h.getVolume();
              }),
              (d.setVolume = function (e) {
                return ((this.m.volume = e), this.h.setVolume(e));
              }),
              (d.isMuted = function () {
                return this.h.getVolume() == 0;
              }),
              (d.isLinear = function () {
                return this.g.isLinear();
              }),
              (d.resize = function (e, t) {
                this.h.resize(e, t);
              }),
              (d.setMuted = function (e) {
                (this.m.muted = e)
                  ? ((this.j = this.getVolume()), this.h.setVolume(0))
                  : this.h.setVolume(this.j);
              }),
              (d.getSequenceLength = function () {
                var e = this.g.getAdPodInfo();
                return e == null ? 1 : e.getTotalAds();
              }),
              (d.getPositionInSequence = function () {
                var e = this.g.getAdPodInfo();
                return e == null ? 1 : e.getAdPosition();
              }),
              (d.getTitle = function () {
                return this.g.getTitle();
              }),
              (d.getDescription = function () {
                return this.g.getDescription();
              }),
              (d.getVastMediaBitrate = function () {
                return this.g.getVastMediaBitrate();
              }),
              (d.getVastMediaHeight = function () {
                return this.g.getVastMediaHeight();
              }),
              (d.getVastMediaWidth = function () {
                return this.g.getVastMediaWidth();
              }),
              (d.getVastAdId = function () {
                return "";
              }),
              (d.getAdId = function () {
                return this.g.getAdId();
              }),
              (d.getCreativeAdId = function () {
                return this.g.getCreativeAdId();
              }),
              (d.getAdvertiserName = function () {
                return this.g.getAdvertiserName();
              }),
              (d.getMediaUrl = function () {
                return this.g.getMediaUrl();
              }),
              (d.getTimeOffset = function () {
                var e = this.g.getAdPodInfo();
                return e == null ? 0 : e.getTimeOffset();
              }),
              (d.getPodIndex = function () {
                var e = this.g.getAdPodInfo();
                return e == null ? 0 : e.getPodIndex();
              }),
              (d.release = function () {
                this.h = this.g = null;
              }),
              Ee("shaka.ads.ClientSideAd", $e),
              ($e.prototype.release = $e.prototype.release),
              ($e.prototype.getPodIndex = $e.prototype.getPodIndex),
              ($e.prototype.getTimeOffset = $e.prototype.getTimeOffset),
              ($e.prototype.getMediaUrl = $e.prototype.getMediaUrl),
              ($e.prototype.getAdvertiserName = $e.prototype.getAdvertiserName),
              ($e.prototype.getCreativeAdId = $e.prototype.getCreativeAdId),
              ($e.prototype.getAdId = $e.prototype.getAdId),
              ($e.prototype.getVastAdId = $e.prototype.getVastAdId),
              ($e.prototype.getVastMediaWidth = $e.prototype.getVastMediaWidth),
              ($e.prototype.getVastMediaHeight = $e.prototype.getVastMediaHeight),
              ($e.prototype.getVastMediaBitrate = $e.prototype.getVastMediaBitrate),
              ($e.prototype.getDescription = $e.prototype.getDescription),
              ($e.prototype.getTitle = $e.prototype.getTitle),
              ($e.prototype.getPositionInSequence = $e.prototype.getPositionInSequence),
              ($e.prototype.getSequenceLength = $e.prototype.getSequenceLength),
              ($e.prototype.setMuted = $e.prototype.setMuted),
              ($e.prototype.resize = $e.prototype.resize),
              ($e.prototype.isLinear = $e.prototype.isLinear),
              ($e.prototype.isMuted = $e.prototype.isMuted),
              ($e.prototype.setVolume = $e.prototype.setVolume),
              ($e.prototype.getVolume = $e.prototype.getVolume),
              ($e.prototype.play = $e.prototype.play),
              ($e.prototype.pause = $e.prototype.pause),
              ($e.prototype.skip = $e.prototype.skip),
              ($e.prototype.canSkipNow = $e.prototype.canSkipNow),
              ($e.prototype.getTimeUntilSkippable = $e.prototype.getTimeUntilSkippable),
              ($e.prototype.isSkippable = $e.prototype.isSkippable),
              ($e.prototype.isPaused = $e.prototype.isPaused),
              ($e.prototype.getRemainingTime = $e.prototype.getRemainingTime),
              ($e.prototype.getMinSuggestedDuration = $e.prototype.getMinSuggestedDuration),
              ($e.prototype.getDuration = $e.prototype.getDuration),
              ($e.prototype.isUsingAnotherMediaElement = $e.prototype.isUsingAnotherMediaElement),
              ($e.prototype.hasCustomClick = $e.prototype.hasCustomClick),
              ($e.prototype.isClientRendering = $e.prototype.isClientRendering),
              ($e.prototype.needsSkipUI = $e.prototype.needsSkipUI));
            function Ht() {}
            function AI(e, t) {
              var r = [];
              e = I(Rt(e, "Ad"));
              for (var s = e.next(); !s.done; s = e.next())
                if ((s = jt(s.value, "InLine")) && (s = jt(s, "Creatives"))) {
                  s = I(Rt(s, "Creative"));
                  for (var a = s.next(); !a.done; a = s.next()) {
                    a = a.value;
                    var c = jt(a, "Linear");
                    if ((c && YN(r, t, c), (a = jt(a, "NonLinearAds")))) {
                      ((a = Rt(a, "NonLinear")), (a = I(a)));
                      for (var f = a.next(); !f.done; f = a.next())
                        e: {
                          c = r;
                          var g = t,
                            m = f.value,
                            x = jt(m, "StaticResource");
                          if (x) f = x.attributes.creativeType;
                          else {
                            if (((x = jt(m, "HTMLResource")), !x)) break e;
                            f = "text/html";
                          }
                          if ((x = ui(x))) {
                            f === "text/html" &&
                              (x = "data:text/html;charset=UTF-8," + encodeURIComponent(x));
                            var E = ze(m, "width", Nn) || ze(m, "expandedWidth", Nn),
                              A = ze(m, "height", Nn) || ze(m, "expandedHeight", Nn);
                            if (E || A) {
                              var R = null,
                                b = jt(m, "NonLinearClickThrough");
                              (b && (b = ui(b)) && (R = b),
                                (b = null),
                                (m = m.attributes.minSuggestedDuration) && (b = Fa(m)),
                                (m = 0),
                                g != null && (m = g),
                                c.push({
                                  id: null,
                                  groupId: null,
                                  startTime: m,
                                  endTime: null,
                                  uri: x,
                                  mimeType: f,
                                  isSkippable: !1,
                                  skipOffset: null,
                                  skipFor: null,
                                  canJump: !1,
                                  resumeOffset: 0,
                                  playoutLimit: b,
                                  once: !0,
                                  pre: g == null,
                                  post: g == 1 / 0,
                                  timelineRange: !1,
                                  loop: !1,
                                  overlay: {
                                    viewport: { x: 0, y: 0 },
                                    topLeft: { x: 0, y: 0 },
                                    size: { x: E || 0, y: A || 0 },
                                  },
                                  displayOnBackground: !1,
                                  currentVideo: null,
                                  background: null,
                                  clickThroughUrl: R,
                                }));
                            }
                          }
                        }
                    }
                  }
                }
              return r;
            }
            function YN(e, t, r) {
              var s = 0;
              t != null && (s = t);
              var a = null;
              r.attributes.skipoffset && ((a = Fa(r.attributes.skipoffset)), isNaN(a) && (a = null));
              var c = jt(r, "MediaFiles");
              if (c) {
                var f = null;
                for (
                  (r = jt(r, "VideoClicks")) && (r = jt(r, "ClickThrough")) && (r = ui(r)) && (f = r),
                    c = r = Rt(c, "MediaFile"),
                    r = r.filter(function (m) {
                      return m.attributes.delivery == "streaming";
                    }),
                    r.length && (c = r),
                    c = c.sort(function (m, x) {
                      return (
                        (parseInt(x.attributes.height, 10) || 0) - (parseInt(m.attributes.height, 10) || 0)
                      );
                    }),
                    c = I(c),
                    r = c.next();
                  !r.done;
                  r = c.next()
                )
                  if (((r = r.value), !r.attributes.apiFramework)) {
                    var g = ui(r);
                    if (g) {
                      e.push({
                        id: null,
                        groupId: null,
                        startTime: s,
                        endTime: null,
                        uri: g,
                        mimeType: r.attributes.type || null,
                        isSkippable: a != null,
                        skipOffset: a,
                        skipFor: null,
                        canJump: !1,
                        resumeOffset: 0,
                        playoutLimit: null,
                        once: !0,
                        pre: t == null,
                        post: t == 1 / 0,
                        timelineRange: !1,
                        loop: !1,
                        overlay: null,
                        displayOnBackground: !1,
                        currentVideo: null,
                        background: null,
                        clickThroughUrl: f,
                      });
                      break;
                    }
                  }
              }
            }
            function XN(e) {
              var t = [];
              e = I(Rt(e, "vmap:AdBreak"));
              for (var r = e.next(); !r.done; r = e.next()) {
                var s = r.value,
                  a = s.attributes.timeOffset;
                a &&
                  ((r = null),
                  a == "start" ? (r = null) : a == "end" ? (r = 1 / 0) : (r = Fa(a)),
                  (s = jt(s, "vmap:AdSource")) &&
                    (s = jt(s, "vmap:AdTagURI")) &&
                    (s = cn(s)) &&
                    t.push({ time: r, uri: s }));
              }
              return t;
            }
            (Ee("shaka.ads.Utils", Ht),
              (Ht.ADS_LOADED = "ads-loaded"),
              (Ht.AD_STARTED = "ad-started"),
              (Ht.AD_FIRST_QUARTILE = "ad-first-quartile"),
              (Ht.AD_MIDPOINT = "ad-midpoint"),
              (Ht.AD_THIRD_QUARTILE = "ad-third-quartile"),
              (Ht.AD_COMPLETE = "ad-complete"),
              (Ht.AD_STOPPED = "ad-stopped"),
              (Ht.AD_SKIPPED = "ad-skipped"),
              (Ht.AD_VOLUME_CHANGED = "ad-volume-changed"),
              (Ht.AD_MUTED = "ad-muted"),
              (Ht.AD_PAUSED = "ad-paused"),
              (Ht.AD_RESUMED = "ad-resumed"),
              (Ht.AD_SKIP_STATE_CHANGED = "ad-skip-state-changed"),
              (Ht.CUEPOINTS_CHANGED = "ad-cue-points-changed"),
              (Ht.IMA_AD_MANAGER_LOADED = "ima-ad-manager-loaded"),
              (Ht.IMA_STREAM_MANAGER_LOADED = "ima-stream-manager-loaded"),
              (Ht.AD_CLICKED = "ad-clicked"),
              (Ht.AD_PROGRESS = "ad-progress"),
              (Ht.AD_BUFFERING = "ad-buffering"),
              (Ht.AD_IMPRESSION = "ad-impression"),
              (Ht.AD_DURATION_CHANGED = "ad-duration-changed"),
              (Ht.AD_CLOSED = "ad-closed"),
              (Ht.AD_LOADED = "ad-loaded"),
              (Ht.ALL_ADS_COMPLETED = "all-ads-completed"),
              (Ht.AD_LINEAR_CHANGED = "ad-linear-changed"),
              (Ht.AD_METADATA = "ad-metadata"),
              (Ht.AD_RECOVERABLE_ERROR = "ad-recoverable-error"),
              (Ht.AD_ERROR = "ad-error"),
              (Ht.AD_BREAK_READY = "ad-break-ready"),
              (Ht.AD_INTERACTION = "ad-interaction"),
              (Ht.AD_CONTENT_PAUSE_REQUESTED = "ad-content-pause-requested"),
              (Ht.AD_CONTENT_RESUME_REQUESTED = "ad-content-resume-requested"),
              (Ht.AD_CONTENT_ATTACH_REQUESTED = "ad-content-attach-requested"));
            function xf(e, t, r, s, a) {
              var c = this;
              ((this.u = e),
                (this.i = t),
                (this.G = !1),
                (this.B = this.o = null),
                (this.H = NaN),
                (this.l = a),
                (this.j = null),
                (this.h = new gt()),
                google.ima.settings.setLocale(r),
                google.ima.settings.setDisableCustomPlaybackForIOS10Plus(!0),
                (this.F = new google.ima.AdDisplayContainer(this.u, this.i)),
                this.F.initialize(),
                (this.m = new google.ima.AdsLoader(this.F)),
                this.m.getSettings().setPlayerType("shaka-player"),
                this.m.getSettings().setPlayerVersion("v4.16.12"),
                (this.g = null),
                (this.C = s || new google.ima.AdsRenderingSettings()),
                this.h.D(this.m, google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED, function (f) {
                  qN(c, f);
                }),
                this.h.D(this.m, google.ima.AdErrorEvent.Type.AD_ERROR, function (f) {
                  II(c, f);
                }),
                this.h.D(this.i, "ended", function () {
                  c.m.contentComplete();
                }),
                this.h.Aa(this.i, "play", function () {
                  c.G = !0;
                }));
            }
            ((xf.prototype.configure = function (e) {
              this.o = e;
            }),
              (xf.prototype.stop = function () {
                (this.g && this.g.stop(), this.u && zu(this.u));
              }),
              (xf.prototype.release = function () {
                (this.stop(),
                  this.B && this.B.disconnect(),
                  this.h && this.h.release(),
                  this.g && this.g.destroy(),
                  this.m.destroy(),
                  this.F.destroy());
              }));
            function II(e, t) {
              (t.getError(),
                (t = new Map().set("originalEvent", t)),
                e.l(new Me("ad-error", t)),
                Tf(e, null),
                e.l(new Me("ad-cue-points-changed", new Map().set("cuepoints", []))));
            }
            function qN(e, t) {
              if (
                (e.l(new Me("ads-loaded", new Map().set("loadTime", Date.now() / 1e3 - e.H))),
                e.o.customPlayheadTracker)
              ) {
                var r = { currentTime: e.i.currentTime };
                ((e.g = t.getAdsManager(r, e.C)),
                  e.i.muted ? e.g.setVolume(0) : e.g.setVolume(e.i.volume),
                  e.h.D(e.i, "timeupdate", function () {
                    e.i.duration && (r.currentTime = e.i.currentTime);
                  }),
                  e.h.D(e.i, "volumechange", function () {
                    e.j && (e.j.setVolume(e.i.volume), e.i.muted && e.j.setMuted(!0));
                  }));
              } else e.g = t.getAdsManager(e.i, e.C);
              e.l(new Me("ima-ad-manager-loaded", new Map().set("imaAdManager", e.g)));
              var s = e.g.getCuePoints();
              if (s.length) {
                ((t = []), (s = I(s)));
                for (var a = s.next(); !a.done; a = s.next()) t.push({ start: a.value, end: null });
                e.l(new Me("ad-cue-points-changed", new Map().set("cuepoints", t)));
              }
              QN(e);
              try {
                (e.g.init(e.i.offsetWidth, e.i.offsetHeight),
                  e.h.D(e.i, "loadeddata", function () {
                    e.g.resize(e.i.offsetWidth, e.i.offsetHeight);
                  }),
                  "ResizeObserver" in l
                    ? ((e.B = new ResizeObserver(function () {
                        e.g.resize(e.i.offsetWidth, e.i.offsetHeight);
                      })),
                      e.B.observe(e.i))
                    : e.h.D(document, "fullscreenchange", function () {
                        e.g.resize(e.i.offsetWidth, e.i.offsetHeight);
                      }),
                  e.G || e.o.skipPlayDetection
                    ? e.g.start()
                    : e.h.Aa(e.i, "play", function () {
                        ((e.G = !0), e.g.start());
                      }));
              } catch (c) {
                Tf(e, null);
              }
            }
            function QN(e) {
              function t(r, s) {
                ((r = new Map().set("originalEvent", r)), e.l(new Me(s, r)));
              }
              (e.h.D(e.g, google.ima.AdErrorEvent.Type.AD_ERROR, function (r) {
                II(e, r);
              }),
                e.h.D(e.g, google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED, function (r) {
                  wI(e, r);
                }),
                e.h.D(e.g, google.ima.AdEvent.Type.STARTED, function (r) {
                  wI(e, r);
                }),
                e.h.D(e.g, google.ima.AdEvent.Type.FIRST_QUARTILE, function (r) {
                  t(r, "ad-first-quartile");
                }),
                e.h.D(e.g, google.ima.AdEvent.Type.MIDPOINT, function (r) {
                  t(r, "ad-midpoint");
                }),
                e.h.D(e.g, google.ima.AdEvent.Type.THIRD_QUARTILE, function (r) {
                  t(r, "ad-third-quartile");
                }),
                e.h.D(e.g, google.ima.AdEvent.Type.COMPLETE, function (r) {
                  t(r, "ad-complete");
                }),
                e.h.D(e.g, google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED, function (r) {
                  Tf(e, r);
                }),
                e.h.D(e.g, google.ima.AdEvent.Type.ALL_ADS_COMPLETED, function (r) {
                  (t(r, "all-ads-completed"), Tf(e, r));
                }),
                e.h.D(e.g, google.ima.AdEvent.Type.SKIPPED, function (r) {
                  t(r, "ad-skipped");
                }),
                e.h.D(e.g, google.ima.AdEvent.Type.VOLUME_CHANGED, function (r) {
                  t(r, "ad-volume-changed");
                }),
                e.h.D(e.g, google.ima.AdEvent.Type.VOLUME_MUTED, function (r) {
                  t(r, "ad-muted");
                }),
                e.h.D(e.g, google.ima.AdEvent.Type.PAUSED, function (r) {
                  e.j && ((e.j.i = !0), t(r, "ad-paused"));
                }),
                e.h.D(e.g, google.ima.AdEvent.Type.RESUMED, function (r) {
                  e.j && ((e.j.i = !1), t(r, "ad-resumed"));
                }),
                e.h.D(e.g, google.ima.AdEvent.Type.SKIPPABLE_STATE_CHANGED, function (r) {
                  e.j && t(r, "ad-skip-state-changed");
                }),
                e.h.D(e.g, google.ima.AdEvent.Type.CLICK, function (r) {
                  t(r, "ad-clicked");
                }),
                e.h.D(e.g, google.ima.AdEvent.Type.AD_PROGRESS, function (r) {
                  t(r, "ad-progress");
                }),
                e.h.D(e.g, google.ima.AdEvent.Type.AD_BUFFERING, function (r) {
                  t(r, "ad-buffering");
                }),
                e.h.D(e.g, google.ima.AdEvent.Type.IMPRESSION, function (r) {
                  t(r, "ad-impression");
                }),
                e.h.D(e.g, google.ima.AdEvent.Type.DURATION_CHANGE, function (r) {
                  t(r, "ad-duration-changed");
                }),
                e.h.D(e.g, google.ima.AdEvent.Type.USER_CLOSE, function (r) {
                  t(r, "ad-closed");
                }),
                e.h.D(e.g, google.ima.AdEvent.Type.LOADED, function (r) {
                  t(r, "ad-loaded");
                }),
                e.h.D(e.g, google.ima.AdEvent.Type.LINEAR_CHANGED, function (r) {
                  t(r, "ad-linear-changed");
                }),
                e.h.D(e.g, google.ima.AdEvent.Type.AD_METADATA, function (r) {
                  t(r, "ad-metadata");
                }),
                e.h.D(e.g, google.ima.AdEvent.Type.LOG, function (r) {
                  t(r, "ad-recoverable-error");
                }),
                e.h.D(e.g, google.ima.AdEvent.Type.AD_BREAK_READY, function (r) {
                  t(r, "ad-break-ready");
                }),
                e.h.D(e.g, google.ima.AdEvent.Type.INTERACTION, function (r) {
                  t(r, "ad-interaction");
                }));
            }
            function wI(e, t) {
              var r = t.getAd();
              r
                ? ((e.j = new $e(r, e.g, e.i)),
                  t.type != google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED ||
                    e.o.supportsMultipleMediaElements ||
                    e.l(new Me("ad-content-pause-requested")),
                  (t = new Map().set("ad", e.j).set("sdkAdObject", r).set("originalEvent", t)),
                  e.l(new Me("ad-started", t)),
                  e.j.isLinear() &&
                    (e.u.setAttribute("ad-active", "true"),
                    e.o.customPlayheadTracker || e.i.pause(),
                    e.i.muted
                      ? ((t = e.j), (t.j = e.i.volume), t.h.setVolume(0))
                      : e.j.setVolume(e.i.volume)))
                : He("The IMA SDK fired a " + t.type + " event with no associated ad. Unable to play ad!");
            }
            function Tf(e, t) {
              (t &&
                t.type == google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED &&
                !e.o.supportsMultipleMediaElements &&
                e.l(new Me("ad-content-resume-requested")),
                e.l(new Me("ad-stopped", new Map().set("originalEvent", t))),
                e.j &&
                  e.j.isLinear() &&
                  (e.u.removeAttribute("ad-active"), e.o.customPlayheadTracker || e.i.ended || e.i.play()));
            }
            function Ge(e, t, r, s, a, c) {
              ((this.g = e),
                (this.h = t),
                (this.j = (this.i = t.isSkippable) ? t.skipOffset || 0 : t.skipOffset),
                (this.l = t.skipFor),
                (this.B = r),
                (this.o = s),
                (this.m = a),
                (this.u = c),
                (this.C = t.overlay));
            }
            ((d = Ge.prototype),
              (d.needsSkipUI = function () {
                return !0;
              }),
              (d.isClientRendering = function () {
                return !0;
              }),
              (d.hasCustomClick = function () {
                return this.h.clickThroughUrl != null;
              }),
              (d.isUsingAnotherMediaElement = function () {
                return this.u;
              }),
              (d.getDuration = function () {
                var e = this.g.duration;
                return isNaN(e) ? -1 : e;
              }),
              (d.getMinSuggestedDuration = function () {
                return this.getDuration();
              }),
              (d.getRemainingTime = function () {
                var e = this.g.duration;
                return isNaN(e) ? -1 : e - this.g.currentTime;
              }),
              (d.isPaused = function () {
                return this.g.paused;
              }),
              (d.isSkippable = function () {
                return this.i && this.l != null
                  ? this.getDuration() - this.getRemainingTime() < this.j + this.l
                  : this.i;
              }),
              (d.getTimeUntilSkippable = function () {
                if (this.isSkippable()) {
                  var e = this.getRemainingTime() + this.j - this.getDuration();
                  return Math.max(e, 0);
                }
                return Math.max(this.getRemainingTime(), 0);
              }),
              (d.canSkipNow = function () {
                return this.i && this.getTimeUntilSkippable() == 0;
              }),
              (d.skip = function () {
                this.canSkipNow() && this.B();
              }),
              (d.pause = function () {
                return this.g.pause();
              }),
              (d.play = function () {
                return this.g.play();
              }),
              (d.getVolume = function () {
                return this.g.volume;
              }),
              (d.setVolume = function (e) {
                this.g.volume = e;
              }),
              (d.isMuted = function () {
                return this.g.muted;
              }),
              (d.isLinear = function () {
                return this.C == null;
              }),
              (d.resize = function () {}),
              (d.setMuted = function (e) {
                this.g.muted = e;
              }),
              (d.getSequenceLength = function () {
                return this.o;
              }),
              (d.getPositionInSequence = function () {
                return this.m;
              }),
              (d.getTitle = function () {
                return "";
              }),
              (d.getDescription = function () {
                return "";
              }),
              (d.getVastMediaBitrate = function () {
                return 0;
              }),
              (d.getVastMediaHeight = function () {
                return 0;
              }),
              (d.getVastMediaWidth = function () {
                return 0;
              }),
              (d.getVastAdId = function () {
                return "";
              }),
              (d.getAdId = function () {
                return this.h.id || "";
              }),
              (d.getCreativeAdId = function () {
                return "";
              }),
              (d.getAdvertiserName = function () {
                return "";
              }),
              (d.getMediaUrl = function () {
                return this.h.uri;
              }),
              (d.getTimeOffset = function () {
                return this.h.pre ? 0 : this.h.post ? -1 : this.h.startTime;
              }),
              (d.getPodIndex = function () {
                return 0;
              }),
              (d.release = function () {
                this.g = null;
              }),
              Ee("shaka.ads.InterstitialAd", Ge),
              (Ge.prototype.release = Ge.prototype.release),
              (Ge.prototype.getPodIndex = Ge.prototype.getPodIndex),
              (Ge.prototype.getTimeOffset = Ge.prototype.getTimeOffset),
              (Ge.prototype.getMediaUrl = Ge.prototype.getMediaUrl),
              (Ge.prototype.getAdvertiserName = Ge.prototype.getAdvertiserName),
              (Ge.prototype.getCreativeAdId = Ge.prototype.getCreativeAdId),
              (Ge.prototype.getAdId = Ge.prototype.getAdId),
              (Ge.prototype.getVastAdId = Ge.prototype.getVastAdId),
              (Ge.prototype.getVastMediaWidth = Ge.prototype.getVastMediaWidth),
              (Ge.prototype.getVastMediaHeight = Ge.prototype.getVastMediaHeight),
              (Ge.prototype.getVastMediaBitrate = Ge.prototype.getVastMediaBitrate),
              (Ge.prototype.getDescription = Ge.prototype.getDescription),
              (Ge.prototype.getTitle = Ge.prototype.getTitle),
              (Ge.prototype.getPositionInSequence = Ge.prototype.getPositionInSequence),
              (Ge.prototype.getSequenceLength = Ge.prototype.getSequenceLength),
              (Ge.prototype.setMuted = Ge.prototype.setMuted),
              (Ge.prototype.resize = Ge.prototype.resize),
              (Ge.prototype.isLinear = Ge.prototype.isLinear),
              (Ge.prototype.isMuted = Ge.prototype.isMuted),
              (Ge.prototype.setVolume = Ge.prototype.setVolume),
              (Ge.prototype.getVolume = Ge.prototype.getVolume),
              (Ge.prototype.play = Ge.prototype.play),
              (Ge.prototype.pause = Ge.prototype.pause),
              (Ge.prototype.skip = Ge.prototype.skip),
              (Ge.prototype.canSkipNow = Ge.prototype.canSkipNow),
              (Ge.prototype.getTimeUntilSkippable = Ge.prototype.getTimeUntilSkippable),
              (Ge.prototype.isSkippable = Ge.prototype.isSkippable),
              (Ge.prototype.isPaused = Ge.prototype.isPaused),
              (Ge.prototype.getRemainingTime = Ge.prototype.getRemainingTime),
              (Ge.prototype.getMinSuggestedDuration = Ge.prototype.getMinSuggestedDuration),
              (Ge.prototype.getDuration = Ge.prototype.getDuration),
              (Ge.prototype.isUsingAnotherMediaElement = Ge.prototype.isUsingAnotherMediaElement),
              (Ge.prototype.hasCustomClick = Ge.prototype.hasCustomClick),
              (Ge.prototype.isClientRendering = Ge.prototype.isClientRendering),
              (Ge.prototype.needsSkipUI = Ge.prototype.needsSkipUI));
            function je(e, t, r) {
              ((this.g = e), (this.j = t), (this.h = r), (this.i = e.overlay == null));
            }
            ((d = je.prototype),
              (d.needsSkipUI = function () {
                return !0;
              }),
              (d.isClientRendering = function () {
                return !0;
              }),
              (d.hasCustomClick = function () {
                return this.g.clickThroughUrl != null;
              }),
              (d.isUsingAnotherMediaElement = function () {
                return !1;
              }),
              (d.getDuration = function () {
                return -1;
              }),
              (d.getMinSuggestedDuration = function () {
                return this.getDuration();
              }),
              (d.getRemainingTime = function () {
                return -1;
              }),
              (d.isPaused = function () {
                return !1;
              }),
              (d.isSkippable = function () {
                return !1;
              }),
              (d.getTimeUntilSkippable = function () {
                return 0;
              }),
              (d.canSkipNow = function () {
                return !1;
              }),
              (d.skip = function () {}),
              (d.pause = function () {}),
              (d.play = function () {}),
              (d.getVolume = function () {
                return 1;
              }),
              (d.setVolume = function () {}),
              (d.isMuted = function () {
                return !1;
              }),
              (d.isLinear = function () {
                return this.i;
              }),
              (d.resize = function () {}),
              (d.setMuted = function () {}),
              (d.getSequenceLength = function () {
                return this.j;
              }),
              (d.getPositionInSequence = function () {
                return this.h;
              }),
              (d.getTitle = function () {
                return "";
              }),
              (d.getDescription = function () {
                return "";
              }),
              (d.getVastMediaBitrate = function () {
                return 0;
              }),
              (d.getVastMediaHeight = function () {
                return 0;
              }),
              (d.getVastMediaWidth = function () {
                return 0;
              }),
              (d.getVastAdId = function () {
                return "";
              }),
              (d.getAdId = function () {
                return this.g.id || "";
              }),
              (d.getCreativeAdId = function () {
                return "";
              }),
              (d.getAdvertiserName = function () {
                return "";
              }),
              (d.getMediaUrl = function () {
                return this.g.uri;
              }),
              (d.getTimeOffset = function () {
                return this.g.pre ? 0 : this.g.post ? -1 : this.g.startTime;
              }),
              (d.getPodIndex = function () {
                return 0;
              }),
              (d.release = function () {}),
              Ee("shaka.ads.InterstitialStaticAd", je),
              (je.prototype.release = je.prototype.release),
              (je.prototype.getPodIndex = je.prototype.getPodIndex),
              (je.prototype.getTimeOffset = je.prototype.getTimeOffset),
              (je.prototype.getMediaUrl = je.prototype.getMediaUrl),
              (je.prototype.getAdvertiserName = je.prototype.getAdvertiserName),
              (je.prototype.getCreativeAdId = je.prototype.getCreativeAdId),
              (je.prototype.getAdId = je.prototype.getAdId),
              (je.prototype.getVastAdId = je.prototype.getVastAdId),
              (je.prototype.getVastMediaWidth = je.prototype.getVastMediaWidth),
              (je.prototype.getVastMediaHeight = je.prototype.getVastMediaHeight),
              (je.prototype.getVastMediaBitrate = je.prototype.getVastMediaBitrate),
              (je.prototype.getDescription = je.prototype.getDescription),
              (je.prototype.getTitle = je.prototype.getTitle),
              (je.prototype.getPositionInSequence = je.prototype.getPositionInSequence),
              (je.prototype.getSequenceLength = je.prototype.getSequenceLength),
              (je.prototype.setMuted = je.prototype.setMuted),
              (je.prototype.resize = je.prototype.resize),
              (je.prototype.isLinear = je.prototype.isLinear),
              (je.prototype.isMuted = je.prototype.isMuted),
              (je.prototype.setVolume = je.prototype.setVolume),
              (je.prototype.getVolume = je.prototype.getVolume),
              (je.prototype.play = je.prototype.play),
              (je.prototype.pause = je.prototype.pause),
              (je.prototype.skip = je.prototype.skip),
              (je.prototype.canSkipNow = je.prototype.canSkipNow),
              (je.prototype.getTimeUntilSkippable = je.prototype.getTimeUntilSkippable),
              (je.prototype.isSkippable = je.prototype.isSkippable),
              (je.prototype.isPaused = je.prototype.isPaused),
              (je.prototype.getRemainingTime = je.prototype.getRemainingTime),
              (je.prototype.getMinSuggestedDuration = je.prototype.getMinSuggestedDuration),
              (je.prototype.getDuration = je.prototype.getDuration),
              (je.prototype.isUsingAnotherMediaElement = je.prototype.isUsingAnotherMediaElement),
              (je.prototype.hasCustomClick = je.prototype.hasCustomClick),
              (je.prototype.isClientRendering = je.prototype.isClientRendering),
              (je.prototype.needsSkipUI = je.prototype.needsSkipUI));
            function RI(e, t, r, s) {
              function a(f) {
                return f ? (f.overlay ? !0 : c.g.ended ? f.post : !c.g.paused) : !1;
              }
              var c = this;
              ((this.M = null),
                (this.m = e),
                (this.C = t),
                (this.g = r),
                (this.G = null),
                (this.u = !0),
                (this.h = this.g),
                (this.va = s),
                (this.ma = new Set()),
                (this.T = new Set()),
                (this.H = new Set()),
                (this.F = new Map()),
                (this.K = new Map()),
                (this.i = new de()),
                oy(this),
                (this.I = new gt()),
                (this.j = new gt()),
                (this.J = !1),
                (this.$ = this.o = this.B = this.l = null),
                (this.ba = !1),
                (this.O = -1),
                (this.X = function () {
                  if (!c.J && c.l && !c.C.xa()) {
                    c.l = c.g.currentTime;
                    var f = fl(c);
                    f && a(f) && Sf(c, f, 1, 1, Date.now());
                  }
                }),
                (this.V = function () {
                  if (!(c.J || c.l || c.C.xa())) {
                    c.g.paused || (c.l = c.g.currentTime);
                    var f = fl(c, !0);
                    (f || (f = fl(c)), f && a(f) && Sf(c, f, 1, 1, Date.now()));
                  }
                }),
                (this.oa = function () {
                  if (!c.J && c.l && !c.C.xa()) {
                    var f = c.g.currentTime;
                    c.B && !c.B.pre && !c.B.post && f < (c.B.endTime || c.B.startTime) && (c.B = null);
                  }
                }),
                (this.R = new it(this.X)),
                (this.N = new it(function () {
                  var f, g, m, x, E, A, R, b, D, M, P;
                  return W(function (G) {
                    switch (G.g) {
                      case 1:
                        if (!c.H.size || c.l == null) {
                          G.A(0);
                          break;
                        }
                        if (((f = c.C.$d()), f == Rr || f == mf)) return G.return();
                        ((g = !1), (m = Array.from(c.H)), (x = c.C.Ra()), (E = I(m)), (A = E.next()));
                      case 3:
                        if (A.done) {
                          G.A(5);
                          break;
                        }
                        if (((R = A.value), R == c.B)) {
                          G.A(4);
                          break;
                        }
                        if (((b = R.endTime || R.startTime), !(x.start - b >= 1))) {
                          ((D = R.startTime - c.l),
                            D > 0 &&
                              D <= 10 &&
                              (!c.F.has(R) &&
                                LI(R) &&
                                c.F.set(R, c.i.preload(R.uri, null, R.mimeType || void 0)),
                              bI(c, R)),
                            G.A(4));
                          break;
                        }
                        if (!c.F.has(R)) {
                          G.A(7);
                          break;
                        }
                        return _(G, c.F.get(R), 8);
                      case 8:
                        ((M = G.h) && M.destroy(), c.F.delete(R));
                      case 7:
                        (DI(c, R),
                          (P = R.id || JSON.stringify(R)),
                          c.T.has(P) && c.T.delete(P),
                          c.H.delete(R),
                          iy(c),
                          R.overlay || (g = !0));
                      case 4:
                        ((A = E.next()), G.A(3));
                        break;
                      case 5:
                        (g && Ef(c), K(G));
                    }
                  });
                })),
                this.configure(this.C.getConfiguration().ads));
            }
            ((d = RI.prototype),
              (d.configure = function (e) {
                ((this.M = e), this.J || ry(this));
              }));
            function JN(e) {
              if (!e.ba && e.H.size) {
                if (
                  (e.I.D(e.g, "playing", e.V),
                  e.I.D(e.g, "timeupdate", e.V),
                  e.I.D(e.g, "seeked", e.oa),
                  e.I.D(e.g, "ended", e.X),
                  "requestVideoFrameCallback" in e.g && !_I())
                ) {
                  var t = e.g,
                    r = function () {
                      e.O != -1 && (e.X(), e.O != -1 && (e.O = t.requestVideoFrameCallback(r)));
                    };
                  e.O = t.requestVideoFrameCallback(r);
                } else e.R.Ea(0.025);
                (e.N && e.N.Ea(1), (e.ba = !0));
              }
            }
            function iy(e) {
              e.ba &&
                !e.H.size &&
                (e.I.Ma(e.g, "playing", e.V),
                e.I.Ma(e.g, "timeupdate", e.V),
                e.I.Ma(e.g, "seeked", e.oa),
                e.I.Ma(e.g, "ended", e.X),
                e.O != -1 && (e.g.cancelVideoFrameCallback(e.O), (e.O = -1)),
                e.R && e.R.stop(),
                e.N && e.N.stop(),
                (e.ba = !1));
            }
            function ry(e) {
              if (e.m && e.M) {
                var t = e.M.supportsMultipleMediaElements,
                  r = e.g;
                ((r.controls ||
                  (r.webkitPresentationMode && r.webkitPresentationMode !== "inline") ||
                  r.webkitDisplayingFullscreen) &&
                  (t = !1),
                  e.u == t &&
                    ((e.u = !t),
                    e.u
                      ? ((e.h = e.g), e.G && (e.G.parentElement && e.m.removeChild(e.G), (e.G = null)))
                      : (e.G ||
                          ((t = document.createElement(e.g.tagName)),
                          (t.autoplay = !0),
                          (t.style.position = "absolute"),
                          (t.style.top = "0"),
                          (t.style.left = "0"),
                          (t.style.width = "100%"),
                          (t.style.height = "100%"),
                          (t.style.display = "none"),
                          t.setAttribute("playsinline", ""),
                          (e.G = t)),
                        (e.h = e.G))));
              } else e.u = !0;
            }
            ((d.stop = function () {
              if (
                (this.j && this.j.Qa(),
                this.ma.clear(),
                this.T.clear(),
                this.H.clear(),
                this.i.rg(),
                this.F.size)
              ) {
                var e = Array.from(this.F.values());
                e = I(e);
                for (var t = e.next(); !t.done; t = e.next())
                  (t = t.value) &&
                    t.then(function (r) {
                      r && r.destroy();
                    });
              }
              if ((this.F.clear(), this.K.size))
                for (e = Array.from(this.K.keys()), e = I(e), t = e.next(); !t.done; t = e.next())
                  DI(this, t.value);
              (this.K.clear(),
                this.i.detach(),
                (this.J = !1),
                (this.B = this.l = null),
                (this.u = !0),
                (this.h = this.g),
                (this.G = null),
                sy(this),
                iy(this),
                this.m && zu(this.m),
                this.o && (this.o.stop(), (this.o = null)));
            }),
              (d.release = function () {
                (this.stop(),
                  this.I && this.I.release(),
                  this.j && this.j.release(),
                  this.R && (this.R.stop(), (this.R = null)),
                  this.N && (this.N.stop(), (this.N = null)),
                  this.i.destroy());
              }),
              (d.td = function () {
                return this.i;
              }));
            function ZN(e, t) {
              var r, s, a;
              W(function (c) {
                if (c.g == 1) {
                  if (
                    ((r = null),
                    (s = t.values.find(function (f) {
                      return f.key == "ID";
                    })) && (r = s.data),
                    r)
                  ) {
                    if (e.ma.has(r)) return c.return();
                    e.ma.add(r);
                  }
                  return (
                    oy(e),
                    (a = []),
                    t &&
                    t.values.find(function (f) {
                      return f.key == "X-OVERLAY-ID";
                    })
                      ? ((a = rF(t)), c.A(2))
                      : _(c, iF(e, t), 3)
                  );
                }
                (c.g != 2 && (a = c.h), a.length ? pc(e, a) : He("Unsupported HLS interstitial", t), K(c));
              });
            }
            function eF(e, t) {
              var r = jt(t.eventNode, "OverlayEvent"),
                s = r.attributes.uri,
                a = r.attributes.mimeType,
                c = r.attributes.loop == "true",
                f = ze(r, "z", Nn);
              if (s && f != 0) {
                var g = null,
                  m = jt(r, "Background");
                if (m) {
                  var x = m.attributes.uri;
                  x ? (g = "center / contain no-repeat url('" + x + "')") : (g = ui(m));
                }
                ((m = 1920), (x = 1080));
                var E = jt(r, "Viewport");
                if (E && ((m = ze(E, "x", Nn)), m == null || ((x = ze(E, "y", Nn)), x == null))) return;
                var A = { viewport: { x: m, y: x }, topLeft: { x: 0, y: 0 }, size: { x: m, y: x } },
                  R = jt(r, "Overlay");
                if (E && R) {
                  var b = jt(R, "TopLeft"),
                    D = jt(R, "Size");
                  if (b && D) {
                    if (((R = ze(b, "x", Nn)), R == null || ((b = ze(b, "y", Nn)), b == null))) return;
                    var M = ze(D, "x", Nn);
                    if (M == null || ((D = ze(D, "y", Nn)), D == null)) return;
                    ((A.topLeft.x = R), (A.topLeft.y = b), (A.size.x = M), (A.size.y = D));
                  }
                }
                if (
                  ((R = null),
                  (r = jt(r, "Squeeze")),
                  E && r && ((D = jt(r, "TopLeft")), (r = jt(r, "Size")), D && r))
                ) {
                  if (
                    ((E = ze(D, "x", Nn)),
                    E == null ||
                      ((R = ze(D, "y", Nn)), R == null) ||
                      ((D = ze(r, "x", Nn)), D == null) ||
                      ((r = ze(r, "y", Nn)), r == null))
                  )
                    return;
                  R = { viewport: { x: m, y: x }, topLeft: { x: E, y: R }, size: { x: D, y: r } };
                }
                pc(e, [
                  {
                    id: t.id,
                    groupId: null,
                    startTime: t.startTime,
                    endTime: t.endTime,
                    uri: s,
                    mimeType: a,
                    isSkippable: !1,
                    skipOffset: null,
                    skipFor: null,
                    canJump: !0,
                    resumeOffset: null,
                    playoutLimit: null,
                    once: !1,
                    pre: !1,
                    post: !1,
                    timelineRange: !0,
                    loop: c,
                    overlay: A,
                    displayOnBackground: f == -1,
                    currentVideo: R,
                    background: g,
                    clickThroughUrl: null,
                  },
                ]);
              }
            }
            d.addAdUrlInterstitial = function (e) {
              var t = this,
                r,
                s,
                a,
                c,
                f,
                g,
                m,
                x,
                E;
              return W(function (A) {
                if (A.g == 1) return ((r = { type: 12 }), _(A, ay(t, e, r), 2));
                if (A.g != 3) {
                  if (((s = A.h), (a = Ru(s, "VAST,vmap:VMAP")), !a)) throw new ee(2, 10, 10007);
                  if (((c = []), a.tagName == "VAST")) return ((c = AI(a, t.l)), A.A(3));
                  if (a.tagName != "vmap:VMAP") return A.A(3);
                  for (
                    f = function (R) {
                      var b, D;
                      return W(function (M) {
                        if (M.g == 1) return _(M, ay(t, R.uri, r), 2);
                        if (((b = M.h), (D = Ru(b, "VAST")), !D)) throw new ee(2, 10, 10007);
                        (c.push.apply(c, V(AI(D, R.time))), K(M));
                      });
                    },
                      g = [],
                      m = I(XN(a)),
                      x = m.next();
                    !x.done;
                    x = m.next()
                  )
                    ((E = x.value), g.push(f(E)));
                  return g.length ? _(A, Promise.all(g), 3) : A.A(3);
                }
                (pc(t, c), K(A));
              });
            };
            function pc(e, t) {
              var r, s, a, c, f, g, m, x;
              W(function (E) {
                switch (E.g) {
                  case 1:
                    ((r = !1), (s = I(t)), (a = s.next()));
                  case 2:
                    if (a.done) {
                      E.A(4);
                      break;
                    }
                    if (((c = a.value), !c.uri)) {
                      (He("Missing URL in interstitial", c), E.A(3));
                      break;
                    }
                    if (c.mimeType) {
                      E.A(5);
                      break;
                    }
                    return (
                      q(E, 6),
                      (f = e.i.Yb()),
                      _(E, rl(c.uri, f, e.C.getConfiguration().streaming.retryParameters), 8)
                    );
                  case 8:
                    ((c.mimeType = E.h), he(E, 5));
                    break;
                  case 6:
                    ae(E);
                  case 5:
                    if (((g = c.id || JSON.stringify(c)), e.T.has(g))) {
                      E.A(3);
                      break;
                    }
                    (c.loop && !c.overlay && He("Loop is only supported in overlay interstitials", c),
                      c.overlay || (r = !0),
                      e.T.add(g),
                      e.H.add(c),
                      (m = !1),
                      c.pre && e.l == null
                        ? (m = !0)
                        : c.startTime != 0 || c.canJump
                          ? e.l != null && ((x = c.startTime - e.l), x > 0 && x <= 10 && (m = !0))
                          : (m = !0),
                      m &&
                        (!e.F.has(c) && LI(c) && e.F.set(c, e.i.preload(c.uri, null, c.mimeType || void 0)),
                        bI(e, c)));
                  case 3:
                    ((a = s.next()), E.A(2));
                    break;
                  case 4:
                    (r && Ef(e), JN(e), K(E));
                }
              });
            }
            function fl(e, t, r) {
              ((t = t === void 0 ? !1 : t), (r = r === void 0 ? null : r));
              var s = 0,
                a = null;
              if (e.H.size && e.l != null) {
                var c = e.g.ended,
                  f = Array.from(e.H).sort(function (A, R) {
                    return R.startTime - A.startTime;
                  }),
                  g = f;
                for (
                  g = t
                    ? f.filter(function (A) {
                        return A.pre;
                      })
                    : c
                      ? f.filter(function (A) {
                          return A.post;
                        })
                      : f.filter(function (A) {
                          return !A.pre && !A.post;
                        }),
                    f = I(g),
                    g = f.next();
                  !g.done;
                  g = f.next()
                ) {
                  g = g.value;
                  var m = !1;
                  if (t) m = g.pre;
                  else if (c) m = g.post;
                  else if (!g.pre && !g.post) {
                    var x = e.l - Math.round(g.startTime * 1e3) / 1e3,
                      E = 1;
                    (e.M.allowStartInMiddleOfInterstitial &&
                      g.endTime &&
                      g.endTime != 1 / 0 &&
                      (E = g.endTime - g.startTime),
                      (x > 0 || (x == 0 && e.l == 0)) &&
                        (x <= E || !g.canJump) &&
                        (m = !(r == null && e.B && !e.B.pre && !e.B.post && e.B.startTime >= g.startTime)));
                  }
                  m &&
                    (!e.B || g.startTime >= e.B.startTime) &&
                    (s == (r || 0)
                      ? (a = g)
                      : a &&
                        !g.canJump &&
                        Math.round(g.startTime * 1e3) / 1e3 - Math.round(a.startTime * 1e3) / 1e3 > 0.001 &&
                        ((a = g), (s = 0)),
                    s++);
                }
              }
              return a;
            }
            function Sf(e, t, r, s, a, c) {
              ((c = c === void 0 ? 0 : c),
                (e.B = t),
                ry(e),
                e.u || !e.m || e.h.parentElement || e.m.appendChild(e.h),
                s == 1 &&
                  r == 1 &&
                  (r = Array.from(e.H).filter(function (f) {
                    return t.pre
                      ? f.pre == t.pre
                      : t.post
                        ? f.post == t.post
                        : Math.abs(f.startTime - t.startTime) < 0.001;
                  }).length),
                t.once && (c++, e.H.delete(t), iy(e), t.overlay || Ef(e)),
                t.mimeType && (t.mimeType.startsWith("image/") || t.mimeType === "text/html")
                  ? t.overlay
                    ? tF(e, t, r, s, c)
                    : He("Unsupported interstitial", t)
                  : e.u && t.overlay
                    ? He("Unsupported interstitial", t)
                    : nF(e, t, r, s, a, c));
            }
            function tF(e, t, r, s, a) {
              function c() {
                (e.o && (e.o.stop(), (e.o = null)),
                  e.m.removeChild(m),
                  sy(e, t),
                  on(e, "ad-stopped"),
                  e.j.Qa());
                var R = fl(e, t.pre, s - a);
                R ? Sf(e, R, r, ++s, Date.now(), a) : (e.J = !1);
              }
              e.J = !0;
              var f = t.overlay,
                g = t.mimeType == "text/html" ? "iframe" : "img",
                m = document.createElement(g);
              ((m.style.objectFit = "contain"),
                (m.style.position = "absolute"),
                (m.style.border = "none"),
                CI(e, t));
              var x = new je(t, r, s);
              (on(e, "ad-impression"),
                on(e, "ad-started", new Map().set("ad", x)),
                g == "iframe"
                  ? (m.src = t.uri)
                  : ((m.src = t.uri),
                    (m.onerror = function (R) {
                      (on(e, "ad-error", new Map().set("originalEvent", R)), c());
                    })),
                (x = f.viewport));
              var E = f.topLeft;
              ((f = f.size),
                x.x == 0 && x.y == 0
                  ? ((m.width = t.overlay.size.x),
                    (m.height = t.overlay.size.y),
                    (m.style.bottom = "10%"),
                    (m.style.left = "0"),
                    (m.style.right = "0"),
                    (m.style.width = "100%"),
                    t.overlay.size.y || g != "iframe" || (m.style.height = "auto"))
                  : ((m.style.height = (f.y / x.y) * 100 + "%"),
                    (m.style.left = (E.x / x.x) * 100 + "%"),
                    (m.style.top = (E.y / x.y) * 100 + "%"),
                    (m.style.width = (f.x / x.x) * 100 + "%")),
                e.m.appendChild(m));
              var A = Date.now();
              (e.o && e.o.stop(),
                (e.o = new it(function () {
                  (t.playoutLimit && (Date.now() - A) / 1e3 > t.playoutLimit) ||
                  (t.endTime && e.g.currentTime > t.endTime)
                    ? (on(e, "ad-complete"), c())
                    : e.g.currentTime < t.startTime && (on(e, "ad-skipped"), c());
                })),
                t.playoutLimit && !t.endTime ? e.o.ka(t.playoutLimit) : t.endTime && e.o.Ea(0.025),
                e.j.D(e.g, "seeked", function () {
                  var R = e.g.currentTime;
                  (R < t.startTime || (t.endTime && R > t.endTime)) &&
                    (e.o && e.o.stop(), on(e, "ad-skipped"), c());
                }),
                t.clickThroughUrl &&
                  e.j.D(m, "click", function () {
                    t.clickThroughUrl && l.open(t.clickThroughUrl, "_blank");
                  }));
            }
            function nF(e, t, r, s, a, c) {
              var f, g, m, x, E, A, R, b, D, M, P, G, U, H, Q, ne, z, J, X, ie, Z;
              W(function (re) {
                switch (re.g) {
                  case 1:
                    if (
                      ((f = Date.now()),
                      (e.J = !0),
                      (g = !1),
                      (m = function () {
                        if (!e.u && !t.overlay && t.resumeOffset == null)
                          if (t.timelineRange && t.endTime && t.endTime != 1 / 0)
                            e.g.currentTime != t.endTime && (e.g.currentTime = t.endTime);
                          else {
                            var se = Date.now();
                            ((e.g.currentTime += (se - a) / 1e3), (a = se));
                          }
                      }),
                      (x = function (se) {
                        var me, fe;
                        return W(function (le) {
                          if (le.g == 1) {
                            if ((m(), (me = fl(e, t.pre, s - c)), se && t.groupId))
                              for (; me && me.groupId == t.groupId; ) (s++, (me = fl(e, t.pre, s - c)));
                            return (
                              e.o &&
                                (!t.groupId || (me && me.groupId != t.groupId)) &&
                                (e.o.stop(), (e.o = null)),
                              sy(e, t),
                              me && !me.overlay
                                ? le.A(2)
                                : (t.post && ((e.l = null), (e.B = null)),
                                  e.u ? _(le, e.i.detach(), 4) : _(le, e.i.Cc(), 4))
                            );
                          }
                          (le.g != 2 &&
                            (e.u &&
                              ((fe = t.resumeOffset),
                              fe == null &&
                                (fe =
                                  t.timelineRange && t.endTime && t.endTime != 1 / 0
                                    ? t.endTime - (e.l || 0)
                                    : (Date.now() - a) / 1e3),
                              on(e, "ad-content-resume-requested", new Map().set("offset", fe))),
                            on(e, "ad-stopped"),
                            e.j.Qa(),
                            (e.J = !1),
                            e.u ? Ef(e) : ((e.h.style.display = "none"), m(), e.g.ended || e.g.play())),
                            ry(e),
                            me && (on(e, "ad-stopped"), e.j.Qa(), Sf(e, me, r, ++s, a, c)),
                            K(le));
                        });
                      }),
                      (E = function (se) {
                        return W(function (me) {
                          return g
                            ? me.return()
                            : ((g = !0),
                              on(e, "ad-error", new Map().set("originalEvent", se)),
                              _(me, x(!1), 0));
                        });
                      }),
                      (A = function () {
                        return W(function (se) {
                          if (se.g == 1) return g ? se.return() : ((g = !0), _(se, x(!1), 2));
                          (on(e, "ad-complete"), K(se));
                        });
                      }),
                      (e.$ = function () {
                        return W(function (se) {
                          return g ? se.return() : ((g = !0), on(e, "ad-skipped"), _(se, x(!0), 0));
                        });
                      }),
                      (R = new Ge(e.h, t, e.$, r, s, !e.u)),
                      e.u || (R.setMuted(e.g.muted), R.setVolume(e.g.volume)),
                      on(e, "ad-started", new Map().set("ad", R)),
                      (b = R.canSkipNow()) && on(e, "ad-skip-state-changed"),
                      e.j.Aa(e.i, "error", E),
                      e.j.D(e.h, "timeupdate", function () {
                        if (e.h.duration) {
                          var se = R.canSkipNow();
                          (b != se &&
                            R.getRemainingTime() > 0 &&
                            R.getDuration() > 0 &&
                            on(e, "ad-skip-state-changed"),
                            (b = se),
                            !e.u &&
                              !t.overlay &&
                              t.resumeOffset == null &&
                              t.timelineRange &&
                              t.endTime &&
                              t.endTime != 1 / 0 &&
                              e.g.currentTime != t.endTime &&
                              e.C.Ra().end >= t.endTime &&
                              (e.g.currentTime = t.endTime));
                        }
                      }),
                      e.j.Aa(e.i, "firstquartile", function () {
                        (m(), on(e, "ad-first-quartile"));
                      }),
                      e.j.Aa(e.i, "midpoint", function () {
                        (m(), on(e, "ad-midpoint"));
                      }),
                      e.j.Aa(e.i, "thirdquartile", function () {
                        (m(), on(e, "ad-third-quartile"));
                      }),
                      e.j.Aa(e.i, "complete", A),
                      e.j.D(e.h, "play", function () {
                        on(e, "ad-resumed");
                      }),
                      e.j.D(e.h, "pause", function () {
                        var se = e.i.getConfiguration();
                        e.h.currentTime >= se.playRangeEnd ? A() : on(e, "ad-paused");
                      }),
                      e.j.D(e.h, "volumechange", function () {
                        e.h.muted ? on(e, "ad-muted") : on(e, "ad-volume-changed");
                      }),
                      t.clickThroughUrl &&
                        ((D = e.m || e.h),
                        e.j.D(D, "click", function () {
                          t.clickThroughUrl &&
                            (R.isPaused() || R.pause(), l.open(t.clickThroughUrl, "_blank"));
                        })),
                      !e.u || s != 1)
                    ) {
                      re.A(2);
                      break;
                    }
                    return (
                      on(e, "ad-content-pause-requested", new Map().set("saveLivePosition", !0)),
                      (M = new _t()),
                      (P = function (se) {
                        return W(function (me) {
                          if (me.g == 1)
                            return se.state != "detach"
                              ? me.A(0)
                              : _I()
                                ? _(
                                    me,
                                    new Promise(function (fe) {
                                      return new it(fe).ka(0.1);
                                    }),
                                    3,
                                  )
                                : me.A(3);
                          (M.resolve(), e.j.Ma(e.C, "onstatechange", P), K(me));
                        });
                      }),
                      e.j.D(e.C, "onstatechange", P),
                      _(re, M, 2)
                    );
                  case 2:
                    return (
                      CI(e, t),
                      e.u ||
                        ((e.h.style.display = ""),
                        t.overlay
                          ? ((e.h.loop = t.loop),
                            (G = t.overlay.viewport),
                            (U = t.overlay.topLeft),
                            (H = t.overlay.size),
                            (e.h.style.height = (H.y / G.y) * 100 + "%"),
                            (e.h.style.left = (U.x / G.x) * 100 + "%"),
                            (e.h.style.top = (U.y / G.y) * 100 + "%"),
                            (e.h.style.width = (H.x / G.x) * 100 + "%"))
                          : (e.g.pause(),
                            t.resumeOffset != null &&
                              t.resumeOffset != 0 &&
                              (e.g.currentTime += t.resumeOffset),
                            (e.h.loop = !1),
                            (e.h.style.height = "100%"),
                            (e.h.style.left = "0"),
                            (e.h.style.top = "0"),
                            (e.h.style.width = "100%"))),
                      q(re, 4),
                      oy(e),
                      t.startTime &&
                        t.endTime &&
                        t.endTime != 1 / 0 &&
                        t.startTime != t.endTime &&
                        ((Q = t.endTime - t.startTime), Q > 0 && e.i.configure("playRangeEnd", Q)),
                      t.playoutLimit &&
                        !e.o &&
                        ((e.o = new it(function () {
                          e.$();
                        }).ka(t.playoutLimit)),
                        e.i.configure("playRangeEnd", t.playoutLimit)),
                      _(re, e.i.Vb(e.h), 6)
                    );
                  case 6:
                    return (
                      (ne = null),
                      t.pre ||
                        t.post ||
                        !e.M.allowStartInMiddleOfInterstitial ||
                        e.l == null ||
                        ((z = e.l - t.startTime), Math.abs(z) > 0.25 && (ne = z)),
                      e.F.has(t) ? _(re, e.F.get(t), 10) : _(re, e.i.load(t.uri, ne, t.mimeType || void 0), 8)
                    );
                  case 10:
                    return (
                      (J = re.h),
                      e.F.delete(t),
                      J ? _(re, e.i.load(J), 8) : _(re, e.i.load(t.uri, ne, t.mimeType || void 0), 8)
                    );
                  case 8:
                    (t.overlay && e.g.paused ? e.h.pause() : e.h.play(),
                      (X = (Date.now() - f) / 1e3),
                      on(e, "ads-loaded", new Map().set("loadTime", X)),
                      e.u && e.g.play(),
                      t.overlay &&
                        (t.pre ||
                          t.post ||
                          (e.C.W() && !(t.startTime > 0)) ||
                          ((ie = function () {
                            var se = e.g.currentTime - t.startTime;
                            Math.abs(se - e.h.currentTime) > 0.1 && (e.h.currentTime = se);
                          }),
                          e.j.Aa(e.h, "playing", ie),
                          e.j.D(e.g, "seeking", ie)),
                        e.j.D(e.g, "seeked", function () {
                          var se = e.g.currentTime;
                          (se < t.startTime || (t.endTime && se > t.endTime)) && e.$();
                        })),
                      he(re, 0));
                    break;
                  case 4:
                    if (((Z = ae(re)), !e.J)) return re.return();
                    (E(Z), K(re));
                }
              });
            }
            function CI(e, t) {
              if ((t.displayOnBackground && (e.g.style.zIndex = "1"), t.currentVideo != null)) {
                var r = t.currentVideo;
                e.g.style.transformOrigin = "top left";
                var s = !0,
                  a = [],
                  c = (r.topLeft.x / r.viewport.x) * 100;
                (c > 0 && c <= 100 && (a.push("translateX(" + c + "%)"), (s = !1)),
                  (c = (r.topLeft.y / r.viewport.y) * 100),
                  c > 0 && c <= 100 && (a.push("translateY(" + c + "%)"), (s = !1)),
                  (c = r.size.x / r.viewport.x),
                  c < 1 && a.push("scaleX(" + c + ")"),
                  (r = r.size.y / r.viewport.y),
                  c < 1 && a.push("scaleY(" + r + ")"),
                  a.length && (e.g.style.transform = a.join(" ")),
                  s && (e.g.style.transition = "transform 250ms"));
              }
              (e.m &&
                (t.clickThroughUrl
                  ? (e.m.setAttribute("ad-active", "true"), (e.m.style.pointerEvents = ""))
                  : (e.m.style.pointerEvents = "none"),
                t.background && (e.m.style.background = t.background)),
                e.G && (e.G.style.background = t.overlay ? "" : "rgb(0, 0, 0)"));
            }
            function sy(e, t) {
              ((!t || t.displayOnBackground) && (e.g.style.zIndex = ""),
                (t && t.currentVideo == null) ||
                  ((e.g.style.transformOrigin = ""), (e.g.style.transition = ""), (e.g.style.transform = "")),
                e.m &&
                  (e.m.removeAttribute("ad-active"), (e.m.style.pointerEvents = ""), !t || t.background) &&
                  (e.m.style.background = ""),
                e.G && (e.G.style.background = ""));
            }
            function iF(e, t) {
              var r,
                s,
                a,
                c,
                f,
                g,
                m,
                x,
                E,
                A,
                R,
                b,
                D,
                M,
                P,
                G,
                U,
                H,
                Q,
                ne,
                z,
                J,
                X,
                ie,
                Z,
                re,
                se,
                me,
                fe,
                le,
                ue,
                xe,
                Se,
                Ye,
                be,
                xt,
                qe,
                Ct,
                lt,
                rt,
                dt,
                yt;
              return W(function (ht) {
                switch (ht.g) {
                  case 1:
                    if (
                      ((r = []),
                      !t ||
                        ((s = t.values.find(function (st) {
                          return st.key == "X-ASSET-URI";
                        })),
                        (a = t.values.find(function (st) {
                          return st.key == "X-ASSET-LIST";
                        })),
                        !s && !a))
                    )
                      return ht.return(r);
                    if (
                      ((c = null),
                      (f = t.values.find(function (st) {
                        return st.key == "ID";
                      })) && (c = f.data),
                      (g = c == null ? Math.floor(t.startTime * 10) / 10 : t.startTime),
                      (m = t.endTime) &&
                        t.endTime != 1 / 0 &&
                        typeof t.endTime == "number" &&
                        (m = c == null ? Math.floor(t.endTime * 10) / 10 : t.endTime),
                      (x = t.values.find(function (st) {
                        return st.key == "X-RESTRICT";
                      })),
                      (A = E = !0),
                      x && x.data && ((R = x.data), (E = !R.includes("SKIP")), (A = !R.includes("JUMP"))),
                      (b = E ? 0 : null),
                      (D = t.values.find(function (st) {
                        return st.key == "X-ENABLE-SKIP-AFTER";
                      })) && ((M = D.data), (b = parseFloat(M)), isNaN(b) && (b = E ? 0 : null)),
                      (P = null),
                      (G = t.values.find(function (st) {
                        return st.key == "X-ENABLE-SKIP-FOR";
                      })) && ((U = G.data), (P = parseFloat(U)), isNaN(b) && (P = null)),
                      (H = null),
                      (Q = t.values.find(function (st) {
                        return st.key == "X-RESUME-OFFSET";
                      })) && ((ne = Q.data), (H = parseFloat(ne)), isNaN(H) && (H = null)),
                      (z = null),
                      (J = t.values.find(function (st) {
                        return st.key == "X-PLAYOUT-LIMIT";
                      })) && ((X = J.data), (z = parseFloat(X)), isNaN(z) && (z = null)),
                      (re = Z = ie = !1),
                      (se = t.values.find(function (st) {
                        return st.key == "CUE";
                      })) &&
                        ((me = se.data),
                        (ie = me.includes("ONCE")),
                        (Z = me.includes("PRE")),
                        (re = me.includes("POST"))),
                      (fe = !1),
                      (le = t.values.find(function (st) {
                        return st.key == "X-TIMELINE-OCCUPIES";
                      }))
                        ? ((ue = le.data), (fe = ue.includes("RANGE")))
                        : !Q && e.C.W() && (fe = !Z && !re),
                      s)
                    ) {
                      if (((xe = s.data), !xe)) return ht.return(r);
                      (r.push({
                        id: c,
                        groupId: null,
                        startTime: g,
                        endTime: m,
                        uri: xe,
                        mimeType: null,
                        isSkippable: E,
                        skipOffset: b,
                        skipFor: P,
                        canJump: A,
                        resumeOffset: H,
                        playoutLimit: z,
                        once: ie,
                        pre: Z,
                        post: re,
                        timelineRange: fe,
                        loop: !1,
                        overlay: null,
                        displayOnBackground: !1,
                        currentVideo: null,
                        background: null,
                        clickThroughUrl: null,
                      }),
                        ht.A(2));
                      break;
                    }
                    if (!a) {
                      ht.A(2);
                      break;
                    }
                    return (
                      (Se = a.data),
                      Se ? (q(ht, 4), (Ye = { type: 11 }), _(ht, ay(e, Se, Ye), 6)) : ht.return(r)
                    );
                  case 6:
                    for (
                      be = ht.h,
                        xt = zt(be),
                        qe = JSON.parse(xt),
                        (Ct = qe["SKIP-CONTROL"]) &&
                          ((lt = Ct["ENABLE-SKIP-AFTER"]),
                          typeof lt == "number" && ((b = parseFloat(lt)), isNaN(lt) && (b = E ? 0 : null)),
                          (rt = Ct["ENABLE-SKIP-FOR"]),
                          typeof rt == "number" && ((P = parseFloat(rt)), isNaN(rt) && (P = null))),
                        dt = 0;
                      dt < qe.ASSETS.length;
                      dt++
                    )
                      ((yt = qe.ASSETS[dt]),
                        yt.URI &&
                          r.push({
                            id: c + "_shaka_asset_" + dt,
                            groupId: c,
                            startTime: g,
                            endTime: m,
                            uri: yt.URI,
                            mimeType: null,
                            isSkippable: E,
                            skipOffset: b,
                            skipFor: P,
                            canJump: A,
                            resumeOffset: H,
                            playoutLimit: z,
                            once: ie,
                            pre: Z,
                            post: re,
                            timelineRange: fe,
                            loop: !1,
                            overlay: null,
                            displayOnBackground: !1,
                            currentVideo: null,
                            background: null,
                            clickThroughUrl: null,
                          }));
                    he(ht, 2);
                    break;
                  case 4:
                    ae(ht);
                  case 2:
                    return ht.return(r);
                }
              });
            }
            function rF(e) {
              var t = [];
              if (!e) return t;
              var r = e.values.find(function (P) {
                return P.key == "X-ASSET-URI";
              });
              if (!r || ((r = r.data), !r)) return t;
              var s = null,
                a = e.values.find(function (P) {
                  return P.key == "X-OVERLAY-ID";
                });
              (a && (s = a.data), (a = s == null ? Math.floor(e.startTime * 10) / 10 : e.startTime));
              var c = e.endTime;
              e.endTime &&
                e.endTime != 1 / 0 &&
                typeof e.endTime == "number" &&
                (c = s == null ? Math.floor(e.endTime * 10) / 10 : e.endTime);
              var f = !1,
                g = !1,
                m = !1,
                x = e.values.find(function (P) {
                  return P.key == "CUE";
                });
              (x &&
                ((m = x.data), (f = m.includes("ONCE")), (g = m.includes("PRE")), (m = m.includes("POST"))),
                (x = null));
              var E = e.values.find(function (P) {
                return P.key == "X-ASSET-MIMETYPE";
              });
              (E && (x = E.data), (E = !1));
              var A = e.values.find(function (P) {
                return P.key == "X-LOOP";
              });
              (A && (E = A.data == "YES"), (A = 1));
              var R = e.values.find(function (P) {
                return P.key == "X-DEPTH";
              });
              (R && ((A = parseFloat(R.data)), isNaN(A) && (A = 1)), (R = null));
              var b = e.values.find(function (P) {
                return P.key == "X-BACKGROUND";
              });
              (b && (R = b.data), (b = 1920));
              var D = 1080,
                M = e.values.find(function (P) {
                  return P.key == "X-VIEWPORT";
                });
              if (M) {
                if (((D = M.data.split("x")), D.length != 2)) return t;
                ((b = parseFloat(D[0])), (D = parseFloat(D[1])));
              }
              if (
                ((b = { viewport: { x: b, y: D }, topLeft: { x: 0, y: 0 }, size: { x: b, y: D } }),
                (D = e.values.find(function (P) {
                  return P.key == "X-OVERLAY-POSITION";
                })))
              ) {
                if (((D = D.data.split("x")), D.length != 2)) return t;
                ((b.topLeft.x = parseFloat(D[0])), (b.topLeft.y = parseFloat(D[1])));
              }
              if (
                (D = e.values.find(function (P) {
                  return P.key == "X-OVERLAY-SIZE";
                }))
              ) {
                if (((D = D.data.split("x")), D.length != 2)) return t;
                ((b.size.x = parseFloat(D[0])), (b.size.y = parseFloat(D[1])));
              }
              if (
                ((D = null),
                (M = e.values.find(function (P) {
                  return P.key == "X-SQUEEZECURRENT";
                })) &&
                  ((D = parseFloat(M.data)),
                  isNaN(D) && (D = 1),
                  (D = {
                    viewport: { x: 1920, y: 1080 },
                    topLeft: { x: 0, y: 0 },
                    size: { x: 1920 * D, y: 1080 * D },
                  }),
                  (e = e.values.find(function (P) {
                    return P.key == "X-SQUEEZECURRENT-POSITION";
                  }))))
              ) {
                if (((e = e.data.split("x")), e.length != 2)) return t;
                ((D.topLeft.x = parseFloat(e[0])), (D.topLeft.y = parseFloat(e[1])));
              }
              return (
                t.push({
                  id: s,
                  groupId: null,
                  startTime: a,
                  endTime: c,
                  uri: r,
                  mimeType: x,
                  isSkippable: !1,
                  skipOffset: null,
                  skipFor: null,
                  canJump: !0,
                  resumeOffset: null,
                  playoutLimit: null,
                  once: f,
                  pre: g,
                  post: m,
                  timelineRange: !0,
                  loop: E,
                  overlay: b,
                  displayOnBackground: A == -1,
                  currentVideo: D,
                  background: R,
                  clickThroughUrl: null,
                }),
                t
              );
            }
            function Ef(e) {
              for (var t = [], r = I(e.H), s = r.next(), a = {}; !s.done; a = { Bc: void 0 }, s = r.next())
                ((s = s.value),
                  s.overlay ||
                    ((a.Bc = { start: s.startTime, end: null }),
                    s.pre
                      ? ((a.Bc.start = 0), (a.Bc.end = null))
                      : s.post
                        ? ((a.Bc.start = -1), (a.Bc.end = null))
                        : s.timelineRange && (a.Bc.end = s.endTime),
                    t.find(
                      (function (c) {
                        return function (f) {
                          return c.Bc.start == f.start && c.Bc.end == f.end;
                        };
                      })(a),
                    ) || t.push(a.Bc)));
              on(e, "ad-cue-points-changed", new Map().set("cuepoints", t));
            }
            function oy(e) {
              (e.i.configure(e.C.ki()),
                e.i.configure("ads.disableHLSInterstitial", !0),
                e.i.configure("ads.disableDASHInterstitial", !0),
                e.i.configure("playRangeEnd", 1 / 0),
                DE(e.C.Yb(), e.i.Yb()));
            }
            function ay(e, t, r) {
              var s, a, c;
              return W(function (f) {
                return f.g == 1
                  ? ((s = fn([t], wr())), (a = e.C.Yb().request(7, s, r)), _(f, a.promise, 2))
                  : ((c = f.h), f.return(c.data));
              });
            }
            function LI(e) {
              return (e = e.mimeType) ? !e.startsWith("image/") && e !== "text/html" : !0;
            }
            function _I() {
              var e = tt().Oa();
              return e == "TV" || e == "CONSOLE" || e == "CAST";
            }
            function bI(e, t) {
              if (!(e.K.has(t) || (e.M && !e.M.allowPreloadOnDomElements))) {
                var r = function (c) {
                    var f = document.createElement("link");
                    return (
                      (f.rel = "preload"),
                      (f.href = c),
                      (f.as = "image"),
                      document.head.appendChild(f),
                      f
                    );
                  },
                  s = [];
                if (t.background) {
                  var a = t.background.match(/url\(('|")?([^'"()]+)('|")\)?/);
                  a && s.push(r(a[2]));
                }
                (t.mimeType && t.mimeType.startsWith("image/") && s.push(r(t.uri)), e.K.set(t, s));
              }
            }
            function DI(e, t) {
              if (e.K.has(t)) {
                var r = e.K.get(t);
                r = I(r);
                for (var s = r.next(); !s.done; s = r.next()) ((s = s.value), s.parentNode.removeChild(s));
                e.K.delete(t);
              }
            }
            function on(e, t, r) {
              e.va(new Me(t, r));
            }
            function Fe(e, t, r, s, a) {
              ((this.h = e),
                (this.j = Fa(this.h.skipOffset)),
                (this.g = a),
                (this.i = t),
                (this.l = r),
                (this.o = s),
                (this.m = !1));
            }
            ((d = Fe.prototype),
              (d.needsSkipUI = function () {
                return !0;
              }),
              (d.isClientRendering = function () {
                return !1;
              }),
              (d.hasCustomClick = function () {
                return !1;
              }),
              (d.isUsingAnotherMediaElement = function () {
                return !1;
              }),
              (d.getDuration = function () {
                return this.h.durationInSeconds;
              }),
              (d.getMinSuggestedDuration = function () {
                return this.getDuration();
              }),
              (d.getRemainingTime = function () {
                return this.h.startTimeInSeconds + this.h.durationInSeconds - this.g.currentTime;
              }),
              (d.isPaused = function () {
                return this.g.paused;
              }),
              (d.isSkippable = function () {
                return typeof this.j == "number";
              }),
              (d.getTimeUntilSkippable = function () {
                if (typeof this.j != "number") return this.getRemainingTime();
                var e = this.getRemainingTime() + this.j - this.getDuration();
                return Math.max(e, 0);
              }),
              (d.canSkipNow = function () {
                return this.getTimeUntilSkippable() == 0;
              }),
              (d.skip = function () {
                ((this.m = !0), (this.g.currentTime += this.getRemainingTime()));
              }),
              (d.pause = function () {
                return this.g.pause();
              }),
              (d.play = function () {
                return this.g.play();
              }),
              (d.getVolume = function () {
                return this.g.volume;
              }),
              (d.setVolume = function (e) {
                this.g.volume = e;
              }),
              (d.isMuted = function () {
                return this.g.muted;
              }),
              (d.isLinear = function () {
                return this.o;
              }),
              (d.resize = function () {}),
              (d.setMuted = function (e) {
                this.g.muted = e;
              }),
              (d.getSequenceLength = function () {
                return this.l ? this.l : 1;
              }),
              (d.getPositionInSequence = function () {
                return this.i ? this.i : 1;
              }),
              (d.getTitle = function () {
                return this.h.adTitle;
              }),
              (d.getDescription = function () {
                return "";
              }),
              (d.getVastMediaBitrate = function () {
                return 0;
              }),
              (d.getVastMediaHeight = function () {
                return 0;
              }),
              (d.getVastMediaWidth = function () {
                return 0;
              }),
              (d.getVastAdId = function () {
                return this.h.vastAdId || "";
              }),
              (d.getAdId = function () {
                return this.h.adId;
              }),
              (d.getCreativeAdId = function () {
                return this.h.creativeId;
              }),
              (d.getAdvertiserName = function () {
                return "";
              }),
              (d.getMediaUrl = function () {
                return null;
              }),
              (d.getTimeOffset = function () {
                return 0;
              }),
              (d.getPodIndex = function () {
                return 0;
              }),
              (d.release = function () {
                this.l = this.i = this.g = this.h = null;
              }),
              Ee("shaka.ads.MediaTailorAd", Fe),
              (Fe.prototype.release = Fe.prototype.release),
              (Fe.prototype.getPodIndex = Fe.prototype.getPodIndex),
              (Fe.prototype.getTimeOffset = Fe.prototype.getTimeOffset),
              (Fe.prototype.getMediaUrl = Fe.prototype.getMediaUrl),
              (Fe.prototype.getAdvertiserName = Fe.prototype.getAdvertiserName),
              (Fe.prototype.getCreativeAdId = Fe.prototype.getCreativeAdId),
              (Fe.prototype.getAdId = Fe.prototype.getAdId),
              (Fe.prototype.getVastAdId = Fe.prototype.getVastAdId),
              (Fe.prototype.getVastMediaWidth = Fe.prototype.getVastMediaWidth),
              (Fe.prototype.getVastMediaHeight = Fe.prototype.getVastMediaHeight),
              (Fe.prototype.getVastMediaBitrate = Fe.prototype.getVastMediaBitrate),
              (Fe.prototype.getDescription = Fe.prototype.getDescription),
              (Fe.prototype.getTitle = Fe.prototype.getTitle),
              (Fe.prototype.getPositionInSequence = Fe.prototype.getPositionInSequence),
              (Fe.prototype.getSequenceLength = Fe.prototype.getSequenceLength),
              (Fe.prototype.setMuted = Fe.prototype.setMuted),
              (Fe.prototype.resize = Fe.prototype.resize),
              (Fe.prototype.isLinear = Fe.prototype.isLinear),
              (Fe.prototype.isMuted = Fe.prototype.isMuted),
              (Fe.prototype.setVolume = Fe.prototype.setVolume),
              (Fe.prototype.getVolume = Fe.prototype.getVolume),
              (Fe.prototype.play = Fe.prototype.play),
              (Fe.prototype.pause = Fe.prototype.pause),
              (Fe.prototype.skip = Fe.prototype.skip),
              (Fe.prototype.canSkipNow = Fe.prototype.canSkipNow),
              (Fe.prototype.getTimeUntilSkippable = Fe.prototype.getTimeUntilSkippable),
              (Fe.prototype.isSkippable = Fe.prototype.isSkippable),
              (Fe.prototype.isPaused = Fe.prototype.isPaused),
              (Fe.prototype.getRemainingTime = Fe.prototype.getRemainingTime),
              (Fe.prototype.getMinSuggestedDuration = Fe.prototype.getMinSuggestedDuration),
              (Fe.prototype.getDuration = Fe.prototype.getDuration),
              (Fe.prototype.isUsingAnotherMediaElement = Fe.prototype.isUsingAnotherMediaElement),
              (Fe.prototype.hasCustomClick = Fe.prototype.hasCustomClick),
              (Fe.prototype.isClientRendering = Fe.prototype.isClientRendering),
              (Fe.prototype.needsSkipUI = Fe.prototype.needsSkipUI));
            function gc(e, t, r, s) {
              ((this.C = e),
                (this.K = t),
                (this.h = r),
                (this.l = null),
                (this.R = NaN),
                (this.i = s),
                (this.J = !1),
                (this.B = null),
                (this.j = []),
                (this.N = []),
                (this.M = this.F = this.g = null),
                (this.G = new Map()),
                (this.m = []),
                (this.u = []),
                (this.H = ""),
                (this.O = !0),
                (this.I = ""),
                (this.o = new gt()));
            }
            ((gc.prototype.stop = function () {
              for (var e = I(this.m), t = e.next(); !t.done; t = e.next())
                ((t = t.value), this.o.Ma(t.target, t.type, t.listener));
              (pl(this),
                (this.m = []),
                (this.u = []),
                (this.H = ""),
                (this.O = !0),
                (this.I = ""),
                (this.B = null),
                (this.j = []),
                (this.N = []),
                this.G.clear());
            }),
              (gc.prototype.release = function () {
                (this.stop(), this.o && this.o.release());
              }),
              (gc.prototype.onManifestUpdated = function (e) {
                ((this.J = e), this.H != "" && (oF(this, this.H, this.O), (this.O = !1)));
              }),
              (gc.prototype.getCuePoints = function () {
                for (var e = [], t = I(this.j), r = t.next(); !r.done; r = t.next()) {
                  r = I(r.value.ads);
                  for (var s = r.next(); !s.done; s = r.next())
                    ((s = s.value),
                      e.push({
                        start: s.startTimeInSeconds,
                        end: s.startTimeInSeconds + s.durationInSeconds,
                      }));
                }
                return e;
              }));
            function sF(e, t, r) {
              var s, a, c, f, g, m, x, E, A, R, b, D;
              W(function (M) {
                if (M.g == 1)
                  return (
                    (s = { type: 7 }),
                    (a = fn([t], wr())),
                    (a.method = "POST"),
                    r && ((c = JSON.stringify(r)), (a.body = Er(c))),
                    (f = e.K.request(7, a, s)),
                    q(M, 2),
                    _(M, f.promise, 4)
                  );
                if (M.g != 2) {
                  if (((g = M.h), (m = zt(g.data)), (x = JSON.parse(m)), x.manifestUrl && x.trackingUrl))
                    ((E = new un(t)),
                      (A = new un(x.trackingUrl)),
                      (e.H = E.resolve(A).toString()),
                      (R = Date.now() / 1e3),
                      (b = R - e.R),
                      e.i(new Me("ads-loaded", new Map().set("loadTime", b))),
                      (D = new un(x.manifestUrl)),
                      e.l.resolve(E.resolve(D).toString()),
                      (e.l = null));
                  else throw Error("Insufficient data from MediaTailor.");
                  return he(M, 0);
                }
                if ((ae(M), !e.I.length))
                  return (
                    e.l.reject(
                      "MediaTailor request returned an error and there was no backup asset uri provided.",
                    ),
                    (e.l = null),
                    M.return()
                  );
                (e.l.resolve(e.I), (e.l = null), K(M));
              });
            }
            function oF(e, t, r) {
              var s, a, c, f, g, m, x, E, A, R, b, D, M, P, G, U;
              W(function (H) {
                if (H.g == 1)
                  return (
                    (s = { type: 8 }),
                    (a = fn([t], wr())),
                    (c = e.K.request(7, a, s)),
                    q(H, 2),
                    _(H, c.promise, 4)
                  );
                if (H.g != 2) {
                  if (((f = H.h), (g = []), (m = zt(f.data)), (x = JSON.parse(m)), x.avails.length > 0)) {
                    if (JSON.stringify(e.j) != JSON.stringify(x.avails)) {
                      for (e.j = x.avails, E = I(e.j), A = E.next(); !A.done; A = E.next())
                        for (R = A.value, b = I(R.nonLinearAdsList), D = b.next(); !D.done; D = b.next())
                          for (M = D.value, P = I(M.nonLinearAdList), G = P.next(); !G.done; G = P.next())
                            ((U = G.value), aF(e, U));
                      ((g = e.getCuePoints()),
                        e.i(new Me("ad-cue-points-changed", new Map().set("cuepoints", g))));
                    }
                  } else
                    (e.j.length && e.i(new Me("ad-cue-points-changed", new Map().set("cuepoints", g))),
                      pl(e),
                      (e.j = []));
                  return (r && (e.J || g.length > 0) && lF(e), he(H, 0));
                }
                (ae(H), K(H));
              });
            }
            function aF(e, t) {
              var r, s, a, c, f, g, m, x;
              W(function (E) {
                if (E.g == 1)
                  return !t.staticResource || ((r = kI(t)), e.G.get(r))
                    ? E.return()
                    : ((s = { type: 9 }),
                      (a = fn([t.staticResource], wr())),
                      (c = e.K.request(7, a, s)),
                      q(E, 2),
                      e.G.set(r, []),
                      _(E, c.promise, 4));
                if (E.g != 2)
                  return (
                    (f = E.h),
                    (g = zt(f.data)),
                    (m = JSON.parse(g)),
                    (x = m.apps),
                    e.G.set(r, x),
                    he(E, 0)
                  );
                (ae(E), e.G.delete(r), K(E));
              });
            }
            function kI(e) {
              return [
                e.adId,
                e.adParameters,
                e.adSystem,
                e.adTitle,
                e.creativeAdId,
                e.creativeId,
                e.creativeSequence,
                e.height,
                e.width,
                e.staticResource,
              ].join("");
            }
            function lF(e) {
              (PI(e),
                e.J ||
                  (MI(e),
                  e.o.D(e.h, "seeked", function () {
                    MI(e);
                  }),
                  e.o.D(e.h, "ended", function () {
                    pl(e);
                  })),
                e.o.D(e.h, "timeupdate", function () {
                  PI(e);
                }));
            }
            function MI(e) {
              var t = e.h.currentTime;
              if (t != 0 && e.B == null) {
                for (var r, s, a = I(e.j), c = a.next(); !c.done; c = a.next()) {
                  c = c.value;
                  for (var f = I(c.ads), g = f.next(); !g.done; g = f.next())
                    if (((g = g.value), !s)) g.startTimeInSeconds < t && ((s = g), (r = c));
                    else if (
                      g.startTimeInSeconds < t &&
                      g.startTimeInSeconds > s.startTimeInSeconds + s.durationInSeconds
                    ) {
                      ((s = g), (r = c));
                      break;
                    }
                }
                r && s && !e.N.includes(s.adId) && ((e.B = t), (e.h.currentTime = r.startTimeInSeconds));
              }
            }
            function PI(e) {
              if (e.h.duration && (e.g || e.j.length)) {
                var t = e.h.currentTime,
                  r = !1;
                if (e.g) {
                  r = !0;
                  var s = e.F,
                    a = s.startTimeInSeconds + 0.5 * s.durationInSeconds,
                    c = s.startTimeInSeconds + 0.75 * s.durationInSeconds;
                  (t >= s.startTimeInSeconds + 0.25 * s.durationInSeconds && !e.u.includes("firstQuartile")
                    ? (e.u.push("firstQuartile"), di(e, "firstQuartile"))
                    : t >= a && !e.u.includes("midpoint")
                      ? (e.u.push("midpoint"), di(e, "midpoint"))
                      : t >= c &&
                        !e.u.includes("thirdQuartile") &&
                        (e.u.push("thirdQuartile"), di(e, "thirdQuartile")),
                    (s = e.g.getRemainingTime()),
                    (a = e.g.getDuration()),
                    e.g.canSkipNow() && s > 0 && a > 0 && di(e, "skipStateChanged"),
                    a > 0 && (s <= 0 || s > a) && pl(e));
                }
                if (!e.g || !e.g.isLinear()) {
                  e: for (
                    s = I(e.j), a = s.next();
                    !a.done && ((a = a.value), !(e.g && e.g.isLinear()));
                    a = s.next()
                  )
                    for (c = 0; c < a.ads.length; c++) {
                      var f = a.ads[c],
                        g = f.startTimeInSeconds + f.durationInSeconds;
                      if (f.startTimeInSeconds <= t && g > t) {
                        if (e.N.includes(f.adId)) {
                          if (e.h.ended) continue;
                          e.h.currentTime = g;
                          break e;
                        }
                        (pl(e),
                          (e.M = a),
                          (e.g = new Fe(f, c + 1, a.ads.length, !0, e.h)),
                          (e.F = f),
                          c === 0 && di(e, "breakStart"),
                          OI(e));
                        break;
                      }
                    }
                  if (!e.g) {
                    for (s = I(e.j), a = s.next(); !a.done && ((a = a.value), !e.g); a = s.next())
                      for (c = 0; c < a.nonLinearAdsList.length; c++)
                        if (((f = a.nonLinearAdsList[c]), f.nonLinearAdList.length)) {
                          g = a.startTimeInSeconds;
                          var m = e.G.get(kI(f.nonLinearAdList[0]));
                          if (g <= t && m && m.length) {
                            (pl(e), (g = e), (m = I(m)));
                            for (var x = m.next(); !x.done; x = m.next())
                              if (((x = x.value), x.data.source.length)) {
                                var E = document.createElement("img");
                                ((E.src = x.data.source[0].url),
                                  (E.style.top = (x.placeholder.top || 0) + "%"),
                                  (E.style.height = 100 - (x.placeholder.top || 0) + "%"),
                                  (E.style.left = (x.placeholder.left || 0) + "%"),
                                  (E.style.maxWidth = 100 - (x.placeholder.left || 0) + "%"),
                                  (E.style.objectFit = "contain"),
                                  (E.style.position = "absolute"),
                                  g.C.appendChild(E));
                              }
                            ((e.M = a),
                              (e.g = new Fe(f, c + 1, a.ads.length, !1, e.h)),
                              (e.F = f),
                              c === 0 && di(e, "breakStart"),
                              OI(e));
                            break;
                          }
                        }
                  }
                  r &&
                    !e.g &&
                    ((t = e.h.currentTime), e.B && e.B > t && (e.h.currentTime = e.B), (e.B = null));
                }
              }
            }
            function pl(e) {
              if (e.g) {
                for (; e.C.lastChild; ) e.C.removeChild(e.C.firstChild);
                e.J || e.N.push(e.F.adId);
                var t = e.g.m;
                (t !== void 0 && t ? di(e, "skip") : di(e, "complete"), (t = I(e.m)));
                for (var r = t.next(); !r.done; r = t.next())
                  ((r = r.value), e.o.Ma(r.target, r.type, r.listener));
                ((e.m = []),
                  (e.u = []),
                  (t = e.g.getPositionInSequence()),
                  (r = e.g.getSequenceLength()),
                  t === r && di(e, "breakEnd"),
                  (e.g = null),
                  (e.F = null),
                  (e.M = null));
              }
            }
            function OI(e) {
              var t = !1;
              (e.h.paused ? (t = !0) : (di(e, "impression"), di(e, "start")),
                e.m.push({
                  target: e.h,
                  type: "volumechange",
                  listener: function () {
                    e.h.muted && di(e, "mute");
                  },
                }),
                e.m.push({
                  target: e.h,
                  type: "volumechange",
                  listener: function () {
                    e.h.muted || di(e, "unmute");
                  },
                }),
                e.m.push({
                  target: e.h,
                  type: "play",
                  listener: function () {
                    t ? (di(e, "impression"), di(e, "start"), (t = !1)) : di(e, "resume");
                  },
                }),
                e.m.push({
                  target: e.h,
                  type: "pause",
                  listener: function () {
                    di(e, "pause");
                  },
                }));
              for (var r = I(e.m), s = r.next(); !s.done; s = r.next())
                ((s = s.value), e.o.D(s.target, s.type, s.listener));
            }
            function di(e, t) {
              var r = e.F.trackingEvents.find(function (c) {
                return c.eventType == t;
              });
              if (
                (r ||
                  (r = e.M.adBreakTrackingEvents.find(function (c) {
                    return c.eventType == t;
                  })),
                r)
              ) {
                var s = { type: 10 };
                r = I(r.beaconUrls);
                for (var a = r.next(); !a.done; a = r.next())
                  (a = a.value) &&
                    a != "" &&
                    ((a = fn([a], wr())), (a.method = "POST"), e.K.request(7, a, s));
              }
              switch (t) {
                case "impression":
                  e.i(new Me("ad-impression"));
                  break;
                case "start":
                  e.i(new Me("ad-started", new Map().set("ad", e.g)));
                  break;
                case "mute":
                  e.i(new Me("ad-muted"));
                  break;
                case "unmute":
                  e.i(new Me("ad-volume-changed"));
                  break;
                case "resume":
                  e.i(new Me("ad-resumed"));
                  break;
                case "pause":
                  e.i(new Me("ad-paused"));
                  break;
                case "firstQuartile":
                  e.i(new Me("ad-first-quartile"));
                  break;
                case "midpoint":
                  e.i(new Me("ad-midpoint"));
                  break;
                case "thirdQuartile":
                  e.i(new Me("ad-third-quartile"));
                  break;
                case "complete":
                  (e.i(new Me("ad-complete")), e.i(new Me("ad-stopped")));
                  break;
                case "skip":
                  (e.i(new Me("ad-skipped")), e.i(new Me("ad-stopped")));
                  break;
                case "breakStart":
                  e.C.setAttribute("ad-active", "true");
                  break;
                case "breakEnd":
                  e.C.removeAttribute("ad-active");
                  break;
                case "skipStateChanged":
                  e.i(new Me("ad-skip-state-changed"));
              }
            }
            function Ve(e, t) {
              ((this.g = e), (this.i = null), (this.h = t));
            }
            ((d = Ve.prototype),
              (d.needsSkipUI = function () {
                return !0;
              }),
              (d.isClientRendering = function () {
                return !1;
              }),
              (d.hasCustomClick = function () {
                return !0;
              }),
              (d.isUsingAnotherMediaElement = function () {
                return !1;
              }),
              (d.getDuration = function () {
                return this.i ? this.i.duration : -1;
              }),
              (d.getMinSuggestedDuration = function () {
                return this.getDuration();
              }),
              (d.getRemainingTime = function () {
                return this.i ? this.i.duration - this.i.currentTime : -1;
              }),
              (d.isPaused = function () {
                return this.h.paused;
              }),
              (d.isSkippable = function () {
                return this.g.isSkippable();
              }),
              (d.getTimeUntilSkippable = function () {
                var e = this.g.getSkipTimeOffset();
                return ((e = this.getRemainingTime() - e), Math.max(e, 0));
              }),
              (d.canSkipNow = function () {
                return this.getTimeUntilSkippable() == 0;
              }),
              (d.skip = function () {
                this.h.currentTime += this.getRemainingTime();
              }),
              (d.pause = function () {
                return this.h.pause();
              }),
              (d.play = function () {
                return this.h.play();
              }),
              (d.getVolume = function () {
                return this.h.volume;
              }),
              (d.setVolume = function (e) {
                this.h.volume = e;
              }),
              (d.isMuted = function () {
                return this.h.muted;
              }),
              (d.isLinear = function () {
                return !0;
              }),
              (d.resize = function () {}),
              (d.setMuted = function (e) {
                this.h.muted = e;
              }),
              (d.getSequenceLength = function () {
                var e = this.g.getAdPodInfo();
                return e == null ? 1 : e.getTotalAds();
              }),
              (d.getPositionInSequence = function () {
                var e = this.g.getAdPodInfo();
                return e == null ? 1 : e.getAdPosition();
              }),
              (d.getTitle = function () {
                return this.g.getTitle();
              }),
              (d.getDescription = function () {
                return this.g.getDescription();
              }),
              (d.getVastMediaBitrate = function () {
                return 0;
              }),
              (d.getVastMediaHeight = function () {
                return this.g.getVastMediaHeight();
              }),
              (d.getVastMediaWidth = function () {
                return this.g.getVastMediaWidth();
              }),
              (d.getVastAdId = function () {
                return "";
              }),
              (d.getAdId = function () {
                return this.g.getAdId();
              }),
              (d.getCreativeAdId = function () {
                return this.g.getCreativeAdId();
              }),
              (d.getAdvertiserName = function () {
                return this.g.getAdvertiserName();
              }),
              (d.getMediaUrl = function () {
                return null;
              }),
              (d.getTimeOffset = function () {
                var e = this.g.getAdPodInfo();
                return e == null ? 0 : e.getTimeOffset();
              }),
              (d.getPodIndex = function () {
                var e = this.g.getAdPodInfo();
                return e == null ? 0 : e.getPodIndex();
              }),
              (d.release = function () {
                this.h = this.i = this.g = null;
              }),
              Ee("shaka.ads.ServerSideAd", Ve),
              (Ve.prototype.release = Ve.prototype.release),
              (Ve.prototype.getPodIndex = Ve.prototype.getPodIndex),
              (Ve.prototype.getTimeOffset = Ve.prototype.getTimeOffset),
              (Ve.prototype.getMediaUrl = Ve.prototype.getMediaUrl),
              (Ve.prototype.getAdvertiserName = Ve.prototype.getAdvertiserName),
              (Ve.prototype.getCreativeAdId = Ve.prototype.getCreativeAdId),
              (Ve.prototype.getAdId = Ve.prototype.getAdId),
              (Ve.prototype.getVastAdId = Ve.prototype.getVastAdId),
              (Ve.prototype.getVastMediaWidth = Ve.prototype.getVastMediaWidth),
              (Ve.prototype.getVastMediaHeight = Ve.prototype.getVastMediaHeight),
              (Ve.prototype.getVastMediaBitrate = Ve.prototype.getVastMediaBitrate),
              (Ve.prototype.getDescription = Ve.prototype.getDescription),
              (Ve.prototype.getTitle = Ve.prototype.getTitle),
              (Ve.prototype.getPositionInSequence = Ve.prototype.getPositionInSequence),
              (Ve.prototype.getSequenceLength = Ve.prototype.getSequenceLength),
              (Ve.prototype.setMuted = Ve.prototype.setMuted),
              (Ve.prototype.resize = Ve.prototype.resize),
              (Ve.prototype.isLinear = Ve.prototype.isLinear),
              (Ve.prototype.isMuted = Ve.prototype.isMuted),
              (Ve.prototype.setVolume = Ve.prototype.setVolume),
              (Ve.prototype.getVolume = Ve.prototype.getVolume),
              (Ve.prototype.play = Ve.prototype.play),
              (Ve.prototype.pause = Ve.prototype.pause),
              (Ve.prototype.skip = Ve.prototype.skip),
              (Ve.prototype.canSkipNow = Ve.prototype.canSkipNow),
              (Ve.prototype.getTimeUntilSkippable = Ve.prototype.getTimeUntilSkippable),
              (Ve.prototype.isSkippable = Ve.prototype.isSkippable),
              (Ve.prototype.isPaused = Ve.prototype.isPaused),
              (Ve.prototype.getRemainingTime = Ve.prototype.getRemainingTime),
              (Ve.prototype.getMinSuggestedDuration = Ve.prototype.getMinSuggestedDuration),
              (Ve.prototype.getDuration = Ve.prototype.getDuration),
              (Ve.prototype.isUsingAnotherMediaElement = Ve.prototype.isUsingAnotherMediaElement),
              (Ve.prototype.hasCustomClick = Ve.prototype.hasCustomClick),
              (Ve.prototype.isClientRendering = Ve.prototype.isClientRendering),
              (Ve.prototype.needsSkipUI = Ve.prototype.needsSkipUI));
            function NI(e, t, r, s) {
              var a = this;
              ((this.u = e),
                (this.l = t),
                (this.j = null),
                (this.G = NaN),
                (this.i = s),
                (this.H = !1),
                (this.B = this.m = this.o = null),
                (this.C = ""),
                (this.F = []),
                (this.h = new gt()),
                (e = new google.ima.dai.api.UiSettings()),
                e.setLocale(r),
                (this.g = new google.ima.dai.api.StreamManager(this.l, this.u, e)),
                this.i(new Me("ima-stream-manager-loaded", new Map().set("imaStreamManager", this.g))),
                this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.LOADED, function (c) {
                  uF(a, c);
                }),
                this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.ERROR, function () {
                  (a.C.length
                    ? a.j.resolve(a.C)
                    : a.j.reject(
                        "IMA Stream request returned an error and there was no backup asset uri provided.",
                      ),
                    (a.j = null));
                }),
                this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.AD_BREAK_STARTED, function () {}),
                this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.STARTED, function (c) {
                  ((c = c.getAd()),
                    (a.m = new Ve(c, a.l)),
                    a.B && (a.m.i = a.B),
                    a.i(new Me("ad-started", new Map().set("ad", a.m))),
                    a.u.setAttribute("ad-active", "true"));
                }),
                this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.AD_BREAK_ENDED, function () {
                  a.u.removeAttribute("ad-active");
                  var c = a.l.currentTime;
                  a.o && a.o > c && ((a.l.currentTime = a.o), (a.o = null));
                }),
                this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.AD_PROGRESS, function (c) {
                  ((a.B = c.getStreamData().adProgressData), a.m && (a.m.i = a.B));
                }),
                this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.FIRST_QUARTILE, function () {
                  a.i(new Me("ad-first-quartile"));
                }),
                this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.MIDPOINT, function () {
                  a.i(new Me("ad-midpoint"));
                }),
                this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.THIRD_QUARTILE, function () {
                  a.i(new Me("ad-third-quartile"));
                }),
                this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.COMPLETE, function () {
                  (a.i(new Me("ad-complete")),
                    a.i(new Me("ad-stopped")),
                    a.u.removeAttribute("ad-active"),
                    (a.m = null));
                }),
                this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.SKIPPED, function () {
                  (a.i(new Me("ad-skipped")), a.i(new Me("ad-stopped")));
                }),
                this.h.D(this.g, google.ima.dai.api.StreamEvent.Type.CUEPOINTS_CHANGED, function (c) {
                  var f = c.getStreamData();
                  ((c = []), (f = I(f.cuepoints)));
                  for (var g = f.next(); !g.done; g = f.next())
                    ((g = g.value), c.push({ start: g.start, end: g.end }));
                  ((a.F = c), a.i(new Me("ad-cue-points-changed", new Map().set("cuepoints", c))));
                }));
            }
            ((d = NI.prototype),
              (d.configure = function () {}),
              (d.stop = function () {
                ((this.C = ""), (this.o = null), (this.F = []));
              }),
              (d.release = function () {
                (this.stop(), this.h && this.h.release());
              }),
              (d.onCueMetadataChange = function (e) {
                if (e.key && e.data) {
                  var t = {};
                  ((t[e.key] = e.data), this.g.onTimedMetadata(t));
                }
              }),
              (d.getCuePoints = function () {
                return this.F;
              }));
            function uF(e, t) {
              (e.i(new Me("ads-loaded", new Map().set("loadTime", Date.now() / 1e3 - e.G))),
                (t = t.getStreamData().url),
                e.j.resolve(t),
                (e.j = null),
                e.H ||
                  e.h.D(e.l, "seeked", function () {
                    var r = e.l.currentTime;
                    if (r != 0) {
                      e.g.streamTimeForContentTime(r);
                      var s = e.g.previousCuePointForStreamTime(r);
                      s && !s.played && ((e.o = r), (e.l.currentTime = s.start));
                    }
                  }));
            }
            function _e() {
              (Lt.call(this),
                (this.h = this.i = this.j = this.g = null),
                (this.m = new EI()),
                (this.o = navigator.language),
                (this.l = null));
            }
            (N(_e, Lt),
              (d = _e.prototype),
              (d.setLocale = function (e) {
                this.o = e;
              }),
              (d.configure = function (e) {
                ((this.l = e),
                  this.g && this.g.configure(this.l),
                  this.j && this.j.configure(this.l),
                  this.h && this.h.configure(this.l));
              }),
              (d.initInterstitial = function (e, t, r) {
                var s = this;
                (this.g && this.g.release(),
                  (this.g = new RI(e, t, r, function (a) {
                    return Af(s, a);
                  })),
                  this.g.configure(this.l));
              }),
              (d.initClientSide = function (e, t, r) {
                var s = this;
                if (!l.google || !google.ima || !google.ima.AdsLoader) throw new ee(2, 10, 1e4);
                (this.j && this.j.release(),
                  (this.j = new xf(e, t, this.o, r, function (a) {
                    return Af(s, a);
                  })),
                  this.j.configure(this.l));
              }),
              (d.release = function () {
                (this.g && (this.g.release(), (this.g = null)),
                  this.j && (this.j.release(), (this.j = null)),
                  this.i && (this.i.release(), (this.i = null)),
                  this.h && (this.h.release(), (this.h = null)),
                  Lt.prototype.release.call(this));
              }),
              (d.onAssetUnload = function () {
                (this.g && this.g.stop(),
                  this.j && this.j.stop(),
                  this.i && this.i.stop(),
                  this.h && this.h.stop(),
                  this.dispatchEvent(new Me("ad-stopped")),
                  this.dispatchEvent(new Me("ad-content-attach-requested")),
                  (this.m = new EI()));
              }),
              (d.requestClientSideAds = function (e) {
                if (!this.j) throw new ee(1, 10, 10001);
                var t = this.j;
                (t.g && t.g.destroy(),
                  t.m && t.m.contentComplete(),
                  (t.H = Date.now() / 1e3),
                  t.m.requestAds(e));
              }),
              (d.updateClientSideAdsRenderingSettings = function (e) {
                if (!this.j) throw new ee(1, 10, 10001);
                var t = this.j;
                ((t.C = e), t.g && t.g.updateAdsRenderingSettings(t.C));
              }),
              (d.initMediaTailor = function (e, t, r) {
                var s = this;
                (this.i && this.i.release(),
                  (this.i = new gc(e, t, r, function (a) {
                    return Af(s, a);
                  })));
              }),
              (d.requestMediaTailorStream = function (e, t, r) {
                if (!this.i) throw new ee(1, 10, 10005);
                var s = this.i;
                return (
                  (r = r === void 0 ? "" : r),
                  s.l
                    ? (e = Promise.reject(new ee(1, 10, 10004)))
                    : ((s.l = new _t()), sF(s, e, t), (s.I = r || ""), (s.R = Date.now() / 1e3), (e = s.l)),
                  e
                );
              }),
              (d.addMediaTailorTrackingUrl = function (e) {
                if (!this.i) throw new ee(1, 10, 10005);
                var t = this.i;
                ((t.H = e), t.i(new Me("ads-loaded", new Map().set("loadTime", 0))));
              }),
              (d.initServerSide = function (e, t) {
                var r = this;
                if (!l.google || !google.ima || !google.ima.dai) throw new ee(2, 10, 10002);
                (this.h && this.h.release(),
                  (this.h = new NI(e, t, this.o, function (s) {
                    return Af(r, s);
                  })),
                  this.h.configure(this.l));
              }),
              (d.requestServerSideStream = function (e, t) {
                if (((t = t === void 0 ? "" : t), !this.h)) throw new ee(1, 10, 10003);
                e.adTagParameters || (e.adTagParameters = {});
                var r = e.adTagParameters;
                return (
                  (r.mpt || r.mpv) &&
                    He(
                      'You have attempted to set "mpt" and/or "mpv" parameters of the ad tag. Please note that those parameters are used for Shaka adoption tracking and will be overridden.',
                    ),
                  (e.adTagParameters.mpt = "shaka-player"),
                  (e.adTagParameters.mpv = "v4.16.12"),
                  (r = this.h),
                  r.j
                    ? (e = Promise.reject(new ee(1, 10, 10004)))
                    : (e instanceof google.ima.dai.api.LiveStreamRequest && (r.H = !0),
                      (r.j = new _t()),
                      r.g.requestStream(e),
                      (r.C = t || ""),
                      (r.G = Date.now() / 1e3),
                      (e = r.j)),
                  e
                );
              }),
              (d.replaceServerSideAdTagParameters = function (e) {
                if (!this.h) throw new ee(1, 10, 10003);
                ((e.mpt || e.mpv) &&
                  He(
                    'You have attempted to set "mpt" and/or "mpv" parameters of the ad tag. Please note that those parameters are used for Shaka adoption tracking and will be overridden.',
                  ),
                  (e.mpt = "Shaka Player"),
                  (e.mpv = "v4.16.12"),
                  this.h.g.replaceAdTagParameters(e));
              }),
              (d.getServerSideCuePoints = function () {
                return (
                  ft("AdManager.getServerSideCuePoints", "Please use getCuePoints function."),
                  this.getCuePoints()
                );
              }),
              (d.getCuePoints = function () {
                var e = [];
                return (
                  this.h && (e = e.concat(this.h.getCuePoints())),
                  this.i && (e = e.concat(this.i.getCuePoints())),
                  e
                );
              }),
              (d.getStats = function () {
                var e = this.m;
                return {
                  loadTimes: e.g,
                  averageLoadTime: zN(e),
                  started: e.h,
                  overlayAds: e.j,
                  playedCompletely: e.l,
                  skipped: e.m,
                  errors: e.i,
                };
              }),
              (d.onManifestUpdated = function (e) {
                this.i && this.i.onManifestUpdated(e);
              }),
              (d.onDashTimedMetadata = function (e) {
                this.h &&
                  e.schemeIdUri == "urn:google:dai:2018" &&
                  this.h.g.processMetadata(
                    e.schemeIdUri,
                    e.eventNode ? e.eventNode.attributes.messageData : null,
                    e.startTime,
                  );
              }),
              (d.onHlsTimedMetadata = function (e, t) {
                this.h && this.h.g.processMetadata("ID3", e.data, t);
              }),
              (d.onCueMetadataChange = function (e) {
                this.h && this.h.onCueMetadataChange(e);
              }),
              (d.onHLSInterstitialMetadata = function (e, t, r) {
                (this.l && this.l.disableHLSInterstitial) ||
                  (this.g || this.initInterstitial(null, e, t), this.g && ZN(this.g, r));
              }),
              (d.onDASHInterstitialMetadata = function (e, t, r) {
                if (!this.l || !this.l.disableDASHInterstitial) {
                  var s = r.schemeIdUri;
                  if (
                    s == "urn:mpeg:dash:event:alternativeMPD:insert:2025" ||
                    s == "urn:mpeg:dash:event:alternativeMPD:replace:2025"
                  ) {
                    if (
                      (this.g || this.initInterstitial(null, e, t),
                      this.g &&
                        ((e = this.g),
                        (t = r.schemeIdUri == "urn:mpeg:dash:event:alternativeMPD:replace:2025"),
                        (s = r.schemeIdUri == "urn:mpeg:dash:event:alternativeMPD:insert:2025"),
                        t || s))
                    ) {
                      for (
                        var a = r.startTime,
                          c = r.endTime,
                          f = null,
                          g = 0,
                          m,
                          x = I(r.eventNode.children),
                          E = x.next();
                        !E.done;
                        E = x.next()
                      )
                        if (((E = E.value), E.tagName == "AlternativeMPD")) {
                          if ((E = E.attributes.uri)) {
                            m = E;
                            break;
                          }
                        } else if (E.tagName == "InsertPresentation" || E.tagName == "ReplacePresentation") {
                          var A = E.attributes.url;
                          if (A) {
                            ((m = li(A)),
                              (x = ze(E, "maxDuration", Nn)) && (f = x / r.timescale),
                              (x = ze(E, "returnOffset", Nn)) && (g = x / r.timescale),
                              t && g && (c = a + g));
                            break;
                          }
                        }
                      m &&
                        pc(e, [
                          {
                            id: r.id,
                            groupId: null,
                            startTime: a,
                            endTime: c,
                            uri: m,
                            mimeType: null,
                            isSkippable: !1,
                            skipOffset: null,
                            skipFor: null,
                            canJump: !0,
                            resumeOffset: s ? g : null,
                            playoutLimit: f,
                            once: !1,
                            pre: !1,
                            post: !1,
                            timelineRange: t && !s,
                            loop: !1,
                            overlay: null,
                            displayOnBackground: !1,
                            currentVideo: null,
                            background: null,
                            clickThroughUrl: null,
                          },
                        ]);
                    }
                  } else
                    (s == "urn:mpeg:dash:event:2012" || s == "urn:scte:dash:scte214-events") &&
                      r.eventNode &&
                      jt(r.eventNode, "OverlayEvent") &&
                      (this.g || this.initInterstitial(null, e, t), this.g && eF(this.g, r));
                }
              }),
              (d.addCustomInterstitial = function (e) {
                if (!this.g) throw new ee(1, 10, 10006);
                pc(this.g, [e]);
              }),
              (d.addAdUrlInterstitial = function (e) {
                if (!this.g) throw new ee(1, 10, 10006);
                return this.g.addAdUrlInterstitial(e);
              }),
              (d.getInterstitialPlayer = function () {
                if (!this.g) throw new ee(1, 10, 10006);
                return this.g.td();
              }));
            function Af(e, t) {
              if (t && t.type)
                switch (t.type) {
                  case "ads-loaded":
                    e.m.g.push(t.loadTime);
                    break;
                  case "ad-started":
                    e.m.h++;
                    var r = t.ad;
                    r && !r.isLinear() && e.m.j++;
                    break;
                  case "ad-complete":
                    e.m.l++;
                    break;
                  case "ad-skipped":
                    e.m.m++;
                    break;
                  case "ad-error":
                    e.m.i++;
                }
              e.dispatchEvent(t);
            }
            (Ee("shaka.ads.AdManager", _e),
              (_e.prototype.getInterstitialPlayer = _e.prototype.getInterstitialPlayer),
              (_e.prototype.addAdUrlInterstitial = _e.prototype.addAdUrlInterstitial),
              (_e.prototype.addCustomInterstitial = _e.prototype.addCustomInterstitial),
              (_e.prototype.onDASHInterstitialMetadata = _e.prototype.onDASHInterstitialMetadata),
              (_e.prototype.onHLSInterstitialMetadata = _e.prototype.onHLSInterstitialMetadata),
              (_e.prototype.onCueMetadataChange = _e.prototype.onCueMetadataChange),
              (_e.prototype.onHlsTimedMetadata = _e.prototype.onHlsTimedMetadata),
              (_e.prototype.onDashTimedMetadata = _e.prototype.onDashTimedMetadata),
              (_e.prototype.onManifestUpdated = _e.prototype.onManifestUpdated),
              (_e.prototype.getStats = _e.prototype.getStats),
              (_e.prototype.getCuePoints = _e.prototype.getCuePoints),
              (_e.prototype.getServerSideCuePoints = _e.prototype.getServerSideCuePoints),
              (_e.prototype.replaceServerSideAdTagParameters = _e.prototype.replaceServerSideAdTagParameters),
              (_e.prototype.requestServerSideStream = _e.prototype.requestServerSideStream),
              (_e.prototype.initServerSide = _e.prototype.initServerSide),
              (_e.prototype.addMediaTailorTrackingUrl = _e.prototype.addMediaTailorTrackingUrl),
              (_e.prototype.requestMediaTailorStream = _e.prototype.requestMediaTailorStream),
              (_e.prototype.initMediaTailor = _e.prototype.initMediaTailor),
              (_e.prototype.updateClientSideAdsRenderingSettings =
                _e.prototype.updateClientSideAdsRenderingSettings),
              (_e.prototype.requestClientSideAds = _e.prototype.requestClientSideAds),
              (_e.prototype.onAssetUnload = _e.prototype.onAssetUnload),
              (_e.prototype.release = _e.prototype.release),
              (_e.prototype.initClientSide = _e.prototype.initClientSide),
              (_e.prototype.initInterstitial = _e.prototype.initInterstitial),
              (_e.prototype.configure = _e.prototype.configure),
              (_e.prototype.setLocale = _e.prototype.setLocale),
              (_e.ADS_LOADED = "ads-loaded"),
              (_e.AD_STARTED = "ad-started"),
              (_e.AD_FIRST_QUARTILE = "ad-first-quartile"),
              (_e.AD_MIDPOINT = "ad-midpoint"),
              (_e.AD_THIRD_QUARTILE = "ad-third-quartile"),
              (_e.AD_COMPLETE = "ad-complete"),
              (_e.AD_STOPPED = "ad-stopped"),
              (_e.AD_SKIPPED = "ad-skipped"),
              (_e.AD_VOLUME_CHANGED = "ad-volume-changed"),
              (_e.AD_MUTED = "ad-muted"),
              (_e.AD_PAUSED = "ad-paused"),
              (_e.AD_RESUMED = "ad-resumed"),
              (_e.AD_SKIP_STATE_CHANGED = "ad-skip-state-changed"),
              (_e.CUEPOINTS_CHANGED = "ad-cue-points-changed"),
              (_e.IMA_AD_MANAGER_LOADED = "ima-ad-manager-loaded"),
              (_e.IMA_STREAM_MANAGER_LOADED = "ima-stream-manager-loaded"),
              (_e.AD_CLICKED = "ad-clicked"),
              (_e.AD_PROGRESS = "ad-progress"),
              (_e.AD_BUFFERING = "ad-buffering"),
              (_e.AD_IMPRESSION = "ad-impression"),
              (_e.AD_DURATION_CHANGED = "ad-duration-changed"),
              (_e.AD_CLOSED = "ad-closed"),
              (_e.AD_LOADED = "ad-loaded"),
              (_e.ALL_ADS_COMPLETED = "all-ads-completed"),
              (_e.AD_LINEAR_CHANGED = "ad-linear-changed"),
              (_e.AD_METADATA = "ad-metadata"),
              (_e.AD_RECOVERABLE_ERROR = "ad-recoverable-error"),
              (_e.AD_ERROR = "ad-error"),
              (_e.AD_BREAK_READY = "ad-break-ready"),
              (_e.AD_INTERACTION = "ad-interaction"),
              (_e.AD_CONTENT_PAUSE_REQUESTED = "ad-content-pause-requested"),
              (_e.AD_CONTENT_RESUME_REQUESTED = "ad-content-resume-requested"),
              (_e.AD_CONTENT_ATTACH_REQUESTED = "ad-content-attach-requested"),
              (yf = function () {
                return new _e();
              }));
            function ly(e) {
              return JSON.stringify(e, function (t, r) {
                if (typeof r != "function") {
                  if (((t = r instanceof Me), r instanceof Event || t)) {
                    var s = {};
                    for (c in r) {
                      var a = r[c];
                      a && typeof a == "object"
                        ? c == "detail"
                          ? (s[c] = a)
                          : a instanceof Event || a instanceof Me
                            ? (s[c] = { __type__: "Event", event: ly(a) })
                            : t && Array.isArray(a) && (s[c] = a)
                        : c in Event || (s[c] = a);
                    }
                    return s;
                  }
                  if (r instanceof Error) {
                    var c = new Set(["name", "message", "stack"]);
                    for (s in r) c.add(s);
                    for (t = I(Object.getOwnPropertyNames(r)), s = t.next(); !s.done; s = t.next())
                      c.add(s.value);
                    for (t = {}, c = I(c), s = c.next(); !s.done; s = c.next())
                      ((s = s.value), (t[s] = r[s]));
                    r = { __type__: "Error", contents: t };
                  } else if (r instanceof TimeRanges) {
                    for (
                      c = { __type__: "TimeRanges", length: r.length, start: [], end: [] },
                        r = I(Cs(r)),
                        t = r.next();
                      !t.done;
                      t = r.next()
                    )
                      ((t = t.value), (s = t.end), c.start.push(t.start), c.end.push(s));
                    r = c;
                  } else
                    r =
                      ArrayBuffer.isView(r) && r.BYTES_PER_ELEMENT === 1
                        ? { __type__: "Uint8Array", entries: Array.from(r) }
                        : typeof r == "number"
                          ? isNaN(r)
                            ? "NaN"
                            : isFinite(r)
                              ? r
                              : r < 0
                                ? "-Infinity"
                                : "Infinity"
                          : r;
                  return r;
                }
              });
            }
            function If(e) {
              return JSON.parse(e, function (t, r) {
                if (r == "NaN") var s = NaN;
                else if (r == "-Infinity") s = -1 / 0;
                else if (r == "Infinity") s = 1 / 0;
                else if (r && typeof r == "object" && r.__type__ == "TimeRanges") s = cF(r);
                else if (r && typeof r == "object" && r.__type__ == "Uint8Array")
                  s = new Uint8Array(r.entries);
                else if (r && typeof r == "object" && r.__type__ == "Error") {
                  ((t = r.contents), (r = Error(t.message)));
                  for (s in t) r[s] = t[s];
                  s = r;
                } else s = r && typeof r == "object" && r.__type__ == "Event" ? If(r.event) : r;
                return s;
              });
            }
            function cF(e) {
              return {
                length: e.length,
                start: function (t) {
                  return e.start[t];
                },
                end: function (t) {
                  return e.end[t];
                },
              };
            }
            var FI =
                "ended play playing pause pausing ratechange seeked seeking timeupdate volumechange".split(
                  " ",
                ),
              dF =
                "buffered currentTime duration ended loop muted paused playbackRate seeking videoHeight videoWidth volume".split(
                  " ",
                ),
              uy = ["loop", "playbackRate"],
              hF = ["pause", "play"],
              cy = new Map()
                .set("getAssetUri", 2)
                .set("getAudioLanguages", 4)
                .set("getAudioLanguagesAndRoles", 4)
                .set("getBufferFullness", 1)
                .set("getBufferedInfo", 2)
                .set("getExpiration", 2)
                .set("getKeyStatuses", 2)
                .set("getPlaybackRate", 2)
                .set("getTextLanguages", 4)
                .set("getTextLanguagesAndRoles", 4)
                .set("isAudioOnly", 10)
                .set("isBuffering", 1)
                .set("isInProgress", 1)
                .set("isLive", 10)
                .set("isTextTrackVisible", 1)
                .set("isVideoOnly", 10)
                .set("keySystem", 10)
                .set("seekRange", 1)
                .set("getLoadMode", 10)
                .set("getManifestType", 10)
                .set("isFullyLoaded", 1)
                .set("isEnded", 1)
                .set("getBandwidthEstimate", 1)
                .set("isRemotePlayback", 1),
              dy = new Map()
                .set("getConfiguration", 4)
                .set("getConfigurationForLowLatency", 4)
                .set("getStats", 5)
                .set("getAudioTracks", 2)
                .set("getChaptersTracks", 2)
                .set("getImageTracks", 2)
                .set("getVideoTracks", 2)
                .set("getTextTracks", 2)
                .set("getVariantTracks", 2),
              UI = new Map()
                .set("getPlayheadTimeAsDate", 1)
                .set("getPresentationStartTimeAsDate", 20)
                .set("getSegmentAvailabilityDuration", 20),
              BI = [
                [
                  "getConfiguration",
                  "configure",
                  "getConfigurationForLowLatency",
                  "configurationForLowLatency",
                ],
              ],
              $I = [["isTextTrackVisible", "setTextTrackVisibility"]],
              fF =
                "cancelTrickPlay configure configurationForLowLatency getChapters resetConfiguration retryStreaming selectAudioLanguage selectAudioTrack selectTextLanguage selectTextTrack selectVariantTrack selectVariantsByLabel selectVideoTrack setTextTrackVisibility trickPlay updateStartTime goToLive useTrickPlayTrackIfAvailable".split(
                  " ",
                ),
              pF =
                "addChaptersTrack addTextTrackAsync addThumbnailsTrack getAllThumbnails getChaptersAsync getThumbnails attach attachCanvas detach load unload".split(
                  " ",
                );
            function hy(e, t, r, s, a, c, f) {
              var g = this;
              ((this.H = e),
                (this.K = f),
                (this.l = new it(t)),
                (this.M = r),
                (this.u = !1),
                (this.B = s),
                (this.G = a),
                (this.N = c),
                (this.i = this.m = !1),
                (this.J = ""),
                (this.o = null),
                (this.C = function () {
                  return fy(g);
                }),
                (this.F = function (m, x) {
                  switch (((m = If(x)), m.type)) {
                    case "event":
                      var E = m.targetName,
                        A = bE(m.event);
                      g.B(E, A);
                      break;
                    case "update":
                      E = m.update;
                      for (A in E) {
                        m = g.g[A] || {};
                        for (var R in E[A]) m[R] = E[A][R];
                      }
                      g.u && (g.M(), (g.u = !1));
                      break;
                    case "asyncComplete":
                      if (((R = m.id), (A = m.error), (x = m.res), (m = g.h.get(R)), g.h.delete(R), m))
                        if (A) {
                          R = new ee(A.severity, A.category, A.code);
                          for (E in A) R[E] = A[E];
                          m.reject(R);
                        } else m.resolve(x);
                  }
                }),
                (this.g = { video: {}, player: {} }),
                (this.I = 0),
                (this.h = new Map()),
                (this.j = null),
                yc.add(this));
            }
            ((d = hy.prototype),
              (d.destroy = function () {
                return (
                  yc.delete(this),
                  py(this),
                  Cr && jI(this),
                  this.l && (this.l.stop(), (this.l = null)),
                  (this.G = this.B = null),
                  (this.i = this.m = !1),
                  (this.F = this.C = this.j = this.h = this.g = this.o = null),
                  Promise.resolve()
                );
              }),
              (d.wb = function () {
                return this.i;
              }),
              (d.eh = function () {
                return this.J;
              }),
              (d.init = function () {
                if (this.H.length)
                  if (l.chrome && chrome.cast && chrome.cast.isAvailable) {
                    ((this.m = !0), this.l.Jb());
                    var e = new chrome.cast.SessionRequest(this.H, [], null, this.K, null);
                    ((e = new chrome.cast.ApiConfig(
                      e,
                      function (t) {
                        for (var r = I(yc), s = r.next(); !s.done; s = r.next()) {
                          s = s.value;
                          var a = t;
                          ((s.j = new _t()), (s.u = !0), wf(s, a));
                        }
                      },
                      function (t) {
                        for (var r = I(yc), s = r.next(); !s.done; s = r.next())
                          ((s = s.value), (Rf = t == "available"), s.l.Jb());
                      },
                      "origin_scoped",
                    )),
                      chrome.cast.initialize(
                        e,
                        function () {},
                        function () {},
                      ),
                      Rf && this.l.ka(mF),
                      (e = Cr) && e.status != chrome.cast.SessionStatus.STOPPED
                        ? ((this.j = new _t()), (this.u = !0), wf(this, e))
                        : (Cr = null));
                  } else
                    l.__onGCastApiAvailable !== VI &&
                      ((Cf = l.__onGCastApiAvailable || null), (l.__onGCastApiAvailable = VI));
              }),
              (d.qh = function (e) {
                ((this.o = e), this.i && mc(this, { type: "appData", appData: this.o }));
              }),
              (d.cast = function () {
                var e = this;
                return W(function (t) {
                  if (!e.m) throw new ee(1, 8, 8e3);
                  if (!Rf) throw new ee(1, 8, 8001);
                  if (e.i) throw new ee(1, 8, 8002);
                  return (
                    (e.j = new _t()),
                    chrome.cast.requestSession(
                      function (r) {
                        return wf(e, r);
                      },
                      function (r) {
                        return GI(e, r);
                      },
                    ),
                    _(t, e.j, 0)
                  );
                });
              }));
            function gF(e) {
              e.i &&
                chrome.cast.requestSession(
                  function (t) {
                    return wf(e, t);
                  },
                  function (t) {
                    return GI(e, t);
                  },
                );
            }
            ((d.qd = function () {
              if (this.i) {
                if ((py(this), Cr)) {
                  jI(this);
                  try {
                    Cr.stop(
                      function () {},
                      function () {},
                    );
                  } catch (e) {}
                  Cr = null;
                }
                fy(this);
              }
            }),
              (d.get = function (e, t) {
                var r = this;
                if (e == "video") {
                  if (hF.includes(t))
                    return function () {
                      return r.Mi.apply(r, [e, t].concat(V(Qe.apply(0, arguments))));
                    };
                } else if (e == "player") {
                  if (UI.has(t) && !this.get("player", "isLive")()) return function () {};
                  if (fF.includes(t))
                    return function () {
                      return r.Mi.apply(r, [e, t].concat(V(Qe.apply(0, arguments))));
                    };
                  if (pF.includes(t))
                    return function () {
                      return r.Pk.apply(r, [e, t].concat(V(Qe.apply(0, arguments))));
                    };
                  if (cy.has(t) || dy.has(t))
                    return function () {
                      return r.g[e][t];
                    };
                }
                return this.g[e][t];
              }),
              (d.set = function (e, t, r) {
                ((this.g[e][t] = r), mc(this, { type: "set", targetName: e, property: t, value: r }));
              }));
            function wf(e, t) {
              var r = e.N();
              ((Cr = t),
                t.addUpdateListener(e.C),
                t.addMessageListener("urn:x-cast:com.google.shaka.v2", e.F),
                fy(e),
                mc(e, { type: "init", initState: r, appData: e.o }),
                e.j.resolve());
            }
            function GI(e, t) {
              var r = 8003;
              switch (t.code) {
                case "cancel":
                  r = 8004;
                  break;
                case "timeout":
                  r = 8005;
                  break;
                case "receiver_unavailable":
                  r = 8006;
              }
              e.j.reject(new ee(2, 8, r, t));
            }
            ((d.Mi = function (e, t) {
              mc(this, { type: "call", targetName: e, methodName: t, args: Qe.apply(2, arguments) });
            }),
              (d.Pk = function (e, t) {
                var r = Qe.apply(2, arguments),
                  s = new _t(),
                  a = this.I.toString();
                (this.I++, this.h.set(a, s));
                try {
                  mc(this, { type: "asyncCall", targetName: e, methodName: t, args: r, id: a });
                } catch (c) {
                  s.reject(c);
                }
                return s;
              }));
            function jI(e) {
              var t = Cr;
              (t.removeUpdateListener(e.C), t.removeMessageListener("urn:x-cast:com.google.shaka.v2", e.F));
            }
            function fy(e) {
              var t = Cr ? Cr.status == "connected" : !1;
              if (e.i && !t) {
                e.G();
                for (var r in e.g) e.g[r] = {};
                py(e);
              }
              ((e.i = t), (e.J = t ? Cr.receiver.friendlyName : ""), e.l.Jb());
            }
            function py(e) {
              if (e.h)
                for (var t = I(e.h.keys()), r = t.next(); !r.done; r = t.next()) {
                  r = r.value;
                  var s = e.h.get(r);
                  (e.h.delete(r), s.reject(new ee(1, 7, 7e3)));
                }
            }
            function mc(e, t) {
              t = ly(t);
              var r = Cr;
              try {
                r.sendMessage("urn:x-cast:com.google.shaka.v2", t, function () {}, Vn);
              } catch (s) {
                throw (
                  (t = new ee(2, 8, 8005, s)),
                  (r = new Me("error", new Map().set("detail", t))),
                  e.B("player", r),
                  e.qd(),
                  t
                );
              }
            }
            var mF = 0.02,
              Rf = !1,
              Cr = null,
              Cf = null,
              yc = new Set();
            function VI(e) {
              if ((Cf ? (l.__onGCastApiAvailable = Cf) : delete l.__onGCastApiAvailable, (Cf = null), e))
                for (var t = I(yc), r = t.next(); !r.done; r = t.next()) r.value.init();
              typeof l.__onGCastApiAvailable == "function" && l.__onGCastApiAvailable(e);
            }
            function pn(e, t, r, s) {
              ((s = s === void 0 ? !1 : s), Lt.call(this));
              var a = this;
              ((this.i = e),
                (this.h = t),
                (this.l = this.o = this.m = this.u = this.j = null),
                (this.I = r),
                (this.H = s),
                (this.F = []),
                (this.C = []),
                (this.B = []),
                (this.G = new Map()),
                (this.g = null),
                l.chrome && tt().Oa() != "CAST"
                  ? ((this.g = new hy(
                      r,
                      function () {
                        return WI(a);
                      },
                      function () {
                        return zI(a);
                      },
                      function (c, f) {
                        return XI(a, c, f);
                      },
                      function () {
                        return YI(a);
                      },
                      function () {
                        return KI(a);
                      },
                      s,
                    )),
                    yF(this))
                  : ((this.j = this.i), (this.u = this.h)));
            }
            (N(pn, Lt),
              (d = pn.prototype),
              (d.destroy = function (e) {
                return (
                  this.g && e !== void 0 && e && this.g.qd(),
                  this.l && (this.l.release(), (this.l = null)),
                  (e = []),
                  this.h && (e.push(this.h.destroy()), (this.h = null)),
                  this.g && (e.push(this.g.destroy()), (this.g = null)),
                  (this.u = this.j = this.i = null),
                  Lt.prototype.release.call(this),
                  Promise.all(e)
                );
              }),
              (d.gk = function () {
                return this.j;
              }),
              (d.td = function () {
                return this.u;
              }),
              (d.sj = function () {
                return this.g ? this.g.m && Rf : !1;
              }),
              (d.wb = function () {
                return this.g ? this.g.wb() : !1;
              }),
              (d.eh = function () {
                return this.g ? this.g.eh() : "";
              }),
              (d.cast = function () {
                var e = this;
                return W(function (t) {
                  return t.g == 1
                    ? e.g
                      ? _(t, e.g.cast(), 2)
                      : t.return()
                    : e.h
                      ? _(t, e.h.Cc(), 0)
                      : t.return();
                });
              }),
              (d.qh = function (e) {
                this.g && this.g.qh(e);
              }),
              (d.il = function () {
                this.g && gF(this.g);
              }),
              (d.qd = function () {
                this.g && this.g.qd();
              }),
              (d.tj = function (e, t) {
                t = t === void 0 ? !1 : t;
                var r = this;
                return W(function (s) {
                  if (s.g == 1)
                    return (e == r.I && t == r.H) || ((r.I = e), (r.H = t), !r.g)
                      ? s.return()
                      : (r.g.qd(), _(s, r.g.destroy(), 2));
                  ((r.g = null),
                    (r.g = new hy(
                      e,
                      function () {
                        return WI(r);
                      },
                      function () {
                        return zI(r);
                      },
                      function (a, c) {
                        return XI(r, a, c);
                      },
                      function () {
                        return YI(r);
                      },
                      function () {
                        return KI(r);
                      },
                      t,
                    )),
                    r.g.init(),
                    K(s));
                });
              }));
            function yF(e) {
              (e.g.init(), (e.l = new gt()));
              for (var t = I(FI), r = t.next(); !r.done; r = t.next())
                e.l.D(e.i, r.value, function (c) {
                  e.g.wb() || ((c = bE(c)), e.m.dispatchEvent(c));
                });
              for (var s in mh)
                e.l.D(e.h, mh[s], function (c) {
                  e.g.wb() || e.o.dispatchEvent(c);
                });
              ((e.j = {}), (t = {}));
              for (var a in e.i)
                ((t = { ie: t.ie }),
                  (t.ie = a),
                  Object.defineProperty(e.j, t.ie, {
                    configurable: !1,
                    enumerable: !0,
                    get: (function (c) {
                      return function () {
                        return xF(e, c.ie);
                      };
                    })(t),
                    set: (function (c) {
                      return function (f) {
                        var g = c.ie;
                        e.g.wb() ? e.g.set("video", g, f) : (e.i[g] = f);
                      };
                    })(t),
                  }));
              ((e.u = {}),
                HI(e, function (c) {
                  Object.defineProperty(e.u, c, {
                    configurable: !1,
                    enumerable: !0,
                    get: function () {
                      return Lf(e, c);
                    },
                  });
                }),
                vF(e),
                (e.m = new Lt()),
                (e.m.Je = e.j),
                (e.o = new Lt()),
                (e.o.Je = e.u),
                e.l.D(e.h, "unloading", function () {
                  (e.g && e.g.wb()) || gy(e);
                }));
            }
            function vF(e) {
              var t = new Map();
              HI(e, function (r, s) {
                t.has(s)
                  ? ((s = t.get(s)), r.length < s.length ? e.G.set(r, s) : e.G.set(s, r))
                  : t.set(s, r);
              });
            }
            function HI(e, t) {
              function r(m) {
                return m == "constructor" || typeof s[m] != "function" ? !1 : !a.has(m);
              }
              var s = e.h,
                a = new Set(),
                c;
              for (c in s) r(c) && (a.add(c), t(c, s[c]));
              for (e = Object.getPrototypeOf(s), c = Object.getPrototypeOf({}); e && e != c; ) {
                for (var f = I(Object.getOwnPropertyNames(e)), g = f.next(); !g.done; g = f.next())
                  ((g = g.value), r(g) && (a.add(g), t(g, s[g])));
                e = Object.getPrototypeOf(e);
              }
            }
            function KI(e) {
              var t = {
                video: {},
                player: {},
                playerAfterLoad: {},
                manifest: e.h.rd(),
                startTime: null,
                addThumbnailsTrackCalls: e.F,
                addTextTrackAsyncCalls: e.C,
                addChaptersTrackCalls: e.B,
              };
              e.i.pause();
              for (var r = I(uy), s = r.next(); !s.done; s = r.next()) ((s = s.value), (t.video[s] = e.i[s]));
              for (
                e.i.ended || (t.startTime = e.i.currentTime), r = I(BI), s = r.next();
                !s.done;
                s = r.next()
              ) {
                var a = s.value;
                ((s = a[1]), (a = e.h[a[0]]()), (t.player[s] = a));
              }
              for (r = I($I), s = r.next(); !s.done; s = r.next())
                ((a = s.value), (s = a[1]), (a = e.h[a[0]]()), (t.playerAfterLoad[s] = a));
              return t;
            }
            function WI(e) {
              var t = new Me("caststatuschanged");
              e.dispatchEvent(t);
            }
            function zI(e) {
              var t = new Me(e.j.paused ? "pause" : "play");
              e.m.dispatchEvent(t);
            }
            function YI(e) {
              for (var t = I(BI), r = t.next(); !r.done; r = t.next()) {
                var s = r.value;
                ((r = s[1]), (s = e.g.get("player", s[0])()), e.h[r](s));
              }
              var a = e.F,
                c = e.C,
                f = e.B;
              gy(e);
              var g = e.g.get("player", "getAssetUri")();
              ((s = e.g.get("video", "ended")), (t = Promise.resolve()));
              var m = e.i.autoplay;
              ((r = null), s || (r = e.g.get("video", "currentTime")));
              var x;
              (s = e.g.get("player", "getTextTracks")()) &&
                s.length &&
                (x = s.find(function (R) {
                  return R.active;
                }));
              var E = e.g.get("player", "isTextTrackVisible")();
              g && ((e.i.autoplay = !1), (t = e.h.load(g, r)));
              var A = {};
              for (r = I(uy), s = r.next(); !s.done; s = r.next())
                ((s = s.value), (A[s] = e.g.get("video", s)));
              t.then(
                function () {
                  if (e.i) {
                    for (var R = I(a), b = R.next(); !b.done; b = R.next()) {
                      b = b.value;
                      var D;
                      (D = e.td()).Pe.apply(D, V(b));
                    }
                    for (R = I(c), D = R.next(); !D.done; D = R.next()) {
                      D = D.value;
                      var M;
                      (M = e.td()).Rd.apply(M, V(D));
                    }
                    for (M = I(f), R = M.next(); !R.done; R = M.next()) {
                      R = R.value;
                      var P;
                      (P = e.td()).Oe.apply(P, V(R));
                    }
                    for (P = I(uy), M = P.next(); !M.done; M = P.next()) ((M = M.value), (e.i[M] = A[M]));
                    for (P = I($I), M = P.next(); !M.done; M = P.next())
                      ((R = M.value), (M = R[1]), (R = e.g.get("player", R[0])()), e.h[M](R));
                    (e.h.wh(E),
                      x && e.h.oh(x.language, x.roles, x.forced),
                      (e.i.autoplay = m),
                      g && e.i.play());
                  }
                },
                function (R) {
                  ((R = new Map().set("detail", R)), (R = new Me("error", R)), e.h.dispatchEvent(R));
                },
              );
            }
            function xF(e, t) {
              if (t == "addEventListener")
                return function (s, a, c) {
                  return e.m.addEventListener(s, a, c);
                };
              if (t == "removeEventListener")
                return function (s, a, c) {
                  return e.m.removeEventListener(s, a, c);
                };
              if (e.g.wb() && Object.keys(e.g.g.video).length == 0) {
                var r = e.i[t];
                if (typeof r != "function") return r;
              }
              return e.g.wb()
                ? e.g.get("video", t)
                : ((t = e.i[t]), typeof t == "function" && (t = t.bind(e.i)), t);
            }
            function Lf(e, t, r) {
              if (((r = r === void 0 ? !1 : r), e.G.has(t) && (t = e.G.get(t)), t == "addEventListener"))
                return function (s, a, c) {
                  return e.o.addEventListener(s, a, c);
                };
              if (t == "removeEventListener")
                return function (s, a, c) {
                  return e.o.removeEventListener(s, a, c);
                };
              if (t == "getMediaElement")
                return function () {
                  return e.j;
                };
              if (t == "getSharedConfiguration") return e.g.get("player", "getConfiguration");
              if (t == "getNetworkingEngine")
                return function () {
                  return e.h.Yb();
                };
              if (t == "getDrmEngine")
                return function () {
                  return e.h.F;
                };
              if (t == "getAdManager")
                return function () {
                  return e.h.di();
                };
              if (t == "getQueueManager")
                return function () {
                  return e.h.mi();
                };
              if (t == "setVideoContainer")
                return function (s) {
                  return e.h.Zi(s);
                };
              if (!r) {
                if (t == "addThumbnailsTrack")
                  return function () {
                    var s = Qe.apply(0, arguments);
                    return (e.F.push(s), Lf(e, t, !0).apply(null, V(s)));
                  };
                if (t == "addTextTrackAsync")
                  return function () {
                    var s = Qe.apply(0, arguments);
                    return (e.C.push(s), Lf(e, t, !0).apply(null, V(s)));
                  };
                if (t == "addChaptersTrack")
                  return function () {
                    var s = Qe.apply(0, arguments);
                    return (e.B.push(s), Lf(e, t, !0).apply(null, V(s)));
                  };
              }
              if (e.g.wb()) {
                if (t == "getManifest" || t == "drmInfo")
                  return function () {
                    return (He(t + "() does not work while casting!"), null);
                  };
                if (t == "attach" || t == "detach")
                  return function () {
                    return (He(t + "() does not work while casting!"), Promise.resolve());
                  };
                if (t == "getChapters")
                  return function () {
                    return (He(t + "() does not work while casting!"), []);
                  };
              }
              return (e.g.wb() && Object.keys(e.g.g.video).length == 0 && (cy.has(t) || dy.has(t))) ||
                !e.g.wb()
                ? e.h[t].bind(e.h)
                : e.g.get("player", t);
            }
            function XI(e, t, r) {
              e.g.wb() &&
                (t == "video"
                  ? e.m.dispatchEvent(r)
                  : t == "player" && (r.type == "unloading" && gy(e), e.o.dispatchEvent(r)));
            }
            function gy(e) {
              ((e.F = []), (e.C = []), (e.B = []));
            }
            (Ee("shaka.cast.CastProxy", pn),
              (pn.prototype.changeReceiverId = pn.prototype.tj),
              (pn.prototype.forceDisconnect = pn.prototype.qd),
              (pn.prototype.suggestDisconnect = pn.prototype.il),
              (pn.prototype.setAppData = pn.prototype.qh),
              (pn.prototype.cast = pn.prototype.cast),
              (pn.prototype.receiverName = pn.prototype.eh),
              (pn.prototype.isCasting = pn.prototype.wb),
              (pn.prototype.canCast = pn.prototype.sj),
              (pn.prototype.getPlayer = pn.prototype.td),
              (pn.prototype.getVideo = pn.prototype.gk),
              (pn.prototype.destroy = pn.prototype.destroy));
            function qn(e, t, r, s) {
              Lt.call(this);
              var a = this;
              ((this.h = e),
                (this.g = t),
                (this.j = new gt()),
                (this.I = { video: e, player: t }),
                (this.G = r || function () {}),
                (this.J =
                  s ||
                  function (c) {
                    return c;
                  }),
                (this.i = null),
                (this.H = !1),
                (this.o = !0),
                (this.m = 0),
                (this.C = !1),
                (this.B = !0),
                (this.u = this.l = null),
                (this.F = new it(function () {
                  my(a);
                })),
                TF(this));
            }
            (N(qn, Lt),
              (d = qn.prototype),
              (d.isConnected = function () {
                return this.H;
              }),
              (d.pk = function () {
                return this.o;
              }),
              (d.al = function (e) {
                this.i = e;
              }),
              (d.xj = function () {
                this.i = null;
              }),
              (d.cl = function (e) {
                (this.i || (this.i = { metadataType: cast.receiver.media.MetadataType.GENERIC }),
                  (this.i.title = e));
              }),
              (d.$k = function (e) {
                (this.i || (this.i = { metadataType: cast.receiver.media.MetadataType.GENERIC }),
                  (this.i.images = [{ url: e }]));
              }),
              (d.Zk = function (e) {
                (this.i || (this.i = {}),
                  (this.i.artist = e),
                  (this.i.metadataType = cast.receiver.media.MetadataType.MUSIC_TRACK));
              }),
              (d.destroy = function () {
                var e = this,
                  t,
                  r;
                return W(function (s) {
                  if (s.g == 1)
                    return (
                      e.j && (e.j.release(), (e.j = null)),
                      (t = []),
                      e.g && (t.push(e.g.destroy()), (e.g = null)),
                      e.F && (e.F.stop(), (e.F = null)),
                      (e.h = null),
                      (e.I = null),
                      (e.G = null),
                      (e.H = !1),
                      (e.o = !0),
                      (e.l = null),
                      (e.u = null),
                      Lt.prototype.release.call(e),
                      _(s, Promise.all(t), 2)
                    );
                  ((r = cast.receiver.CastReceiverManager.getInstance()), r.stop(), K(s));
                });
              }));
            function TF(e) {
              var t = cast.receiver.CastReceiverManager.getInstance();
              ((t.onSenderConnected = function () {
                return qI(e);
              }),
                (t.onSenderDisconnected = function () {
                  return qI(e);
                }),
                (t.onSystemVolumeChanged = function () {
                  var a = cast.receiver.CastReceiverManager.getInstance().getSystemVolume();
                  (a &&
                    Ms(e, { type: "update", update: { video: { volume: a.level, muted: a.muted } } }, e.l),
                    Ms(e, { type: "event", targetName: "video", event: { type: "volumechange" } }, e.l));
                }),
                (e.u = t.getCastMessageBus("urn:x-cast:com.google.cast.media")),
                (e.u.onMessage = function (a) {
                  return AF(e, a);
                }),
                (e.l = t.getCastMessageBus("urn:x-cast:com.google.shaka.v2")),
                (e.l.onMessage = function (a) {
                  return EF(e, a);
                }),
                t.start(),
                (t = I(FI)));
              for (var r = t.next(); !r.done; r = t.next())
                e.j.D(e.h, r.value, function (a) {
                  return QI(e, "video", a);
                });
              for (var s in mh)
                e.j.D(e.g, mh[s], function (a) {
                  return QI(e, "player", a);
                });
              (e.j.D(e.h, "loadeddata", function () {
                e.C = !0;
              }),
                e.j.D(e.g, "loading", function () {
                  ((e.o = !1), gl(e));
                }),
                e.j.D(e.h, "playing", function () {
                  ((e.o = !1), gl(e));
                }),
                e.j.D(e.h, "pause", function () {
                  gl(e);
                }),
                e.j.D(e.g, "unloading", function () {
                  ((e.o = !0), gl(e));
                }),
                e.j.D(e.h, "ended", function () {
                  new it(function () {
                    e.h && e.h.ended && ((e.o = !0), gl(e));
                  }).ka(wF);
                }));
            }
            function qI(e) {
              ((e.m = 0),
                (e.B = !0),
                (e.H = cast.receiver.CastReceiverManager.getInstance().getSenders().length != 0),
                gl(e));
            }
            function gl(e) {
              var t;
              W(function (r) {
                if (r.g == 1) return _(r, Promise.resolve(), 2);
                if (!e.g) return r.return();
                ((t = new Me("caststatuschanged")), e.dispatchEvent(t), JI(e) || Ps(e), K(r));
              });
            }
            function SF(e, t, r) {
              var s, a, c, f, g, m, x, E, A, R, b, D, M, P, G, U, H, Q, ne;
              W(function (z) {
                switch (z.g) {
                  case 1:
                    for (s in t.player) ((a = t.player[s]), e.g[s](a));
                    return (
                      e.G(r),
                      (c = e.h.autoplay),
                      t.manifest
                        ? ((e.h.autoplay = !1), q(z, 5), _(z, e.g.load(t.manifest, t.startTime), 7))
                        : _(z, Promise.resolve(), 3)
                    );
                  case 7:
                    if (t.addThumbnailsTrackCalls)
                      for (f = I(t.addThumbnailsTrackCalls), g = f.next(); !g.done; g = f.next())
                        ((m = g.value), e.g.Pe.apply(e.g, V(m)));
                    if (t.addTextTrackAsyncCalls)
                      for (x = I(t.addTextTrackAsyncCalls), E = x.next(); !E.done; E = x.next())
                        ((A = E.value), e.g.Rd.apply(e.g, V(A)));
                    if (t.addChaptersTrackCalls)
                      for (R = I(t.addChaptersTrackCalls), b = R.next(); !b.done; b = R.next())
                        ((D = b.value), e.g.Oe.apply(e.g, V(D)));
                    he(z, 3);
                    break;
                  case 5:
                    return (
                      (M = ae(z)),
                      (P = new Map().set("detail", M)),
                      (G = new Me("error", P)),
                      e.g && e.g.dispatchEvent(G),
                      z.return()
                    );
                  case 3:
                    if (!e.g) return z.return();
                    for (U in t.video) ((H = t.video[U]), (e.h[U] = H));
                    for (Q in t.playerAfterLoad) ((ne = t.playerAfterLoad[Q]), e.g[Q](ne));
                    ((e.h.autoplay = c), t.manifest && (e.h.play(), Ps(e)), K(z));
                }
              });
            }
            function QI(e, t, r) {
              e.g && (my(e), Ms(e, { type: "event", targetName: t, event: r }, e.l));
            }
            function my(e) {
              e.F.ka(IF);
              for (var t = { video: {}, player: {} }, r = I(dF), s = r.next(); !s.done; s = r.next())
                ((s = s.value), (t.video[s] = e.h[s]));
              (e.g.W() &&
                UI.forEach(function (a, c) {
                  e.m % a == 0 && (t.player[c] = e.g[c]());
                }),
                cy.forEach(function (a, c) {
                  e.m % a == 0 && (t.player[c] = e.g[c]());
                }),
                (r = cast.receiver.CastReceiverManager.getInstance().getSystemVolume()) &&
                  ((t.video.volume = r.level), (t.video.muted = r.muted)),
                Ms(e, { type: "update", update: t }, e.l),
                dy.forEach(function (a, c) {
                  e.m % a == 0 &&
                    ((a = { player: {} }),
                    (a.player[c] = e.g[c]()),
                    Ms(e, { type: "update", update: a }, e.l));
                }),
                e.C && (e.m += 1),
                JI(e));
            }
            function JI(e) {
              return e.B && (e.h.duration || e.g.W()) ? (yy(e), (e.B = !1), !0) : !1;
            }
            function yy(e, t) {
              var r = { contentId: e.g.rd(), streamType: e.g.W() ? "LIVE" : "BUFFERED", contentType: "" };
              (e.g.W() || (r.duration = e.h.duration),
                e.i && (r.metadata = e.i),
                Ps(e, t === void 0 ? 0 : t, r));
            }
            function EF(e, t) {
              var r = If(t.data);
              switch (r.type) {
                case "init":
                  ((e.m = 0), (e.C = !1), (e.B = !0), SF(e, r.initState, r.appData), my(e));
                  break;
                case "appData":
                  e.G(r.appData);
                  break;
                case "set":
                  var s = r.targetName,
                    a = r.property;
                  if (((r = r.value), s == "video")) {
                    if (((t = cast.receiver.CastReceiverManager.getInstance()), a == "volume")) {
                      t.setSystemVolumeLevel(r);
                      break;
                    } else if (a == "muted") {
                      t.setSystemVolumeMuted(r);
                      break;
                    }
                  }
                  e.I[s][a] = r;
                  break;
                case "call":
                  ((s = e.I[r.targetName]), s[r.methodName].apply(s, r.args));
                  break;
                case "asyncCall":
                  ((s = r.targetName),
                    (a = r.methodName),
                    s == "player" && a == "load" && ((e.m = 0), (e.C = !1)));
                  var c = r.id,
                    f = t.senderId;
                  ((t = e.I[s]),
                    (r = t[a].apply(t, r.args)),
                    s == "player" &&
                      a == "load" &&
                      (r = r.then(function () {
                        e.B = !0;
                      })),
                    r.then(
                      function (g) {
                        return ZI(e, f, c, null, g);
                      },
                      function (g) {
                        return ZI(e, f, c, g, null);
                      },
                    ));
              }
            }
            function AF(e, t) {
              var r = If(t.data);
              switch (r.type) {
                case "PLAY":
                  (e.h.play(), Ps(e));
                  break;
                case "PAUSE":
                  (e.h.pause(), Ps(e));
                  break;
                case "SEEK":
                  t = r.currentTime;
                  var s = r.resumeState;
                  (t != null && (e.h.currentTime = Number(t)),
                    s && s == "PLAYBACK_START"
                      ? (e.h.play(), Ps(e))
                      : s && s == "PLAYBACK_PAUSE" && (e.h.pause(), Ps(e)));
                  break;
                case "STOP":
                  e.g.Cc().then(function () {
                    e.g && Ps(e);
                  });
                  break;
                case "GET_STATUS":
                  yy(e, Number(r.requestId));
                  break;
                case "VOLUME":
                  ((s = r.volume), (t = s.level), (s = s.muted));
                  var a = e.h.volume,
                    c = e.h.muted;
                  (t != null && (e.h.volume = Number(t)),
                    s != null && (e.h.muted = s),
                    (a == e.h.volume && c == e.h.muted) || Ps(e));
                  break;
                case "LOAD":
                  ((e.m = 0),
                    (e.C = !1),
                    (e.B = !1),
                    (t = r.media),
                    (s = r.currentTime),
                    (a = e.J(t.contentId)),
                    (c = r.autoplay || !0),
                    e.G(t.customData),
                    c && (e.h.autoplay = !0),
                    e.g
                      .load(a, s)
                      .then(function () {
                        e.g && yy(e);
                      })
                      .catch(function (f) {
                        var g = "LOAD_FAILED";
                        (f.category == 7 && f.code == 7e3 && (g = "LOAD_CANCELLED"),
                          Ms(e, { requestId: Number(r.requestId), type: g }, e.u));
                      }));
                  break;
                default:
                  Ms(
                    e,
                    { requestId: Number(r.requestId), type: "INVALID_REQUEST", reason: "INVALID_COMMAND" },
                    e.u,
                  );
              }
            }
            function ZI(e, t, r, s, a) {
              e.g && Ms(e, { type: "asyncComplete", id: r, error: s, res: a }, e.l, t);
            }
            function Ms(e, t, r, s) {
              e.H && ((e = ly(t)), s ? r.getCastChannel(s).send(e) : r.broadcast(e));
            }
            function Ps(e, t, r) {
              r = r === void 0 ? null : r;
              var s = {
                mediaSessionId: 0,
                playbackRate: e.h.playbackRate,
                playerState: e.o ? RF : e.g.Rg() ? LF : e.h.paused ? _F : CF,
                currentTime: e.h.currentTime,
                supportedMediaCommands: 63,
                volume: { level: e.h.volume, muted: e.h.muted },
              };
              (r && (s.media = r),
                Ms(e, { requestId: t === void 0 ? 0 : t, type: "MEDIA_STATUS", status: [s] }, e.u));
            }
            (Ee("shaka.cast.CastReceiver", qn),
              (qn.prototype.destroy = qn.prototype.destroy),
              (qn.prototype.setContentArtist = qn.prototype.Zk),
              (qn.prototype.setContentImage = qn.prototype.$k),
              (qn.prototype.setContentTitle = qn.prototype.cl),
              (qn.prototype.clearContentMetadata = qn.prototype.xj),
              (qn.prototype.setContentMetadata = qn.prototype.al),
              (qn.prototype.isIdle = qn.prototype.pk),
              (qn.prototype.isConnected = qn.prototype.isConnected));
            var IF = 0.5,
              wF = 5,
              RF = "IDLE",
              CF = "PLAYING",
              LF = "BUFFERING",
              _F = "PAUSED";
            function ew(e, t, r, s, a) {
              if (s >= a) return null;
              for (var c = -1, f = -1, g = 0; g < r.length; g++)
                if (
                  r[g].some(function (Q) {
                    return Q != null && Q.g.trim() != "";
                  })
                ) {
                  c = g;
                  break;
                }
              for (g = r.length - 1; g >= 0; g--)
                if (
                  r[g].some(function (Q) {
                    return Q != null && Q.g.trim() != "";
                  })
                ) {
                  f = g;
                  break;
                }
              if (c === -1 || f === -1) return null;
              for (var m = (g = !1), x = "white", E = "black", A = vy(s, a, g, m, x, E); c <= f; c++) {
                for (var R = r[c], b = -1, D = -1, M = 0; M < R.length; M++)
                  if (R[M] != null && R[M].g.trim() !== "") {
                    b = M;
                    break;
                  }
                for (M = R.length - 1; M >= 0; M--)
                  if (R[M] != null && R[M].g.trim() !== "") {
                    D = M;
                    break;
                  }
                if (b === -1 || D === -1) ((R = tw(s, a)), e.nestedCues.push(R));
                else {
                  for (; b <= D; b++)
                    if ((M = R[b])) {
                      var P = M.l,
                        G = M.i,
                        U = M.j,
                        H = M.h;
                      ((P != g || G != m || U != x || H != E) &&
                        (A.payload && e.nestedCues.push(A),
                        (A = vy(s, a, P, G, U, H)),
                        (g = P),
                        (m = G),
                        (x = U),
                        (E = H)),
                        (A.payload += M.g));
                    } else A.payload += " ";
                  (A.payload && e.nestedCues.push(A),
                    c !== f && ((A = tw(s, a)), e.nestedCues.push(A)),
                    (A = vy(s, a, g, m, x, E)));
                }
              }
              return e.nestedCues.length ? { cue: e, stream: t } : null;
            }
            function vy(e, t, r, s, a, c) {
              return (
                (e = new $t(e, t, "")),
                r && e.textDecoration.push(xs),
                s && (e.fontStyle = Ba),
                (e.color = a),
                (e.backgroundColor = c),
                e
              );
            }
            function tw(e, t) {
              return ((e = new $t(e, t, "")), (e.lineBreak = !0), e);
            }
            function nw(e, t, r, s, a) {
              ((this.g = e), (this.l = t), (this.i = r), (this.h = s), (this.j = a));
            }
            function xy(e, t) {
              ((this.i = []),
                (this.g = 1),
                (this.h = 0),
                (this.F = e),
                (this.C = t),
                (this.j = this.m = !1),
                (this.l = "white"),
                (this.o = "black"),
                (this.u = this.B = null),
                vc(this));
            }
            function _f(e, t, r) {
              var s = "CC" + (((e.F << 1) | e.C) + 1),
                a = new $t(t, r, "");
              a.lineInterpretation = 1;
              var c = sw.get(e.g);
              return (
                c && (a.line = c),
                e.u != null && e.B != null && (a.position = 10 + Math.min(70, e.u * 10) + e.B * 2.5),
                (t = ew(a, s, e.i, t, r)) &&
                  e.g + t.cue.nestedCues.length - 3 > 15 &&
                  (c = sw.get(e.g + 3 - t.cue.nestedCues.length)) &&
                  (a.line = c),
                t
              );
            }
            function vc(e) {
              (Os(e, 0, 15), (e.g = 1));
            }
            function ml(e, t, r) {
              if (!(r < 32 || r > 127)) {
                var s = "";
                switch (t) {
                  case 0:
                    s = rw.has(r) ? rw.get(r) : String.fromCharCode(r);
                    break;
                  case 1:
                    s = bF.get(r);
                    break;
                  case 2:
                    (e.i[e.g].pop(), (s = DF.get(r)));
                    break;
                  case 3:
                    (e.i[e.g].pop(), (s = kF.get(r)));
                }
                s && e.i[e.g].push(new nw(s, e.m, e.j, e.o, e.l));
              }
            }
            function iw(e, t, r, s) {
              if (!(r < 0 || t < 0))
                if (t >= r)
                  for (--s; s >= 0; s--)
                    e.i[t + s] = e.i[r + s].map(function (c) {
                      return c;
                    });
                else
                  for (var a = 0; a < s; a++)
                    e.i[t + a] = e.i[r + a].map(function (c) {
                      return c;
                    });
            }
            function Os(e, t, r) {
              for (var s = 0; s <= r; s++) e.i[t + s] = [];
            }
            var rw = new Map([
                [39, ""],
                [42, ""],
                [92, ""],
                [92, ""],
                [94, ""],
                [95, ""],
                [96, ""],
                [123, ""],
                [124, ""],
                [125, ""],
                [126, ""],
                [127, ""],
              ]),
              bF = new Map([
                [48, ""],
                [49, ""],
                [50, ""],
                [51, ""],
                [52, ""],
                [53, ""],
                [54, ""],
                [55, ""],
                [56, ""],
                [57, " "],
                [58, ""],
                [59, ""],
                [60, ""],
                [61, ""],
                [62, ""],
                [63, ""],
              ]),
              DF = new Map([
                [32, ""],
                [33, ""],
                [34, ""],
                [35, ""],
                [36, ""],
                [37, ""],
                [38, ""],
                [39, ""],
                [40, "*"],
                [41, "'"],
                [42, ""],
                [43, ""],
                [44, ""],
                [45, ""],
                [46, ""],
                [47, ""],
                [48, ""],
                [49, ""],
                [50, ""],
                [51, ""],
                [52, ""],
                [53, ""],
                [54, ""],
                [55, ""],
                [56, ""],
                [57, ""],
                [58, ""],
                [59, ""],
                [60, ""],
                [61, ""],
                [62, ""],
                [63, ""],
              ]),
              kF = new Map([
                [32, ""],
                [33, ""],
                [34, ""],
                [35, ""],
                [36, ""],
                [37, ""],
                [38, ""],
                [39, ""],
                [40, ""],
                [41, "{"],
                [42, "}"],
                [43, "\\"],
                [44, "^"],
                [45, "_"],
                [46, "|"],
                [47, "~"],
                [48, ""],
                [49, ""],
                [50, ""],
                [51, ""],
                [52, ""],
                [53, ""],
                [54, ""],
                [55, ""],
                [56, ""],
                [57, ""],
                [58, ""],
                [59, ""],
                [60, ""],
                [61, ""],
                [62, ""],
                [63, ""],
              ]),
              sw = new Map([
                [1, 10],
                [2, 15.33],
                [3, 20.66],
                [4, 26],
                [5, 31.33],
                [6, 36.66],
                [7, 42],
                [8, 47.33],
                [9, 52.66],
                [10, 58],
                [11, 63.33],
                [12, 68.66],
                [13, 74],
                [14, 79.33],
                [15, 84.66],
              ]);
            function bf(e, t) {
              ((this.h = 0),
                (this.o = new xy(e, t)),
                (this.i = new xy(e, t)),
                (this.g = this.j = new xy(e, t)),
                (this.l = 0),
                (this.m = null));
            }
            function Ty(e, t, r) {
              e.g = e.i;
              var s = e.g,
                a = null;
              return (
                e.h !== 3 &&
                  e.h !== 4 &&
                  ((a = _f(s, e.l, r)),
                  (r = e.i),
                  (r.g = r.h > 0 ? r.h : 0),
                  Os(r, 0, 15),
                  (r = e.j),
                  (r.g = r.h > 0 ? r.h : 0),
                  Os(r, 0, 15),
                  (s.g = 15)),
                (e.h = 3),
                (s.h = t),
                a
              );
            }
            function ow(e) {
              ((e.h = 1), (e.g = e.j), (e.g.h = 0));
            }
            function aw(e) {
              (Cn("Cea608DataChannel", "CEA-608 text mode entered, but is unsupported"),
                (e.g = e.o),
                (e.h = 4));
            }
            var MF = "black green blue cyan red yellow magenta black".split(" "),
              lw = "white green blue cyan red yellow magenta white_italics".split(" ");
            function Sy(e, t) {
              ((this.J = t),
                (this.N = e),
                (this.K = this.l = !1),
                (this.m = this.o = this.H = this.M = this.I = 0),
                (this.G = 2),
                (this.i = []),
                (this.g = this.h = this.j = 0),
                (this.F = this.B = !1),
                (this.C = "white"),
                (this.u = "black"),
                Ey(this));
            }
            function Ey(e) {
              e.i = [];
              for (var t = 0; t < 16; t++) e.i.push(Ay());
            }
            function Ay() {
              for (var e = [], t = 0; t < 42; t++) e.push(null);
              return e;
            }
            function yo(e, t) {
              uw(e) && ((e.i[e.h][e.g] = new nw(t, e.F, e.B, e.u, e.C)), e.g++);
            }
            function uw(e) {
              var t = e.g < e.m && e.g >= 0;
              return e.h < e.o && e.h >= 0 && t;
            }
            Sy.prototype.isVisible = function () {
              return this.l;
            };
            function PF(e) {
              for (var t = 0, r = 1; r < 16; r++, t++) e.i[t] = e.i[r];
              for (r = 0; r < 1; r++, t++) e.i[t] = Ay();
            }
            function la(e, t, r) {
              var s = new $t(e.j, t, "");
              s.textAlign = e.G === 0 ? "left" : e.G === 1 ? "right" : Jr;
              var a = s.region;
              switch (
                (e.J && (a.id += "svc" + e.J),
                (a.id += "win" + e.N),
                (a.height = e.o),
                (a.width = e.m),
                (a.heightUnits = 2),
                (a.widthUnits = 2),
                (a.viewportAnchorX = e.I),
                (a.viewportAnchorY = e.M),
                (a.viewportAnchorUnits = e.K ? Mi : 2),
                e.H)
              ) {
                case 0:
                  ((a.regionAnchorX = 0), (a.regionAnchorY = 0));
                  break;
                case 1:
                  ((a.regionAnchorX = 50), (a.regionAnchorY = 0));
                  break;
                case 2:
                  ((a.regionAnchorX = 100), (a.regionAnchorY = 0));
                  break;
                case 3:
                  ((a.regionAnchorX = 0), (a.regionAnchorY = 50));
                  break;
                case 4:
                  ((a.regionAnchorX = 50), (a.regionAnchorY = 50));
                  break;
                case 5:
                  ((a.regionAnchorX = 100), (a.regionAnchorY = 50));
                  break;
                case 6:
                  ((a.regionAnchorX = 0), (a.regionAnchorY = 100));
                  break;
                case 7:
                  ((a.regionAnchorX = 50), (a.regionAnchorY = 100));
                  break;
                case 8:
                  ((a.regionAnchorX = 100), (a.regionAnchorY = 100));
              }
              return ((r = ew(s, "svc" + r, e.i, e.j, t)) && (e.j = t), r);
            }
            Sy.prototype.display = function () {
              this.l = !0;
            };
            function OF() {
              ((this.i = []), (this.h = null), (this.g = 0));
            }
            function NF(e, t) {
              t.type === 3
                ? ((e.g = (t.value & 63) * 2 - 1), (e.h = []))
                : e.h &&
                  (e.g > 0 && (e.h.push(t), e.g--),
                  e.g === 0 && (e.i.push(new xc(e.h)), (e.h = null), (e.g = 0)));
            }
            function xc(e) {
              ((this.g = 0), (this.h = e));
            }
            ((xc.prototype.Ia = function () {
              return this.g < this.h.length;
            }),
              (xc.prototype.Pa = function () {
                return this.g;
              }));
            function Sn(e) {
              if (!e.Ia()) throw new ee(2, 2, 3e3);
              return e.h[e.g++];
            }
            ((xc.prototype.skip = function (e) {
              if (this.g + e > this.h.length) throw new ee(2, 2, 3e3);
              this.g += e;
            }),
              (xc.prototype.Qi = function (e) {
                if (this.g - e < 0) throw new ee(2, 2, 3e3);
                this.g -= e;
              }));
            function FF(e) {
              ((this.i = e), (this.h = [null, null, null, null, null, null, null, null]), (this.g = null));
            }
            function UF(e, t, r, s) {
              if (!e.g) return [];
              if (r == 24)
                return (
                  (r = Sn(t).value),
                  (s = Sn(t).value),
                  (r = (function (c) {
                    return c
                      .map(function (f) {
                        return ("0" + (f & 255).toString(16)).slice(-2);
                      })
                      .join("");
                  })([r, s])),
                  yo(e.g, String.fromCharCode(parseInt(r, 16))),
                  []
                );
              t = e.g;
              var a = null;
              switch (r) {
                case 8:
                  !uw(t) ||
                    (t.g <= 0 && t.h <= 0) ||
                    (t.g <= 0 ? ((t.g = t.m - 1), t.h--) : t.g--, (t.i[t.h][t.g] = null));
                  break;
                case 13:
                  (t.isVisible() && (a = la(t, s, e.i)), t.h + 1 >= t.o ? PF(t) : t.h++, (t.g = 0));
                  break;
                case 14:
                  (t.isVisible() && (a = la(t, s, e.i)), (t.i[t.h] = Ay()), (t.g = 0));
                  break;
                case 12:
                  (t.isVisible() && (a = la(t, s, e.i)), Ey(t), (t.h = 0), (t.g = 0));
              }
              return a ? [a] : [];
            }
            function BF(e, t, r, s) {
              if (r >= 128 && r <= 135) ((s = r & 7), e.h[s] && (e.g = e.h[s]));
              else {
                if (r === 136) {
                  ((r = Sn(t).value), (t = []), (r = I(Tc(e, r))));
                  for (var a = r.next(); !a.done; a = r.next()) {
                    if (((a = e.h[a.value]), a.isVisible())) {
                      var c = la(a, s, e.i);
                      c && t.push(c);
                    }
                    Ey(a);
                  }
                  return t;
                }
                if (r === 137)
                  for (t = Sn(t).value, t = I(Tc(e, t)), r = t.next(); !r.done; r = t.next())
                    ((r = e.h[r.value]), r.isVisible() || (r.j = s), r.display());
                else {
                  if (r === 138) {
                    for (r = Sn(t).value, t = null, r = I(Tc(e, r)), a = r.next(); !a.done; a = r.next())
                      ((a = e.h[a.value]), a.isVisible() && (t = la(a, s, e.i)), (a.l = !1));
                    return t ? [t] : [];
                  }
                  if (r === 139) {
                    for (r = Sn(t).value, t = null, r = I(Tc(e, r)), a = r.next(); !a.done; a = r.next())
                      ((a = e.h[a.value]), a.isVisible() ? (t = la(a, s, e.i)) : (a.j = s), (a.l = !a.l));
                    return t ? [t] : [];
                  }
                  if (r === 140) return ((t = Sn(t).value), cw(e, t, s));
                  if (r === 143) return ((s = cw(e, 255, s)), dw(e), s);
                  if (r === 144)
                    (t.skip(1), (s = Sn(t).value), e.g && ((e.g.B = (s & 128) > 0), (e.g.F = (s & 64) > 0)));
                  else if (r === 145)
                    ((s = Sn(t).value),
                      (r = Sn(t).value),
                      t.skip(1),
                      e.g &&
                        ((t = hw((r & 48) >> 4, (r & 12) >> 2, r & 3)),
                        (e.g.C = hw((s & 48) >> 4, (s & 12) >> 2, s & 3)),
                        (e.g.u = t)));
                  else if (r === 146)
                    ((s = Sn(t).value),
                      (t = Sn(t).value),
                      e.g && ((e = e.g), (e.h = s & 15), (e.g = t & 63)));
                  else if (r === 151)
                    (t.skip(1), t.skip(1), (s = Sn(t).value), t.skip(1), e.g && (e.g.G = s & 3));
                  else if (r >= 152 && r <= 159) {
                    ((r = (r & 15) - 8),
                      (a = e.h[r] !== null),
                      a || ((c = new Sy(r, e.i)), (c.j = s), (e.h[r] = c)),
                      (s = Sn(t).value),
                      (c = Sn(t).value));
                    var f = Sn(t).value,
                      g = Sn(t).value,
                      m = Sn(t).value;
                    ((t = Sn(t).value),
                      (a && (t & 7) === 0) ||
                        ((t = e.h[r]),
                        (t.h = 0),
                        (t.g = 0),
                        (t.F = !1),
                        (t.B = !1),
                        (t.C = "white"),
                        (t.u = "black")),
                      (t = e.h[r]),
                      (t.l = (s & 32) > 0),
                      (t.M = c & 127),
                      (t.I = f),
                      (t.H = (g & 240) >> 4),
                      (t.K = (c & 128) > 0),
                      (t.o = (g & 15) + 1),
                      (t.m = (m & 63) + 1),
                      (e.g = e.h[r]));
                  }
                }
              }
              return [];
            }
            function Tc(e, t) {
              for (var r = [], s = 0; s < 8; s++) ((t & 1) === 1 && e.h[s] && r.push(s), (t >>= 1));
              return r;
            }
            function cw(e, t, r) {
              var s = [];
              t = I(Tc(e, t));
              for (var a = t.next(); !a.done; a = t.next()) {
                a = a.value;
                var c = e.h[a];
                (c.isVisible() && (c = la(c, r, e.i)) && s.push(c), (e.h[a] = null));
              }
              return s;
            }
            function dw(e) {
              ((e.g = null), (e.h = [null, null, null, null, null, null, null, null]));
            }
            function hw(e, t, r) {
              var s = { 0: 0, 1: 0, 2: 1, 3: 1 };
              return ((e = s[e]), (t = s[t]), (r = s[r]), $F[(e << 2) | (t << 1) | r]);
            }
            var fw = new Map([
                [32, " "],
                [33, ""],
                [37, ""],
                [42, ""],
                [44, ""],
                [48, ""],
                [49, ""],
                [50, ""],
                [51, ""],
                [52, ""],
                [53, ""],
                [57, ""],
                [58, ""],
                [60, ""],
                [61, ""],
                [63, ""],
                [118, ""],
                [119, ""],
                [120, ""],
                [121, ""],
                [122, ""],
                [123, ""],
                [124, ""],
                [125, ""],
                [126, ""],
                [127, ""],
              ]),
              $F = "black blue green cyan red magenta yellow white".split(" ");
            function yl() {
              ((this.h = []),
                (this.g = []),
                (this.i = new OF()),
                (this.l = 0),
                (this.m = new Map([
                  ["CC1", new bf(0, 0)],
                  ["CC2", new bf(0, 1)],
                  ["CC3", new bf(1, 0)],
                  ["CC4", new bf(1, 1)],
                ])),
                (this.u = this.o = 0),
                (this.j = new Map()),
                (this.C = !0),
                (this.B = new Set()),
                Iy(this));
            }
            yl.prototype.clear = function () {
              ((this.l = 0), (this.h = []), (this.g = []));
              var e = this.i;
              ((e.i = []), (e.h = []), (e.g = 0), Iy(this), (e = I(this.j.values())));
              for (var t = e.next(); !t.done; t = e.next()) dw(t.value);
            };
            function Iy(e) {
              ((e.o = 0), (e.u = 0));
              for (var t = I(e.m.values()), r = t.next(); !r.done; r = t.next())
                ((r = r.value), (r.h = 0), (r.g = r.j), (r.m = null), vc(r.i), vc(r.j), vc(r.o));
              e.C = !0;
            }
            ((yl.prototype.extract = function (e, t) {
              if (this.C) {
                for (var r = I(this.m.values()), s = r.next(); !s.done; s = r.next()) s.value.l = t;
                this.C = !1;
              }
              if (
                ((e = new Gt(e, 0)),
                !(e.getLength() < 8) &&
                  e.Y() === 181 &&
                  e.Ca() === 49 &&
                  e.U() === 1195456820 &&
                  e.Y() === 3 &&
                  ((r = e.Y()), (r & 64) !== 0))
              )
                for (r &= 31, e.skip(1), s = 0; s < r; s++) {
                  var a = e.Y(),
                    c = (a & 4) >> 2,
                    f = e.Y(),
                    g = e.Y();
                  c &&
                    ((a &= 3),
                    a === 0 || a === 1
                      ? this.h.push({ pts: t, type: a, Cb: f, kc: g, order: this.h.length })
                      : (this.g.push({ pts: t, type: a, value: f, order: this.g.length }),
                        this.g.push({ pts: t, type: 2, value: g, order: this.g.length })));
                }
            }),
              (yl.prototype.decode = function () {
                function e(a, c) {
                  return a.pts - c.pts || a.order - c.order;
                }
                var t = [];
                (this.h.sort(e), this.g.sort(e));
                for (var r = I(this.h), s = r.next(); !s.done; s = r.next())
                  (s = GF(this, s.value)) && t.push(s);
                for (r = I(this.g), s = r.next(); !s.done; s = r.next()) NF(this.i, s.value);
                for (r = I(this.i.i), s = r.next(); !s.done; s = r.next())
                  ((s = jF(this, s.value)), t.push.apply(t, V(s)));
                return ((this.i.i = []), (this.h = []), (this.g = []), t);
              }));
            function GF(e, t) {
              var r = t.type;
              if ((t.Cb & 112) === 16) {
                var s = (t.Cb >> 3) & 1;
                r === 0 ? (e.o = s) : (e.u = s);
              }
              if (
                ((s = "CC" + (((r << 1) | (r ? e.u : e.o)) + 1)),
                (r = e.m.get(s)),
                (t.Cb === 255 && t.kc === 255) || (!t.Cb && !t.kc) || !pw(t.Cb) || !pw(t.kc))
              )
                return (++e.l >= 45 && Iy(e), null);
              ((e.l = 0), (t.Cb &= 127), (t.kc &= 127));
              var a = t.Cb;
              if ((a >= 1 && a <= 15) || (!t.Cb && !t.kc)) return null;
              if (((a = null), (t.Cb & 112) === 16))
                e: {
                  if ((e.B.add(s), (s = t.Cb), (e = t.kc), r.m === ((s << 8) | e))) r.m = null;
                  else if (((r.m = (s << 8) | e), (s & 240) === 16 && (e & 192) === 64)) {
                    ((t = [11, 11, 1, 2, 3, 4, 12, 13, 14, 15, 5, 6, 7, 8, 9, 10][
                      ((s & 7) << 1) | ((e >> 5) & 1)
                    ]),
                      (s = "white"),
                      (a = !1));
                    var c = null,
                      f = e > 95 ? e - 96 : e - 64;
                    (f <= 13
                      ? (s = lw[Math.floor(f / 2)])
                      : f <= 15
                        ? (a = !0)
                        : (c = Math.floor((f - 16) / 2)),
                      (e = (e & 1) === 1),
                      r.h !== 4 &&
                        ((f = r.g),
                        r.h === 3 &&
                          t !== f.g &&
                          ((r = 1 + t - f.h),
                          iw(f, r, 1 + f.g - f.h, f.h),
                          Os(f, 0, r - 1),
                          Os(f, t + 1, 15 - t)),
                        (f.g = t),
                        (f.m = e),
                        (f.j = a),
                        (f.l = s),
                        (f.u = c),
                        (f.o = "black")));
                  } else if ((s & 247) === 17 && (e & 240) === 32)
                    ((r.g.m = !1),
                      (r.g.j = !1),
                      (r.g.l = "white"),
                      ml(r.g, 0, 32),
                      (s = !1),
                      (t = lw[(e & 14) >> 1]),
                      t === "white_italics" && ((t = "white"), (s = !0)),
                      (r.g.m = (e & 1) === 1),
                      (r.g.j = s),
                      (r.g.l = t));
                  else if (((s & 247) === 16 && (e & 240) === 32) || ((s & 247) === 23 && (e & 255) === 45))
                    ((t = "black"), (s & 7) === 0 && (t = MF[(e & 14) >> 1]), (r.g.o = t));
                  else if ((s & 247) === 17 && (e & 240) === 48) ml(r.g, 1, e);
                  else if ((s & 246) === 18 && (e & 224) === 32) ml(r.g, s & 1 ? 3 : 2, e);
                  else {
                    if ((s & 246) === 20 && (e & 240) === 32) {
                      switch (((e = t.pts), (s = null), t.kc)) {
                        case 32:
                          ow(r);
                          break;
                        case 33:
                          ((r = r.g), r.i[r.g].pop());
                          break;
                        case 37:
                          s = Ty(r, 2, e);
                          break;
                        case 38:
                          s = Ty(r, 3, e);
                          break;
                        case 39:
                          s = Ty(r, 4, e);
                          break;
                        case 40:
                          ml(r.g, 0, 32);
                          break;
                        case 41:
                          ((r.h = 2), (r.g = r.i), (r.g.h = 0), (r.l = e));
                          break;
                        case 42:
                          (vc(r.o), aw(r));
                          break;
                        case 43:
                          aw(r);
                          break;
                        case 44:
                          ((t = r.i), (s = null), r.h !== 4 && (s = _f(t, r.l, e)), Os(t, 0, 15));
                          break;
                        case 45:
                          ((t = r.g),
                            r.h !== 3
                              ? (s = null)
                              : ((s = _f(t, r.l, e)),
                                (a = t.g - t.h + 1),
                                iw(t, a - 1, a, t.h),
                                Os(t, 0, a - 1),
                                Os(t, t.g, 15 - t.g),
                                (r.l = e)));
                          break;
                        case 46:
                          Os(r.j, 0, 15);
                          break;
                        case 47:
                          ((t = null),
                            r.h !== 4 && (t = _f(r.i, r.l, e)),
                            (s = r.j),
                            (r.j = r.i),
                            (r.i = s),
                            ow(r),
                            (r.l = e),
                            (s = t));
                      }
                      a = s;
                      break e;
                    }
                    (s == 23 || s == 31) && e >= 33 && e <= 35 && (r.g.B = e - 32);
                  }
                  a = null;
                }
              else ((e = t.kc), ml(r.g, 0, t.Cb), ml(r.g, 0, e));
              return a;
            }
            function jF(e, t) {
              var r = [];
              try {
                for (; t.Ia(); ) {
                  var s = Sn(t).value,
                    a = (s & 224) >> 5,
                    c = s & 31;
                  if ((a === 7 && c != 0 && (a = Sn(t).value & 63), a != 0)) {
                    (e.B.add("svc" + a), e.j.has(a) || e.j.set(a, new FF(a)));
                    for (var f = e.j.get(a), g = t.Pa(); t.Pa() - g < c; ) {
                      a = f;
                      var m = t,
                        x = Sn(m),
                        E = x.value,
                        A = x.pts;
                      if (E === 16) {
                        var R = Sn(m);
                        E = (E << 16) | R.value;
                      }
                      if (E >= 0 && E <= 31) var b = UF(a, m, E, A);
                      else if (E >= 128 && E <= 159) b = BF(a, m, E, A);
                      else {
                        if (E >= 4096 && E <= 4127)
                          ((a = m),
                            (m = E & 255),
                            m >= 8 && m <= 15
                              ? a.skip(1)
                              : m >= 16 && m <= 23
                                ? a.skip(2)
                                : m >= 24 && m <= 31 && a.skip(3));
                        else if (E >= 4224 && E <= 4255)
                          ((a = m),
                            (m = E & 255),
                            m >= 128 && m <= 135 ? a.skip(4) : m >= 136 && m <= 143 && a.skip(5));
                        else if (E >= 32 && E <= 127)
                          ((m = E), a.g && (m === 127 ? yo(a.g, "") : yo(a.g, String.fromCharCode(m))));
                        else if (E >= 160 && E <= 255) a.g && yo(a.g, String.fromCharCode(E));
                        else if (E >= 4128 && E <= 4223) {
                          if (((m = E & 255), a.g))
                            if (fw.has(m)) {
                              var D = fw.get(m);
                              yo(a.g, D);
                            } else yo(a.g, "_");
                        } else
                          E >= 4256 &&
                            E <= 4351 &&
                            a.g &&
                            ((E & 255) != 160 ? yo(a.g, "_") : yo(a.g, "[CC]"));
                        b = [];
                      }
                      r.push.apply(r, V(b));
                    }
                  }
                }
              } catch (M) {
                if (M instanceof ee && M.code === 3e3)
                  Cn("CEA708_INVALID_DATA", "Buffer read out of bounds / invalid CEA-708 Data.");
                else throw M;
              }
              return r;
            }
            function pw(e) {
              for (var t = 0; e; ) ((t ^= e & 1), (e >>= 1));
              return t === 1;
            }
            ((yl.prototype.getStreams = function () {
              return Array.from(this.B);
            }),
              Ee("shaka.cea.CeaDecoder", yl),
              (Vo = function () {
                return new yl();
              }));
            function gw(e) {
              for (var t = [], r = e, s = (e = 0); s < r.length; )
                (e == 2 && r[s] == 3
                  ? ((e = 0), (r = [].concat(V(r))), r.splice(s, 1), (r = new Uint8Array(r)))
                  : r[s] == 0
                    ? e++
                    : (e = 0),
                  s++);
              for (e = r, s = 0; s < e.length; ) {
                for (r = 0; e[s] == 255; ) ((r += 255), s++);
                r += e[s++];
                for (var a = 0; e[s] == 255; ) ((a += 255), s++);
                ((a += e[s++]), r == 4 && t.push(e.subarray(s, s + a)), (s += a));
              }
              return t;
            }
            function Df() {
              ((this.j = new Map()), (this.i = this.h = 0), (this.g = wy));
            }
            ((Df.prototype.init = function (e) {
              function t(c) {
                ((c = c.name), kf.has(c) && (r.g = kf.get(c)));
              }
              var r = this,
                s = [],
                a = [];
              if (
                (new bt()
                  .box("moov", Ze)
                  .box("mvex", Ze)
                  .S("trex", function (c) {
                    var f = c.reader;
                    (f.skip(4), f.skip(4), (c = f.U()), (f = f.U()), (r.h = c), (r.i = f));
                  })
                  .box("trak", Ze)
                  .S("tkhd", function (c) {
                    var f = c.reader;
                    ((c = c.version), c == 1 ? (f.skip(8), f.skip(8)) : (f.skip(4), f.skip(4)));
                    var g = f.U();
                    (c == 1 ? f.skip(8) : f.skip(4),
                      f.skip(4),
                      f.skip(8),
                      f.skip(2),
                      f.skip(2),
                      f.skip(2),
                      f.skip(2),
                      f.skip(36),
                      f.Ca(),
                      f.Ca(),
                      f.Ca(),
                      f.Ca(),
                      s.push(g));
                  })
                  .box("mdia", Ze)
                  .S("mdhd", function (c) {
                    ((c = wh(c.reader, c.version)), a.push(c.timescale));
                  })
                  .box("minf", Ze)
                  .box("stbl", Ze)
                  .S("stsd", ws)
                  .box("avc1", t)
                  .box("avc3", t)
                  .box("dvav", t)
                  .box("dva1", t)
                  .box("hev1", t)
                  .box("hvc1", t)
                  .box("dvh1", t)
                  .box("dvhe", t)
                  .box("vvc1", t)
                  .box("vvi1", t)
                  .box("dvc1", t)
                  .box("dvi1", t)
                  .box("encv", Oi)
                  .box("sinf", Ze)
                  .box("frma", function (c) {
                    ((c = Km(c.reader).codec), kf.has(c) && (r.g = kf.get(c)));
                  })
                  .parse(e, !0, !0),
                !s.length || !a.length || s.length != a.length)
              )
                throw new ee(2, 2, 2010);
              (this.g == wy && He("Unable to determine bitstream format for CEA parsing!"),
                s.forEach(function (c, f) {
                  r.j.set(c, a[f]);
                }));
            }),
              (Df.prototype.parse = function (e) {
                var t = this;
                if (this.g == wy) return [];
                var r = [],
                  s = 0,
                  a = [];
                return (
                  new bt()
                    .box("moof", function (c) {
                      ((s = c.start), (a = []), Ze(c));
                    })
                    .box("traf", function (c) {
                      (a.push({ baseMediaDecodeTime: null, Wd: t.h, Xd: t.i, Ii: [], timescale: 9e4 }),
                        Ze(c));
                    })
                    .S("trun", function (c) {
                      var f = a[a.length - 1];
                      ((c = Rh(c.reader, c.version, c.flags)), f.Ii.push(c));
                    })
                    .S("tfhd", function (c) {
                      var f = a[a.length - 1];
                      ((c = Ah(c.reader, c.flags)),
                        (f.Wd = c.Wd || t.h),
                        (f.Xd = c.Xd || t.i),
                        (c = c.trackId),
                        t.j.has(c) && (f.timescale = t.j.get(c)));
                    })
                    .S("tfdt", function (c) {
                      var f = a[a.length - 1];
                      ((c = Ih(c.reader, c.version)), (f.baseMediaDecodeTime = c.baseMediaDecodeTime));
                    })
                    .box("mdat", function (c) {
                      for (
                        var f = s - c.start - 8, g = c.reader.Pa(), m = I(a), x = m.next();
                        !x.done;
                        x = m.next()
                      )
                        ((x = x.value),
                          x.baseMediaDecodeTime === null
                            ? He("Unable to find base media decode time for CEA captions!")
                            : (c.reader.seek(g),
                              VF(t, c.reader, x.baseMediaDecodeTime, x.timescale, x.Wd, x.Xd, f, x.Ii, r)));
                    })
                    .parse(e, !1, !0),
                  r
                );
              }));
            function VF(e, t, r, s, a, c, f, g, m) {
              var x = 0,
                E = c,
                A = g.map(function (D) {
                  return D.mh;
                });
              for (
                A = [].concat.apply([], V(A)), A.length && (E = A[0].sampleSize || c), t.skip(f + g[0].qg);
                t.Ia();
              ) {
                f = t.U();
                var R = t.Y(),
                  b = null;
                switch (((b = !1), (g = 1), e.g)) {
                  case Sc:
                    ((b = R & 31), (b = b == 6));
                    break;
                  case Ec:
                    ((g = 2), t.skip(1), (b = (R >> 1) & 63), (b = b == 39 || b == 40));
                    break;
                  case Ac:
                    ((g = 2), t.skip(1), (b = (R >> 1) & 63), (b = b == 23 || b == 24));
                    break;
                  default:
                    return;
                }
                if (b)
                  for (
                    R = 0,
                      x < A.length && (R = A[x].Gf || 0),
                      R = (r + R) / s,
                      g = t.Tb(f - g, !1),
                      g = I(gw(g)),
                      b = g.next();
                    !b.done;
                    b = g.next()
                  )
                    m.push({ packet: b.value, pts: R });
                else
                  try {
                    t.skip(f - g);
                  } catch (D) {
                    break;
                  }
                ((E -= f + 4),
                  E == 0 &&
                    ((r = x < A.length ? r + (A[x].nh || a) : r + a),
                    x++,
                    x < A.length ? (E = A[x].sampleSize || c) : (E = c)));
              }
            }
            Ee("shaka.cea.Mp4CeaParser", Df);
            var wy = 0,
              Sc = 1,
              Ec = 2,
              Ac = 3,
              kf = new Map()
                .set("avc1", Sc)
                .set("avc3", Sc)
                .set("dvav", Sc)
                .set("dva1", Sc)
                .set("hev1", Ec)
                .set("hvc1", Ec)
                .set("dvh1", Ec)
                .set("dvhe", Ec)
                .set("vvc1", Ac)
                .set("vvi1", Ac)
                .set("dvc1", Ac)
                .set("dvi1", Ac);
            mm("video/mp4", function () {
              return new Df();
            });
            function Mf() {
              this.g = null;
            }
            ((Mf.prototype.init = function () {}),
              (Mf.prototype.parse = function (e) {
                this.g ? this.g.clearData() : (this.g = new Ft());
                var t = [];
                if (((e = We(e)), !Za(e))) return t;
                e = this.g.parse(e);
                var r = e.Yd(),
                  s = e.ef();
                switch (((e = []), r.video)) {
                  case "avc":
                    e.push(6);
                    break;
                  case "hvc":
                    (e.push(39), e.push(40));
                }
                if (!e.length) return t;
                for (r = I(s), s = r.next(); !s.done; s = r.next())
                  if (((s = s.value), e.includes(s.type) && s.time != null))
                    for (var a = I(gw(s.data)), c = a.next(); !c.done; c = a.next())
                      t.push({ packet: c.value, pts: s.time });
                return t;
              }),
              Ee("shaka.cea.TsCeaParser", Mf),
              mm("video/mp2t", function () {
                return new Mf();
              }));
            function HF(e) {
              var t = 0,
                r = Ti(e),
                s = r.getUint32(t, !0);
              if (s != e.byteLength) return [];
              e: {
                for (e = t + 4 + 2, t = []; e < r.byteLength - 1; ) {
                  ((s = r.getUint16(e, !0)), (e += 2));
                  var a = r.getUint16(e, !0);
                  if (((e += 2), (a & 1) != 0 || a + e > r.byteLength)) {
                    r = [];
                    break e;
                  }
                  var c = We(r, e, a);
                  (t.push({ type: s, value: c }), (e += a));
                }
                r = t;
              }
              return r;
            }
            function mw(e) {
              return (
                (e = rr(cn(e))),
                (e = HF(e).filter(function (t) {
                  return t.type === KF;
                })[0]),
                e ? ((e = Zs(e.value, !0)), (e = Wo(e, "WRMHEADER")) ? e : null) : null
              );
            }
            function Pf(e) {
              try {
                var t = mw(e);
                if (t)
                  e: {
                    for (var r = I(Br(t, "DATA")), s = r.next(); !s.done; s = r.next()) {
                      var a = s.value;
                      if (a.children)
                        for (var c = I(a.children), f = c.next(); !f.done; f = c.next()) {
                          var g = f.value;
                          if (g.tagName == "LA_URL") {
                            var m = cn(g);
                            break e;
                          }
                        }
                    }
                    m = "";
                  }
                else m = "";
                return m;
              } catch (x) {
                return "";
              }
            }
            var KF = 1;
            function yw() {
              this.g = new Map();
            }
            yw.prototype.release = function () {
              this.g.clear();
            };
            function vw(e, t, r, s) {
              var a = YF(e, t),
                c = null;
              e = [];
              var f = [];
              t = null;
              var g = new Set(
                a.map(function (x) {
                  return x.keyId;
                }),
              );
              g.delete(null);
              var m = "cenc";
              if (g.size > 1) throw new ee(2, 4, 4010);
              if (!r) {
                if (
                  ((f = a.filter(function (x) {
                    return x.Hd == "urn:mpeg:dash:sea:2012";
                  })),
                  f.length > 1)
                )
                  throw new ee(2, 4, 4050);
                (f.length && (t = qF(f[0])),
                  (f = a.find(function (x) {
                    return x.Hd == "urn:mpeg:dash:mp4protection:2011";
                  })) &&
                    f.encryptionScheme &&
                    (m = f.encryptionScheme),
                  (f = a.filter(function (x) {
                    return x.Hd == "urn:mpeg:dash:mp4protection:2011"
                      ? ((c = x.init || c), !1)
                      : x.Hd != "urn:mpeg:dash:sea:2012";
                  })),
                  f.length && ((e = zF(c, m, f, s, g)), e.length == 0 && (e = [ms("", m, c)])));
              }
              if (a.length && !t && (r || !f.length))
                for (e = [], r = I(Object.values(s)), s = r.next(); !s.done; s = r.next())
                  ((s = s.value), s != "org.w3.clearkey" && ((s = ms(s, m, c)), e.push(s)));
              if ((g = Array.from(g)[0] || null))
                for (m = I(e), r = m.next(); !r.done; r = m.next())
                  for (r = I(r.value.initData), s = r.next(); !s.done; s = r.next()) s.value.keyId = g;
              return { Yh: g, Em: c, drmInfos: e, hg: t, ci: !0 };
            }
            function WF(e, t, r, s, a) {
              var c = vw(e, t, s, a);
              if (r.ci)
                ((e = r.drmInfos.length == 1 && !r.drmInfos[0].keySystem),
                  (t = c.drmInfos.length == 0),
                  (r.drmInfos.length == 0 || (e && !t)) && (r.drmInfos = c.drmInfos),
                  (r.ci = !1));
              else if (
                c.drmInfos.length > 0 &&
                ((r.drmInfos = r.drmInfos.filter(function (f) {
                  return c.drmInfos.some(function (g) {
                    return g.keySystem == f.keySystem;
                  });
                })),
                r.drmInfos.length == 0)
              )
                throw new ee(2, 4, 4008);
              return c.Yh || r.Yh;
            }
            function Of(e) {
              var t = sr(e.node, "https://dashif.org/CPS", "Laurl");
              if (t && (t = cn(t))) return t;
              if ((t = sr(e.node, "urn:microsoft:playready", "pro")) && cn(t)) return Pf(t);
              if ((e = sr(e.node, "urn:mpeg:cenc:2013", "pssh")) && (e = cn(e))) {
                ((t = rr(e)), (e = 8), (t = Ti(t)));
                var r = t.getUint8(e);
                return (
                  (e += 20),
                  r > 0 && (e += 4 + 16 * t.getUint32(e)),
                  (e = We(t, e + 4)),
                  (e = zd(e)),
                  (e = Wo("<pro>" + e + "</pro>")),
                  Pf(e)
                );
              }
              return "";
            }
            function zF(e, t, r, s, a) {
              var c = [];
              r = I(r);
              for (var f = r.next(); !f.done; f = r.next()) {
                f = f.value;
                var g = s[f.Hd];
                if (g) {
                  var m;
                  if ((m = sr(f.node, "urn:microsoft:playready", "pro")) && cn(m)) {
                    ((m = cn(m)), (m = rr(m)));
                    var x = new Uint8Array([
                      154, 4, 240, 121, 152, 64, 66, 134, 171, 146, 230, 91, 224, 136, 95, 149,
                    ]);
                    m = [{ initData: Sh(m, x, new Set(), 0), initDataType: "cenc", keyId: f.keyId }];
                  } else m = null;
                  if (((x = null), f.Hd === "urn:uuid:e2719d58-a985-b3c9-781a-b030af78d30e")) {
                    x = f;
                    var E = a;
                    if (E.size == 0) x = null;
                    else {
                      var A = new Uint8Array([
                          16, 119, 239, 236, 192, 178, 77, 2, 172, 227, 60, 30, 82, 226, 251, 75,
                        ]),
                        R = new Uint8Array([]);
                      x = [{ initData: Sh(R, A, E, 1), initDataType: "cenc", keyId: x.keyId }];
                    }
                  }
                  ((m = ms(g, t, f.init || e || m || x)), (g = QF.get(g)) && (m.licenseServerUri = g(f)));
                  e: {
                    if ((f = sr(f.node, "https://dashif.org/CPS", "Certurl")) && (f = cn(f))) break e;
                    f = "";
                  }
                  ((m.serverCertificateUri = f), c.push(m));
                }
              }
              return c;
            }
            function YF(e, t) {
              var r = [];
              t = I(t);
              for (var s = t.next(); !s.done; s = t.next()) (s = XF(e, s.value)) && r.push(s);
              return r;
            }
            function XF(e, t) {
              var r = t.attributes.schemeIdUri,
                s = ys(t, "urn:mpeg:cenc:2013", "default_KID"),
                a = YS(t, "urn:mpeg:cenc:2013", "pssh").map(ui),
                c = t.attributes.value;
              if (!r) return null;
              if (((r = r.toLowerCase()), s && ((s = s.replace(/-/g, "").toLowerCase()), s.includes(" "))))
                throw new ee(2, 4, 4009);
              var f = [];
              try {
                f = a.map(function (g) {
                  if (!e.g.has(g)) {
                    var m = rr(g);
                    e.g.set(g, m);
                  }
                  return { initDataType: "cenc", initData: e.g.get(g), keyId: null };
                });
              } catch (g) {
                throw new ee(2, 4, 4007);
              }
              return { node: t, Hd: r, keyId: s, init: f.length > 0 ? f : null, encryptionScheme: c };
            }
            function qF(e) {
              if (!l.crypto || !l.crypto.subtle)
                throw (
                  He(
                    "Web Crypto API is not available to decrypt AES-128. (Web Crypto only exists in secure origins like https)",
                  ),
                  new ee(2, 4, 4042)
                );
              var t = sr(e.node, "urn:mpeg:dash:schema:sea:2012", "SegmentEncryption");
              if (!t) throw new ee(2, 4, 4051);
              if (t.attributes.schemeIdUri != "urn:mpeg:dash:sea:aes128-cbc:2013") throw new ee(2, 4, 4051);
              if (((t = sr(e.node, "urn:mpeg:dash:schema:sea:2012", "CryptoPeriod")), !t))
                throw new ee(2, 4, 4051);
              if (((e = t.attributes.IV), (t = li(t.attributes.keyUriTemplate)), !e || !t))
                throw new ee(2, 4, 4051);
              if (((e = Go(e.substr(2))), e.byteLength != 16)) throw new ee(2, 4, 4048);
              return { wk: t, iv: e };
            }
            var QF = new Map()
              .set("com.apple.fps", function (e) {
                if (l.shakaMediaKeysPolyfill === "apple") throw new ee(2, 4, 4054);
                return (e = sr(e.node, "https://dashif.org/CPS", "Laurl")) && (e = cn(e)) ? e : "";
              })
              .set("com.widevine.alpha", function (e) {
                var t = sr(e.node, "https://dashif.org/CPS", "Laurl");
                return t && (t = cn(t))
                  ? t
                  : ((e = sr(e.node, "urn:microsoft", "laurl")) && li(e.attributes.licenseUrl)) || "";
              })
              .set("com.microsoft.playready", Of)
              .set("com.microsoft.playready.recommendation", Of)
              .set("com.microsoft.playready.software", Of)
              .set("com.microsoft.playready.hardware", Of)
              .set("org.w3.clearkey", function (e) {
                var t = sr(e.node, "https://dashif.org/CPS", "Laurl");
                return t && (t = cn(t))
                  ? t
                  : (e = sr(e.node, "http://dashif.org/guidelines/clearKey", "Laurl")) &&
                      e.attributes.Lic_type === "EME-1.0" &&
                      e &&
                      (e = cn(e))
                    ? e
                    : "";
              });
            function Ic(e, t, r, s, a, c) {
              var f = new Map()
                .set("RepresentationID", t)
                .set("Number", r)
                .set("SubNumber", s)
                .set("Bandwidth", a)
                .set("Time", c);
              return e.replace(
                /\$(RepresentationID|Number|SubNumber|Bandwidth|Time)?(?:%0([0-9]+)([diouxX]))?\$/g,
                function (g, m, x, E) {
                  if (g == "$$") return "$";
                  var A = f.get(m);
                  if (A == null) return g;
                  switch (
                    (m == "RepresentationID" && x && (x = void 0),
                    m == "Time" &&
                      typeof A != "bigint" &&
                      (Math.abs(A - Math.round(A)) >= 0.2 &&
                        He("Calculated $Time$ values must be close to integers"),
                      (A = Math.round(A))),
                    E)
                  ) {
                    case void 0:
                    case "d":
                    case "i":
                    case "u":
                      g = A.toString();
                      break;
                    case "o":
                      g = A.toString(8);
                      break;
                    case "x":
                      g = A.toString(16);
                      break;
                    case "X":
                      g = A.toString(16).toUpperCase();
                      break;
                    default:
                      g = A.toString();
                  }
                  return ((x = l.parseInt(x, 10) || 1), Array(Math.max(0, x - g.length) + 1).join("0") + g);
                },
              );
            }
            function xw(e, t) {
              var r = Lr(e, t, "timescale"),
                s = 1;
              (r && (s = Qr(r) || 1), (r = Lr(e, t, "duration")));
              var a = (r = Qr(r || "")) ? r / s : null,
                c = Lr(e, t, "startNumber"),
                f = Number(Lr(e, t, "presentationTimeOffset")) || 0,
                g = Fn(c || "");
              if (((c == null || g == null) && (g = 1), (c = null), (t = vl(e, t, "SegmentTimeline")))) {
                ((t = Rt(t, "S")), (c = s), (e = e.na.duration || 1 / 0));
                for (var m = g, x = [], E = -f, A = 0; A < t.length; ++A) {
                  var R = t[A],
                    b = t[A + 1],
                    D = ze(R, "t", Fn),
                    M = ze(R, "d", Fn),
                    P = ze(R, "r", Nn);
                  if (((R = ze(R, "k", Nn) || 0), D != null && (D -= f), M)) {
                    if (((D = D != null ? D : E), (P = P || 0), P < 0))
                      if (b) {
                        if (((b = ze(b, "t", Fn)), b == null)) break;
                        if (D >= b) break;
                        P = Math.ceil((b - D) / M) - 1;
                      } else {
                        if (e == 1 / 0) break;
                        if (D / c >= e) break;
                        P = Math.ceil((e * c - D) / M) - 1;
                      }
                    for (x.length > 0 && D != E && (x[x.length - 1].end = D / c), b = 0; b <= P; ++b)
                      ((E = D + M),
                        x.push({ start: D / c, Ld: D, end: E / c, Jh: E, wc: R, Vk: x.length + m }),
                        (D = E));
                  }
                }
                c = x;
              }
              return { timescale: s, Qf: r, gb: a, ve: g, ec: f / s || 0, gd: f, timeline: c };
            }
            function Tw(e, t) {
              return [t(e.L), t(e.qa), t(e.sa)].filter(so);
            }
            function Lr(e, t, r) {
              ((t = Tw(e, t)), (e = null), (t = I(t)));
              for (var s = t.next(); !s.done && !(e = s.value.attributes[r]); s = t.next());
              return e;
            }
            function vl(e, t, r) {
              ((t = Tw(e, t)), (e = null), (t = I(t)));
              for (var s = t.next(); !s.done && !(e = jt(s.value, r)); s = t.next());
              return e;
            }
            function JF(e, t, r, s, a, c) {
              for (
                var f = ys(e, "http://www.w3.org/1999/xlink", "href"),
                  g = ys(e, "http://www.w3.org/1999/xlink", "actuate") || "onRequest",
                  m = I(Object.keys(e.attributes)),
                  x = m.next();
                !x.done;
                x = m.next()
              ) {
                x = x.value;
                var E = x.split(":"),
                  A = vm("http://www.w3.org/1999/xlink");
                E[0] == A && delete e.attributes[x];
              }
              if (c >= 5) return oo(new ee(2, 4, 4028));
              if (g != "onLoad") return oo(new ee(2, 4, 4027));
              var R = Ln([s], [f]);
              return a.request(0, fn(R, t)).Xa(function (b) {
                if (((b = Ru(b.data, e.tagName)), !b)) return oo(new ee(2, 4, 4001, f));
                for (e.children = []; b.children.length; ) {
                  var D = b.children.shift();
                  e.children.push(D);
                }
                D = I(Object.keys(b.attributes));
                for (var M = D.next(); !M.done; M = D.next())
                  ((M = M.value), (e.attributes[M] = b.attributes[M]));
                return Nf(e, t, r, R[0], a, c + 1);
              });
            }
            function Nf(e, t, r, s, a, c) {
              if (((c = c === void 0 ? 0 : c), ys(e, "http://www.w3.org/1999/xlink", "href"))) {
                var f = JF(e, t, r, s, a, c);
                return (
                  r &&
                    (f = f.Xa(void 0, function () {
                      return Nf(e, t, r, s, a, c);
                    })),
                  f
                );
              }
              f = [];
              for (var g = I(zS(e)), m = g.next(), x = {}; !m.done; x = { Td: void 0 }, m = g.next())
                ((x.Td = m.value),
                  ys(x.Td, "http://www.w3.org/1999/xlink", "href") == "urn:mpeg:dash:resolve-to-zero:2013"
                    ? (e.children = e.children.filter(
                        (function (E) {
                          return function (A) {
                            return A !== E.Td;
                          };
                        })(x),
                      ))
                    : x.Td.tagName != "SegmentTimeline" && f.push(Nf(x.Td, t, r, s, a, c)));
              return _E(f).Xa(function () {
                return e;
              });
            }
            function ZF(e, t, r, s, a, c, f, g) {
              var m,
                x = new bt().S("sidx", function (E) {
                  m = eU(t, s, a, c, f, r, E, g);
                });
              if ((e && x.parse(e), m)) return m;
              throw new ee(2, 3, 3004);
            }
            function eU(e, t, r, s, a, c, f, g) {
              g = g === void 0 ? !1 : g;
              var m = [];
              f.reader.skip(4);
              var x = f.reader.U();
              if (x == 0) throw new ee(2, 3, 3005);
              if (f.version == 0)
                var E = f.reader.U(),
                  A = f.reader.U();
              else ((E = f.reader.Ed()), (A = f.reader.Ed()));
              f.reader.skip(2);
              var R = f.reader.Ca();
              for (e = (g ? -f.size : e) + f.size + A, g = 0; g < R; g++) {
                var b = f.reader.U();
                ((A = (b & 2147483648) >>> 31), (b &= 2147483647));
                var D = f.reader.U();
                if ((f.reader.skip(4), A == 1)) throw new ee(2, 3, 3006);
                (m.push(
                  new Be(
                    E / x + r,
                    (E + D) / x + r,
                    function () {
                      return c;
                    },
                    e,
                    e + b - 1,
                    t,
                    r,
                    s,
                    a,
                  ),
                ),
                  (E += D),
                  (e += b));
              }
              return (f.parser.stop(), m);
            }
            function vo(e) {
              ((this.h = Ti(e)), (this.g = new Gt(this.h, 0)));
            }
            vo.prototype.Ia = function () {
              return this.g.Ia();
            };
            function Ns(e) {
              var t = Sw(e);
              if (t.length > 7) throw new ee(2, 3, 3002);
              var r = 0;
              t = I(t);
              for (var s = t.next(); !s.done; s = t.next()) r = 256 * r + s.value;
              t = Sw(e);
              e: {
                s = I(tU);
                for (var a = s.next(); !a.done; a = s.next())
                  if (fs(t, new Uint8Array(a.value))) {
                    s = !0;
                    break e;
                  }
                s = !1;
              }
              if (s) t = e.h.byteLength - e.g.Pa();
              else {
                if (t.length == 8 && t[1] & 224) throw new ee(2, 3, 3001);
                for (a = s = 0; a < t.length; a++) {
                  var c = t[a];
                  s = a == 0 ? c & ((1 << (8 - t.length)) - 1) : 256 * s + c;
                }
                t = s;
              }
              return (
                (t = e.g.Pa() + t <= e.h.byteLength ? t : e.h.byteLength - e.g.Pa()),
                (s = Ti(e.h, e.g.Pa(), t)),
                e.g.skip(t),
                new nU(r, s)
              );
            }
            function Sw(e) {
              var t = e.g.Pa(),
                r = e.g.Y();
              if (r == 0) throw new ee(2, 3, 3002);
              return ((r = 8 - Math.floor(Math.log2(r))), e.g.skip(r - 1), We(e.h, t, r));
            }
            var tU = [
              [255],
              [127, 255],
              [63, 255, 255],
              [31, 255, 255, 255],
              [15, 255, 255, 255, 255],
              [7, 255, 255, 255, 255, 255],
              [3, 255, 255, 255, 255, 255, 255],
              [1, 255, 255, 255, 255, 255, 255, 255],
            ];
            function nU(e, t) {
              ((this.id = e), (this.g = t));
            }
            function Ry(e) {
              if (e.g.byteLength > 8) throw new ee(2, 3, 3002);
              if (e.g.byteLength == 8 && e.g.getUint8(0) & 224) throw new ee(2, 3, 3001);
              for (var t = 0, r = 0; r < e.g.byteLength; r++) {
                var s = e.g.getUint8(r);
                t = 256 * t + s;
              }
              return t;
            }
            function iU(e, t, r, s, a, c, f) {
              if (((t = new vo(t)), Ns(t).id != 440786851)) throw new ee(2, 3, 3008);
              var g = Ns(t);
              if (g.id != 408125543) throw new ee(2, 3, 3009);
              ((t = g.g.byteOffset), (g = new vo(g.g)));
              for (var m = null; g.Ia(); ) {
                var x = Ns(g);
                if (x.id == 357149030) {
                  m = x;
                  break;
                }
              }
              if (!m) throw new ee(2, 3, 3010);
              for (m = new vo(m.g), x = 1e6, g = null; m.Ia(); ) {
                var E = Ns(m);
                if (E.id == 2807729) x = Ry(E);
                else if (E.id == 17545)
                  if (E.g.byteLength == 4) g = E.g.getFloat32(0);
                  else if (E.g.byteLength == 8) g = E.g.getFloat64(0);
                  else throw new ee(2, 3, 3003);
              }
              if (g == null) throw new ee(2, 3, 3011);
              if (((m = x / 1e9), (g *= m), (e = Ns(new vo(e))), e.id != 475249515)) throw new ee(2, 3, 3007);
              return rU(e, t, m, g, r, s, a, c, f);
            }
            function rU(e, t, r, s, a, c, f, g, m) {
              function x() {
                return a;
              }
              var E = [];
              e = new vo(e.g);
              for (var A = null, R = null; e.Ia(); ) {
                var b = Ns(e);
                if (b.id == 187) {
                  var D = sU(b);
                  D &&
                    ((b = r * D.ol),
                    (D = t + D.Nk),
                    A != null && E.push(new Be(A + f, b + f, x, R, D - 1, c, f, g, m)),
                    (A = b),
                    (R = D));
                }
              }
              return (A != null && E.push(new Be(A + f, s + f, x, R, null, c, f, g, m)), E);
            }
            function sU(e) {
              var t = new vo(e.g);
              if (((e = Ns(t)), e.id != 179)) throw new ee(2, 3, 3013);
              if (((e = Ry(e)), (t = Ns(t)), t.id != 183)) throw new ee(2, 3, 3012);
              t = new vo(t.g);
              for (var r = 0; t.Ia(); ) {
                var s = Ns(t);
                if (s.id == 241) {
                  r = Ry(s);
                  break;
                }
              }
              return { ol: e, Nk: r };
            }
            function Ew(e, t, r) {
              if (((t = vl(e, t, "Initialization")), !t)) return null;
              var s = e.L.bb(),
                a = t.attributes.sourceURL;
              (a && (s = Ln(s, [li(a)], e.Lb())), (a = 0));
              var c = null;
              return (
                (t = ze(t, "range", Jd)) && ((a = t.start), (c = t.end)),
                (r = new Ai(
                  function () {
                    return s;
                  },
                  a,
                  c,
                  Rw(e),
                  null,
                  null,
                  r,
                  e.qa.encrypted,
                )),
                (r.codecs = e.L.codecs),
                (r.mimeType = e.L.mimeType),
                e.na && !e.na.kf && (r.g = e.na.start + e.na.duration),
                r
              );
            }
            function oU(e, t, r) {
              var s = Number(Lr(e, xl, "presentationTimeOffset")) || 0,
                a = Lr(e, xl, "timescale"),
                c = 1;
              a && (c = Qr(a) || 1);
              var f = s / c || 0,
                g = Ew(e, xl, r);
              aU(e, g);
              var m = to(e);
              return {
                endTime: -1,
                timeline: -1,
                Sc: function () {
                  var x = vl(m, xl, "RepresentationIndex"),
                    E = m.L.bb();
                  return (
                    x && (x = li(x.attributes.sourceURL)) && (E = Ln(E, [x], m.Lb())),
                    (x = Iw(m)),
                    Aw(m, t, g, E, x.start, x.end, f)
                  );
                },
                timescale: c,
              };
            }
            function Aw(e, t, r, s, a, c, f) {
              var g, m, x, E, A, R, b, D, M, P, G, U, H, Q, ne, z, J, X, ie, Z;
              return W(function (re) {
                if (re.g == 1)
                  return (
                    (g = e.presentationTimeline),
                    (m = !e.Eb || !e.na.kf),
                    (x = e.na.start),
                    (E = e.na.duration),
                    (A = e.L.mimeType.split("/")[1]),
                    (R = t),
                    (b = null),
                    (D = [R(s, a, c, !1), A == "webm" ? R(r.P(), r.startByte, r.endByte, !0) : null]),
                    (R = null),
                    _(re, Promise.all(D), 2)
                  );
                for (
                  M = re.h,
                    P = M[0],
                    G = M[1] || null,
                    U = null,
                    H = x - f,
                    Q = x,
                    ne = E ? x + E : 1 / 0,
                    z = e.L.bb(),
                    J =
                      z.length != s.length ||
                      z.some(function (se, me) {
                        return se != s[me];
                      }),
                    U = A == "mp4" ? ZF(P, a, z, r, H, Q, ne, J) : iU(P, G, z, r, H, Q, ne),
                    X = I(U),
                    ie = X.next();
                  !ie.done;
                  ie = X.next()
                )
                  ((Z = ie.value),
                    (Z.codecs = e.L.codecs),
                    (Z.mimeType = e.L.mimeType),
                    (Z.bandwidth = e.bandwidth));
                return (g.me(U), (b = new mt(U)), m && b.pd(Q, ne, !0), re.return(b));
              });
            }
            function xl(e) {
              return e.Id;
            }
            function Iw(e) {
              var t = vl(e, xl, "RepresentationIndex");
              return ((e = Lr(e, xl, "indexRange")), (e = Jd(e || "")), t && (e = ze(t, "range", Jd, e)), e);
            }
            function aU(e, t) {
              if ((ww(e, t), !Iw(e))) throw new ee(2, 4, 4002);
            }
            function ww(e, t) {
              var r = e.L.mimeType.split("/")[1];
              if (e.L.contentType != nt && r != "mp4" && r != "webm") throw new ee(2, 4, 4006);
              if (r == "webm" && !t) throw new ee(2, 4, 4005);
            }
            function Rw(e) {
              var t = e.L;
              return {
                bandwidth: e.bandwidth,
                audioSamplingRate: t.audioSamplingRate,
                codecs: t.codecs,
                contentType: t.contentType,
                frameRate: t.frameRate || null,
                height: t.height || null,
                mimeType: t.mimeType,
                channelsCount: t.yf,
                pixelAspectRatio: t.pixelAspectRatio || null,
                width: t.width || null,
                label: e.qa.label || null,
                roles: e.roles || null,
                language: e.qa.language || null,
              };
            }
            function lU(e, t, r) {
              var s = Ew(e, Cw, r),
                a = uU(e);
              if (!a.gb && !a.timeline && a.yd.length > 1) throw new ee(2, 4, 4002);
              if (!a.gb && !e.na.duration && !a.timeline && a.yd.length == 1) throw new ee(2, 4, 4002);
              if (a.timeline && a.timeline.length == 0) throw new ee(2, 4, 4002);
              var c = null,
                f = null;
              e.sa.id && e.L.id && (f = t.get(e.sa.id + "," + e.L.id)) && (c = f.segmentIndex);
              var g = cU(
                e.na.start,
                e.na.duration,
                e.L.bb,
                a,
                s,
                r,
                e.L.mimeType,
                e.L.codecs,
                e.bandwidth,
                e.Lb,
              );
              return (
                (t = !c),
                c ? c.ke(g, e.presentationTimeline.Hb()) : (c = new mt(g)),
                e.presentationTimeline.me(g),
                (e.Eb && e.na.kf) || c.pd(e.na.start, e.na.duration ? e.na.start + e.na.duration : 1 / 0, t),
                f && (f.segmentIndex = c),
                {
                  endTime: -1,
                  timeline: -1,
                  Sc: function () {
                    return ((c && c.getNumReferences() != 0) || c.tf(g), Promise.resolve(c));
                  },
                  timescale: a.timescale,
                }
              );
            }
            function Cw(e) {
              return e.Ac;
            }
            function uU(e) {
              var t = dU(e);
              e = xw(e, Cw);
              var r = e.ve;
              r == 0 && (r = 1);
              var s = 0;
              return (
                e.gb
                  ? (s = e.gb * (r - 1))
                  : e.timeline && e.timeline.length > 0 && (s = e.timeline[0].start),
                {
                  gb: e.gb,
                  startTime: s,
                  ve: r,
                  ec: e.ec,
                  timescale: e.timescale,
                  timeline: e.timeline,
                  yd: t,
                }
              );
            }
            function cU(e, t, r, s, a, c, f, g, m, x) {
              var E = s.yd.length;
              s.timeline &&
                s.timeline.length != s.yd.length &&
                (E = Math.min(s.timeline.length, s.yd.length));
              for (
                var A = e - s.ec, R = t ? e + t : 1 / 0, b = [], D = s.startTime, M = {}, P = 0;
                P < E;
                M = { Sf: void 0, Hf: void 0 }, P++
              ) {
                M.Hf = s.yd[P];
                var G = D;
                ((D = void 0),
                  (D = s.gb != null ? G + s.gb : s.timeline ? s.timeline[P].end : G + t),
                  (M.Sf = null),
                  (M = new Be(
                    e + G,
                    e + D,
                    (function (U) {
                      return function () {
                        return (U.Sf == null && (U.Sf = Ln(r(), [U.Hf.Ck], x())), U.Sf);
                      };
                    })(M),
                    M.Hf.start,
                    M.Hf.end,
                    a,
                    A,
                    e,
                    R,
                    [],
                    "",
                    null,
                    null,
                    Rs,
                    c,
                  )),
                  (M.codecs = g),
                  (M.mimeType = f),
                  (M.bandwidth = m),
                  b.push(M));
              }
              return b;
            }
            function dU(e) {
              return [e.L.Ac, e.qa.Ac, e.sa.Ac]
                .filter(so)
                .map(function (t) {
                  return Rt(t, "SegmentURL");
                })
                .reduce(function (t, r) {
                  return t.length > 0 ? t : r;
                })
                .map(function (t) {
                  t.attributes.indexRange && !e.Og && (e.Og = !0);
                  var r = li(t.attributes.media);
                  return (
                    (t = ze(t, "mediaRange", Jd, { start: 0, end: null })),
                    { Ck: r, start: t.start, end: t.end }
                  );
                });
            }
            function Lw(e, t, r, s, a, c, f, g, m, x) {
              m || e.L.hf || (e.L.hf = Lr(e, xo, "initialization"));
              var E = e.L.hf ? gU(e, f) : null,
                A = hU(e);
              fU(A);
              var R = to(e);
              if (A.fe)
                return (
                  ww(e, E),
                  {
                    endTime: -1,
                    timeline: -1,
                    Sc: function () {
                      var G = Ic(A.fe, R.L.originalId, null, null, R.bandwidth || null, null);
                      return ((G = Ln(R.L.bb(), [G])), Aw(R, t, E, G, 0, null, A.ec));
                    },
                    timescale: A.timescale,
                  }
                );
              if (A.gb)
                return (
                  s ||
                    e.qa.contentType === "image" ||
                    e.qa.contentType === "text" ||
                    ((s = e.na.start),
                    (x = e.sa.id),
                    (r = e.na.duration),
                    (x = (x = (x != null && c.get(x)) || r) ? s + x : 1 / 0),
                    e.presentationTimeline.Wg(A.gb),
                    e.presentationTimeline.Gi(s, x)),
                  {
                    endTime: -1,
                    timeline: -1,
                    Sc: function () {
                      return pU(R, A, a, E, c, f, g, e.L.If);
                    },
                    timescale: A.timescale,
                  }
                );
              var b = null;
              ((s = s = null),
                e.sa.id && e.L.id && ((s = e.sa.id + "," + e.L.id), (s = r.get(s))) && (b = s.segmentIndex));
              var D = e.na.start,
                M = e.na.duration ? D + e.na.duration : 1 / 0;
              if (b) ((x = b), _w(x, A, D, M, E, e.Eb), x.Ya(e.presentationTimeline.Hb()));
              else {
                if (((r = 0), (m = -1), e.sa.id != null && e.L.id != null)) {
                  var P = x.get(e.sa.id);
                  if (P) m = P.timeline;
                  else
                    for (x = I(x.values()), P = x.next(); !P.done; P = x.next())
                      if (((P = P.value), Math.abs(A.ec - P.endTime) <= BS && P.gh.includes(e.L.id))) {
                        m = P.timeline;
                        break;
                      } else P.timeline >= r && (r = P.timeline + 1);
                }
                (m == -1 && (m = r),
                  (b = new wc(e.Eb, A, e.L.originalId, e.bandwidth, e.L.bb, e.Lb, D, M, E, f, e.L.If, m)));
              }
              return (
                A.timeline &&
                  e.qa.contentType !== "image" &&
                  e.qa.contentType !== "text" &&
                  e.presentationTimeline.Hi(b.h ? b.h.timeline : [], D),
                s && e.Eb && (s.segmentIndex = b),
                (s = (s = (s = A.timeline) && s[s.length - 1]) ? s.end + A.ec : -1),
                (x = -1),
                b instanceof wc && (x = b.We()),
                {
                  endTime: s,
                  timeline: x,
                  Sc: function () {
                    return (
                      b instanceof wc && b.getNumReferences() == 0 && _w(b, A, D, M, E, e.Eb),
                      Promise.resolve(b)
                    );
                  },
                  timescale: A.timescale,
                }
              );
            }
            function xo(e) {
              return e.Oc;
            }
            function hU(e) {
              var t = xw(e, xo),
                r = Lr(e, xo, "media"),
                s = Lr(e, xo, "index"),
                a = Lr(e, xo, "k"),
                c = 0;
              return (
                a && (c = parseInt(a, 10)),
                {
                  Qf: t.Qf,
                  gb: t.gb,
                  timescale: t.timescale,
                  ve: t.ve,
                  ec: t.ec,
                  gd: t.gd,
                  timeline: t.timeline,
                  bc: r && li(r),
                  fe: s,
                  mimeType: e.L.mimeType,
                  codecs: e.L.codecs,
                  bandwidth: e.bandwidth,
                  Dk: c,
                }
              );
            }
            function fU(e) {
              var t = e.fe ? 1 : 0;
              if (((t += e.timeline ? 1 : 0), (t += e.gb ? 1 : 0), t == 0)) throw new ee(2, 4, 4002);
              if ((t != 1 && (e.fe && (e.timeline = null), (e.Qf = null), (e.gb = null)), !e.fe && !e.bc))
                throw new ee(2, 4, 4002);
            }
            function pU(e, t, r, s, a, c, f, g) {
              function m(se) {
                var me = se - P,
                  fe = me * M,
                  le = t.Qf,
                  ue = me * le;
                ("BigInt" in l && ue > Number.MAX_SAFE_INTEGER && (ue = BigInt(me) * BigInt(le)),
                  (fe += R),
                  (me = fe + M),
                  (le = Math.min(me, E())));
                var xe = [],
                  Se = t.Dk;
                if (Se)
                  for (var Ye = (le - fe) / Se, be = {}, xt = 0; xt < Se; be = { bj: void 0 }, xt++) {
                    var qe = fe + Ye * xt,
                      Ct = qe + Ye;
                    ((be.bj = xt),
                      (be = new Be(
                        qe,
                        Ct,
                        (function (lt) {
                          return function () {
                            var rt = Ic(G, H, se, lt.bj, U, ue);
                            return Ln(Q(), [rt], ne());
                          };
                        })(be),
                        0,
                        null,
                        s,
                        z,
                        R,
                        E(),
                        [],
                        "",
                        null,
                        null,
                        Rs,
                        c,
                      )),
                      (be.codecs = e.L.codecs),
                      (be.mimeType = e.L.mimeType),
                      g == 0 ? xt > 0 && be.wd() : xt % g != 0 && be.wd(),
                      xe.push(be));
                  }
                return (
                  (fe = new Be(
                    fe,
                    le,
                    function () {
                      if (Se) return [];
                      var lt = Ic(G, H, se, null, U, ue);
                      return Ln(Q(), [lt], ne());
                    },
                    0,
                    null,
                    s,
                    z,
                    R,
                    E(),
                    xe,
                    "",
                    null,
                    null,
                    Rs,
                    c,
                    xe.length > 0,
                  )),
                  (fe.codecs = e.L.codecs),
                  (fe.mimeType = e.L.mimeType),
                  (fe.bandwidth = e.bandwidth),
                  (fe.j = me),
                  fe
                );
              }
              function x() {
                var se = [Math.max(A.Hb(), R), Math.min(A.Ic(), E())].map(function (me) {
                  return me - R;
                });
                return (
                  (se = [Math.ceil(se[0] / M), Math.ceil(se[1] / M) - 1]),
                  e.L.rb && se[1]++,
                  se.map(function (me) {
                    return me + P;
                  })
                );
              }
              function E() {
                var se = (b != null && a.get(b)) || D;
                return se ? R + se : 1 / 0;
              }
              var A = e.presentationTimeline,
                R = e.na.start,
                b = e.sa.id,
                D = e.na.duration,
                M = t.gb,
                P = t.ve,
                G = t.bc,
                U = e.bandwidth || null,
                H = e.L.originalId,
                Q = e.L.bb,
                ne = e.Lb,
                z = R - t.ec,
                J = x();
              ((r = e.Eb ? Math.max(J[0], J[1] - r + 1) : J[0]), (f = f || J[1]), (J = []));
              for (var X = r; X <= f; ++X) {
                var ie = m(X);
                J.push(ie);
              }
              var Z = new mt(J);
              if (((J = A.Ic() < E()), (X = A.W()), J || X)) {
                var re = Math.max(r, f + 1);
                ((r = M),
                  e.L.rb && (r = 0.1),
                  Z.Rf(r, function () {
                    var se = A.Hb();
                    Z.Ya(se);
                    var me = I(x());
                    (me.next(), (me = me.next().value));
                    for (var fe = []; re <= me; ) {
                      var le = m(re);
                      (fe.push(le), re++);
                    }
                    return se > E() && !fe.length ? null : fe;
                  }));
              }
              return Promise.resolve(Z);
            }
            function gU(e, t) {
              var r = e.L.hf;
              if ((r || (r = Lr(e, xo, "initialization")), !r)) return null;
              r = li(r);
              var s = e.L.originalId,
                a = e.bandwidth || null,
                c = e.L.bb,
                f = e.Lb;
              return (
                (t = new Ai(
                  function () {
                    var g = Ic(r, s, null, null, a, null);
                    return Ln(c(), [g], f());
                  },
                  0,
                  null,
                  Rw(e),
                  null,
                  null,
                  t,
                  e.qa.encrypted,
                )),
                (t.codecs = e.L.codecs),
                (t.mimeType = e.L.mimeType),
                e.na && !e.na.kf && (t.g = e.na.start + e.na.duration),
                t
              );
            }
            function wc(e, t, r, s, a, c, f, g, m, x, E, A) {
              (mt.call(this, []),
                (this.F = e),
                (this.h = t),
                (this.H = r),
                (this.C = s),
                (this.G = a),
                (this.J = c),
                (this.j = f),
                (this.l = g),
                (this.u = m),
                (this.B = x),
                (this.I = E),
                (this.K = A),
                Cy(this));
            }
            (N(wc, mt),
              (d = wc.prototype),
              (d.getNumReferences = function () {
                return this.h ? this.h.timeline.length : 0;
              }),
              (d.release = function () {
                (mt.prototype.release.call(this), (this.h = null));
              }),
              (d.Ya = function (e) {
                if (this.h) {
                  for (var t = 0, r = this.h.timeline, s = 0; s < r.length && r[s].end + this.j <= e; s += 1)
                    t += 1;
                  t > 0 &&
                    ((this.h.timeline = r.slice(t)),
                    this.g.length >= t && (this.g = this.g.slice(t)),
                    (this.i += t),
                    this.getNumReferences() === 0 && this.release());
                }
              }));
            function _w(e, t, r, s, a, c) {
              if ((mU(e, a), (e.F = c), e.h)) {
                if (e.h.gd !== t.gd)
                  for (r = t.gd - e.h.gd, a = 0; a < t.timeline.length; a++)
                    ((c = t.timeline[a]),
                      (c.Ld += r),
                      (c.Jh += r),
                      (c.start = (c.Ld + r) / t.timescale),
                      (c.end = (c.Jh + r) / t.timescale));
                if ((e.h.bc !== t.bc && (e.h.bc = t.bc), (r = e.h.timeline), r.length)) {
                  var f = r[r.length - 1];
                  t = t.timeline.filter(function (g) {
                    return g.end > f.end;
                  });
                } else t = t.timeline.slice();
                (t.length > 0 && e.h.timeline.push.apply(e.h.timeline, V(t)), e.l !== s && (e.l = s));
              } else ((e.h = t), (e.j = r), (e.l = s));
              Cy(e);
            }
            function mU(e, t) {
              if (e.u !== t) {
                ((e.u = t), (e = I(e.g)));
                for (var r = e.next(); !r.done; r = e.next()) (r = r.value) && dA(r, t);
              }
            }
            function Cy(e) {
              if (e.h && !e.o) {
                for (var t = [], r = I(e.h.timeline), s = r.next(); !s.done; s = r.next())
                  ((s = s.value), s.start >= e.l || s.end <= 0 || t.push(s));
                ((e.h.timeline = t), e.Ya(e.j));
              }
            }
            ((d.find = function (e) {
              if (
                this.h &&
                this.h.timeline &&
                this.h.timeline.length &&
                e < this.h.timeline[0].start + this.j
              )
                return this.i;
              if (!this.h) return null;
              var t = this.h.timeline;
              if (e < this.j || e >= this.l) return null;
              for (var r = t.length - 1, s = 0; s < t.length; s++) {
                var a = t[s],
                  c = a.start + this.j;
                if (
                  ((a = s < r ? t[s + 1].start + this.j : this.l === 1 / 0 ? a.end + this.j : this.l),
                  e >= c && e < a)
                )
                  return s + this.i;
              }
              return null;
            }),
              (d.get = function (e) {
                var t = this;
                if (((e -= this.i), e < 0 || e >= this.getNumReferences() || !this.h)) return null;
                var r = this.g[e];
                if (!r) {
                  r = this.h.timeline[e];
                  var s = r.Vk,
                    a = r.Ld + this.h.gd,
                    c = this.j - this.h.ec,
                    f = this.j + r.end,
                    g = f;
                  e === this.getNumReferences() - 1 &&
                    this.l !== 1 / 0 &&
                    (g = this.F && Math.abs(g - this.l) > 0.1 ? Math.min(g, this.l) : this.l);
                  var m = this.h.codecs,
                    x = this.h.mimeType,
                    E = this.h.bandwidth,
                    A = [],
                    R = !1;
                  if ((r.wc && this.h && this.h.bc && (R = this.h.bc.includes("$SubNumber$")), R)) {
                    R = (r.end - r.start) / r.wc;
                    for (var b = {}, D = 0; D < r.wc; b = { Tf: void 0, cj: void 0 }, D++) {
                      var M = r.start + R * D,
                        P = M + R;
                      ((b.cj = D),
                        (b.Tf = null),
                        (b = new Be(
                          this.j + M,
                          this.j + P,
                          (function (G) {
                            return function () {
                              return t.h
                                ? (G.Tf == null && (G.Tf = bw(t.h.bc, t.H, s, t.C, a, G.cj, t.G, t.J)), G.Tf)
                                : [];
                            };
                          })(b),
                          0,
                          null,
                          this.u,
                          c,
                          this.j,
                          this.l,
                          [],
                          "",
                          null,
                          null,
                          Rs,
                          this.B,
                        )),
                        (b.codecs = m),
                        (b.mimeType = x),
                        (b.bandwidth = E),
                        this.I == 0 ? D > 0 && b.wd() : D % this.I != 0 && b.wd(),
                        A.push(b));
                    }
                  }
                  ((r = new Be(
                    this.j + r.start,
                    g,
                    function () {
                      return A.length > 0 || !t.h ? [] : bw(t.h.bc, t.H, s, t.C, a, null, t.G, t.J);
                    },
                    0,
                    null,
                    this.u,
                    c,
                    this.j,
                    this.l,
                    A,
                    "",
                    null,
                    null,
                    Rs,
                    this.B,
                    A.length > 0,
                  )),
                    (r.codecs = m),
                    (r.mimeType = x),
                    (r.j = f),
                    (r.bandwidth = E),
                    (this.g[e] = r));
                }
                return r;
              }),
              (d.Fb = function (e) {
                Cy(this);
                for (var t = 0; t < this.getNumReferences(); t++) {
                  var r = this.get(t + this.i);
                  r && e(r);
                }
              }));
            function bw(e, t, r, s, a, c, f, g) {
              return (
                (e = Ic(e, t, r, c, s || null, a)),
                Ln(f(), [e], g()).map(function (m) {
                  return m.toString();
                })
              );
            }
            d.We = function () {
              return this.K;
            };
            function Tl(e) {
              ((this.o = null),
                (this.B = e),
                (this.H = new Ha()),
                (this.i = []),
                (this.h = null),
                (this.m = []),
                (this.C = null),
                (this.G = []),
                (this.F = 300),
                (this.l = new Map()),
                (this.j = new Map()),
                (this.g = null),
                (this.u = "UNKNOWN"));
            }
            ((Tl.prototype.configure = function (e) {
              this.o = e;
            }),
              (Tl.prototype.destroy = function () {
                return (
                  (this.B = this.o = null),
                  (this.i = []),
                  (this.h = null),
                  (this.m = []),
                  (this.G = []),
                  this.l.clear(),
                  this.g != null && (this.g.stop(), (this.g = null)),
                  this.H.destroy()
                );
              }),
              (Tl.prototype.setManifestType = function (e) {
                this.u = e;
              }));
            function Rc(e, t) {
              var r, s, a, c, f, g, m;
              return W(function (x) {
                if (x.g == 1)
                  return (
                    (r = Ln(e.i, [yU(e, t)])),
                    (s = fn(r, e.o.retryParameters)),
                    (a = e.B.networkingEngine.request(8, s)),
                    Jo(e.H, a),
                    q(x, 2),
                    _(x, a.promise, 4)
                  );
                if (x.g != 2)
                  return (
                    (c = x.h),
                    (f = zt(c.data)),
                    (g = JSON.parse(f)),
                    g.VERSION == 1 && vU(e, g, c.uri),
                    he(x, 0)
                  );
                if ((m = ae(x)) && m.code == 7001) return x.return();
                (e.g != null && (e.g.stop(), (e.g = null)),
                  (e.g = new it(function () {
                    Rc(e, t);
                  })),
                  e.g.ka(e.F),
                  K(x));
              });
            }
            function yU(e, t) {
              if (!e.m.length) return t;
              t = new un(t);
              var r = e.C || e.m[0],
                s = Math.round(e.B.getBandwidthEstimate()),
                a = t.g;
              return (
                e.u == "DASH"
                  ? (a.add("_DASH_pathway", r), a.add("_DASH_throughput", String(s)))
                  : e.u == "HLS" && (a.add("_HLS_pathway", r), a.add("_HLS_throughput", String(s))),
                PS(a) && Bo(t, a),
                t.toString()
              );
            }
            function vU(e, t, r) {
              e.g != null && (e.g.stop(), (e.g = null));
              var s = t["RELOAD-URI"] || r;
              ((e.g = new it(function () {
                Rc(e, s);
              })),
                (r = t.TTL) && (e.F = r),
                e.g.ka(e.F),
                (e.m = t["PATHWAY-PRIORITY"] || []),
                (e.G = t["PATHWAY-CLONES"] || []));
            }
            function Sl(e, t, r, s) {
              var a = e.l.get(t);
              (a || (a = new Map()), a.set(r, s), e.l.set(t, a));
            }
            Tl.prototype.banLocation = function (e) {
              this.j.set(e, Date.now() + 6e4);
            };
            function Cc(e, t, r) {
              ((r = r === void 0 ? !1 : r), (t = e.l.get(t) || new Map()));
              for (var s = [], a = I(e.m), c = a.next(), f = {}; !c.done; f = { Cd: void 0 }, c = a.next())
                if (((f.Cd = c.value), (c = t.get(f.Cd)))) s.push({ ah: f.Cd, location: c });
                else if (
                  (c = e.G.find(
                    (function (m) {
                      return function (x) {
                        return x.Ol == m.Cd;
                      };
                    })(f),
                  ))
                ) {
                  var g = t.get(c["BASE-ID"]);
                  g &&
                    (c["URI-REPLACEMENT"].oj
                      ? ((g = new un(g)),
                        jd(g, c["URI-REPLACEMENT"].oj),
                        s.push({ ah: f.Cd, location: g.toString() }))
                      : s.push({ ah: f.Cd, location: g }));
                }
              for (a = Date.now(), f = I(e.j.keys()), c = f.next(); !c.done; c = f.next())
                ((c = c.value), (g = e.j.get(c)), a > g && e.j.delete(c));
              if (
                ((s = s.filter(function (m) {
                  for (var x = I(e.j.keys()), E = x.next(); !E.done; E = x.next())
                    if (E.value.includes(new un(m.location).Db)) return !1;
                  return !0;
                })),
                s.length && (e.C = s[0].ah),
                (s = s.map(function (m) {
                  return m.location;
                })),
                !s.length && e.h)
              )
                for (a = I(e.h.split(",")), f = a.next(); !f.done; f = a.next())
                  (f = t.get(f.value)) && ((e.C = e.h), s.push(f));
              if (!s.length) for (t = I(t.values()), a = t.next(); !a.done; a = t.next()) s.push(a.value);
              return r ? s : Ln(e.i, s);
            }
            function wi() {
              ((this.l = []),
                (this.h = []),
                (this.g = []),
                (this.j = []),
                (this.i = []),
                (this.o = !1),
                (this.m = new Set()));
            }
            ((d = wi.prototype),
              (d.release = function () {
                for (var e = I(this.h.concat(this.g, this.j, this.i)), t = e.next(); !t.done; t = e.next())
                  ((t = t.value), t.segmentIndex && t.segmentIndex.release());
                ((this.h = []),
                  (this.g = []),
                  (this.j = []),
                  (this.i = []),
                  (this.l = []),
                  (this.o = !1),
                  this.m.clear());
              }),
              (d.fk = function () {
                return this.l;
              }),
              (d.Mg = function () {
                return this.j.slice();
              }),
              (d.Mj = function () {
                return this.i;
              }),
              (d.Zh = function (e, t) {
                if (e) {
                  if (e.type == "audio")
                    for (var r = I(this.h), s = r.next(); !s.done; s = r.next())
                      ((s = s.value),
                        (s.matchedStreams = s.matchedStreams.filter(function (a) {
                          return a !== e;
                        })));
                  else if (e.type == "video")
                    for (r = I(this.g), s = r.next(); !s.done; s = r.next())
                      ((s = s.value),
                        (s.matchedStreams = s.matchedStreams.filter(function (a) {
                          return a !== e;
                        })),
                        s.trickModeVideo &&
                          (s.trickModeVideo.matchedStreams = s.trickModeVideo.matchedStreams.filter(
                            function (a) {
                              return a !== e;
                            },
                          )),
                        s.dependencyStream &&
                          (s.dependencyStream.matchedStreams = s.dependencyStream.matchedStreams.filter(
                            function (a) {
                              return a !== e;
                            },
                          )));
                  else if (e.type == nt)
                    for (r = I(this.j), s = r.next(); !s.done; s = r.next())
                      ((s = s.value),
                        (s.matchedStreams = s.matchedStreams.filter(function (a) {
                          return a !== e;
                        })));
                  else if (e.type == "image")
                    for (r = I(this.i), s = r.next(); !s.done; s = r.next())
                      ((s = s.value),
                        (s.matchedStreams = s.matchedStreams.filter(function (a) {
                          return a !== e;
                        })));
                  (e.segmentIndex && e.closeSegmentIndex(), this.m.delete(t));
                }
              }));
            function Dw(e, t) {
              var r = [],
                s = [],
                a = [],
                c = [];
              e = I(e);
              for (var f = e.next(); !f.done; f = e.next()) {
                var g = f.value;
                f = new Map(
                  g.audioStreams.map(function (A) {
                    return [Dy(A), A];
                  }),
                );
                var m = new Map(
                    g.videoStreams.map(function (A) {
                      return [by(A), A];
                    }),
                  ),
                  x = new Map(
                    g.textStreams.map(function (A) {
                      return [_c(A), A];
                    }),
                  );
                if (
                  ((g = new Map(
                    g.imageStreams.map(function (A) {
                      return [bc(A), A];
                    }),
                  )),
                  t)
                ) {
                  var E = Uw(nt);
                  (x.set(_c(E), E), (E = Uw("image")), g.set(bc(E), E));
                }
                (r.push(f), s.push(m), a.push(x), c.push(g));
              }
              return { Sh: r, mj: s, hj: a, pi: c };
            }
            d.lg = function (e, t, r) {
              r = r === void 0 ? !1 : r;
              var s = this,
                a,
                c,
                f,
                g,
                m,
                x,
                E,
                A,
                R,
                b,
                D,
                M,
                P,
                G,
                U,
                H,
                Q,
                ne,
                z,
                J,
                X,
                ie,
                Z,
                re,
                se,
                me,
                fe,
                le,
                ue,
                xe,
                Se,
                Ye;
              return W(function (be) {
                if (be.g == 1) {
                  if (((a = hn), !t && e.length == 1))
                    return (
                      (c = Dw(e, !1)),
                      (f = c.Sh),
                      (g = c.mj),
                      (m = c.hj),
                      (x = c.pi),
                      (s.h = Array.from(f[0].values())),
                      (s.g = Array.from(g[0].values())),
                      (s.j = Array.from(m[0].values())),
                      (s.i = Array.from(x[0].values())),
                      be.A(2)
                    );
                  for (E = r ? s.m.size : 0, A = -1, R = 0; R < e.length; R++)
                    ((b = e[R]), s.m.has(b.id) || (s.m.add(b.id), A == -1 && (A = R)));
                  return A == -1
                    ? be.return()
                    : ((D = Dw(e, !0)),
                      (M = D.Sh),
                      (P = D.mj),
                      (G = D.hj),
                      (U = D.pi),
                      _(
                        be,
                        Promise.all([
                          To(s, s.h, M, A, El, So, E),
                          To(s, s.g, P, A, El, So, E),
                          To(s, s.j, G, A, El, So, E),
                          To(s, s.i, U, A, El, So, E),
                        ]),
                        2,
                      ));
                }
                if (((H = 0), (Q = []), s.g.length && s.h.length))
                  for (re = I(s.h), se = re.next(); !se.done; se = re.next())
                    for (me = se.value, fe = I(s.g), le = fe.next(); !le.done; le = fe.next())
                      ((ue = le.value),
                        (xe = FS(me.drmInfos, ue.drmInfos)),
                        (me.drmInfos.length && ue.drmInfos.length && !xe.length) ||
                          ((Se = (me.bandwidth || 0) + (ue.bandwidth || 0)),
                          me.dependencyStream && (Se += me.dependencyStream.bandwidth || 0),
                          ue.dependencyStream && (Se += ue.dependencyStream.bandwidth || 0),
                          (Ye = H++),
                          Q.push({
                            id: Ye,
                            language: me.language,
                            disabledUntilTime: 0,
                            primary: me.primary,
                            audio: me,
                            video: ue,
                            bandwidth: Se,
                            drmInfos: xe,
                            allowedByApplication: !0,
                            allowedByKeySystem: !0,
                            decodingInfos: [],
                          })));
                else
                  for (ne = s.g.length ? s.g : s.h, z = I(ne), J = z.next(); !J.done; J = z.next())
                    ((X = J.value),
                      (ie = H++),
                      (Z = X.bandwidth || 0),
                      X.dependencyStream && (Z += X.dependencyStream.bandwidth || 0),
                      Q.push({
                        id: ie,
                        language: X.language,
                        disabledUntilTime: 0,
                        primary: X.primary,
                        audio: X.type == a.aa ? X : null,
                        video: X.type == a.wa ? X : null,
                        bandwidth: Z,
                        drmInfos: X.drmInfos,
                        allowedByApplication: !0,
                        allowedByKeySystem: !0,
                        decodingInfos: [],
                      }));
                ((s.l = Q), K(be));
              });
            };
            function kw(e) {
              var t,
                r,
                s,
                a,
                c,
                f,
                g,
                m,
                x,
                E,
                A,
                R,
                b,
                D,
                M,
                P,
                G,
                U,
                H,
                Q,
                ne,
                z,
                J,
                X,
                ie,
                Z,
                re,
                se,
                me,
                fe;
              return W(function (le) {
                switch (le.g) {
                  case 1:
                    if (((t = hn), e.length == 1)) return le.return(e[0]);
                    for (
                      r = e.map(function (ue) {
                        return new Map(
                          ue
                            .filter(function (xe) {
                              return xe.type === t.aa;
                            })
                            .map(function (xe) {
                              return [Dy(xe), xe];
                            }),
                        );
                      }),
                        s = e.map(function (ue) {
                          return new Map(
                            ue
                              .filter(function (xe) {
                                return xe.type === t.wa;
                              })
                              .map(function (xe) {
                                return [by(xe), xe];
                              }),
                          );
                        }),
                        a = e.map(function (ue) {
                          return new Map(
                            ue
                              .filter(function (xe) {
                                return xe.type === t.Na;
                              })
                              .map(function (xe) {
                                return [_c(xe), xe];
                              }),
                          );
                        }),
                        c = e.map(function (ue) {
                          return new Map(
                            ue
                              .filter(function (xe) {
                                return xe.type === t.Yf;
                              })
                              .map(function (xe) {
                                return [bc(xe), xe];
                              }),
                          );
                        }),
                        f = I(a),
                        g = f.next();
                      !g.done;
                      g = f.next()
                    )
                      ((m = g.value), (x = Fw(t.Na)), m.set(_c(x), x));
                    for (E = I(c), A = E.next(); !A.done; A = E.next())
                      ((R = A.value), (b = Fw(t.Yf)), R.set(bc(b), b));
                    return ((D = new wi()), _(le, To(D, [], r, 0, Ff, Uf, 0), 2));
                  case 2:
                    return ((M = le.h), _(le, To(D, [], s, 0, Ff, Uf, 0), 3));
                  case 3:
                    return ((P = le.h), _(le, To(D, [], a, 0, Ff, Uf, 0), 4));
                  case 4:
                    return ((G = le.h), _(le, To(D, [], c, 0, Ff, Uf, 0), 5));
                  case 5:
                    if (((U = le.h), (H = 0), P.length && M.length))
                      for (X = I(M), ie = X.next(); !ie.done; ie = X.next())
                        for (Z = ie.value, re = I(P), se = re.next(); !se.done; se = re.next())
                          ((me = se.value), (fe = H++), me.variantIds.push(fe), Z.variantIds.push(fe));
                    else
                      for (Q = P.concat(M), ne = I(Q), z = ne.next(); !z.done; z = ne.next())
                        ((J = z.value), (J.variantIds = [H++]));
                    return le.return(P.concat(M).concat(G).concat(U));
                }
              });
            }
            function To(e, t, r, s, a, c, f) {
              var g, m, x, E, A, R, b, D, M, P, G, U, H, Q, ne, z, J, X, ie;
              return W(function (Z) {
                switch (Z.g) {
                  case 1:
                    for (g = [], m = 0; m < r.length; m++)
                      m >= s ? g.push(new Set(r[m].values())) : g.push(new Set());
                    ((x = I(t)), (E = x.next()));
                  case 2:
                    if (E.done) {
                      Z.A(4);
                      break;
                    }
                    return ((A = E.value), _(Z, xU(e, A, r, s, c, g, f), 5));
                  case 5:
                    if (((R = Z.h), !R)) throw new ee(2, 4, 4037);
                    ((E = x.next()), Z.A(2));
                    break;
                  case 4:
                    for (b = I(g), D = b.next(); !D.done; D = b.next())
                      for (M = D.value, P = I(M), G = P.next(); !G.done; G = P.next())
                        ((U = G.value), (H = TU(e, t, U, r, a, c, g)) && t.push(H));
                    for (Q = I(g), ne = Q.next(); !ne.done; ne = Q.next())
                      for (
                        z = ne.value, J = I(z), X = J.next(), ie = {};
                        !X.done;
                        ie = { yh: void 0 }, X = J.next()
                      )
                        if (
                          ((ie.yh = X.value),
                          !_y(ie.yh) &&
                            t.some(
                              (function (re) {
                                return function (se) {
                                  return Ly(re.yh, se);
                                };
                              })(ie),
                            ))
                        )
                          throw new ee(2, 4, 4037);
                    return Z.return(t);
                }
              });
            }
            function xU(e, t, r, s, a, c, f) {
              return W(function (g) {
                return g.g == 1
                  ? (Ow(e, r, t, f > 0),
                    t.matchedStreams ? (t.segmentIndex ? _(g, Mw(t, s + f), 2) : g.A(2)) : g.return(!1))
                  : (Pw(t, s, a, c, f), g.return(!0));
              });
            }
            function Mw(e, t) {
              var r, s, a, c, f, g;
              return W(function (m) {
                if (m.g == 1) {
                  for (r = [], s = e.matchedStreams, a = t; a < s.length; a++)
                    ((c = s[a]),
                      r.push(c.createSegmentIndex()),
                      c.trickModeVideo &&
                        !c.trickModeVideo.segmentIndex &&
                        r.push(c.trickModeVideo.createSegmentIndex()),
                      c.dependencyStream &&
                        !c.dependencyStream.segmentIndex &&
                        r.push(c.dependencyStream.createSegmentIndex()));
                  return _(m, Promise.all(r), 2);
                }
                if (e.segmentIndex instanceof Qt)
                  for (f = t; f < s.length; f++)
                    ((g = s[f]), g.segmentIndex && e.segmentIndex.h.push(g.segmentIndex));
                K(m);
              });
            }
            function TU(e, t, r, s, a, c, f) {
              if (_y(r)) return null;
              var g = a(r);
              return (
                Ow(e, s, g),
                g.createSegmentIndex &&
                  ((g.createSegmentIndex = function () {
                    return W(function (m) {
                      return g.segmentIndex ? m.A(0) : ((g.segmentIndex = new Qt()), _(m, Mw(g, 0), 0));
                    });
                  }),
                  (g.closeSegmentIndex = function () {
                    if (
                      (g.segmentIndex && (g.segmentIndex.release(), (g.segmentIndex = null)),
                      g.matchedStreams)
                    )
                      for (var m = I(g.matchedStreams), x = m.next(); !x.done; x = m.next()) {
                        x = x.value;
                        var E;
                        if ((E = x.segmentIndex)) {
                          e: {
                            E = I(t);
                            for (var A = E.next(); !A.done; A = E.next())
                              if (
                                ((A = A.value),
                                A !== g && A.segmentIndex && A.matchedStreams && A.matchedStreams.includes(x))
                              ) {
                                E = !0;
                                break e;
                              }
                            E = !1;
                          }
                          E = !E;
                        }
                        E && (x.segmentIndex.release(), (x.segmentIndex = null));
                      }
                  })),
                !g.matchedStreams || !g.matchedStreams.length ? null : (Pw(g, 0, c, f, 0), g)
              );
            }
            function Pw(e, t, r, s, a) {
              var c = e.matchedStreams;
              for (t += a; t < c.length; t++) {
                var f = c[t];
                r(e, f);
                var g = !0;
                if (
                  (e.type == "audio" && Xo(e.language, f.language) == 0 && (g = !1),
                  g && ((g = s[t - a]) && g.delete(f), f.fullMimeTypes))
                )
                  for (f = I(f.fullMimeTypes.values()), g = f.next(); !g.done; g = f.next())
                    e.fullMimeTypes.add(g.value);
              }
            }
            function El(e) {
              var t = Object.assign({}, e);
              return (
                (t.originalId = null),
                (t.createSegmentIndex = function () {
                  return Promise.resolve();
                }),
                (t.closeSegmentIndex = function () {}),
                (t.roles = t.roles.slice()),
                (t.segmentIndex = null),
                (t.emsgSchemeIdUris = []),
                (t.keyIds = new Set(e.keyIds)),
                (t.closedCaptions = e.closedCaptions ? new Map(e.closedCaptions) : null),
                (t.trickModeVideo = null),
                (t.dependencyStream = null),
                t
              );
            }
            function Ff(e) {
              var t = Object.assign({}, e);
              return (
                (t.roles = t.roles.slice()),
                (t.keyIds = new Set(e.keyIds)),
                (t.segments = []),
                (t.variantIds = []),
                (t.closedCaptions = e.closedCaptions ? new Map(e.closedCaptions) : null),
                t
              );
            }
            function So(e, t) {
              function r(f, g) {
                (f || (f = []), (g = I(g)));
                for (var m = g.next(); !m.done; m = g.next()) ((m = m.value), f.includes(m) || f.push(m));
                return f;
              }
              ((e.roles = r(e.roles, t.roles)),
                t.emsgSchemeIdUris && (e.emsgSchemeIdUris = r(e.emsgSchemeIdUris, t.emsgSchemeIdUris)));
              for (var s = I(t.keyIds), a = s.next(); !a.done; a = s.next()) e.keyIds.add(a.value);
              if (
                (e.originalId == null
                  ? (e.originalId = t.originalId)
                  : (s = t.originalId || "") && !e.originalId.endsWith(s) && (e.originalId += "," + s),
                (s = FS(e.drmInfos, t.drmInfos)),
                t.drmInfos.length && e.drmInfos.length && !s.length)
              )
                throw new ee(2, 4, 4038);
              if (((e.drmInfos = s), (e.encrypted = e.encrypted || t.encrypted), t.closedCaptions))
                for (
                  e.closedCaptions || (e.closedCaptions = new Map()), s = I(t.closedCaptions), a = s.next();
                  !a.done;
                  a = s.next()
                ) {
                  var c = I(a.value);
                  ((a = c.next().value), (c = c.next().value), e.closedCaptions.set(a, c));
                }
              (e.bandwidth && t.bandwidth && (e.bandwidth = Math.max(e.bandwidth, t.bandwidth)),
                t.trickModeVideo
                  ? (e.trickModeVideo ||
                      ((e.trickModeVideo = El(t.trickModeVideo)),
                      (e.trickModeVideo.matchedStreams = []),
                      (e.trickModeVideo.createSegmentIndex = function () {
                        if (e.trickModeVideo.segmentIndex) return Promise.resolve();
                        for (
                          var f = new Qt(), g = I(e.trickModeVideo.matchedStreams), m = g.next();
                          !m.done;
                          m = g.next()
                        )
                          f.h.push(m.value.segmentIndex);
                        return ((e.trickModeVideo.segmentIndex = f), Promise.resolve());
                      })),
                    e.trickModeVideo.matchedStreams.push(t.trickModeVideo),
                    So(e.trickModeVideo, t.trickModeVideo))
                  : e.trickModeVideo && (e.trickModeVideo.matchedStreams.push(t), So(e.trickModeVideo, t)),
                t.dependencyStream
                  ? (e.dependencyStream ||
                      ((e.dependencyStream = El(t.dependencyStream)),
                      (e.dependencyStream.matchedStreams = []),
                      (e.dependencyStream.createSegmentIndex = function () {
                        if (e.dependencyStream.segmentIndex) return Promise.resolve();
                        for (
                          var f = new Qt(), g = I(e.dependencyStream.matchedStreams), m = g.next();
                          !m.done;
                          m = g.next()
                        )
                          f.h.push(m.value.segmentIndex);
                        return ((e.dependencyStream.segmentIndex = f), Promise.resolve());
                      })),
                    e.dependencyStream.matchedStreams.push(t.dependencyStream),
                    So(e.dependencyStream, t.dependencyStream))
                  : e.dependencyStream &&
                    (e.dependencyStream.matchedStreams.push(t), So(e.dependencyStream, t)));
            }
            function Uf(e, t) {
              var r = e.roles;
              r || (r = []);
              for (var s = I(t.roles), a = s.next(); !a.done; a = s.next())
                ((a = a.value), r.includes(a) || r.push(a));
              for (e.roles = r, r = I(t.keyIds), s = r.next(); !s.done; s = r.next()) e.keyIds.add(s.value);
              if (
                ((e.encrypted = e.encrypted && t.encrypted),
                e.segments.push.apply(e.segments, V(t.segments)),
                t.closedCaptions)
              )
                for (
                  e.closedCaptions || (e.closedCaptions = new Map()), t = I(t.closedCaptions), r = t.next();
                  !r.done;
                  r = t.next()
                )
                  ((s = I(r.value)), (r = s.next().value), (s = s.next().value), e.closedCaptions.set(r, s));
            }
            function Ow(e, t, r, s) {
              ((s = s !== void 0 && s ? r.matchedStreams : []), (t = I(t)));
              for (var a = t.next(); !a.done; a = t.next()) {
                if (((a = SU(e, a.value, r)), !a)) return;
                s.push(a);
              }
              r.matchedStreams = s;
            }
            function SU(e, t, r) {
              var s = { audio: Dy, video: by, text: _c, image: bc }[r.type],
                a = null,
                c = s(r);
              if (t.has(c)) a = t.get(c);
              else {
                c = {
                  audio: function (x, E) {
                    return Ly(x, E);
                  },
                  video: function (x, E) {
                    return Ly(x, E);
                  },
                  text: EU,
                  image: AU,
                }[r.type];
                for (
                  var f = { audio: IU, video: wU, text: RU, image: CU }[r.type],
                    g = I(t.values()),
                    m = g.next();
                  !m.done;
                  m = g.next()
                )
                  ((m = m.value),
                    !c(r, m) || r.fastSwitching != m.fastSwitching || (a && !f(r, a, m)) || (a = m));
              }
              return (e.o && !_y(a) && t.delete(s(a)), a);
            }
            function Nw(e, t) {
              return e.mimeType != t.mimeType ? !1 : Gw(e.codecs) === Gw(t.codecs);
            }
            d.Xi = function (e) {
              this.o = e;
            };
            function Ly(e, t) {
              return !(e.drmInfos && !NS(e.drmInfos, t.drmInfos));
            }
            function EU(e, t) {
              return t.language
                ? !(e.forced !== t.forced || Xo(e.language, t.language) == 0 || t.kind != e.kind)
                : !0;
            }
            function AU() {
              return !0;
            }
            function IU(e, t, r) {
              var s = Bw(e, t, r);
              if (s === Bi) return !0;
              if (s === cr) return !1;
              s = Xo(e.language, t.language);
              var a = Xo(e.language, r.language);
              if (a > s) return !0;
              if (a < s) return !1;
              if (t.label !== r.label) {
                if (e.label === t.label) return !1;
                if (e.label === r.label) return !0;
              }
              if (e.roles.length) {
                if (
                  ((s = t.roles.filter(function (c) {
                    return e.roles.includes(c);
                  })),
                  (a = r.roles.filter(function (c) {
                    return e.roles.includes(c);
                  })),
                  a.length > s.length)
                )
                  return !0;
                if (a.length < s.length) return !1;
                if (r.roles.length !== t.roles.length) return r.roles.length < t.roles.length;
              } else {
                if (!r.roles.length && t.roles.length) return !0;
                if (r.roles.length && !t.roles.length) return !1;
              }
              return !t.primary && r.primary
                ? !0
                : t.primary && !r.primary
                  ? !1
                  : ((s = Lc(e.channelsCount, t.channelsCount, r.channelsCount)),
                    s == Bi
                      ? !0
                      : s == cr
                        ? !1
                        : ((s = Lc(e.audioSamplingRate, t.audioSamplingRate, r.audioSamplingRate)),
                          s == Bi
                            ? !0
                            : s == cr
                              ? !1
                              : !!(e.bandwidth && $w(e.bandwidth, t.bandwidth, r.bandwidth) == Bi)));
            }
            function wU(e, t, r) {
              var s = Bw(e, t, r);
              if (s === Bi) return !0;
              if (s === cr) return !1;
              if (((s = Lc(e.width * e.height, t.width * t.height, r.width * r.height)), s == Bi)) return !0;
              if (s == cr) return !1;
              if (e.frameRate) {
                if (((s = Lc(e.frameRate, t.frameRate, r.frameRate)), s == Bi)) return !0;
                if (s == cr) return !1;
              }
              return !!(e.bandwidth && $w(e.bandwidth, t.bandwidth, r.bandwidth) == Bi);
            }
            function RU(e, t, r) {
              var s = Xo(e.language, t.language),
                a = Xo(e.language, r.language);
              if (a > s) return !0;
              if (a < s) return !1;
              if (!t.primary && r.primary) return !0;
              if (t.primary && !r.primary) return !1;
              if (t.label !== r.label) {
                if (e.label === t.label) return !1;
                if (e.label === r.label) return !0;
              }
              if (e.roles.length) {
                if (
                  ((s = t.roles.filter(function (c) {
                    return e.roles.includes(c);
                  })),
                  (a = r.roles.filter(function (c) {
                    return e.roles.includes(c);
                  })),
                  a.length > s.length)
                )
                  return !0;
                if (a.length < s.length) return !1;
              } else {
                if (!r.roles.length && t.roles.length) return !0;
                if (r.roles.length && !t.roles.length) return !1;
              }
              return !(
                r.mimeType != e.mimeType ||
                r.codecs != e.codecs ||
                (t.mimeType == e.mimeType && t.codecs == e.codecs)
              );
            }
            function CU(e, t, r) {
              return Lc(e.width * e.height, t.width * t.height, r.width * r.height) == Bi;
            }
            function Fw(e) {
              return {
                id: 0,
                originalId: "",
                groupId: null,
                primary: !1,
                type: e,
                mimeType: "",
                codecs: "",
                language: "",
                originalLanguage: null,
                label: null,
                width: null,
                height: null,
                encrypted: !1,
                keyIds: new Set(),
                segments: [],
                variantIds: [],
                roles: [],
                forced: !1,
                channelsCount: null,
                audioSamplingRate: null,
                spatialAudio: !1,
                closedCaptions: null,
                external: !1,
                fastSwitching: !1,
                isAudioMuxedInVideo: !1,
                baseOriginalId: null,
              };
            }
            function Uw(e) {
              return {
                id: 0,
                originalId: "",
                groupId: null,
                createSegmentIndex: function () {
                  return Promise.resolve();
                },
                segmentIndex: new mt([]),
                mimeType: "",
                codecs: "",
                encrypted: !1,
                drmInfos: [],
                keyIds: new Set(),
                language: "",
                originalLanguage: null,
                label: null,
                type: e,
                primary: !1,
                trickModeVideo: null,
                dependencyStream: null,
                emsgSchemeIdUris: null,
                roles: [],
                forced: !1,
                channelsCount: null,
                audioSamplingRate: null,
                spatialAudio: !1,
                closedCaptions: null,
                accessibilityPurpose: null,
                external: !1,
                fastSwitching: !1,
                fullMimeTypes: new Set(),
                isAudioMuxedInVideo: !1,
                baseOriginalId: null,
              };
            }
            function Lc(e, t, r) {
              if (t == e && e != r) return cr;
              if (r == e && e != t) return Bi;
              if (t > e) {
                if (r <= e || r - e < t - e) return Bi;
                if (r - e > t - e) return cr;
              } else {
                if (r > e) return cr;
                if (e - r < e - t) return Bi;
                if (e - r > e - t) return cr;
              }
              return ky;
            }
            function Bw(e, t, r) {
              var s = e.mimeType === t.mimeType && e.codecs === t.codecs,
                a = e.mimeType === r.mimeType && e.codecs === r.codecs;
              return s && !a
                ? cr
                : !s && a
                  ? Bi
                  : ((t = Nw(e, t)), (e = Nw(e, r)), t && !e ? cr : !t && e ? Bi : ky);
            }
            function $w(e, t, r) {
              return ((t = Math.abs(e - t)), (e = Math.abs(e - r)), e < t ? Bi : t < e ? cr : ky);
            }
            function _y(e) {
              switch (e.type) {
                case nt:
                  return !e.language;
                case "image":
                  return !e.tilesLayout;
                default:
                  return !1;
              }
            }
            function by(e) {
              return Bf([
                e.fastSwitching,
                e.width,
                e.frameRate,
                e.codecs,
                e.mimeType,
                e.label,
                e.roles,
                e.closedCaptions ? Array.from(e.closedCaptions.entries()) : null,
                e.bandwidth,
                e.dependencyStream ? e.dependencyStream.baseOriginalId : null,
                Array.from(e.keyIds),
              ]);
            }
            function Dy(e) {
              return Bf([
                e.fastSwitching,
                e.channelsCount,
                e.language,
                e.bandwidth,
                e.label,
                e.codecs,
                e.mimeType,
                e.roles,
                e.audioSamplingRate,
                e.primary,
                e.dependencyStream ? e.dependencyStream.baseOriginalId : null,
                Array.from(e.keyIds),
              ]);
            }
            function _c(e) {
              return Bf([e.language, e.label, e.codecs, e.mimeType, e.bandwidth, e.roles]);
            }
            function bc(e) {
              return Bf([e.width, e.codecs, e.mimeType]);
            }
            function Bf(e) {
              return JSON.stringify(e);
            }
            function Gw(e) {
              if (!My.has(e)) {
                var t = Kn(e);
                My.set(e, t);
              }
              return My.get(e);
            }
            (Ee("shaka.util.PeriodCombiner", wi),
              (wi.prototype.setUseStreamOnce = wi.prototype.Xi),
              (wi.prototype.combinePeriods = wi.prototype.lg),
              (wi.prototype.deleteStream = wi.prototype.Zh),
              (wi.prototype.getImageStreams = wi.prototype.Mj),
              (wi.prototype.getTextStreams = wi.prototype.Mg),
              (wi.prototype.getVariants = wi.prototype.fk));
            var Bi = 1,
              ky = 0,
              cr = -1,
              My = new Map();
            function LU(e, t) {
              var r = new DOMParser(),
                s = _U.value()(e);
              e = null;
              try {
                e = r.parseFromString(s, "text/xml");
              } catch (a) {
                return null;
              }
              if (
                ((r = e.documentElement),
                !r || r.getElementsByTagName("parsererror").length || r.tagName != t)
              )
                return null;
              if (!("createNodeIterator" in document)) return r;
              for (t = document.createNodeIterator(e, NodeFilter.SHOW_ALL); (e = t.nextNode()); )
                if (e instanceof HTMLElement || e instanceof SVGElement) return null;
              return r;
            }
            function jw(e, t) {
              try {
                var r = Yr(e);
                return LU(r, t);
              } catch (s) {
                return null;
              }
            }
            var _U = new Kt(function () {
              if (typeof trustedTypes < "u") {
                var e = trustedTypes.createPolicy("shaka-player#xml", {
                  createHTML: function (t) {
                    return t;
                  },
                });
                return function (t) {
                  return e.createHTML(t);
                };
              }
              return function (t) {
                return t;
              };
            });
            function Dc() {
              var e = this;
              ((this.j = this.g = null),
                (this.B = []),
                (this.h = null),
                (this.Fa = 1),
                (this.H = []),
                (this.l = { vf: "", type: "", profiles: [], uc: null, rb: 0, bb: null, qe: 0 }),
                (this.u = new Map()),
                (this.C = new Map()),
                (this.o = new Map()),
                (this.F = new Map()),
                (this.za = new Map()),
                (this.m = new wi()),
                (this.K = 0),
                (this.Da = new Di(5)),
                (this.M = new it(function () {
                  if (e.J && !e.g.continueLoadingWhenPaused && (e.I.Ma(e.J, "timeupdate"), e.J.paused)) {
                    e.I.Aa(e.J, "timeupdate", function () {
                      return Xw(e);
                    });
                    return;
                  }
                  Xw(e);
                })),
                (this.R = new Ha()),
                (this.O = null),
                (this.G = []),
                (this.ba = 1 / 0),
                (this.va = !1),
                (this.i = null),
                (this.N = 0),
                (this.T = !1),
                (this.I = new gt()),
                (this.J = null),
                (this.V = !1),
                (this.$ = ""),
                (this.oa = function () {
                  return !1;
                }),
                (this.X = []),
                (this.ma = new Set()),
                (this.ya = new yw()));
            }
            ((d = Dc.prototype),
              (d.configure = function (e, t) {
                var r = this.j && e.updatePeriod != this.g.updatePeriod && e.updatePeriod >= 0;
                ((this.g = e),
                  t && (this.oa = t),
                  r && this.h && this.h.presentationTimeline.W() && this.M.Jb(),
                  this.i && this.i.configure(this.g),
                  this.m && this.m.Xi(this.g.dash.useStreamOnceInPeriodFlattening));
              }),
              (d.start = function (e, t) {
                var r = this,
                  s;
                return W(function (a) {
                  if (a.g == 1)
                    return ((r.va = t.isLowLatencyMode()), (r.B = [e]), (r.j = t), _(a, Py(r), 2));
                  if (((s = a.h), r.j && Oy(r, s), !r.j)) throw new ee(2, 7, 7001);
                  return a.return(r.h);
                });
              }),
              (d.stop = function () {
                for (var e = I(this.o.values()), t = e.next(); !t.done; t = e.next())
                  ((t = t.value), t.segmentIndex && t.segmentIndex.release());
                return (
                  this.m && this.m.release(),
                  (this.g = this.j = null),
                  (this.B = []),
                  (this.h = null),
                  this.o.clear(),
                  this.F.clear(),
                  this.u.clear(),
                  this.C.clear(),
                  (this.l = { vf: "", type: "", profiles: [], uc: null, rb: 0, bb: null, qe: 0 }),
                  (this.m = null),
                  this.M != null && (this.M.stop(), (this.M = null)),
                  this.i && this.i.destroy(),
                  this.I && (this.I.release(), (this.I = null)),
                  this.ma.clear(),
                  this.ya.release(),
                  this.R.destroy()
                );
              }),
              (d.update = function () {
                var e = this,
                  t;
                return W(function (r) {
                  if (r.g == 1) return (q(r, 2), _(r, Py(e), 4));
                  if (r.g != 2) return he(r, 0);
                  if (((t = ae(r)), !e.j || !t)) return r.return();
                  (e.j.onError(t), K(r));
                });
              }),
              (d.onExpirationUpdated = function () {}),
              (d.onInitialVariantChosen = function (e) {
                if (this.h && this.h.presentationTimeline.W()) {
                  var t = e.video || e.audio;
                  if (t && t.segmentIndex) {
                    e = this.h.presentationTimeline.Ic();
                    var r = t.segmentIndex.find(e);
                    r != null && (t = t.segmentIndex.get(r)) && ((this.K = t.endTime - e), Oy(this, 0));
                  }
                }
              }),
              (d.banLocation = function (e) {
                this.i && this.i.banLocation(e);
              }),
              (d.setMediaElement = function (e) {
                this.J = e;
              }));
            function Py(e) {
              var t, r, s, a, c, f, g, m, x, E, A;
              return W(function (R) {
                return R.g == 1
                  ? ((t = 4),
                    (r = "MPD"),
                    (s = HU(e)),
                    (a = e.B),
                    s.length
                      ? ((a = s), (r = "Patch"), (t = 6))
                      : e.B.length > 1 && e.i && ((c = Cc(e.i, "Location", !0)), c.length && (a = c)),
                    (f = fn(a, e.g.retryParameters)),
                    (g = Date.now()),
                    _(R, Fy(e, f, 0, { type: t }), 2))
                  : R.g != 3
                    ? ((m = R.h),
                      e.j
                        ? (m.uri && m.uri != m.originalUri && !e.B.includes(m.uri) && e.B.unshift(m.uri),
                          (x = new un(m.uri)),
                          (e.$ = x.g.toString()),
                          _(R, bU(e, m.data, m.uri, r), 3))
                        : R.return(0))
                    : ((E = Date.now()), (A = (E - g) / 1e3), e.Da.sample(1, A), e.ma.clear(), R.return(A));
              });
            }
            function bU(e, t, r, s) {
              var a, c, f, g, m, x, E, A, R, b;
              return W(function (D) {
                if (D.g == 1) {
                  if (((a = t), (c = e.g.dash.manifestPreprocessor), (f = Qh), c != f)) {
                    if (
                      (ft(
                        "manifest.dash.manifestPreprocessor configuration",
                        "Please Use manifest.dash.manifestPreprocessorTXml instead.",
                      ),
                      (g = jw(a, s)),
                      !g)
                    )
                      throw new ee(2, 4, 4001, r);
                    (c(g), (a = Er(g.outerHTML)));
                  }
                  if (((m = Ru(a, s)), !m)) throw new ee(2, 4, 4001, r);
                  return (
                    (x = e.g.dash.manifestPreprocessorTXml),
                    (E = Jh),
                    x != E && x(m),
                    s === "Patch"
                      ? D.return(DU(e, m))
                      : e.g.dash.disableXlinkProcessing
                        ? D.return(Vw(e, m, r))
                        : ((A = e.g.dash.xlinkFailGracefully),
                          (R = Nf(m, e.g.retryParameters, A, r, e.j.networkingEngine)),
                          Jo(e.R, R),
                          _(D, R.promise, 2))
                  );
                }
                return ((b = D.h), D.return(Vw(e, b, r)));
              });
            }
            function Vw(e, t, r) {
              var s,
                a,
                c,
                f,
                g,
                m,
                x,
                E,
                A,
                R,
                b,
                D,
                M,
                P,
                G,
                U,
                H,
                Q,
                ne,
                z,
                J,
                X,
                ie,
                Z,
                re,
                se,
                me,
                fe,
                le,
                ue,
                xe,
                Se,
                Ye,
                be,
                xt,
                qe,
                Ct,
                lt,
                rt,
                dt,
                yt,
                ht,
                st,
                ut,
                An,
                mn,
                Zi,
                Li,
                fi,
                da,
                Us,
                _r,
                Ll,
                _l,
                Tp;
              return W(function (br) {
                switch (br.g) {
                  case 1:
                    for (
                      e.i && e.i.l.clear(),
                        s = [r],
                        a = [],
                        c = new Map(),
                        f = Rt(t, "Location"),
                        g = I(f),
                        m = g.next();
                      !m.done;
                      m = g.next()
                    )
                      ((x = m.value),
                        (E = x.attributes.serviceLocation),
                        (A = ui(x)) &&
                          ((R = Ln(s, [A])[0]),
                          E && (e.i ? Sl(e.i, "Location", E, R) : c.set(E, R)),
                          a.push(R)));
                    if (
                      (e.i
                        ? ((b = Cc(e.i, "Location", !0)), b.length > 0 && (s = e.B = b))
                        : a.length && (s = e.B = a),
                      (e.l.vf = t.attributes.id || ""),
                      (e.l.qe = ze(t, "publishTime", vs) || 0),
                      (e.H = Rt(t, "PatchLocation")),
                      (D = Promise.resolve()),
                      (M = jt(t, "ContentSteering")) && e.j)
                    )
                      for (
                        P = M.attributes.defaultServiceLocation,
                          e.i
                            ? ((e.i.i = s), (e.i.h = P))
                            : ((e.i = new Tl(e.j)),
                              e.i.configure(e.g),
                              e.i.setManifestType("DASH"),
                              (e.i.i = s),
                              (e.i.h = P),
                              (G = ui(M)) &&
                                (ze(M, "queryBeforeStart", eh, !1) ? (D = Rc(e.i, G)) : Rc(e.i, G))),
                          U = I(c.keys()),
                          H = U.next();
                        !H.done;
                        H = U.next()
                      )
                        ((Q = H.value), (ne = c.get(Q)), Sl(e.i, "Location", Q, ne));
                    if (((z = Rt(t, "BaseURL")), (J = !1), e.i))
                      for (X = I(z), ie = X.next(); !ie.done; ie = X.next())
                        ((Z = ie.value),
                          (re = Z.attributes.serviceLocation),
                          (se = ui(Z)),
                          re && se && (Sl(e.i, "BaseURL", re, se), (J = !0)));
                    if (
                      (e.X.splice(0),
                      (J && e.i) || ((me = z.map(ui)), e.X.push.apply(e.X, V(Ln(s, me)))),
                      (fe = e.i),
                      (le = e.X),
                      (ue = KU),
                      (xe = ue.call(Dc, fe, J, le)),
                      (e.l.bb = xe),
                      (Se = 0),
                      z && z.length && (Se = ze(z[0], "availabilityTimeOffset", Zd) || 0),
                      (e.l.rb = Se),
                      (e.K = ze(t, "minimumUpdatePeriod", qr, -1)),
                      (Ye = ze(t, "availabilityStartTime", vs)),
                      (be = ze(t, "timeShiftBufferDepth", qr)),
                      (xt = e.g.dash.ignoreSuggestedPresentationDelay),
                      (qe = null),
                      xt || (qe = ze(t, "suggestedPresentationDelay", qr)),
                      (Ct = e.g.dash.ignoreMaxSegmentDuration),
                      (lt = null),
                      Ct || (lt = ze(t, "maxSegmentDuration", qr)),
                      (rt = t.attributes.type || "static"),
                      e.h &&
                        e.h.presentationTimeline &&
                        (e.V = e.h.presentationTimeline.W() && rt == "static"),
                      (e.l.type = rt),
                      e.h)
                    )
                      for (
                        dt = e.h.presentationTimeline, yt = dt.Hb(), ht = I(e.o.values()), st = ht.next();
                        !st.done;
                        st = ht.next()
                      )
                        ((ut = st.value), ut.segmentIndex && ut.segmentIndex.Ya(yt));
                    else
                      ((An = e.g.dash.ignoreMinBufferTime),
                        (mn = 0),
                        An || (mn = ze(t, "minBufferTime", qr) || 0),
                        (Zi = 0),
                        (Zi =
                          qe != null
                            ? Math.min(qe, be || 1 / 0)
                            : e.g.defaultPresentationDelay > 0
                              ? e.g.defaultPresentationDelay
                              : Math.min(mn * 1.5, be || 1 / 0)),
                        (dt = new Ke(Ye, Zi, e.g.dash.autoCorrectDrift)));
                    return (
                      dt.cd(rt == "static"),
                      dt.W() &&
                        !isNaN(e.g.availabilityWindowOverride) &&
                        (be = e.g.availabilityWindowOverride),
                      be == null && (be = 1 / 0),
                      dt.Lf(be),
                      (Li = t.attributes.profiles || ""),
                      (e.l.profiles = Li.split(",")),
                      (fi = {
                        Eb: rt != "static",
                        presentationTimeline: dt,
                        sa: null,
                        na: null,
                        qa: null,
                        L: null,
                        bandwidth: 0,
                        Og: !1,
                        rb: Se,
                        uc: null,
                        profiles: Li.split(","),
                        roles: null,
                        Lb: Zw,
                      }),
                      _(br, D, 2)
                    );
                  case 2:
                    return (
                      (e.N = 0),
                      (da = zw(e, fi, xe, t, !1)),
                      (Us = da.duration),
                      (_r = da.periods),
                      ((rt != "static" || e.V) && da.ai) || dt.Ab(Us || 1 / 0),
                      e.T && e.va && dt.Ui(e.ba),
                      dt.Wg(lt || 1),
                      e.T && e.va && ((Ll = qe != null ? qe : e.g.defaultPresentationDelay), dt.rh(Ll)),
                      e.h
                        ? ((e.h.periodCount = _r.length), (e.h.gapCount = e.N), _(br, Hw(e, _r, !1), 4))
                        : _(br, e.m.lg(_r, fi.Eb), 6)
                    );
                  case 6:
                    var Sp = dt,
                      Vv = e.m.l,
                      Ep = e.m.Mg(),
                      bl = e.m.i,
                      Vc = e.g.dash.sequenceMode,
                      yn = jt(t, "ServiceDescription");
                    if (yn) {
                      var Gi = jt(yn, "Latency");
                      if (((yn = jt(yn, "PlaybackRate")), Gi || yn)) {
                        var pi = {};
                        (Gi &&
                          ("target" in Gi.attributes &&
                            (pi.targetLatency = parseInt(Gi.attributes.target, 10) / 1e3),
                          "max" in Gi.attributes && (pi.maxLatency = parseInt(Gi.attributes.max, 10) / 1e3),
                          "min" in Gi.attributes && (pi.minLatency = parseInt(Gi.attributes.min, 10) / 1e3)),
                          yn &&
                            ("max" in yn.attributes && (pi.maxPlaybackRate = parseFloat(yn.attributes.max)),
                            "min" in yn.attributes && (pi.minPlaybackRate = parseFloat(yn.attributes.min))),
                          (Gi = pi));
                      } else Gi = null;
                    } else Gi = null;
                    e: {
                      if (((yn = Rt(t, "SupplementalProperty")), yn.length)) {
                        for (yn = I(yn), pi = yn.next(); !pi.done; pi = yn.next())
                          if (((pi = pi.value), pi.attributes.schemeIdUri == "urn:mpeg:dash:chaining:2016")) {
                            yn = pi.attributes.value;
                            break e;
                          }
                      }
                      yn = null;
                    }
                    if (
                      ((e.h = {
                        presentationTimeline: Sp,
                        variants: Vv,
                        textStreams: Ep,
                        imageStreams: bl,
                        offlineSessionIds: [],
                        sequenceMode: Vc,
                        ignoreManifestTimestampsInSegmentsMode: !1,
                        type: "DASH",
                        serviceDescription: Gi,
                        nextUrl: yn,
                        periodCount: _r.length,
                        gapCount: e.N,
                        isLowLatency: e.T,
                        startTime: null,
                      }),
                      !dt.kj())
                    ) {
                      br.A(7);
                      break;
                    }
                    return ((_l = Rt(t, "UTCTiming")), _(br, jU(e, xe, _l), 8));
                  case 8:
                    if (((Tp = br.h), !e.j)) return br.return();
                    dt.Vi(Tp);
                  case 7:
                    (dt.qf(), e.m && !e.h.presentationTimeline.W() && e.m.release());
                  case 4:
                    (e.j.makeTextStreamsForClosedCaptions(e.h), MU(e), PU(e, _r), K(br));
                }
              });
            }
            function Hw(e, t, r) {
              var s;
              return W(function (a) {
                if (a.g == 1) return _(a, e.m.lg(t, !0, r), 2);
                ((e.h.variants = e.m.l),
                  (s = e.m.Mg()),
                  s.length > 0 && (e.h.textStreams = s),
                  (e.h.imageStreams = e.m.i),
                  e.j.filter(e.h),
                  K(a));
              });
            }
            function DU(e, t) {
              var r, s, a, c, f, g, m, x, E, A, R, b, D, M, P, G, U, H, Q, ne, z, J, X, ie, Z, re, se;
              return W(function (me) {
                if (me.g == 1) {
                  if (
                    ((r = t.attributes.mpdId),
                    (s = ze(t, "originalPublishTime", vs)),
                    !r || r !== e.l.vf || s !== e.l.qe)
                  )
                    throw ((e.H = []), new ee(1, 4, 4052));
                  for (a = [], c = [], f = new Set(), g = I(zS(t)), m = g.next(); !m.done; m = g.next())
                    if (
                      ((x = m.value),
                      (E = th(x.attributes.sel || "")),
                      (A = E[E.length - 1]),
                      (R = ui(x) || ""),
                      A.name === "MPD")
                    )
                      if (A.Dc === "mediaPresentationDuration") {
                        b = ui(x) || "";
                        var fe = qr(b);
                        if (fe != null) {
                          e.l.uc = fe;
                          for (var le = I(e.u.values()), ue = le.next(); !ue.done; ue = le.next())
                            ue.value.uc = fe;
                        }
                      } else if (A.Dc === "type") {
                        for (
                          e.h.presentationTimeline.cd(R == "static"),
                            e.l.type = R,
                            fe = I(e.u.values()),
                            le = fe.next();
                          !le.done;
                          le = fe.next()
                        )
                          le.value.Eb = R == "dynamic";
                        R == "static" && (e.K = -1);
                      } else
                        A.Dc === "publishTime"
                          ? (e.l.qe = vs(R) || 0)
                          : A.Dc === null && x.tagName === "add" && c.push(x);
                    else if (A.name === "PatchLocation") XS(e.H, x);
                    else if (A.name === "Period")
                      x.tagName === "add" ? c.push(x) : x.tagName === "remove" && A.id && kU(e, A.id);
                    else if (A.name === "SegmentTemplate") {
                      if (((le = th(x.attributes.sel || "")), (fe = le[le.length - 1]), fe.Dc)) {
                        ((le = Kw(e, le)), (ue = ui(x) || ""));
                        for (var xe = I(le), Se = xe.next(); !Se.done; Se = xe.next())
                          ((Se = e.u.get(Se.value)), QS(Se.L.Oc, x.tagName, fe.Dc, ue));
                        fe = le;
                      } else fe = [];
                      for (D = fe, M = I(D), P = M.next(); !P.done; P = M.next()) ((G = P.value), f.add(G));
                    } else if (A.name === "SegmentTimeline" || A.name === "S") {
                      for (
                        fe = th(x.attributes.sel || ""), fe = Kw(e, fe), le = I(fe), ue = le.next();
                        !ue.done;
                        ue = le.next()
                      )
                        ((ue = e.u.get(ue.value)),
                          (ue = vl(ue, xo, "SegmentTimeline")),
                          (xe = Rt(ue, "S")),
                          XS(xe, x),
                          (ue.children = xe));
                      for (U = fe, H = I(U), Q = H.next(); !Q.done; Q = H.next()) ((ne = Q.value), f.add(ne));
                    }
                  for (z = I(f), J = z.next(); !J.done; J = z.next()) ((X = J.value), Ww(e, X));
                  for (ie = I(c), Z = ie.next(); !Z.done; Z = ie.next())
                    ((re = Z.value),
                      a.push.apply(
                        a,
                        V(
                          zw(
                            e,
                            {
                              Eb: e.l.type == "dynamic",
                              presentationTimeline: e.h.presentationTimeline,
                              sa: null,
                              na: null,
                              qa: null,
                              L: null,
                              bandwidth: 0,
                              Og: !1,
                              rb: e.l.rb,
                              profiles: e.l.profiles,
                              uc: e.l.uc,
                              roles: null,
                              Lb: Zw,
                            },
                            e.l.bb,
                            re,
                            !0,
                          ).periods,
                        ),
                      ));
                  return a.length
                    ? ((e.h.periodCount += a.length), (e.h.gapCount = e.N), _(me, Hw(e, a, !0), 2))
                    : me.A(2);
                }
                (e.l.type == "static" && ((se = e.l.uc), e.h.presentationTimeline.Ab(se || 1 / 0)), K(me));
              });
            }
            function kU(e, t) {
              e.h.periodCount--;
              for (var r = I(e.u.keys()), s = r.next(); !s.done; s = r.next())
                if (((s = s.value), s.startsWith(t))) {
                  var a = e.u.get(s);
                  ((vl(a, xo, "SegmentTimeline").children = []), Ww(e, s), e.u.delete(s));
                }
              e.G = e.G.filter(function (c) {
                return c !== t;
              });
            }
            function Kw(e, t) {
              var r = "",
                s = "",
                a = -1,
                c = "";
              t = I(t);
              for (var f = t.next(); !f.done; f = t.next())
                ((f = f.value),
                  f.name === "Period"
                    ? (r = f.id)
                    : f.name === "AdaptationSet"
                      ? ((s = f.id), f.position !== null && (a = f.position))
                      : f.name === "Representation" && (c = f.id));
              if (((t = []), c)) t.push(r + "," + c);
              else if (s)
                for (a = I(e.u.values()), e = a.next(); !e.done; e = a.next())
                  ((e = e.value), e.sa.id === r && e.qa.id === s && e.L.id && t.push(r + "," + e.L.id));
              else if (a > -1)
                for (s = I(e.u.values()), e = s.next(); !e.done; e = s.next())
                  ((e = e.value), e.sa.id === r && e.qa.position === a && e.L.id && t.push(r + "," + e.L.id));
              return t;
            }
            function Ww(e, t) {
              var r = e.u.get(t),
                s = e.o.get(t);
              s.segmentIndex && s.segmentIndex.Ya(e.h.presentationTimeline.Hb());
              try {
                var a = Lw(
                  r,
                  function (c, f, g, m) {
                    return Qw(e, c, f, g, m);
                  },
                  e.o,
                  !0,
                  e.g.dash.initialSegmentLimit,
                  e.za,
                  r.L.aesKey,
                  null,
                  !0,
                  e.C,
                );
                s.createSegmentIndex = function () {
                  return W(function (c) {
                    if (c.g == 1) return s.segmentIndex ? c.A(0) : _(c, a.Sc(), 3);
                    ((s.segmentIndex = c.h), K(c));
                  });
                };
              } catch (c) {
                if (
                  ((t = r.L.contentType), (t != nt && t != "application" && t != "image") || c.code != 4002)
                )
                  throw c;
              }
            }
            function zw(e, t, r, s, a) {
              var c = t.uc;
              c || ((c = ze(s, "mediaPresentationDuration", qr)), (e.l.uc = c));
              var f = 0;
              e.h && e.h.presentationTimeline && e.V && (f = e.h.presentationTimeline.Zb());
              var g = [],
                m = f;
              s = Rt(s, "Period");
              for (var x = 0; x < s.length; x++) {
                var E = s[x],
                  A = s[x + 1],
                  R = ze(E, "start", qr, m),
                  b = E.attributes.id,
                  D = ze(E, "duration", qr);
                R = x == 0 && R == 0 && e.V ? f : R;
                var M = null;
                if (A) {
                  var P = ze(A, "start", qr);
                  P != null && (M = P - R + f);
                } else c != null && (M = c - R + f);
                if (
                  ((P = BS),
                  M && D && Math.abs(M - D) > P && M > D && e.N++,
                  M == null && (M = D),
                  !(e.O !== null && b !== null && R !== null && R < e.O) ||
                    e.G.includes(b) ||
                    x + 1 == s.length)
                ) {
                  if (
                    (R !== null && (e.O === null || R > e.O) && (e.O = R),
                    (m = OU(e, t, r, { start: R, duration: M, node: E, kf: M == null || !A })),
                    g.push(m),
                    t.sa.id && M && e.za.set(t.sa.id, M),
                    M == null)
                  ) {
                    m = null;
                    break;
                  }
                  m = R + M;
                }
              }
              if (a)
                for (t = I(g), r = t.next(); !r.done; r = t.next())
                  ((r = r.value.id), e.G.includes(r) || e.G.push(r));
              else
                e.G = g.map(function (G) {
                  return G.id;
                });
              return c != null
                ? { periods: g, duration: c + f, ai: !1 }
                : { periods: g, duration: m, ai: !0 };
            }
            function MU(e) {
              var t = Array.from(e.F.keys()).filter(function (g) {
                return !e.G.includes(g);
              });
              t = I(t);
              for (var r = t.next(); !r.done; r = t.next()) {
                r = r.value;
                for (var s = !0, a = I(e.F.get(r)), c = a.next(); !c.done; c = a.next()) {
                  c = c.value;
                  var f = e.o.get(c);
                  f &&
                    (f.segmentIndex && f.segmentIndex.getNumReferences() != 0
                      ? (s = !1)
                      : (e.m && e.m.Zh(f, r), e.o.delete(c)));
                }
                s && e.F.delete(r);
              }
            }
            function PU(e, t) {
              t = new Set(
                t.map(function (a) {
                  return a.id;
                }),
              );
              for (var r = I(e.C.keys()), s = r.next(); !s.done; s = r.next())
                ((s = s.value), t.has(s) || e.C.delete(s));
            }
            function OU(e, t, r, s) {
              ((t.sa = Ny(e, s.node, null, r)),
                (t.na = s),
                (t.sa.rb = t.rb),
                t.sa.id || (t.sa.id = "__shaka_period_" + s.start));
              var a = Rt(s.node, "EventStream");
              ((r = t.presentationTimeline.Hb()), (a = I(a)));
              for (var c = a.next(); !c.done; c = a.next()) VU(e, s.start, s.duration, c.value, r);
              for (r = Rt(s.node, "SupplementalProperty"), r = I(r), a = r.next(); !a.done; a = r.next())
                ((a = a.value),
                  a.attributes.schemeIdUri == "urn:mpeg:dash:urlparam:2014" && (a = kc(e, a)) && (t.Lb = a));
              if (
                ((r = Rt(s.node, "AdaptationSet")
                  .map(function (b, D) {
                    return Yw(e, t, D, b);
                  })
                  .filter(so)),
                t.Eb)
              ) {
                ((a = []), (c = I(r)));
                for (var f = c.next(); !f.done; f = c.next()) {
                  f = I(f.value.Rk);
                  for (var g = f.next(); !g.done; g = f.next()) a.push(g.value);
                }
                if (a.length != new Set(a).size) throw new ee(2, 4, 4018);
              }
              for (a = new Map(), c = I(r), f = c.next(); !f.done; f = c.next())
                for (f = I(f.value.Aj), g = f.next(); !g.done; g = f.next()) {
                  var m = I(g.value);
                  ((g = m.next().value), (m = m.next().value), a.set(g, m));
                }
              if (a.size)
                for (c = null, f = I(r), g = f.next(); !g.done; g = f.next()) {
                  ((g = g.value), (m = []));
                  for (var x = I(g.streams), E = x.next(), A = {}; !E.done; A = { Ah: void 0 }, E = x.next())
                    if (((A.Ah = E.value), a.has(A.Ah.originalId))) {
                      (c ||
                        (c = Rt(s.node, "AdaptationSet")
                          .map(function (b, D) {
                            return Yw(e, t, D, b);
                          })
                          .filter(so)),
                        (E = I(c)));
                      for (var R = E.next(); !R.done; R = E.next())
                        (R = R.value.streams.find(
                          (function (b) {
                            return function (D) {
                              return D.originalId == b.Ah.originalId;
                            };
                          })(A),
                        )) &&
                          ((R.dependencyStream = a.get(R.originalId)),
                          (R.originalId += R.dependencyStream.originalId),
                          m.push(R));
                    }
                  m.length && g.streams.push.apply(g.streams, V(m));
                }
              if (
                ((s = r.filter(function (b) {
                  return !b.Hh;
                })),
                (r = r.filter(function (b) {
                  return b.Hh;
                })),
                !e.g.disableIFrames)
              ) {
                for (r = I(r), a = r.next(); !a.done; a = r.next())
                  for (a = a.value, c = a.Hh.split(" "), f = I(s), g = f.next(); !g.done; g = f.next())
                    if (((g = g.value), c.includes(g.id)))
                      for (g = I(g.streams), m = g.next(); !m.done; m = g.next()) SE(m.value, a.streams);
              }
              if (
                ((r = $f(e.g.disableAudio, s, "audio")),
                (a = $f(e.g.disableVideo, s, "video")),
                (c = $f(e.g.disableText, s, nt)),
                (s = $f(e.g.disableThumbnails, s, "image")),
                a.length === 0 && r.length === 0)
              )
                throw new ee(2, 4, 4004);
              return { id: t.sa.id, audioStreams: r, videoStreams: a, textStreams: c, imageStreams: s };
            }
            function $f(e, t, r) {
              return e || !t.length
                ? []
                : t.reduce(function (s, a) {
                    return (a.contentType != r || s.push.apply(s, V(a.streams)), s);
                  }, []);
            }
            function Yw(e, t, r, s) {
              function a(se) {
                var me = se.attributes["dvb:fontFamily"];
                ((se = se.attributes["dvb:url"]),
                  me && se && ((se = Ln(t.qa.bb(), [se], t.Lb())), e.j.addFont(me, se[0])));
              }
              function c(se) {
                switch (se) {
                  case 1:
                  case 5:
                  case 6:
                  case 7:
                    return "srgb";
                  case 9:
                    return "rec2020";
                  case 11:
                  case 12:
                    return "p3";
                }
              }
              function f(se) {
                switch (se) {
                  case 1:
                  case 6:
                  case 13:
                  case 14:
                  case 15:
                    return "SDR";
                  case 16:
                    return "PQ";
                  case 18:
                    return "HLG";
                }
              }
              ((t.qa = Ny(e, s, t.sa, null)), (t.qa.position = r));
              var g = !1;
              r = Rt(s, "Role");
              var m = r
                  .map(function (se) {
                    return se.attributes.value;
                  })
                  .filter(so),
                x = void 0,
                E = t.qa.contentType == nt;
              (E && (x = "subtitle"), (r = I(r)));
              for (var A = r.next(); !A.done; A = r.next()) {
                A = A.value;
                var R = A.attributes.schemeIdUri;
                if (R == null || R == "urn:mpeg:dash:role:2011")
                  switch (((A = A.attributes.value), A)) {
                    case "main":
                      g = !0;
                      break;
                    case "caption":
                    case "subtitle":
                      x = A;
                  }
              }
              var b = Rt(s, "EssentialProperty");
              r = null;
              var D = !1;
              ((A = null), (R = !1), (b = I(b)));
              for (var M = b.next(); !M.done; M = b.next()) {
                M = M.value;
                var P = M.attributes.schemeIdUri;
                if (P == "http://dashif.org/guidelines/trickmode") r = M.attributes.value;
                else if (P == "urn:mpeg:mpegB:cicp:TransferCharacteristics")
                  var G = f(parseInt(M.attributes.value, 10));
                else if (P == "urn:mpeg:mpegB:cicp:ColourPrimaries")
                  var U = c(parseInt(M.attributes.value, 10));
                else
                  P != "urn:mpeg:mpegB:cicp:MatrixCoefficients" &&
                    (P == "urn:mpeg:dash:ssr:2023" && e.g.dash.enableFastSwitching
                      ? (D = !0)
                      : P == "urn:dvb:dash:fontdownload:2014"
                        ? a(M)
                        : (P == "urn:mpeg:dash:urlparam:2014" && (A = kc(e, M))) || (R = !0));
              }
              if (R) return null;
              var H = null;
              for (R = Rt(s, "SupplementalProperty"), R = I(R), b = R.next(); !b.done; b = R.next())
                ((b = b.value),
                  (M = b.attributes.schemeIdUri),
                  M == "http://dashif.org/guidelines/last-segment-number"
                    ? (H = parseInt(b.attributes.value, 10) - 1)
                    : M == "urn:mpeg:mpegB:cicp:TransferCharacteristics"
                      ? (G = f(parseInt(b.attributes.value, 10)))
                      : M == "urn:mpeg:mpegB:cicp:ColourPrimaries"
                        ? (U = c(parseInt(b.attributes.value, 10)))
                        : M == "urn:dvb:dash:fontdownload:2014"
                          ? a(b)
                          : M == "urn:mpeg:dash:urlparam:2014" && (A = kc(e, b)));
              (A && (t.Lb = A), (A = Rt(s, "Accessibility")));
              var Q = new Map(),
                ne;
              for (A = I(A), R = A.next(); !R.done; R = A.next())
                if (
                  ((b = R.value),
                  (R = b.attributes.schemeIdUri),
                  (b = b.attributes.value),
                  R != "urn:scte:dash:cc:cea-608:2015" || e.g.disableText)
                )
                  if (R != "urn:scte:dash:cc:cea-708:2015" || e.g.disableText)
                    R == "urn:mpeg:dash:role:2011"
                      ? b != null && (m.push(b), b == "captions" && (x = "caption"))
                      : R == "urn:tva:metadata:cs:AudioPurposeCS:2007" &&
                        (b == "1"
                          ? (ne = "visually impaired")
                          : b == "2"
                            ? (ne = "hard of hearing")
                            : b == "9" && (ne = "spoken subtitles"));
                  else if (((R = 1), b != null))
                    for (b = I(b.split(";")), M = b.next(); !M.done; M = b.next()) {
                      P = M.value;
                      var z = (M = void 0);
                      (P.includes("=")
                        ? ((P = P.split("=")), (M = "svc" + P[0]), (z = P[1].split(",")[0].split(":").pop()))
                        : ((M = "svc" + R), R++, (z = P)),
                        Q.set(M, At(z)));
                    }
                  else Q.set("svc1", "und");
                else if (((R = 1), b != null))
                  for (b = b.split(";"), M = I(b), P = M.next(); !P.done; P = M.next()) {
                    z = P.value;
                    var J = (P = void 0);
                    (z.includes("=")
                      ? ((z = z.split("=")),
                        (P = z[0].startsWith("CC") ? z[0] : "CC" + z[0]),
                        (J = z[1] || "und"))
                      : ((P = "CC" + R), b.length == 2 ? (R += 2) : R++, (J = z)),
                      Q.set(P, At(J)));
                  }
                else Q.set("CC1", "und");
              A = Rt(s, "ContentProtection");
              var X = vw(e.ya, A, e.g.ignoreDrmInfo, e.g.dash.keySystemsByURI);
              t.qa.encrypted = A.length > 0;
              var ie = At(t.qa.language || "und"),
                Z = t.qa.label,
                re = new Map();
              if (((s = Rt(s, "Representation")), !e.g.ignoreSupplementalCodecs)) {
                for (A = [], R = I(s), b = R.next(); !b.done; b = R.next())
                  ((M = b.value),
                    (b = ys(M, "urn:scte:dash:scte214-extensions", "supplementalCodecs")) &&
                      ((M = Ar(M)),
                      (M.attributes.codecs = b.split(" ").join(",")),
                      M.attributes.id &&
                        (M.attributes.supplementalId = M.attributes.id + "_supplementalCodecs"),
                      A.push(M)));
                s.push.apply(s, V(A));
              }
              if (
                ((A = s
                  .map(function (se) {
                    var me = NU(e, t, X, x, ie, Z, g, m, Q, se, ne, H);
                    return me &&
                      ((me.hdr = me.hdr || G),
                      (me.colorGamut = me.colorGamut || U),
                      (me.fastSwitching = D),
                      (se = se.attributes.dependencyId))
                      ? ((me.baseOriginalId = se), re.set(se, me), null)
                      : me;
                  })
                  .filter(function (se) {
                    return !!se;
                  })),
                A.length == 0 && re.size == 0)
              ) {
                if (((r = t.qa.contentType == "image"), e.g.dash.ignoreEmptyAdaptationSet || E || r))
                  return null;
                throw new ee(2, 4, 4003);
              }
              if (!t.qa.contentType || t.qa.contentType == "application")
                for (
                  t.qa.contentType = Jw(A[0].mimeType, A[0].codecs), E = I(A), R = E.next();
                  !R.done;
                  R = E.next()
                )
                  R.value.type = t.qa.contentType;
              for (E = t.qa.id || "__fake__" + e.Fa++, R = I(A), b = R.next(); !b.done; b = R.next()) {
                for (b = b.value, M = I(X.drmInfos), P = M.next(); !P.done; P = M.next())
                  ((P = P.value),
                    (P.keyIds =
                      P.keyIds && b.keyIds
                        ? new Set([].concat(V(P.keyIds), V(b.keyIds)))
                        : P.keyIds || b.keyIds));
                e.g.enableAudioGroups && (b.groupId = E);
              }
              return (
                (s = s
                  .map(function (se) {
                    return se.attributes.supplementalId || se.attributes.id;
                  })
                  .filter(so)),
                {
                  id: E,
                  contentType: t.qa.contentType,
                  language: ie,
                  Fm: g,
                  streams: A,
                  drmInfos: X.drmInfos,
                  Hh: r,
                  Rk: s,
                  Aj: re,
                }
              );
            }
            function kc(e, t) {
              if (
                (t = sr(t, "urn:mpeg:dash:schema:urlparam:2014", "UrlQueryInfo")) &&
                ze(t, "useMPDUrlQuery", eh, !1)
              ) {
                var r = t.attributes.queryTemplate;
                if (r)
                  return function () {
                    return r == "$querypart$"
                      ? e.$
                      : r
                          .split("&")
                          .map(function (s) {
                            if (s == "$querypart$") return e.$;
                            var a = /\$query:(.*?)\$/g.exec(s);
                            if (a && a.length == 2) {
                              a = a[1];
                              var c = new ba(e.$).get(a);
                              if (c.length) return a + "=" + c[0];
                            }
                            return s;
                          })
                          .join("&");
                  };
              }
              return null;
            }
            function NU(e, t, r, s, a, c, f, g, m, x, E, A) {
              t.L = Ny(e, x, t.qa, null);
              var R = t.L.id;
              if (((e.ba = Math.min(e.ba, t.L.rb)), (e.T = e.ba > 0), !GU(t.L))) return null;
              var b = t.na.start;
              ((t.bandwidth = ze(x, "bandwidth", Qr) || 0), (t.roles = g));
              var D = Rt(x, "SupplementalProperty"),
                M = Rt(x, "EssentialProperty"),
                P = Rt(x, "ContentProtection");
              x = null;
              var G = M.find(function (le) {
                return le.attributes.schemeIdUri == "urn:mpeg:dash:urlparam:2014";
              });
              ((G ||
                (G = D.find(function (le) {
                  return le.attributes.schemeIdUri == "urn:mpeg:dash:urlparam:2014";
                }))) &&
                (x = kc(e, G)),
                x && (t.Lb = x),
                (G = t.L.contentType),
                (x = G == nt || G == "application"),
                (G = G == "image"),
                P.length && (t.qa.encrypted = !0));
              try {
                var U = void 0;
                if (r.hg) {
                  var H = t.L.bb,
                    Q = t.Lb,
                    ne = Ln(H(), [r.hg.wk], Q()),
                    z = fn(ne, e.g.retryParameters);
                  U = {
                    bitsKey: 128,
                    blockCipherMode: "CBC",
                    iv: r.hg.iv,
                    firstMediaSequenceNumber: 0,
                    fetchKey: function () {
                      var le, ue, xe;
                      return W(function (Se) {
                        if (Se.g == 1) return _(Se, Fy(e, z, 6), 2);
                        if (Se.g != 3) {
                          if (((le = Se.h), !le.data || le.data.byteLength != 16)) throw new ee(2, 4, 4049);
                          return (
                            (ue = { name: "AES-CBC" }),
                            (xe = U),
                            _(Se, l.crypto.subtle.importKey("raw", le.data, ue, !0, ["decrypt"]), 3)
                          );
                        }
                        ((xe.cryptoKey = Se.h), (U.fetchKey = void 0), K(Se));
                      });
                    },
                  };
                }
                if (
                  ((t.L.aesKey = U),
                  (H = function (le, ue, xe, Se) {
                    return Qw(e, le, ue, xe, Se);
                  }),
                  t.L.Id)
                )
                  var J = oU(t, H, U);
                else if (t.L.Ac) J = lU(t, e.o, U);
                else if (t.L.Oc) J = Lw(t, H, e.o, !!e.h, e.g.dash.initialSegmentLimit, e.za, U, A, !1, e.C);
                else {
                  var X = t.na.duration || 0,
                    ie = t.L.bb,
                    Z = t.L.mimeType,
                    re = t.L.codecs;
                  J = {
                    endTime: -1,
                    timeline: -1,
                    Sc: function () {
                      var le = Oh(b, X, ie());
                      return (
                        le.Fb(function (ue) {
                          ((ue.mimeType = Z), (ue.codecs = re));
                        }),
                        Promise.resolve(le)
                      );
                    },
                    timescale: 1,
                  };
                }
              } catch (le) {
                if ((x || G) && le.code == 4002) return null;
                throw le;
              }
              ((A = WF(e.ya, P, r, e.g.ignoreDrmInfo, e.g.dash.keySystemsByURI)),
                (A = new Set(A ? [A] : [])),
                (P = !1),
                D.some(function (le) {
                  return (
                    le.attributes.schemeIdUri == "tag:dolby.com,2018:dash:EC3_ExtensionType:2018" &&
                    le.attributes.value == "JOC"
                  );
                }) && (P = !0),
                (D = !1),
                x && (D = g.includes("forced_subtitle") || g.includes("forced-subtitle")));
              var se;
              if (
                G &&
                ((M = M.find(function (le) {
                  return [
                    "http://dashif.org/thumbnail_tile",
                    "http://dashif.org/guidelines/thumbnail_tile",
                  ].includes(le.attributes.schemeIdUri);
                })) && (se = M.attributes.value),
                !se)
              )
                return null;
              var me;
              ((x = t.L.codecs),
                t.profiles.includes("http://dashif.org/guidelines/dash-if-uhd#hevc-hdr-pq10") &&
                  (x.includes("hvc1.2.4.L153.B0") || x.includes("hev1.2.4.L153.B0")) &&
                  (me = "PQ"),
                (M = t.L.id ? t.sa.id + "," + t.L.id : ""),
                e.H.length && R && e.u.set(t.sa.id + "," + R, UU(t)),
                t.L.Cf && FU(e, t.L.Cf, J, t.presentationTimeline),
                J.endTime != -1 &&
                  t.sa.id != null &&
                  t.L.id != null &&
                  ((R = e.C.get(t.sa.id))
                    ? ((R.endTime = J.endTime),
                      R.gh.includes(t.L.id) || R.gh.push(t.L.id),
                      e.C.set(t.sa.id, R))
                    : e.C.set(t.sa.id, { endTime: J.endTime, timeline: J.timeline, gh: [t.L.id] })));
              var fe =
                M && e.o.has(M)
                  ? e.o.get(M)
                  : {
                      id: e.Fa++,
                      originalId: t.L.id,
                      groupId: null,
                      createSegmentIndex: function () {
                        return Promise.resolve();
                      },
                      closeSegmentIndex: function () {
                        fe.segmentIndex && (fe.segmentIndex.release(), (fe.segmentIndex = null));
                      },
                      segmentIndex: null,
                      mimeType: t.L.mimeType,
                      codecs: x,
                      frameRate: t.L.frameRate,
                      pixelAspectRatio: t.L.pixelAspectRatio,
                      bandwidth: t.bandwidth,
                      width: t.L.width,
                      height: t.L.height,
                      kind: s,
                      encrypted: r.drmInfos.length > 0,
                      drmInfos: r.drmInfos,
                      keyIds: A,
                      language: a,
                      originalLanguage: t.qa.language,
                      label: c,
                      type: t.qa.contentType,
                      primary: f,
                      trickModeVideo: null,
                      dependencyStream: null,
                      emsgSchemeIdUris: t.L.emsgSchemeIdUris,
                      roles: g,
                      forced: D,
                      channelsCount: t.L.yf,
                      audioSamplingRate: t.L.audioSamplingRate,
                      spatialAudio: P,
                      closedCaptions: m,
                      hdr: me,
                      colorGamut: void 0,
                      videoLayout: void 0,
                      tilesLayout: se,
                      accessibilityPurpose: E,
                      external: !1,
                      fastSwitching: !1,
                      fullMimeTypes: new Set([tn(t.L.mimeType, t.L.codecs)]),
                      isAudioMuxedInVideo: !1,
                      baseOriginalId: null,
                    };
              return (
                (fe.createSegmentIndex = function () {
                  var le;
                  return W(function (ue) {
                    if (ue.g == 1) return fe.segmentIndex ? ue.A(0) : ((le = fe), _(ue, J.Sc(), 3));
                    ((le.segmentIndex = ue.h), K(ue));
                  });
                }),
                M &&
                  t.Eb &&
                  !e.o.has(M) &&
                  ((t = t.sa.id || ""), e.F.has(t) || e.F.set(t, []), e.o.set(M, fe), e.F.get(t).push(M)),
                fe
              );
            }
            function FU(e, t, r, s) {
              if (!e.ma.has(t)) {
                e.ma.add(t);
                var a = ze(t, "presentationTime", Fn) || 0,
                  c = jt(t, "UTCTiming"),
                  f;
                ((f = c && c.attributes.schemeIdUri) &&
                  ((c = c.attributes.schemeIdUri),
                  (f = !(
                    c === "urn:mpeg:dash:utc:http-ntp:2014" ||
                    c === "urn:mpeg:dash:utc:ntp:2014" ||
                    c === "urn:mpeg:dash:utc:sntp:2014"
                  ))),
                  f
                    ? (t = (ze(t, "wallClockTime", vs) || 0) * 1e3)
                    : ((t = ze(t, "wallClockTime", Fn) || 0), (t = vA(t))),
                  (r = new Date(t - (a / r.timescale) * 1e3)),
                  (a = r.getTime() / 1e3),
                  isNaN(a) ||
                    (s.o || s.sh(a),
                    (s = new Map().set("detail", { wallClockTime: t, programStartDate: r })),
                    (s = new Me("prft", s)),
                    e.j.onEvent(s)));
              }
            }
            function UU(e) {
              function t(r) {
                return r
                  ? ((r = to(r)), (r.Id = null), (r.Ac = null), (r.Oc = xm(r.Oc)), (r.Cf = null), r)
                  : null;
              }
              return (
                (e = to(e)),
                (e.sa = t(e.sa)),
                (e.qa = t(e.qa)),
                (e.L = t(e.L)),
                e.na && ((e.na = to(e.na)), (e.na.node = null)),
                e
              );
            }
            function Xw(e) {
              var t, r;
              return W(function (s) {
                switch (s.g) {
                  case 1:
                    return ((t = 0), q(s, 2), _(s, Py(e), 4));
                  case 4:
                    ((t = s.h), he(s, 3));
                    break;
                  case 2:
                    if (((r = ae(s)), e.j)) {
                      if (e.g.raiseFatalErrorOnManifestUpdateRequestFailure)
                        return (e.j.onError(r), s.return());
                      ((r.severity = 1), e.j.onError(r));
                    }
                  case 3:
                    if (!e.j) return s.return();
                    (e.j.onManifestUpdated(), Oy(e, t), K(s));
                }
              });
            }
            function Oy(e, t) {
              if (!(e.K < 0)) {
                var r = e.K;
                (e.g.updatePeriod >= 0 && (r = e.g.updatePeriod), e.M.ka(Math.max(r - t, ai(e.Da))));
              }
            }
            function Ny(e, t, r, s) {
              ((r = r || {
                contentType: "",
                mimeType: "",
                codecs: "",
                emsgSchemeIdUris: [],
                frameRate: void 0,
                pixelAspectRatio: void 0,
                yf: null,
                audioSamplingRate: null,
                rb: 0,
                If: 1,
                encrypted: !1,
              }),
                (s = s || r.bb));
              var a = t.attributes.id,
                c = t.attributes.supplementalId,
                f = Rt(t, "BaseURL"),
                g,
                m = !1;
              if (e.i)
                for (var x = I(f), E = x.next(); !E.done; E = x.next()) {
                  var A = E.value;
                  ((E = A.attributes.serviceLocation), (A = ui(A)), E && A && (Sl(e.i, a, E, A), (m = !0)));
                }
              (m && e.i) || (g = f.map(ui));
              var R = e.i;
              ((e = t.attributes.contentType || r.contentType),
                (x = t.attributes.mimeType || r.mimeType),
                (E = y0([t.attributes.codecs || r.codecs]).join(",")),
                (A = ze(t, "frameRate", pP) || r.frameRate));
              var b = t.attributes.sar || r.pixelAspectRatio,
                D = BU(Rt(t, "InbandEventStream"), r.emsgSchemeIdUris),
                M = Rt(t, "AudioChannelConfiguration");
              M = $U(M) || r.yf;
              var P = ze(t, "audioSamplingRate", Fn) || r.audioSamplingRate;
              e || (e = Jw(x, E));
              var G = jt(t, "SegmentBase"),
                U = jt(t, "SegmentTemplate"),
                H = (G && ze(G, "availabilityTimeOffset", Zd)) || 0,
                Q = (U && ze(U, "availabilityTimeOffset", Zd)) || 0,
                ne = (f && f.length && ze(f[0], "availabilityTimeOffset", Zd)) || 0;
              ((H = r.rb + ne + H + Q),
                (Q = null),
                (ne = jt(t, "SegmentSequenceProperties")) && (ne = ze(ne, "cadence", Qr)) && (Q = ne),
                (ne = t.attributes.label));
              var z = Rt(t, "Label");
              return (
                z && z.length && ((z = z[0]), cn(z) && (ne = cn(z))),
                {
                  bb: function () {
                    return Ln(s(), f.length ? (R && m ? Cc(R, a) : g || []) : []);
                  },
                  Id: G || r.Id,
                  Ac: jt(t, "SegmentList") || r.Ac,
                  Oc: U || r.Oc,
                  Cf: jt(t, "ProducerReferenceTime") || r.Cf,
                  width: ze(t, "width", Fn) || r.width,
                  height: ze(t, "height", Fn) || r.height,
                  contentType: e,
                  mimeType: x,
                  codecs: E,
                  frameRate: A,
                  pixelAspectRatio: b,
                  emsgSchemeIdUris: D,
                  id: c || a,
                  originalId: a,
                  language: t.attributes.lang,
                  yf: M,
                  audioSamplingRate: P,
                  rb: H,
                  hf: null,
                  If: Q || r.If,
                  label: ne || null,
                  encrypted: !1,
                }
              );
            }
            function BU(e, t) {
              ((t = t.slice()), (e = I(e)));
              for (var r = e.next(); !r.done; r = e.next())
                ((r = r.value.attributes.schemeIdUri), t.includes(r) || t.push(r));
              return t;
            }
            function $U(e) {
              e = I(e);
              for (var t = e.next(); !t.done; t = e.next()) {
                t = t.value;
                var r = t.attributes.schemeIdUri;
                if (r && (t = t.attributes.value))
                  switch (r) {
                    case "urn:mpeg:dash:outputChannelPositionList:2012":
                      return t.trim().split(/ +/).length;
                    case "urn:mpeg:dash:23003:3:audio_channel_configuration:2011":
                    case "urn:dts:dash:audio_channel_configuration:2012":
                      if (((t = parseInt(t, 10)), !t)) continue;
                      return t;
                    case "tag:dolby.com,2015:dash:audio_channel_configuration:2015":
                      if (
                        ((r = [2, 1, 2, 2, 2, 2, 1, 2, 2, 1, 1, 1, 1, 2, 1, 1, 2, 2]),
                        (t = parseInt(t, 16)),
                        !t)
                      )
                        continue;
                      for (var s = 0, a = 0; a < r.length; a++) t & (1 << a) && (s += r[a]);
                      if (s) return s;
                      continue;
                    case "tag:dolby.com,2014:dash:audio_channel_configuration:2011":
                    case "urn:dolby:dash:audio_channel_configuration:2011":
                      if (
                        ((r = [1, 1, 1, 1, 1, 2, 2, 1, 1, 2, 2, 2, 1, 2, 1, 1].reverse()),
                        (t = parseInt(t, 16)),
                        !t)
                      )
                        continue;
                      for (a = s = 0; a < r.length; a++) t & (1 << a) && (s += r[a]);
                      if (s) return s;
                      continue;
                    case "urn:mpeg:mpegB:cicp:ChannelConfiguration":
                      if (
                        ((r = [0, 1, 2, 3, 4, 5, 6, 8, 2, 3, 4, 7, 8, 24, 8, 12, 10, 12, 14, 12, 14]),
                        (t = parseInt(t, 10)) && t > 0 && t < r.length)
                      )
                        return r[t];
                  }
              }
              return null;
            }
            function GU(e) {
              var t = e.Id ? 1 : 0;
              return (
                (t += e.Ac ? 1 : 0),
                (t += e.Oc ? 1 : 0),
                t == 0
                  ? e.contentType == nt || e.contentType == "application"
                  : (t != 1 && (e.Id && (e.Ac = null), (e.Oc = null)), !0)
              );
            }
            function qw(e, t, r, s) {
              var a, c, f, g, m, x, E;
              return W(function (A) {
                if (A.g == 1)
                  return (
                    (a = [li(r)]),
                    (c = Ln(t(), a)),
                    (f = fn(c, e.g.retryParameters)),
                    (f.method = s),
                    (g = e.j.networkingEngine.request(4, f, { isPreload: e.oa() })),
                    Jo(e.R, g),
                    _(A, g.promise, 2)
                  );
                if (((m = A.h), s == "HEAD")) {
                  if (!m.headers || !m.headers.date) return A.return(0);
                  x = m.headers.date;
                } else x = zt(m.data);
                return ((E = Date.parse(x)), isNaN(E) ? A.return(0) : A.return(E - Date.now()));
              });
            }
            function jU(e, t, r) {
              var s, a, c, f, g, m, x, E;
              return W(function (A) {
                switch (A.g) {
                  case 1:
                    ((s = r.map(function (R) {
                      return { scheme: R.attributes.schemeIdUri, value: R.attributes.value };
                    })),
                      (a = e.g.dash.clockSyncUri),
                      !s.length && a && s.push({ scheme: "urn:mpeg:dash:utc:http-head:2014", value: a }),
                      (c = I(s)),
                      (f = c.next()));
                  case 2:
                    if (f.done) {
                      A.A(4);
                      break;
                    }
                    switch (((g = f.value), q(A, 5), (m = g.scheme), (x = g.value), m)) {
                      case "urn:mpeg:dash:utc:http-head:2014":
                      case "urn:mpeg:dash:utc:http-head:2012":
                        return A.A(7);
                      case "urn:mpeg:dash:utc:http-xsdate:2014":
                      case "urn:mpeg:dash:utc:http-iso:2014":
                      case "urn:mpeg:dash:utc:http-xsdate:2012":
                      case "urn:mpeg:dash:utc:http-iso:2012":
                        return A.A(8);
                      case "urn:mpeg:dash:utc:direct:2014":
                      case "urn:mpeg:dash:utc:direct:2012":
                        return ((E = Date.parse(x)), A.return(isNaN(E) ? 0 : E - Date.now()));
                      case "urn:mpeg:dash:utc:http-ntp:2014":
                      case "urn:mpeg:dash:utc:ntp:2014":
                      case "urn:mpeg:dash:utc:sntp:2014":
                        He("NTP UTCTiming scheme is not supported");
                        break;
                      default:
                        He("Unrecognized scheme in UTCTiming element", m);
                    }
                    A.A(9);
                    break;
                  case 7:
                    return _(A, qw(e, t, x, "HEAD"), 10);
                  case 10:
                    return A.return(A.h);
                  case 8:
                    return _(A, qw(e, t, x, "GET"), 11);
                  case 11:
                    return A.return(A.h);
                  case 9:
                    he(A, 3);
                    break;
                  case 5:
                    ae(A);
                  case 3:
                    ((f = c.next()), A.A(2));
                    break;
                  case 4:
                    return (
                      He(
                        "A UTCTiming element should always be given in live manifests! This content may not play on clients with bad clocks!",
                      ),
                      A.return(0)
                    );
                }
              });
            }
            function VU(e, t, r, s, a) {
              var c = s.attributes.schemeIdUri || "",
                f = s.attributes.value || "",
                g = ze(s, "timescale", Fn) || 1,
                m = ze(s, "presentationTimeOffset", Fn) || 0;
              s = I(Rt(s, "Event"));
              for (var x = s.next(); !x.done; x = s.next()) {
                x = x.value;
                var E = ze(x, "presentationTime", Fn) || 0,
                  A = ze(x, "duration", Fn) || 0;
                ((E = Math.max((E - m) / g + t, t)),
                  (A = E + A / g),
                  r != null && ((E = Math.min(E, t + r)), (A = Math.min(A, t + r))),
                  A < a ||
                    ((x = {
                      schemeIdUri: c,
                      value: f,
                      startTime: E,
                      endTime: A,
                      id: x.attributes.id || "",
                      timescale: g,
                      eventElement: JS(x),
                      eventNode: xm(x),
                    }),
                    e.j.onTimelineRegionAdded(x)));
              }
            }
            function Qw(e, t, r, s, a) {
              var c, f, g, m;
              return W(function (x) {
                return x.g == 1
                  ? ((c = or),
                    (f = a ? 0 : 1),
                    (g = ec(t, r, s, e.g.retryParameters)),
                    _(x, Fy(e, g, c, { type: f }), 2))
                  : ((m = x.h), x.return(m.data));
              });
            }
            function Jw(e, t) {
              return ((t = tn(e, t)), Mu(t) ? nt : e.split("/")[0]);
            }
            function Fy(e, t, r, s) {
              return (
                s || (s = {}),
                (s.isPreload = e.oa()),
                (t = e.j.networkingEngine.request(r, t, s)),
                Jo(e.R, t),
                t.promise
              );
            }
            function HU(e) {
              var t = e.l.qe;
              if (!e.l.vf || !t || !e.H.length) return [];
              var r = Date.now() / 1e3,
                s = e.H.filter(function (a) {
                  return ((a = Fn(a.attributes.ttl)), !a || t + a > r);
                })
                  .map(ui)
                  .filter(so);
              return s.length ? Ln(e.B, s) : [];
            }
            function Zw() {
              return "";
            }
            function KU(e, t, r) {
              return function () {
                return e && t ? Cc(e, "BaseURL") : r.slice();
              };
            }
            (Ee("shaka.dash.DashParser", Dc),
              jo("application/dash+xml", function () {
                return new Dc();
              }),
              jo("video/vnd.mpeg.dash.mpd", function () {
                return new Dc();
              }));
            function Gf() {}
            (Ee("shaka.dependencies", Gf),
              (Gf.has = function (e) {
                return Uy.has(e);
              }),
              (Gf.add = function (e, t) {
                if (!tR[e]) throw Error(e + " is not supported");
                e == eR
                  ? ft("mux.js", "mux.js is no longer used in Shaka Player.")
                  : Uy.set(e, function () {
                      return t;
                    });
              }));
            var eR = "muxjs",
              tR = { Gm: eR, ISOBoxer: "ISOBoxer" };
            Gf.Allowed = tR;
            var Uy = new Map([
              [
                "ISOBoxer",
                function () {
                  return l.ISOBoxer;
                },
              ],
            ]);
            function wt() {
              ((this.j = new Kt(function () {
                return ["Oculus", "Quest"].some(function (e) {
                  return navigator.userAgent.includes(e.toLowerCase());
                })
                  ? "VR"
                  : navigator.userAgent.match(/Smart( ?|_)TV/i) || navigator.userAgent.match(/Android ?TV/i)
                    ? "TV"
                    : navigator.userAgentData
                      ? navigator.userAgentData.mobile
                        ? "MOBILE"
                        : "DESKTOP"
                      : /(?:iPhone|iPad|iPod)/.test(navigator.userAgent)
                        ? "MOBILE"
                        : navigator.userAgentData && navigator.userAgentData.platform
                          ? navigator.userAgentData.platform.toLowerCase() == "android"
                            ? "MOBILE"
                            : "DESKTOP"
                          : navigator.userAgent.includes("Android")
                            ? "MOBILE"
                            : "DESKTOP";
              })),
                (this.l = new Kt(function () {
                  return navigator.vendor.includes("Apple") &&
                    (navigator.userAgent.includes("Version/") || navigator.userAgent.includes("OS/"))
                    ? "WEBKIT"
                    : navigator.userAgent.includes("Edge/")
                      ? "EDGE"
                      : navigator.userAgent.includes("Chrome/")
                        ? "CHROMIUM"
                        : navigator.userAgent.includes("Firefox/")
                          ? "GECKO"
                          : "UNKNOWN";
                })));
            }
            function es() {
              var e = l.ManagedMediaSource || l.MediaSource;
              return !!(e && e.isTypeSupported);
            }
            ((d = wt.prototype),
              (d.hc = function () {
                return !!navigator.mediaCapabilities;
              }),
              (d.Oa = function () {
                return this.j.value();
              }),
              (d.Ha = function () {
                return this.l.value();
              }),
              (d.Fd = function () {
                return !1;
              }),
              (d.ih = function () {
                return !1;
              }),
              (d.jf = function () {
                return !1;
              }),
              (d.Ni = function () {
                return !1;
              }),
              (d.se = function () {
                return !1;
              }),
              (d.fd = function () {
                return !0;
              }),
              (d.Ib = function () {
                var e = l.ManagedSourceBuffer || l.SourceBuffer;
                return !!e && !!e.prototype && !!e.prototype.changeType;
              }),
              (d.we = function () {
                return !0;
              }),
              (d.Si = function () {
                return 0;
              }),
              (d.lc = function () {
                return Promise.resolve({ width: 1 / 0, height: 1 / 0 });
              }),
              (d.$i = function () {
                return !1;
              }),
              (d.xh = function () {
                return !1;
              }),
              (d.Wa = function (e) {
                var t = this.Oa();
                return (
                  (t === "TV" || t === "CONSOLE" || t === "CAST") &&
                    ((e.ads.customPlayheadTracker = !0),
                    (e.ads.skipPlayDetection = !0),
                    (e.ads.supportsMultipleMediaElements = !1)),
                  e
                );
              }),
              (d.Ch = function () {
                return !!l.indexedDB;
              }),
              (d.Li = function () {
                return [];
              }),
              (d.sd = function (e) {
                return l.matchMedia !== void 0 && l.matchMedia("(color-gamut: p3)").matches
                  ? e
                    ? "HLG"
                    : "PQ"
                  : "SDR";
              }),
              (d.gj = function () {
                return !1;
              }),
              (d.Bi = function () {
                return !1;
              }),
              (d.Ff = function () {
                return !1;
              }),
              (d.Of = function () {
                return !0;
              }),
              (d.Ci = function () {
                return !1;
              }),
              (d.fj = function () {
                return !0;
              }),
              (d.ed = function () {
                return !1;
              }),
              (d.Vg = function (e) {
                return e === "com.apple.fps";
              }),
              (d.Nf = function () {
                return !0;
              }),
              (d.toString = function () {
                return "Device: " + this.Nb() + " v" + this.Ba() + "; Type: " + this.Oa();
              }));
            function By() {
              (wt.call(this),
                (this.g = new Kt(function () {
                  var e = navigator.userAgent.match(/Version\/(\d+)/);
                  return e || (e = navigator.userAgent.match(/OS (\d+)(?:_\d+)?/))
                    ? parseInt(e[1], 10)
                    : null;
                })),
                (this.h = new Kt(function () {
                  return /(?:iPhone|iPad|iPod)/.test(navigator.userAgent) || navigator.maxTouchPoints > 1
                    ? "xr" in navigator
                      ? "APPLE_VR"
                      : "MOBILE"
                    : "xr" in navigator
                      ? "APPLE_VR"
                      : "DESKTOP";
                })));
            }
            (N(By, wt),
              (d = By.prototype),
              (d.Ba = function () {
                return this.g.value();
              }),
              (d.Nb = function () {
                return "Apple Browser";
              }),
              (d.Oa = function () {
                return this.h.value();
              }),
              (d.Ha = function () {
                return "WEBKIT";
              }),
              (d.hc = function () {
                return !1;
              }),
              (d.Fd = function (e, t) {
                return t === "audio";
              }),
              (d.jf = function () {
                return !0;
              }),
              (d.Ni = function (e) {
                return e === "audio";
              }),
              (d.Wa = function (e) {
                return (wt.prototype.Wa.call(this, e), (e.abr.minTimeToSwitch = 0.5), e);
              }),
              (d.gj = function () {
                return !0;
              }),
              (d.Nf = function () {
                return !1;
              }),
              (navigator.vendor || "").includes("Apple") &&
                (/(?:iPhone|iPad|iPod)/.test(navigator.userAgent) ||
                  navigator.maxTouchPoints > 1 ||
                  (navigator.userAgentData &&
                    navigator.userAgentData.platform &&
                    navigator.userAgentData.platform.toLowerCase() == "macos") ||
                  (navigator.platform && navigator.platform.toLowerCase().includes("mac"))) &&
                (Fr = function () {
                  return new By();
                }));
            function $y() {
              if (!nR()) throw Error("Not a Chromecast device!");
              (wt.call(this),
                (this.h = new Kt(function () {
                  var e = navigator.userAgent.match(/Chrome\/(\d+)/);
                  return e ? parseInt(e[1], 10) : null;
                })),
                (this.g = new Kt(function () {
                  var e =
                    (navigator.userAgentData && navigator.userAgentData.platform) || navigator.userAgent;
                  return (
                    (e = e.toLowerCase()),
                    e.includes("android") ? iR : e.includes("fuchsia") ? rR : Gy
                  );
                })));
            }
            (N($y, wt),
              (d = $y.prototype),
              (d.Ba = function () {
                return this.h.value();
              }),
              (d.Nb = function () {
                return "Chromecast with " + this.g.value();
              }),
              (d.Oa = function () {
                return "CAST";
              }),
              (d.Ha = function () {
                return "CHROMIUM";
              }),
              (d.hc = function () {
                return wt.prototype.hc.call(this) && this.g.value() !== Gy;
              }),
              (d.Ib = function () {
                return wt.prototype.Ib.call(this) && this.g.value() !== Gy;
              }),
              (d.Si = function () {
                switch (this.g.value()) {
                  case iR:
                    return 0;
                  case rR:
                    return 3;
                  default:
                    return 1;
                }
              }),
              (d.lc = function () {
                var e, t, r, s, a;
                return W(function (c) {
                  switch (c.g) {
                    case 1:
                      if (
                        ((e = l.cast && cast.__platform__ && cast.__platform__.canDisplayType),
                        (t = { width: 1280, height: 720 }),
                        q(c, 2),
                        !(r = e))
                      ) {
                        c.A(4);
                        break;
                      }
                      return _(
                        c,
                        cast.__platform__.canDisplayType(
                          'video/mp4; codecs="avc1.640028"; width=3840; height=2160',
                        ),
                        5,
                      );
                    case 5:
                      r = c.h;
                    case 4:
                      if (r) {
                        ((t.width = 3840), (t.height = 2160), c.A(6));
                        break;
                      }
                      if (!(s = e)) {
                        c.A(7);
                        break;
                      }
                      return _(
                        c,
                        cast.__platform__.canDisplayType(
                          'video/mp4; codecs="avc1.640028"; width=1920; height=1080',
                        ),
                        8,
                      );
                    case 8:
                      s = c.h;
                    case 7:
                      s && ((t.width = 1920), (t.height = 1080));
                    case 6:
                      he(c, 3);
                      break;
                    case 2:
                      ((a = ae(c)), Bt("Failed to check canDisplayType:", a));
                    case 3:
                      return c.return(t);
                  }
                });
              }),
              (d.Wa = function (e) {
                return (wt.prototype.Wa.call(this, e), (e.streaming.stallSkip = 0), e);
              }),
              (d.Ch = function () {
                return !1;
              }),
              (d.ed = function () {
                return !0;
              }));
            function nR() {
              return (
                navigator.userAgent.includes("CrKey") && !navigator.userAgent.includes("VIZIO SmartCast")
              );
            }
            var iR = "Android",
              rR = "Fuchsia",
              Gy = "Linux";
            nR() &&
              (Fr = function () {
                return new $y();
              });
            function jy() {
              wt.call(this);
              var e = this;
              ((this.i = new Kt(function () {
                var t = navigator.userAgent.match(/(Chrome|Firefox)\/(\d+)/);
                return t ? parseInt(t[2], 10) : null;
              })),
                (this.g = new Kt(function () {
                  return navigator.userAgent.match(/Edge?\//)
                    ? "Edge"
                    : navigator.userAgent.includes("Chrome")
                      ? "Chrome"
                      : navigator.userAgent.includes("Firefox")
                        ? "Firefox"
                        : "Unknown";
                })),
                (this.h = new Kt(function () {
                  return navigator.userAgentData && navigator.userAgentData.platform
                    ? navigator.userAgentData.platform.toLowerCase() == "windows"
                    : navigator.platform
                      ? navigator.platform.toLowerCase().includes("win32")
                      : !1;
                })),
                (this.u = new Kt(function () {
                  return wt.prototype.Ib.call(e)
                    ? navigator.userAgent.match(/Edge?\//)
                      ? !e.h.value()
                      : !0
                    : !1;
                })),
                (this.o = new Kt(function () {
                  return navigator.userAgent.includes("sony.hbbtv.tv");
                })),
                (this.m = new Kt(function () {
                  return navigator.userAgentData && navigator.userAgentData.platform
                    ? navigator.userAgentData.platform.toLowerCase() == "android"
                    : !!navigator.userAgent.includes("Android");
                })));
            }
            (N(jy, wt),
              (d = jy.prototype),
              (d.Ba = function () {
                return this.i.value();
              }),
              (d.Nb = function () {
                return this.g.value();
              }),
              (d.Fd = function (e) {
                return dm(e) ? this.g.value() === "Edge" && this.h.value() : !1;
              }),
              (d.ih = function () {
                return this.g.value() === "Edge" && this.h.value();
              }),
              (d.jf = function () {
                return this.g.value() === "Edge" && this.h.value();
              }),
              (d.Ib = function () {
                return this.u.value();
              }),
              (d.Wa = function (e) {
                if ((wt.prototype.Wa.call(this, e), this.h.value()))
                  switch (this.g.value()) {
                    case "Firefox":
                      e.drm.keySystemsMapping = {
                        "com.microsoft.playready": "com.microsoft.playready.recommendation",
                      };
                      break;
                    case "Chrome":
                      e.drm.keySystemsMapping = {
                        "com.microsoft.playready": "com.microsoft.playready.recommendation.3000",
                        "com.microsoft.playready.recommendation":
                          "com.microsoft.playready.recommendation.3000",
                      };
                  }
                return (
                  this.m.value() &&
                    ((e.drm.defaultAudioRobustnessForWidevine = ""),
                    (e.drm.defaultVideoRobustnessForWidevine = "")),
                  e
                );
              }),
              (d.Ff = function () {
                return this.g.value() === "Edge" || this.o.value();
              }),
              (d.ed = function () {
                if (this.Ha() === "GECKO") {
                  var e = this.Ba();
                  return e !== null ? e >= 100 : wt.prototype.ed.call(this);
                }
                return wt.prototype.ed.call(this);
              }),
              (d.Vg = function (e) {
                return this.Ha() === "GECKO"
                  ? e.startsWith("com.microsoft.playready.recommendation")
                  : wt.prototype.Vg.call(this, e);
              }),
              (am = function () {
                return new jy();
              }));
            function Vy() {
              wt.apply(this, arguments);
            }
            (N(Vy, wt),
              (d = Vy.prototype),
              (d.Ba = function () {
                return null;
              }),
              (d.Nb = function () {
                return "Hisense";
              }),
              (d.Oa = function () {
                return "TV";
              }),
              (d.hc = function () {
                return !1;
              }),
              (d.lc = function () {
                var e = { width: 1920, height: 1080 },
                  t = null;
                if (l.Hisense_Get4KSupportState)
                  try {
                    t = l.Hisense_Get4KSupportState();
                  } catch (r) {}
                return (
                  t == null && (t = navigator.userAgent.includes("UHD")),
                  t && ((e.width = 3840), (e.height = 2160)),
                  Promise.resolve(e)
                );
              }),
              (d.Wa = function (e) {
                return (wt.prototype.Wa.call(this, e), (e.streaming.stallSkip = 0), e);
              }),
              (navigator.userAgent.includes("Hisense") || navigator.userAgent.includes("VIDAA")) &&
                (Fr = function () {
                  return new Vy();
                }));
            function Hy() {
              (wt.call(this),
                (this.g = new Kt(function () {
                  var e = navigator.userAgent.match(/PlayStation (\d+)/);
                  return e ? parseInt(e[1], 10) : null;
                })));
            }
            (N(Hy, wt),
              (d = Hy.prototype),
              (d.Nb = function () {
                return "PlayStation";
              }),
              (d.Oa = function () {
                return "CONSOLE";
              }),
              (d.Ha = function () {
                return "WEBKIT";
              }),
              (d.Ba = function () {
                return this.g.value();
              }),
              (d.hc = function () {
                return !1;
              }),
              (d.fd = function () {
                return !1;
              }),
              (d.Ib = function () {
                return !1;
              }),
              (d.xh = function () {
                return this.Ba() === 4;
              }),
              (d.lc = function () {
                var e, t, r, s, a;
                return W(function (c) {
                  switch (c.g) {
                    case 1:
                      return (
                        (e = { width: 1920, height: 1080 }),
                        (t = !1),
                        q(c, 2),
                        _(c, l.msdk.device.getDisplayInfo(), 4)
                      );
                    case 4:
                      ((r = c.h), (t = r.resolution === "4K"), he(c, 3));
                      break;
                    case 2:
                      return (ae(c), q(c, 5), _(c, l.msdk.device.getDisplayInfoImmediate(), 7));
                    case 7:
                      ((s = c.h), (t = s.resolution === "4K"), he(c, 3));
                      break;
                    case 5:
                      ((a = ae(c)), He("PlayStation: Failed to get the display info:", a));
                    case 3:
                      return (t && ((e.width = 3840), (e.height = 2160)), c.return(e));
                  }
                });
              }),
              (d.Wa = function (e) {
                return (
                  wt.prototype.Wa.call(this, e),
                  this.Ba() === 4 && e.drm.preferredKeySystems.push("com.microsoft.playready"),
                  (e.streaming.clearDecodingCache = !0),
                  e
                );
              }),
              (d.Ff = function () {
                return this.Ba() === 4;
              }),
              (d.Of = function () {
                return this.Ba() !== 4;
              }),
              navigator.userAgent.includes("PlayStation") &&
                (Fr = function () {
                  return new Hy();
                }));
            function Ky() {
              wt.call(this);
              var e = navigator.userAgent.match(/Tizen (\d+).(\d+)/);
              ((this.g = e ? parseInt(e[1], 10) : null), (this.h = e ? parseInt(e[2], 10) : null));
            }
            (N(Ky, wt),
              (d = Ky.prototype),
              (d.Ba = function () {
                return this.g;
              }),
              (d.Nb = function () {
                return "Tizen";
              }),
              (d.Ha = function () {
                return "CHROMIUM";
              }),
              (d.Oa = function () {
                return "TV";
              }),
              (d.Fd = function () {
                return !0;
              }),
              (d.se = function () {
                return this.Ba() === 3;
              }),
              (d.hc = function () {
                return !1;
              }),
              (d.fd = function () {
                var e = this.Ba();
                return e !== null ? e >= 4 : wt.prototype.fd.call(this);
              }),
              (d.Ib = function () {
                return !1;
              }),
              (d.we = function () {
                return this.g && this.h
                  ? this.g === 5
                    ? this.h >= 5
                    : this.g > 5
                  : wt.prototype.we.call(this);
              }),
              (d.lc = function () {
                var e = l.devicePixelRatio;
                e = {
                  width: l.screen.width * e > 1920 ? 3840 : 1920,
                  height: l.screen.height * e > 1080 ? 2160 : 1080,
                };
                try {
                  if (webapis.systeminfo && webapis.systeminfo.getMaxVideoResolution) {
                    var t = webapis.systeminfo.getMaxVideoResolution();
                    ((e.width = t.width), (e.height = t.height));
                  } else
                    webapis.productinfo.is8KPanelSupported && webapis.productinfo.is8KPanelSupported()
                      ? ((e.width = 7680), (e.height = 4320))
                      : webapis.productinfo.isUdPanelSupported &&
                        webapis.productinfo.isUdPanelSupported() &&
                        ((e.width = 3840), (e.height = 2160));
                } catch (r) {
                  He("Tizen: Error detecting screen size, default screen size 1920x1080.");
                }
                return Promise.resolve(e);
              }),
              (d.Wa = function (e) {
                return (
                  wt.prototype.Wa.call(this, e),
                  (e.drm.ignoreDuplicateInitData = this.Ba() !== 2),
                  this.Ba() === 3 && (e.streaming.crossBoundaryStrategy = "reset_to_encrypted"),
                  (e.streaming.shouldFixTimestampOffset = !0),
                  (e.streaming.stallSkip = 0),
                  (e.streaming.gapPadding = 2),
                  e
                );
              }),
              (d.Li = function () {
                var e = [];
                return (this.g !== null && this.g < 5 && e.push("opus"), e);
              }),
              (d.sd = function (e) {
                try {
                  if (webapis.avinfo.isHdrTvSupport()) return e ? "HLG" : "PQ";
                } catch (t) {
                  return wt.prototype.sd.call(this, e);
                }
                return "SDR";
              }),
              (d.Bi = function () {
                return !0;
              }),
              (d.Ci = function () {
                return this.Ba() === 3;
              }),
              navigator.userAgent.includes("Tizen") &&
                (Fr = function () {
                  return new Ky();
                }));
            function Al() {
              wt.apply(this, arguments);
            }
            (N(Al, wt),
              (Al.prototype.Ba = function () {
                return null;
              }),
              (Al.prototype.Nb = function () {
                return "Vizio";
              }),
              (Al.prototype.Oa = function () {
                return "TV";
              }),
              (Al.prototype.hc = function () {
                return !1;
              }),
              navigator.userAgent.includes("VIZIO SmartCast") &&
                (Fr = function () {
                  return new Al();
                }));
            function Wy() {
              (wt.call(this),
                (this.i = new Kt(function () {
                  return (
                    navigator.userAgent.includes("DT_STB_BCM") || navigator.userAgent.includes("Sky_STB")
                  );
                })),
                (this.h = new Kt(function () {
                  return navigator.userAgent.includes("SOPOpenBrowser");
                })),
                (this.g = new Kt(function () {
                  if (navigator.userAgent.includes("DT_STB_BCM")) return 11;
                  var e = navigator.userAgent.match(/Version\/(\d+)/);
                  return e || (e = navigator.userAgent.match(/OS (\d+)(?:_\d+)?/))
                    ? parseInt(e[1], 10)
                    : null;
                })));
            }
            (N(Wy, wt),
              (d = Wy.prototype),
              (d.Ba = function () {
                return this.g.value();
              }),
              (d.Nb = function () {
                return "WebKit STB";
              }),
              (d.Oa = function () {
                return "TV";
              }),
              (d.Ha = function () {
                return "WEBKIT";
              }),
              (d.hc = function () {
                return !1;
              }),
              (d.fd = function () {
                var e = this.g.value();
                return e !== null ? e >= 15 : !0;
              }),
              (d.Fd = function () {
                return this.h.value();
              }),
              (d.lc = function () {
                return Promise.resolve({
                  width: l.screen.width * l.devicePixelRatio,
                  height: l.screen.height * l.devicePixelRatio,
                });
              }),
              (d.Of = function () {
                return !this.i.value();
              }),
              (d.Nf = function () {
                return !1;
              }),
              (navigator.userAgent.includes("SOPOpenBrowser") ||
                navigator.userAgent.includes("DT_STB_BCM") ||
                navigator.userAgent.includes("Sky_STB") ||
                !(
                  !(navigator.vendor || "").includes("Apple") ||
                  /(?:iPhone|iPad|iPod)/.test(navigator.userAgent) ||
                  navigator.maxTouchPoints > 1 ||
                  (navigator.userAgentData &&
                    navigator.userAgentData.platform &&
                    navigator.userAgentData.platform.toLowerCase() == "macos") ||
                  (navigator.platform && navigator.platform.toLowerCase().includes("mac"))
                )) &&
                (Fr = function () {
                  return new Wy();
                }));
            function zy() {
              wt.call(this);
              var e = this;
              ((this.h = WU()), (this.g = null));
              try {
                var t = new PalmServiceBridge();
                ((t.onservicecallback = function (r) {
                  ((r = JSON.parse(r)),
                    (e.g =
                      r.configs["tv.model.supportHDR"] ||
                      r.configs["tv.config.supportDolbyHDRContents"] ||
                      !1));
                }),
                  t.call(
                    "luna://com.webos.service.config/getConfigs",
                    JSON.stringify({
                      configNames: ["tv.model.supportHDR", "tv.config.supportDolbyHDRContents"],
                    }),
                  ));
              } catch (r) {
                He("WebOS: getConfigs call failed", r);
              }
            }
            (N(zy, wt),
              (d = zy.prototype),
              (d.Ba = function () {
                return this.h;
              }),
              (d.Nb = function () {
                return "WebOS";
              }),
              (d.Oa = function () {
                return "TV";
              }),
              (d.Ha = function () {
                return "CHROMIUM";
              }),
              (d.hc = function () {
                return !1;
              }),
              (d.fd = function () {
                var e = this.Ba();
                return e !== null ? e > 3 : wt.prototype.fd.call(this);
              }),
              (d.Ib = function () {
                return !1;
              }),
              (d.we = function () {
                var e = this.Ba();
                return e !== null ? e > 3 : wt.prototype.we.call(this);
              }),
              (d.lc = function () {
                var e = { width: 1920, height: 1080 };
                try {
                  var t = JSON.parse(l.PalmSystem.deviceInfo);
                  ((e.width = Math.max(1920, t.screenWidth)), (e.height = Math.max(1080, t.screenHeight)));
                } catch (r) {
                  He("WebOS: Error detecting screen size, default screen size 1920x1080.");
                }
                return Promise.resolve(e);
              }),
              (d.Wa = function (e) {
                return (
                  wt.prototype.Wa.call(this, e),
                  this.Ba() === 3 && (e.streaming.crossBoundaryStrategy = "reset"),
                  (e.streaming.shouldFixTimestampOffset = !0),
                  (e.streaming.stallSkip = 0),
                  e
                );
              }),
              (d.sd = function (e) {
                return this.g == null
                  ? (He("WebOS: getConfigs call haven't finished"), wt.prototype.sd.call(this, e))
                  : this.g
                    ? e
                      ? "HLG"
                      : "PQ"
                    : "SDR";
              }));
            function WU() {
              var e = null,
                t = navigator.userAgent.match(/Chrome\/(\d+)/);
              switch ((t && (e = parseInt(t[1], 10)), e)) {
                case 38:
                  return 3;
                case 53:
                  return 4;
                case 68:
                  return 5;
                case 79:
                  return 6;
                case 87:
                  return 22;
                case 94:
                  return 23;
                case 108:
                  return 24;
                case 120:
                  return 25;
                default:
                  return null;
              }
            }
            if (
              ((d.fj = function () {
                return !1;
              }),
              (d.ed = function () {
                var e = this.Ba();
                return e !== null ? e >= 6 : wt.prototype.ed.call(this);
              }),
              navigator.userAgent.includes("Web0S"))
            ) {
              var zU = new zy();
              Fr = function () {
                return zU;
              };
            }
            function Yy() {
              (wt.call(this), (this.g = navigator.userAgent.includes("Edge/")));
              var e = navigator.userAgent.match(/Edge?\/(\d+)/);
              this.h = e ? parseInt(e[1], 10) : null;
            }
            (N(Yy, wt),
              (d = Yy.prototype),
              (d.Ba = function () {
                return this.h;
              }),
              (d.Nb = function () {
                return "Xbox";
              }),
              (d.Oa = function () {
                return "CONSOLE";
              }),
              (d.Ha = function () {
                return this.g ? "EDGE" : "CHROMIUM";
              }),
              (d.Fd = function () {
                return !0;
              }),
              (d.ih = function () {
                return !0;
              }),
              (d.jf = function () {
                return !0;
              }),
              (d.$i = function () {
                return this.g;
              }),
              (d.lc = function () {
                var e = { width: 1920, height: 1080 },
                  t = sR();
                if (t)
                  try {
                    var r = new t.Media.Protection.ProtectionCapabilities(),
                      s = t.Media.Protection.ProtectionCapabilityResult;
                    t = null;
                    do
                      t = r.isTypeSupported(
                        'video/mp4;codecs="hvc1,mp4a";features="decode-res-x=3840,decode-res-y=2160,decode-bitrate=20000,decode-fps=30,decode-bpc=10,display-res-x=3840,display-res-y=2160,display-bpc=8"',
                        "com.microsoft.playready.recommendation",
                      );
                    while (t === s.maybe);
                    t === s.probably && ((e.width = 3840), (e.height = 2160));
                  } catch (a) {
                    He("Xbox: Error detecting screen size, default screen size 1920x1080.");
                  }
                return Promise.resolve(e);
              }),
              (d.Wa = function (e) {
                return (
                  wt.prototype.Wa.call(this, e),
                  (e.drm.parseInbandPsshEnabled = this.g),
                  e.drm.preferredKeySystems.push("com.microsoft.playready"),
                  this.g && (e.streaming.gapPadding = 0.01),
                  e
                );
              }),
              (d.Ff = function () {
                return !0;
              }),
              (d.Ch = function () {
                return !1;
              }));
            function sR() {
              var e = null;
              try {
                e = typeof Windows < "u" ? Windows : chrome.webview.hostObjects.sync.Windows;
              } catch (t) {}
              return e;
            }
            (navigator.userAgent.includes("Xbox One") || sR() !== null) &&
              (Fr = function () {
                return new Yy();
              });
            function oR(e, t, r) {
              ((this.type = e), (this.ha = t), (this.segments = r || null));
            }
            function jf(e, t, r, s) {
              ((this.id = e), (this.name = t), (this.attributes = r), (this.value = s === void 0 ? null : s));
            }
            jf.prototype.toString = function (e) {
              function t(a) {
                return a.name + "=" + (isNaN(Number(a.value)) ? '"' + a.value + '"' : a.value);
              }
              var r = "#" + this.name,
                s = this.attributes
                  ? this.attributes
                      .filter(function (a) {
                        return e ? !e.has(a.name) : !0;
                      })
                      .map(t)
                  : [];
              return (this.value && s.unshift(this.value), s.length > 0 && (r += ":" + s.join(",")), r);
            };
            function Xy(e, t) {
              return t
                ? e.toString()
                : ((t = new Set()
                    .add("AUDIO")
                    .add("VIDEO")
                    .add("SUBTITLES")
                    .add("PATHWAY-ID")
                    .add("GROUP-ID")
                    .add("URI")),
                  e.toString(t));
            }
            function Il(e, t) {
              return (
                e.attributes.find(function (r) {
                  return r.name === t;
                }) || null
              );
            }
            function Pe(e, t, r) {
              return (e = Il(e, t)) ? e.value : r || null;
            }
            function Dt(e, t) {
              if (((e = Il(e, t)), !e)) throw new ee(2, 4, 4023, t);
              return e.value;
            }
            function aR(e, t, r) {
              ((r = r === void 0 ? [] : r), (this.ha = t), (this.g = e), (this.wc = r));
            }
            function Vf(e, t) {
              ((this.name = e), (this.value = t));
            }
            function dr(e, t) {
              return e.filter(function (r) {
                return r.name == t;
              });
            }
            function lR(e, t) {
              return e.filter(function (r) {
                return Dt(r, "TYPE") == t;
              });
            }
            function _n(e, t) {
              e = I(e);
              for (var r = e.next(); !r.done; r = e.next()) if (((r = r.value), r.name === t)) return r;
              return null;
            }
            function wl(e, t, r) {
              return ((r = r === void 0 ? 0 : r), (e = _n(e, t)) ? Number(e.value) : r);
            }
            function Eo(e, t, r) {
              return t ? uR(e, [t], r) : [];
            }
            function uR(e, t, r) {
              if (!t.length) return [];
              var s = t;
              return (
                r &&
                  r.size &&
                  (s = t.map(function (a) {
                    return cR(a, r);
                  })),
                Ln(e, s)
              );
            }
            function cR(e, t) {
              if (!t || !t.size) return e;
              e = String(e).replace(/%7B/g, "{").replace(/%7D/g, "}");
              var r = e.match(/{\$\w*}/g);
              if (r) {
                r = I(r);
                for (var s = r.next(); !s.done; s = r.next()) {
                  s = s.value;
                  var a = s.slice(2, s.length - 1),
                    c = t.get(a);
                  if (c) e = e.replace(s, c);
                  else throw new ee(2, 4, 4039, a);
                }
              }
              return e;
            }
            function YU() {
              this.g = 0;
            }
            function qy(e, t) {
              ((t = zt(t)), (t = t.replace(/\r\n|\r(?=[^\n]|$)/gm, "\n").trim()));
              var r = t.split(/\n+/m);
              if (!qU.test(r[0])) throw new ee(2, 4, 4015);
              t = 0;
              for (var s = !1, a = [], c = !0, f = 0; f < r.length; f++) {
                var g = r[f],
                  m = r[f + 1];
                if ((g.startsWith("#") && !g.startsWith("#EXT")) || c) c = !1;
                else {
                  if (
                    ((g = dR(e, g)),
                    s ||
                      (fR.has(g.name)
                        ? ((t = 1), (s = !0))
                        : g.name == "EXT-X-STREAM-INF" || g.name == "EXT-X-MEDIA"
                          ? (s = !0)
                          : pR.has(g.name) && ((t = 1), (s = !0))),
                    pR.has(g.name))
                  ) {
                    if (t != 1) throw new ee(2, 4, 4017);
                    ((c = e), (e = Array(Math.max(100, Math.floor((r.length - f) / 2)))), (s = 0), (g = []));
                    var x = [];
                    for (m = null; f < r.length; f++) {
                      var E = r[f];
                      E.startsWith("#EXT")
                        ? ((E = dR(c, E)),
                          fR.has(E.name)
                            ? a.push(E)
                            : E.name == "EXT-X-MAP"
                              ? (m = E)
                              : E.name == "EXT-X-PART"
                                ? x.push(E)
                                : E.name == "EXT-X-PRELOAD-HINT"
                                  ? Pe(E, "TYPE") == "PART"
                                    ? x.push(E)
                                    : Pe(E, "TYPE") == "MAP" && ((E.name = "EXT-X-MAP"), (m = E))
                                  : g.push(E))
                        : (!E.startsWith("#") || E.startsWith("#EXT")) &&
                          ((E = E.trim()),
                          m && g.push(m),
                          (g = new aR(E, g, x)),
                          s < e.length ? (e[s++] = g) : (e.push(g), s++),
                          (g = []),
                          (x = []));
                    }
                    return (
                      x.length &&
                        (m && g.push(m),
                        (r = new aR("", g, x)),
                        s < e.length ? (e[s++] = r) : (e.push(r), s++)),
                      new oR(t, a, s < e.length ? e.slice(0, s) : e)
                    );
                  }
                  (a.push(g),
                    g.name == "EXT-X-STREAM-INF" && (g.attributes.push(new Vf("URI", m)), (c = !0)));
                }
              }
              return new oR(t, a);
            }
            function dR(e, t) {
              e = e.g++;
              var r = t.match(XU);
              if (!r) throw new ee(2, 4, 4016, t);
              t = r[1];
              var s = r[2];
              r = [];
              var a;
              if (s) {
                s = new Oa(s);
                var c;
                for (hR.lastIndex = 0, (c = eo(s, hR)) && (a = c[1]), Qy.lastIndex = 0, c = eo(s, Qy); c; )
                  (r.push(new Vf(c[1], c[2] || c[3])), Na(s), (c = eo(s, Qy)));
              }
              return new jf(e, t, r, a);
            }
            var XU = /^#(EXT[^:]*)(?::(.*))?$/,
              qU = /^#EXTM3U($|[ \t\n])/m,
              hR = /^([^,=]+)(?:,|$)/g,
              Qy = /([^=]+)=(?:"([^"]*)"|([^",]*))(?:,|$)/g,
              fR = new Set(
                "EXT-X-TARGETDURATION EXT-X-MEDIA-SEQUENCE EXT-X-DISCONTINUITY-SEQUENCE EXT-X-PLAYLIST-TYPE EXT-X-I-FRAMES-ONLY EXT-X-ENDLIST EXT-X-SERVER-CONTROL EXT-X-SKIP EXT-X-PART-INF EXT-X-DATERANGE".split(
                  " ",
                ),
              ),
              pR = new Set(
                "EXTINF EXT-X-BYTERANGE EXT-X-DISCONTINUITY EXT-X-PROGRAM-DATE-TIME EXT-X-KEY EXT-X-DATERANGE EXT-X-MAP EXT-X-GAP EXT-X-TILES".split(
                  " ",
                ),
              );
            function gR() {}
            function mR(e, t) {
              try {
                var r = Hf(e);
                return Va({
                  uri: e,
                  originalUri: e,
                  data: r.data,
                  headers: { "content-type": r.contentType },
                  originalRequest: t,
                });
              } catch (s) {
                return oo(s);
              }
            }
            function Hf(e) {
              var t = e.split(":");
              if (t.length < 2 || t[0] != "data") throw new ee(2, 1, 1004, e);
              if (((t = t.slice(1).join(":").split(",")), t.length < 2)) throw new ee(2, 1, 1004, e);
              var r = t[0];
              ((e = l.decodeURIComponent(t.slice(1).join(","))), (t = r.split(";")), (r = t[0]));
              var s = !1;
              t.length > 1 && t[t.length - 1] == "base64" && ((s = !0), t.pop());
              var a;
              return (s ? (a = rr(e)) : (a = Er(e)), { data: a, contentType: r, Ih: t });
            }
            (Ee("shaka.net.DataUriPlugin", gR), (gR.parse = mR), As("data", mR));
            function Kf() {
              var e = this;
              ((this.g = this.h = null),
                (this.G = 1),
                (this.B = new Map()),
                (this.M = new Map()),
                (this.C = new Map()),
                this.C.set("video", new Map()),
                this.C.set("audio", new Map()),
                this.C.set(nt, new Map()),
                this.C.set("image", new Map()),
                (this.dc = new Map()
                  .set("com.apple.streamingkeydelivery", function (t, r, s) {
                    return IB(e, t, r, s);
                  })
                  .set("urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed", function (t) {
                    var r = Dt(t, "METHOD");
                    if (["SAMPLE-AES", "SAMPLE-AES-CTR"].includes(r)) {
                      var s = "cenc";
                      r == "SAMPLE-AES" && (s = "cbcs");
                      var a = Dt(t, "URI");
                      if (((r = Hf(a.split("?")[0])), (a = a.split("?")[0]), !e.I.has(a))) {
                        var c = We(r.data);
                        e.I.set(a, c);
                      }
                      ((s = ms(
                        "com.widevine.alpha",
                        s,
                        [{ initDataType: "cenc", initData: e.I.get(a) }],
                        void 0,
                        r.Ih,
                      )),
                        (t = Pe(t, "KEYID")) && s.keyIds.add(t.toLowerCase().substr(2)),
                        (t = Promise.resolve(s)));
                    } else t = Promise.resolve(null);
                    return t;
                  })
                  .set("com.microsoft.playready", function (t) {
                    var r = Dt(t, "METHOD");
                    if (["SAMPLE-AES", "SAMPLE-AES-CTR"].includes(r)) {
                      var s = "cenc";
                      (r == "SAMPLE-AES" && (s = "cbcs"),
                        (t = Dt(t, "URI")),
                        (r = Hf(t.split("?")[0])),
                        (t = We(r.data)));
                      var a = new Uint8Array([
                        154, 4, 240, 121, 152, 64, 66, 134, 171, 146, 230, 91, 224, 136, 95, 149,
                      ]);
                      ((a = Sh(t, a, new Set(), 0)),
                        (s = ms(
                          "com.microsoft.playready",
                          s,
                          [{ initDataType: "cenc", initData: a }],
                          void 0,
                          r.Ih,
                        )),
                        (t = Wo(["<PLAYREADY>", ps(t), "</PLAYREADY>"].join("\n"))) &&
                          (s.licenseServerUri = Pf(t)),
                        (s = Promise.resolve(s)));
                    } else s = Promise.resolve(null);
                    return s;
                  })
                  .set("urn:uuid:3d5e6d35-9b9a-41e8-b843-dd3c6e72c42c", function (t) {
                    var r = Dt(t, "METHOD");
                    if (["SAMPLE-AES", "SAMPLE-AES-CTR"].includes(r)) {
                      var s = "cenc";
                      r == "SAMPLE-AES" && (s = "cbcs");
                      var a = Dt(t, "URI");
                      if (((r = Hf(a.split("?")[0])), (a = a.split("?")[0]), !e.I.has(a))) {
                        var c = We(r.data);
                        e.I.set(a, c);
                      }
                      ((s = ms(
                        "com.huawei.wiseplay",
                        s,
                        [{ initDataType: "cenc", initData: e.I.get(a) }],
                        void 0,
                        r.Ih,
                      )),
                        (t = Pe(t, "KEYID")) && s.keyIds.add(t.toLowerCase().substr(2)),
                        (t = Promise.resolve(s)));
                    } else t = Promise.resolve(null);
                    return t;
                  })),
                (this.ob = new Set()),
                (this.i = new Map()),
                (this.l = null),
                (this.H = ""),
                (this.ab = new YU()),
                (this.N = -1),
                (this.ma = 1 / 0),
                (this.ba = this.zc = this.kb = !1),
                (this.F = new it(function () {
                  if (e.X && !e.g.continueLoadingWhenPaused && (e.V.Ma(e.X, "timeupdate"), e.X.paused)) {
                    e.V.Aa(e.X, "timeupdate", function () {
                      return FR(e);
                    });
                    return;
                  }
                  FR(e);
                })),
                (this.Fa = Jf),
                (this.m = null),
                (this.eb = 0),
                (this.o = 1 / 0),
                (this.Ua = this.Ta = this.T = 0),
                (this.$ = new Ha()),
                (this.J = new Map()),
                (this.K = new Map()),
                (this.Da = new Map()),
                (this.va = new Map()),
                (this.O = new Map()),
                (this.ya = new Map()),
                (this.za = new Map()),
                (this.yc = this.oa = !1),
                (this.ac = new Di(5)),
                (this.j = null),
                (this.R = !0),
                (this.V = new gt()),
                (this.u = this.X = null),
                (this.cc = function () {
                  return !1;
                }),
                (this.I = new Map()));
            }
            ((d = Kf.prototype),
              (d.configure = function (e, t) {
                var r = this.h && e.updatePeriod != this.g.updatePeriod && e.updatePeriod >= 0;
                ((this.g = e),
                  t && (this.cc = t),
                  this.j && this.j.configure(this.g),
                  r && this.m && this.m.presentationTimeline.W() && this.F.Jb());
              }),
              (d.start = function (e, t) {
                var r = this,
                  s;
                return W(function (a) {
                  return a.g == 1
                    ? ((r.h = t), (r.oa = t.isLowLatencyMode()), _(a, rv(r, [e]).promise, 2))
                    : a.g != 3
                      ? ((s = a.h), (r.H = s.uri), _(a, ZU(r, s.data), 3))
                      : a.return(r.m);
                });
              }),
              (d.stop = function () {
                this.F && (this.F.stop(), (this.F = null));
                var e = [];
                return (
                  this.$ && (e.push(this.$.destroy()), (this.$ = null)),
                  (this.g = this.h = null),
                  this.ob.clear(),
                  (this.m = null),
                  this.i.clear(),
                  this.M.clear(),
                  this.K.clear(),
                  this.B.clear(),
                  this.Da.clear(),
                  this.va.clear(),
                  this.O.clear(),
                  this.ya.clear(),
                  this.za.clear(),
                  this.I.clear(),
                  this.j && this.j.destroy(),
                  this.V && (this.V.release(), (this.V = null)),
                  Promise.all(e)
                );
              }),
              (d.update = function () {
                var e = this,
                  t,
                  r,
                  s,
                  a,
                  c,
                  f,
                  g,
                  m,
                  x,
                  E;
                return W(function (A) {
                  if (A.g == 1) {
                    if (!ii(e)) return A.return();
                    for (
                      t = [],
                        r = Array.from(e.i.values()),
                        e.o = 1 / 0,
                        e.m.gapCount = 0,
                        s = r.filter(function (R) {
                          return !R.stream.isAudioMuxedInVideo && R.stream.segmentIndex;
                        }),
                        a = I(s),
                        c = a.next();
                      !c.done;
                      c = a.next()
                    )
                      ((f = c.value), t.push(QU(e, f)));
                    return _(A, Promise.all(t), 2);
                  }
                  for (
                    IR(
                      e,
                      s.map(function (R) {
                        return R.stream;
                      }),
                    ),
                      g = s.some(function (R) {
                        return R.be == 0;
                      }),
                      s.length && !g && (Xf(e, Jf), Wf(e)),
                      g && Wf(e),
                      m = I(s),
                      x = m.next();
                    !x.done;
                    x = m.next()
                  )
                    ((E = x.value),
                      E.stream.isAudioMuxedInVideo ||
                        !E.stream.segmentIndex ||
                        $r(E.stream.segmentIndex) ||
                        e.h.disableStream(E.stream));
                  K(A);
                });
              }));
            function Jy(e, t) {
              return ii(e) ? e.C.get(t.type) : t.rf;
            }
            function QU(e, t) {
              var r,
                s,
                a,
                c,
                f,
                g,
                m,
                x,
                E,
                A,
                R,
                b,
                D,
                M,
                P,
                G,
                U,
                H,
                Q,
                ne,
                z,
                J,
                X,
                ie,
                Z,
                re,
                se,
                me,
                fe,
                le,
                ue,
                xe,
                Se,
                Ye,
                be,
                xt;
              return W(function (qe) {
                switch (qe.g) {
                  case 1:
                    if (t.stream.isAudioMuxedInVideo) return qe.return();
                    for (r = [], s = I(t.P()), a = s.next(); !a.done; a = s.next())
                      ((c = a.value),
                        (f = new un(c)),
                        (g = f.g),
                        t.Ue &&
                          (t.Qb >= 0 && g.add("_HLS_msn", String(t.Qb)),
                          t.Rb >= 0 && g.add("_HLS_part", String(t.Rb))),
                        t.Ve && g.add("_HLS_skip", "YES"),
                        PS(g) && Bo(f, _a(g.toString())),
                        r.push(f.toString()));
                    return (q(qe, 2), _(qe, rv(e, r, !0).promise, 4));
                  case 4:
                    ((m = qe.h), he(qe, 3));
                    break;
                  case 2:
                    throw ((x = ae(qe)), e.h && e.h.disableStream(t.stream), x);
                  case 3:
                    if (!t.stream.segmentIndex) return qe.return();
                    if (((E = qy(e.ab, m.data)), E.type != 1)) throw new ee(2, 4, 4017);
                    return (
                      (A = m.uri),
                      A == m.originalUri || t.P().includes(A) || t.Df.push(A),
                      (R = dr(E.ha, "EXT-X-DEFINE")),
                      (b = Zy(e, R, A)),
                      (D = t.stream),
                      (M = Jy(e, t)),
                      _(qe, LR(e, E, D.mimeType, t.P, b), 5)
                    );
                  case 5:
                    for (
                      P = qe.h,
                        G = P.keyIds,
                        U = P.drmInfos,
                        H = P.encrypted,
                        Q = P.Qh,
                        D.encrypted || !H || Q || (D.encrypted = !0),
                        ne = function (Ct, lt) {
                          return (
                            Ct.size === lt.size &&
                            [].concat(V(Ct)).every(function (rt) {
                              return lt.has(rt);
                            })
                          );
                        },
                        ne(D.keyIds, G) || ((D.keyIds = G), (D.drmInfos = U), e.h.newDrmInfo(D)),
                        z = PR(e, E, M, b, t.P, t.type),
                        J = z.segments,
                        (X = z.bandwidth) && (D.bandwidth = X),
                        ie = Fh(D),
                        Z = I(J),
                        re = Z.next();
                      !re.done;
                      re = Z.next()
                    )
                      ((se = re.value), se.ea && (se.ea.xd = ie));
                    (D.segmentIndex.ke(J, e.l.Hb()),
                      J.length &&
                        ((me = wl(E.ha, "EXT-X-MEDIA-SEQUENCE", 0)),
                        (le = (fe = _n(E.ha, "EXT-X-SKIP")) ? Number(Pe(fe, "SKIPPED-SEGMENTS")) : 0),
                        (ue = RR(me, J)),
                        (xe = ue.Qb),
                        (Se = ue.Rb),
                        (t.Qb = xe + le),
                        (t.Rb = Se),
                        (Ye = M.get(me)),
                        D.segmentIndex.Ya(Ye)),
                      (be = $r(D.segmentIndex)) &&
                        ((t.Wc = be.startTime), (xt = J[J.length - 1]), (t.Mc = xt.endTime)),
                      _n(E.ha, "EXT-X-ENDLIST") && (t.be = !0),
                      tv(e, E),
                      nv(e, E.ha, D.type, b, t.P),
                      K(qe));
                }
              });
            }
            ((d.onExpirationUpdated = function () {}),
              (d.onInitialVariantChosen = function () {}),
              (d.banLocation = function (e) {
                this.j && this.j.banLocation(e);
              }),
              (d.setMediaElement = function (e) {
                this.X = e;
              }));
            function yR(e, t, r) {
              r = r === void 0 ? !1 : r;
              for (var s = e.N == -1, a = I(t), c = a.next(); !c.done; c = a.next()) {
                c = c.value;
                var f = c.stream.segmentIndex,
                  g = Jy(e, c);
                if ((f = $r(f))) {
                  g = I(g);
                  for (var m = g.next(); !m.done; m = g.next()) {
                    m = I(m.value);
                    var x = m.next().value;
                    if (m.next().value == f.startTime) {
                      (s && (e.N = Math.max(e.N, x)), (c.sg = x));
                      break;
                    }
                  }
                }
              }
              if (!(e.N < 0))
                for (t = I(t), s = t.next(); !s.done; s = t.next())
                  ((s = s.value),
                    (Mc(e, s.type) || r) &&
                      (a = s.stream.segmentIndex) &&
                      ((c = e.N - s.sg),
                      c > 0 &&
                        (a.g.splice(0, c), (a = $r(a))) &&
                        ((a = -a.startTime), s.stream.segmentIndex.offset(a), vR(e, s, a))));
            }
            function JU(e, t) {
              if (e.ma == 1 / 0) {
                t = I(t);
                for (var r = t.next(); !r.done; r = t.next())
                  ((r = $r(r.value.stream.segmentIndex)),
                    r != null && r.h != null && (e.ma = Math.min(e.ma, r.h)));
              }
              if (((t = e.ma), t != 1 / 0)) {
                r = I(e.i.values());
                for (var s = r.next(); !s.done; s = r.next())
                  if (((s = s.value), !Mc(e, s.type))) {
                    var a = s.stream.segmentIndex;
                    if (a != null) {
                      var c = $r(a);
                      if (c)
                        if (c.h == null)
                          Bt("Missing EXT-X-PROGRAM-DATE-TIME for stream", s.P(), "Expect AV sync issues!");
                        else
                          for (vR(e, s, c.h - t - c.startTime), s = I(a), a = s.next(); !a.done; a = s.next())
                            a.value.Dh(t);
                    }
                  }
              }
            }
            function vR(e, t, r) {
              if (!(Math.abs(r) < 0.001)) {
                ((t.Wc += r), (t.Mc += r), (e = Jy(e, t)));
                for (var s = I(e), a = s.next(); !a.done; a = s.next()) {
                  var c = I(a.value);
                  ((a = c.next().value), (c = c.next().value), e.set(a, c + r));
                }
                t.P();
              }
            }
            function ZU(e, t) {
              var r,
                s,
                a,
                c,
                f,
                g,
                m,
                x,
                E,
                A,
                R,
                b,
                D,
                M,
                P,
                G,
                U,
                H,
                Q,
                ne,
                z,
                J,
                X,
                ie,
                Z,
                re,
                se,
                me,
                fe,
                le,
                ue,
                xe,
                Se,
                Ye,
                be,
                xt,
                qe,
                Ct,
                lt,
                rt,
                dt,
                yt,
                ht;
              return W(function (st) {
                switch (st.g) {
                  case 1:
                    return (
                      (r = hn),
                      (s = qy(e.ab, t)),
                      (a = dr(s.ha, "EXT-X-DEFINE")),
                      (c = []),
                      (f = []),
                      (g = []),
                      (e.l = new Ke(null, 0)),
                      e.l.cd(!0),
                      (m = function () {
                        return [e.H];
                      }),
                      (x = null),
                      (E = new Map()),
                      s.type == 1
                        ? ((e.R = !1),
                          (xe = dr(s.ha, "EXT-X-DEFINE")),
                          (E = Zy(e, xe, e.H)),
                          (x = r.wa),
                          (Se = ""),
                          (Ye = new Map()),
                          _(
                            st,
                            wR(
                              e,
                              e.G++,
                              E,
                              s,
                              m,
                              "",
                              x,
                              Se,
                              !0,
                              "Media Playlist",
                              null,
                              Ye,
                              null,
                              !1,
                              null,
                              !1,
                            ),
                            7,
                          ))
                        : (tB(e, a),
                          (A = dr(s.ha, "EXT-X-MEDIA")),
                          (R = dr(s.ha, "EXT-X-STREAM-INF")),
                          (b = dr(s.ha, "EXT-X-IMAGE-STREAM-INF")),
                          (D = dr(s.ha, "EXT-X-I-FRAME-STREAM-INF")),
                          (M = dr(s.ha, "EXT-X-SESSION-KEY")),
                          (P = dr(s.ha, "EXT-X-SESSION-DATA")),
                          (G = dr(s.ha, "EXT-X-CONTENT-STEERING")),
                          iB(e, P),
                          _(st, rB(e, G), 4))
                    );
                  case 4:
                    if (!e.g.ignoreSupplementalCodecs) {
                      for (
                        U = [], H = I(R), Q = H.next(), ne = {};
                        !Q.done;
                        ne = { dj: void 0 }, Q = H.next()
                      )
                        ((z = Q.value),
                          (J = Pe(z, "SUPPLEMENTAL-CODECS")) &&
                            ((ne.dj = J.split(/\s*,\s*/).map(function (ut) {
                              return ut.split("/")[0];
                            })),
                            (X = z.attributes.map(
                              (function (ut) {
                                return function (An) {
                                  var mn = An.name,
                                    Zi = An.value;
                                  return (
                                    mn == "CODECS" &&
                                      ((Zi = ut.dj.join(",")),
                                      (An = An.value.split(",")),
                                      An.length > 1 && (An = Si("audio", An)) && (Zi += "," + An)),
                                    new Vf(mn, Zi)
                                  );
                                };
                              })(ne),
                            )),
                            U.push(new jf(z.id, z.name, X, null))));
                      for (
                        R.push.apply(R, V(U)), ie = [], Z = I(D), re = Z.next(), se = {};
                        !re.done;
                        se = { ej: void 0 }, re = Z.next()
                      )
                        ((me = re.value),
                          (fe = Pe(me, "SUPPLEMENTAL-CODECS")) &&
                            ((se.ej = fe.split(/\s*,\s*/).map(function (ut) {
                              return ut.split("/")[0];
                            })),
                            (le = me.attributes.map(
                              (function (ut) {
                                return function (An) {
                                  var mn = An.name;
                                  return (
                                    (An = An.value),
                                    mn == "CODECS" && (An = ut.ej.join(",")),
                                    new Vf(mn, An)
                                  );
                                };
                              })(se),
                            )),
                            ie.push(new jf(me.id, me.name, le, null))));
                      D.push.apply(D, V(ie));
                    }
                    return (nB(e, R), mB(e, A), (ue = lB(e, D)), _(st, uB(e, R, M, A, m, e.B, ue), 5));
                  case 5:
                    return ((c = st.h), (f = sB(e, A)), _(st, oB(e, b, D), 6));
                  case 6:
                    ((g = st.h), st.A(3));
                    break;
                  case 7:
                    ((be = st.h),
                      e.i.set(e.H, be),
                      be.stream &&
                        ((xt = Fh(be.stream)),
                        be.stream.segmentIndex.Fb(function (ut) {
                          ut.ea && (ut.ea.xd = xt);
                        })),
                      (x = be.stream.type),
                      (qe = !0),
                      ((e.g.disableAudio && be.type == "audio") ||
                        (e.g.disableVideo && be.type == "video" && !be.stream.codecs.includes(","))) &&
                        (qe = !1),
                      qe &&
                        c.push({
                          id: 0,
                          language: At(Se || "und"),
                          disabledUntilTime: 0,
                          primary: !0,
                          audio: be.type == "audio" ? be.stream : null,
                          video: be.type == "video" ? be.stream : null,
                          bandwidth: be.stream.bandwidth || 0,
                          allowedByApplication: !0,
                          allowedByKeySystem: !0,
                          decodingInfos: [],
                        }));
                  case 3:
                    if (!e.h) throw new ee(2, 7, 7001);
                    if (
                      (bR(e, s),
                      s.type == 1 &&
                        (ii(e) && (DR(e, s), (Ct = e.o), e.F.ka(Ct)),
                        (lt = Array.from(e.i.values())),
                        ev(e, lt),
                        Wf(e),
                        nv(e, s.ha, x, E, m)),
                      (e.m = {
                        presentationTimeline: e.l,
                        variants: c,
                        textStreams: f,
                        imageStreams: g,
                        offlineSessionIds: [],
                        sequenceMode: e.g.hls.sequenceMode,
                        ignoreManifestTimestampsInSegmentsMode:
                          e.g.hls.ignoreManifestTimestampsInSegmentsMode,
                        type: "HLS",
                        serviceDescription: null,
                        nextUrl: null,
                        periodCount: 1,
                        gapCount: 0,
                        isLowLatency: !1,
                        startTime: e.u,
                      }),
                      e.ba || !e.g.hls.disableCodecGuessing)
                    ) {
                      st.A(8);
                      break;
                    }
                    for (rt = [], dt = I(e.m.variants), yt = dt.next(); !yt.done; yt = dt.next())
                      ((ht = yt.value),
                        ht.audio && ht.audio.codecs === "" && rt.push(ht.audio.createSegmentIndex()),
                        ht.video && ht.video.codecs === "" && rt.push(ht.video.createSegmentIndex()));
                    return _(st, Promise.all(rt), 8);
                  case 8:
                    (e.h.makeTextStreamsForClosedCaptions(e.m), K(st));
                }
              });
            }
            function eB(e, t) {
              var r, s, a, c, f, g, m, x, E, A, R, b, D, M, P, G;
              return W(function (U) {
                if (U.g == 1)
                  return (
                    (r = m0(e.g.hls.mediaPlaylistFullMimeType)),
                    t.length
                      ? ((s = OR(e, t)),
                        (a = s.segment),
                        (c = s.segmentIndex),
                        (f = a.P()),
                        (g = sl(f[0])) && (m = sv.get(g))
                          ? U.return(m0(m))
                          : _(U, Promise.all([xR(e, a.ea, 0), xR(e, a, c)]), 2))
                      : U.return(r)
                  );
                if (
                  ((x = U.h),
                  (E = x[1].mimeType),
                  (A = x[0].data),
                  (R = x[1].data),
                  (b = "mp4 mp4a m4s m4i m4a m4f cmfa mp4v m4v cmfv fmp4".split(" ")),
                  (D = ["audio/mp4", "video/mp4", "video/iso.segment"]),
                  (M = a.ea || D.includes(E)),
                  !M && Za(We(R)))
                ) {
                  var H = R,
                    Q = e.g.disableAudio,
                    ne = e.g.disableVideo,
                    z = e.g.disableText,
                    J = We(H),
                    X = new Ft().parse(J),
                    ie = X.Yd();
                  J = X.Ng();
                  var Z = [],
                    re = !1,
                    se = !1;
                  if (!Q)
                    switch (ie.audio) {
                      case "aac":
                      case "aac-loas":
                        X.ub().length && (Z.push("mp4a.40.2"), (re = !0));
                        break;
                      case "mp3":
                        X.ub().length && (Z.push("mp4a.40.34"), (re = !0));
                        break;
                      case "ac3":
                        X.ub().length && (Z.push("ac-3"), (re = !0));
                        break;
                      case "ec3":
                        X.ub().length && (Z.push("ec-3"), (re = !0));
                        break;
                      case "opus":
                        X.ub().length && (Z.push("opus"), (re = !0));
                    }
                  if (!ne)
                    switch (ie.video) {
                      case "avc":
                        (J.codec ? Z.push(J.codec) : Z.push("avc1.42E01E"), (se = !0));
                        break;
                      case "hvc":
                        (J.codec ? Z.push(J.codec) : Z.push("hvc1.1.6.L93.90"), (se = !0));
                        break;
                      case "av1":
                        (Z.push("av01.0.01M.08"), (se = !0));
                    }
                  if (Z.length) {
                    if (((Q = re && !se), (ne = new Map()), se && !z)) {
                      for (
                        z = new Ur("video/mp2t"), z.Af(H), H = I(z.Zf()), se = H.next();
                        !se.done;
                        se = H.next()
                      )
                        ((se = se.value), ne.set(se, se));
                      z.Pd();
                    }
                    J = {
                      type: Q ? "audio" : "video",
                      mimeType: "video/mp2t",
                      codecs: Z.join(", "),
                      language: null,
                      height: J.height,
                      width: J.width,
                      channelCount: null,
                      sampleRate: null,
                      closedCaptions: ne,
                      ze: null,
                      colorGamut: null,
                      frameRate: J.frameRate,
                      timescale: null,
                    };
                  } else J = null;
                  if ((P = J)) return U.return(P);
                } else if ((M || b.includes(g)) && (G = aO(A, R, e.g.disableText))) return U.return(G);
                return E ? U.return(m0(E)) : U.return(r);
              });
            }
            function xR(e, t, r) {
              var s, a, c, f, g, m;
              return W(function (x) {
                switch (x.g) {
                  case 1:
                    return t
                      ? ((s = or),
                        (a = ec(t.P(), t.Jc(), t.Hc(), e.g.retryParameters)),
                        (c = t instanceof Be ? 1 : 0),
                        _(x, Fs(e, a, s, { type: c }).promise, 2))
                      : x.return({ mimeType: null, data: null });
                  case 2:
                    if (((f = x.h), (g = f.data), !t.aesKey)) {
                      x.A(3);
                      break;
                    }
                    return _(x, v0(g, t.aesKey, r), 4);
                  case 4:
                    g = x.h;
                  case 3:
                    return (
                      t instanceof Be ? t.ue(g, !0) : t.ue(g),
                      (m = f.headers["content-type"]) && (m = m.split(";")[0].toLowerCase()),
                      x.return({ mimeType: m, data: g })
                    );
                }
              });
            }
            function Wf(e) {
              if (ii(e)) {
                if (e.Fa == ov) {
                  for (var t = 1 / 0, r = 1 / 0, s = I(e.i.values()), a = s.next(); !a.done; a = s.next())
                    ((a = a.value),
                      a.stream.segmentIndex &&
                        a.stream.type != "text" &&
                        !a.stream.isAudioMuxedInVideo &&
                        ((t = Math.min(t, a.Mc)), (r = Math.min(r, a.Wc))));
                  ((t = t - r || 0),
                    isNaN(e.g.availabilityWindowOverride) || (t = e.g.availabilityWindowOverride),
                    e.l.Lf(t));
                }
              } else e.l.Ab(AR(e));
              if (!e.l.o)
                for (t = I(e.i.values()), r = t.next(); !r.done; r = t.next())
                  ((r = r.value),
                    !r.stream.segmentIndex ||
                      (r.type != "audio" && r.type != "video") ||
                      ((r = $r(r.stream.segmentIndex)) && r.h && e.l.sh(r.h)));
              e.l.qf();
            }
            function tB(e, t) {
              var r = new un(e.H).g;
              t = I(t);
              for (var s = t.next(); !s.done; s = t.next()) {
                var a = s.value;
                s = Pe(a, "NAME");
                var c = Pe(a, "VALUE");
                ((a = Pe(a, "QUERYPARAM")),
                  s && c && (e.B.has(s) || e.B.set(s, c)),
                  a && (s = r.get(a)[0]) && !e.B.has(s) && e.B.set(a, s));
              }
            }
            function Zy(e, t, r) {
              r = new un(r).g;
              var s = new Map();
              t = I(t);
              for (var a = t.next(); !a.done; a = t.next()) {
                var c = a.value,
                  f = Pe(c, "NAME"),
                  g = Pe(c, "VALUE");
                ((a = Pe(c, "QUERYPARAM")),
                  (c = Pe(c, "IMPORT")),
                  f && g && (s.has(f) || s.set(f, g)),
                  a && (f = r.get(a)[0]) && !s.has(f) && s.set(a, f),
                  c && (a = e.B.get(c)) && s.set(c, a));
              }
              return s;
            }
            function nB(e, t) {
              t = I(t);
              for (var r = t.next(); !r.done; r = t.next()) {
                var s = r.value,
                  a = Pe(s, "AUDIO");
                r = Pe(s, "VIDEO");
                var c = Pe(s, "SUBTITLES");
                if (((s = TR(e, s)), c)) {
                  var f = Si(nt, s);
                  (e.K.set(c, f), ki(s, f));
                }
                (a && ((c = Si("audio", s)), c || (c = e.g.hls.defaultAudioCodec), e.K.set(a, c)),
                  r && ((a = Si("video", s)), a || (a = e.g.hls.defaultVideoCodec), e.K.set(r, a)));
              }
            }
            function iB(e, t) {
              t = I(t);
              for (var r = t.next(); !r.done; r = t.next()) {
                var s = r.value,
                  a = Pe(s, "DATA-ID");
                r = Pe(s, "URI");
                var c = Pe(s, "LANGUAGE");
                ((s = Pe(s, "VALUE")),
                  (a = new Map().set("id", a)),
                  r && a.set("uri", Eo([e.H], r, e.B)[0]),
                  c && a.set("language", c),
                  s && a.set("value", s),
                  (r = new Me("sessiondata", a)),
                  e.h && e.h.onEvent(r));
              }
            }
            function rB(e, t) {
              var r, s, a, c, f, g;
              return W(function (m) {
                if (!e.h || !e.g) return m.return();
                for (s = I(t), a = s.next(); !a.done; a = s.next())
                  if (((c = a.value), (f = Pe(c, "PATHWAY-ID")), (g = Pe(c, "SERVER-URI")), f && g)) {
                    ((e.j = new Tl(e.h)),
                      e.j.configure(e.g),
                      (e.j.i = [e.H]),
                      e.j.setManifestType("HLS"),
                      (e.j.h = f),
                      (r = Rc(e.j, g)));
                    break;
                  }
                return _(m, r, 0);
              });
            }
            function sB(e, t) {
              var r = lR(t, "SUBTITLES"),
                s = {};
              t = I(r);
              for (var a = t.next(); !a.done; a = t.next()) {
                a = a.value;
                var c = Xy(a, !e.j);
                s[c] ? s[c].push(a) : (s[c] = [a]);
              }
              if (((t = []), !e.g.disableText))
                for (var f in s)
                  try {
                    t.push(SR(e, s[f], new Map()).stream);
                  } catch (g) {
                    if (!e.g.hls.ignoreTextStreamFailures) throw g;
                  }
              for (f = I(r), r = f.next(); !r.done; r = f.next())
                if (((s = Dt(r.value, "GROUP-ID")), (r = e.K.get(s)) && (s = e.M.get(s))))
                  for (s = I(s), a = s.next(); !a.done; a = s.next())
                    ((a = a.value),
                      (a.stream.codecs = r),
                      (a.stream.mimeType = iv(nt, r) || Yf(nt)),
                      Rl(a.stream));
              return t.filter(function (g) {
                return g;
              });
            }
            function Rl(e) {
              var t = new Set([tn(e.mimeType, e.codecs)]);
              (e.segmentIndex &&
                e.segmentIndex.Fb(function (r) {
                  r.mimeType && t.add(tn(r.mimeType, e.codecs));
                }),
                (e.fullMimeTypes = t));
            }
            function oB(e, t, r) {
              var s, a;
              return W(function (c) {
                return c.g == 1
                  ? ((s = t
                      .map(function (f) {
                        var g, m;
                        return W(function (x) {
                          if (x.g == 1)
                            return e.g.disableThumbnails ? x.return(null) : (q(x, 2), _(x, yB(e, f), 4));
                          if (x.g != 2) return ((g = x.h), x.return(g.stream));
                          if (((m = ae(x)), e.g.hls.ignoreImageStreamFailures)) return x.return(null);
                          throw m;
                        });
                      })
                      .concat(
                        r.map(function (f) {
                          if (e.g.disableThumbnails) return null;
                          try {
                            var g = ER(e, f);
                            return g.stream.type !== "image" ? null : g.stream;
                          } catch (m) {
                            if (e.g.hls.ignoreImageStreamFailures) return null;
                            throw m;
                          }
                        }),
                      )),
                    _(c, Promise.all(s), 2))
                  : ((a = c.h),
                    c.return(
                      a.filter(function (f) {
                        return f;
                      }),
                    ));
              });
            }
            function aB(e, t, r) {
              t = t.filter(function (g) {
                var m = Pe(g, "URI") || "";
                return ((g = Pe(g, "TYPE")), g != "SUBTITLES" && (m != "" || g == "AUDIO"));
              });
              var s = {};
              t = I(t);
              for (var a = t.next(); !a.done; a = t.next()) {
                a = a.value;
                var c = Xy(a, !e.j);
                s[c] ? s[c].push(a) : (s[c] = [a]);
              }
              for (var f in s) SR(e, s[f], r, !1);
            }
            function lB(e, t) {
              return t
                .map(function (r) {
                  return ((r = ER(e, r)), r.stream.type !== "video" ? null : r.stream);
                })
                .filter(function (r) {
                  return r;
                });
            }
            function uB(e, t, r, s, a, c, f) {
              var g,
                m,
                x,
                E,
                A,
                R,
                b,
                D,
                M,
                P,
                G,
                U,
                H,
                Q,
                ne,
                z,
                J,
                X,
                ie,
                Z,
                re,
                se,
                me,
                fe,
                le,
                ue,
                xe,
                Se,
                Ye,
                be,
                xt,
                qe,
                Ct,
                lt,
                rt,
                dt;
              return W(function (yt) {
                switch (yt.g) {
                  case 1:
                    if (((g = []), (m = new Set()), e.g.ignoreDrmInfo || !(r.length > 0))) {
                      yt.A(2);
                      break;
                    }
                    ((x = I(r)), (E = x.next()));
                  case 3:
                    if (E.done) {
                      yt.A(2);
                      break;
                    }
                    if (
                      ((A = E.value),
                      (R = Dt(A, "METHOD")),
                      (b = Pe(A, "KEYFORMAT") || "identity"),
                      (D = null),
                      R == "NONE")
                    ) {
                      yt.A(4);
                      break;
                    }
                    if (qf(R)) {
                      ((M = Eo(a(), Dt(A, "URI"), c)),
                        (P = M.sort().join("")),
                        e.O.has(P) ||
                          ((G = fn(M, e.g.retryParameters)), (U = Fs(e, G, 6).promise), e.O.set(P, U)),
                        yt.A(4));
                      break;
                    }
                    if (b == "identity") return _(yt, UR(e, A, "", a, null, c), 12);
                    if (((H = e.dc.get(b)), !H)) {
                      ((Q = null), yt.A(10));
                      break;
                    }
                    return _(yt, H(A, "", null), 11);
                  case 11:
                    Q = yt.h;
                  case 10:
                    ((D = Q), yt.A(6));
                    break;
                  case 12:
                    D = yt.h;
                  case 6:
                    if (D) {
                      if (D.keyIds)
                        for (ne = I(D.keyIds), z = ne.next(); !z.done; z = ne.next())
                          ((J = z.value), m.add(J));
                      g.push(D);
                    }
                  case 4:
                    ((E = x.next()), yt.A(3));
                    break;
                  case 2:
                    for (X = {}, ie = I(t), Z = ie.next(); !Z.done; Z = ie.next())
                      ((re = Z.value), (se = Xy(re, !e.j)), X[se] ? X[se].push(re) : (X[se] = [re]));
                    me = [];
                    for (fe in X)
                      ((le = X[fe]),
                        (ue = le[0]),
                        (xe = Pe(ue, "FRAME-RATE")),
                        (Se = Number(Dt(ue, "BANDWIDTH")) || Number(Pe(ue, "AVERAGE-BANDWIDTH"))),
                        (Ye = Pe(ue, "RESOLUTION")),
                        (be = I(Ye ? Ye.split("x") : [null, null])),
                        (xt = be.next().value),
                        (qe = be.next().value),
                        (Ct = Pe(ue, "VIDEO-RANGE")),
                        (lt = Pe(ue, "REQ-VIDEO-LAYOUT")) &&
                          lt.includes(",") &&
                          ((rt = lt.split(",").filter(function (ht) {
                            return ht == "CH-STEREO" || ht == "CH-MONO";
                          })),
                          (lt = rt[0])),
                        (lt = lt || "CH-MONO"),
                        (dt = cB(e, le, s)),
                        me.push.apply(me, V(gB(e, dt.audio, dt.video, Se, xt, qe, xe, Ct, lt, g, m, f))));
                    return yt.return(
                      me.filter(function (ht) {
                        return ht != null;
                      }),
                    );
                }
              });
            }
            function cB(e, t, r) {
              for (
                var s = { audio: [], video: [] },
                  a = new Map(),
                  c = [],
                  f = !1,
                  g = !1,
                  m = I(t),
                  x = m.next();
                !x.done;
                x = m.next()
              ) {
                var E = x.value;
                x = Pe(E, "AUDIO");
                var A = Pe(E, "VIDEO"),
                  R = x || A;
                R &&
                  (c.includes(R) || c.push(R),
                  (E = Pe(E, "PATHWAY-ID")) && a.set(R, E),
                  x ? (f = !0) : A && (g = !0));
              }
              (c.length &&
                r.length &&
                ((r = r.filter(function (D) {
                  return c.includes(Dt(D, "GROUP-ID"));
                })),
                aB(e, r, a)),
                (r = (a = c.sort().join(",")) && e.M.has(a) ? e.M.get(a) : []),
                f ? s.audio.push.apply(s.audio, V(r)) : g && s.video.push.apply(s.video, V(r)),
                (g = !1));
              var b = t.map(function (D) {
                return Dt(D, "URI");
              });
              return (
                (f = s.audio.find(function (D) {
                  return (
                    D &&
                    D.P().find(function (M) {
                      return b.includes(M);
                    })
                  );
                })),
                (r = TR(e, t[0])),
                (m = Si("video", r)),
                (x = Si("audio", r)) && !m
                  ? ((f = "audio"),
                    (g =
                      s.audio.length > 0 &&
                      !s.audio.some(function (D) {
                        return D.stream.isAudioMuxedInVideo;
                      })))
                  : !s.audio.length && !s.video.length && x && m
                    ? ((f = "video"), (r = [[m, x].join()]))
                    : s.audio.length && f
                      ? ((f = "audio"), (g = !0))
                      : (f = s.video.length && !s.audio.length ? "audio" : "video"),
                g ||
                  ((t = vB(e, t, r, f)),
                  a && e.g.enableAudioGroups && (t.stream.groupId = a),
                  t.stream.type == "audio" &&
                    f === "audio" &&
                    s.audio.some(function (D) {
                      return D.stream.isAudioMuxedInVideo;
                    }) &&
                    ((e = s.audio[0].stream),
                    (t.stream.language = e.language),
                    (t.stream.channelsCount = e.channelsCount),
                    (t.stream.label = e.label),
                    (t.stream.audioSamplingRate = e.audioSamplingRate),
                    (t.stream.originalId = e.originalId),
                    (t.stream.originalLanguage = e.originalLanguage)),
                  (s[t.stream.type] = [t])),
                s
              );
            }
            function TR(e, t) {
              return (
                (t = Pe(t, "CODECS") || ""),
                (e.ba = t.length > 0),
                e.ba ||
                  e.g.hls.disableCodecGuessing ||
                  ((t = []),
                  e.g.disableVideo || t.push(e.g.hls.defaultVideoCodec),
                  e.g.disableAudio || t.push(e.g.hls.defaultAudioCodec),
                  (t = t.join(","))),
                y0(t.split(/\s*,\s*/))
              );
            }
            function dB(e) {
              return (e = Pe(e, "CHANNELS")) ? parseInt(e.split("/")[0], 10) : null;
            }
            function hB(e) {
              return (e = Pe(e, "SAMPLE-RATE")) ? parseInt(e, 10) : null;
            }
            function fB(e) {
              return (
                (e = Pe(e, "CHANNELS")),
                e ? ((e = e.split("/")), e.length != 2 ? !1 : e[1] === "JOC" || e[1].includes("ATMOS")) : !1
              );
            }
            function pB(e) {
              return ((e = Dt(e, "TYPE").toLowerCase()), e == "subtitles" && (e = nt), e);
            }
            function gB(e, t, r, s, a, c, f, g, m, x, E, A) {
              for (var R = I(r), b = R.next(); !b.done; b = R.next()) NR(b.value.stream, a, c, f, g, m, null);
              for (
                a = e.g.disableVideo,
                  (!r.length || a) && (r = [null]),
                  a &&
                    (t = t.filter(function (G) {
                      return !G.stream.isAudioMuxedInVideo;
                    })),
                  a = e.g.disableAudio,
                  (!t.length || a) && (t = [null]),
                  a = [],
                  t = I(t),
                  c = t.next();
                !c.done;
                c = t.next()
              )
                for (c = c.value, f = I(r), g = f.next(); !g.done; g = f.next()) {
                  var D = g.value;
                  ((g = c ? c.stream : null) && ((g.drmInfos = x), (g.keyIds = E)),
                    (m = D ? D.stream : null) &&
                      ((m.drmInfos = x), (m.keyIds = E), e.g.disableIFrames || SE(m, A)),
                    m && !g && (m.bandwidth = s),
                    !m && g && (g.bandwidth = s),
                    (R = c ? c.stream.drmInfos : null),
                    (b = D ? D.stream.drmInfos : null),
                    (D = D ? D.P().sort().join(",") : ""));
                  var M = c ? c.P().sort().join(",") : "",
                    P = [];
                  (g && g.codecs && P.push(g.codecs),
                    m && m.codecs && P.push(m.codecs),
                    (D = [D, M, P.sort()].join("-")),
                    (g && m && !NS(R, b)) ||
                      e.ob.has(D) ||
                      ((g = {
                        id: e.G++,
                        language: g ? g.language : "und",
                        disabledUntilTime: 0,
                        primary: (!!g && g.primary) || (!!m && m.primary),
                        audio: g,
                        video: m,
                        bandwidth: s,
                        allowedByApplication: !0,
                        allowedByKeySystem: !0,
                        decodingInfos: [],
                      }),
                      a.push(g),
                      e.ob.add(D)));
                }
              return a;
            }
            function mB(e, t) {
              ((t = lR(t, "CLOSED-CAPTIONS")), (e.R = t.length == 0), (t = I(t)));
              for (var r = t.next(); !r.done; r = t.next()) {
                var s = r.value,
                  a = Pe(s, "LANGUAGE");
                ((r = At(a || "und")),
                  a || ((a = Pe(s, "NAME")) && (r = a)),
                  (a = Dt(s, "GROUP-ID")),
                  (s = Dt(s, "INSTREAM-ID").replace("SERVICE", "svc")),
                  e.J.get(a) || e.J.set(a, new Map()),
                  e.J.get(a).set(s, r));
              }
            }
            function SR(e, t, r, s) {
              s = s === void 0 ? !0 : s;
              for (
                var a = [], c = [], f = new Map(), g = I(t), m = g.next(), x = {};
                !m.done;
                x = { oi: void 0 }, m = g.next()
              ) {
                ((m = m.value),
                  (x.oi = ++e.G),
                  (x = (function (M) {
                    return function () {
                      return "shaka://hls-muxed" + M.oi;
                    };
                  })(x)));
                var E = s ? Dt(m, "URI") : Pe(m, "URI") || x();
                ((x = Dt(m, "GROUP-ID")),
                  a.push(E),
                  c.push(x),
                  f.set(x, E),
                  (m = Pe(m, "PATHWAY-ID")) && r.set(x, m));
              }
              if (((s = c.sort().join(",")), (m = t[0]), (t = ""), (g = pB(m)), g == nt))
                t = Pe(m, "CODECS") || "";
              else
                for (c = I(c), x = c.next(); !x.done; x = c.next())
                  if (((x = x.value), e.K.has(x))) {
                    t = e.K.get(x);
                    break;
                  }
              if (((c = a.sort().join(",")), g == "audio" && s && (c += s), e.i.has(c))) return e.i.get(c);
              if (((x = e.G++), e.j))
                for (f = I(f), E = f.next(); !E.done; E = f.next()) {
                  var A = I(E.value);
                  ((E = A.next().value), (A = A.next().value), (E = r.get(E)) && Sl(e.j, x, E, A));
                }
              ((r = Pe(m, "LANGUAGE")),
                (f = Pe(m, "NAME")),
                (E = Pe(m, "DEFAULT") == "YES"),
                (A = g == "audio" ? dB(m) : null));
              var R = g == "audio" ? fB(m) : !1,
                b = Pe(m, "CHARACTERISTICS"),
                D = Pe(m, "FORCED") == "YES";
              return (
                (m = g == "audio" ? hB(m) : null),
                (a = zf(e, x, a, t, g, r, E, f, A, null, b, D, m, R)),
                a.stream && e.g.enableAudioGroups && (a.stream.groupId = s),
                e.M.has(s) ? e.M.get(s).push(a) : e.M.set(s, [a]),
                e.i.set(c, a),
                a
              );
            }
            function yB(e, t) {
              var r, s, a, c, f, g, m, x, E, A;
              return W(function (R) {
                return R.g == 1
                  ? ((r = Dt(t, "URI")),
                    (s = Pe(t, "CODECS", "jpeg") || ""),
                    e.i.has(r)
                      ? R.return(e.i.get(r))
                      : ((a = Pe(t, "LANGUAGE")),
                        (c = Pe(t, "NAME")),
                        (f = Pe(t, "CHARACTERISTICS")),
                        (g = zf(e, e.G++, [r], s, "image", a, !1, c, null, null, f, !1, null, !1)),
                        (m = Pe(t, "RESOLUTION")) ? _(R, g.stream.createSegmentIndex(), 3) : R.A(2)))
                  : (R.g != 2 &&
                      ((x = $r(g.stream.segmentIndex)),
                      (E = x.tilesLayout) &&
                        ((g.stream.width = Number(m.split("x")[0]) * Number(E.split("x")[0])),
                        (g.stream.height = Number(m.split("x")[1]) * Number(E.split("x")[1]))),
                      g.stream.closeSegmentIndex()),
                    (A = Pe(t, "BANDWIDTH")) && (g.stream.bandwidth = Number(A)),
                    e.i.set(r, g),
                    R.return(g));
              });
            }
            function ER(e, t) {
              var r = "video",
                s = Dt(t, "URI"),
                a = Pe(t, "CODECS") || "";
              if ((a == "mjpg" && (r = "image"), e.i.has(s))) return e.i.get(s);
              var c = Pe(t, "LANGUAGE"),
                f = Pe(t, "NAME"),
                g = Pe(t, "CHARACTERISTICS");
              return (
                (r = zf(e, e.G++, [s], a, r, c, !1, f, null, null, g, !1, null, !1)),
                (a = Pe(t, "RESOLUTION")),
                (c = I(a ? a.split("x") : [null, null])),
                (a = c.next().value),
                (c = c.next().value),
                (r.stream.width = Number(a) || void 0),
                (r.stream.height = Number(c) || void 0),
                (t = Pe(t, "BANDWIDTH")) && (r.stream.bandwidth = Number(t)),
                e.i.set(s, r),
                r
              );
            }
            function vB(e, t, r, s) {
              for (var a = e.G++, c = [], f = I(t), g = f.next(); !g.done; g = f.next()) {
                var m = g.value;
                ((g = Dt(m, "URI")), (m = Pe(m, "PATHWAY-ID")), e.j && m && Sl(e.j, a, m, g), c.push(g));
              }
              if (((f = c.sort().join(",") + r.sort().join(",")), e.i.has(f))) return e.i.get(f);
              g = c.join(",");
              e: {
                if (((t = Pe(t[0], "CLOSED-CAPTIONS")), s == "video")) {
                  if (e.g.disableText) {
                    ((e.R = !1), (t = null));
                    break e;
                  }
                  if (t) {
                    if (t != "NONE") {
                      t = e.J.get(t);
                      break e;
                    }
                    e.R = !1;
                  } else if (!t && e.J.size)
                    for (t = I(e.J.keys()), t = t.next(); !t.done; t = t.next()) {
                      t = e.J.get(t.value);
                      break e;
                    }
                }
                t = null;
              }
              return (
                (r = Ma(s, r)),
                (s = zf(e, a, c, r, s, null, !1, g, null, t, null, !1, null, !1)),
                e.i.set(f, s),
                s
              );
            }
            function zf(e, t, r, s, a, c, f, g, m, x, E, A, R, b) {
              function D(Q) {
                var ne, z, J, X, ie, Z, re, se, me, fe, le, ue, xe, Se, Ye, be, xt, qe, Ct, lt;
                return W(function (rt) {
                  switch (rt.g) {
                    case 1:
                      return ((ne = hn), q(rt, 2), _(rt, Q.promise, 4));
                    case 4:
                      if (((z = rt.h), Q.aborted)) return rt.return();
                      if (
                        ((J = z.uri),
                        J != z.originalUri && ((X = G.P()), X.includes(J) || G.Df.push(J)),
                        (ie = qy(e.ab, z.data)),
                        ie.type != 1)
                      )
                        throw new ee(2, 4, 4017);
                      return (
                        (Z = dr(ie.ha, "EXT-X-DEFINE")),
                        (re = Zy(e, Z, J)),
                        (se = !1),
                        ((!e.ba && e.g.hls.disableCodecGuessing) ||
                          (e.R && a == ne.wa && !e.g.hls.disableClosedCaptionsDetection)) &&
                          ie.segments.length > 0 &&
                          ((e.R = !1), (se = !0)),
                        (me = !e.ba && e.g.hls.disableCodecGuessing),
                        (fe = ii(e)),
                        _(rt, wR(e, 0, re, ie, M, s, a, c, f, g, m, x, E, A, R, b, void 0, se, me), 5)
                      );
                    case 5:
                      if (((le = rt.h), Q.aborted)) return rt.return();
                      ((ue = le.stream),
                        bR(e, ie),
                        ii(e) && !fe && DR(e, ie),
                        (G.Wc = le.Wc),
                        (G.Mc = le.Mc),
                        (G.Ve = le.Ve),
                        (G.Ue = le.Ue),
                        (G.be = le.be),
                        (G.rf = le.rf),
                        (G.Qb = le.Qb),
                        (G.Rb = le.Rb),
                        (P.segmentIndex = ue.segmentIndex),
                        (P.encrypted = ue.encrypted),
                        (P.drmInfos = ue.drmInfos),
                        (P.keyIds = ue.keyIds),
                        (P.mimeType = ue.mimeType),
                        (P.bandwidth = P.bandwidth || ue.bandwidth),
                        (P.codecs = P.codecs || ue.codecs),
                        (P.closedCaptions = P.closedCaptions || ue.closedCaptions),
                        (P.width = P.width || ue.width),
                        (P.height = P.height || ue.height),
                        (P.hdr = P.hdr || ue.hdr),
                        (P.colorGamut = P.colorGamut || ue.colorGamut),
                        (P.frameRate = P.frameRate || ue.frameRate),
                        P.language == "und" && ue.language != "und" && (P.language = ue.language),
                        (P.language = P.language || ue.language),
                        (P.channelsCount = P.channelsCount || ue.channelsCount),
                        (P.audioSamplingRate = P.audioSamplingRate || ue.audioSamplingRate),
                        Rl(P),
                        P.drmInfos.length && e.h.newDrmInfo(P),
                        (xe = !1),
                        ((!x && P.closedCaptions) ||
                          (x && P.closedCaptions && x.size != P.closedCaptions.size)) &&
                          (xe = !0),
                        e.m && xe && e.h.makeTextStreamsForClosedCaptions(e.m),
                        a == ne.Na &&
                          (Se = $r(ue.segmentIndex)) &&
                          Se.ea &&
                          ((P.mimeType = "application/mp4"), Rl(P)),
                        (Ye = Fh(P)),
                        P.segmentIndex.Fb(function (dt) {
                          dt.ea && (dt.ea.xd = Ye);
                        }),
                        xB(e) &&
                          (e.zc
                            ? ev(e, [G])
                            : ((e.zc = !0),
                              (be = Array.from(e.i.values())),
                              (xt = be.filter(function (dt) {
                                return dt.stream.segmentIndex;
                              })),
                              ev(e, xt),
                              Wf(e),
                              (qe = e.o),
                              qe > 0 && e.F.ka(qe))),
                        nv(e, ie.ha, P.type, re, M),
                        e.m && (e.m.startTime = e.u),
                        he(rt, 0));
                      break;
                    case 2:
                      if (((Ct = ae(rt)), P.closeSegmentIndex(), Ct.code === 7001)) return rt.return();
                      if (((lt = e.h.disableStream(P)), !lt)) throw Ct;
                      K(rt);
                  }
                });
              }
              function M() {
                return e.j && r.length > 1 ? Cc(e.j, t) : G.Df.concat(uR([e.H], r, e.B));
              }
              var P = CR(e, s, a, c, f, g, m, x, E, A, R, b);
              r.some(function (Q) {
                return Q.startsWith("shaka://hls-muxed");
              }) && ((P.isAudioMuxedInVideo = !0), (P.mimeType = "video/mp2t"), Rl(P));
              var G = {
                  stream: P,
                  type: a,
                  Df: [],
                  Wc: 0,
                  Mc: 0,
                  rf: new Map(),
                  Ve: !1,
                  Ue: !1,
                  be: !1,
                  sg: -1,
                  Qb: -1,
                  Rb: -1,
                  P: M,
                },
                U = null,
                H;
              return (
                (P.createSegmentIndex = function () {
                  return (
                    U ||
                    (P.isAudioMuxedInVideo
                      ? ((P.segmentIndex = new mt([])), Promise.resolve())
                      : ((H = rv(e, G.P(), !0)),
                        (U = new Promise(function (Q) {
                          Q(D(H));
                        }))))
                  );
                }),
                (P.closeSegmentIndex = function () {
                  (U && !P.segmentIndex && H.abort(),
                    P.segmentIndex && (P.segmentIndex.release(), (P.segmentIndex = null)),
                    (U = null));
                }),
                G
              );
            }
            function AR(e) {
              var t = 1 / 0;
              e = I(e.i.values());
              for (var r = e.next(); !r.done; r = e.next())
                ((r = r.value),
                  r.stream.segmentIndex &&
                    r.stream.type != "text" &&
                    !r.stream.isAudioMuxedInVideo &&
                    (t = Math.min(t, r.Mc)));
              return t;
            }
            function IR(e, t) {
              var r = [];
              t = I(t);
              for (var s = t.next(); !s.done; s = t.next())
                ((s = s.value),
                  s.segmentIndex &&
                    s.segmentIndex.Fb(function (a) {
                      r.push(a);
                    }));
              e.l.me(r);
            }
            function ev(e, t) {
              if (!ii(e))
                for (var r = AR(e), s = I(t), a = s.next(); !a.done; a = s.next())
                  a.value.stream.segmentIndex.pd(0, r);
              (IR(
                e,
                t.map(function (c) {
                  return c.stream;
                }),
              ),
                (s = Array.from(e.i.values()).filter(function (c) {
                  return c.stream.segmentIndex;
                })),
                (r = s.some(function (c) {
                  return c.stream.type == "audio";
                })),
                (a = s.some(function (c) {
                  return c.stream.type == "video";
                })),
                (s = ii(e) && !e.kb),
                (r = !ii(e) && e.kb && !(r && a)),
                e.g.hls.ignoreManifestProgramDateTime || s || r
                  ? yR(e, t, s)
                  : (JU(e, t), e.g.hls.ignoreManifestProgramDateTimeForTypes.length > 0 && yR(e, t)));
            }
            function Mc(e, t) {
              return e.g.hls.ignoreManifestProgramDateTime
                ? !0
                : e.g.hls.ignoreManifestProgramDateTimeForTypes.includes(t);
            }
            function xB(e) {
              if (!e.m) return !1;
              var t = [],
                r = [];
              e = I(e.m.variants);
              for (var s = e.next(); !s.done; s = e.next())
                ((s = s.value), s.video && t.push(s.video), s.audio && r.push(s.audio));
              return !(
                (t.length > 0 &&
                  !t.some(function (a) {
                    return a.segmentIndex;
                  })) ||
                (r.length > 0 &&
                  !r.some(function (a) {
                    return a.segmentIndex;
                  }))
              );
            }
            function wR(e, t, r, s, a, c, f, g, m, x, E, A, R, b, D, M, P, G, U) {
              ((G = G === void 0 ? !0 : G), (U = U === void 0 ? !0 : U));
              var H,
                Q,
                ne,
                z,
                J,
                X,
                ie,
                Z,
                re,
                se,
                me,
                fe,
                le,
                ue,
                xe,
                Se,
                Ye,
                be,
                xt,
                qe,
                Ct,
                lt,
                rt,
                dt,
                yt,
                ht,
                st,
                ut,
                An;
              return W(function (mn) {
                switch (mn.g) {
                  case 1:
                    if (
                      ((H = s.segments || []),
                      (Q = H.every(function (Zi) {
                        return !!_n(Zi.ha, "EXT-X-GAP");
                      })),
                      !H.length || Q)
                    )
                      throw new ee(2, 4, 4053);
                    if (
                      (TB(e, s),
                      ii(e) && tv(e, s),
                      (ne = ii(e) ? e.C.get(f) : new Map()),
                      (z = PR(e, s, ne, r, a, f)),
                      (J = z.segments),
                      (X = z.bandwidth),
                      (me = se = re = Z = ie = null),
                      !(J.length > 0 && G))
                    ) {
                      mn.A(2);
                      break;
                    }
                    return _(mn, eB(e, J), 3);
                  case 3:
                    ((fe = mn.h),
                      f != fe.type && ii(e) && (e.C.set(fe.type, e.C.get(f)), e.C.set(f, new Map())),
                      (f = fe.type),
                      (g = fe.language),
                      (E = fe.channelCount),
                      (D = fe.sampleRate),
                      e.g.disableText || (A = fe.closedCaptions),
                      (Z = fe.height),
                      (ie = fe.width),
                      (re = fe.ze),
                      (se = fe.colorGamut),
                      (me = fe.frameRate),
                      U && ((P = fe.mimeType), (c = fe.codecs)));
                  case 2:
                    if (P) {
                      mn.A(4);
                      break;
                    }
                    return _(mn, AB(e, f, c, J), 5);
                  case 5:
                    ((P = mn.h),
                      f != nt || c || P != "application/mp4" || !J[0] || J[0].ea || (P = "text/vtt"));
                  case 4:
                    return _(mn, LR(e, s, P, a, r), 6);
                  case 6:
                    if (
                      ((le = mn.h),
                      (ue = le.drmInfos),
                      (xe = le.keyIds),
                      (Se = le.encrypted),
                      (Ye = le.Qh),
                      Se && !ue.length && !Ye)
                    )
                      throw new ee(2, 4, 4026);
                    return (
                      (be = CR(e, c, f, g, m, x, E, A, R, b, D, M)),
                      (be.encrypted = Se && !Ye),
                      (be.drmInfos = ue),
                      (be.keyIds = xe),
                      (be.mimeType = P),
                      X && (be.bandwidth = X),
                      Rl(be),
                      f == "video" && (ie || Z || re || se) && NR(be, ie, Z, me, re, null, se),
                      ii(e) && tv(e, s),
                      (xt = J[0].startTime),
                      (qe = J[J.length - 1]),
                      (Ct = qe.endTime),
                      (lt = new mt(J)),
                      (be.segmentIndex = lt),
                      (dt = (rt = _n(s.ha, "EXT-X-SERVER-CONTROL")) ? Il(rt, "CAN-SKIP-UNTIL") != null : !1),
                      (yt = rt ? Il(rt, "CAN-BLOCK-RELOAD") != null : !1),
                      (ht = wl(s.ha, "EXT-X-MEDIA-SEQUENCE", 0)),
                      (st = RR(ht, J)),
                      (ut = st.Qb),
                      (An = st.Rb),
                      mn.return({
                        stream: be,
                        type: f,
                        Df: [],
                        P: a,
                        Wc: xt,
                        Mc: Ct,
                        Ve: dt,
                        Ue: yt,
                        be: !1,
                        sg: -1,
                        Qb: ut,
                        Rb: An,
                        rf: ne,
                      })
                    );
                }
              });
            }
            function RR(e, t) {
              e = e + t.length - 1;
              var r = -1;
              if (!t.length) return (e++, { Qb: e, Rb: r });
              t = t[t.length - 1];
              var s = t.g;
              return t.g.length
                ? ((r = s.length - 1), s[s.length - 1].isPreload() || (e++, (r = 0)), { Qb: e, Rb: r })
                : (e++, t.o && (r = 0), { Qb: e, Rb: r });
            }
            function CR(e, t, r, s, a, c, f, g, m, x, E, A) {
              var R = iv(r, t) || Yf(r),
                b = [];
              if (m) {
                m = I(m.split(","));
                for (var D = m.next(); !D.done; D = m.next()) b.push(D.value);
              }
              return (
                (D = void 0),
                (m = null),
                r == nt
                  ? (D =
                      b.includes("public.accessibility.transcribes-spoken-dialog") &&
                      b.includes("public.accessibility.describes-music-and-sound")
                        ? "caption"
                        : "subtitle")
                  : b.includes("public.accessibility.describes-video") && (m = "visually impaired"),
                b.length || D !== "subtitle" || b.push("subtitle"),
                (D = null),
                r != "video" && (D = c),
                (e = {
                  id: e.G++,
                  originalId: c,
                  groupId: null,
                  createSegmentIndex: function () {
                    return Promise.resolve();
                  },
                  segmentIndex: null,
                  mimeType: R,
                  codecs: t,
                  kind: r == nt ? "subtitle" : void 0,
                  encrypted: !1,
                  drmInfos: [],
                  keyIds: new Set(),
                  language: At(s || "und"),
                  originalLanguage: s,
                  label: D,
                  type: r,
                  primary: a,
                  trickModeVideo: null,
                  dependencyStream: null,
                  emsgSchemeIdUris: null,
                  frameRate: void 0,
                  pixelAspectRatio: void 0,
                  width: void 0,
                  height: void 0,
                  bandwidth: void 0,
                  roles: b,
                  forced: x,
                  channelsCount: f,
                  audioSamplingRate: E,
                  spatialAudio: A,
                  closedCaptions: g,
                  hdr: void 0,
                  colorGamut: void 0,
                  videoLayout: void 0,
                  tilesLayout: void 0,
                  accessibilityPurpose: m,
                  external: !1,
                  fastSwitching: !1,
                  fullMimeTypes: new Set(),
                  isAudioMuxedInVideo: !1,
                  baseOriginalId: null,
                }),
                Rl(e),
                e
              );
            }
            function LR(e, t, r, s, a) {
              var c,
                f,
                g,
                m,
                x,
                E,
                A,
                R,
                b,
                D,
                M,
                P,
                G,
                U,
                H,
                Q,
                ne,
                z,
                J,
                X,
                ie,
                Z,
                re,
                se,
                me,
                fe,
                le,
                ue,
                xe;
              return W(function (Se) {
                switch (Se.g) {
                  case 1:
                    if (((c = new Map()), !e.g.ignoreDrmInfo && t.segments)) {
                      for (f = I(t.segments), g = f.next(); !g.done; g = f.next())
                        if (((m = g.value), (x = dr(m.ha, "EXT-X-KEY")), (E = null), x.length))
                          for (E = kR(e, t, m.ha, s, a), A = I(x), R = A.next(); !R.done; R = A.next())
                            ((b = R.value), c.set(b, E));
                    }
                    ((M = D = !1), (P = []), (G = new Set()), (U = I(c)), (H = U.next()));
                  case 2:
                    if (H.done) {
                      Se.A(4);
                      break;
                    }
                    if (
                      ((Q = H.value),
                      (ne = I(Q)),
                      (z = ne.next().value),
                      (J = ne.next().value),
                      (X = z),
                      (ie = J),
                      (Z = Dt(X, "METHOD")),
                      Z == "NONE")
                    ) {
                      Se.A(3);
                      break;
                    }
                    if (((D = !0), (re = Pe(X, "KEYFORMAT") || "identity"), (se = null), qf(Z))) {
                      ((M = !0), Se.A(3));
                      break;
                    }
                    if (re == "identity") return _(Se, UR(e, X, r, s, ie, a), 11);
                    if (((me = e.dc.get(re)), !me)) {
                      ((fe = null), Se.A(9));
                      break;
                    }
                    return _(Se, me(X, r, ie), 10);
                  case 10:
                    fe = Se.h;
                  case 9:
                    ((se = fe), Se.A(6));
                    break;
                  case 11:
                    se = Se.h;
                  case 6:
                    if (se) {
                      if (se.keyIds)
                        for (le = I(se.keyIds), ue = le.next(); !ue.done; ue = le.next())
                          ((xe = ue.value), G.add(xe));
                      P.push(se);
                    }
                  case 3:
                    ((H = U.next()), Se.A(2));
                    break;
                  case 4:
                    return Se.return({ drmInfos: P, keyIds: G, encrypted: D, Qh: M });
                }
              });
            }
            function _R(e, t, r, s, a) {
              if (!l.crypto || !l.crypto.subtle)
                throw (
                  He(
                    "Web Crypto API is not available to decrypt AES. (Web Crypto only exists in secure origins like https)",
                  ),
                  new ee(2, 4, 4042)
                );
              var c = 0,
                f = Pe(t, "IV", "");
              if (f) {
                var g = Go(f.substr(2));
                if (g.byteLength != 16) throw new ee(2, 4, 4048);
              } else c = wl(r.ha, "EXT-X-MEDIA-SEQUENCE", 0);
              var m = Eo(s(), Dt(t, "URI"), a),
                x = m.sort().join("");
              if (((r = t.toString() + "-" + c + "-" + x), !e.va.has(r))) {
                var E = { bitsKey: 128, blockCipherMode: "CBC", iv: g, firstMediaSequenceNumber: c };
                switch (Dt(t, "METHOD")) {
                  case "AES-256":
                    E.bitsKey = 256;
                    break;
                  case "AES-256-CTR":
                    ((E.bitsKey = 256), (E.blockCipherMode = "CTR"));
                }
                ((E.fetchKey = function () {
                  var A, R, b, D;
                  return W(function (M) {
                    if (M.g == 1)
                      return (
                        e.O.has(x) ||
                          ((A = fn(m, e.g.retryParameters)), (R = Fs(e, A, 6).promise), e.O.set(x, R)),
                        _(M, e.O.get(x), 2)
                      );
                    if (M.g != 3) {
                      if (((b = M.h), !b.data || b.data.byteLength != E.bitsKey / 8))
                        throw new ee(2, 4, 4049);
                      return (
                        (D = { name: E.blockCipherMode == "CTR" ? "AES-CTR" : "AES-CBC", length: E.bitsKey }),
                        _(M, l.crypto.subtle.importKey("raw", b.data, D, !0, ["decrypt"]), 3)
                      );
                    }
                    ((E.cryptoKey = M.h), (E.fetchKey = void 0), K(M));
                  });
                }),
                  e.va.set(r, E));
              }
              return e.va.get(r);
            }
            function bR(e, t) {
              e.u == null && (t = _n(t.ha, "EXT-X-START")) && (e.u = Number(Dt(t, "TIME-OFFSET")));
            }
            function TB(e, t) {
              var r = _n(t.ha, "EXT-X-PLAYLIST-TYPE");
              ((t = _n(t.ha, "EXT-X-ENDLIST")),
                (t = (r && r.value == "VOD") || t),
                (r = r && r.value == "EVENT" && !t),
                (r = !t && !r),
                t ? Xf(e, Jf) : r ? Xf(e, ov) : Xf(e, _B));
            }
            function tv(e, t) {
              var r = 1 / 0,
                s = t.segments;
              if (s.length)
                for (var a = s.length - 1; a >= 0; ) {
                  var c = _n(s[a].ha, "EXTINF");
                  if (c) {
                    r = Number(c.value.split(",")[0]);
                    break;
                  }
                  a--;
                }
              if (((s = _n(t.ha, "EXT-X-TARGETDURATION")), !s))
                throw new ee(2, 4, 4024, "EXT-X-TARGETDURATION");
              ((s = Number(s.value)),
                (a = _n(t.ha, "EXT-X-PART-INF")) && (e.T = Number(Dt(a, "PART-TARGET"))),
                (t = _n(t.ha, "EXT-X-SERVER-CONTROL")),
                e.oa && e.T
                  ? ((e.o = e.yc
                      ? e.T * 5 <= r
                        ? Math.min(e.T, e.o)
                        : Math.min(r, e.o)
                      : Math.min(e.T, e.o)),
                    (e.Ua = t ? Number(Dt(t, "PART-HOLD-BACK")) : 0))
                  : ((e.o = Math.min(r, e.o)),
                    (r = t ? Il(t, "HOLD-BACK") : null),
                    (e.Ta = r ? Number(r.value) : 0)),
                (e.eb = Math.max(s, e.eb)));
            }
            function DR(e, t) {
              var r = 0;
              if (e.g.defaultPresentationDelay) r = e.g.defaultPresentationDelay;
              else if (e.Ua) r = e.Ua;
              else if (e.Ta) r = e.Ta;
              else
                for (var s = t.segments.length, a = s - Math.min(s, e.g.hls.liveSegmentsDelay); a < s; a++) {
                  var c = _n(t.segments[a].ha, "EXTINF");
                  r = c ? r + Number(c.value.split(",")[0]) : r + e.eb;
                }
              (e.u && e.u < 0 && ((r = Math.min(-e.u, r)), (e.u += r)), e.l.Wi(0), e.l.rh(r), e.l.cd(!1));
            }
            function kR(e, t, r, s, a) {
              var c = _n(r, "EXT-X-MAP");
              if (!c) return null;
              var f = Dt(c, "URI"),
                g = Eo(s(), f, a);
              if (((f = [g.toString(), Pe(c, "BYTERANGE", "")].join("-")), !e.Da.has(f))) {
                var m = void 0,
                  x = null,
                  E = !1;
                r = I(r);
                for (var A = r.next(); !A.done; A = r.next())
                  ((A = A.value),
                    A.name == "EXT-X-KEY"
                      ? ((E = Dt(A, "METHOD")),
                        qf(E) && A.id < c.id ? ((E = !1), (m = _R(e, A, t, s, a))) : (E = E != "NONE"))
                      : A.name == "EXT-X-BYTERANGE" && A.id < c.id && (x = A));
                ((t = SB(g, c, x, m, E)), e.Da.set(f, t));
              }
              return e.Da.get(f);
            }
            function SB(e, t, r, s, a) {
              var c = 0,
                f = null;
              return (
                (t = Pe(t, "BYTERANGE")),
                !t && r && (t = r.value),
                t &&
                  ((c = t.split("@")),
                  (f = Number(c[0])),
                  (c = Number(c[1])),
                  (f = c + f - 1),
                  s && ((r = f + 1 - c), r % 16 && (f += 16 - (r % 16)))),
                new Ai(
                  function () {
                    return e;
                  },
                  c,
                  f,
                  null,
                  null,
                  null,
                  s,
                  a,
                )
              );
            }
            function EB(e, t, r, s, a, c, f, g, m, x) {
              var E = s.ha,
                A = _n(E, "EXTINF"),
                R = 0,
                b = 0,
                D = null;
              s.wc.length && (e.m.isLowLatency = !0);
              var M = null;
              if (!e.g.hls.ignoreManifestProgramDateTime) {
                var P = _n(E, "EXT-X-PROGRAM-DATE-TIME");
                P && P.value && ((M = vs(P.value)), (e.kb = !0));
              }
              var G = Rs;
              if ((_n(E, "EXT-X-GAP") && (e.m.gapCount++, (G = 2)), !A)) {
                if (s.wc.length == 0) throw new ee(2, 4, 4024, "EXTINF");
                if (!e.oa) return null;
              }
              var U = [];
              P = !1;
              var H = null,
                Q = !1,
                ne = !1;
              if (e.oa && s.wc.length) {
                R = t && l.ReadableStream && e.g.hls.allowLowLatencyByteRangeOptimization;
                for (var z = M, J = {}, X = 0; X < s.wc.length; J = { Uf: void 0, pe: void 0 }, X++) {
                  var ie = s.wc[X],
                    Z = X == 0 ? r : U[U.length - 1],
                    re = X == 0 ? a : Z.endTime,
                    se = Number(Pe(ie, "DURATION")) || e.T;
                  if (se) {
                    var me = re + se,
                      fe = 0,
                      le = null;
                    if (
                      (ie.name == "EXT-X-PRELOAD-HINT"
                        ? ((fe = (fe = Pe(ie, "BYTERANGE-START")) ? Number(fe) : 0),
                          (Z = Pe(ie, "BYTERANGE-LENGTH"))
                            ? (le = fe + Number(Z) - 1)
                            : fe && (le = Number.MAX_SAFE_INTEGER))
                        : ((fe = Pe(ie, "BYTERANGE")),
                          (le = I(MR(Z, fe))),
                          (fe = le.next().value),
                          (le = le.next().value)),
                      (J.pe = Pe(ie, "URI")),
                      J.pe)
                    ) {
                      ((Z = Rs),
                        Pe(ie, "GAP") == "YES" && (e.m.gapCount++, (Z = 2), (Q = !0)),
                        (J.Uf = null));
                      var ue = (function (Se) {
                        return function () {
                          return (Se.Uf == null && (Se.Uf = Eo(g(), Se.pe, c)), Se.Uf);
                        };
                      })(J);
                      (R && fe >= 0 && le != null && ((H = ue), (P = !0)),
                        (re = new Be(re, me, ue, fe, le, t, 0, 0, 1 / 0, [], "", null, z, Z, x)),
                        ie.name == "EXT-X-PRELOAD-HINT" && (re.Ug(), (ne = !0)),
                        Pe(ie, "INDEPENDENT") != "YES" && X > 0 && re.wd(),
                        (ie = m),
                        ie ||
                          (U.length && U[0].mimeType
                            ? (ie = U[0].mimeType)
                            : J.pe && ((J = sl(J.pe)), (ie = Qf.get(f).get(J) || null))),
                        ie && ((re.mimeType = ie), $R.has(ie) && (re.ea = null)),
                        U.push(re),
                        z && (z += se));
                    }
                  }
                }
              }
              if (A) {
                if (((A = Number(A.value.split(",")[0])), A == 0)) return null;
                R = a + A;
              } else if (U.length) R = U[U.length - 1].endTime;
              else return null;
              (P && (Q || U[0].startByte != 0 ? ((P = !1), (H = null)) : (U = [])),
                (A = _n(E, "EXT-X-BYTERANGE"))
                  ? ((D = I(MR(r, A.value))), (b = D.next().value), (D = D.next().value))
                  : U.length && ((b = U[0].startByte), (D = U[U.length - 1].endByte)),
                (r = ""),
                (A = null),
                f == "image" &&
                  ((r = "1x1"), (f = _n(E, "EXT-X-TILES"))) &&
                  ((r = Dt(f, "LAYOUT")), (f = Pe(f, "DURATION")) && (A = Number(f))));
              var xe = null;
              return (
                (t = new Be(
                  a,
                  R,
                  function () {
                    return H ? H() : (xe == null && (xe = Eo(g(), s.g, c)), xe || []);
                  },
                  b,
                  D,
                  t,
                  0,
                  0,
                  1 / 0,
                  U,
                  r,
                  A,
                  M,
                  G,
                  x,
                  U.length > 0 && !!s.g,
                )),
                m && ((t.mimeType = m), $R.has(m) && (t.ea = null)),
                P && ((e.yc = !0), t.xi(), ne && t.Ug()),
                t
              );
            }
            function MR(e, t) {
              var r = 0,
                s = null;
              return (
                t &&
                  ((r = t.split("@")),
                  (t = Number(r[0])),
                  (r = r[1] ? Number(r[1]) : e.endByte + 1),
                  (s = r + t - 1)),
                [r, s]
              );
            }
            function nv(e, t, r, s, a) {
              if (r == "video" || r == "audio") {
                var c = e.l.m;
                if (c && !Mc(e, r))
                  for (
                    t = dr(t, "EXT-X-DATERANGE"),
                      t = t
                        .filter(function (Z) {
                          return Il(Z, "START-DATE") != null;
                        })
                        .sort(function (Z, re) {
                          return (
                            (Z = Dt(Z, "START-DATE")),
                            (re = Dt(re, "START-DATE")),
                            Z < re ? -1 : Z > re ? 1 : 0
                          );
                        }),
                      r = 0;
                    r < t.length;
                    r++
                  ) {
                    var f = t[r];
                    try {
                      var g = Dt(f, "START-DATE"),
                        m = vs(g);
                      if (!isNaN(m)) {
                        var x = Math.max(0, m - c),
                          E = null,
                          A = Pe(f, "END-DATE");
                        if (A) {
                          var R = vs(A);
                          if (!isNaN(R) && ((E = R - c), E < 0)) continue;
                        }
                        if (E == null) {
                          var b = Pe(f, "DURATION") || Pe(f, "PLANNED-DURATION");
                          if (b) {
                            var D = parseFloat(b);
                            if ((isNaN(D) || (E = x + D), m - c + D < 0)) continue;
                          }
                        }
                        var M = Pe(f, "CLASS") || "com.apple.quicktime.HLS",
                          P = Pe(f, "END-ON-NEXT") == "YES";
                        if (E == null && P) {
                          for (var G = r + 1; G < t.length; G++) {
                            var U = Pe(t[G], "CLASS") || "com.apple.quicktime.HLS";
                            if (M == U) {
                              var H = Dt(t[G], "START-DATE"),
                                Q = vs(H);
                              if (!isNaN(Q) && Q && Q > m) {
                                E = Math.max(0, Q - c);
                                break;
                              }
                            }
                          }
                          if (E == null) continue;
                        }
                        G = ["CLASS", "START-DATE", "END-DATE", "DURATION", "END-ON-NEXT"];
                        for (var ne = [], z = I(f.attributes), J = z.next(); !J.done; J = z.next()) {
                          var X = J.value;
                          if (!G.includes(X.name)) {
                            var ie = cR(X.value, s);
                            ((X.name == "X-ASSET-URI" || X.name == "X-ASSET-LIST") &&
                              (ie = Eo(a(), X.value, s)[0]),
                              ne.push({
                                key: X.name,
                                description: "",
                                data: ie,
                                mimeType: null,
                                pictureType: null,
                              }));
                          }
                        }
                        ne.length > 1 && e.h.onMetadata(M, x, E, ne);
                      }
                    } catch (Z) {}
                  }
              }
            }
            function PR(e, t, r, s, a, c) {
              function f(Z) {
                if (((Z = sl(Z)), !Z)) return null;
                var re = Qf.get(c).get(Z);
                return (re || (re = sv.get(Z)), re);
              }
              var g = t.segments,
                m = null,
                x = null,
                E = null,
                A = null,
                R = void 0,
                b = wl(t.ha, "EXT-X-DISCONTINUITY-SEQUENCE", -1),
                D = wl(t.ha, "EXT-X-MEDIA-SEQUENCE", 0),
                M = _n(t.ha, "EXT-X-SKIP"),
                P = M ? Number(Pe(M, "SKIPPED-SEGMENTS")) : 0,
                G = D + P,
                U = 0;
              (ii(e) && r.has(G) && (U = r.get(G)),
                U === 0 && e.Fa == ov && r.size > 0 && !r.has(G) && e.l.i != null && (U = e.l.Hb()));
              var H = [],
                Q = null;
              M = [];
              for (var ne = 0; ne < g.length; ne++) {
                var z = g[ne];
                ((G = _n(z.ha, "EXT-X-MAP")) && G.id !== x && ((m = kR(e, t, z.ha, a, s)), (x = G.id)),
                  (G = z.g));
                var J = "";
                (G && (J = sl(G)),
                  J !== A && ((E = f(G)), (A = J)),
                  (J = ne == 0 ? U : Q.endTime),
                  (G = D + P + ne),
                  _n(z.ha, "EXT-X-DISCONTINUITY") && (b++, Q && Q.ea && (Q.ea.g = J)));
                for (var X = I(z.ha), ie = X.next(); !ie.done; ie = X.next())
                  ((ie = ie.value),
                    ie.name == "EXT-X-KEY" &&
                      (qf(Dt(ie, "METHOD")) ? (R = _R(e, ie, t, a, s)) : (R = void 0)));
                if ((r.set(G, J), (J = EB(e, m, Q, z, J, s, c, a, E, R)))) {
                  if (
                    ((Q = wl(z.ha, "EXT-X-BITRATE"))
                      ? (M.push({ bitrate: Q, duration: J.endTime - J.startTime }), (J.bandwidth = Q))
                      : J.endByte
                        ? (z = Wm(J)) &&
                          ((Q = J.endTime - J.startTime),
                          (z = (z * 8) / Q / 1e3),
                          M.push({ bitrate: z, duration: Q }),
                          (J.bandwidth = z))
                        : M.length &&
                          ((Q = M.pop()),
                          (Q.duration += J.endTime - J.startTime),
                          M.push(Q),
                          (J.bandwidth = Q.bitrate)),
                    J.bandwidth)
                  )
                    for (Q = I(J.g), z = Q.next(); !z.done; z = Q.next()) z.value.bandwidth = J.bandwidth;
                  ((Q = J), (J.i = b), (Mc(e, c) && e.N != null && G < e.N) || H.push(J));
                }
              }
              if (
                ((t = void 0),
                M.length &&
                  ((t = M.reduce(function (Z, re) {
                    return Z + re.duration;
                  }, 0)),
                  (t = Math.round(
                    (M.reduce(function (Z, re) {
                      return Z + re.bitrate * re.duration;
                    }, 0) /
                      t) *
                      1e3,
                  ))),
                (M = H.some(function (Z) {
                  return Z.h != null;
                })))
              ) {
                for (
                  r = {}, s = 0;
                  s < H.length;
                  r = { Ze: void 0, Ye: void 0, Re: void 0, Zc: void 0, Qe: void 0 }, s++
                )
                  if (((r.Zc = H[s]), r.Zc.h == null))
                    for (
                      r.Ye = 0,
                        r.Ze = s,
                        a = (function (Z) {
                          return function () {
                            var re = H[Z.Ze];
                            if (re) {
                              if (re.h != null) return re.h + Z.Ye;
                              ((Z.Ye -= re.endTime - re.startTime), (Z.Ze += 1));
                            }
                            return null;
                          };
                        })(r),
                        r.Qe = 0,
                        r.Re = s,
                        g = (function (Z) {
                          return function () {
                            var re = H[Z.Re];
                            if (re) {
                              if ((re != Z.Zc && (Z.Qe += re.endTime - re.startTime), re.h != null))
                                return re.h + Z.Qe;
                              --Z.Re;
                            }
                            return null;
                          };
                        })(r);
                      r.Zc.h == null;
                    )
                      ((r.Zc.h = g()), r.Zc.h == null && (r.Zc.h = a()));
              }
              if (M)
                for (r = I(H), s = r.next(); !s.done; s = r.next())
                  for (a = s.value, s = a.h, a = I(a.g), g = a.next(); !g.done; g = a.next())
                    ((g = g.value), (g.h = s), (s += g.endTime - g.startTime));
              if (((r = e.ma), M && r != 1 / 0 && !Mc(e, c)))
                for (e = I(H), M = e.next(); !M.done; M = e.next()) M.value.Dh(r);
              return { segments: H, bandwidth: t };
            }
            function iv(e, t) {
              if (e == nt) {
                if (t == "vtt" || t == "wvtt") return "text/vtt";
                if (t && t !== "") return "application/mp4";
              }
              return e != "image" || (t && t != "jpeg")
                ? e == "audio" && t == "mp4a.40.34"
                  ? "audio/mpeg"
                  : t == "mjpg"
                    ? "application/mp4"
                    : null
                : "image/jpeg";
            }
            function Yf(e) {
              return e == nt ? "text/vtt" : Qf.get(e).get("mp4");
            }
            function OR(e, t) {
              e = ii(e) ? Math.trunc((t.length - 1) / 2) : 0;
              for (var r = t[e]; r.Kc() == 2 && e + 1 < t.length; ) (e++, (r = t[e]));
              return { segment: r, segmentIndex: e };
            }
            function AB(e, t, r, s) {
              var a, c, f, g, m, x, E, A, R, b, D, M, P;
              return W(function (G) {
                switch (G.g) {
                  case 1:
                    return (
                      (a = or),
                      (c = OR(e, s)),
                      (f = c.segment),
                      f.status == 2
                        ? G.return(Yf(t))
                        : ((m = f.P()),
                          (x = sl(m[0])) && ((E = Qf.get(t)), (A = E.get(x)) || (A = sv.get(x)))
                            ? G.return(A)
                            : (g = iv(t, r))
                              ? G.return(g)
                              : ((b = 1),
                                (D = fn(m, e.g.retryParameters)),
                                q(G, 2),
                                (D.method = "HEAD"),
                                _(G, Fs(e, D, a, { type: b }).promise, 4)))
                    );
                  case 4:
                    ((M = G.h), (R = M.headers["content-type"]), he(G, 3));
                    break;
                  case 2:
                    if (((P = ae(G)), !P || (P.code != 1002 && P.code != 1001))) {
                      G.A(3);
                      break;
                    }
                    return (
                      (D.method = "GET"),
                      e.g.hls.allowRangeRequestsToGuessMimeType && (D.headers.Range = "bytes=0-0"),
                      _(G, Fs(e, D, a, { type: b }).promise, 6)
                    );
                  case 6:
                    ((M = G.h), (R = M.headers["content-type"]));
                  case 3:
                    if (!R) {
                      G.A(7);
                      break;
                    }
                    if (((g = R.toLowerCase().split(";")[0]), g != "application/octet-stream")) {
                      G.A(8);
                      break;
                    }
                    if (M.data.byteLength) {
                      G.A(9);
                      break;
                    }
                    return ((D.method = "GET"), _(G, Fs(e, D, a, { type: b }).promise, 10));
                  case 10:
                    M = G.h;
                  case 9:
                    Za(We(M.data)) && (g = "video/mp2t");
                  case 8:
                    if (g != "application/octet-stream") return G.return(g);
                  case 7:
                    return G.return(Yf(t));
                }
              });
            }
            function NR(e, t, r, s, a, c, f) {
              e &&
                ((e.width = Number(t) || void 0),
                (e.height = Number(r) || void 0),
                (e.frameRate = Number(s) || void 0),
                (e.hdr = a || void 0),
                (e.videoLayout = c || void 0),
                (e.colorGamut = f || void 0));
            }
            function rv(e, t, r) {
              return Fs(e, fn(t, e.g.retryParameters), 0, { type: r ? 2 : 3 });
            }
            function FR(e) {
              var t, r, s, a, c, f;
              return W(function (g) {
                switch (g.g) {
                  case 1:
                    return e.h ? (q(g, 2), (t = Date.now()), _(g, e.update(), 4)) : g.return();
                  case 4:
                    ((r = Date.now()),
                      ii(e) &&
                        ((s = (r - t) / 1e3),
                        e.ac.sample(1, s),
                        (a = e.g.updatePeriod > 0 ? e.g.updatePeriod : e.o),
                        (c = Math.max(0, a - ai(e.ac))),
                        e.F.ka(c)),
                      he(g, 3));
                    break;
                  case 2:
                    if (((f = ae(g)), !e.h)) return g.return();
                    if (e.g.raiseFatalErrorOnManifestUpdateRequestFailure)
                      return (e.h.onError(f), g.return());
                    ((f.severity = 1), e.h.onError(f), e.F.ka(0.1));
                  case 3:
                    if (!e.h) return g.return();
                    (e.h.onManifestUpdated(), K(g));
                }
              });
            }
            function ii(e) {
              return e.Fa != Jf;
            }
            function Xf(e, t) {
              ((e.Fa = t), e.l && e.l.cd(!ii(e)), ii(e) || e.F.stop());
            }
            function Fs(e, t, r, s) {
              if (!e.$) throw new ee(2, 7, 7001);
              return (
                s || (s = {}),
                (s.isPreload = e.cc()),
                (t = e.h.networkingEngine.request(r, t, s)),
                Jo(e.$, t),
                t
              );
            }
            function qf(e) {
              return e == "AES-128" || e == "AES-256" || e == "AES-256-CTR";
            }
            function IB(e, t, r, s) {
              var a, c, f, g, m, x;
              return W(function (E) {
                if (E.g == 1) {
                  if (r == "video/mp2t") throw new ee(2, 4, 4040);
                  if (l.shakaMediaKeysPolyfill === "apple") throw new ee(2, 4, 4041);
                  if (((a = Dt(t, "METHOD")), (c = ["SAMPLE-AES", "SAMPLE-AES-CTR"]), !c.includes(a)))
                    return E.return(null);
                  ((f = "cenc"),
                    a == "SAMPLE-AES" && (f = "cbcs"),
                    (g = Dt(t, "URI")),
                    (m = ms("com.apple.fps", f, null, g)));
                  var A = new un(g).Db.replace(/-/g, "").toLowerCase();
                  return (x = A.length === 32 && /^[0-9a-f]+$/.test(A) ? A : null) || !s
                    ? E.A(2)
                    : _(E, BR(e, s), 3);
                }
                return (E.g != 2 && (x = E.h), x && m.keyIds.add(x), E.return(m));
              });
            }
            function UR(e, t, r, s, a, c) {
              var f, g, m, x, E, A, R, b, D, M, P, G;
              return W(function (U) {
                switch (U.g) {
                  case 1:
                    if (r == "video/mp2t") throw new ee(2, 4, 4040);
                    if (l.shakaMediaKeysPolyfill === "apple") throw new ee(2, 4, 4041);
                    if (((f = Dt(t, "METHOD")), (g = ["SAMPLE-AES", "SAMPLE-AES-CTR"]), !g.includes(f)))
                      return U.return(null);
                    if (((m = Eo(s(), Dt(t, "URI"), c)), m[0].startsWith("data:text/plain;base64,"))) {
                      ((x = gs(rr(m[0].split("data:text/plain;base64,").pop()))), U.A(2));
                      break;
                    }
                    return (
                      (E = m.sort().join("")),
                      e.ya.has(E) ||
                        ((A = fn(m, e.g.retryParameters)), (R = Fs(e, A, 6).promise), e.ya.set(E, R)),
                      _(U, e.ya.get(E), 3)
                    );
                  case 3:
                    ((b = U.h), (x = gs(b.data)));
                  case 2:
                    if (((D = "00000000000000000000000000000000"), !a)) {
                      U.A(4);
                      break;
                    }
                    return _(U, BR(e, a), 5);
                  case 5:
                    (M = U.h) && (D = M);
                  case 4:
                    return (
                      (P = new Map()),
                      P.set(D, x),
                      (G = "cenc"),
                      f == "SAMPLE-AES" && (G = "cbcs"),
                      U.return(US(P, G))
                    );
                }
              });
            }
            function BR(e, t) {
              var r, s, a, c;
              return W(function (f) {
                return f.g == 1
                  ? ((r = null),
                    e.za.has(t)
                      ? ((r = e.za.get(t)), f.A(2))
                      : ((s = ec(t.P(), t.Jc(), t.Hc(), e.g.retryParameters)),
                        (a = or),
                        _(f, Fs(e, s, a, { type: 0 }).promise, 3)))
                  : (f.g != 2 && ((c = f.h), t.ue(c.data), (r = uO(c.data)), e.za.set(t, r)), f.return(r));
              });
            }
            Ee("shaka.hls.HlsParser", Kf);
            var sv = new Map()
                .set("aac", "audio/aac")
                .set("ac3", "audio/ac3")
                .set("ec3", "audio/ec3")
                .set("mp3", "audio/mpeg"),
              wB = new Map()
                .set("mp4", "audio/mp4")
                .set("mp4a", "audio/mp4")
                .set("m4s", "audio/mp4")
                .set("m4i", "audio/mp4")
                .set("m4a", "audio/mp4")
                .set("m4f", "audio/mp4")
                .set("cmfa", "audio/mp4")
                .set("ts", "video/mp2t")
                .set("tsa", "video/mp2t"),
              RB = new Map()
                .set("mp4", "video/mp4")
                .set("mp4v", "video/mp4")
                .set("m4s", "video/mp4")
                .set("m4i", "video/mp4")
                .set("m4v", "video/mp4")
                .set("m4f", "video/mp4")
                .set("cmfv", "video/mp4")
                .set("ts", "video/mp2t")
                .set("tsv", "video/mp2t"),
              CB = new Map()
                .set("mp4", "application/mp4")
                .set("m4s", "application/mp4")
                .set("m4i", "application/mp4")
                .set("m4f", "application/mp4")
                .set("cmft", "application/mp4")
                .set("vtt", "text/vtt")
                .set("webvtt", "text/vtt")
                .set("ttml", "application/ttml+xml"),
              LB = new Map()
                .set("jpg", "image/jpeg")
                .set("png", "image/png")
                .set("svg", "image/svg+xml")
                .set("webp", "image/webp")
                .set("avif", "image/avif"),
              Qf = new Map().set("audio", wB).set("video", RB).set("text", CB).set("image", LB),
              $R = new Set(["video/mp2t"].concat(V(Ss))),
              Jf = "VOD",
              _B = "EVENT",
              ov = "LIVE";
            (jo("application/x-mpegurl", function () {
              return new Kf();
            }),
              jo("application/vnd.apple.mpegurl", function () {
                return new Kf();
              }));
            function Zf(e) {
              return Pf(e);
            }
            var bB = new Map()
              .set("com.microsoft.playready", Zf)
              .set("com.microsoft.playready.recommendation", Zf)
              .set("com.microsoft.playready.software", Zf)
              .set("com.microsoft.playready.hardware", Zf);
            function av() {
              var e = this;
              ((this.h = this.g = null),
                (this.l = []),
                (this.j = null),
                (this.u = 1),
                (this.i = null),
                (this.F = new Di(5)),
                (this.o = new it(function () {
                  DB(e);
                })),
                (this.C = new Ha()),
                (this.m = new Map()),
                (this.B = function () {
                  return !1;
                }));
            }
            ((d = av.prototype),
              (d.configure = function (e, t) {
                ((this.g = e), t && (this.B = t));
              }),
              (d.start = function (e, t) {
                var r = this;
                return W(function (s) {
                  if (s.g == 1) return ((r.l = [e]), (r.h = t), _(s, lv(r), 2));
                  if (!r.h) throw new ee(2, 7, 7001);
                  return s.return(r.j);
                });
              }));
            function DB(e) {
              var t;
              W(function (r) {
                switch (r.g) {
                  case 1:
                    return (q(r, 2), _(r, lv(e), 4));
                  case 4:
                    he(r, 3);
                    break;
                  case 2:
                    ((t = ae(r)), e.h && ((t.severity = 1), e.h.onError(t)));
                  case 3:
                    if (!e.h) return r.return();
                    K(r);
                }
              });
            }
            ((d.stop = function () {
              return (
                (this.g = this.h = null),
                (this.l = []),
                (this.j = null),
                this.o != null && (this.o.stop(), (this.o = null)),
                this.m.clear(),
                this.C.destroy()
              );
            }),
              (d.update = function () {
                var e = this,
                  t;
                return W(function (r) {
                  if (r.g == 1) return (q(r, 2), _(r, lv(e), 4));
                  if (r.g != 2) return he(r, 0);
                  if (((t = ae(r)), !e.h || !t)) return r.return();
                  (e.h.onError(t), K(r));
                });
              }),
              (d.onExpirationUpdated = function () {}),
              (d.onInitialVariantChosen = function () {}),
              (d.banLocation = function () {}),
              (d.setMediaElement = function () {}));
            function lv(e) {
              var t, r, s, a, c, f, g;
              return W(function (m) {
                if (m.g == 1)
                  return (
                    (t = fn(e.l, e.g.retryParameters)),
                    (r = e.h.networkingEngine),
                    (s = Date.now()),
                    (a = r.request(0, t, { type: 5, isPreload: e.B() })),
                    Jo(e.C, a),
                    _(m, a.promise, 2)
                  );
                if (((c = m.h), !e.h)) return m.return();
                c.uri && !e.l.includes(c.uri) && e.l.unshift(c.uri);
                var x = c.uri,
                  E = c.data,
                  A = e.g.mss.manifestPreprocessor;
                if (A != Qh) {
                  if (
                    (ft(
                      "manifest.mss.manifestPreprocessor configuration",
                      "Please Use manifest.mss.manifestPreprocessorTXml instead.",
                    ),
                    (E = jw(E, "SmoothStreamingMedia")),
                    !E)
                  )
                    throw new ee(2, 4, 4046, x);
                  (A(E), (E = Er(E.outerHTML)));
                }
                var R = Ru(E, "SmoothStreamingMedia");
                if (!R) throw new ee(2, 4, 4046, x);
                if (
                  ((x = e.g.mss.manifestPreprocessorTXml),
                  x != Jh && x(R),
                  e.i || (e.i = new Ke(null, 0)),
                  (x = ze(R, "IsLive", eh, !1)))
                )
                  throw new ee(2, 4, 4047);
                (e.i.cd(!x),
                  (A = ze(R, "TimeScale", Fn, 1e7)),
                  (E = ze(R, "DVRWindowLength", Fn)),
                  x && (E === 0 || isNaN(E)) && (E = 1 / 0));
                var b = ze(R, "CanSeek", eh, !1);
                (E === 0 && b && (E = 1 / 0),
                  (b = null),
                  E && E > 0 && (b = E / A),
                  x && !isNaN(e.g.availabilityWindowOverride) && (b = e.g.availabilityWindowOverride),
                  b == null && (b = 1 / 0),
                  e.i.Lf(b),
                  (E = ze(R, "Duration", Fn, 1 / 0)),
                  x || e.i.Ab(E / A),
                  (x = { variants: [], textStreams: [], timescale: A, duration: E / A }));
                var D;
                for (
                  b = Rt(R, "Protection"), A = e.g.mss.keySystemsBySystemId, E = [], b = I(b), D = b.next();
                  !D.done;
                  D = b.next()
                )
                  E = E.concat(Rt(D.value, "ProtectionHeader"));
                if (E.length) {
                  for (b = [], D = 0; D < E.length; D++) {
                    var M = E[D],
                      P = M.attributes.SystemID.toLowerCase(),
                      G = A[P];
                    if (G) {
                      var U;
                      e: {
                        if ((U = mw(M))) {
                          U = I(Br(U, "DATA"));
                          for (var H = U.next(); !H.done; H = U.next())
                            if ((H = jt(H.value, "KID"))) {
                              ((U = rr(cn(H))),
                                (U = new Uint8Array(
                                  [U[3], U[2], U[1], U[0], U[5], U[4], U[7], U[6]].concat(V(U.slice(8))),
                                )),
                                (U = gs(U)));
                              break e;
                            }
                        }
                        U = null;
                      }
                      ((H = rr(cn(M))),
                        (P = Go(P.replace(/-/g, ""))),
                        (P = [{ initData: Sh(H, P, new Set(), 0), initDataType: "cenc", keyId: U }]),
                        (P = ms(G, "cenc", P)),
                        U && P.keyIds.add(U),
                        (G = bB.get(G)) && (P.licenseServerUri = G(M)),
                        b.push(P));
                    }
                  }
                  A = b;
                } else A = [];
                for (
                  D = A, b = [], A = [], E = [], R = Rt(R, "StreamIndex"), R = I(R), M = R.next();
                  !M.done;
                  M = R.next()
                ) {
                  ((M = M.value),
                    (G = Rt(M, "QualityLevel")),
                    (P = x.timescale),
                    (U = x.duration),
                    (H = Rt(M, "c")));
                  for (var Q = [], ne = 0, z = 0; z < H.length; ++z) {
                    var J = H[z],
                      X = H[z + 1],
                      ie = ze(J, "t", Fn),
                      Z = ze(J, "d", Fn);
                    if (((J = ze(J, "r", Nn)), !Z)) break;
                    if (((ie = ie != null ? ie : ne), (J = J || 0) && J--, J < 0))
                      if (X) {
                        if (((X = ze(X, "t", Fn)), X == null)) break;
                        if (ie >= X) break;
                        J = Math.ceil((X - ie) / Z) - 1;
                      } else {
                        if (U == 1 / 0) break;
                        if (ie / P >= U) break;
                        J = Math.ceil((U * P - ie) / Z) - 1;
                      }
                    for (X = 0; X <= J; ++X)
                      ((ne = ie + Z), Q.push({ start: ie / P, end: ne / P, Ld: ie }), (ie = ne));
                  }
                  for (P = Q, G = I(G), U = G.next(); !U.done; U = G.next())
                    (U = kB(e, M, U.value, P, D, x)) &&
                      (U.type != "audio" || e.g.disableAudio
                        ? U.type != "video" || e.g.disableVideo
                          ? U.type != nt || e.g.disableText || E.push(U)
                          : A.push(U)
                        : b.push(U));
                }
                for (R = [], b = I(b.length > 0 ? b : [null]), D = b.next(); !D.done; D = b.next())
                  for (D = D.value, M = I(A.length > 0 ? A : [null]), Q = M.next(); !Q.done; Q = M.next())
                    ((G = R),
                      (P = G.push),
                      (U = e),
                      (H = D),
                      (Q = Q.value),
                      (z = 0),
                      H && H.bandwidth && H.bandwidth > 0 && (z += H.bandwidth),
                      Q && Q.bandwidth && Q.bandwidth > 0 && (z += Q.bandwidth),
                      (U = {
                        id: U.u++,
                        language: H ? H.language : "und",
                        disabledUntilTime: 0,
                        primary: (!!H && H.primary) || (!!Q && Q.primary),
                        audio: H,
                        video: Q,
                        bandwidth: z,
                        allowedByApplication: !0,
                        allowedByKeySystem: !0,
                        decodingInfos: [],
                      }),
                      P.call(G, U));
                ((x.variants = R),
                  (x.textStreams = E),
                  e.j
                    ? ((e.j.variants = x.variants), (e.j.textStreams = x.textStreams), e.h.filter(e.j))
                    : ((e.j = {
                        presentationTimeline: e.i,
                        variants: x.variants,
                        textStreams: x.textStreams,
                        imageStreams: [],
                        offlineSessionIds: [],
                        sequenceMode: e.g.mss.sequenceMode,
                        ignoreManifestTimestampsInSegmentsMode: !1,
                        type: "MSS",
                        serviceDescription: null,
                        nextUrl: null,
                        periodCount: 1,
                        gapCount: 0,
                        isLowLatency: !1,
                        startTime: null,
                      }),
                      e.i.qf()),
                  Promise.resolve(),
                  (f = Date.now()),
                  (g = (f - s) / 1e3),
                  e.F.sample(1, g),
                  K(m));
              });
            }
            function kB(e, t, r, s, a, c) {
              var f = t.attributes.Type;
              if (f !== "audio" && f !== "video" && f !== "text")
                return (He("Ignoring unrecognized type:", f), null);
              var g = t.attributes.Language,
                m = e.u++,
                x = ze(r, "Bitrate", Qr),
                E = ze(r, "MaxWidth", Qr),
                A = ze(r, "MaxHeight", Qr),
                R = ze(r, "Channels", Qr),
                b = ze(r, "SamplingRate", Qr),
                D = c.duration;
              s.length && (D = s[s.length - 1].end - s[0].start);
              var M = e.i.getDuration();
              (e.i.Ab(Math.min(D, M)),
                (M = t.attributes.Name) && (M += r.attributes.Index),
                M || (M = String(m)));
              var P = {
                id: m,
                originalId: M,
                groupId: null,
                createSegmentIndex: function () {
                  return Promise.resolve();
                },
                closeSegmentIndex: function () {
                  return Promise.resolve();
                },
                segmentIndex: null,
                mimeType: "",
                codecs: "",
                frameRate: void 0,
                pixelAspectRatio: void 0,
                bandwidth: x || 0,
                width: E || void 0,
                height: A || void 0,
                kind: "",
                encrypted: a.length > 0,
                drmInfos: a,
                keyIds: new Set(),
                language: At(g || "und"),
                originalLanguage: g,
                label: "",
                type: "",
                primary: !1,
                trickModeVideo: null,
                dependencyStream: null,
                emsgSchemeIdUris: [],
                roles: [],
                forced: !1,
                channelsCount: R,
                audioSamplingRate: b,
                spatialAudio: !1,
                closedCaptions: null,
                hdr: void 0,
                colorGamut: void 0,
                videoLayout: void 0,
                tilesLayout: void 0,
                matchedStreams: [],
                mssPrivateData: { duration: D, timescale: c.timescale, codecPrivateData: null },
                accessibilityPurpose: null,
                external: !1,
                fastSwitching: !1,
                fullMimeTypes: new Set(),
                isAudioMuxedInVideo: !1,
                baseOriginalId: null,
              };
              if (
                ((a = t.attributes.Subtype) &&
                  ((a = UB.get(a)) && P.roles.push(a), a === "main" && (P.primary = !0)),
                (a = r.attributes.FourCC),
                (a === null || a === "") && (a = t.attributes.FourCC),
                !a)
              ) {
                if (f === "audio") a = "AAC";
                else if (f === "video")
                  return (
                    He(
                      'FourCC is not defined whereas it is required for a QualityLevel element for a StreamIndex of type "video"',
                    ),
                    null
                  );
              }
              if (!FB.includes(a.toUpperCase())) return (He("Codec not supported:", a), null);
              switch (((r = MB(r, f, a, P)), (P.mssPrivateData.codecPrivateData = r), f)) {
                case "audio":
                  if (!r) return (He("Quality unsupported without CodecPrivateData", f), null);
                  ((P.type = "audio"), (P.mimeType = "mss/audio/mp4"), (P.codecs = PB(a, r)));
                  break;
                case "video":
                  if (!r) return (He("Quality unsupported without CodecPrivateData", f), null);
                  ((P.type = "video"), (P.mimeType = "mss/video/mp4"), (P.codecs = OB(r)));
                  break;
                case "text":
                  ((P.type = nt),
                    (P.mimeType = "application/mp4"),
                    (a === "TTML" || a === "DFXP") && (P.codecs = "stpp"));
              }
              return (
                P.fullMimeTypes.add(tn(P.mimeType, P.codecs)),
                (P.createSegmentIndex = function () {
                  if (P.segmentIndex) return Promise.resolve();
                  if (e.m.has(P.id)) var G = e.m.get(P.id);
                  else
                    ((G = []),
                      P.type == "video" && (G = P.mssPrivateData.codecPrivateData.split("00000001").slice(1)),
                      (G = {
                        id: P.id,
                        type: P.type,
                        codecs: P.codecs,
                        encrypted: P.encrypted,
                        timescale: P.mssPrivateData.timescale,
                        duration: P.mssPrivateData.duration,
                        Bb: G,
                        Ga: new Uint8Array([]),
                        Sa: new Uint8Array([]),
                        Za: 0,
                        $a: 0,
                        data: null,
                        stream: P,
                      }),
                      (G = Xa(new Ya([G]))),
                      e.m.set(P.id, G));
                  return (
                    (G = NB(
                      e,
                      new Ai(
                        function () {
                          return [];
                        },
                        0,
                        null,
                        Fh(P),
                        P.mssPrivateData.timescale,
                        G,
                        null,
                        P.encrypted,
                      ),
                      P,
                      t,
                      s,
                    )),
                    (P.segmentIndex = new mt(G)),
                    Promise.resolve()
                  );
                }),
                (P.closeSegmentIndex = function () {
                  P.segmentIndex && (P.segmentIndex.release(), (P.segmentIndex = null));
                }),
                P
              );
            }
            function MB(e, t, r, s) {
              if ((e = e.attributes.CodecPrivateData)) return e;
              if (t !== "audio") return null;
              ((t = s.channelsCount || 2), (e = s.audioSamplingRate || 44100));
              var a = {
                96e3: 0,
                88200: 1,
                64e3: 2,
                48e3: 3,
                44100: 4,
                32e3: 5,
                24e3: 6,
                22050: 7,
                16e3: 8,
                12e3: 9,
                11025: 10,
                8e3: 11,
                7350: 12,
              };
              return (
                (s = a[e]),
                r === "AACH"
                  ? ((r = new Uint8Array(4)),
                    (e = a[e * 2]),
                    (r[0] = 40 | (s >> 1)),
                    (r[1] = (s << 7) | (t << 3) | (e >> 1)),
                    (r[2] = (e << 7) | 8),
                    (r[3] = 0),
                    (t = new Uint16Array(2)),
                    (t[0] = (r[0] << 8) + r[1]),
                    (t[1] = (r[2] << 8) + r[3]),
                    t[0].toString(16) + t[1].toString(16))
                  : ((r = new Uint8Array(2)),
                    (r[0] = 16 | (s >> 1)),
                    (r[1] = (s << 7) | (t << 3)),
                    (t = new Uint16Array(1)),
                    (t[0] = (r[0] << 8) + r[1]),
                    t[0].toString(16))
              );
            }
            function PB(e, t) {
              var r = 0;
              return (
                e === "AACH" && (r = 5),
                t
                  ? r === 0 && (r = (parseInt(t.substr(0, 2), 16) & 248) >> 3)
                  : ((r = 2), e === "AACH" && (r = 5)),
                "mp4a.40." + r
              );
            }
            function OB(e) {
              var t = /00000001[0-9]7/.exec(e);
              return t.length && e ? "avc1." + e.substr(e.indexOf(t[0]) + 10, 6) : "";
            }
            function NB(e, t, r, s, a) {
              var c = s.attributes.Url.replace("{bitrate}", String(r.bandwidth));
              ((s = []), (a = I(a)));
              for (var f = a.next(), g = {}; !f.done; g = { Pf: void 0 }, f = a.next())
                ((g.Pf = f.value),
                  s.push(
                    new Be(
                      g.Pf.start,
                      g.Pf.end,
                      (function (m) {
                        return function () {
                          return Ln(e.l, [c.replace("{start time}", String(m.Pf.Ld))]);
                        };
                      })(g),
                      0,
                      null,
                      t,
                      0,
                      0,
                      r.mssPrivateData.duration,
                    ),
                  ));
              return s;
            }
            Ee("shaka.mss.MssParser", av);
            var FB = "AAC AACL AACH AACP AVC1 H264 TTML DFXP".split(" "),
              UB = new Map().set("CAPT", "main").set("SUBT", "alternate").set("DESC", "main");
            jo("application/vnd.ms-sstr+xml", function () {
              return new av();
            });
            function GR(e, t, r, s, a, c, f) {
              if ((r >= 200 && r <= 299 && r != 202) || r == 304)
                return {
                  uri: a || s,
                  originalUri: s,
                  data: t,
                  status: r,
                  headers: e,
                  fromCache: !!e["x-shaka-from-cache"],
                  originalRequest: c,
                };
              c = null;
              try {
                c = Yr(t);
              } catch (g) {}
              throw new ee(r == 401 || r == 403 ? 2 : 1, 1, 1001, s, r, c, e, f, a || s);
            }
            function uv() {}
            function ep(e, t, r, s, a, c) {
              var f = new HB();
              try {
                Wa(t.headers).forEach(function (E, A) {
                  f.append(A, E);
                });
              } catch (E) {
                return oo(new ee(1, 1, 1002, e, E, r));
              }
              var g = new jB(),
                m = { Vh: !1, ij: !1 };
              if (
                ((e = BB(
                  e,
                  t,
                  r,
                  {
                    body: t.body || void 0,
                    headers: f,
                    method: t.method,
                    signal: g.signal,
                    credentials: t.allowCrossSiteCredentials ? "include" : void 0,
                  },
                  m,
                  s,
                  a,
                  t.streamDataCallback,
                  c.minBytesForProgressEvents || 0,
                )),
                (e = new sn(e, function () {
                  return ((m.Vh = !0), g.abort(), Promise.resolve());
                })),
                (t = t.retryParameters.timeout))
              ) {
                var x = new it(function () {
                  ((m.ij = !0), g.abort());
                });
                (x.ka(t / 1e3),
                  e.finally(function () {
                    x.stop();
                  }));
              }
              return e;
            }
            function BB(e, t, r, s, a, c, f, g, m) {
              var x, E, A, R, b, D, M, P, G, U, H, Q, ne, z, J;
              return W(function (X) {
                switch (X.g) {
                  case 1:
                    return (
                      (x = GB),
                      (E = VB),
                      (R = new ArrayBuffer(0)),
                      (D = b = 0),
                      (M = {}),
                      (P = Date.now()),
                      q(X, 2),
                      _(X, x(e, s), 4)
                    );
                  case 4:
                    if (((A = X.h), (M = $B(A.headers)), f(M), s.method == "HEAD")) {
                      X.A(5);
                      break;
                    }
                    return (
                      (U = (G = A.headers.get("Content-Length")) ? parseInt(G, 10) : 0),
                      A.body
                        ? ((H = A.clone().body.getReader()),
                          (Q = function (ie) {
                            function Z() {
                              var re, se, me, fe;
                              return W(function (le) {
                                switch (le.g) {
                                  case 1:
                                    return (q(le, 2), _(le, H.read(), 4));
                                  case 4:
                                    ((re = le.h), he(le, 3));
                                    break;
                                  case 2:
                                    return (ae(le), le.return());
                                  case 3:
                                    if (re.done) {
                                      le.A(5);
                                      break;
                                    }
                                    if (((b += re.value.byteLength), !g)) {
                                      le.A(5);
                                      break;
                                    }
                                    return _(le, g(re.value), 5);
                                  case 5:
                                    ((se = Date.now()),
                                      (me = b - D),
                                      ((se - P > 100 && me >= m) || re.done) &&
                                        ((fe = re.done ? 0 : U - b), c(se - P, me, fe), (D = b), (P = se)),
                                      re.done ? ie.close() : (ie.enqueue(re.value), Z()),
                                      K(le));
                                }
                              });
                            }
                            Z();
                          }),
                          new E({ start: Q }),
                          _(X, A.arrayBuffer(), 8))
                        : _(X, A.arrayBuffer(), 9)
                    );
                  case 8:
                    ((R = X.h), X.A(5));
                    break;
                  case 9:
                    ((R = X.h), (ne = Date.now()), c(ne - P, R.byteLength, 0));
                  case 5:
                    (t.headers.Range &&
                      ((z = t.headers.Range.replace("bytes=", "")
                        .split("-")
                        .filter(function (ie) {
                          return ie;
                        })
                        .map(function (ie) {
                          return parseInt(ie, 10);
                        })),
                      z.length == 2 &&
                        R.byteLength != z[1] - z[0] + 1 &&
                        He("Payload length does not match range requested bytes", t, A)),
                      he(X, 3));
                    break;
                  case 2:
                    throw (
                      (J = ae(X)),
                      a.Vh
                        ? new ee(1, 1, 7001, e, r)
                        : a.ij
                          ? new ee(1, 1, 1003, e, r)
                          : new ee(1, 1, 1002, e, J, r)
                    );
                  case 3:
                    return X.return(GR(M, R, A.status, e, A.url, t, r));
                }
              });
            }
            function $B(e) {
              var t = {};
              return (
                e.forEach(function (r, s) {
                  t[s.trim()] = r;
                }),
                t
              );
            }
            function jR() {
              if (l.ReadableStream)
                try {
                  new ReadableStream({});
                } catch (e) {
                  return !1;
                }
              else return !1;
              if (l.Response) {
                if (!new Response("").body) return !1;
              } else return !1;
              return !(!l.fetch || "polyfill" in l.fetch || !l.AbortController);
            }
            (Ee("shaka.net.HttpFetchPlugin", uv), (uv.isSupported = jR), (uv.parse = ep));
            var GB = l.fetch,
              jB = l.AbortController,
              VB = l.ReadableStream,
              HB = l.Headers;
            jR() && (As("http", ep, 2, !0), As("https", ep, 2, !0), As("blob", ep, 2, !0));
            function VR() {}
            function tp(e, t, r, s, a, c) {
              var f = new KB(),
                g = Date.now(),
                m = 0,
                x = new Promise(function (E, A) {
                  (f.open(t.method, e, !0),
                    (f.responseType = "arraybuffer"),
                    (f.timeout = t.retryParameters.timeout),
                    (f.withCredentials = t.allowCrossSiteCredentials));
                  var R = {};
                  ((f.onabort = function () {
                    A(new ee(1, 1, 7001, e, r));
                  }),
                    (f.onreadystatechange = function () {
                      if (f.readyState === XMLHttpRequest.HEADERS_RECEIVED) {
                        var D = f.getAllResponseHeaders().trim().split("\r\n"),
                          M = {};
                        D = I(D);
                        for (var P = D.next(); !P.done; P = D.next())
                          ((P = P.value.split(": ")), (M[P[0].toLowerCase()] = P.slice(1).join(": ")));
                        ((R = M), a(R));
                      }
                    }),
                    (f.onload = function (D) {
                      var M = f.response;
                      try {
                        s(Date.now() - g, D.loaded - m, 0);
                        var P = GR(R, M, f.status, e, f.responseURL, t, r);
                        E(P);
                      } catch (G) {
                        A(G);
                      }
                    }),
                    (f.onerror = function (D) {
                      A(new ee(1, 1, 1002, e, D, r));
                    }),
                    (f.ontimeout = function () {
                      A(new ee(1, 1, 1003, e, r));
                    }),
                    (f.onprogress = function (D) {
                      var M = Date.now(),
                        P = c.minBytesForProgressEvents || 0,
                        G = D.loaded - m;
                      ((M - g > 100 && G >= P) || (D.lengthComputable && D.loaded == D.total)) &&
                        (s(M - g, G, f.readyState == 4 ? 0 : D.total - D.loaded), (m = D.loaded), (g = M));
                    }));
                  for (var b in t.headers)
                    try {
                      f.setRequestHeader(b.toLowerCase(), t.headers[b]);
                    } catch (D) {
                      throw new ee(1, 1, 1002, e, D, r);
                    }
                  f.send(t.body);
                });
              return new sn(x, function () {
                return (f.abort(), Promise.resolve());
              });
            }
            (Ee("shaka.net.HttpXHRPlugin", VR), (VR.parse = tp));
            var KB = l.XMLHttpRequest;
            (As("http", tp, 1, !0), As("https", tp, 1, !0), As("blob", tp, 1, !0));
            function HR(e, t, r, s, a) {
              ((this.g = e), (this.i = t), (this.groupId = r), (this.h = s), (this.j = a));
            }
            function cv(e) {
              var t = e.$b(!1);
              return t
                ? ps(t)
                : e
                    .P()
                    .map(function (r) {
                      return "{" + encodeURI(r.split("#xywh=")[0]) + "}";
                    })
                    .join("") +
                    ":" +
                    e.startByte +
                    ":" +
                    e.endByte;
            }
            function WB(e, t) {
              return ec(e.g.P(), e.g.startByte, e.g.endByte, t.streaming.retryParameters);
            }
            function KR() {
              ((this.g = this.j = this.i = 0), (this.h = new Map()), (this.l = 0));
            }
            function WR(e, t) {
              e.i += t;
              var r = e.l;
              return (e.l++, e.h.set(r, t), r);
            }
            KR.prototype.close = function (e, t) {
              if (this.h.has(e)) {
                var r = this.h.get(e);
                (this.h.delete(e), (this.j += r), (this.g += t));
              }
            };
            function zR(e) {
              return e.i == 0 ? 0 : e.j / e.i;
            }
            function dv(e) {
              var t = this;
              ((this.u = e),
                (this.i = new Map()),
                (this.h = new Ka(function () {
                  return hv(t).catch(function () {});
                })),
                (this.j = []),
                (this.o = function () {}),
                (this.m = function () {}),
                (this.g = new KR()),
                (this.l = !1));
            }
            dv.prototype.destroy = function () {
              return this.h.destroy();
            };
            function zB(e, t, r) {
              ((e.o = t), (e.m = r));
            }
            function hv(e) {
              e.l = !0;
              var t = e.j.map(function (r) {
                return r();
              });
              return ((e.j = []), Promise.all(t));
            }
            dv.prototype.queue = function (e, t, r, s, a) {
              var c = this;
              Nt(this.h);
              var f = (this.i.get(e) || Promise.resolve()).then(function () {
                var g, m, x, E, A, R, b;
                return W(function (D) {
                  if (D.g == 1) return _(D, qB(c, t), 2);
                  if (((g = D.h), c.h.g)) throw new ee(2, 9, 7001);
                  if (s)
                    for (E in ((m = We(g)), (x = new Um(m)), x.data))
                      ((A = Number(E)), (R = x.data[A]), (b = x.g[A]), c.m(R, b));
                  return (c.g.close(r, g.byteLength), c.o(zR(c.g), c.g.g), D.return(a(g)));
                });
              });
              return (this.i.set(e, f), f);
            };
            function YB(e, t, r, s, a, c) {
              Nt(e.h);
              var f = (e.i.get(t) || Promise.resolve()).then(function () {
                if (e.h.g) throw new ee(2, 9, 7001);
                if (a) {
                  var g = We(r);
                  g = new Um(g);
                  for (var m in g.data) {
                    var x = Number(m);
                    e.m(g.data[x], g.g[x]);
                  }
                }
                return (e.g.close(s, r.byteLength), e.o(zR(e.g), e.g.g), c(r));
              });
              e.i.set(t, f);
            }
            function XB(e) {
              return W(function (t) {
                return t.g == 1 ? _(t, Promise.all(e.i.values()), 2) : t.return(e.g.g);
              });
            }
            function qB(e, t) {
              var r, s, a, c;
              return W(function (f) {
                return f.g == 1
                  ? ((r = or),
                    (s = e.u.request(r, t)),
                    (a = function () {
                      return s.abort();
                    }),
                    e.j.push(a),
                    _(f, s.promise, 2))
                  : ((c = f.h), ki(e.j, a), f.return(c.data));
              });
            }
            function np(e, t) {
              var r = this;
              ((this.i = e),
                (this.h = e.objectStore(t)),
                (this.g = new _t()),
                (e.onabort = function (s) {
                  (s.preventDefault(), r.g.reject());
                }),
                (e.onerror = function (s) {
                  (s.preventDefault(), r.g.reject());
                }),
                (e.oncomplete = function () {
                  r.g.resolve();
                }));
            }
            np.prototype.abort = function () {
              var e = this;
              return W(function (t) {
                if (t.g == 1) {
                  try {
                    e.i.abort();
                  } catch (r) {}
                  return (q(t, 2), _(t, e.g, 4));
                }
                if (t.g != 2) return he(t, 0);
                (ae(t), K(t));
              });
            };
            function fv(e, t) {
              return new Promise(function (r, s) {
                var a = e.h.openCursor();
                ((a.onerror = s),
                  (a.onsuccess = function () {
                    var c;
                    return W(function (f) {
                      if (f.g == 1)
                        return a.result == null
                          ? (r(), f.return())
                          : ((c = a.result), _(f, t(c.key, c.value, c), 2));
                      (c.continue(), K(f));
                    });
                  }));
              });
            }
            ((np.prototype.store = function () {
              return this.h;
            }),
              (np.prototype.promise = function () {
                return this.g;
              }));
            function pv(e) {
              ((this.h = e), (this.g = []));
            }
            pv.prototype.destroy = function () {
              return Promise.all(
                this.g.map(function (e) {
                  return e.abort();
                }),
              );
            };
            function ua(e, t) {
              return ip(e, t, "readwrite");
            }
            function ip(e, t, r) {
              r = e.h.transaction([t], r);
              var s = new np(r, t);
              return (
                e.g.push(s),
                s.promise().then(
                  function () {
                    ki(e.g, s);
                  },
                  function () {
                    ki(e.g, s);
                  },
                ),
                s
              );
            }
            function ca(e, t, r) {
              ((this.h = new pv(e)), (this.i = t), (this.g = r));
            }
            ((d = ca.prototype),
              (d.destroy = function () {
                return this.h.destroy();
              }),
              (d.hasFixedKeySpace = function () {
                return !0;
              }),
              (d.addSegments = function () {
                return YR(this.i);
              }),
              (d.removeSegments = function (e, t) {
                return XR(this, this.i, e, t);
              }),
              (d.getSegments = function (e) {
                var t = this,
                  r;
                return W(function (s) {
                  return s.g == 1
                    ? _(s, qR(t, t.i, e), 2)
                    : ((r = s.h),
                      s.return(
                        r.map(function (a) {
                          return t.Xh(a);
                        }),
                      ));
                });
              }),
              (d.addManifests = function () {
                return YR(this.g);
              }),
              (d.updateManifest = function () {
                return Promise.reject(new ee(2, 9, 9016, "Cannot modify values in " + this.g));
              }));
            function QB(e, t, r) {
              e = ua(e.h, e.g);
              var s = e.store();
              return (
                (s.get(t).onsuccess = function () {
                  s.put(r, t);
                }),
                e.promise()
              );
            }
            ((d.updateManifestExpiration = function (e, t) {
              var r = ua(this.h, this.g),
                s = r.store();
              return (
                (s.get(e).onsuccess = function (a) {
                  (a = a.target.result) && ((a.expiration = t), s.put(a, e));
                }),
                r.promise()
              );
            }),
              (d.removeManifests = function (e, t) {
                return XR(this, this.g, e, t);
              }),
              (d.getManifests = function (e) {
                var t = this,
                  r;
                return W(function (s) {
                  return s.g == 1
                    ? _(s, qR(t, t.g, e), 2)
                    : ((r = s.h),
                      s.return(
                        Promise.all(
                          r.map(function (a) {
                            return t.Ud(a);
                          }),
                        ),
                      ));
                });
              }),
              (d.getAllManifests = function () {
                var e = this,
                  t,
                  r;
                return W(function (s) {
                  return s.g == 1
                    ? ((t = ip(e.h, e.g, "readonly")),
                      (r = new Map()),
                      _(
                        s,
                        fv(t, function (a, c) {
                          var f;
                          return W(function (g) {
                            if (g.g == 1) return _(g, e.Ud(c), 2);
                            ((f = g.h), r.set(a, f), K(g));
                          });
                        }),
                        2,
                      ))
                    : s.g != 3
                      ? _(s, t.promise(), 3)
                      : s.return(r);
                });
              }),
              (d.Xh = function (e) {
                return e;
              }),
              (d.Ud = function (e) {
                return Promise.resolve(e);
              }));
            function YR(e) {
              return Promise.reject(new ee(2, 9, 9011, "Cannot add new value to " + e));
            }
            d.add = function (e, t) {
              var r = this,
                s,
                a,
                c,
                f,
                g,
                m,
                x;
              return W(function (E) {
                if (E.g == 1) {
                  for (
                    s = ua(r.h, e), a = s.store(), c = [], f = I(t), g = f.next(), m = {};
                    !g.done;
                    m = { hh: void 0 }, g = f.next()
                  )
                    ((x = g.value),
                      (m.hh = a.add(x)),
                      (m.hh.onsuccess = (function (A) {
                        return function () {
                          c.push(A.hh.result);
                        };
                      })(m)));
                  return _(E, s.promise(), 2);
                }
                return E.return(c);
              });
            };
            function XR(e, t, r, s) {
              ((e = ua(e.h, t)), (t = e.store()), (r = I(r)));
              for (var a = r.next(), c = {}; !a.done; c = { Tg: void 0 }, a = r.next())
                ((c.Tg = a.value),
                  (t.delete(c.Tg).onsuccess = (function (f) {
                    return function () {
                      return s(f.Tg);
                    };
                  })(c)));
              return e.promise();
            }
            function qR(e, t, r) {
              var s, a, c, f, g, m, x;
              return W(function (E) {
                if (E.g == 1) {
                  for (
                    s = ip(e.h, t, "readonly"), a = s.store(), c = {}, f = [], g = I(r), m = g.next(), x = {};
                    !m.done;
                    x = { Ef: void 0, lf: void 0 }, m = g.next()
                  )
                    ((x.lf = m.value),
                      (x.Ef = a.get(x.lf)),
                      (x.Ef.onsuccess = (function (A) {
                        return function () {
                          (A.Ef.result == null && f.push(A.lf), (c[A.lf] = A.Ef.result));
                        };
                      })(x)));
                  return _(E, s.promise(), 2);
                }
                if (f.length) throw new ee(2, 9, 9012, "Could not find values for " + f);
                return E.return(
                  r.map(function (A) {
                    return c[A];
                  }),
                );
              });
            }
            function Pc(e) {
              this.g = new pv(e);
            }
            ((Pc.prototype.destroy = function () {
              return this.g.destroy();
            }),
              (Pc.prototype.getAll = function () {
                var e = this,
                  t,
                  r;
                return W(function (s) {
                  return s.g == 1
                    ? ((t = ip(e.g, "session-ids", "readonly")),
                      (r = []),
                      _(
                        s,
                        fv(t, function (a, c) {
                          r.push(c);
                        }),
                        2,
                      ))
                    : s.g != 3
                      ? _(s, t.promise(), 3)
                      : s.return(r);
                });
              }),
              (Pc.prototype.add = function (e) {
                var t = ua(this.g, "session-ids"),
                  r = t.store();
                e = I(e);
                for (var s = e.next(); !s.done; s = e.next()) r.add(s.value);
                return t.promise();
              }),
              (Pc.prototype.remove = function (e) {
                var t = this,
                  r;
                return W(function (s) {
                  return s.g == 1
                    ? ((r = ua(t.g, "session-ids")),
                      _(
                        s,
                        fv(r, function (a, c, f) {
                          e.includes(c.sessionId) && f.delete();
                        }),
                        2,
                      ))
                    : _(s, r.promise(), 0);
                });
              }));
            function Ri() {
              this.g = new Map();
            }
            ((Ri.prototype.destroy = function () {
              for (var e = [], t = I(this.g.values()), r = t.next(); !r.done; r = t.next())
                e.push(r.value.destroy());
              return (this.g.clear(), Promise.all(e));
            }),
              (Ri.prototype.init = function () {
                var e = this;
                Oc.forEach(function (a, c) {
                  (a = a()) && e.g.set(c, a);
                });
                for (var t = [], r = I(this.g.values()), s = r.next(); !s.done; s = r.next())
                  t.push(s.value.init());
                return Promise.all(t);
              }));
            function QR(e) {
              var t = null;
              if (
                (e.g.forEach(function (r, s) {
                  r.getCells().forEach(function (a, c) {
                    a.hasFixedKeySpace() || t || (t = { path: { Pb: s, cb: c }, cb: a });
                  });
                }),
                t)
              )
                return t;
              throw new ee(2, 9, 9013, "Could not find a cell that supports add-operations");
            }
            function JB(e, t) {
              e.g.forEach(function (r, s) {
                r.getCells().forEach(function (a, c) {
                  t({ Pb: s, cb: c }, a);
                });
              });
            }
            function rp(e, t, r) {
              if (((e = e.g.get(t)), !e)) throw new ee(2, 9, 9013, "Could not find mechanism with name " + t);
              if (((t = e.getCells().get(r)), !t))
                throw new ee(2, 9, 9013, "Could not find cell with name " + r);
              return t;
            }
            function ZB(e, t) {
              e.g.forEach(function (r) {
                t(r.getEmeSessionCell());
              });
            }
            function e3(e) {
              var t = Array.from(e.g.keys());
              if (!t.length) throw new ee(2, 9, 9e3, "No supported storage mechanisms found");
              return e.g.get(t[0]).getEmeSessionCell();
            }
            function t3(e) {
              var t, r, s;
              return W(function (a) {
                return a.g == 1
                  ? ((t = Array.from(e.g.values())),
                    (r = t.length > 0),
                    r ||
                      ((s = Oc),
                      s.forEach(function (c) {
                        (c = c()) && t.push(c);
                      })),
                    _(
                      a,
                      Promise.all(
                        t.map(function (c) {
                          return c.erase();
                        }),
                      ),
                      2,
                    ))
                  : r
                    ? a.A(0)
                    : _(
                        a,
                        Promise.all(
                          t.map(function (c) {
                            return c.destroy();
                          }),
                        ),
                        0,
                      );
              });
            }
            function JR(e, t) {
              Oc.set(e, t);
            }
            (Ee("shaka.offline.StorageMuxer", Ri),
              (Ri.unregister = function (e) {
                Oc.delete(e);
              }),
              (Ri.register = JR),
              (Ri.prototype.destroy = Ri.prototype.destroy));
            var Oc = new Map();
            function Nc() {
              ca.apply(this, arguments);
            }
            (N(Nc, ca),
              (Nc.prototype.updateManifestExpiration = function (e, t) {
                var r = this,
                  s,
                  a,
                  c;
                return W(function (f) {
                  return (
                    (s = ua(r.h, r.g)),
                    (a = s.store()),
                    (c = new _t()),
                    (a.get(e).onsuccess = function (g) {
                      (g = g.target.result)
                        ? ((g.expiration = t), a.put(g), c.resolve())
                        : c.reject(new ee(2, 9, 9012, "Could not find values for " + e));
                    }),
                    _(f, Promise.all([s.promise(), c]), 0)
                  );
                });
              }),
              (Nc.prototype.Ud = function (e) {
                var t, r, s, a, c, f;
                return W(function (g) {
                  if (g.g == 1) {
                    for (t = [], r = 0; r < e.periods.length; ++r)
                      ((s = r == e.periods.length - 1 ? e.duration : e.periods[r + 1].startTime),
                        (a = s - e.periods[r].startTime),
                        (c = n3(e.periods[r], a)),
                        t.push(c));
                    return _(g, kw(t), 2);
                  }
                  return (
                    (f = g.h),
                    g.return({
                      creationTime: 0,
                      originalManifestUri: e.originalManifestUri,
                      duration: e.duration,
                      size: e.size,
                      expiration: e.expiration == null ? 1 / 0 : e.expiration,
                      streams: f,
                      sessionIds: e.sessionIds,
                      drmInfo: e.drmInfo,
                      appMetadata: e.appMetadata,
                      sequenceMode: !1,
                    })
                  );
                });
              }));
            function n3(e, t) {
              r3(e);
              for (var r = I(e.streams), s = r.next(); !s.done; s = r.next());
              return e.streams.map(function (a) {
                return i3(a, e.startTime, t);
              });
            }
            function i3(e, t, r) {
              var s = e.initSegmentUri ? ZR(e.initSegmentUri) : null,
                a = t + e.presentationTimeOffset,
                c = t + r;
              return {
                id: e.id,
                originalId: null,
                groupId: null,
                primary: e.primary,
                type: e.contentType,
                mimeType: e.mimeType,
                codecs: e.codecs,
                frameRate: e.frameRate,
                pixelAspectRatio: void 0,
                hdr: void 0,
                colorGamut: void 0,
                videoLayout: void 0,
                kind: e.kind,
                language: e.language,
                originalLanguage: e.language || null,
                label: e.label,
                width: e.width,
                height: e.height,
                initSegmentKey: s,
                encrypted: e.encrypted,
                keyIds: new Set([e.keyId]),
                segments: e.segments.map(function (f) {
                  var g = ZR(f.uri);
                  return {
                    startTime: t + f.startTime,
                    endTime: t + f.endTime,
                    dataKey: g,
                    initSegmentKey: s,
                    appendWindowStart: t,
                    appendWindowEnd: c,
                    timestampOffset: a,
                    tilesLayout: "",
                    mimeType: null,
                    codecs: null,
                    thumbnailSprite: null,
                  };
                }),
                variantIds: e.variantIds,
                roles: [],
                forced: !1,
                audioSamplingRate: null,
                channelsCount: null,
                spatialAudio: !1,
                closedCaptions: null,
                tilesLayout: void 0,
                external: !1,
                fastSwitching: !1,
                isAudioMuxedInVideo: !1,
              };
            }
            Nc.prototype.Xh = function (e) {
              return { data: e.data };
            };
            function ZR(e) {
              var t;
              if (
                (t = /^offline:[0-9]+\/[0-9]+\/([0-9]+)$/.exec(e)) ||
                (t = /^offline:segment\/([0-9]+)$/.exec(e))
              )
                return Number(t[1]);
              throw new ee(2, 9, 9004, "Could not parse uri " + e);
            }
            function r3(e) {
              var t = e.streams.filter(function (g) {
                return g.contentType == "audio";
              });
              if (
                ((e = e.streams.filter(function (g) {
                  return g.contentType == "video";
                })),
                !t.every(function (g) {
                  return g.variantIds;
                }) ||
                  !e.every(function (g) {
                    return g.variantIds;
                  }))
              ) {
                for (var r = I(t), s = r.next(); !s.done; s = r.next()) s.value.variantIds = [];
                for (r = I(e), s = r.next(); !s.done; s = r.next()) s.value.variantIds = [];
                if (((r = 0), e.length && !t.length)) {
                  s = r++;
                  for (var a = I(e), c = a.next(); !c.done; c = a.next()) c.value.variantIds.push(s);
                }
                if (!e.length && t.length)
                  for (s = r++, a = I(t), c = a.next(); !c.done; c = a.next()) c.value.variantIds.push(s);
                if (e.length && t.length)
                  for (t = I(t), s = t.next(); !s.done; s = t.next())
                    for (s = s.value, a = I(e), c = a.next(); !c.done; c = a.next()) {
                      c = c.value;
                      var f = r++;
                      (s.variantIds.push(f), c.variantIds.push(f));
                    }
              }
            }
            function sp() {
              ca.apply(this, arguments);
            }
            (N(sp, ca),
              (sp.prototype.Ud = function (e) {
                var t, r, s, a, c, f;
                return W(function (g) {
                  if (g.g == 1) {
                    for (t = [], r = 0; r < e.periods.length; ++r) {
                      ((s = r == e.periods.length - 1 ? e.duration : e.periods[r + 1].startTime),
                        (a = s - e.periods[r].startTime));
                      for (
                        var m = e.periods[r], x = [], E = I(m.streams), A = E.next();
                        !A.done;
                        A = E.next()
                      )
                        ((A = A.value),
                          A.variantIds.length != 0 && x.push(s3(A, m.startTime, m.startTime + a)));
                      ((c = x), t.push(c));
                    }
                    return _(g, kw(t), 2);
                  }
                  return (
                    (f = g.h),
                    g.return({
                      appMetadata: e.appMetadata,
                      creationTime: 0,
                      drmInfo: e.drmInfo,
                      duration: e.duration,
                      expiration: e.expiration == null ? 1 / 0 : e.expiration,
                      originalManifestUri: e.originalManifestUri,
                      sessionIds: e.sessionIds,
                      size: e.size,
                      streams: f,
                      sequenceMode: !1,
                    })
                  );
                });
              }));
            function s3(e, t, r) {
              return {
                id: e.id,
                originalId: e.originalId,
                groupId: null,
                primary: e.primary,
                type: e.contentType,
                mimeType: e.mimeType,
                codecs: e.codecs,
                frameRate: e.frameRate,
                pixelAspectRatio: e.pixelAspectRatio,
                hdr: void 0,
                colorGamut: void 0,
                videoLayout: void 0,
                kind: e.kind,
                language: e.language,
                originalLanguage: e.language || null,
                label: e.label,
                width: e.width,
                height: e.height,
                encrypted: e.encrypted,
                keyIds: new Set([e.keyId]),
                segments: e.segments.map(function (s) {
                  return {
                    startTime: t + s.startTime,
                    endTime: t + s.endTime,
                    initSegmentKey: e.initSegmentKey,
                    appendWindowStart: t,
                    appendWindowEnd: r,
                    timestampOffset: t - e.presentationTimeOffset,
                    dataKey: s.dataKey,
                    tilesLayout: "",
                    mimeType: null,
                    codecs: null,
                    thumbnailSprite: null,
                  };
                }),
                variantIds: e.variantIds,
                roles: [],
                forced: !1,
                audioSamplingRate: null,
                channelsCount: null,
                spatialAudio: !1,
                closedCaptions: null,
                tilesLayout: void 0,
                external: !1,
                fastSwitching: !1,
                isAudioMuxedInVideo: !1,
              };
            }
            function gv() {
              ca.apply(this, arguments);
            }
            (N(gv, ca),
              (d = gv.prototype),
              (d.hasFixedKeySpace = function () {
                return !1;
              }),
              (d.addSegments = function (e) {
                return this.add(this.i, e);
              }),
              (d.addManifests = function (e) {
                return this.add(this.g, e);
              }),
              (d.updateManifest = function (e, t) {
                return QB(this, e, t);
              }),
              (d.Ud = function (e) {
                return (e.expiration == null && (e.expiration = 1 / 0), Promise.resolve(e));
              }));
            function eC() {
              this.m = this.j = this.i = this.h = this.g = this.l = null;
            }
            ((d = eC.prototype),
              (d.init = function () {
                var e = this,
                  t = new _t(),
                  r = !1,
                  s = new it(function () {
                    ((r = !0), t.reject(new ee(2, 9, 9017)));
                  });
                typeof op == "number" && op > 0 && s.ka(op);
                var a = l.indexedDB.open("shaka_offline_db", 5);
                return (
                  (a.onsuccess = function () {
                    if (!r) {
                      s.stop();
                      var c = a.result;
                      e.l = c;
                      var f = c.objectStoreNames;
                      ((f =
                        f.contains("manifest") && f.contains("segment")
                          ? new Nc(c, "segment", "manifest")
                          : null),
                        (e.g = f),
                        (f = c.objectStoreNames),
                        (f =
                          f.contains("manifest-v2") && f.contains("segment-v2")
                            ? new sp(c, "segment-v2", "manifest-v2")
                            : null),
                        (e.h = f),
                        (f = c.objectStoreNames),
                        (f =
                          f.contains("manifest-v3") && f.contains("segment-v3")
                            ? new sp(c, "segment-v3", "manifest-v3")
                            : null),
                        (e.i = f),
                        (f = c.objectStoreNames),
                        (f =
                          f.contains("manifest-v5") && f.contains("segment-v5")
                            ? new gv(c, "segment-v5", "manifest-v5")
                            : null),
                        (e.j = f),
                        (c = c.objectStoreNames.contains("session-ids") ? new Pc(c) : null),
                        (e.m = c),
                        t.resolve());
                    }
                  }),
                  (a.onupgradeneeded = function () {
                    for (
                      var c = a.result, f = I(["segment-v5", "manifest-v5", "session-ids"]), g = f.next();
                      !g.done;
                      g = f.next()
                    )
                      ((g = g.value),
                        c.objectStoreNames.contains(g) || c.createObjectStore(g, { autoIncrement: !0 }));
                  }),
                  (a.onerror = function (c) {
                    r || (s.stop(), t.reject(new ee(2, 9, 9001, a.error)), c.preventDefault());
                  }),
                  t
                );
              }),
              (d.destroy = function () {
                var e = this;
                return W(function (t) {
                  switch (t.g) {
                    case 1:
                      if (!e.g) {
                        t.A(2);
                        break;
                      }
                      return _(t, e.g.destroy(), 2);
                    case 2:
                      if (!e.h) {
                        t.A(4);
                        break;
                      }
                      return _(t, e.h.destroy(), 4);
                    case 4:
                      if (!e.i) {
                        t.A(6);
                        break;
                      }
                      return _(t, e.i.destroy(), 6);
                    case 6:
                      if (!e.j) {
                        t.A(8);
                        break;
                      }
                      return _(t, e.j.destroy(), 8);
                    case 8:
                      if (!e.m) {
                        t.A(10);
                        break;
                      }
                      return _(t, e.m.destroy(), 10);
                    case 10:
                      (e.l && e.l.close(), K(t));
                  }
                });
              }),
              (d.getCells = function () {
                var e = new Map();
                return (
                  this.g && e.set("v1", this.g),
                  this.h && e.set("v2", this.h),
                  this.i && e.set("v3", this.i),
                  this.j && e.set("v5", this.j),
                  e
                );
              }),
              (d.getEmeSessionCell = function () {
                return this.m;
              }),
              (d.erase = function () {
                var e = this;
                return W(function (t) {
                  switch (t.g) {
                    case 1:
                      if (!e.g) {
                        t.A(2);
                        break;
                      }
                      return _(t, e.g.destroy(), 2);
                    case 2:
                      if (!e.h) {
                        t.A(4);
                        break;
                      }
                      return _(t, e.h.destroy(), 4);
                    case 4:
                      if (!e.i) {
                        t.A(6);
                        break;
                      }
                      return _(t, e.i.destroy(), 6);
                    case 6:
                      if (!e.j) {
                        t.A(8);
                        break;
                      }
                      return _(t, e.j.destroy(), 8);
                    case 8:
                      return (e.l && e.l.close(), _(t, o3(), 10));
                    case 10:
                      return (
                        (e.l = null),
                        (e.g = null),
                        (e.h = null),
                        (e.i = null),
                        (e.j = null),
                        _(t, e.init(), 0)
                      );
                  }
                });
              }));
            function o3() {
              var e = new _t(),
                t = l.indexedDB.deleteDatabase("shaka_offline_db");
              return (
                (t.onblocked = function () {}),
                (t.onsuccess = function () {
                  e.resolve();
                }),
                (t.onerror = function (r) {
                  (e.reject(new ee(2, 9, 9001, t.error)), r.preventDefault());
                }),
                e
              );
            }
            var op = 5;
            (Ee("shaka.offline.indexeddb.StorageMechanismOpenTimeout", op),
              JR("idb", function () {
                return tt().Ch() ? new eC() : null;
              }));
            function ts(e, t, r, s) {
              ((this.g = e),
                (this.i = t),
                (this.h = r),
                (this.l = s),
                (this.j = ["offline:", e, "/", t, "/", r, "/", s].join("")));
            }
            ((ts.prototype.Pb = function () {
              return this.i;
            }),
              (ts.prototype.cb = function () {
                return this.h;
              }),
              (ts.prototype.key = function () {
                return this.l;
              }),
              (ts.prototype.toString = function () {
                return this.j;
              }));
            function mv(e) {
              if (((e = /^offline:([a-z]+)\/([^/]+)\/([^/]+)\/([0-9]+)$/.exec(e)), e == null)) return null;
              var t = e[1];
              if (t != "manifest" && t != "segment") return null;
              var r = e[2];
              if (!r) return null;
              var s = e[3];
              return s && t != null ? new ts(t, r, s, Number(e[4])) : null;
            }
            function tC(e, t) {
              ((this.h = e), (this.g = t));
            }
            function nC(e, t) {
              var r = new Ke(null, 0);
              r.Ab(t.duration);
              var s = t.streams.filter(function (x) {
                  return x.type == "audio";
                }),
                a = t.streams.filter(function (x) {
                  return x.type == "video";
                });
              ((s = a3(e, s, a, r)),
                (a = t.streams
                  .filter(function (x) {
                    return x.type == nt;
                  })
                  .map(function (x) {
                    return ap(e, x, r);
                  })));
              var c = t.streams
                  .filter(function (x) {
                    return x.type == "image";
                  })
                  .map(function (x) {
                    return ap(e, x, r);
                  }),
                f = t.drmInfo ? [t.drmInfo] : [];
              if (t.drmInfo)
                for (var g = I(s.values()), m = g.next(); !m.done; m = g.next())
                  ((m = m.value),
                    m.audio && m.audio.encrypted && (m.audio.drmInfos = f),
                    m.video && m.video.encrypted && (m.video.drmInfos = f));
              return {
                presentationTimeline: r,
                offlineSessionIds: t.sessionIds,
                variants: Array.from(s.values()),
                textStreams: a,
                imageStreams: c,
                sequenceMode: t.sequenceMode || !1,
                ignoreManifestTimestampsInSegmentsMode: !1,
                type: t.type || "UNKNOWN",
                serviceDescription: null,
                nextUrl: null,
                periodCount: 1,
                gapCount: 0,
                isLowLatency: !1,
                startTime: null,
              };
            }
            function a3(e, t, r, s) {
              for (var a = new Set(), c = I(t), f = c.next(); !f.done; f = c.next()) {
                f = I(f.value.variantIds);
                for (var g = f.next(); !g.done; g = f.next()) a.add(g.value);
              }
              for (c = I(r), f = c.next(); !f.done; f = c.next())
                for (f = I(f.value.variantIds), g = f.next(); !g.done; g = f.next()) a.add(g.value);
              for (c = new Map(), a = I(a), f = a.next(); !f.done; f = a.next())
                ((f = f.value),
                  c.set(f, {
                    id: f,
                    language: "",
                    disabledUntilTime: 0,
                    primary: !1,
                    audio: null,
                    video: null,
                    bandwidth: 0,
                    allowedByApplication: !0,
                    allowedByKeySystem: !0,
                    decodingInfos: [],
                  }));
              for (t = I(t), a = t.next(); !a.done; a = t.next())
                for (f = a.value, a = ap(e, f, s), f = I(f.variantIds), g = f.next(); !g.done; g = f.next())
                  ((g = c.get(g.value)),
                    (g.language = a.language),
                    (g.primary = g.primary || a.primary),
                    (g.audio = a));
              for (r = I(r), t = r.next(); !t.done; t = r.next())
                for (a = t.value, t = ap(e, a, s), a = I(a.variantIds), f = a.next(); !f.done; f = a.next())
                  ((f = c.get(f.value)), (f.primary = f.primary || t.primary), (f.video = t));
              return c;
            }
            function ap(e, t, r) {
              var s = t.segments.map(function (a) {
                return l3(e, a, t);
              });
              return (
                r.me(s),
                {
                  id: t.id,
                  originalId: t.originalId,
                  groupId: t.groupId,
                  createSegmentIndex: function () {
                    return Promise.resolve();
                  },
                  segmentIndex: new mt(s),
                  mimeType: t.mimeType,
                  codecs: t.codecs,
                  width: t.width || void 0,
                  height: t.height || void 0,
                  frameRate: t.frameRate,
                  pixelAspectRatio: t.pixelAspectRatio,
                  hdr: t.hdr,
                  colorGamut: t.colorGamut,
                  videoLayout: t.videoLayout,
                  kind: t.kind,
                  encrypted: t.encrypted,
                  drmInfos: [],
                  keyIds: t.keyIds,
                  language: t.language,
                  originalLanguage: t.originalLanguage || null,
                  label: t.label,
                  type: t.type,
                  primary: t.primary,
                  trickModeVideo: null,
                  dependencyStream: null,
                  emsgSchemeIdUris: null,
                  roles: t.roles,
                  forced: t.forced,
                  channelsCount: t.channelsCount,
                  audioSamplingRate: t.audioSamplingRate,
                  spatialAudio: t.spatialAudio,
                  closedCaptions: t.closedCaptions,
                  tilesLayout: t.tilesLayout,
                  mssPrivateData: t.mssPrivateData,
                  accessibilityPurpose: null,
                  external: t.external,
                  fastSwitching: t.fastSwitching,
                  fullMimeTypes: new Set([tn(t.mimeType, t.codecs)]),
                  isAudioMuxedInVideo: t.isAudioMuxedInVideo || !1,
                  baseOriginalId: null,
                }
              );
            }
            function l3(e, t, r) {
              var s = new ts("segment", e.h, e.g, t.dataKey);
              return (
                (e = new Be(
                  t.startTime,
                  t.endTime,
                  function () {
                    return [s.toString()];
                  },
                  0,
                  null,
                  t.initSegmentKey != null ? u3(e, t.initSegmentKey) : null,
                  t.timestampOffset,
                  t.appendWindowStart,
                  t.appendWindowEnd,
                  [],
                  t.tilesLayout || "",
                )),
                (e.mimeType = t.mimeType || r.mimeType || ""),
                (e.codecs = t.codecs || r.codecs || ""),
                t.thumbnailSprite && e.Mf(t.thumbnailSprite),
                e
              );
            }
            function u3(e, t) {
              var r = new ts("segment", e.h, e.g, t);
              return new Ai(
                function () {
                  return [r.toString()];
                },
                0,
                null,
              );
            }
            function iC() {
              this.g = null;
            }
            ((d = iC.prototype),
              (d.configure = function () {}),
              (d.start = function (e, t) {
                var r = this,
                  s,
                  a,
                  c,
                  f,
                  g,
                  m,
                  x;
                return W(function (E) {
                  switch (E.g) {
                    case 1:
                      if (((s = mv(e)), (r.g = s), s == null || s.g != "manifest"))
                        throw new ee(2, 1, 9004, e);
                      return ((a = new Ri()), ce(E, 2), _(E, a.init(), 4));
                    case 4:
                      return _(E, rp(a, s.Pb(), s.cb()), 5);
                    case 5:
                      return ((c = E.h), _(E, c.getManifests([s.key()]), 6));
                    case 6:
                      return (
                        (f = E.h),
                        (g = f[0]),
                        (m = new tC(s.Pb(), s.cb())),
                        (x = nC(m, g)),
                        t.makeTextStreamsForClosedCaptions(x),
                        E.return(x)
                      );
                    case 2:
                      return (ye(E), _(E, a.destroy(), 7));
                    case 7:
                      ve(E, 0);
                  }
                });
              }),
              (d.stop = function () {
                return Promise.resolve();
              }),
              (d.update = function () {}),
              (d.onExpirationUpdated = function (e, t) {
                var r = this,
                  s,
                  a,
                  c,
                  f,
                  g,
                  m,
                  x;
                return W(function (E) {
                  switch (E.g) {
                    case 1:
                      return ((s = r.g), (a = new Ri()), q(E, 2, 3), _(E, a.init(), 5));
                    case 5:
                      return _(E, rp(a, s.Pb(), s.cb()), 6);
                    case 6:
                      return ((c = E.h), _(E, c.getManifests([s.key()]), 7));
                    case 7:
                      if (
                        ((f = E.h),
                        (g = f[0]),
                        (m = g.sessionIds.includes(e)),
                        (x = g.expiration == null || g.expiration > t),
                        !m || !x)
                      ) {
                        E.A(3);
                        break;
                      }
                      return _(E, c.updateManifestExpiration(s.key(), t), 3);
                    case 3:
                      return (ye(E), _(E, a.destroy(), 10));
                    case 10:
                      ve(E, 0);
                      break;
                    case 2:
                      (ae(E), E.A(3));
                  }
                });
              }),
              (d.onInitialVariantChosen = function () {}),
              (d.banLocation = function () {}),
              (d.setMediaElement = function () {}),
              jo("application/x-offline-manifest", function () {
                return new iC();
              }));
            function rC() {}
            function sC(e, t) {
              var r = mv(e);
              return (
                r && r.g == "manifest"
                  ? ((e = {
                      uri: e,
                      originalUri: e,
                      data: new ArrayBuffer(0),
                      headers: { "content-type": "application/x-offline-manifest" },
                      originalRequest: t,
                    }),
                    (e = Va(e)))
                  : (e = r && r.g == "segment" ? c3(r.key(), r, t) : oo(new ee(2, 1, 9004, e))),
                e
              );
            }
            function c3(e, t, r) {
              var s = new Ri();
              return Va(void 0)
                .Xa(function () {
                  return s.init();
                })
                .Xa(function () {
                  return rp(s, t.Pb(), t.cb());
                })
                .Xa(function (a) {
                  return a.getSegments([t.key()]);
                })
                .Xa(function (a) {
                  return { uri: t, data: a[0].data, headers: {}, originalRequest: r };
                })
                .finally(function () {
                  return s.destroy();
                });
            }
            (Ee("shaka.offline.OfflineScheme", rC), (rC.plugin = sC), As("offline", sC));
            function oC(e, t, r) {
              var s, a, c, f, g, m;
              return W(function (x) {
                switch (x.g) {
                  case 1:
                    s = [];
                    for (var E = [], A = I(r), R = A.next(); !R.done; R = A.next()) {
                      R = R.value;
                      for (var b = !1, D = I(E), M = D.next(); !M.done; M = D.next())
                        if (((M = M.value), h3(M.info, R))) {
                          (M.sessionIds.push(R.sessionId), (b = !0));
                          break;
                        }
                      b || E.push({ info: R, sessionIds: [R.sessionId] });
                    }
                    ((a = I(E)), (c = a.next()));
                  case 2:
                    if (c.done) {
                      x.A(4);
                      break;
                    }
                    return ((f = c.value), (g = d3(e, t, f)), _(x, g, 5));
                  case 5:
                    ((m = x.h), (s = s.concat(m)), (c = a.next()), x.A(2));
                    break;
                  case 4:
                    return x.return(s);
                }
              });
            }
            function d3(e, t, r) {
              var s, a;
              return W(function (c) {
                switch (c.g) {
                  case 1:
                    return (
                      (s = new Eh({
                        vc: t,
                        onError: function () {},
                        zf: function () {},
                        onExpirationUpdated: function () {},
                        onEvent: function () {},
                      })),
                      q(c, 2),
                      s.configure(e),
                      _(
                        c,
                        HP(
                          s,
                          r.info.keySystem,
                          r.info.licenseUri,
                          r.info.serverCertificate,
                          r.info.audioCapabilities,
                          r.info.videoCapabilities,
                        ),
                        4,
                      )
                    );
                  case 4:
                    he(c, 3);
                    break;
                  case 2:
                    return (ae(c), _(c, s.destroy(), 5));
                  case 5:
                    return c.return([]);
                  case 3:
                    return (
                      (a = []),
                      _(
                        c,
                        Promise.all(
                          r.sessionIds.map(function (f) {
                            return W(function (g) {
                              if (g.g == 1) return (q(g, 2), _(g, zP(s, f), 4));
                              if (g.g != 2) return (a.push(f), he(g, 0));
                              (ae(g), K(g));
                            });
                          }),
                        ),
                        6,
                      )
                    );
                  case 6:
                    return _(c, s.destroy(), 7);
                  case 7:
                    return c.return(a);
                }
              });
            }
            function h3(e, t) {
              function r(s, a) {
                return s.robustness == a.robustness && s.contentType == a.contentType;
              }
              return (
                e.keySystem == t.keySystem &&
                e.licenseUri == t.licenseUri &&
                nr(e.audioCapabilities, t.audioCapabilities, r) &&
                nr(e.videoCapabilities, t.videoCapabilities, r)
              );
            }
            function f3(e, t, r) {
              var s = t.presentationTimeline.getDuration();
              return (
                (t = aC(t)),
                {
                  offlineUri: null,
                  originalManifestUri: e,
                  duration: s,
                  size: 0,
                  expiration: 1 / 0,
                  tracks: t,
                  appMetadata: r,
                  isIncomplete: !1,
                }
              );
            }
            function yv(e, t) {
              var r = nC(new tC(e.Pb(), e.cb()), t),
                s = t.appMetadata || {};
              return (
                (r = aC(r)),
                {
                  offlineUri: e.toString(),
                  originalManifestUri: t.originalManifestUri,
                  duration: t.duration,
                  size: t.size,
                  expiration: t.expiration,
                  tracks: r,
                  appMetadata: s,
                  isIncomplete: t.isIncomplete || !1,
                }
              );
            }
            function aC(e) {
              var t = [],
                r = fh(e.variants);
              r = I(r);
              for (var s = r.next(); !s.done; s = r.next()) t.push(qo(s.value));
              for (e = I(e.textStreams), r = e.next(); !r.done; r = e.next()) t.push(Qo(r.value));
              return t;
            }
            function p3() {
              this.g = new Map();
            }
            function g3(e, t) {
              var r = t.audio,
                s = t.video;
              if (
                (r && !s && e.g.set(r.id, r.bandwidth || t.bandwidth),
                !r && s && e.g.set(s.id, s.bandwidth || t.bandwidth),
                r && s)
              ) {
                var a = r.bandwidth || 393216,
                  c = s.bandwidth || t.bandwidth - a;
                (c <= 0 && (c = t.bandwidth), e.g.set(r.id, a), e.g.set(s.id, c));
              }
            }
            function m3(e, t) {
              e.g.set(t.id, t.bandwidth || 2048);
            }
            function lC(e, t) {
              return ((e = e.g.get(t)), e == null && (e = 0), e);
            }
            function kn(e) {
              var t = this;
              if (e && e.constructor != de) throw new ee(2, 9, 9008);
              ((this.g = this.h = null),
                e
                  ? ((this.h = e.g), (this.g = e.Yb()))
                  : ((this.h = ll()), (this.g = new Vt()), this.g.configure(this.h.networking)),
                (this.i = []),
                (this.l = []));
              var r = !e;
              ((this.j = new Ka(function () {
                var s, a, c, f, g;
                return W(function (m) {
                  switch (m.g) {
                    case 1:
                      return _(
                        m,
                        Promise.all(
                          t.l.map(function (x) {
                            return hv(x);
                          }),
                        ),
                        2,
                      );
                    case 2:
                      for (s = function () {}, a = [], c = I(t.i), f = c.next(); !f.done; f = c.next())
                        ((g = f.value), a.push(g.then(s, s)));
                      return _(m, Promise.all(a), 3);
                    case 3:
                      if (!r) {
                        m.A(4);
                        break;
                      }
                      return _(m, t.g.destroy(), 4);
                    case 4:
                      ((t.h = null), (t.g = null), K(m));
                  }
                });
              })),
                (this.m = 1e9));
            }
            function vv() {
              if (es(tt()))
                e: {
                  for (var e = I(Oc.values()), t = e.next(); !t.done; t = e.next())
                    if (((t = t.value), (t = t()))) {
                      (t.destroy(), (e = !0));
                      break e;
                    }
                  e = !1;
                }
              else e = !1;
              return e;
            }
            ((d = kn.prototype),
              (d.destroy = function () {
                return this.j.destroy();
              }),
              (d.configure = function (e, t) {
                return (arguments.length == 2 && typeof e == "string" && (e = zh(e, t)), bs(this.h, e));
              }),
              (d.getConfiguration = function () {
                var e = ll();
                return (bs(e, this.h, ll()), e);
              }),
              (d.Yb = function () {
                return this.g;
              }),
              (d.store = function (e, t, r, s, a) {
                var c = this,
                  f = this.getConfiguration(),
                  g = new dv(this.g);
                return (
                  this.l.push(g),
                  (t = y3(
                    this,
                    e,
                    t || {},
                    s || [],
                    a || [],
                    function () {
                      var m;
                      return W(function (x) {
                        return x.g == 1
                          ? r
                            ? x.A(2)
                            : _(x, rl(e, c.g, f.manifest.retryParameters), 3)
                          : (x.g != 2 && (r = x.h), (m = VS(e, r || null)), x.return(m()));
                      });
                    },
                    f,
                    g,
                  )),
                  (t = new sn(t, function () {
                    return hv(g);
                  })),
                  t.finally(function () {
                    ki(c.l, g);
                  }),
                  M3(this, t)
                );
              }));
            function y3(e, t, r, s, a, c, f, g) {
              var m, x, E, A, R, b, D, M, P, G, U, H, Q, ne, z, J, X, ie, Z, re, se, me, fe, le;
              return W(function (ue) {
                switch (ue.g) {
                  case 1:
                    return (
                      lp(),
                      (x = m = null),
                      (E = new Ri()),
                      (b = R = A = null),
                      q(ue, 2, 3),
                      _(ue, c(), 5)
                    );
                  case 5:
                    return ((m = ue.h), _(ue, R3(e, t, m, f), 6));
                  case 6:
                    if (
                      ((D = ue.h),
                      Hi(e),
                      (M = !D.presentationTimeline.W() && !D.presentationTimeline.Vc()),
                      !M)
                    )
                      throw new ee(2, 9, 9005, t);
                    ((P = I(s)), (G = P.next()));
                  case 7:
                    if (G.done) {
                      ue.A(9);
                      break;
                    }
                    return ((U = G.value), _(ue, C3(e, U, D), 10));
                  case 10:
                    ((H = ue.h), D.imageStreams.push(H), Hi(e), (G = P.next()), ue.A(7));
                    break;
                  case 9:
                    ((Q = I(a)), (ne = Q.next()));
                  case 11:
                    return ne.done
                      ? (qE(f.drm.clearKeys, D.variants),
                        (X = D.variants.some(function (xe) {
                          if (xe.audio) {
                            for (var Se = I(xe.audio.drmInfos), Ye = Se.next(); !Ye.done; Ye = Se.next())
                              if (Ye.value.licenseServerUri.startsWith("data:")) return !0;
                          }
                          if (xe.video) {
                            for (xe = I(xe.video.drmInfos), Se = xe.next(); !Se.done; Se = xe.next())
                              if (Se.value.licenseServerUri.startsWith("data:")) return !0;
                          }
                          return !1;
                        })),
                        (ie = f.offline.usePersistentLicense),
                        X && (ie = !1),
                        _(
                          ue,
                          e.md(
                            D,
                            function (xe) {
                              b = b || xe;
                            },
                            f,
                            ie,
                          ),
                          15,
                        ))
                      : ((z = ne.value), _(ue, L3(e, D, z.uri, z.language, z.kind, z.mime, z.codecs), 14));
                  case 14:
                    ((J = ue.h), D.textStreams.push(J), Hi(e), (ne = Q.next()), ue.A(11));
                    break;
                  case 15:
                    if (((x = ue.h), Hi(e), b)) throw b;
                    return _(ue, x3(D, x, f, ie), 16);
                  case 16:
                    return _(ue, E.init(), 17);
                  case 17:
                    return (Hi(e), _(ue, QR(E), 18));
                  case 18:
                    return (
                      (A = ue.h),
                      Hi(e),
                      (Z = T3(x, D, t, r, f, g, ie)),
                      (re = Z.xk),
                      (se = Z.Gh),
                      _(ue, A.cb.addManifests([re]), 19)
                    );
                  case 19:
                    if (((me = ue.h), Hi(e), (R = me[0]), Hi(e), b)) throw b;
                    return _(ue, v3(e, se, R, re, g, f, A.cb, D, x, ie), 20);
                  case 20:
                    return (Hi(e), hC(D, re, x, ie), _(ue, A.cb.updateManifest(R, re), 21));
                  case 21:
                    return (Hi(e), (fe = new ts("manifest", A.path.Pb, A.path.cb, R)), ue.return(yv(fe, re)));
                  case 3:
                    return (ye(ue), _(ue, E.destroy(), 22));
                  case 22:
                    if (!m) {
                      ue.A(23);
                      break;
                    }
                    return _(ue, m.stop(), 23);
                  case 23:
                    if (!x) {
                      ue.A(25);
                      break;
                    }
                    return _(ue, x.destroy(), 25);
                  case 25:
                    ve(ue, 0);
                    break;
                  case 2:
                    if (((le = ae(ue)), R == null)) {
                      ue.A(27);
                      break;
                    }
                    return _(ue, uC(R), 27);
                  case 27:
                    throw b || le;
                }
              });
            }
            function v3(e, t, r, s, a, c, f, g, m, x) {
              var E, A, R, b, D, M, P, G, U, H, Q;
              return W(function (ne) {
                switch (ne.g) {
                  case 1:
                    if (
                      ((E = {}),
                      (A = 0),
                      (R = function () {
                        if (e.j.g || a.l) throw new ee(2, 9, 7001);
                      }),
                      (b = function (z, J) {
                        var X, ie, Z, re, se, me, fe, le, ue;
                        return W(function (xe) {
                          if (xe.g == 1) {
                            for (X = I(z), ie = X.next(), Z = {}; !ie.done; Z = { mc: void 0 }, ie = X.next())
                              ((Z.mc = ie.value),
                                R(),
                                (re = WB(Z.mc, c)),
                                (se = Z.mc.i),
                                (me = Z.mc.h),
                                (fe = (function (Se) {
                                  return function (Ye) {
                                    var be, xt, qe, Ct;
                                    return W(function (lt) {
                                      switch (lt.g) {
                                        case 1:
                                          if (((be = Se.mc.g), (xt = be.$b(!1)), !be.aesKey || xt)) {
                                            lt.A(2);
                                            break;
                                          }
                                          return _(lt, v0(Ye, be.aesKey, Se.mc.j), 3);
                                        case 3:
                                          Ye = lt.h;
                                        case 2:
                                          return ((qe = cv(be)), _(lt, f.addSegments([{ data: Ye }]), 4));
                                        case 4:
                                          ((Ct = lt.h), R(), (E[qe] = Ct[0]), (A += Ye.byteLength), K(lt));
                                      }
                                    });
                                  };
                                })(Z)),
                                (le = Z.mc.g),
                                (ue = le.$b(!1))
                                  ? YB(a, Z.mc.groupId, ue, se, me, fe)
                                  : a.queue(Z.mc.groupId, re, se, me, fe));
                            return _(xe, XB(a), 2);
                          }
                          return (
                            R(),
                            !J || a.l ? xe.A(0) : (hC(g, s, m, x), _(xe, f.updateManifest(r, s), 0))
                          );
                        });
                      }),
                      (D = !1),
                      q(ne, 2),
                      !xv(g) || !D || dC(g))
                    ) {
                      ne.A(4);
                      break;
                    }
                    return _(
                      ne,
                      b(
                        t.filter(function (z) {
                          return z.h;
                        }),
                        !0,
                      ),
                      5,
                    );
                  case 5:
                    return (
                      R(),
                      (t = t.filter(function (z) {
                        return !z.h;
                      })),
                      (M = E),
                      (P = A),
                      (E = {}),
                      (A = 0),
                      _(
                        ne,
                        cC(f, r, s, M, P, function () {
                          return Hi(e);
                        }),
                        6,
                      )
                    );
                  case 6:
                    R();
                  case 4:
                    if (D) {
                      ne.A(7);
                      break;
                    }
                    return _(ne, b(t, !1), 8);
                  case 8:
                    return (
                      R(),
                      (G = E),
                      (U = A),
                      (E = {}),
                      (A = 0),
                      _(
                        ne,
                        cC(f, r, s, G, U, function () {
                          return R();
                        }),
                        9,
                      )
                    );
                  case 9:
                    R();
                  case 7:
                    he(ne, 0);
                    break;
                  case 2:
                    return (
                      (H = ae(ne)),
                      (Q = Object.values(E)),
                      _(
                        ne,
                        f.removeSegments(Q, function () {}),
                        10,
                      )
                    );
                  case 10:
                    throw H;
                }
              });
            }
            function uC(e) {
              var t, r, s, a;
              return W(function (c) {
                switch (c.g) {
                  case 1:
                    return ((t = new Ri()), _(c, t.init(), 2));
                  case 2:
                    return _(c, QR(t), 3);
                  case 3:
                    return (
                      (r = c.h),
                      (s = new ts("manifest", r.path.Pb, r.path.cb, e)),
                      _(c, t.destroy(), 4)
                    );
                  case 4:
                    return ((a = new kn()), _(c, a.remove(s.toString()), 0));
                }
              });
            }
            function cC(e, t, r, s, a, c) {
              var f, g, m, x, E, A, R, b, D, M, P;
              return W(function (G) {
                switch (G.g) {
                  case 1:
                    for (f = !1, q(G, 2), g = !0, m = I(r.streams), x = m.next(); !x.done; x = m.next())
                      for (E = x.value, A = I(E.segments), R = A.next(); !R.done; R = A.next())
                        ((b = R.value),
                          (D = b.pendingSegmentRefId ? s[b.pendingSegmentRefId] : null),
                          D != null && ((b.dataKey = D), (b.pendingSegmentRefId = void 0)),
                          (D = b.pendingInitSegmentRefId ? s[b.pendingInitSegmentRefId] : null),
                          D != null && ((b.initSegmentKey = D), (b.pendingInitSegmentRefId = void 0)),
                          b.pendingSegmentRefId && (g = !1),
                          b.pendingInitSegmentRefId && (g = !1));
                    return ((r.size += a), g && (r.isIncomplete = !1), _(G, e.updateManifest(t, r), 4));
                  case 4:
                    ((f = !0), c(), he(G, 0));
                    break;
                  case 2:
                    return ((M = ae(G)), _(G, uC(t), 5));
                  case 5:
                    if (f) {
                      G.A(6);
                      break;
                    }
                    return (
                      (P = Object.values(s)),
                      _(
                        G,
                        e.removeSegments(P, function () {}),
                        6,
                      )
                    );
                  case 6:
                    throw M;
                }
              });
            }
            function x3(e, t, r, s) {
              var a,
                c,
                f,
                g,
                m,
                x,
                E,
                A,
                R,
                b,
                D,
                M,
                P,
                G,
                U,
                H,
                Q,
                ne,
                z,
                J,
                X,
                ie,
                Z,
                re,
                se,
                me,
                fe,
                le,
                ue,
                xe;
              return W(function (Se) {
                switch (Se.g) {
                  case 1:
                    return (
                      (a = { width: 1 / 0, height: 1 / 0 }),
                      IP(e, r.restrictions, a),
                      _(Se, gE(t, e, s, r.drm.preferredKeySystems, r.drm.keySystemsMapping), 2)
                    );
                  case 2:
                    for (
                      c = [],
                        f = r.preferredDecodingAttributes,
                        g = r.preferredVideoCodecs,
                        m = r.preferredAudioCodecs,
                        x = r.preferredTextFormats,
                        pE(e, g, m, f, x),
                        E = I(e.variants),
                        A = E.next();
                      !A.done;
                      A = E.next()
                    )
                      ((R = A.value), c.push(qo(R)));
                    for (b = I(e.textStreams), D = b.next(); !D.done; D = b.next())
                      ((M = D.value), c.push(Qo(M)));
                    for (P = I(e.imageStreams), G = P.next(); !G.done; G = P.next())
                      ((U = G.value), c.push(Mm(U)));
                    return _(Se, r.offline.trackSelectionCallback(c), 3);
                  case 3:
                    for (
                      H = Se.h, Q = e.presentationTimeline.getDuration(), ne = 0, z = I(H), J = z.next();
                      !J.done;
                      J = z.next()
                    )
                      ((X = J.value), (ie = (X.bandwidth * Q) / 8), (ne += ie));
                    return (q(Se, 4), _(Se, r.offline.downloadSizeCallback(ne), 6));
                  case 6:
                    if (((Z = Se.h), !Z)) throw new ee(2, 9, 9014);
                    he(Se, 5);
                    break;
                  case 4:
                    throw ((re = ae(Se)), re instanceof ee ? re : new ee(2, 9, 9015));
                  case 5:
                    for (
                      se = new Set(), me = new Set(), fe = new Set(), le = I(H), ue = le.next();
                      !ue.done;
                      ue = le.next()
                    )
                      ((xe = ue.value),
                        xe.type == "variant" && se.add(xe.id),
                        xe.type == "text" && me.add(xe.id),
                        xe.type == "image" && fe.add(xe.id));
                    ((e.variants = e.variants.filter(function (Ye) {
                      return se.has(Ye.id);
                    })),
                      (e.textStreams = e.textStreams.filter(function (Ye) {
                        return me.has(Ye.id);
                      })),
                      (e.imageStreams = e.imageStreams.filter(function (Ye) {
                        return fe.has(Ye.id);
                      })),
                      N3(e),
                      K(Se));
                }
              });
            }
            function T3(e, t, r, s, a, c, f) {
              var g = f3(r, t, s),
                m = a.offline.progressCallback;
              zB(
                c,
                function (D, M) {
                  ((g.size = M), m(g, D));
                },
                function (D, M) {
                  x && f && E == M && Bu(e, "cenc", D);
                },
              );
              var x = xv(t) && !dC(t),
                E = null;
              x && (E = F3.get(e.g.keySystem));
              for (var A = new p3(), R = I(t.textStreams), b = R.next(); !b.done; b = R.next())
                A.g.set(b.value.id, 52);
              for (R = I(t.imageStreams), b = R.next(); !b.done; b = R.next()) m3(A, b.value);
              for (R = I(t.variants), b = R.next(); !b.done; b = R.next()) g3(A, b.value);
              return (
                (c = b3(c, A, t, a)),
                (a = c.streams),
                (c = c.Gh),
                (A = e.g) && f && (A.initData = []),
                {
                  xk: {
                    creationTime: Date.now(),
                    originalManifestUri: r,
                    duration: t.presentationTimeline.getDuration(),
                    size: 0,
                    expiration: e.Zd(),
                    streams: a,
                    sessionIds: f ? VE(e) : [],
                    drmInfo: A,
                    appMetadata: s,
                    isIncomplete: !0,
                    sequenceMode: t.sequenceMode,
                    type: t.type,
                  },
                  Gh: c,
                }
              );
            }
            function xv(e) {
              return e.variants.some(function (t) {
                var r = t.audio && t.audio.encrypted;
                return (t.video && t.video.encrypted) || r;
              });
            }
            function dC(e) {
              return e.variants.some(function (t) {
                return (t.video ? t.video.drmInfos : [])
                  .concat(t.audio ? t.audio.drmInfos : [])
                  .some(function (r) {
                    return r.initData && r.initData.length;
                  });
              });
            }
            function hC(e, t, r, s) {
              if (
                ((t.expiration = r.Zd()), (r = VE(r)), (t.sessionIds = s ? r : []), xv(e) && s && !r.length)
              )
                throw new ee(2, 9, 9007);
            }
            d.remove = function (e) {
              return Tv(this, S3(this, e));
            };
            function S3(e, t) {
              var r, s, a, c, f, g;
              return W(function (m) {
                switch (m.g) {
                  case 1:
                    if ((lp(), (r = mv(t)), r == null || r.g != "manifest")) throw new ee(2, 9, 9004, t);
                    return ((s = r), (a = new Ri()), ce(m, 2), _(m, a.init(), 4));
                  case 4:
                    return _(m, rp(a, s.Pb(), s.cb()), 5);
                  case 5:
                    return ((c = m.h), _(m, c.getManifests([s.key()]), 6));
                  case 6:
                    return ((f = m.h), (g = f[0]), _(m, Promise.all([E3(e, g, a), A3(c, s, g)]), 2));
                  case 2:
                    return (ye(m), _(m, a.destroy(), 8));
                  case 8:
                    ve(m, 0);
                }
              });
            }
            function fC(e, t) {
              for (var r = [], s = I(e.streams), a = s.next(); !a.done; a = s.next())
                ((a = a.value),
                  t && a.type == "video"
                    ? r.push({ contentType: tn(a.mimeType, a.codecs), robustness: e.drmInfo.videoRobustness })
                    : t ||
                      a.type != "audio" ||
                      r.push({
                        contentType: tn(a.mimeType, a.codecs),
                        robustness: e.drmInfo.audioRobustness,
                      }));
              return r;
            }
            function E3(e, t, r) {
              return W(function (s) {
                return _(s, O3(e.g, e.h.drm, r, t), 0);
              });
            }
            function A3(e, t, r) {
              function s() {}
              var a = P3(r);
              return (yv(t, r), Promise.all([e.removeSegments(a, s), e.removeManifests([t.key()], s)]));
            }
            d.Qk = function () {
              return Tv(this, I3(this));
            };
            function I3(e) {
              var t, r, s, a, c, f, g, m, x, E;
              return W(function (A) {
                switch (A.g) {
                  case 1:
                    return (
                      lp(),
                      (t = e.g),
                      (r = e.h.drm),
                      (s = new Ri()),
                      (a = !1),
                      ce(A, 2),
                      _(A, s.init(), 4)
                    );
                  case 4:
                    ((c = []),
                      ZB(s, function (R) {
                        return c.push(R);
                      }),
                      (f = I(c)),
                      (g = f.next()));
                  case 5:
                    if (g.done) {
                      A.A(2);
                      break;
                    }
                    return ((m = g.value), _(A, m.getAll(), 8));
                  case 8:
                    return ((x = A.h), _(A, oC(r, t, x), 9));
                  case 9:
                    return ((E = A.h), _(A, m.remove(E), 10));
                  case 10:
                    (E.length != x.length && (a = !0), (g = f.next()), A.A(5));
                    break;
                  case 2:
                    return (ye(A), _(A, s.destroy(), 11));
                  case 11:
                    ve(A, 3);
                    break;
                  case 3:
                    return A.return(!a);
                }
              });
            }
            d.list = function () {
              return Tv(this, w3());
            };
            function w3() {
              var e, t, r;
              return W(function (s) {
                switch (s.g) {
                  case 1:
                    return (lp(), (e = []), (t = new Ri()), ce(s, 2), _(s, t.init(), 4));
                  case 4:
                    return (
                      (r = Promise.resolve()),
                      JB(t, function (a, c) {
                        r = r.then(function () {
                          var f;
                          return W(function (g) {
                            if (g.g == 1) return _(g, c.getAllManifests(), 2);
                            ((f = g.h),
                              f.forEach(function (m, x) {
                                ((m = yv(new ts("manifest", a.Pb, a.cb, x), m)), e.push(m));
                              }),
                              K(g));
                          });
                        });
                      }),
                      _(s, r, 2)
                    );
                  case 2:
                    return (ye(s), _(s, t.destroy(), 6));
                  case 6:
                    ve(s, 3);
                    break;
                  case 3:
                    return s.return(e);
                }
              });
            }
            function R3(e, t, r, s) {
              var a, c, f, g, m;
              return W(function (x) {
                if (x.g == 1)
                  return (
                    (a = null),
                    (c = e.g),
                    (f = {
                      networkingEngine: c,
                      filter: function () {
                        return Promise.resolve();
                      },
                      makeTextStreamsForClosedCaptions: function () {},
                      onTimelineRegionAdded: function () {},
                      onEvent: function () {},
                      onError: function (E) {
                        a = E;
                      },
                      isLowLatencyMode: function () {
                        return !1;
                      },
                      updateDuration: function () {},
                      newDrmInfo: function () {},
                      onManifestUpdated: function () {},
                      getBandwidthEstimate: function () {
                        return s.abr.defaultBandwidthEstimate;
                      },
                      onMetadata: function () {},
                      disableStream: function () {},
                      addFont: function () {},
                    }),
                    r.configure(s.manifest),
                    Hi(e),
                    _(x, r.start(t, f), 2)
                  );
                if (x.g != 3)
                  return (
                    (g = x.h),
                    Hi(e),
                    (m = gC(g)),
                    _(
                      x,
                      Promise.all(
                        Nm(m, function (E) {
                          return E.createSegmentIndex();
                        }),
                      ),
                      3,
                    )
                  );
                if ((Hi(e), a)) throw a;
                return x.return(g);
              });
            }
            function C3(e, t, r) {
              var s, a, c, f, g, m, x, E, A, R, b, D, M, P, G;
              return W(function (U) {
                switch (U.g) {
                  case 1:
                    return _(U, pC(e, t), 2);
                  case 2:
                    if (((s = U.h), s != "text/vtt")) throw new ee(1, 2, 2017, t);
                    return _(U, _3(t, e.g, e.h.streaming.retryParameters), 3);
                  case 3:
                    if (((a = U.h), (c = ku(s)), !c)) throw new ee(2, 2, 2014, s);
                    for (
                      f = c(),
                        g = {
                          periodStart: 0,
                          segmentStart: 0,
                          segmentEnd: r.presentationTimeline.getDuration(),
                          vttOffset: 0,
                        },
                        m = We(a),
                        x = f.parseMedia(m, g, t, []),
                        E = [],
                        A = I(x),
                        R = A.next(),
                        b = {};
                      !R.done;
                      b = { Vf: void 0, od: void 0 }, R = A.next()
                    )
                      ((b.od = R.value),
                        (b.Vf = null),
                        (D = (function (H) {
                          return function () {
                            return (H.Vf == null && (H.Vf = Ln([t], [H.od.payload])), H.Vf || []);
                          };
                        })(b)),
                        (M = new Be(b.od.startTime, b.od.endTime, D, 0, null, null, 0, 0, 1 / 0)),
                        b.od.payload.includes("#xywh") &&
                          ((P = b.od.payload.split("#xywh=")[1].split(",")),
                          P.length === 4 &&
                            M.Mf({
                              height: parseInt(P[3], 10),
                              positionX: parseInt(P[0], 10),
                              positionY: parseInt(P[1], 10),
                              width: parseInt(P[2], 10),
                            })),
                        E.push(M));
                    if (((G = s), !E.length)) {
                      U.A(4);
                      break;
                    }
                    return _(U, rl(E[0].P()[0], e.g, e.h.manifest.retryParameters), 5);
                  case 5:
                    G = U.h;
                  case 4:
                    return U.return({
                      id: e.m++,
                      originalId: null,
                      groupId: null,
                      createSegmentIndex: function () {
                        return Promise.resolve();
                      },
                      segmentIndex: new mt(E),
                      mimeType: G || "",
                      codecs: "",
                      kind: "",
                      encrypted: !1,
                      drmInfos: [],
                      keyIds: new Set(),
                      language: "und",
                      originalLanguage: null,
                      label: null,
                      type: "image",
                      primary: !1,
                      trickModeVideo: null,
                      dependencyStream: null,
                      emsgSchemeIdUris: null,
                      roles: [],
                      forced: !1,
                      channelsCount: null,
                      audioSamplingRate: null,
                      spatialAudio: !1,
                      closedCaptions: null,
                      tilesLayout: "1x1",
                      accessibilityPurpose: null,
                      external: !0,
                      fastSwitching: !1,
                      fullMimeTypes: new Set([tn(G || "", "")]),
                      isAudioMuxedInVideo: !1,
                      baseOriginalId: null,
                    });
                }
              });
            }
            function L3(e, t, r, s, a, c, f) {
              var g, m, x;
              return W(function (E) {
                if (E.g == 1) return c ? E.A(2) : _(E, pC(e, r), 3);
                if (
                  (E.g != 2 && (c = E.h),
                  (g = {
                    id: e.m++,
                    originalId: null,
                    groupId: null,
                    createSegmentIndex: function () {
                      return Promise.resolve();
                    },
                    segmentIndex: Oh(0, t.presentationTimeline.getDuration(), [r]),
                    mimeType: c || "",
                    codecs: f || "",
                    kind: a,
                    encrypted: !1,
                    drmInfos: [],
                    keyIds: new Set(),
                    language: s,
                    originalLanguage: s,
                    label: null,
                    type: nt,
                    primary: !1,
                    trickModeVideo: null,
                    dependencyStream: null,
                    emsgSchemeIdUris: null,
                    roles: [],
                    forced: !1,
                    channelsCount: null,
                    audioSamplingRate: null,
                    spatialAudio: !1,
                    closedCaptions: null,
                    accessibilityPurpose: null,
                    external: !0,
                    fastSwitching: !1,
                    fullMimeTypes: new Set([tn(c || "", f || "")]),
                    isAudioMuxedInVideo: !1,
                    baseOriginalId: null,
                  }),
                  (m = tn(g.mimeType, g.codecs)),
                  (x = Mu(m)),
                  !x)
                )
                  throw new ee(2, 2, 2014, c);
                return E.return(g);
              });
            }
            function pC(e, t) {
              var r;
              return W(function (s) {
                switch (s.g) {
                  case 1:
                    return (q(s, 2), _(s, rl(t, e.g, e.h.streaming.retryParameters), 4));
                  case 4:
                    ((r = s.h), he(s, 3));
                    break;
                  case 2:
                    ae(s);
                  case 3:
                    if (r) return s.return(r);
                    throw new ee(1, 2, 2011, t);
                }
              });
            }
            function _3(e, t, r) {
              var s, a, c;
              return W(function (f) {
                return f.g == 1
                  ? ((s = or), (a = fn([e], r)), (a.method = "GET"), _(f, t.request(s, a).promise, 2))
                  : ((c = f.h), f.return(c.data));
              });
            }
            d.md = function (e, t, r, s) {
              var a = this,
                c;
              return W(function (f) {
                return f.g == 1
                  ? ((c = new Eh({
                      vc: a.g,
                      onError: t,
                      zf: function () {},
                      onExpirationUpdated: function () {},
                      onEvent: function () {},
                    })),
                    c.configure(r.drm),
                    _(f, VP(c, e.variants, s), 2))
                  : f.g != 3
                    ? _(f, jE(c), 3)
                    : f.return(c);
              });
            };
            function b3(e, t, r, s) {
              var a = new Map(),
                c = gC(r),
                f = new Map();
              c = I(c);
              for (var g = c.next(); !g.done; g = c.next()) {
                g = g.value;
                var m = D3(e, t, r, g, s, a);
                f.set(g.id, m);
              }
              for (e = I(r.variants), t = e.next(); !t.done; t = e.next())
                ((t = t.value),
                  t.audio && f.get(t.audio.id).variantIds.push(t.id),
                  t.video && f.get(t.video.id).variantIds.push(t.id));
              return { streams: Array.from(f.values()), Gh: Array.from(a.values()) };
            }
            function D3(e, t, r, s, a, c) {
              var f = {
                  id: s.id,
                  originalId: s.originalId,
                  groupId: s.groupId,
                  primary: s.primary,
                  type: s.type,
                  mimeType: s.mimeType,
                  codecs: s.codecs,
                  frameRate: s.frameRate,
                  pixelAspectRatio: s.pixelAspectRatio,
                  hdr: s.hdr,
                  colorGamut: s.colorGamut,
                  videoLayout: s.videoLayout,
                  kind: s.kind,
                  language: s.language,
                  originalLanguage: s.originalLanguage,
                  label: s.label,
                  width: s.width || null,
                  height: s.height || null,
                  encrypted: s.encrypted,
                  keyIds: s.keyIds,
                  segments: [],
                  variantIds: [],
                  roles: s.roles,
                  forced: s.forced,
                  channelsCount: s.channelsCount,
                  audioSamplingRate: s.audioSamplingRate,
                  spatialAudio: s.spatialAudio,
                  closedCaptions: s.closedCaptions,
                  tilesLayout: s.tilesLayout,
                  mssPrivateData: s.mssPrivateData,
                  external: s.external,
                  fastSwitching: s.fastSwitching,
                  isAudioMuxedInVideo: s.isAudioMuxedInVideo,
                },
                g = a.offline.numberOfParallelDownloads,
                m = g === 0 ? s.id : 0;
              return (
                k3(s, r.presentationTimeline.Hb(), function (x, E) {
                  var A = cv(x),
                    R = void 0;
                  if (!c.has(A)) {
                    var b = x.endTime - x.startTime;
                    ((b = lC(t, s.id) * b), (b = WR(e.g, b)), c.set(A, new HR(x, b, m, !1, E)));
                  }
                  (x.ea &&
                    ((R = cv(x.ea)),
                    c.has(R) ||
                      ((b = lC(t, s.id) * 0.5), (b = WR(e.g, b)), c.set(R, new HR(x.ea, b, m, !0, E)))),
                    f.segments.push({
                      pendingInitSegmentRefId: R,
                      initSegmentKey: R ? 0 : null,
                      startTime: x.startTime,
                      endTime: x.endTime,
                      appendWindowStart: x.appendWindowStart,
                      appendWindowEnd: x.appendWindowEnd,
                      timestampOffset: x.timestampOffset,
                      tilesLayout: x.tilesLayout,
                      pendingSegmentRefId: A,
                      dataKey: 0,
                      mimeType: x.mimeType,
                      codecs: x.codecs,
                      thumbnailSprite: x.thumbnailSprite,
                    }),
                    g !== 0 && (m = (m + 1) % g));
                }),
                f
              );
            }
            function k3(e, t, r) {
              if (((t = e.segmentIndex.find(t)), t != null))
                for (var s = e.segmentIndex.get(t); s; ) (r(s, t), (s = e.segmentIndex.get(++t)));
            }
            function Hi(e) {
              if (e.j.g) throw new ee(2, 9, 7001);
            }
            function lp() {
              if (!vv()) throw new ee(2, 9, 9e3);
            }
            function Tv(e, t) {
              return W(function (r) {
                return r.g == 1
                  ? (e.i.push(t), ce(r, 2), _(r, t, 4))
                  : r.g != 2
                    ? r.return(r.h)
                    : (ye(r), ki(e.i, t), ve(r, 0));
              });
            }
            function M3(e, t) {
              var r = t.promise;
              return (
                e.i.push(r),
                t.finally(function () {
                  ki(e.i, r);
                })
              );
            }
            function P3(e) {
              var t = new Set();
              e = I(e.streams);
              for (var r = e.next(); !r.done; r = e.next()) {
                r = I(r.value.segments);
                for (var s = r.next(); !s.done; s = r.next())
                  ((s = s.value), s.initSegmentKey != null && t.add(s.initSegmentKey), t.add(s.dataKey));
              }
              return Array.from(t);
            }
            function O3(e, t, r, s) {
              var a, c, f;
              return W(function (g) {
                return g.g == 1
                  ? s.drmInfo
                    ? ((a = e3(r)),
                      (c = s.sessionIds.map(function (m) {
                        return {
                          sessionId: m,
                          keySystem: s.drmInfo.keySystem,
                          licenseUri: s.drmInfo.licenseServerUri,
                          serverCertificate: s.drmInfo.serverCertificate,
                          audioCapabilities: fC(s, !1),
                          videoCapabilities: fC(s, !0),
                        };
                      })),
                      _(g, oC(t, e, c), 2))
                    : g.return()
                  : g.g != 3
                    ? ((f = g.h), _(g, a.remove(f), 3))
                    : _(
                        g,
                        a.add(
                          c.filter(function (m) {
                            return !f.includes(m.sessionId);
                          }),
                        ),
                        0,
                      );
              });
            }
            function gC(e) {
              for (var t = new Set(), r = I(e.variants), s = r.next(); !s.done; s = r.next())
                ((s = s.value), s.audio && t.add(s.audio), s.video && t.add(s.video));
              for (r = I(e.textStreams), s = r.next(); !s.done; s = r.next()) t.add(s.value);
              for (e = I(e.imageStreams), r = e.next(); !r.done; r = e.next()) t.add(r.value);
              return t;
            }
            function N3(e) {
              e.variants.map(function (c) {
                return c.video;
              });
              var t = new Set(
                e.variants.map(function (c) {
                  return c.audio;
                }),
              );
              e = e.textStreams;
              for (var r = I(t), s = r.next(); !s.done; s = r.next()) {
                s = I(t);
                for (var a = s.next(); !a.done; a = s.next());
              }
              for (t = I(e), r = t.next(); !r.done; r = t.next())
                for (r = I(e), s = r.next(); !s.done; s = r.next());
            }
            (Ee("shaka.offline.Storage", kn),
              (kn.deleteAll = function () {
                var e;
                return W(function (t) {
                  return t.g == 1
                    ? ((e = new Ri()), ce(t, 2), _(t, t3(e), 2))
                    : t.g != 5
                      ? (ye(t), _(t, e.destroy(), 5))
                      : ve(t, 0);
                });
              }),
              (kn.prototype.list = kn.prototype.list),
              (kn.prototype.removeEmeSessions = kn.prototype.Qk),
              (kn.prototype.remove = kn.prototype.remove),
              (kn.prototype.store = kn.prototype.store),
              (kn.prototype.getNetworkingEngine = kn.prototype.Yb),
              (kn.prototype.getConfiguration = kn.prototype.getConfiguration),
              (kn.prototype.configure = kn.prototype.configure),
              (kn.prototype.destroy = kn.prototype.destroy),
              (kn.support = vv));
            var F3 = new Map()
              .set("org.w3.clearkey", "1077efecc0b24d02ace33c1e52e2fb4b")
              .set("com.widevine.alpha", "edef8ba979d64acea3c827dcd51d21ed")
              .set("com.microsoft.playready", "9a04f07998404286ab92e65be0885f95")
              .set("com.microsoft.playready.recommendation", "9a04f07998404286ab92e65be0885f95")
              .set("com.microsoft.playready.software", "9a04f07998404286ab92e65be0885f95")
              .set("com.microsoft.playready.hardware", "9a04f07998404286ab92e65be0885f95")
              .set("com.huawei.wiseplay", "3d5e6d359b9a41e8b843dd3c6e72c42c");
            W1("offline", vv);
            function Ci() {}
            function Ki(e, t) {
              for (e = { priority: t || 0, callback: e }, t = 0; t < Fc.length; t++)
                if (Fc[t].priority < e.priority) {
                  Fc.splice(t, 0, e);
                  return;
                }
              Fc.push(e);
            }
            (Ee("shaka.polyfill", Ci),
              (Ci.register = Ki),
              (Ci.installAll = function () {
                for (var e = I(Fc), t = e.next(); !t.done; t = e.next()) {
                  t = t.value;
                  try {
                    t.callback();
                  } catch (r) {
                    He("Error installing polyfill!", r);
                  }
                }
              }));
            var Fc = [];
            function up(e, t, r) {
              ((this.g = e), (this.i = t || null), (this.h = r || null), (this.keySystem = e.keySystem));
            }
            ((up.prototype.getConfiguration = function () {
              var e = this.g.getConfiguration();
              if (e.videoCapabilities)
                for (var t = I(e.videoCapabilities), r = t.next(); !r.done; r = t.next())
                  r.value.encryptionScheme = this.i;
              if (e.audioCapabilities)
                for (t = I(e.audioCapabilities), r = t.next(); !r.done; r = t.next())
                  r.value.encryptionScheme = this.h;
              return e;
            }),
              (up.prototype.createMediaKeys = function () {
                return this.g.createMediaKeys();
              }));
            function mC(e) {
              return e.startsWith("com.apple")
                ? "cbcs"
                : e.startsWith("com.widevine") ||
                    e.startsWith("com.microsoft") ||
                    e.startsWith("com.chromecast") ||
                    e.startsWith("org.w3") ||
                    e.startsWith("com.huawei")
                  ? "cenc"
                  : (He("EmeEncryptionSchemePolyfill: Unknown key system:", e, "Please contribute!"), null);
            }
            function yC(e) {
              if (!e) return !1;
              e = e.getConfiguration();
              var t = e.audioCapabilities && e.audioCapabilities[0];
              return !!(
                (e = (e.videoCapabilities && e.videoCapabilities[0]) || t) && e.encryptionScheme !== void 0
              );
            }
            function Sv(e, t) {
              return !!(!e || e == t || ((e == "cbcs" || e == "cbcs-1-9") && tt().ed()));
            }
            function vC() {}
            var Uc;
            function xC() {
              tt().Of() &&
                !Uc &&
                !navigator.emeEncryptionSchemePolyfilled &&
                navigator.requestMediaKeySystemAccess &&
                MediaKeySystemAccess.prototype.getConfiguration &&
                ((Uc = navigator.requestMediaKeySystemAccess),
                (navigator.requestMediaKeySystemAccess = U3),
                (navigator.emeEncryptionSchemePolyfilled = !0));
            }
            function U3(e, t) {
              var r = this,
                s;
              return W(function (a) {
                return a.g == 1
                  ? _(a, Uc.call(r, e, t), 2)
                  : ((s = a.h),
                    yC(s)
                      ? ((navigator.requestMediaKeySystemAccess = Uc), a.return(s))
                      : ((navigator.requestMediaKeySystemAccess = TC), a.return(TC.call(r, e, t))));
              });
            }
            function TC(e, t) {
              var r = this,
                s,
                a,
                c,
                f,
                g,
                m,
                x,
                E,
                A,
                R,
                b,
                D;
              return W(function (M) {
                if (M.g == 1) {
                  for (s = mC(e), a = [], c = I(t), f = c.next(); !f.done; f = c.next())
                    ((g = f.value),
                      (m = SC(g.videoCapabilities, s)),
                      (x = SC(g.audioCapabilities, s)),
                      (g.videoCapabilities && g.videoCapabilities.length && !m.length) ||
                        (g.audioCapabilities && g.audioCapabilities.length && !x.length) ||
                        ((E = Object.assign({}, g)),
                        (E.videoCapabilities = m),
                        (E.audioCapabilities = x),
                        a.push(E)));
                  if (!a.length)
                    throw (
                      (A = Error("Unsupported keySystem or supportedConfigurations.")),
                      (A.name = "NotSupportedError"),
                      (A.code = DOMException.NOT_SUPPORTED_ERR),
                      A
                    );
                  return _(M, Uc.call(r, e, a), 2);
                }
                return (
                  (R = M.h),
                  (D = b = null),
                  a[0] &&
                    (a[0].videoCapabilities && (b = a[0].videoCapabilities[0].encryptionScheme),
                    a[0].audioCapabilities && (D = a[0].audioCapabilities[0].encryptionScheme)),
                  M.return(new up(R, b, D))
                );
              });
            }
            function SC(e, t) {
              return (
                e &&
                e.filter(function (r) {
                  return Sv(r.encryptionScheme, t);
                })
              );
            }
            ((Ci.EmeEncryptionScheme = vC), (vC.install = xC), Ki(xC));
            function EC() {}
            var Bc;
            function AC() {
              tt().Of() &&
                !Bc &&
                !navigator.mediaCapabilitiesEncryptionSchemePolyfilled &&
                navigator.mediaCapabilities &&
                ((Bc = navigator.mediaCapabilities.decodingInfo),
                (navigator.mediaCapabilities.decodingInfo = B3),
                (navigator.mediaCapabilitiesEncryptionSchemePolyfilled = !0));
            }
            function B3(e) {
              var t = this,
                r,
                s;
              return W(function (a) {
                switch (a.g) {
                  case 1:
                    return _(a, Bc.call(t, e), 2);
                  case 2:
                    if (((r = a.h), !r.supported || !e.keySystemConfiguration)) return a.return(r);
                    if (((s = r.keySystemAccess), yC(s)))
                      return ((navigator.mediaCapabilities.decodingInfo = Bc), a.return(r));
                    if (((navigator.mediaCapabilities.decodingInfo = IC), s)) {
                      a.A(3);
                      break;
                    }
                    return _(a, wC(e), 4);
                  case 4:
                    return ((r.keySystemAccess = a.h), a.return(r));
                  case 3:
                    return a.return(IC.call(t, e));
                }
              });
            }
            function IC(e) {
              var t = this,
                r,
                s,
                a,
                c,
                f,
                g,
                m;
              return W(function (x) {
                switch (x.g) {
                  case 1:
                    return (
                      (s = r = null),
                      !e.keySystemConfiguration ||
                      ((a = e.keySystemConfiguration),
                      (c = a.keySystem),
                      (s = a.audio && a.audio.encryptionScheme),
                      (r = a.video && a.video.encryptionScheme),
                      (f = mC(c)),
                      (g = {
                        powerEfficient: !1,
                        smooth: !1,
                        supported: !1,
                        keySystemAccess: null,
                        configuration: e,
                      }),
                      Sv(s, f) && Sv(r, f))
                        ? _(x, Bc.call(t, e), 2)
                        : x.return(g)
                    );
                  case 2:
                    if (((m = x.h), m.keySystemAccess)) {
                      ((m.keySystemAccess = new up(m.keySystemAccess, r, s)), x.A(3));
                      break;
                    }
                    if (!e.keySystemConfiguration) {
                      x.A(3);
                      break;
                    }
                    return _(x, wC(e), 5);
                  case 5:
                    m.keySystemAccess = x.h;
                  case 3:
                    return x.return(m);
                }
              });
            }
            function wC(e) {
              var t, r;
              return W(function (s) {
                if (s.g == 1) {
                  var a = e.keySystemConfiguration,
                    c = [],
                    f = [];
                  return (
                    a.audio &&
                      c.push({
                        robustness: a.audio.robustness || "",
                        contentType: e.audio.contentType,
                        encryptionScheme: a.audio.encryptionScheme,
                      }),
                    a.video &&
                      f.push({
                        robustness: a.video.robustness || "",
                        contentType: e.video.contentType,
                        encryptionScheme: a.video.encryptionScheme,
                      }),
                    (a = {
                      initDataTypes: a.initDataType ? [a.initDataType] : [],
                      distinctiveIdentifier: a.distinctiveIdentifier,
                      persistentState: a.persistentState,
                      sessionTypes: a.sessionTypes,
                    }),
                    c.length && (a.audioCapabilities = c),
                    f.length && (a.videoCapabilities = f),
                    (t = a),
                    _(s, navigator.requestMediaKeySystemAccess(e.keySystemConfiguration.keySystem, [t]), 2)
                  );
                }
                return ((r = s.h), s.return(r));
              });
            }
            ((Ci.MCapEncryptionScheme = EC), (EC.install = AC), Ki(AC, -2));
            function cp() {}
            function RC() {
              tt().hc() ||
                (navigator.mediaCapabilities || (navigator.mediaCapabilities = {}),
                (cp.originalMcap = navigator.mediaCapabilities),
                (navigator.mediaCapabilities.decodingInfo = $3));
            }
            function $3(e) {
              var t, r, s, a, c, f, g, m, x, E, A;
              return W(function (R) {
                switch (R.g) {
                  case 1:
                    if (
                      ((t = {
                        supported: !1,
                        powerEfficient: !0,
                        smooth: !0,
                        keySystemAccess: null,
                        configuration: e,
                      }),
                      tt(),
                      (r = e.video),
                      (s = e.audio),
                      e.type != "media-source")
                    ) {
                      if (e.type == "file") {
                        if (
                          (r && ((a = r.contentType), (c = na().canPlayType(a) != ""), !c)) ||
                          (s && ((f = s.contentType), (g = na().canPlayType(f) != ""), !g))
                        )
                          return R.return(t);
                      } else return R.return(t);
                      R.A(2);
                      break;
                    }
                    if (!es()) return R.return(t);
                    if (!r) {
                      R.A(3);
                      break;
                    }
                    return _(R, G3(r), 4);
                  case 4:
                    if (((m = R.h), !m)) return R.return(t);
                  case 3:
                    if (s) {
                      var b = tt().Oa(),
                        D = s.contentType;
                      if (
                        (b === "CAST" && s.spatialRendering && (D += "; spatialRendering=true"),
                        (x = ti(D)),
                        !x)
                      )
                        return R.return(t);
                    }
                  case 2:
                    return e.keySystemConfiguration
                      ? ((E = e.keySystemConfiguration), _(R, j3(r, s, E), 6))
                      : ((t.supported = !0), R.return(t));
                  case 6:
                    (A = R.h) && ((t.supported = !0), (t.keySystemAccess = A));
                  case 5:
                    return R.return(t);
                }
              });
            }
            function G3(e) {
              var t, r, s;
              return W(function (a) {
                return a.g == 1
                  ? ((t = tt()), (r = t.Oa()), r !== "CAST" ? a.A(2) : _(a, V3(e), 3))
                  : a.g != 2
                    ? ((s = a.h), a.return(s))
                    : a.return(ti(e.contentType));
              });
            }
            function j3(e, t, r) {
              var s, a, c, f, g, m, x, E, A, R, b, D;
              return W(function (M) {
                switch (M.g) {
                  case 1:
                    ((s = []),
                      (a = []),
                      (c = []),
                      r.audio &&
                        ((f = { robustness: r.audio.robustness || "", contentType: t.contentType }),
                        tt().Bi() &&
                          t.contentType.includes('codecs="ac-3"') &&
                          (f.contentType = 'audio/mp4; codecs="ec-3"'),
                        r.audio.encryptionScheme &&
                          ((f.encryptionScheme = r.audio.encryptionScheme), c.push(r.audio.encryptionScheme)),
                        s.push(f)),
                      r.video &&
                        ((g = { robustness: r.video.robustness || "", contentType: e.contentType }),
                        r.video.encryptionScheme &&
                          ((g.encryptionScheme = r.video.encryptionScheme), c.push(r.video.encryptionScheme)),
                        a.push(g)),
                      (m = {
                        initDataTypes: [r.initDataType],
                        distinctiveIdentifier: r.distinctiveIdentifier,
                        persistentState: r.persistentState,
                        sessionTypes: r.sessionTypes,
                      }),
                      s.length && (m.audioCapabilities = s),
                      a.length && (m.videoCapabilities = a),
                      (x = e ? e.contentType : ""),
                      (E = t ? t.contentType : ""),
                      (A = Pi(x) + ";" + ro(x)),
                      (R = Pi(E) + ";" + ro(E)),
                      (b = r.keySystem),
                      (D = null),
                      q(M, 2));
                    var P = hm(A, R, b, c);
                    if (ka.has(P)) {
                      ((P = hm(A, R, b, c)), (D = ka.get(P) || null), M.A(4));
                      break;
                    }
                    return _(M, navigator.requestMediaKeySystemAccess(r.keySystem, [m]), 5);
                  case 5:
                    P = D = M.h;
                    var G = hm(A, R, b, c);
                    ka.set(G, P);
                  case 4:
                    he(M, 3);
                    break;
                  case 2:
                    ae(M);
                  case 3:
                    return M.return(D);
                }
              });
            }
            function V3(e) {
              var t, r, s, a, c;
              return W(function (f) {
                if (f.g == 1) {
                  if (!(l.cast && cast.__platform__ && cast.__platform__.canDisplayType))
                    return f.return(ti(e.contentType));
                  switch (
                    ((t = e.contentType),
                    e.width &&
                      e.height &&
                      e.width > 1280 &&
                      e.height > 720 &&
                      (t += "; width=" + e.width + "; height=" + e.height),
                    e.framerate &&
                      ((r = Math.round(e.framerate)), r < 24 || r > 30) &&
                      (t += "; framerate=" + e.framerate),
                    (s = e.transferFunction || ""),
                    s)
                  ) {
                    case "":
                    case "srgb":
                      break;
                    case "pq":
                      t += "; eotf=smpte2084";
                      break;
                    case "hlg":
                      t += "; eotf=arib-std-b67";
                      break;
                    default:
                      return f.return(!1);
                  }
                  return (
                    (a = !1),
                    (c = H3),
                    c.has(t) ? ((a = c.get(t)), f.A(2)) : _(f, cast.__platform__.canDisplayType(t), 3)
                  );
                }
                return (f.g != 2 && ((a = f.h), c.set(t, a)), f.return(a));
              });
            }
            ((Ci.MediaCapabilities = cp), (cp.install = RC), (cp.originalMcap = null));
            var H3 = new Map();
            Ki(RC, -1);
            function CC() {}
            function LC() {
              var e = tt(),
                t = e.Ha() === "WEBKIT" ? e.Ba() : null;
              for (
                (l.MediaSource || l.ManagedMediaSource) &&
                  t &&
                  l.MediaSource &&
                  (t <= 12 ? (_C(), K3()) : t <= 15 && _C()),
                  e = I(e.Li()),
                  t = e.next();
                !t.done;
                t = e.next()
              )
                z3(t.value);
              ((l.MediaSource || l.ManagedMediaSource) && W3(),
                l.MediaSource &&
                  MediaSource.isTypeSupported('video/webm; codecs="vp9"') &&
                  !MediaSource.isTypeSupported('video/webm; codecs="vp09.00.10.08"') &&
                  Y3());
            }
            function _C() {
              var e = MediaSource.prototype.addSourceBuffer;
              MediaSource.prototype.addSourceBuffer = function () {
                var t = e.apply(this, Qe.apply(0, arguments));
                return ((t.abort = function () {}), t);
              };
            }
            function K3() {
              var e = SourceBuffer.prototype.remove;
              SourceBuffer.prototype.remove = function (t, r) {
                return e.call(this, t, r - 0.001);
              };
            }
            function W3() {
              if (l.MediaSource) {
                var e = MediaSource.isTypeSupported.bind(MediaSource);
                MediaSource.isTypeSupported = function (r) {
                  return Du(r) != "mp2t" && e(r);
                };
              }
              if (l.ManagedMediaSource) {
                var t = ManagedMediaSource.isTypeSupported.bind(ManagedMediaSource);
                l.ManagedMediaSource.isTypeSupported = function (r) {
                  return Du(r) != "mp2t" && t(r);
                };
              }
            }
            function z3(e) {
              var t = MediaSource.isTypeSupported.bind(MediaSource);
              if (
                ((MediaSource.isTypeSupported = function (s) {
                  return ro(s) != e && t(s);
                }),
                l.ManagedMediaSource)
              ) {
                var r = ManagedMediaSource.isTypeSupported.bind(ManagedMediaSource);
                l.ManagedMediaSource.isTypeSupported = function (s) {
                  return ro(s) != e && r(s);
                };
              }
            }
            function Y3() {
              var e = MediaSource.isTypeSupported;
              tt().fj() &&
                (MediaSource.isTypeSupported = function (t) {
                  var r = t.split(/ *; */),
                    s = r.findIndex(function (f) {
                      return f.startsWith("codecs=");
                    });
                  if (s < 0) return e(t);
                  var a = r[s]
                      .replace("codecs=", "")
                      .replace(/"/g, "")
                      .split(/\s*,\s*/),
                    c = a.findIndex(function (f) {
                      return f.startsWith("vp09");
                    });
                  return (
                    c >= 0 && ((a[c] = "vp9"), (r[s] = 'codecs="' + a.join(",") + '"'), (t = r.join("; "))),
                    e(t)
                  );
                });
            }
            ((Ci.MediaSource = CC), (CC.install = LC), Ki(LC));
            function Ev() {}
            var Av, Iv, wv, Rv, Cv, Lv;
            function bC(e) {
              l.HTMLVideoElement &&
                l.WebKitMediaKeys &&
                l.shakaMediaKeysPolyfill != bv &&
                (e !== void 0 &&
                  e &&
                  ((Av = !0),
                  (Iv = Object.getOwnPropertyDescriptor(HTMLMediaElement.prototype, "mediaKeys")),
                  (wv = HTMLMediaElement.prototype.setMediaKeys),
                  (Rv = l.MediaKeys),
                  (Cv = l.MediaKeySystemAccess),
                  (Lv = navigator.requestMediaKeySystemAccess)),
                delete HTMLMediaElement.prototype.mediaKeys,
                (HTMLMediaElement.prototype.mediaKeys = null),
                (HTMLMediaElement.prototype.setMediaKeys = q3),
                (l.MediaKeys = $c),
                (l.MediaKeySystemAccess = dp),
                (navigator.requestMediaKeySystemAccess = X3),
                (l.shakaMediaKeysPolyfill = bv),
                ph.clear(),
                ka.clear());
            }
            function X3(e, t) {
              try {
                var r = new dp(e, t);
                return Promise.resolve(r);
              } catch (s) {
                return Promise.reject(s);
              }
            }
            function q3(e) {
              var t = this.mediaKeys;
              return (
                t && t != e && DC(t, null),
                delete this.mediaKeys,
                (this.mediaKeys = e) ? DC(e, this) : Promise.resolve()
              );
            }
            function Q3(e) {
              if (((e = We(e.initData)), Ti(e).getUint32(0, !0) + 4 != e.byteLength))
                throw new RangeError("Malformed FairPlay init data");
              ((e = Zs(e.subarray(4), !0)), (e = Er(e)));
              var t = new Event("encrypted");
              ((t.initDataType = "skd"), (t.initData = ir(e)), this.dispatchEvent(t));
            }
            ((Ci.PatchedMediaKeysApple = Ev),
              (Ev.uninstall = function () {
                l.shakaMediaKeysPolyfill == bv &&
                  Av &&
                  ((Av = !1),
                  Object.defineProperty(HTMLMediaElement.prototype, "mediaKeys", Iv),
                  (HTMLMediaElement.prototype.setMediaKeys = wv),
                  (l.MediaKeys = Rv),
                  (l.MediaKeySystemAccess = Cv),
                  (navigator.requestMediaKeySystemAccess = Lv),
                  (Iv = Lv = wv = Cv = Rv = null),
                  (l.shakaMediaKeysPolyfill = ""),
                  ph.clear(),
                  ka.clear());
              }),
              (Ev.install = bC));
            function dp(e, t) {
              if (((this.keySystem = e), e.startsWith("com.apple.fps")))
                for (e = I(t), t = e.next(); !t.done; t = e.next()) {
                  var r = t.value;
                  if (r.persistentState == "required") t = null;
                  else {
                    t = {
                      audioCapabilities: [],
                      videoCapabilities: [],
                      persistentState: "optional",
                      distinctiveIdentifier: "optional",
                      initDataTypes: r.initDataTypes,
                      sessionTypes: ["temporary"],
                      label: r.label,
                    };
                    var s = !1,
                      a = !1;
                    if (r.audioCapabilities)
                      for (var c = I(r.audioCapabilities), f = c.next(); !f.done; f = c.next())
                        ((f = f.value),
                          f.contentType &&
                            ((s = !0),
                            WebKitMediaKeys.isTypeSupported(this.keySystem, f.contentType.split(";")[0]) &&
                              (t.audioCapabilities.push(f), (a = !0))));
                    if (r.videoCapabilities)
                      for (r = I(r.videoCapabilities), c = r.next(); !c.done; c = r.next())
                        ((c = c.value),
                          c.contentType &&
                            ((s = !0),
                            WebKitMediaKeys.isTypeSupported(this.keySystem, c.contentType.split(";")[0]) &&
                              (t.videoCapabilities.push(c), (a = !0))));
                    (s || (a = WebKitMediaKeys.isTypeSupported(this.keySystem, "video/mp4")),
                      (t = a ? t : null));
                  }
                  if (t) {
                    this.g = t;
                    return;
                  }
                }
              throw (
                (e = Error("Unsupported keySystem")),
                (e.name = "NotSupportedError"),
                (e.code = DOMException.NOT_SUPPORTED_ERR),
                e
              );
            }
            ((dp.prototype.createMediaKeys = function () {
              var e = new $c(this.keySystem);
              return Promise.resolve(e);
            }),
              (dp.prototype.getConfiguration = function () {
                return this.g;
              }));
            function $c(e) {
              ((this.h = new WebKitMediaKeys(e)), (this.g = new gt()));
            }
            (($c.prototype.createSession = function (e) {
              if (((e = e || "temporary"), e != "temporary"))
                throw new TypeError("Session type " + e + " is unsupported on this platform.");
              return new _v(this.h);
            }),
              ($c.prototype.setServerCertificate = function () {
                return Promise.resolve(!1);
              }));
            function DC(e, t) {
              if ((e.g.Qa(), !t)) return Promise.resolve();
              e.g.D(t, "webkitneedkey", Q3);
              try {
                return (
                  il(t, HTMLMediaElement.HAVE_METADATA, e.g, function () {
                    t.webkitSetMediaKeys(e.h);
                  }),
                  Promise.resolve()
                );
              } catch (r) {
                return Promise.reject(r);
              }
            }
            $c.prototype.getStatusForPolicy = function () {
              return Promise.resolve("usable");
            };
            function _v(e) {
              (Lt.call(this),
                (this.i = null),
                (this.l = e),
                (this.g = this.h = null),
                (this.j = new gt()),
                (this.sessionId = ""),
                (this.expiration = NaN),
                (this.closed = new _t()),
                (this.keyStatuses = new kC()),
                (this.onkeystatuseschange = null));
            }
            (N(_v, Lt),
              (d = _v.prototype),
              (d.generateRequest = function (e, t) {
                var r = this;
                this.h = new _t();
                try {
                  var s = this.l.createSession("video/mp4", We(t));
                  ((this.i = s),
                    (this.sessionId = s.sessionId || ""),
                    this.j.D(this.i, "webkitkeymessage", function (a) {
                      (r.h && (r.h.resolve(), (r.h = null)),
                        (a = new Map()
                          .set(
                            "messageType",
                            r.keyStatuses.Kc() == null ? "license-request" : "license-renewal",
                          )
                          .set("message", ir(a.message))),
                        (a = new Me("message", a)),
                        r.dispatchEvent(a));
                    }),
                    this.j.D(s, "webkitkeyadded", function () {
                      r.g && (hp(r, "usable"), r.g.resolve(), (r.g = null));
                    }),
                    this.j.D(s, "webkitkeyerror", function () {
                      var a = Error("EME PatchedMediaKeysApple key error");
                      if (((a.errorCode = r.i.error), r.h != null)) (r.h.reject(a), (r.h = null));
                      else if (r.g != null) (r.g.reject(a), (r.g = null));
                      else
                        switch (r.i.error.code) {
                          case WebKitMediaKeyError.MEDIA_KEYERR_OUTPUT:
                          case WebKitMediaKeyError.MEDIA_KEYERR_HARDWARECHANGE:
                            hp(r, "output-not-allowed");
                            break;
                          default:
                            hp(r, "internal-error");
                        }
                    }),
                    hp(this, "status-pending"));
                } catch (a) {
                  this.h.reject(a);
                }
                return this.h;
              }),
              (d.load = function () {
                return Promise.reject(Error("MediaKeySession.load not yet supported"));
              }),
              (d.update = function (e) {
                this.g = new _t();
                try {
                  this.i.update(We(e));
                } catch (t) {
                  this.g.reject(t);
                }
                return this.g;
              }),
              (d.close = function () {
                try {
                  (this.i.close(), this.closed.resolve(), this.j.Qa());
                } catch (e) {
                  this.closed.reject(e);
                }
                return this.closed;
              }),
              (d.remove = function () {
                return Promise.reject(
                  Error(
                    "MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform",
                  ),
                );
              }));
            function hp(e, t) {
              var r = e.keyStatuses;
              ((r.size = t == null ? 0 : 1),
                (r.g = t),
                (t = new Me("keystatuseschange")),
                e.dispatchEvent(t),
                e.onkeystatuseschange && e.onkeystatuseschange(t));
            }
            function kC() {
              ((this.size = 0), (this.g = void 0));
            }
            ((d = kC.prototype),
              (d.Kc = function () {
                return this.g;
              }),
              (d.forEach = function (e) {
                this.g && e(this.g, Kd.value());
              }),
              (d.get = function (e) {
                if (this.has(e)) return this.g;
              }),
              (d.has = function (e) {
                var t = Kd.value();
                return !!(this.g && fs(e, t));
              }),
              (d.entries = function () {}),
              (d.keys = function () {}),
              (d.values = function () {}));
            var bv = "apple";
            Ki(function () {
              l.HTMLVideoElement &&
                l.WebKitMediaKeys &&
                ((navigator.requestMediaKeySystemAccess && MediaKeySystemAccess.prototype.getConfiguration) ||
                  bC());
            });
            function MC() {}
            function PC() {
              if (l.MediaKeys) {
                var e = tt();
                (MediaKeys.prototype.setServerCertificate && e.we()) ||
                  (MediaKeys.prototype.setServerCertificate = J3);
              }
            }
            function J3() {
              return Promise.resolve(!1);
            }
            ((Ci.PatchedMediaKeysCert = MC), (MC.install = PC), Ki(PC));
            function OC() {}
            function NC() {
              if (
                !(
                  !l.HTMLVideoElement ||
                  (navigator.requestMediaKeySystemAccess && MediaKeySystemAccess.prototype.getConfiguration)
                )
              ) {
                if (HTMLMediaElement.prototype.webkitGenerateKeyRequest) Ov = "webkit";
                else if (!HTMLMediaElement.prototype.generateKeyRequest) return;
                ((navigator.requestMediaKeySystemAccess = Z3),
                  delete HTMLMediaElement.prototype.mediaKeys,
                  (HTMLMediaElement.prototype.mediaKeys = null),
                  (HTMLMediaElement.prototype.setMediaKeys = e4),
                  (l.MediaKeys = Gc),
                  (l.MediaKeySystemAccess = fp),
                  (l.shakaMediaKeysPolyfill = t4));
              }
            }
            function Dv(e) {
              var t = Ov;
              return t ? t + e.charAt(0).toUpperCase() + e.slice(1) : e;
            }
            function Z3(e, t) {
              try {
                var r = new fp(e, t);
                return Promise.resolve(r);
              } catch (s) {
                return Promise.reject(s);
              }
            }
            function e4(e) {
              var t = this.mediaKeys;
              return (
                t && t != e && FC(t, null),
                delete this.mediaKeys,
                (this.mediaKeys = e) && FC(e, this),
                Promise.resolve()
              );
            }
            ((Ci.PatchedMediaKeysWebkit = OC), (OC.install = NC));
            function fp(e, t) {
              this.g = this.keySystem = e;
              var r = !1;
              e == "org.w3.clearkey" && ((this.g = "webkit-org.w3.clearkey"), (r = !1));
              var s = !1,
                a = document.getElementsByTagName("video");
              ((a = a.length ? a[0] : document.createElement("video")), (t = I(t)));
              for (var c = t.next(); !c.done; c = t.next()) {
                c = c.value;
                var f = {
                    audioCapabilities: [],
                    videoCapabilities: [],
                    persistentState: "optional",
                    distinctiveIdentifier: "optional",
                    initDataTypes: c.initDataTypes,
                    sessionTypes: ["temporary"],
                    label: c.label,
                  },
                  g = !1;
                if (c.audioCapabilities)
                  for (var m = I(c.audioCapabilities), x = m.next(); !x.done; x = m.next())
                    ((x = x.value),
                      x.contentType &&
                        ((g = !0),
                        a.canPlayType(x.contentType.split(";")[0], this.g) &&
                          (f.audioCapabilities.push(x), (s = !0))));
                if (c.videoCapabilities)
                  for (m = I(c.videoCapabilities), x = m.next(); !x.done; x = m.next())
                    ((x = x.value),
                      x.contentType &&
                        ((g = !0),
                        a.canPlayType(x.contentType, this.g) && (f.videoCapabilities.push(x), (s = !0))));
                if (
                  (g || (s = a.canPlayType("video/mp4", this.g) || a.canPlayType("video/webm", this.g)),
                  c.persistentState == "required" &&
                    (r
                      ? ((f.persistentState = "required"), (f.sessionTypes = ["persistent-license"]))
                      : (s = !1)),
                  s)
                ) {
                  this.h = f;
                  return;
                }
              }
              throw (
                (r = "Unsupported keySystem"),
                (e == "org.w3.clearkey" || e == "com.widevine.alpha") &&
                  (r = "None of the requested configurations were supported."),
                (e = Error(r)),
                (e.name = "NotSupportedError"),
                (e.code = DOMException.NOT_SUPPORTED_ERR),
                e
              );
            }
            ((fp.prototype.createMediaKeys = function () {
              var e = new Gc(this.g);
              return Promise.resolve(e);
            }),
              (fp.prototype.getConfiguration = function () {
                return this.h;
              }));
            function Gc(e) {
              ((this.l = e), (this.h = null), (this.g = new gt()), (this.i = []), (this.j = new Map()));
            }
            function FC(e, t) {
              ((e.h = t), e.g.Qa());
              var r = Ov;
              t &&
                (e.g.D(t, r + "needkey", function (s) {
                  var a = new CustomEvent("encrypted");
                  ((a.initDataType = "cenc"), (a.initData = ir(s.initData)), e.h.dispatchEvent(a));
                }),
                e.g.D(t, r + "keymessage", function (s) {
                  var a = kv(e, s.sessionId);
                  a &&
                    ((s = new Map()
                      .set("messageType", a.keyStatuses.Kc() == null ? "licenserequest" : "licenserenewal")
                      .set("message", s.message)),
                    (s = new Me("message", s)),
                    a.h && (a.h.resolve(), (a.h = null)),
                    a.dispatchEvent(s));
                }),
                e.g.D(t, r + "keyadded", function (s) {
                  (s = kv(e, s.sessionId)) && s.ready();
                }),
                e.g.D(t, r + "keyerror", function (s) {
                  var a = kv(e, s.sessionId);
                  if (a) {
                    var c = Error("EME v0.1b key error"),
                      f = s.errorCode;
                    ((f.systemCode = s.systemCode),
                      (c.errorCode = f),
                      !s.sessionId && a.h
                        ? (s.systemCode == 45 && (c.message = "Unsupported session type."),
                          a.h.reject(c),
                          (a.h = null))
                        : s.sessionId && a.g
                          ? (a.g.reject(c), (a.g = null))
                          : ((c = s.systemCode),
                            s.errorCode.code == MediaKeyError.MEDIA_KEYERR_OUTPUT
                              ? pp(a, "output-restricted")
                              : c == 1
                                ? pp(a, "expired")
                                : pp(a, "internal-error")));
                  }
                }));
            }
            ((Gc.prototype.createSession = function (e) {
              if (((e = e || "temporary"), e != "temporary" && e != "persistent-license"))
                throw new TypeError("Session type " + e + " is unsupported on this platform.");
              var t = this.h || document.createElement("video");
              return (t.src || (t.src = "about:blank"), (e = new Mv(t, this.l, e)), this.i.push(e), e);
            }),
              (Gc.prototype.setServerCertificate = function () {
                return Promise.resolve(!1);
              }),
              (Gc.prototype.getStatusForPolicy = function () {
                return Promise.resolve("usable");
              }));
            function kv(e, t) {
              var r = e.j.get(t);
              return r || ((r = e.i.shift()) ? ((r.sessionId = t), e.j.set(t, r), r) : null);
            }
            function Mv(e, t, r) {
              (Lt.call(this),
                (this.j = e),
                (this.m = !1),
                (this.g = this.h = null),
                (this.i = t),
                (this.l = r),
                (this.sessionId = ""),
                (this.expiration = NaN),
                (this.closed = new _t()),
                (this.keyStatuses = new BC()),
                (this.onkeystatuseschange = null));
            }
            (N(Mv, Lt),
              (d = Mv.prototype),
              (d.ready = function () {
                (pp(this, "usable"), this.g && this.g.resolve(), (this.g = null));
              }));
            function UC(e, t, r) {
              if (e.m) return Promise.reject(Error("The session is already initialized."));
              e.m = !0;
              try {
                if (e.l == "persistent-license")
                  if (r) var s = We(Er("LOAD_SESSION|" + r));
                  else {
                    var a = Er("PERSISTENT|");
                    s = dn(a, t);
                  }
                else s = We(t);
              } catch (f) {
                return Promise.reject(f);
              }
              e.h = new _t();
              var c = Dv("generateKeyRequest");
              try {
                e.j[c](e.i, s);
              } catch (f) {
                if (f.name != "InvalidStateError") return ((e.h = null), Promise.reject(f));
                new it(function () {
                  try {
                    e.j[c](e.i, s);
                  } catch (g) {
                    (e.h.reject(g), (e.h = null));
                  }
                }).ka(0.01);
              }
              return e.h;
            }
            function Pv(e, t, r) {
              if (e.g)
                e.g
                  .then(function () {
                    return Pv(e, t, r);
                  })
                  .catch(function () {
                    return Pv(e, t, r);
                  });
              else {
                if (((e.g = t), e.i == "webkit-org.w3.clearkey")) {
                  var s = zt(r),
                    a = JSON.parse(s);
                  (a.keys[0].kty != "oct" &&
                    (e.g.reject(Error("Response is not a valid JSON Web Key Set.")), (e.g = null)),
                    (s = rr(a.keys[0].k)),
                    (a = rr(a.keys[0].kid)));
                } else ((s = We(r)), (a = null));
                var c = Dv("addKey");
                try {
                  e.j[c](e.i, s, a, e.sessionId);
                } catch (f) {
                  (e.g.reject(f), (e.g = null));
                }
              }
            }
            function pp(e, t) {
              var r = e.keyStatuses;
              ((r.size = t == null ? 0 : 1),
                (r.g = t),
                (t = new Me("keystatuseschange")),
                e.dispatchEvent(t),
                e.onkeystatuseschange && e.onkeystatuseschange(t));
            }
            ((d.generateRequest = function (e, t) {
              return UC(this, t, null);
            }),
              (d.load = function (e) {
                return this.l == "persistent-license"
                  ? UC(this, null, e)
                  : Promise.reject(Error("Not a persistent session."));
              }),
              (d.update = function (e) {
                var t = new _t();
                return (Pv(this, t, e), t);
              }),
              (d.close = function () {
                if (this.l != "persistent-license") {
                  if (!this.sessionId)
                    return (this.closed.reject(Error("The session is not callable.")), this.closed);
                  var e = Dv("cancelKeyRequest");
                  try {
                    this.j[e](this.i, this.sessionId);
                  } catch (t) {}
                }
                return (this.closed.resolve(), this.closed);
              }),
              (d.remove = function () {
                return this.l != "persistent-license"
                  ? Promise.reject(Error("Not a persistent session."))
                  : this.close();
              }));
            function BC() {
              ((this.size = 0), (this.g = void 0));
            }
            ((d = BC.prototype),
              (d.Kc = function () {
                return this.g;
              }),
              (d.forEach = function (e) {
                this.g && e(this.g, Kd.value());
              }),
              (d.get = function (e) {
                if (this.has(e)) return this.g;
              }),
              (d.has = function (e) {
                var t = Kd.value();
                return !!(this.g && fs(e, t));
              }),
              (d.entries = function () {}),
              (d.keys = function () {}),
              (d.values = function () {}));
            var Ov = "",
              t4 = "webkit";
            Ki(NC);
            function $C() {}
            function GC() {
              l.crypto && ("randomUUID" in l.crypto || (l.crypto.randomUUID = n4));
            }
            function n4() {
              var e = URL.createObjectURL(new Blob()),
                t = e.toString();
              return (URL.revokeObjectURL(e), t.substr(t.lastIndexOf("/") + 1));
            }
            ((Ci.RandomUUID = $C), ($C.install = GC), Ki(GC));
            function jC() {}
            function VC() {
              var e = Symbol.prototype;
              "description" in e || Object.defineProperty(e, "description", { get: i4 });
            }
            function i4() {
              var e = /\((.*)\)/.exec(this.toString());
              return e ? e[1] : void 0;
            }
            ((Ci.Symbol = jC), (jC.install = VC), Ki(VC));
            function HC() {}
            function KC() {
              for (
                var e = I([
                    Uint8Array,
                    Uint8ClampedArray,
                    Uint16Array,
                    Uint32Array,
                    Int8Array,
                    Int16Array,
                    Int32Array,
                    Float32Array,
                    Float64Array,
                  ]),
                  t = e.next();
                !t.done;
                t = e.next()
              )
                ((t = t.value),
                  t.prototype.indexOf || (t.prototype.indexOf = r4),
                  t.prototype.lastIndexOf || (t.prototype.lastIndexOf = s4),
                  t.prototype.includes || (t.prototype.includes = o4));
            }
            function r4(e, t) {
              return Array.prototype.indexOf.call(this, e, t);
            }
            function s4(e, t) {
              return Array.prototype.lastIndexOf.call(this, e, t);
            }
            function o4(e, t) {
              return this.indexOf(e, t) !== -1;
            }
            ((Ci.TypedArray = HC), (HC.install = KC), Ki(KC));
            function WC() {}
            function zC() {
              if (l.HTMLMediaElement) {
                var e = HTMLMediaElement.prototype.play;
                HTMLMediaElement.prototype.play = function () {
                  var t = e.apply(this);
                  return (t && t.catch(function () {}), t);
                };
              }
            }
            ((Ci.VideoPlayPromise = WC), (WC.install = zC), Ki(zC));
            function YC() {}
            function XC() {
              if (l.HTMLVideoElement) {
                var e = HTMLVideoElement.prototype;
                !e.getVideoPlaybackQuality &&
                  ("webkitDroppedFrameCount" in e || typeof na().webkitDroppedFrameCount == "number") &&
                  (e.getVideoPlaybackQuality = a4);
              }
            }
            function a4() {
              return {
                droppedVideoFrames: this.webkitDroppedFrameCount,
                totalVideoFrames: this.webkitDecodedFrameCount,
                corruptedVideoFrames: 0,
                creationTime: NaN,
                totalFrameDelay: 0,
              };
            }
            ((Ci.VideoPlaybackQuality = YC), (YC.install = XC), Ki(XC));
            function qC() {}
            function QC() {
              if (!l.VTTCue && l.TextTrackCue) {
                var e = null,
                  t = TextTrackCue.length;
                if (t == 3) e = Nv;
                else if (t == 6) e = l4;
                else {
                  try {
                    var r = !!Nv(1, 2, "");
                  } catch (s) {
                    r = !1;
                  }
                  r && (e = Nv);
                }
                e &&
                  (l.VTTCue = function (s, a, c) {
                    return e(s, a, c);
                  });
              }
            }
            function Nv(e, t, r) {
              return new l.TextTrackCue(e, t, r);
            }
            function l4(e, t, r) {
              return new l.TextTrackCue(e + "-" + t + "-" + r, e, t, r);
            }
            ((Ci.VTTCue = qC), (qC.install = QC), Ki(QC));
            function bn(e) {
              (Lt.call(this),
                (this.g = e),
                (this.m = null),
                (this.h = []),
                (this.j = -1),
                (this.i = this.l = null),
                (this.o = new gt()));
            }
            (N(bn, Lt),
              (d = bn.prototype),
              (d.destroy = function () {
                var e = this;
                return W(function (t) {
                  if (t.g == 1) return _(t, e.removeAllItems(), 2);
                  ((e.g = null), e.o && (e.o.release(), (e.o = null)), Lt.prototype.release.call(e), K(t));
                });
              }),
              (d.configure = function (e) {
                this.m = e;
              }),
              (d.getConfiguration = function () {
                return this.m;
              }),
              (d.getCurrentItem = function () {
                return this.h.length && this.j >= 0 && this.j < this.h.length ? this.h[this.j] : null;
              }),
              (d.getCurrentItemIndex = function () {
                return this.j;
              }),
              (d.getItems = function () {
                return this.h.slice();
              }),
              (d.insertItems = function (e) {
                (this.h.push.apply(this.h, V(e)), this.dispatchEvent(new Me("itemsinserted")));
              }),
              (d.removeAllItems = function () {
                var e = this,
                  t,
                  r,
                  s,
                  a;
                return W(function (c) {
                  if (c.g == 1) return (e.o.Qa(), e.h.length && e.j >= 0 ? _(c, e.g.Cc(), 2) : c.A(2));
                  if (c.g != 4) {
                    for (
                      t = [],
                        e.i && (e.i.preloadManager.l || t.push(e.i.preloadManager.destroy()), (e.i = null)),
                        e.l && (e.l.preloadManager.l || t.push(e.l.preloadManager.destroy()), (e.l = null)),
                        r = I(e.h),
                        s = r.next();
                      !s.done;
                      s = r.next()
                    )
                      ((a = s.value),
                        a.preloadManager && !a.preloadManager.l && t.push(a.preloadManager.destroy()));
                    return t.length ? _(c, Promise.all(t), 4) : c.A(4);
                  }
                  ((e.h = []), (e.j = -1), e.dispatchEvent(new Me("itemsremoved")), K(c));
                });
              }),
              (d.playItem = function (e) {
                var t = this,
                  r,
                  s,
                  a,
                  c,
                  f,
                  g,
                  m,
                  x,
                  E,
                  A,
                  R,
                  b,
                  D,
                  M,
                  P,
                  G,
                  U;
                return W(function (H) {
                  switch (H.g) {
                    case 1:
                      if ((t.o.Qa(), !t.h.length || e >= t.h.length)) throw new ee(2, 7, 7007);
                      if (
                        ((r = t.getCurrentItem()),
                        (s = t.h[e]),
                        t.j != e && ((t.j = e), t.dispatchEvent(new Me("currentitemchanged"))),
                        (a = t.g.bf()),
                        (c = t.m ? t.m.preloadNextUrlWindow : 0),
                        c > 0 &&
                          ((f = !1),
                          t.o.D(a, "timeupdate", function () {
                            var Q, ne, z, J;
                            return W(function (X) {
                              switch (X.g) {
                                case 1:
                                  if (t.l || t.h.length <= 1 || f || t.g.W() || !a.duration)
                                    return X.return();
                                  if (((Q = t.g.Ra().end - a.currentTime), isNaN(Q))) {
                                    X.A(0);
                                    break;
                                  }
                                  if (!(Q <= c)) {
                                    X.A(0);
                                    break;
                                  }
                                  if (
                                    ((ne = t.m && t.m.repeatMode),
                                    (z = null),
                                    t.j + 1 < t.h.length ? (z = t.h[t.j + 1]) : ne == 1 && (z = t.h[0]),
                                    !z || (z.preloadManager && !z.preloadManager.l))
                                  ) {
                                    X.A(0);
                                    break;
                                  }
                                  return (
                                    (f = !0),
                                    (J = null),
                                    q(X, 5),
                                    _(X, t.g.preload(z.manifestUri, z.startTime, z.mimeType, z.config), 7)
                                  );
                                case 7:
                                  ((J = X.h), he(X, 6));
                                  break;
                                case 5:
                                  (ae(X), (J = null));
                                case 6:
                                  ((t.l = { item: z, preloadManager: J }), (f = !1), K(X));
                              }
                            });
                          })),
                        t.o.D(t.g, "complete", function () {
                          var Q = t.m && t.m.repeatMode,
                            ne = !1;
                          if (Q == 2) ne = !0;
                          else {
                            var z = t.j + 1;
                            z < t.h.length
                              ? t.playItem(z)
                              : Q == 1 && (t.h.length == 1 ? (ne = !0) : t.playItem(0));
                          }
                          ne &&
                            (a.paused
                              ? ((a.currentTime = t.g.Ra().start), a.play())
                              : t.o.D(a, "paused", function () {
                                  ((a.currentTime = t.g.Ra().start), a.play());
                                }));
                        }),
                        (g = s.manifestUri),
                        s.preloadManager && !s.preloadManager.l && (g = s.preloadManager),
                        (m = !1),
                        t.l && t.l.item == s && t.l.preloadManager
                          ? (g = t.l.preloadManager)
                          : t.i &&
                            t.i.item == s &&
                            t.i.preloadManager &&
                            ((g = t.i.preloadManager), (m = !0)),
                        !t.i)
                      ) {
                        H.A(2);
                        break;
                      }
                      if (m || t.i.preloadManager.l) {
                        H.A(3);
                        break;
                      }
                      return _(H, t.i.preloadManager.destroy(), 3);
                    case 3:
                      t.i = null;
                    case 2:
                      if (!(t.m && t.m.preloadPrevItem && r && t.g.$d() === $n)) {
                        H.A(5);
                        break;
                      }
                      return ((x = null), q(H, 6), _(H, t.g.jj(), 8));
                    case 8:
                      ((x = H.h), he(H, 7));
                      break;
                    case 6:
                      (ae(H), (x = null));
                    case 7:
                      t.i = { item: r, preloadManager: x };
                    case 5:
                      return (
                        s.config && (t.g.Oi(), t.g.configure(s.config)),
                        _(H, t.g.load(g, s.startTime, s.mimeType), 9)
                      );
                    case 9:
                      if (((t.l = null), s.extraText))
                        for (E = I(s.extraText), A = E.next(); !A.done; A = E.next())
                          ((R = A.value),
                            R.mime
                              ? t.g.Rd(R.uri, R.language, R.kind, R.mime, R.codecs)
                              : t.g.Rd(R.uri, R.language, R.kind));
                      if (s.extraThumbnail)
                        for (b = I(s.extraThumbnail), D = b.next(); !D.done; D = b.next())
                          ((M = D.value), t.g.Pe(M));
                      if (s.extraChapter)
                        for (P = I(s.extraChapter), G = P.next(); !G.done; G = P.next())
                          ((U = G.value), t.g.Oe(U.uri, U.language, U.mime));
                      K(H);
                  }
                });
              }),
              Ee("shaka.queue.QueueManager", bn),
              (bn.prototype.playItem = bn.prototype.playItem),
              (bn.prototype.removeAllItems = bn.prototype.removeAllItems),
              (bn.prototype.insertItems = bn.prototype.insertItems),
              (bn.prototype.getItems = bn.prototype.getItems),
              (bn.prototype.getCurrentItemIndex = bn.prototype.getCurrentItemIndex),
              (bn.prototype.getCurrentItem = bn.prototype.getCurrentItem),
              (bn.prototype.getConfiguration = bn.prototype.getConfiguration),
              (bn.prototype.configure = bn.prototype.configure),
              (bn.prototype.destroy = bn.prototype.destroy),
              (vf = function (e) {
                return new bn(e);
              }));
            function Wi() {}
            ((Wi.prototype.parseInit = function () {}),
              (Wi.prototype.setSequenceMode = function () {}),
              (Wi.prototype.setManifestType = function () {}),
              (Wi.prototype.parseMedia = function (e, t) {
                var r = null,
                  s = [];
                ((e = zt(e).split(/\r?\n/)), (e = I(e)));
                for (var a = e.next(); !a.done; a = e.next())
                  if ((a = a.value) && !/^\s+$/.test(a) && (a = u4.exec(a))) {
                    var c = c4.exec(a[1]);
                    ((c = parseInt(c[1], 10) * 60 + parseFloat(c[2].replace(",", "."))),
                      (a = new $t(c, t.segmentEnd ? t.segmentEnd : c + 2, a[2])),
                      r && ((r.endTime = c), s.push(r)),
                      (r = a));
                  }
                return (r && s.push(r), s);
              }),
              Ee("shaka.text.LrcTextParser", Wi),
              (Wi.prototype.parseMedia = Wi.prototype.parseMedia),
              (Wi.prototype.setManifestType = Wi.prototype.setManifestType),
              (Wi.prototype.setSequenceMode = Wi.prototype.setSequenceMode),
              (Wi.prototype.parseInit = Wi.prototype.parseInit));
            var u4 = /^\[(\d{1,2}:\d{1,2}(?:[.,]\d{1,3})?)\](.*)/,
              c4 = /^(\d+):(\d{1,2}(?:[.,]\d{1,3})?)$/;
            Un("application/x-subtitle-lrc", function () {
              return new Wi();
            });
            function $i() {
              this.g = "UNKNOWN";
            }
            (($i.prototype.parseInit = function () {}),
              ($i.prototype.setSequenceMode = function () {}),
              ($i.prototype.setManifestType = function (e) {
                this.g = e;
              }),
              ($i.prototype.parseMedia = function (e, t, r, s) {
                var a = zt(e);
                if (((e = []), a == "")) return e;
                var c = Wo(a, "tt", !0);
                if (!c) throw new ee(2, 2, 2005, "Failed to parse TTML.");
                if (((a = Br(c, "body")[0]), !a)) return [];
                var f = Xr(c, jc, "frameRate"),
                  g = Xr(c, jc, "subFrameRate"),
                  m = Xr(c, jc, "frameRateMultiplier"),
                  x = Xr(c, jc, "tickRate"),
                  E = Xr(c, jc, "cellResolution"),
                  A = c.attributes["xml:space"] || "default",
                  R = Xr(c, yp, "extent");
                if (A != "default" && A != "preserve")
                  throw new ee(2, 2, 2005, "Invalid xml:space value: " + A);
                ((A = A == "default"),
                  (f = new g4(f, g, m, x)),
                  (E = p4(E)),
                  (g = Br(c, "metadata")[0]),
                  (g = (g ? g.children : []).filter(function (M) {
                    return M != "\n";
                  })),
                  (m = Br(c, "style")),
                  (c = Br(c, "region")),
                  (x = []));
                for (var b = I(c), D = b.next(); !D.done; D = b.next())
                  (D = d4(this, D.value, m, R)) && x.push(D);
                if (Rt(a, "p").length) throw new ee(2, 2, 2001, "<p> can only be inside <div> in TTML");
                for (R = I(Rt(a, "div")), b = R.next(); !b.done; b = R.next())
                  if (Rt(b.value, "span").length)
                    throw new ee(2, 2, 2001, "<span> can only be inside <p> in TTML");
                return (
                  (t = JC(this, a, t, f, g, m, c, x, A, E, null, !1, r, s)) &&
                    (t.backgroundColor || (t.backgroundColor = "transparent"), e.push(t)),
                  e
                );
              }));
            function JC(e, t, r, s, a, c, f, g, m, x, E, A, R, b) {
              var D = E;
              if (Qd(t)) {
                if (!A) return null;
                var M = { tagName: "span", children: [cn(t)], attributes: {}, parent: null };
              } else M = t;
              for (
                var P = null, G = I(lL), U = G.next();
                !U.done && !(P = mp(M, "backgroundImage", a, "#", U.value)[0]);
                U = G.next()
              );
              ((G = null), (U = Xr(M, lL, "backgroundImage")));
              var H = /^(urn:)(mpeg:[a-z0-9][a-z0-9-]{0,31}:)(subs:)([0-9]+)$/;
              if (U && H.test(U)) {
                if (((G = parseInt(U.split(":").pop(), 10) - 1), G >= b.length)) return null;
                G = b[G];
              } else
                R &&
                  U &&
                  !U.startsWith("#") &&
                  ((H = new un(R)), (U = new un(U)), (U = H.resolve(U).toString()) && (G = U));
              if (
                ((t.tagName == "p" || P || G) && (A = !0),
                (t = A),
                (U = (M.attributes["xml:space"] || (m ? "default" : "preserve")) == "default"),
                (H = M.children.every(Qd)),
                (m = []),
                !H)
              )
                for (var Q = I(M.children), ne = Q.next(); !ne.done; ne = Q.next())
                  (ne = JC(e, ne.value, r, s, a, c, f, g, U, x, M, A, R, b)) && m.push(ne);
              if (
                ((a = E != null),
                (R = cn(M)),
                (R = M.children.length && R && /\S/.test(R)),
                (Q = M.attributes.begin || M.attributes.end || M.attributes.dur),
                !(Q || R || M.tagName == "br" || m.length != 0 || (a && !U)))
              )
                return null;
              for (b = tL(M, s), R = b.start, b = b.end; D && D.tagName && D.tagName != "tt"; )
                ((b = f4(D, s, R, b)), (R = b.start), (b = b.end), (D = D.parent));
              if (
                (R == null && (R = 0),
                (R += r.periodStart),
                (b = b == null ? 1 / 0 : b + r.periodStart),
                e.g !== "HLS" && ((R = Math.max(R, r.segmentStart)), (b = Math.min(b, r.segmentEnd))),
                !Q && m.length > 0)
              )
                for (R = 1 / 0, b = 0, r = I(m), s = r.next(); !s.done; s = r.next())
                  ((s = s.value), (R = Math.min(R, s.startTime)), (b = Math.max(b, s.endTime)));
              if (M.tagName == "br") return ((e = new $t(R, b, "")), (e.lineBreak = !0), e);
              if (
                ((r = ""),
                H && ((r = li(cn(M) || "")), U && (r = r.replace(/\s+/g, " "))),
                (r = new $t(R, b, r)),
                (r.nestedCues = m),
                A || (r.isContainer = !0),
                x && (r.cellResolution = x),
                (x = mp(M, "region", f, "")[0]),
                M.attributes.region && x && x.attributes["xml:id"])
              ) {
                var z = x.attributes["xml:id"];
                r.region = g.filter(function (J) {
                  return J.id == z;
                })[0];
              }
              return (
                (g = x),
                E && a && !M.attributes.region && !M.attributes.style && (g = mp(E, "region", f, "")[0]),
                h4(e, r, M, g, P, G, c, t, m.length == 0),
                r
              );
            }
            function d4(e, t, r, s) {
              var a = new Ho(),
                c = t.attributes["xml:id"];
              if (!c) return null;
              ((a.id = c),
                (c = null),
                s && (c = Gv.exec(s) || jv.exec(s)),
                (s = c ? Number(c[1]) : null),
                (c = c ? Number(c[2]) : null));
              var f,
                g = gp(e, t, r, "extent");
              if (g) {
                var m = (f = Gv.exec(g)) || jv.exec(g);
                m != null &&
                  ((a.width = Number(m[1])),
                  (a.height = Number(m[2])),
                  f ||
                    (s != null && (a.width = (a.width * 100) / s),
                    c != null && (a.height = (a.height * 100) / c)),
                  (a.widthUnits = f || s != null ? Mi : 0),
                  (a.heightUnits = f || c != null ? Mi : 0));
              }
              return (
                (e = gp(e, t, r, "origin")) &&
                  ((m = (f = Gv.exec(e)) || jv.exec(e)),
                  m != null &&
                    ((a.viewportAnchorX = Number(m[1])),
                    (a.viewportAnchorY = Number(m[2])),
                    f
                      ? g ||
                        ((a.width = 100 - a.viewportAnchorX),
                        (a.widthUnits = Mi),
                        (a.height = 100 - a.viewportAnchorY),
                        (a.heightUnits = Mi))
                      : (c != null && (a.viewportAnchorY = (a.viewportAnchorY * 100) / c),
                        s != null && (a.viewportAnchorX = (a.viewportAnchorX * 100) / s)),
                    (a.viewportAnchorUnits = f || s != null ? Mi : 0))),
                a
              );
            }
            function Fv(e) {
              var t = e.match(/rgba\(([^)]+)\)/);
              return t && ((t = t[1].split(",")), t.length == 4)
                ? ((t[3] = String(Number(t[3]) / 255)), "rgba(" + t.join(",") + ")")
                : e;
            }
            function h4(e, t, r, s, a, c, f, g, m) {
              if (
                ((g = g || m),
                Qn(e, r, s, f, "direction", g) == "rtl" && (t.direction = "rtl"),
                (m = Qn(e, r, s, f, "writingMode", g)),
                m == "tb" || m == "tblr"
                  ? (t.writingMode = "vertical-lr")
                  : m == "tbrl"
                    ? (t.writingMode = "vertical-rl")
                    : m == "rltb" || m == "rl"
                      ? (t.direction = "rtl")
                      : m && (t.direction = _u),
                (m = Qn(e, r, s, f, "textAlign", !0))
                  ? ((t.positionAlign = v4.get(m)),
                    (t.lineAlign = y4.get(m)),
                    (t.textAlign = Em[m.toUpperCase()]))
                  : (t.textAlign = Jr),
                (m = Qn(e, r, s, f, "displayAlign", !0)) && (t.displayAlign = nE[m.toUpperCase()]),
                (m = Qn(e, r, s, f, "color", g)) && (t.color = Fv(m)),
                (m = Qn(e, r, s, f, "backgroundColor", g)) && (t.backgroundColor = Fv(m)),
                (m = Qn(e, r, s, f, "border", g)) && (t.border = m),
                (m = Qn(e, r, s, f, "fontFamily", g)))
              )
                switch (m) {
                  case "monospaceSerif":
                    t.fontFamily = "Courier New,Liberation Mono,Courier,monospace";
                    break;
                  case "proportionalSansSerif":
                    t.fontFamily = "Arial,Helvetica,Liberation Sans,sans-serif";
                    break;
                  case "sansSerif":
                    t.fontFamily = "sans-serif";
                    break;
                  case "monospaceSansSerif":
                    t.fontFamily = "Consolas,monospace";
                    break;
                  case "proportionalSerif":
                    t.fontFamily = "serif";
                    break;
                  default:
                    t.fontFamily = m
                      .split(",")
                      .filter(function (x) {
                        return x != "default";
                      })
                      .join(",");
                }
              switch (
                ((m = Qn(e, r, s, f, "fontWeight", g)) && m == "bold" && (t.fontWeight = Ua),
                (m = Qn(e, r, s, f, "wrapOption", g)),
                (t.wrapLine = !(m && m == "noWrap")),
                (m = Qn(e, r, s, f, "lineHeight", g)) && m.match(Cl) && (t.lineHeight = m),
                (m = Qn(e, r, s, f, "fontSize", g)) && (m.match(Cl) || m.match(m4)) && (t.fontSize = m),
                (m = Qn(e, r, s, f, "fontStyle", g)) && (t.fontStyle = oE[m.toUpperCase()]),
                a
                  ? ((c = a.attributes.imageType || a.attributes.imagetype),
                    (m = a.attributes.encoding),
                    (a = cn(a).trim()),
                    c == "PNG" && m == "Base64" && a && (t.backgroundImage = "data:image/png;base64," + a))
                  : c && (t.backgroundImage = c),
                (a = Qn(e, r, s, f, "textOutline", g)) &&
                  ((a = a.split(" ")),
                  a[0].match(Cl)
                    ? (t.textStrokeColor = t.color)
                    : ((t.textStrokeColor = Fv(a[0])), a.shift()),
                  a[0] && a[0].match(Cl) ? (t.textStrokeWidth = a[0]) : (t.textStrokeColor = "")),
                (a = Qn(e, r, s, f, "letterSpacing", g)) && a.match(Cl) && (t.letterSpacing = a),
                (a = Qn(e, r, s, f, "linePadding", g)) && a.match(Cl) && (t.linePadding = a),
                (a = Qn(e, r, s, f, "opacity", g)) && (t.opacity = parseFloat(a)),
                (a = gp(e, s, f, "textDecoration")) && ZC(t, a),
                (a = Uv(e, r, f, "textDecoration")) && ZC(t, a),
                (a = Qn(e, r, s, f, "textCombine", g)) && (t.textCombineUpright = a),
                Qn(e, r, s, f, "ruby", g))
              ) {
                case "container":
                  t.rubyTag = "ruby";
                  break;
                case "text":
                  t.rubyTag = "rt";
              }
            }
            function ZC(e, t) {
              t = I(t.split(" "));
              for (var r = t.next(); !r.done; r = t.next())
                switch (r.value) {
                  case "underline":
                    e.textDecoration.includes(xs) || e.textDecoration.push(xs);
                    break;
                  case "noUnderline":
                    e.textDecoration.includes(xs) && ki(e.textDecoration, xs);
                    break;
                  case "lineThrough":
                    e.textDecoration.includes("lineThrough") || e.textDecoration.push("lineThrough");
                    break;
                  case "noLineThrough":
                    e.textDecoration.includes("lineThrough") && ki(e.textDecoration, "lineThrough");
                    break;
                  case "overline":
                    e.textDecoration.includes("overline") || e.textDecoration.push("overline");
                    break;
                  case "noOverline":
                    e.textDecoration.includes("overline") && ki(e.textDecoration, "overline");
                }
            }
            function Qn(e, t, r, s, a, c) {
              return ((c = c === void 0 ? !0 : c), (t = Uv(e, t, s, a)) ? t : c ? gp(e, r, s, a) : null);
            }
            function gp(e, t, r, s) {
              if (!t) return null;
              var a = Xr(t, yp, s);
              return a || eL(e, t, r, s);
            }
            function Uv(e, t, r, s) {
              var a = Xr(t, yp, s);
              return a || eL(e, t, r, s);
            }
            function eL(e, t, r, s) {
              t = mp(t, "style", r, "");
              for (var a = null, c = 0; c < t.length; c++) {
                var f = ys(t[c], "urn:ebu:tt:style", s);
                (f || (f = Xr(t[c], yp, s)), f || (f = Uv(e, t[c], r, s)), f && (a = f));
              }
              return a;
            }
            function mp(e, t, r, s, a) {
              var c = [];
              if (!e || r.length < 1) return c;
              var f = e;
              for (e = null; !e && !(e = a ? ys(f, a, t) : f.attributes[t]) && ((f = f.parent), f); );
              if ((t = e)) {
                for (t = I(t.split(" ")), a = t.next(); !a.done; a = t.next())
                  for (a = a.value, e = I(r), f = e.next(); !f.done; f = e.next())
                    if (((f = f.value), s + f.attributes["xml:id"] == a)) {
                      c.push(f);
                      break;
                    }
              }
              return c;
            }
            function f4(e, t, r, s) {
              return (
                (e = tL(e, t)),
                r == null ? (r = e.start) : e.start != null && (r += e.start),
                s == null ? (s = e.end) : e.start != null && (s += e.start),
                { start: r, end: s }
              );
            }
            function tL(e, t) {
              var r = Bv(e.attributes.begin, t),
                s = Bv(e.attributes.end, t);
              return (
                (e = Bv(e.attributes.dur, t)),
                s == null && e != null && (s = r + e),
                { start: r, end: s }
              );
            }
            function Bv(e, t) {
              var r = null;
              if (nL.test(e)) {
                ((e = nL.exec(e)), (r = Number(e[1])));
                var s = Number(e[2]),
                  a = Number(e[3]),
                  c = Number(e[4]);
                ((c += (Number(e[5]) || 0) / t.h), (a += c / t.frameRate), (r = a + s * 60 + r * 3600));
              } else if (iL.test(e)) r = $v(iL, e);
              else if (rL.test(e)) r = $v(rL, e);
              else if (sL.test(e)) ((e = sL.exec(e)), (r = Number(e[1]) / t.frameRate));
              else if (oL.test(e)) ((e = oL.exec(e)), (r = Number(e[1]) / t.g));
              else if (aL.test(e)) r = $v(aL, e);
              else if (e) throw new ee(2, 2, 2001, "Could not parse cue time range in TTML");
              return r;
            }
            function $v(e, t) {
              return (
                (e = e.exec(t)),
                e == null || e[0] == ""
                  ? null
                  : (Number(e[4]) || 0) / 1e3 +
                    (Number(e[3]) || 0) +
                    (Number(e[2]) || 0) * 60 +
                    (Number(e[1]) || 0) * 3600
              );
            }
            function p4(e) {
              return e && (e = /^(\d+) (\d+)$/.exec(e))
                ? { columns: parseInt(e[1], 10), rows: parseInt(e[2], 10) }
                : null;
            }
            (Ee("shaka.text.TtmlTextParser", $i),
              ($i.prototype.parseMedia = $i.prototype.parseMedia),
              ($i.prototype.setManifestType = $i.prototype.setManifestType),
              ($i.prototype.setSequenceMode = $i.prototype.setSequenceMode),
              ($i.prototype.parseInit = $i.prototype.parseInit));
            function g4(e, t, r, s) {
              ((this.frameRate = Number(e) || 30),
                (this.h = Number(t) || 1),
                (this.g = Number(s)),
                this.g == 0 && (this.g = e ? this.frameRate * this.h : 1),
                r && (e = /^(\d+) (\d+)$/g.exec(r)) && (this.frameRate *= Number(e[1]) / Number(e[2])));
            }
            var Gv = /^(\d{1,2}(?:\.\d+)?|100(?:\.0+)?)% (\d{1,2}(?:\.\d+)?|100(?:\.0+)?)%$/,
              m4 = /^(\d{1,4}(?:\.\d+)?|100)%$/,
              Cl = /^(\d+px|\d+em|\d*\.?\d+c)$/,
              jv = /^(\d+)px (\d+)px$/,
              nL = /^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,
              iL = /^(?:(\d{2,}):)?(\d{2}):(\d{2})$/,
              rL = /^(?:(\d{2,}):)?(\d{2}):(\d{2}\.\d+)$/,
              sL = /^(\d*(?:\.\d*)?)f$/,
              oL = /^(\d*(?:\.\d*)?)t$/,
              aL = RegExp(
                "^(?:(\\d*(?:\\.\\d*)?)h)?(?:(\\d*(?:\\.\\d*)?)m)?(?:(\\d*(?:\\.\\d*)?)s)?(?:(\\d*(?:\\.\\d*)?)ms)?$",
              ),
              y4 = new Map()
                .set("left", Yo)
                .set("center", "center")
                .set("right", "end")
                .set("start", Yo)
                .set("end", "end"),
              v4 = new Map().set("left", "line-left").set("center", "center").set("right", "line-right"),
              jc = ["http://www.w3.org/ns/ttml#parameter", "http://www.w3.org/2006/10/ttaf1#parameter"],
              yp = ["http://www.w3.org/ns/ttml#styling", "http://www.w3.org/2006/10/ttaf1#styling"],
              lL = [
                "http://www.smpte-ra.org/schemas/2052-1/2010/smpte-tt",
                "http://www.smpte-ra.org/schemas/2052-1/2013/smpte-tt",
              ];
            Un("application/ttml+xml", function () {
              return new $i();
            });
            function En() {
              this.g = new $i();
            }
            ((En.prototype.parseInit = function (e) {
              var t = !1;
              if (
                (new bt()
                  .box("moov", Ze)
                  .box("trak", Ze)
                  .box("mdia", Ze)
                  .box("minf", Ze)
                  .box("stbl", Ze)
                  .S("stsd", ws)
                  .box("stpp", function (r) {
                    ((t = !0), r.parser.stop());
                  })
                  .parse(e),
                !t)
              )
                throw new ee(2, 2, 2007);
            }),
              (En.prototype.setSequenceMode = function (e) {
                this.g.setSequenceMode(e);
              }),
              (En.prototype.setManifestType = function (e) {
                this.g.setManifestType(e);
              }),
              (En.prototype.parseMedia = function (e, t, r) {
                var s = [],
                  a = null,
                  c = [],
                  f = new Map(),
                  g = [];
                if (
                  (new bt()
                    .box("moof", Ze)
                    .box("traf", Ze)
                    .S("tfhd", function (G) {
                      a = Ah(G.reader, G.flags).Xd;
                    })
                    .S("trun", function (G) {
                      ((G = Rh(G.reader, G.version, G.flags)), (G = I(G.mh)));
                      for (var U = G.next(); !U.done; U = G.next()) g.push(U.value.sampleSize || a || 0);
                    })
                    .S("subs", function (G) {
                      for (var U = G.reader, H = U.U(), Q = -1, ne = 0; ne < H; ne++) {
                        var z = U.U();
                        ((Q += z), (z = U.Ca()));
                        for (var J = [], X = 0; X < z; X++)
                          (G.version == 1 ? J.push(U.U()) : J.push(U.Ca()), U.Y(), U.Y(), U.U());
                        f.set(Q, J);
                      }
                    })
                    .box(
                      "mdat",
                      za(function (G) {
                        c.push(G);
                      }, !1),
                    )
                    .parse(e, !1),
                  c.length == 0)
                )
                  throw new ee(2, 2, 2007);
                for (var m = dn.apply(Hn, V(c)), x = 0, E = 0; E < g.length; E++) {
                  var A = We(m, x, g[E]);
                  x += g[E];
                  var R = f.get(E);
                  if (R && R.length) {
                    A = We(A, 0, R[0]);
                    for (var b = [], D = R[0], M = 1; M < R.length; M++) {
                      var P = We(e, D, R[M]);
                      ((P = zd(P)), b.push("data:image/png;base64," + P), (D += R[M]));
                    }
                    s = s.concat(this.g.parseMedia(A, t, r, b));
                  } else s = s.concat(this.g.parseMedia(A, t, r, []));
                }
                return s;
              }),
              Ee("shaka.text.Mp4TtmlParser", En),
              (En.prototype.parseMedia = En.prototype.parseMedia),
              (En.prototype.setManifestType = En.prototype.setManifestType),
              (En.prototype.setSequenceMode = En.prototype.setSequenceMode),
              (En.prototype.parseInit = En.prototype.parseInit),
              Un('application/mp4; codecs="stpp"', function () {
                return new En();
              }),
              Un('application/mp4; codecs="stpp.ttml"', function () {
                return new En();
              }),
              Un('application/mp4; codecs="stpp.ttml.im1i"', function () {
                return new En();
              }),
              Un('application/mp4; codecs="stpp.ttml.im1t"', function () {
                return new En();
              }),
              Un('application/mp4; codecs="stpp.ttml.im2i"', function () {
                return new En();
              }),
              Un('application/mp4; codecs="stpp.ttml.im2t"', function () {
                return new En();
              }),
              Un('application/mp4; codecs="stpp.ttml.etd1"', function () {
                return new En();
              }),
              Un('application/mp4; codecs="stpp.ttml.etd1|im1t"', function () {
                return new En();
              }),
              Un('application/mp4; codecs="stpp.ttml.im1t|etd1"', function () {
                return new En();
              }),
              Un('application/mp4; codecs="stpp.TTML.im1t"', function () {
                return new En();
              }));
            function hi() {
              this.g = "UNKNOWN";
            }
            ((hi.prototype.parseInit = function () {}),
              (hi.prototype.setSequenceMode = function () {}),
              (hi.prototype.setManifestType = function (e) {
                this.g = e;
              }),
              (hi.prototype.parseMedia = function (e, t) {
                ((e = zt(e)), (e = e.replace(/\r\n|\r(?=[^\n]|$)/gm, "\n")));
                var r = e.split(/\n{2,}/m);
                if (!/^WEBVTT($|[ \t\n])/m.test(r[0])) throw new ee(2, 2, 2e3);
                if (((e = t.vttOffset), this.g == "HLS" && r[0].includes("X-TIMESTAMP-MAP"))) {
                  var s = r[0];
                  if (
                    ((e = s.match(/LOCAL:((?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3}))/m)),
                    (s = s.match(/MPEGTS:(\d+)/m)),
                    !e || !s)
                  )
                    throw new ee(2, 2, 2e3);
                  if (((e = Fa(e[1])), e == null)) throw new ee(2, 2, 2e3);
                  s = Number(s[1]);
                  for (var a = t.segmentStart - t.periodStart; a >= 95443.7176888889; )
                    ((a -= 95443.7176888889), (s += 8589934592));
                  e = t.periodStart + s / 9e4 - e;
                }
                for (t = [], s = I(r[0].split("\n")), a = s.next(); !a.done; a = s.next())
                  if (((a = a.value), /^Region:/.test(a))) {
                    a = new Oa(a);
                    var c = new Ho();
                    (Ko(a), Na(a));
                    for (var f = Ko(a); f; ) {
                      var g = c,
                        m = f;
                      ((f = /^id=(.*)$/.exec(m))
                        ? (g.id = f[1])
                        : (f = /^width=(\d{1,2}|100)%$/.exec(m))
                          ? (g.width = Number(f[1]))
                          : (f = /^lines=(\d+)$/.exec(m))
                            ? ((g.height = Number(f[1])), (g.heightUnits = 2))
                            : (f = /^regionanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(m))
                              ? ((g.regionAnchorX = Number(f[1])), (g.regionAnchorY = Number(f[2])))
                              : (f = /^viewportanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(m))
                                ? ((g.viewportAnchorX = Number(f[1])), (g.viewportAnchorY = Number(f[2])))
                                : /^scroll=up$/.exec(m) && (g.scroll = "up"),
                        Na(a),
                        (f = Ko(a)));
                    }
                    t.push(c);
                  }
                for (s = new Map(), eE(s), a = [], r = I(r.slice(1)), c = r.next(); !c.done; c = r.next()) {
                  if (
                    ((c = c.value.split("\n")),
                    (c.length != 1 || c[0]) && !/^NOTE($|[ \t])/.test(c[0]) && c[0] == "STYLE")
                  ) {
                    for (g = [], f = -1, m = 1; m < c.length; m++)
                      (c[m].includes("::cue") && (g.push([]), (f = g.length - 1)),
                        f != -1 && (g[f].push(c[m]), c[m].includes("}") && (f = -1)));
                    for (g = I(g), f = g.next(); !f.done; f = g.next()) {
                      var x = f.value;
                      ((f = "global"),
                        (m = x[0].match(/\((.*)\)/)) && (f = m.pop()),
                        (m = x.slice(1, -1)),
                        x[0].includes("}") && (x = /\{(.*?)\}/.exec(x[0])) && (m = x[1].split(";")),
                        (x = s.get(f)) || (x = new $t(0, 0, "")));
                      for (var E = !1, A = 0; A < m.length; A++) {
                        var R = /^\s*([^:]+):\s*(.*)/.exec(m[A]);
                        if (R) {
                          var b = R[2].trim().replace(";", "");
                          switch (R[1].trim()) {
                            case "background-color":
                            case "background":
                              ((E = !0), (x.backgroundColor = b));
                              break;
                            case "color":
                              ((E = !0), (x.color = b));
                              break;
                            case "font-family":
                              ((E = !0), (x.fontFamily = b));
                              break;
                            case "font-size":
                              ((E = !0), (x.fontSize = b));
                              break;
                            case "font-weight":
                              (parseInt(b, 10) >= 700 || b == "bold") && ((E = !0), (x.fontWeight = Ua));
                              break;
                            case "font-style":
                              switch (b) {
                                case "normal":
                                  ((E = !0), (x.fontStyle = Im));
                                  break;
                                case "italic":
                                  ((E = !0), (x.fontStyle = Ba));
                                  break;
                                case "oblique":
                                  ((E = !0), (x.fontStyle = "oblique"));
                              }
                              break;
                            case "opacity":
                              ((E = !0), (x.opacity = parseFloat(b)));
                              break;
                            case "text-combine-upright":
                              ((E = !0), (x.textCombineUpright = b));
                              break;
                            case "text-shadow":
                              ((E = !0), (x.textShadow = b));
                              break;
                            case "white-space":
                              ((E = !0), (x.wrapLine = b != "noWrap"));
                          }
                        }
                      }
                      E && s.set(f, x);
                    }
                  }
                  if (
                    ((x = c),
                    (E = e),
                    (x.length == 1 && !x[0]) ||
                      /^NOTE($|[ \t])/.test(x[0]) ||
                      x[0] == "STYLE" ||
                      x[0] == "REGION")
                  )
                    c = null;
                  else if (
                    ((c = null),
                    x[0].includes("-->") || ((c = x[0]), x.splice(0, 1)),
                    (g = new Oa(x[0])),
                    (f = wu(g)),
                    (A = eo(g, /[ \t]+--\x3e[ \t]+/g)),
                    (m = wu(g)),
                    f == null || A == null || m == null)
                  )
                    (He("Failed to parse VTT time code. Cue skipped:", c, x), (c = null));
                  else {
                    for (
                      f += E,
                        m += E,
                        f < 0 && (f = 0),
                        E = x.slice(1).join("\n").trim(),
                        s.has("global")
                          ? ((x = s.get("global").clone()),
                            (x.startTime = f),
                            (x.endTime = m),
                            (x.payload = E))
                          : (x = new $t(f, m, E)),
                        Na(g),
                        f = Ko(g);
                      f;
                    )
                      (uL(x, f, t), Na(g), (f = Ko(g)));
                    (ih(x, s), c != null && (x.id = c), (c = x));
                  }
                  c && a.push(c);
                }
                return a;
              }));
            function uL(e, t, r) {
              var s;
              (s = /^align:(start|middle|center|end|left|right)$/.exec(t))
                ? ((t = s[1]), t == "middle" ? (e.textAlign = Jr) : (e.textAlign = Em[t.toUpperCase()]))
                : (s = /^vertical:(lr|rl)$/.exec(t))
                  ? (e.writingMode = s[1] == "lr" ? "vertical-lr" : "vertical-rl")
                  : (s = /^size:([\d.]+)%$/.exec(t))
                    ? (e.size = Number(s[1]))
                    : (s =
                          /^position:([\d.]+)%(?:,(line-left|line-right|middle|center|start|end|auto))?$/.exec(
                            t,
                          ))
                      ? ((e.position = Number(s[1])),
                        s[2] &&
                          ((t = s[2]),
                          (e.positionAlign =
                            t == "line-left" || t == "start"
                              ? "line-left"
                              : t == "line-right" || t == "end"
                                ? "line-right"
                                : t == "center" || t == "middle"
                                  ? "center"
                                  : rh)))
                      : (s = /^region:(.*)$/.exec(t))
                        ? (t = x4(r, s[1])) && (e.region = t)
                        : (r = /^line:([\d.]+)%(?:,(start|end|center))?$/.exec(t))
                          ? ((e.lineInterpretation = 1),
                            (e.line = Number(r[1])),
                            r[2] && (e.lineAlign = Am[r[2].toUpperCase()]))
                          : (r = /^line:(-?\d+)(?:,(start|end|center))?$/.exec(t)) &&
                            ((e.lineInterpretation = bu),
                            (e.line = Number(r[1])),
                            r[2] && (e.lineAlign = Am[r[2].toUpperCase()]));
            }
            function x4(e, t) {
              return (
                (e = e.filter(function (r) {
                  return r.id == t;
                })),
                e.length ? e[0] : null
              );
            }
            (Ee("shaka.text.VttTextParser", hi),
              (hi.prototype.parseMedia = hi.prototype.parseMedia),
              (hi.prototype.setManifestType = hi.prototype.setManifestType),
              (hi.prototype.setSequenceMode = hi.prototype.setSequenceMode),
              (hi.prototype.parseInit = hi.prototype.parseInit),
              Un("text/vtt", function () {
                return new hi();
              }),
              Un('text/vtt; codecs="vtt"', function () {
                return new hi();
              }),
              Un('text/vtt; codecs="wvtt"', function () {
                return new hi();
              }));
            function zi() {
              this.g = null;
            }
            ((zi.prototype.parseInit = function (e) {
              var t = this,
                r = !1;
              if (
                (new bt()
                  .box("moov", Ze)
                  .box("trak", Ze)
                  .box("mdia", Ze)
                  .S("mdhd", function (s) {
                    ((s = wh(s.reader, s.version)), (t.g = s.timescale));
                  })
                  .box("minf", Ze)
                  .box("stbl", Ze)
                  .S("stsd", ws)
                  .box("wvtt", function () {
                    r = !0;
                  })
                  .parse(e),
                !this.g)
              )
                throw new ee(2, 2, 2008);
              if (!r) throw new ee(2, 2, 2008);
            }),
              (zi.prototype.setSequenceMode = function () {}),
              (zi.prototype.setManifestType = function () {}),
              (zi.prototype.parseMedia = function (e, t) {
                if (!e.length) return [];
                if (!this.g) throw new ee(2, 2, 2008);
                var r = 0,
                  s = [],
                  a,
                  c = [],
                  f = !1,
                  g = !1,
                  m = !1,
                  x = null;
                if (
                  (new bt()
                    .box("moof", Ze)
                    .box("traf", Ze)
                    .S("tfdt", function (H) {
                      ((f = !0), (r = Ih(H.reader, H.version).baseMediaDecodeTime));
                    })
                    .S("tfhd", function (H) {
                      x = Ah(H.reader, H.flags).Wd;
                    })
                    .S("trun", function (H) {
                      ((g = !0), (s = Rh(H.reader, H.version, H.flags).mh));
                    })
                    .box(
                      "mdat",
                      za(function (H) {
                        ((m = !0), (a = H));
                      }, !1),
                    )
                    .parse(e, !1),
                  !m && !f && !g)
                )
                  throw new ee(2, 2, 2008);
                e = r;
                for (var E = new Gt(a, 0), A = I(s), R = A.next(); !R.done; R = A.next()) {
                  R = R.value;
                  var b = R.nh || x,
                    D = R.Gf ? r + R.Gf : e;
                  e = D + (b || 0);
                  var M = 0;
                  do {
                    var P = E.U();
                    M += P;
                    var G = E.U(),
                      U = null;
                    (Th(G) == "vttc" ? P > 8 && (U = E.Tb(P - 8, !1)) : E.skip(P - 8),
                      b &&
                        U &&
                        ((P = T4(U, t.periodStart + D / this.g, t.periodStart + e / this.g)), c.push(P)));
                  } while (R.sampleSize && M < R.sampleSize);
                }
                return c.filter(so);
              }));
            function T4(e, t, r) {
              var s, a, c;
              return (
                new bt()
                  .box(
                    "payl",
                    za(function (f) {
                      s = zt(f);
                    }, !1),
                  )
                  .box(
                    "iden",
                    za(function (f) {
                      a = zt(f);
                    }, !1),
                  )
                  .box(
                    "sttg",
                    za(function (f) {
                      c = zt(f);
                    }, !1),
                  )
                  .parse(e),
                s ? S4(s, a, c, t, r) : null
              );
            }
            function S4(e, t, r, s, a) {
              if (((e = new $t(s, a, e)), ih(e), t && (e.id = t), r))
                for (t = new Oa(r), r = Ko(t); r; ) (uL(e, r, []), Na(t), (r = Ko(t)));
              return e;
            }
            (Ee("shaka.text.Mp4VttParser", zi),
              (zi.prototype.parseMedia = zi.prototype.parseMedia),
              (zi.prototype.setManifestType = zi.prototype.setManifestType),
              (zi.prototype.setSequenceMode = zi.prototype.setSequenceMode),
              (zi.prototype.parseInit = zi.prototype.parseInit),
              Un('application/mp4; codecs="wvtt"', function () {
                return new zi();
              }));
            function Yi() {}
            ((Yi.prototype.parseInit = function () {}),
              (Yi.prototype.setSequenceMode = function () {}),
              (Yi.prototype.setManifestType = function () {}),
              (Yi.prototype.parseMedia = function (e) {
                var t = zt(e).replace(/\r+/g, "");
                if (((t = t.trim()), (e = []), t == "")) return e;
                t = I(t.split("\n\n"));
                for (var r = t.next(); !r.done; r = t.next()) {
                  r = r.value.split("\n");
                  var s = new Oa(r[0]),
                    a = wu(s),
                    c = eo(s, /,/g);
                  if (((s = wu(s)), a == null || c == null || s == null))
                    throw new ee(2, 2, 2001, "Could not parse cue time range in SubViewer");
                  e.push(new $t(a, s, r.slice(1).join("\n").trim()));
                }
                return e;
              }),
              Ee("shaka.text.SbvTextParser", Yi),
              (Yi.prototype.parseMedia = Yi.prototype.parseMedia),
              (Yi.prototype.setManifestType = Yi.prototype.setManifestType),
              (Yi.prototype.setSequenceMode = Yi.prototype.setSequenceMode),
              (Yi.prototype.parseInit = Yi.prototype.parseInit),
              Un("text/x-subviewer", function () {
                return new Yi();
              }));
            function Xi() {
              this.g = new hi();
            }
            ((Xi.prototype.parseInit = function () {}),
              (Xi.prototype.setSequenceMode = function () {}),
              (Xi.prototype.setManifestType = function () {}),
              (Xi.prototype.parseMedia = function (e, t, r) {
                var s = zt(e);
                if (((e = "WEBVTT\n\n"), s != "")) {
                  ((s = s.replace(/\r+/g, "")), (s = s.trim()), (s = I(s.split("\n\n"))));
                  for (var a = s.next(); !a.done; a = s.next())
                    ((a = a.value.split(/\n/)),
                      a[0].match(/\d+/) && a.shift(),
                      (a[0] = a[0].replace(/,/g, ".")),
                      (e +=
                        a
                          .join("\n")
                          .replace(/{b}/g, "<b>")
                          .replace(/{\/b}/g, "</b>")
                          .replace(/{i}/g, "<i>")
                          .replace(/{\/i}/g, "</i>")
                          .replace(/{u}/g, "<u>")
                          .replace(/{\/u}/g, "</u>") + "\n\n"));
                }
                return ((e = We(Er(e))), this.g.parseMedia(e, t, r, []));
              }),
              Ee("shaka.text.SrtTextParser", Xi),
              (Xi.prototype.parseMedia = Xi.prototype.parseMedia),
              (Xi.prototype.setManifestType = Xi.prototype.setManifestType),
              (Xi.prototype.setSequenceMode = Xi.prototype.setSequenceMode),
              (Xi.prototype.parseInit = Xi.prototype.parseInit),
              Un("text/srt", function () {
                return new Xi();
              }));
            function qi() {}
            ((qi.prototype.parseInit = function () {}),
              (qi.prototype.setSequenceMode = function () {}),
              (qi.prototype.setManifestType = function () {}),
              (qi.prototype.parseMedia = function (e) {
                var t = "",
                  r = "",
                  s = null,
                  a = null;
                for (a = zt(e).split(/\r?\n\s*\r?\n/), e = I(a), a = e.next(); !a.done; a = e.next()) {
                  var c = a.value;
                  ((a = c),
                    (c = A4.exec(c)) && ((s = c[1]), (a = c[2])),
                    s == "V4 Styles" || s == "V4+ Styles"
                      ? ((t = a), (t = r ? t + ("\n" + a) : a))
                      : s == "Events" && (r = r ? r + ("\n" + a) : a));
                }
                for (s = [], a = null, t = I(t.split(/\r?\n/)), e = t.next(); !e.done; e = t.next())
                  if (((e = e.value), !/^\s*;/.test(e) && (c = hL.exec(e)))) {
                    if (((e = c[1].trim()), (c = c[2].trim()), e == "Format")) a = c.split(vp);
                    else if (e == "Style") {
                      ((e = c.split(vp)), (c = {}));
                      for (var f = 0; f < a.length && f < e.length; f++) c[a[f]] = e[f];
                      s.push(c);
                    }
                  }
                for (
                  a = [], t = null, r = I(r.split(/\r?\n/)), c = r.next(), e = {};
                  !c.done;
                  e = { aj: void 0 }, c = r.next()
                )
                  if (((c = c.value), !/^\s*;/.test(c) && (f = hL.exec(c)))) {
                    if (((c = f[1].trim()), (f = f[2].trim()), c == "Format")) t = f.split(vp);
                    else if (c == "Dialogue") {
                      ((f = f.split(vp)), (c = {}));
                      for (var g = 0; g < t.length && g < f.length; g++) c[t[g]] = f[g];
                      g = dL(c.Start);
                      var m = dL(c.End);
                      ((f = new $t(
                        g,
                        m,
                        f
                          .slice(t.length - 1)
                          .join(",")
                          .replace(/\\N/g, "\n")
                          .replace(/\{[^}]+\}/g, ""),
                      )),
                        (e.aj = c.Style),
                        (e = s.find(
                          (function (x) {
                            return function (E) {
                              return E.Name == x.aj;
                            };
                          })(e),
                        )) && E4(f, e),
                        a.push(f));
                    }
                  }
                return a;
              }));
            function E4(e, t) {
              var r = t.Fontname;
              if (
                (r && (e.fontFamily = r),
                (r = t.Fontsize) && (e.fontSize = r + "px"),
                (r = t.PrimaryColour) && (r = cL(r)) && (e.color = r),
                (r = t.BackColour) && (r = cL(r)) && (e.backgroundColor = r),
                t.Bold && (e.fontWeight = Ua),
                t.Italic && (e.fontStyle = Ba),
                t.Underline && e.textDecoration.push(xs),
                (r = t.Spacing) && (e.letterSpacing = r + "px"),
                (r = t.Alignment))
              )
                switch (parseInt(r, 10)) {
                  case 1:
                    ((e.displayAlign = Lu), (e.textAlign = "start"));
                    break;
                  case 2:
                    ((e.displayAlign = Lu), (e.textAlign = Jr));
                    break;
                  case 3:
                    ((e.displayAlign = Lu), (e.textAlign = "end"));
                    break;
                  case 5:
                    ((e.displayAlign = "before"), (e.textAlign = "start"));
                    break;
                  case 6:
                    ((e.displayAlign = "before"), (e.textAlign = Jr));
                    break;
                  case 7:
                    ((e.displayAlign = "before"), (e.textAlign = "end"));
                    break;
                  case 9:
                    ((e.displayAlign = "center"), (e.textAlign = "start"));
                    break;
                  case 10:
                    ((e.displayAlign = "center"), (e.textAlign = Jr));
                    break;
                  case 11:
                    ((e.displayAlign = "center"), (e.textAlign = "end"));
                }
              (t = t.AlphaLevel) && (e.opacity = parseFloat(t));
            }
            function cL(e) {
              return (
                (e = parseInt(e.replace("&H", ""), 16)),
                e >= 0
                  ? "rgba(" +
                    (e & 255) +
                    "," +
                    ((e >> 8) & 255) +
                    "," +
                    ((e >> 16) & 255) +
                    "," +
                    (((e >> 24) & 255) ^ 255) / 255 +
                    ")"
                  : null
              );
            }
            function dL(e) {
              return (
                (e = I4.exec(e)),
                (e[1] ? parseInt(e[1].replace(":", ""), 10) : 0) * 3600 +
                  parseInt(e[2], 10) * 60 +
                  parseFloat(e[3])
              );
            }
            (Ee("shaka.text.SsaTextParser", qi),
              (qi.prototype.parseMedia = qi.prototype.parseMedia),
              (qi.prototype.setManifestType = qi.prototype.setManifestType),
              (qi.prototype.setSequenceMode = qi.prototype.setSequenceMode),
              (qi.prototype.parseInit = qi.prototype.parseInit));
            var A4 = /^\s*\[([^\]]+)\]\r?\n([\s\S]*)/,
              hL = /^\s*([^:]+):\s*(.*)/,
              vp = /\s*,\s*/,
              I4 = /^(\d+:)?(\d{1,2}):(\d{1,2}(?:[.]\d{1,3})?)?$/;
            Un("text/x-ssa", function () {
              return new qi();
            });
            function fL(e, t) {
              var r = e[t + 1] & 1 ? 7 : 9;
              return t + r <= e.length &&
                ((e = (((e[t + 3] & 3) << 11) | (e[t + 4] << 3) | ((e[t + 5] & 224) >>> 5)) - r), e > 0)
                ? { ee: r, ra: e }
                : null;
            }
            function pL(e, t) {
              var r = [96e3, 88200, 64e3, 48e3, 44100, 32e3, 24e3, 22050, 16e3, 12e3, 11025, 8e3, 7350],
                s = (e[t + 2] & 60) >>> 2;
              if (s > r.length - 1) return null;
              var a = ((e[t + 2] & 192) >>> 6) + 1,
                c = (e[t + 2] & 1) << 2;
              return (
                (c |= (e[t + 3] & 192) >>> 6),
                { sampleRate: r[s], channelCount: c, codec: "mp4a.40." + a }
              );
            }
            function gL(e, t) {
              if (t + 1 < e.length && e[t] === 255 && (e[t + 1] & 246) === 240) {
                var r = e[t + 1] & 1 ? 7 : 9;
                if (t + r >= e.length) return !1;
                var s = ((e[t + 3] & 3) << 11) | (e[t + 4] << 3) | ((e[t + 5] & 224) >>> 5);
                return s <= r
                  ? !1
                  : ((t += s),
                    t === e.length || (t + 1 < e.length && e[t] === 255 && (e[t + 1] & 246) === 240));
              }
              return !1;
            }
            function w4(e, t) {
              switch (e) {
                case "mp4a.40.2":
                  if (t === 1) return new Uint8Array([0, 200, 0, 128, 35, 128]);
                  if (t === 2) return new Uint8Array([33, 0, 73, 144, 2, 25, 0, 35, 128]);
                  if (t === 3) return new Uint8Array([0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 142]);
                  if (t === 4)
                    return new Uint8Array([
                      0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 128, 44, 128, 8, 2, 56,
                    ]);
                  if (t === 5)
                    return new Uint8Array([
                      0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 130, 48, 4, 153, 0, 33, 144, 2, 56,
                    ]);
                  if (t === 6)
                    return new Uint8Array([
                      0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 130, 48, 4, 153, 0, 33, 144, 2, 0, 178,
                      0, 32, 8, 224,
                    ]);
                  break;
                default:
                  if (t === 1)
                    return new Uint8Array([
                      1, 64, 34, 128, 163, 78, 230, 128, 186, 8, 0, 0, 0, 28, 6, 241, 193, 10, 90, 90, 90, 90,
                      90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90,
                      90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 94,
                    ]);
                  if (t === 2 || t === 3)
                    return new Uint8Array([
                      1, 64, 34, 128, 163, 94, 230, 128, 186, 8, 0, 0, 0, 0, 149, 0, 6, 241, 161, 10, 90, 90,
                      90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90,
                      90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 94,
                    ]);
              }
              return null;
            }
            function Qi(e) {
              ((this.j = e), (this.h = 0), (this.g = new Map()), (this.i = null));
            }
            ((d = Qi.prototype),
              (d.destroy = function () {
                this.g.clear();
              }),
              (d.isSupported = function (e) {
                return e.toLowerCase().split(";")[0] == "audio/aac" ? ti(this.convertCodecs("audio", e)) : !1;
              }),
              (d.convertCodecs = function (e, t) {
                return t.toLowerCase().split(";")[0] == "audio/aac"
                  ? 'audio/mp4; codecs="' + (Ei(t) || "mp4a.40.2") + '"'
                  : t;
              }),
              (d.getOriginalMimeType = function () {
                return this.j;
              }),
              (d.transmux = function (e, t, r, s) {
                for (var a = We(e), c = Qa(a), f = c.length; f < a.length && !gL(a, f); f++);
                if (
                  ((e = r.endTime * 1e3),
                  (c = ia(c)),
                  c.length &&
                    r &&
                    (c = c.find(function (E) {
                      return E.description === "com.apple.streaming.transportStreamTimestamp";
                    })) &&
                    (e = c.data),
                  (c = pL(a, f)),
                  !c)
                )
                  return Promise.reject(new ee(2, 3, 3018, r ? r.P()[0] : null));
                ((t.audioSamplingRate = c.sampleRate), (t.channelsCount = c.channelCount));
                for (var g = []; f < a.length; ) {
                  var m = fL(a, f);
                  if (!m) return Promise.reject(new ee(2, 3, 3018, r ? r.P()[0] : null));
                  var x = m.ee + m.ra;
                  (f + x <= a.length &&
                    g.push({
                      data: a.subarray(f + m.ee, f + x),
                      size: m.ra,
                      duration: 1024,
                      sb: 0,
                      flags: { xb: 0, mb: 0, jb: 0, hb: 0, ib: 2, yb: 0 },
                    }),
                    (f += x));
                }
                return (
                  (a = c.sampleRate),
                  (e = Math.floor((e * a) / 1e3)),
                  (s = {
                    id: t.id,
                    type: "audio",
                    codecs: c.codec,
                    encrypted: t.encrypted && t.drmInfos.length > 0,
                    timescale: a,
                    duration: s,
                    Bb: [],
                    Ga: new Uint8Array([]),
                    Sa: new Uint8Array([]),
                    Za: 0,
                    $a: 0,
                    data: { sequenceNumber: this.h, baseMediaDecodeTime: e, zb: g },
                    stream: t,
                  }),
                  (s = new Ya([s])),
                  (r = t.id + "_" + r.i),
                  this.g.has(r) ? (t = this.g.get(r)) : ((t = Xa(s)), this.g.set(r, t)),
                  (r = this.i !== t),
                  (s = Hu(s)),
                  (this.i = t),
                  this.h++,
                  Promise.resolve({ data: s, init: r ? t : null })
                );
              }),
              Ee("shaka.transmuxer.AacTransmuxer", Qi),
              (Qi.prototype.transmux = Qi.prototype.transmux),
              (Qi.prototype.getOriginalMimeType = Qi.prototype.getOriginalMimeType),
              (Qi.prototype.convertCodecs = Qi.prototype.convertCodecs),
              (Qi.prototype.isSupported = Qi.prototype.isSupported),
              (Qi.prototype.destroy = Qi.prototype.destroy),
              Ts(
                "audio/aac",
                function () {
                  return new Qi("audio/aac");
                },
                io,
              ));
            function mL(e, t) {
              if (t + 8 > e.length || e[t] !== 11 || e[t + 1] !== 119) return null;
              var r = e[t + 4] >> 6;
              if (r >= 3) return null;
              var s = e[t + 4] & 63,
                a =
                  [
                    64, 69, 96, 64, 70, 96, 80, 87, 120, 80, 88, 120, 96, 104, 144, 96, 105, 144, 112, 121,
                    168, 112, 122, 168, 128, 139, 192, 128, 140, 192, 160, 174, 240, 160, 175, 240, 192, 208,
                    288, 192, 209, 288, 224, 243, 336, 224, 244, 336, 256, 278, 384, 256, 279, 384, 320, 348,
                    480, 320, 349, 480, 384, 417, 576, 384, 418, 576, 448, 487, 672, 448, 488, 672, 512, 557,
                    768, 512, 558, 768, 640, 696, 960, 640, 697, 960, 768, 835, 1152, 768, 836, 1152, 896,
                    975, 1344, 896, 976, 1344, 1024, 1114, 1536, 1024, 1115, 1536, 1152, 1253, 1728, 1152,
                    1254, 1728, 1280, 1393, 1920, 1280, 1394, 1920,
                  ][s * 3 + r] * 2;
              if (t + a > e.length) return null;
              var c = e[t + 6] >> 5,
                f = 0;
              (c === 2 ? (f += 2) : (c & 1 && c !== 1 && (f += 2), c & 4 && (f += 2)),
                (f = (((e[t + 6] << 8) | e[t + 7]) >> (12 - f)) & 1));
              var g = e[t + 5] & 7;
              return (
                (e = new Uint8Array([
                  (r << 6) | ((e[t + 5] >> 3) << 1) | (g >> 2),
                  ((g & 3) << 6) | (c << 3) | (f << 2) | (s >> 4),
                  (s << 4) & 224,
                ])),
                {
                  sampleRate: [48e3, 44100, 32e3][r],
                  channelCount: [2, 1, 2, 3, 3, 4, 4, 5][c] + f,
                  Ga: e,
                  ra: a,
                }
              );
            }
            function R4(e, t) {
              if (e[t] === 11 && e[t + 1] === 119) {
                var r = 0,
                  s = 5;
                t += s;
                for (var a, c; s > 0; ) {
                  c = e[t];
                  var f = Math.min(s, 8),
                    g = 8 - f;
                  ((a = (4278190080 >>> (24 + g)) << g),
                    (a = (c & a) >> g),
                    (r = r ? (r << f) | a : a),
                    (t += 1),
                    (s -= f));
                }
                if (r < 16) return !0;
              }
              return !1;
            }
            function hr(e) {
              ((this.j = e), (this.h = 0), (this.g = new Map()), (this.i = null));
            }
            ((d = hr.prototype),
              (d.destroy = function () {
                this.g.clear();
              }),
              (d.isSupported = function (e) {
                return e.toLowerCase().split(";")[0] == "audio/ac3" ? ti(this.convertCodecs("audio", e)) : !1;
              }),
              (d.convertCodecs = function (e, t) {
                return t.toLowerCase().split(";")[0] == "audio/ac3"
                  ? tt().se()
                    ? 'audio/mp4; codecs="ec-3"'
                    : 'audio/mp4; codecs="ac-3"'
                  : t;
              }),
              (d.getOriginalMimeType = function () {
                return this.j;
              }),
              (d.transmux = function (e, t, r, s) {
                e = We(e);
                for (var a = Qa(e), c = a.length; c < e.length && !R4(e, c); c++);
                var f = r.endTime * 1e3;
                ((a = ia(a)),
                  a.length &&
                    r &&
                    (a = a.find(function (E) {
                      return E.description === "com.apple.streaming.transportStreamTimestamp";
                    })) &&
                    (f = a.data),
                  (a = 0));
                for (var g = new Uint8Array([]), m = []; c < e.length; ) {
                  var x = mL(e, c);
                  if (!x) return Promise.reject(new ee(2, 3, 3018, r ? r.P()[0] : null));
                  ((t.audioSamplingRate = x.sampleRate),
                    (t.channelsCount = x.channelCount),
                    (a = x.sampleRate),
                    (g = x.Ga),
                    m.push({
                      data: e.subarray(c, c + x.ra),
                      size: x.ra,
                      duration: 1536,
                      sb: 0,
                      flags: { xb: 0, mb: 0, jb: 0, hb: 0, ib: 2, yb: 0 },
                    }),
                    (c += x.ra));
                }
                return (
                  (e = Math.floor((f * a) / 1e3)),
                  (s = {
                    id: t.id,
                    type: "audio",
                    codecs: "ac-3",
                    encrypted: t.encrypted && t.drmInfos.length > 0,
                    timescale: a,
                    duration: s,
                    Bb: [],
                    Ga: g,
                    Sa: new Uint8Array([]),
                    Za: 0,
                    $a: 0,
                    data: { sequenceNumber: this.h, baseMediaDecodeTime: e, zb: m },
                    stream: t,
                  }),
                  (s = new Ya([s])),
                  (r = t.id + "_" + r.i),
                  this.g.has(r) ? (t = this.g.get(r)) : ((t = Xa(s)), this.g.set(r, t)),
                  (r = this.i !== t),
                  (s = Hu(s)),
                  (this.i = t),
                  this.h++,
                  Promise.resolve({ data: s, init: r ? t : null })
                );
              }),
              Ee("shaka.transmuxer.Ac3Transmuxer", hr),
              (hr.prototype.transmux = hr.prototype.transmux),
              (hr.prototype.getOriginalMimeType = hr.prototype.getOriginalMimeType),
              (hr.prototype.convertCodecs = hr.prototype.convertCodecs),
              (hr.prototype.isSupported = hr.prototype.isSupported),
              (hr.prototype.destroy = hr.prototype.destroy),
              Ts(
                "audio/ac3",
                function () {
                  return new hr("audio/ac3");
                },
                io,
              ));
            function yL(e, t) {
              if (t + 8 > e.length || ((e[t] << 8) | (e[t + 1] << 0)) !== 2935) return null;
              var r = new Ls(e.subarray(t + 2));
              (Fi(r, 2), Fi(r, 3));
              var s = (at(r, 11) + 1) << 1,
                a = at(r, 2);
              if (a == 3) {
                ((a = at(r, 2)), (a = [24e3, 22060, 16e3][a]));
                var c = 3;
              } else ((a = [48e3, 44100, 32e3][a]), (c = at(r, 2)));
              var f = at(r, 3),
                g = at(r, 1);
              return (
                (r = at(r, 5)),
                t + s > e.byteLength
                  ? null
                  : ((e = Math.floor((s * a) / ([1, 2, 3, 6][c] * 16))),
                    (e = new Uint8Array([
                      (e & 8160) >> 5,
                      (e & 31) << 3,
                      (a << 6) | (r << 1) | 0,
                      0 | (f << 1) | (g << 0),
                      0,
                    ])),
                    { sampleRate: a, channelCount: [2, 1, 2, 3, 3, 4, 4, 5][f] + g, Ga: e, ra: s })
              );
            }
            function fr(e) {
              ((this.j = e), (this.h = 0), (this.g = new Map()), (this.i = null));
            }
            ((d = fr.prototype),
              (d.destroy = function () {
                this.g.clear();
              }),
              (d.isSupported = function (e) {
                return e.toLowerCase().split(";")[0] == "audio/ec3" ? ti(this.convertCodecs("audio", e)) : !1;
              }),
              (d.convertCodecs = function (e, t) {
                return t.toLowerCase().split(";")[0] == "audio/ec3" ? 'audio/mp4; codecs="ec-3"' : t;
              }),
              (d.getOriginalMimeType = function () {
                return this.j;
              }),
              (d.transmux = function (e, t, r, s) {
                e = We(e);
                for (
                  var a = Qa(e), c = a.length;
                  c < e.length && ((e[c] << 8) | (e[c + 1] << 0)) !== 2935;
                  c++
                );
                var f = r.endTime * 1e3;
                ((a = ia(a)),
                  a.length &&
                    r &&
                    (a = a.find(function (E) {
                      return E.description === "com.apple.streaming.transportStreamTimestamp";
                    })) &&
                    (f = a.data),
                  (a = 0));
                for (var g = new Uint8Array([]), m = []; c < e.length; ) {
                  var x = yL(e, c);
                  if (!x) return Promise.reject(new ee(2, 3, 3018, r ? r.P()[0] : null));
                  ((t.audioSamplingRate = x.sampleRate),
                    (t.channelsCount = x.channelCount),
                    (a = x.sampleRate),
                    (g = x.Ga),
                    m.push({
                      data: e.subarray(c, c + x.ra),
                      size: x.ra,
                      duration: 1536,
                      sb: 0,
                      flags: { xb: 0, mb: 0, jb: 0, hb: 0, ib: 2, yb: 0 },
                    }),
                    (c += x.ra));
                }
                return (
                  (e = Math.floor((f * a) / 1e3)),
                  (s = {
                    id: t.id,
                    type: "audio",
                    codecs: "ec-3",
                    encrypted: t.encrypted && t.drmInfos.length > 0,
                    timescale: a,
                    duration: s,
                    Bb: [],
                    Ga: g,
                    Sa: new Uint8Array([]),
                    Za: 0,
                    $a: 0,
                    data: { sequenceNumber: this.h, baseMediaDecodeTime: e, zb: m },
                    stream: t,
                  }),
                  (s = new Ya([s])),
                  (r = t.id + "_" + r.i),
                  this.g.has(r) ? (t = this.g.get(r)) : ((t = Xa(s)), this.g.set(r, t)),
                  (r = this.i !== t),
                  (s = Hu(s)),
                  (this.i = t),
                  this.h++,
                  Promise.resolve({ data: s, init: r ? t : null })
                );
              }),
              Ee("shaka.transmuxer.Ec3Transmuxer", fr),
              (fr.prototype.transmux = fr.prototype.transmux),
              (fr.prototype.getOriginalMimeType = fr.prototype.getOriginalMimeType),
              (fr.prototype.convertCodecs = fr.prototype.convertCodecs),
              (fr.prototype.isSupported = fr.prototype.isSupported),
              (fr.prototype.destroy = fr.prototype.destroy),
              Ts(
                "audio/ec3",
                function () {
                  return new fr("audio/ec3");
                },
                io,
              ));
            function C4(e) {
              if (!e.length) return null;
              var t = e.find(function (M) {
                return M.type == 7;
              });
              if (
                ((e = e.find(function (M) {
                  return M.type == 8;
                })),
                !t || !e)
              )
                return null;
              var r = new Ls(t.data),
                s = It(r);
              if (
                (It(r),
                It(r),
                Bn(r),
                _4.includes(s) && ((s = De(r)), s === 3 && Fi(r, 1), Bn(r), Bn(r), Fi(r, 1), Oe(r)))
              ) {
                s = s !== 3 ? 8 : 12;
                for (var a = 0; a < s; a++) Oe(r) && (a < 6 ? bh(r, 16) : bh(r, 64));
              }
              if ((Bn(r), (s = De(r)), s === 0)) De(r);
              else if (s === 1) for (Fi(r, 1), Bn(r), Bn(r), s = De(r), a = 0; a < s; a++) Bn(r);
              (Bn(r), Fi(r, 1));
              var c = De(r),
                f = De(r),
                g = at(r, 1);
              (g === 0 && Fi(r, 1), Fi(r, 1));
              var m = 0,
                x = 0,
                E = 0,
                A = 0;
              if (
                (Oe(r) && ((m = De(r)), (x = De(r)), (E = De(r)), (A = De(r))), (a = s = 1), Oe(r) && Oe(r))
              ) {
                var R = It(r),
                  b = [1, 12, 10, 16, 40, 24, 20, 32, 80, 18, 15, 64, 160, 4, 3, 2],
                  D = [1, 11, 11, 11, 33, 11, 11, 11, 33, 11, 11, 33, 99, 3, 2, 1];
                R > 0 && R <= 16
                  ? ((s = b[R - 1]), (a = D[R - 1]))
                  : R === 255 && ((s = at(r, 16)), (a = at(r, 16)));
              }
              return (
                (r = (2 - g) * (f + 1) * 16 - E * 2 - A * 2),
                (c = (c + 1) * 16 - m * 2 - x * 2),
                (m = []),
                (t = t.fullData),
                m.push((t.byteLength >>> 8) & 255),
                m.push(t.byteLength & 255),
                (m = m.concat.apply(m, V(t))),
                (t = []),
                (e = e.fullData),
                t.push((e.byteLength >>> 8) & 255),
                t.push(e.byteLength & 255),
                (t = t.concat.apply(t, V(e))),
                (e = new Uint8Array([1, m[3], m[4], m[5], 255, 225].concat(m, [1], t))),
                { height: r, width: c, Sa: e, Za: s, $a: a }
              );
            }
            function L4(e) {
              function t(D) {
                a = {
                  data: new Uint8Array([]),
                  frame: !1,
                  isKeyframe: !1,
                  pts: D.pts,
                  dts: D.dts,
                  nalus: [],
                };
              }
              function r() {
                if (a && a.nalus.length && a.frame) {
                  for (var D = [], M = I(a.nalus), P = M.next(); !P.done; P = M.next()) {
                    P = P.value;
                    var G = P.fullData.byteLength,
                      U = new Uint8Array(4);
                    ((U[0] = (G >> 24) & 255),
                      (U[1] = (G >> 16) & 255),
                      (U[2] = (G >> 8) & 255),
                      (U[3] = G & 255),
                      D.push(U),
                      D.push(P.fullData));
                  }
                  ((a.data = dn.apply(Hn, V(D))), s.push(a));
                }
              }
              for (var s = [], a = null, c = !1, f = 0; f < e.length; f++) {
                var g = e[f],
                  m = g.nalus,
                  x = !1;
                (a && m.length && !c && (r(), t(g)), (m = I(g.nalus)));
                for (var E = m.next(); !E.done; E = m.next()) {
                  E = E.value;
                  var A = !1;
                  switch (E.type) {
                    case 1:
                      var R = !1;
                      A = !0;
                      var b = E.data;
                      (x &&
                        b.length > 4 &&
                        ((b = b2(new Ls(b))), b === 2 || b === 4 || b === 7 || b === 9) &&
                        (R = !0),
                        R && a && a.frame && !a.isKeyframe && (r(), (a = null)),
                        a || t(g),
                        (a.frame = !0),
                        (a.isKeyframe = R));
                      break;
                    case 5:
                      ((A = !0),
                        a && a.frame && !a.isKeyframe && (r(), (a = null)),
                        a || t(g),
                        (a.frame = !0),
                        (a.isKeyframe = !0));
                      break;
                    case 6:
                      A = !0;
                      break;
                    case 7:
                      x = A = !0;
                      break;
                    case 8:
                      A = !0;
                      break;
                    case 9:
                      ((c = A = !0), a && a.frame && (r(), (a = null)), a || t(g));
                      break;
                    case 12:
                      A = !0;
                      break;
                    default:
                      A = !1;
                  }
                  a && A && a.nalus.push(E);
                }
              }
              return (r(), s);
            }
            var _4 = [100, 110, 122, 244, 44, 83, 86, 118, 128, 138, 139, 134];
            function b4(e) {
              if (!e.length) return null;
              var t = e.find(function (f) {
                  return f.type == 32;
                }),
                r = e.find(function (f) {
                  return f.type == 33;
                }),
                s = e.find(function (f) {
                  return f.type == 34;
                });
              if (!t || !r || !s) return null;
              var a = D4(t.fullData);
              e = k4(r.fullData);
              var c = M4(s.fullData);
              return (
                (t = P4(t.fullData, r.fullData, s.fullData, {
                  Xg: a.Xg,
                  Eh: a.Eh,
                  Ig: e.Ig,
                  Jg: e.Jg,
                  Cg: e.Cg,
                  Hg: e.Hg,
                  Dg: e.Dg,
                  Eg: e.Eg,
                  Fg: e.Fg,
                  Gg: e.Gg,
                  wg: e.wg,
                  xg: e.xg,
                  yg: e.yg,
                  zg: e.zg,
                  Ag: e.Ag,
                  Bg: e.Bg,
                  uf: e.uf,
                  kg: e.kg,
                  jg: e.jg,
                  ig: e.ig,
                  Zg: c.Zg,
                  vg: e.vg,
                  ug: e.ug,
                })),
                { height: e.height, width: e.width, Sa: t, Za: e.Uk, $a: e.Tk }
              );
            }
            function D4(e) {
              var t = new Ls(e, !0);
              return (
                It(t),
                It(t),
                at(t, 4),
                at(t, 2),
                at(t, 6),
                (e = at(t, 3)),
                (t = Oe(t)),
                { Xg: e + 1, Eh: t }
              );
            }
            function k4(e) {
              ((e = new Ls(e, !0)), It(e), It(e));
              var t = 0,
                r = 0,
                s = 0,
                a = 0;
              at(e, 4);
              var c = at(e, 3);
              Oe(e);
              for (
                var f = at(e, 2),
                  g = at(e, 1),
                  m = at(e, 5),
                  x = It(e),
                  E = It(e),
                  A = It(e),
                  R = It(e),
                  b = It(e),
                  D = It(e),
                  M = It(e),
                  P = It(e),
                  G = It(e),
                  U = It(e),
                  H = It(e),
                  Q = [],
                  ne = [],
                  z = 0;
                z < c;
                z++
              )
                (Q.push(Oe(e)), ne.push(Oe(e)));
              if (c > 0) for (z = c; z < 8; z++) at(e, 2);
              for (z = 0; z < c; z++) (Q[z] && at(e, 88), ne[z] && It(e));
              (De(e),
                (Q = De(e)),
                Q == 3 && at(e, 1),
                (ne = De(e)),
                (z = De(e)),
                Oe(e) && ((t += De(e)), (r += De(e)), (s += De(e)), (a += De(e))));
              var J = De(e),
                X = De(e),
                ie = De(e);
              if (Oe(e)) for (var Z = 0; Z <= c; Z++) (De(e), De(e), De(e));
              else (De(e), De(e), De(e));
              if ((De(e), De(e), De(e), De(e), De(e), De(e), Oe(e) && Oe(e)))
                for (Z = 0; Z < 4; Z++)
                  for (var re = 0; re < (Z === 3 ? 2 : 6); re++)
                    if (Oe(e)) {
                      var se = Math.min(64, 1 << (4 + (Z << 1)));
                      Z > 1 && Ja(e);
                      for (var me = 0; me < se; me++) Ja(e);
                    } else De(e);
              for (Oe(e), Oe(e), Oe(e) && (It(e), De(e), De(e), Oe(e)), Z = De(e), se = re = 0; se < Z; se++)
                if (((me = !1), se !== 0 && (me = Oe(e)), me)) {
                  (se === Z && De(e), Oe(e), De(e));
                  for (var fe = (me = 0); fe <= re; fe++) {
                    var le = Oe(e),
                      ue = !1;
                    (le || (ue = Oe(e)), (le || ue) && me++);
                  }
                  re = me;
                } else {
                  for (fe = De(e), me = De(e), re = fe + me, le = 0; le < fe; le++) (De(e), Oe(e));
                  for (fe = 0; fe < me; fe++) (De(e), Oe(e));
                }
              if (Oe(e))
                for (Z = De(e), re = 0; re < Z; re++) {
                  for (se = 0; se < ie + 4; se++) at(e, 1);
                  at(e, 1);
                }
              if (((Z = ie = 1), (re = !0), (se = 1), (fe = me = 0), Oe(e), Oe(e), Oe(e))) {
                if (Oe(e)) {
                  ((le = It(e)), (ue = [1, 12, 10, 16, 40, 24, 20, 32, 80, 18, 15, 64, 160, 4, 3, 2]));
                  var xe = [1, 11, 11, 11, 33, 11, 11, 11, 33, 11, 11, 33, 99, 3, 2, 1];
                  le > 0 && le <= 16
                    ? ((ie = ue[le - 1]), (Z = xe[le - 1]))
                    : le === 255 && ((ie = at(e, 16)), (Z = at(e, 16)));
                }
                if (
                  (Oe(e) && Oe(e),
                  Oe(e) && (at(e, 3), Oe(e), Oe(e) && (It(e), It(e), It(e))),
                  Oe(e) && (De(e), De(e)),
                  Oe(e),
                  Oe(e),
                  Oe(e),
                  (le = Oe(e)) && (Bn(e), Bn(e), Bn(e), Bn(e)),
                  Oe(e) && ((se = at(e, 32)), (me = at(e, 32)), Oe(e) && De(e), Oe(e)))
                ) {
                  ((xe = !1),
                    (le = Oe(e)),
                    (ue = Oe(e)),
                    (le || ue) &&
                      ((xe = Oe(e)) && (It(e), at(e, 5), Oe(e), at(e, 5)),
                      at(e, 4),
                      at(e, 4),
                      xe && at(e, 4),
                      at(e, 5),
                      at(e, 5),
                      at(e, 5)));
                  for (var Se = 0; Se <= c; Se++) {
                    re = Oe(e);
                    var Ye = !0,
                      be = 1;
                    re || (Ye = Oe(e));
                    var xt = !1;
                    if ((Ye ? De(e) : (xt = Oe(e)), xt || (be = De(e) + 1), le)) {
                      for (Ye = 0; Ye < be; Ye++) (De(e), De(e), xe && (De(e), De(e)));
                      Oe(e);
                    }
                    if (ue) {
                      for (Ye = 0; Ye < be; Ye++) (De(e), De(e), xe && (De(e), De(e)));
                      Oe(e);
                    }
                  }
                }
                Oe(e) && (Oe(e), Oe(e), Oe(e), (fe = De(e)), De(e), De(e), De(e), De(e));
              }
              return {
                Cg: H,
                Ig: f,
                Jg: g,
                Hg: m,
                Dg: x,
                Eg: E,
                Fg: A,
                Gg: R,
                wg: b,
                xg: D,
                yg: M,
                zg: P,
                Ag: G,
                Bg: U,
                uf: fe,
                kg: Q,
                jg: J,
                ig: X,
                width: ne - (t + r) * (Q === 1 || Q === 2 ? 2 : 1),
                height: z - (s + a) * (Q === 1 ? 2 : 1),
                Uk: ie,
                Tk: Z,
                vg: me / se,
                ug: re,
              };
            }
            function M4(e) {
              var t = new Ls(e, !0);
              (It(t),
                It(t),
                De(t),
                De(t),
                Oe(t),
                Oe(t),
                at(t, 3),
                Oe(t),
                Oe(t),
                De(t),
                De(t),
                Ja(t),
                Oe(t),
                Oe(t),
                Oe(t) && De(t),
                Ja(t),
                Ja(t),
                Oe(t),
                Oe(t),
                Oe(t),
                Oe(t),
                (e = Oe(t)),
                (t = Oe(t)));
              var r = 1;
              return (t && e ? (r = 0) : t ? (r = 3) : e && (r = 2), { Zg: r });
            }
            function P4(e, t, r, s) {
              var a = new Uint8Array(23 + (5 + e.byteLength) + (5 + t.byteLength) + (5 + r.byteLength));
              for (
                a[0] = 1,
                  a[1] = ((s.Ig & 3) << 6) | ((s.Jg ? 1 : 0) << 5) | (s.Hg & 31),
                  a[2] = s.Dg,
                  a[3] = s.Eg,
                  a[4] = s.Fg,
                  a[5] = s.Gg,
                  a[6] = s.wg,
                  a[7] = s.xg,
                  a[8] = s.yg,
                  a[9] = s.zg,
                  a[10] = s.Ag,
                  a[11] = s.Bg,
                  a[12] = s.Cg,
                  a[13] = 240 | ((s.uf & 3840) >> 8),
                  a[14] = s.uf & 255,
                  a[15] = 252 | (s.Zg & 3),
                  a[16] = 252 | (s.kg & 3),
                  a[17] = 248 | (s.jg & 7),
                  a[18] = 248 | (s.ig & 7),
                  a[19] = 0,
                  a[20] = parseInt(s.vg, 10),
                  a[21] = (((s.ug ? 1 : 0) & 3) << 6) | ((s.Xg & 7) << 3) | ((s.Eh ? 1 : 0) << 2) | 3,
                  a[22] = 3,
                  e = [e, t, r],
                  t = 23,
                  r = e.length - 1,
                  s = 0;
                s < e.length;
                s += 1
              )
                (a.set(new Uint8Array([(32 + s) | (s === r ? 128 : 0), 0, 1]), t),
                  (t += 3),
                  a.set(new Uint8Array([e[s].byteLength >> 8, e[s].byteLength & 255]), t),
                  (t += 2),
                  a.set(e[s], t),
                  (t += e[s].byteLength));
              return a;
            }
            function xp(e, t) {
              var r = (e[t + 1] >> 3) & 3,
                s = (e[t + 1] >> 1) & 3,
                a = (e[t + 2] >> 4) & 15,
                c = (e[t + 2] >> 2) & 3;
              if (r !== 1 && a !== 0 && a !== 15 && c !== 3) {
                var f = e[t + 3] >> 6;
                ((a = O4[(r === 3 ? 3 - s : s === 3 ? 3 : 4) * 14 + a - 1] * 1e3),
                  (c = N4[(r === 3 ? 0 : r === 2 ? 1 : 2) * 3 + c]),
                  (r = F4[r][s]));
                var g = U4[s],
                  m = Math.floor((r * a) / c + ((e[t + 2] >> 1) & 1)) * g,
                  x = (navigator.userAgent || "").match(/Chrome\/(\d+)/i);
                return (
                  (x = x ? parseInt(x[1], 10) : 0) &&
                    x <= 87 &&
                    s === 2 &&
                    a >= 224e3 &&
                    f === 0 &&
                    (e[t + 3] |= 128),
                  { sampleRate: c, channelCount: f === 3 ? 1 : 2, ra: m, Sk: r * 8 * g }
                );
              }
              return null;
            }
            function vL(e, t) {
              return e[t] === 255 && (e[t + 1] & 224) === 224 && (e[t + 1] & 6) !== 0;
            }
            function xL(e, t) {
              if (t + 1 < e.length && vL(e, t)) {
                var r = xp(e, t),
                  s = 4;
                return (r && r.ra && (s = r.ra), (t += s), t === e.length || (t + 1 < e.length && vL(e, t)));
              }
              return !1;
            }
            var O4 = [
                32, 64, 96, 128, 160, 192, 224, 256, 288, 320, 352, 384, 416, 448, 32, 48, 56, 64, 80, 96,
                112, 128, 160, 192, 224, 256, 320, 384, 32, 40, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224,
                256, 320, 32, 48, 56, 64, 80, 96, 112, 128, 144, 160, 176, 192, 224, 256, 8, 16, 24, 32, 40,
                48, 56, 64, 80, 96, 112, 128, 144, 160,
              ],
              N4 = [44100, 48e3, 32e3, 22050, 24e3, 16e3, 11025, 12e3, 8e3],
              F4 = [
                [0, 72, 144, 12],
                [0, 0, 0, 0],
                [0, 72, 144, 12],
                [0, 144, 144, 12],
              ],
              U4 = [0, 1, 1, 4];
            function pr(e) {
              ((this.j = e), (this.h = 0), (this.g = new Map()), (this.i = null));
            }
            ((d = pr.prototype),
              (d.destroy = function () {
                this.g.clear();
              }),
              (d.isSupported = function (e) {
                return e.toLowerCase().split(";")[0] == "audio/mpeg"
                  ? ti(this.convertCodecs("audio", e))
                  : !1;
              }),
              (d.convertCodecs = function (e, t) {
                return t.toLowerCase().split(";")[0] == "audio/mpeg" ? 'audio/mp4; codecs="mp3"' : t;
              }),
              (d.getOriginalMimeType = function () {
                return this.j;
              }),
              (d.transmux = function (e, t, r, s) {
                for (var a = We(e), c = Qa(a).length; c < a.length && !xL(a, c); c++);
                var f;
                for (e = []; c < a.length; ) {
                  var g = xp(a, c);
                  if (!g) return Promise.reject(new ee(2, 3, 3018, r ? r.P()[0] : null));
                  (f || (f = g),
                    c + g.ra <= a.length &&
                      e.push({
                        data: a.subarray(c, c + g.ra),
                        size: g.ra,
                        duration: 1152,
                        sb: 0,
                        flags: { xb: 0, mb: 0, jb: 0, hb: 0, ib: 2, yb: 0 },
                      }),
                    (c += g.ra));
                }
                return f
                  ? ((a = ((f.Sk * 9e4) / f.sampleRate) * this.h),
                    (s = {
                      id: t.id,
                      type: "audio",
                      codecs: "mp3",
                      encrypted: t.encrypted && t.drmInfos.length > 0,
                      timescale: f.sampleRate,
                      duration: s,
                      Bb: [],
                      Ga: new Uint8Array([]),
                      Sa: new Uint8Array([]),
                      Za: 0,
                      $a: 0,
                      data: { sequenceNumber: this.h, baseMediaDecodeTime: a, zb: e },
                      stream: t,
                    }),
                    (s = new Ya([s])),
                    (r = t.id + "_" + r.i),
                    this.g.has(r) ? (t = this.g.get(r)) : ((t = Xa(s)), this.g.set(r, t)),
                    (r = this.i !== t),
                    (s = Hu(s)),
                    (this.i = t),
                    this.h++,
                    Promise.resolve({ data: s, init: r ? t : null }))
                  : Promise.reject(new ee(2, 3, 3018, r ? r.P()[0] : null));
              }),
              Ee("shaka.transmuxer.Mp3Transmuxer", pr),
              (pr.prototype.transmux = pr.prototype.transmux),
              (pr.prototype.getOriginalMimeType = pr.prototype.getOriginalMimeType),
              (pr.prototype.convertCodecs = pr.prototype.convertCodecs),
              (pr.prototype.isSupported = pr.prototype.isSupported),
              (pr.prototype.destroy = pr.prototype.destroy),
              Ts(
                "audio/mpeg",
                function () {
                  return new pr("audio/mpeg");
                },
                io,
              ));
            function gr(e) {
              ((this.h = e), (this.g = null));
            }
            ((d = gr.prototype),
              (d.destroy = function () {}),
              (d.isSupported = function (e) {
                if (e.toLowerCase().split(";")[0] != "video/mp2t") return !1;
                var t = Ei(e).split(","),
                  r = Si("audio", t);
                return (
                  (t = Si("video", t)),
                  !r || t || Kn(r) != "mp3" ? !1 : ti(this.convertCodecs("audio", e))
                );
              }),
              (d.convertCodecs = function (e, t) {
                return t.toLowerCase().split(";")[0] == "video/mp2t" ? "audio/mpeg" : t;
              }),
              (d.getOriginalMimeType = function () {
                return this.h;
              }),
              (d.transmux = function (e, t, r, s, a) {
                if (
                  (this.g ? this.g.clearData() : (this.g = new Ft()),
                  this.g.Kf(r.i),
                  (e = We(e)),
                  (e = this.g.parse(e)),
                  e.Yd().audio != "mp3" || a != "audio")
                )
                  return Promise.reject(new ee(2, 3, 3018, r ? r.P()[0] : null));
                for (r = new Uint8Array([]), a = I(e.ub()), e = a.next(); !e.done; e = a.next())
                  if ((e = e.value.data))
                    for (t = 0; t < e.length; )
                      (s = xp(e, t))
                        ? (t + s.ra <= e.length && (r = dn(r, e.subarray(t, t + s.ra))), (t += s.ra))
                        : t++;
                return Promise.resolve(r);
              }),
              Ee("shaka.transmuxer.MpegTsTransmuxer", gr),
              (gr.prototype.transmux = gr.prototype.transmux),
              (gr.prototype.getOriginalMimeType = gr.prototype.getOriginalMimeType),
              (gr.prototype.convertCodecs = gr.prototype.convertCodecs),
              (gr.prototype.isSupported = gr.prototype.isSupported),
              (gr.prototype.destroy = gr.prototype.destroy),
              Ts(
                "video/mp2t",
                function () {
                  return new gr("video/mp2t");
                },
                Rm,
              ));
            /*
 @license
 MSS Transmuxer
 Copyright 2015 Dash Industry Forum
 SPDX-License-Identifier: BSD-3-Clause
*/ function Ji(e) {
              ((this.h = e), (this.g = Uy.get("ISOBoxer")()) && B4(this));
            }
            function B4(e) {
              function t() {
                (this._procFullBox(),
                  this.flags & 1 &&
                    (this._procField("AlgorithmID", "uint", 24),
                    this._procField("IV_size", "uint", 8),
                    this._procFieldArray("KID", 16, "uint", 8)),
                  this._procField("sample_count", "uint", 32),
                  this._procEntries("entry", this.sample_count, function (r) {
                    (this._procEntryField(r, "InitializationVector", "data", 8),
                      this.flags & 2 &&
                        (this._procEntryField(r, "NumberOfEntries", "uint", 16),
                        this._procSubEntries(r, "clearAndCryptedData", r.NumberOfEntries, function (s) {
                          (this._procEntryField(s, "BytesOfClearData", "uint", 16),
                            this._procEntryField(s, "BytesOfEncryptedData", "uint", 32));
                        })));
                  }));
              }
              (e.g.addBoxProcessor("saio", function () {
                (this._procFullBox(),
                  this.flags & 1 &&
                    (this._procField("aux_info_type", "uint", 32),
                    this._procField("aux_info_type_parameter", "uint", 32)),
                  this._procField("entry_count", "uint", 32),
                  this._procFieldArray("offset", this.entry_count, "uint", this.version === 1 ? 64 : 32));
              }),
                e.g.addBoxProcessor("saiz", function () {
                  (this._procFullBox(),
                    this.flags & 1 &&
                      (this._procField("aux_info_type", "uint", 32),
                      this._procField("aux_info_type_parameter", "uint", 32)),
                    this._procField("default_sample_info_size", "uint", 8),
                    this._procField("sample_count", "uint", 32),
                    this.default_sample_info_size === 0 &&
                      this._procFieldArray("sample_info_size", this.sample_count, "uint", 8));
                }),
                e.g.addBoxProcessor("senc", t),
                e.g.addBoxProcessor("uuid", function () {
                  for (var r = !0, s = 0; s < 16; s++) this.usertype[s] !== $4[s] && (r = !1);
                  r && (this._parsing && (this.type = "sepiff"), t.call(this));
                }));
            }
            ((d = Ji.prototype),
              (d.destroy = function () {}),
              (d.isSupported = function (e, t) {
                var r = e.startsWith("mss/");
                return !this.g || !r
                  ? !1
                  : t
                    ? ti(this.convertCodecs(t, e))
                    : ((t = this.convertCodecs("audio", e)),
                      (e = this.convertCodecs("video", e)),
                      ti(t) || ti(e));
              }),
              (d.convertCodecs = function (e, t) {
                return t.replace("mss/", "");
              }),
              (d.getOriginalMimeType = function () {
                return this.h;
              }),
              (d.transmux = function (e, t, r) {
                if (!r) return Promise.resolve(We(e));
                if (!t.mssPrivateData) return Promise.reject(new ee(2, 3, 3020, r ? r.P()[0] : null));
                try {
                  var s,
                    a = this.g.parseBuffer(e),
                    c = a.fetch("tfhd");
                  c.track_ID = t.id + 1;
                  var f = a.fetch("tfdt"),
                    g = a.fetch("traf");
                  f === null &&
                    ((f = this.g.createFullBox("tfdt", g, c)),
                    (f.version = 1),
                    (f.flags = 0),
                    (f.baseMediaDecodeTime = Math.floor(r.startTime * t.mssPrivateData.timescale)));
                  var m = a.fetch("trun"),
                    x = a.fetch("tfxd");
                  x && x._parent.boxes.splice(x._parent.boxes.indexOf(x), 1);
                  var E = a.fetch("tfrf");
                  E && E._parent.boxes.splice(E._parent.boxes.indexOf(E), 1);
                  var A = a.fetch("sepiff");
                  if (A !== null) {
                    ((A.type = "senc"), (A.usertype = void 0));
                    var R = a.fetch("saio");
                    if (R === null) {
                      ((R = this.g.createFullBox("saio", g)),
                        (R.version = 0),
                        (R.flags = 0),
                        (R.entry_count = 1),
                        (R.offset = [0]));
                      var b = this.g.createFullBox("saiz", g);
                      if (
                        ((b.version = 0),
                        (b.flags = 0),
                        (b.sample_count = A.sample_count),
                        (b.default_sample_info_size = 0),
                        (b.sample_info_size = []),
                        A.flags & 2)
                      )
                        for (s = 0; s < A.sample_count; s += 1)
                          b.sample_info_size[s] = 10 + 6 * A.entry[s].NumberOfEntries;
                      else b.default_sample_info_size = 8;
                    }
                  }
                  ((c.flags &= 16777214), (c.flags |= 131072), (m.flags |= 1));
                  var D = a.fetch("moof");
                  m.data_offset = D.getLength() + 8;
                  var M = a.fetch("saio");
                  M !== null && (M.offset[0] = TL(D, "traf") + TL(g, "senc") + 16);
                  var P = We(a.write());
                  return Promise.resolve(P);
                } catch (G) {
                  return G instanceof ee
                    ? Promise.reject(G)
                    : Promise.reject(new ee(2, 3, 3022, r ? r.P()[0] : null));
                }
              }));
            function TL(e, t) {
              for (var r = 8, s = 0; s < e.boxes.length && e.boxes[s].type !== t; s++) r += e.boxes[s].size;
              return r;
            }
            (Ee("shaka.transmuxer.MssTransmuxer", Ji),
              (Ji.prototype.transmux = Ji.prototype.transmux),
              (Ji.prototype.getOriginalMimeType = Ji.prototype.getOriginalMimeType),
              (Ji.prototype.convertCodecs = Ji.prototype.convertCodecs),
              (Ji.prototype.isSupported = Ji.prototype.isSupported),
              (Ji.prototype.destroy = Ji.prototype.destroy));
            var $4 = new Uint8Array([162, 57, 79, 82, 90, 155, 79, 20, 162, 68, 108, 66, 124, 100, 141, 244]);
            (Ts(
              "mss/audio/mp4",
              function () {
                return new Ji("mss/audio/mp4");
              },
              io,
            ),
              Ts(
                "mss/video/mp4",
                function () {
                  return new Ji("mss/video/mp4");
                },
                io,
              ));
            function mr(e) {
              ((this.m = e), (this.g = 0), (this.j = new Map()), (this.l = this.i = this.h = null));
            }
            ((d = mr.prototype),
              (d.destroy = function () {
                (this.j.clear(), this.i && this.i.destroy());
              }),
              (d.isSupported = function (e, t) {
                if (e.toLowerCase().split(";")[0] != "video/mp2t") return !1;
                var r = e;
                t && (r = this.convertCodecs(t, e));
                var s = Ei(r).split(",");
                return (
                  (r = Si("audio", s)),
                  (s = Si("video", s)),
                  (r && ((r = Kn(r)), !G4.includes(r))) || (s && ((r = Kn(s)), !j4.includes(r)))
                    ? !1
                    : t
                      ? ti(this.convertCodecs(t, e))
                      : ((t = this.convertCodecs("audio", e)),
                        (e = this.convertCodecs("video", e)),
                        ti(t) || ti(e))
                );
              }),
              (d.convertCodecs = function (e, t) {
                return t.toLowerCase().split(";")[0] == "video/mp2t"
                  ? ((t = Ei(t)
                      .replace("mp4a.40.34", "mp3")
                      .split(",")
                      .map(function (r) {
                        return Fu(r, "audio/mp4");
                      })
                      .map(vE)
                      .join(",")),
                    e == "audio" ? 'audio/mp4; codecs="' + t + '"' : 'video/mp4; codecs="' + t + '"')
                  : t;
              }),
              (d.getOriginalMimeType = function () {
                return this.m;
              }),
              (d.transmux = function (e, t, r, s, a) {
                var c = We(e);
                if (a == "audio" && !Za(c)) {
                  for (var f = Qa(c), g = f.length; g < c.length; g++)
                    if (xL(c, g)) return Promise.reject(new ee(2, 3, 3018, r ? r.P()[0] : null));
                  for (g = f.length; g < c.length; g++)
                    if (gL(c, g))
                      return (this.i || (this.i = new Qi("audio/aac")), this.i.transmux(e, t, r, s, a));
                  return Promise.reject(new ee(2, 3, 3018, r ? r.P()[0] : null));
                }
                (this.h ? this.h.clearData() : (this.h = new Ft()), this.h.Kf(r.i));
                var m = this.h.parse(c),
                  x = [],
                  E = m.Yd();
                try {
                  var A = null;
                  if (a == "video") {
                    switch (E.video) {
                      case "avc":
                        var R = [],
                          b = null,
                          D = m.ud(),
                          M = L4(D);
                        if (!M.length) throw new ee(2, 3, 3023, r ? r.P()[0] : null);
                        for (var P = 0; P < M.length; P++) {
                          var G = M[P];
                          b == null && (b = G.dts);
                          var U = void 0;
                          ((U =
                            P + 1 < M.length
                              ? (M[P + 1].dts || 0) - (G.dts || 0)
                              : M.length > 1
                                ? (G.dts || 0) - (M[P - 1].dts || 0)
                                : (r.endTime - r.startTime) * 9e4),
                            R.push({
                              data: G.data,
                              size: G.data.byteLength,
                              duration: U,
                              sb: Math.round((G.pts || 0) - (G.dts || 0)),
                              flags: {
                                xb: 0,
                                mb: 0,
                                jb: 0,
                                hb: 0,
                                ib: G.isKeyframe ? 2 : 1,
                                yb: G.isKeyframe ? 0 : 1,
                              },
                            }));
                        }
                        for (var H = [], Q = I(D), ne = Q.next(); !ne.done; ne = Q.next())
                          H.push.apply(H, V(ne.value.nalus));
                        var z = C4(H);
                        if (!z || b == null) throw new ee(2, 3, 3018, r ? r.P()[0] : null);
                        ((t.height = z.height),
                          (t.width = z.width),
                          (A = {
                            id: t.id,
                            type: "video",
                            codecs: "avc1",
                            encrypted: t.encrypted && t.drmInfos.length > 0,
                            timescale: 9e4,
                            duration: s,
                            Bb: [],
                            Ga: new Uint8Array([]),
                            Sa: z.Sa,
                            Za: z.Za,
                            $a: z.$a,
                            data: { sequenceNumber: this.g, baseMediaDecodeTime: b, zb: R },
                            stream: t,
                          }));
                        break;
                      case "hvc":
                        var J = [],
                          X = null,
                          ie = [],
                          Z = m.ud();
                        if (!Z.length) throw new ee(2, 3, 3023, r ? r.P()[0] : null);
                        for (var re = 0; re < Z.length; re++) {
                          var se = Z[re],
                            me = se.nalus;
                          ie.push.apply(ie, V(me));
                          for (
                            var fe = !1, le = [], ue = !1, xe = I(me), Se = xe.next();
                            !Se.done;
                            Se = xe.next()
                          ) {
                            var Ye = Se.value;
                            switch (Ye.type) {
                              case 1:
                              case 0:
                                var be = (ue = !0);
                                break;
                              case 19:
                              case 20:
                              case 21:
                                fe = be = ue = !0;
                                break;
                              case 32:
                                be = !0;
                                break;
                              case 33:
                                be = !0;
                                break;
                              case 34:
                                be = !0;
                                break;
                              case 35:
                                ue = be = !0;
                                break;
                              case 39:
                              case 40:
                                be = !0;
                                break;
                              default:
                                be = !1;
                            }
                            if (ue && be) {
                              var xt = Ye.fullData.byteLength,
                                qe = new Uint8Array(4);
                              ((qe[0] = (xt >> 24) & 255),
                                (qe[1] = (xt >> 16) & 255),
                                (qe[2] = (xt >> 8) & 255),
                                (qe[3] = xt & 255),
                                le.push(qe),
                                le.push(Ye.fullData));
                            }
                          }
                          var Ct = le.length ? { data: dn.apply(Hn, V(le)), isKeyframe: fe } : null;
                          if (Ct) {
                            X == null && se.dts != null && (X = se.dts);
                            var lt = void 0;
                            ((lt =
                              re + 1 < Z.length
                                ? (Z[re + 1].dts || 0) - (se.dts || 0)
                                : Z.length > 1
                                  ? (se.dts || 0) - (Z[re - 1].dts || 0)
                                  : (r.endTime - r.startTime) * 9e4),
                              J.push({
                                data: Ct.data,
                                size: Ct.data.byteLength,
                                duration: lt,
                                sb: Math.round((se.pts || 0) - (se.dts || 0)),
                                flags: {
                                  xb: 0,
                                  mb: 0,
                                  jb: 0,
                                  hb: 0,
                                  ib: Ct.isKeyframe ? 2 : 1,
                                  yb: Ct.isKeyframe ? 0 : 1,
                                },
                              }));
                          }
                        }
                        var rt = b4(ie);
                        if (!rt || X == null) throw new ee(2, 3, 3018, r ? r.P()[0] : null);
                        ((t.height = rt.height),
                          (t.width = rt.width),
                          (A = {
                            id: t.id,
                            type: "video",
                            codecs: "hvc1",
                            encrypted: t.encrypted && t.drmInfos.length > 0,
                            timescale: 9e4,
                            duration: s,
                            Bb: [],
                            Ga: new Uint8Array([]),
                            Sa: rt.Sa,
                            Za: rt.Za,
                            $a: rt.$a,
                            data: { sequenceNumber: this.g, baseMediaDecodeTime: X, zb: J },
                            stream: t,
                          }));
                    }
                    A && (x.push(A), (A = null));
                  }
                  if (a == "audio") {
                    switch (E.audio) {
                      case "aac":
                        for (
                          var dt = [], yt, ht = null, st = null, ut = null, An = I(m.ub()), mn = An.next();
                          !mn.done;
                          mn = An.next()
                        ) {
                          var Zi = mn.value,
                            Li = Zi.data;
                          if (Li) {
                            var fi = 0;
                            if (st == -1 && ut) ((Li = dn(ut, Zi.data)), (st = null));
                            else if (st != null && ut) {
                              fi = Math.max(0, st);
                              var da = dn(ut, Li.subarray(0, fi));
                              (dt.push({
                                data: da,
                                size: da.byteLength,
                                duration: 1024,
                                sb: 0,
                                flags: { xb: 0, mb: 0, jb: 0, hb: 0, ib: 2, yb: 0 },
                              }),
                                (st = ut = null));
                            }
                            if (((yt = pL(Li, fi)), !yt)) throw new ee(2, 3, 3018, r ? r.P()[0] : null);
                            for (
                              t.audioSamplingRate = yt.sampleRate,
                                t.channelsCount = yt.channelCount,
                                ht == null && Zi.pts !== null && (ht = Zi.pts);
                              fi < Li.length;
                            ) {
                              var Us = fL(Li, fi);
                              if (!Us) {
                                ((ut = Li.subarray(fi, Li.length)), (st = -1));
                                break;
                              }
                              var _r = Us.ee + Us.ra;
                              ((st = Math.max(0, fi + _r - Li.length)),
                                st != 0
                                  ? (ut = Li.subarray(fi + Us.ee, fi + _r))
                                  : fi + _r <= Li.length &&
                                    dt.push({
                                      data: Li.subarray(fi + Us.ee, fi + _r),
                                      size: Us.ra,
                                      duration: 1024,
                                      sb: 0,
                                      flags: { xb: 0, mb: 0, jb: 0, hb: 0, ib: 2, yb: 0 },
                                    }),
                                (fi += _r));
                            }
                          }
                        }
                        if (!yt || ht == null) {
                          ht = r.startTime * 9e4;
                          var Ll = Si("audio", t.codecs.split(","));
                          if (!Ll || !t.channelsCount || !t.audioSamplingRate)
                            throw new ee(2, 3, 3018, r ? r.P()[0] : null);
                          yt = { sampleRate: t.audioSamplingRate, channelCount: t.channelsCount, codec: Ll };
                          var _l = w4(Ll, t.channelsCount);
                          if (!_l) throw new ee(2, 3, 3018, r ? r.P()[0] : null);
                          for (var Tp = ht + (r.endTime - r.startTime) * 9e4, br = ht; br < Tp; )
                            (dt.push({
                              data: _l,
                              size: _l.byteLength,
                              duration: 1024,
                              sb: 0,
                              flags: { xb: 0, mb: 0, jb: 0, hb: 0, ib: 2, yb: 0 },
                            }),
                              (br += (1024 / yt.sampleRate) * 9e4));
                        }
                        var Sp = yt.sampleRate,
                          Vv = (ht / 9e4) * Sp;
                        A = {
                          id: t.id,
                          type: "audio",
                          codecs: yt.codec,
                          encrypted: t.encrypted && t.drmInfos.length > 0,
                          timescale: Sp,
                          duration: s,
                          Bb: [],
                          Ga: new Uint8Array([]),
                          Sa: new Uint8Array([]),
                          Za: 0,
                          $a: 0,
                          data: { sequenceNumber: this.g, baseMediaDecodeTime: Vv, zb: dt },
                          stream: t,
                        };
                        break;
                      case "ac3":
                        for (
                          var Ep = [],
                            bl = 0,
                            Vc = new Uint8Array([]),
                            yn = null,
                            Gi = I(m.ub()),
                            pi = Gi.next();
                          !pi.done;
                          pi = Gi.next()
                        ) {
                          var Hv = pi.value,
                            Kv = Hv.data;
                          yn == null && Hv.pts !== null && (yn = Hv.pts);
                          for (var Dl = 0; Dl < Kv.length; ) {
                            var Ao = mL(Kv, Dl);
                            Ao
                              ? ((t.audioSamplingRate = Ao.sampleRate),
                                (t.channelsCount = Ao.channelCount),
                                (bl = Ao.sampleRate),
                                (Vc = Ao.Ga),
                                Ep.push({
                                  data: Kv.subarray(Dl, Dl + Ao.ra),
                                  size: Ao.ra,
                                  duration: 1536,
                                  sb: 0,
                                  flags: { xb: 0, mb: 0, jb: 0, hb: 0, ib: 2, yb: 0 },
                                }),
                                (Dl += Ao.ra))
                              : Dl++;
                          }
                        }
                        if (bl == 0 || Vc.byteLength == 0 || yn == null)
                          throw new ee(2, 3, 3018, r ? r.P()[0] : null);
                        var V4 = (yn / 9e4) * bl;
                        A = {
                          id: t.id,
                          type: "audio",
                          codecs: "ac-3",
                          encrypted: t.encrypted && t.drmInfos.length > 0,
                          timescale: bl,
                          duration: s,
                          Bb: [],
                          Ga: Vc,
                          Sa: new Uint8Array([]),
                          Za: 0,
                          $a: 0,
                          data: { sequenceNumber: this.g, baseMediaDecodeTime: V4, zb: Ep },
                          stream: t,
                        };
                        break;
                      case "ec3":
                        for (
                          var EL = [],
                            Ap = 0,
                            Wv = new Uint8Array([]),
                            Ip = null,
                            AL = I(m.ub()),
                            zv = AL.next();
                          !zv.done;
                          zv = AL.next()
                        ) {
                          var Yv = zv.value,
                            Xv = Yv.data;
                          Ip == null && Yv.pts !== null && (Ip = Yv.pts);
                          for (var kl = 0; kl < Xv.length; ) {
                            var Io = yL(Xv, kl);
                            Io
                              ? ((t.audioSamplingRate = Io.sampleRate),
                                (t.channelsCount = Io.channelCount),
                                (Ap = Io.sampleRate),
                                (Wv = Io.Ga),
                                EL.push({
                                  data: Xv.subarray(kl, kl + Io.ra),
                                  size: Io.ra,
                                  duration: 1536,
                                  sb: 0,
                                  flags: { xb: 0, mb: 0, jb: 0, hb: 0, ib: 2, yb: 0 },
                                }),
                                (kl += Io.ra))
                              : kl++;
                          }
                        }
                        if (Ap == 0 || Wv.byteLength == 0 || Ip == null)
                          throw new ee(2, 3, 3018, r ? r.P()[0] : null);
                        var H4 = (Ip / 9e4) * Ap;
                        A = {
                          id: t.id,
                          type: "audio",
                          codecs: "ec-3",
                          encrypted: t.encrypted && t.drmInfos.length > 0,
                          timescale: Ap,
                          duration: s,
                          Bb: [],
                          Ga: Wv,
                          Sa: new Uint8Array([]),
                          Za: 0,
                          $a: 0,
                          data: { sequenceNumber: this.g, baseMediaDecodeTime: H4, zb: EL },
                          stream: t,
                        };
                        break;
                      case "mp3":
                        for (
                          var IL = [], wp, Rp = null, wL = I(m.ub()), qv = wL.next();
                          !qv.done;
                          qv = wL.next()
                        ) {
                          var Qv = qv.value,
                            Hc = Qv.data;
                          if (Hc) {
                            Rp == null && Qv.pts !== null && (Rp = Qv.pts);
                            for (var ha = 0; ha < Hc.length; ) {
                              var Ml = xp(Hc, ha);
                              Ml
                                ? (wp || (wp = Ml),
                                  ha + Ml.ra <= Hc.length &&
                                    IL.push({
                                      data: Hc.subarray(ha, ha + Ml.ra),
                                      size: Ml.ra,
                                      duration: 1152,
                                      sb: 0,
                                      flags: { xb: 0, mb: 0, jb: 0, hb: 0, ib: 2, yb: 0 },
                                    }),
                                  (ha += Ml.ra))
                                : ha++;
                            }
                          }
                        }
                        if (!wp || Rp == null) throw new ee(2, 3, 3018, r ? r.P()[0] : null);
                        var RL = wp.sampleRate,
                          K4 = (Rp / 9e4) * RL;
                        A = {
                          id: t.id,
                          type: "audio",
                          codecs: "mp3",
                          encrypted: t.encrypted && t.drmInfos.length > 0,
                          timescale: RL,
                          duration: s,
                          Bb: [],
                          Ga: new Uint8Array([]),
                          Sa: new Uint8Array([]),
                          Za: 0,
                          $a: 0,
                          data: { sequenceNumber: this.g, baseMediaDecodeTime: K4, zb: IL },
                          stream: t,
                        };
                        break;
                      case "opus":
                        var CL = [],
                          Cp = null,
                          ns = m.H;
                        if (!ns) throw new ee(2, 3, 3018, r ? r.P()[0] : null);
                        var gi = [];
                        switch (ns.uj) {
                          case 1:
                          case 2:
                            gi = [0];
                            break;
                          case 0:
                            gi = [255, 1, 1, 0, 1];
                            break;
                          case 128:
                            gi = [255, 2, 0, 0, 1];
                            break;
                          case 3:
                            gi = [1, 2, 1, 0, 2, 1];
                            break;
                          case 4:
                            gi = [1, 2, 2, 0, 1, 2, 3];
                            break;
                          case 5:
                            gi = [1, 3, 2, 0, 4, 1, 2, 3];
                            break;
                          case 6:
                            gi = [1, 4, 2, 0, 4, 1, 2, 3, 5];
                            break;
                          case 7:
                            gi = [1, 4, 2, 0, 4, 1, 2, 3, 5, 6];
                            break;
                          case 8:
                            gi = [1, 5, 3, 0, 6, 1, 2, 3, 4, 5, 7];
                            break;
                          case 130:
                            gi = [1, 1, 2, 0, 1];
                            break;
                          case 131:
                            gi = [1, 1, 3, 0, 1, 2];
                            break;
                          case 132:
                            gi = [1, 1, 4, 0, 1, 2, 3];
                            break;
                          case 133:
                            gi = [1, 1, 5, 0, 1, 2, 3, 4];
                            break;
                          case 134:
                            gi = [1, 1, 6, 0, 1, 2, 3, 4, 5];
                            break;
                          case 135:
                            gi = [1, 1, 7, 0, 1, 2, 3, 4, 5, 6];
                            break;
                          case 136:
                            gi = [1, 1, 8, 0, 1, 2, 3, 4, 5, 6, 7];
                        }
                        for (
                          var LL = new Uint8Array(
                              [
                                0,
                                ns.channelCount,
                                0,
                                0,
                                (ns.sampleRate >>> 24) & 255,
                                (ns.sampleRate >>> 17) & 255,
                                (ns.sampleRate >>> 8) & 255,
                                (ns.sampleRate >>> 0) & 255,
                                0,
                                0,
                              ].concat(V(gi)),
                            ),
                            _L = ns.sampleRate,
                            bL = I(m.ub()),
                            Jv = bL.next();
                          !Jv.done;
                          Jv = bL.next()
                        ) {
                          var Zv = Jv.value,
                            Pl = Zv.data;
                          Cp == null && Zv.pts !== null && (Cp = Zv.pts);
                          for (var Kc = 0; Kc < Pl.length; ) {
                            for (
                              var W4 = (Pl[Kc + 1] & 16) !== 0,
                                z4 = (Pl[Kc + 1] & 8) !== 0,
                                Bs = Kc + 2,
                                Lp = 0;
                              Pl[Bs] === 255;
                            )
                              ((Lp += 255), (Bs += 1));
                            ((Lp += Pl[Bs]), (Bs += 1), (Bs += W4 ? 2 : 0), (Bs += z4 ? 2 : 0));
                            var DL = Pl.slice(Bs, Bs + Lp);
                            (CL.push({
                              data: DL,
                              size: DL.byteLength,
                              duration: 960,
                              sb: 0,
                              flags: { xb: 0, mb: 0, jb: 0, hb: 0, ib: 2, yb: 0 },
                            }),
                              (Kc = Bs + Lp));
                          }
                        }
                        if (LL.byteLength == 0 || Cp == null) throw new ee(2, 3, 3018, r ? r.P()[0] : null);
                        ((t.audioSamplingRate = ns.sampleRate), (t.channelsCount = ns.channelCount));
                        var Y4 = (Cp / 9e4) * _L;
                        A = {
                          id: t.id,
                          type: "audio",
                          codecs: "opus",
                          encrypted: t.encrypted && t.drmInfos.length > 0,
                          timescale: _L,
                          duration: s,
                          Bb: [],
                          Ga: LL,
                          Sa: new Uint8Array([]),
                          Za: 0,
                          $a: 0,
                          data: { sequenceNumber: this.g, baseMediaDecodeTime: Y4, zb: CL },
                          stream: t,
                        };
                    }
                    A && (x.push(A), (A = null));
                  }
                } catch (tx) {
                  return tx && tx.code == 3023 ? Promise.resolve(new Uint8Array([])) : Promise.reject(tx);
                }
                if (!x.length) return Promise.reject(new ee(2, 3, 3018, r ? r.P()[0] : null));
                var kL = new Ya(x),
                  ex = t.id + "_" + r.i;
                if (this.j.has(ex)) var Wc = this.j.get(ex);
                else ((Wc = Xa(kL)), this.j.set(ex, Wc));
                var X4 = this.l !== Wc,
                  q4 = Hu(kL);
                return ((this.l = Wc), this.g++, Promise.resolve({ data: q4, init: X4 ? Wc : null }));
              }),
              Ee("shaka.transmuxer.TsTransmuxer", mr),
              (mr.prototype.transmux = mr.prototype.transmux),
              (mr.prototype.getOriginalMimeType = mr.prototype.getOriginalMimeType),
              (mr.prototype.convertCodecs = mr.prototype.convertCodecs),
              (mr.prototype.isSupported = mr.prototype.isSupported),
              (mr.prototype.destroy = mr.prototype.destroy));
            var G4 = ["aac", "ac-3", "ec-3", "mp3", "opus"],
              j4 = ["avc", "hevc"];
            Ts(
              "video/mp2t",
              function () {
                return new mr("video/mp2t");
              },
              Cm,
            );
            function SL() {}
            (N(SL, Ii), Ee("shaka.util.FairPlayUtils", SL));
          }).call(i, n, n, void 0);
          for (var o in i.shaka) u[o] = i.shaka[o];
        })();
      })(Ax)),
    Ax
  );
}
tV();
const ST = {
    lightning: {
      debug: !1,
      focusDebug: !1,
      fontSettings: { fontFamily: "Roboto", color: 4294967295, fontSize: 40 },
      animationSettings: { easing: "ease-in-out", duration: 250 },
      rendererOptions: {
        appHeight: 1080,
        appWidth: 1920,
        numImageWorkers: 2,
        fontEngines: [Zj],
        renderEngine: x5,
        deviceLogicalPixelRatio: 1,
        devicePhysicalPixelRatio: 1,
        boundsMargin: 20,
        createImageBitmapSupport: "auto",
      },
    },
    keys: {
      Back: ["Escape", 461, 27],
      Backspace: ["Backspace", 8],
      Left: ["ArrowLeft", 37],
      Right: ["ArrowRight", 39],
      Up: ["ArrowUp", 38],
      Down: ["ArrowDown", 40],
      Enter: ["Enter", 13],
    },
    keyHoldOptions: { userKeyHoldMap: { EnterHold: ["Enter", 13], BackHold: ["b", 66] }, holdThreshold: 1e3 },
  },
  nV =
    "eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIxODU4MjY0ZTM2ZWQ1NzZkYzM3ZDU5MjJmNzM3MWRmNiIsIm5iZiI6MTY2NzIzOTgzMS45MDIwMDAyLCJzdWIiOiI2MzYwMGY5NzFkYmM4ODAwOTBmNTIxMDAiLCJzY29wZXMiOlsiYXBpX3JlYWQiXSwidmVyc2lvbiI6MX0.LXx9-LdX9JsiY0DhpmjYcYitlqPJqntNHVv-HGZXpww",
  iV = "https://api.themoviedb.org/3";
let vk, xk;
const rV = new URLSearchParams(window.location.search),
  sV = rV.get("posterSize") || "w185",
  oV = { headers: { "Content-Type": "application/json", Authorization: "Bearer " + nV } };
function sS(u, n = sV) {
  return xk + n + u;
}
function aV(u, n = {}) {
  return vk ? ET(u, n) : Tk().then(() => ET(u, n));
}
function ET(u, n = {}) {
  return fetch(iV + u, { ...oV, ...n }).then(i => i.json());
}
function Tk() {
  return ET("/configuration").then(u => {
    var n;
    return ((vk = u), (xk = (n = u.images) == null ? void 0 : n.secure_base_url), u);
  });
}
const $d = { get: aV, loadConfig: Tk };
async function lV(u) {
  try {
    const n = await $d.get("/discover/movie");
    return (u ? n.results.slice(0, 5) : n.results).map(o => ({
      title: o.title,
      poster_path: o.poster_path,
      overview: o.overview,
      backdrop_path: o.backdrop_path,
      id: o.id,
    }));
  } catch (n) {
    throw (console.error(n), n);
  }
}
async function uV() {
  try {
    return (await $d.get("/discover/movie")).results.map(n => ({
      title: n.title,
      poster_path: n.poster_path,
      overview: n.overview,
      backdrop_path: n.backdrop_path,
      id: n.id,
    }));
  } catch (u) {
    throw (console.error(u), u);
  }
}
async function cV(u) {
  try {
    const n = await $d.get("/discover/tv");
    return (u ? n.results.slice(0, 5) : n.results).map(o => ({
      title: o.name,
      poster_path: o.poster_path,
      overview: o.overview,
      backdrop_path: o.backdrop_path,
      id: o.id,
    }));
  } catch (n) {
    throw (console.error(n), n);
  }
}
function dV() {
  const u = [];
  return (
    u.push({ title: "MOVIES", items: Cg(() => lV(!0))[0] }),
    u.push({ title: "SERIES", items: Cg(() => cV(!0))[0] }),
    { rows: u }
  );
}
function hV() {
  const [u] = Cg(() => uV());
  return { movies: u };
}
const fV = "" + new URL("logo-CWMc854L.png", import.meta.url).href,
  Ix = {
    container: { display: "flex", flexDirection: "column", justifyContent: "center", alignItems: "center" },
    text: { fontFamily: "Roboto", fontSize: 32, color: 1465341951 },
    underline: { width: "100%", height: 4, y: 4, color: 4278190335, alpha: 0, $focus: { alpha: 1 } },
  };
function pV(u) {
  return Ae(
    pt,
    Ud(
      {
        forwardStates: !0,
        get style() {
          return Ix.container;
        },
      },
      u,
      {
        get children() {
          return [
            Ae(Gn, {
              get style() {
                return Ix.text;
              },
              get color() {
                return u.selected ? 4294967295 : 1465341951;
              },
              get children() {
                return u.children;
              },
            }),
            Ae(pt, {
              get style() {
                return Ix.underline;
              },
            }),
          ];
        },
      },
    ),
  );
}
const gV = [
    { label: "Home", path: "/" },
    { label: "Movies", path: "/movies" },
  ],
  mV = u => {
    const n = Ra(),
      i = () => (mT() === "/" || n(-1), !0);
    let o, l;
    return Ae(pt, {
      onUp: () => o.setFocus(),
      onDown: () => l.setFocus(),
      onBack: i,
      onBackspace: i,
      get children() {
        return [
          Ae(pt, { x: 32, y: 32, src: fV, width: 301, height: 60, zIndex: 200 }),
          Ae(Id, {
            x: 400,
            y: 37,
            gap: 20,
            ref(d) {
              var y = o;
              typeof y == "function" ? y(d) : (o = d);
            },
            zIndex: 200,
            get children() {
              return Ae(Ad, {
                each: gV,
                children: d =>
                  Ae(
                    pV,
                    Ud(u, {
                      get selected() {
                        return d.path === mT();
                      },
                      width: 118,
                      height: 49,
                      onEnter: () => n(d.path),
                      onClick: () => n(d.path),
                      get children() {
                        return d.label;
                      },
                    }),
                  ),
              });
            },
          }),
          Ae(pt, {
            y: 0,
            ref(d) {
              var y = l;
              typeof y == "function" ? y(d) : (l = d);
            },
            forwardFocus: 0,
            get children() {
              return u.children;
            },
          }),
        ];
      },
    });
  },
  yV = { scale: 1, $focus: { scale: 1.1 } },
  vV = {
    fontFamily: "Inter",
    fontWeight: 400,
    fontSize: 24,
    maxLines: 1,
    contain: "width",
    lineHeight: 1,
    color: 4294967193,
    $focus: { color: 4294967295 },
  },
  xV = { borderRadius: 6, $focus: { border: { width: 6, color: 3978044671 } } },
  TV = u => {
    const { id: n, title: i, poster_path: o } = u.item;
    return Ae(pt, {
      id: "card",
      get width() {
        return u.style.width;
      },
      get height() {
        return u.style.height;
      },
      display: "flex",
      flexDirection: "column",
      gap: 16,
      style: yV,
      forwardStates: !0,
      onEnter: () => u.onEnter(),
      get children() {
        return [
          Ae(pt, {
            id: "pic",
            style: xV,
            get src() {
              return sS(o, "w342");
            },
          }),
          Ae(Gn, {
            id: "text",
            get y() {
              return u.style.height;
            },
            get width() {
              return u.style.width;
            },
            style: vV,
            children: i,
          }),
        ];
      },
    });
  },
  M_ = "" + new URL("background.jpg", import.meta.url).href,
  AT = {
    homeCard: { width: 229, height: 300 },
    page: { width: 1920, height: 1080 },
    topChannelsWrapper: {
      width: 312,
      height: 837,
      alignItems: "center",
      justifyContent: "center",
      borderRadius: 16,
      gap: 16,
      color: 255,
    },
  },
  SV = "static/images/channels/",
  EV = {
    width: 280,
    height: 136,
    color: 404232447,
    borderRadius: 16,
    display: "flex",
    flexDirection: "column",
    justifyContent: "center",
    alignItems: "center",
    gap: 24,
    $focus: { border: { width: 4, color: 3978044671 } },
  },
  AV = { fontFamily: "Inter", fontWeight: 400, fontSize: 16, lineHeight: 1, height: 19 },
  IV = u =>
    Ae(pt, {
      style: EV,
      id: "card",
      get children() {
        return [
          Ae(pt, {
            width: 45,
            height: 45,
            get src() {
              return SV + u.channel.image;
            },
          }),
          Ae(Gn, {
            style: AV,
            get children() {
              return u.channel.name;
            },
          }),
        ];
      },
    }),
  wV = [
    { name: "CBS", image: "CBS.png" },
    { name: "NBC", image: "NBC.png" },
    { name: "ABC", image: "ABC.png" },
    { name: "Fox", image: "FOX.png" },
    { name: "Fox News Channel", image: "FNC.png" },
  ],
  P_ = {
    fontFamily: "Inter",
    fontWeight: 700,
    fontSize: 24,
    lineHeight: 1,
    width: 280,
    height: 29,
    display: "flex",
    justifyContent: "center",
    alignSelf: "center",
  },
  RV = () =>
    Ae(kg, {
      get style() {
        return AT.topChannelsWrapper;
      },
      flexBoundary: "fixed",
      get children() {
        return [
          Ae(pt, {
            style: P_,
            skipFocus: !0,
            get children() {
              return Ae(Gn, { style: P_, children: "Top 5 Channels" });
            },
          }),
          Ae(Ad, { each: wV, children: u => Ae(IV, { channel: u }) }),
        ];
      },
    }),
  CV = {
    borderRadius: 30,
    width: 352,
    height: 67,
    top: 19,
    color: 791621631,
    display: "flex",
    justifyContent: "center",
    alignItems: "center",
    $focus: { color: 3978044671 },
  },
  LV = { fontFace: "Inter", fontWeight: 600, fontSize: 24, letterSpacing: 0.06, display: "flex" },
  _V = u =>
    Ae(pt, {
      style: CV,
      get children() {
        return Ae(Gn, { style: LV, children: "GO TO LIVE PLAYER" });
      },
    });
function Sk() {
  const u = Ra();
  return {
    toDetails(n, i) {
      u("/".concat(i.toLowerCase(), "/details/").concat(n));
    },
  };
}
const oS = u => {
    var i, o, l, h;
    ((i = u.xPos) != null, (o = u.yPos) != null, (l = u.width) != null, (h = u.height) != null);
    let n;
    return (
      WT(() => {
        n.animate({ rotation: Math.PI * 2 }, { duration: 1e3, repeat: -1, easing: "linear" }).start();
      }),
      [
        Ae(pt, {
          ref(p) {
            var d = n;
            typeof d == "function" ? d(p) : (n = p);
          },
          src: "../../../public/assets/zabrinutiMita.png",
          width: 120,
          height: 120,
          zIndex: 200,
          x: 960,
          y: 540,
          mountX: 0.5,
          mountY: 0.5,
        }),
        Ae(Gn, { x: 880, y: 620, children: "Loading..." }),
      ]
    );
  },
  bV = { fontFamily: "Inter", fontWeight: 700, fontSize: 24, letterSpacing: 0.06, color: 4294967295 },
  DV = u => {
    (ld(1920), ud(1080), ru(M_));
    const n = () => {
      ru(M_);
    };
    ek("movies");
    const { toDetails: i } = Sk();
    return Ae(gu, {
      get when() {
        return u.data.rows[0].items();
      },
      get fallback() {
        return Ae(oS, {});
      },
      get children() {
        return Ae(pt, {
          get style() {
            return AT.page;
          },
          forwardFocus: 1,
          onFocus: n,
          get children() {
            return [
              Ae(pt, { id: "gradient", width: 1920, height: 1080, colorTl: 353703423, colorBr: 0 }),
              Ae(kg, {
                y: 125,
                x: 62,
                gap: 5,
                get children() {
                  return [
                    Ae(Id, {
                      id: "homeContainer",
                      scroll: "none",
                      get children() {
                        return [
                          Ae(kg, {
                            id: "mediaContainer",
                            width: 1241,
                            height: 404,
                            autofocus: !0,
                            get children() {
                              return Ae(Ad, {
                                get each() {
                                  return u.data.rows;
                                },
                                children: o => [
                                  Ae(Gn, {
                                    style: bV,
                                    skipFocus: !0,
                                    get children() {
                                      return o.title;
                                    },
                                  }),
                                  Ae(Id, {
                                    width: 1241,
                                    height: 359,
                                    gap: 24,
                                    scroll: "none",
                                    get children() {
                                      return Ae(Ad, {
                                        get each() {
                                          return o.items();
                                        },
                                        children: l =>
                                          Ae(TV, {
                                            item: l,
                                            get style() {
                                              return AT.homeCard;
                                            },
                                            onEnter: () => i(l.id, o.title),
                                          }),
                                      });
                                    },
                                  }),
                                ],
                              });
                            },
                          }),
                          Ae(RV, {}),
                        ];
                      },
                    }),
                    Ae(_V, {}),
                  ];
                },
              }),
            ];
          },
        });
      },
    });
  },
  kV = { width: 440, height: 265, scale: 1, $focus: { scale: 1.1 } },
  MV = {
    fontWeight: 400,
    fontSize: 24,
    maxLines: 1,
    contain: "width",
    lineHeight: 1,
    color: 4294967193,
    $focus: { color: 4294967295 },
  },
  PV = { borderRadius: 6, $focus: { border: { width: 6, color: 3978044671 } } },
  OV = u => {
    const { title: n, poster_path: i } = u.item;
    return Ae(pt, {
      id: "card",
      get item() {
        return u.item;
      },
      get width() {
        return u.style.width;
      },
      get height() {
        return u.style.height;
      },
      display: "flex",
      flexDirection: "column",
      style: kV,
      gap: 16,
      forwardStates: !0,
      focusable: !0,
      onEnter: () => u.onEnter(),
      get children() {
        return [
          Ae(pt, {
            id: "picture",
            style: PV,
            get src() {
              return sS(i, "w92");
            },
          }),
          Ae(Gn, {
            id: "text",
            get y() {
              return u.style.height;
            },
            get width() {
              return u.style.width;
            },
            style: MV,
            children: n,
          }),
        ];
      },
    });
  },
  NV = { fontWeight: 700, fontSize: 24, letterSpacing: 0.06, color: 4294967295 },
  FV = u => {
    const { toDetails: n } = Sk();
    (ld(1920), ud(697), ru(" "));
    const i = () => location.hash.endsWith("movies"),
      o = dT(h => {
        i() && ru(h);
      }, 400),
      l = dT((h, p) => {
        i() && (g_(h), m_(p));
      }, 400);
    return (
      WT(() => {
        var d, y;
        v_(0);
        const h = (y = (d = u.data).movies) == null ? void 0 : y.call(d);
        if (!(h != null && h.length)) return;
        const p = h[0];
        p != null &&
          p.backdrop_path &&
          (ld(1920),
          ud(697),
          ru("https://image.tmdb.org/t/p/w300/".concat(p.backdrop_path)),
          g_(p.title || p.name || ""),
          m_(p.overview || ""));
      }),
      Ae(gu, {
        get when() {
          var h;
          return (h = u.data.movies()) == null ? void 0 : h.length;
        },
        get fallback() {
          return Ae(oS, {});
        },
        get children() {
          return Ae(pt, {
            forwardFocus: 4,
            focusable: !0,
            get children() {
              return [
                Ae(pt, {
                  width: 1920,
                  height: 1080,
                  colorTl: 353703423,
                  colorTr: "rgba(21,21,21,0.6)",
                  colorBl: 353703423,
                  colorBr: "rgba(21,21,21,0.6)",
                }),
                Ae(pt, {
                  width: 1920,
                  height: 1080,
                  colorTl: 353703423,
                  colorTr: 353703423,
                  colorBl: "rgba(21,21,21,0)",
                  colorBr: "rgba(21,21,21,0)",
                }),
                Ae(Gn, {
                  x: 69,
                  y: 258,
                  fontSize: 28,
                  fontWeight: 600,
                  color: 4294967295,
                  fontFamily: "Inter",
                  get children() {
                    return aG();
                  },
                }),
                Ae(Gn, {
                  width: 698,
                  height: 124,
                  x: 69,
                  y: 316,
                  fontSize: 22,
                  fontWeight: 600,
                  contain: "width",
                  fontFamily: "Inter",
                  lineHeight: 31,
                  get children() {
                    return lG();
                  },
                }),
                Ae(Id, {
                  y: 697,
                  x: 64,
                  gap: 24,
                  width: 1241,
                  scroll: "center",
                  throttleInput: 50,
                  autofocus: !0,
                  get selected() {
                    return dG();
                  },
                  onSelectedChanged: (h, p, d, y) => {
                    v_(h);
                    const v = p.children[h],
                      T = v == null ? void 0 : v.item;
                    T != null &&
                      T.backdrop_path &&
                      (ld(1920),
                      ud(697),
                      o("https://image.tmdb.org/t/p/w300/".concat(T.backdrop_path)),
                      l(T.title || T.name || "", T.overview || ""));
                  },
                  get children() {
                    return Ae(Ad, {
                      get each() {
                        var h;
                        return (h = u.data.movies()) != null ? h : [];
                      },
                      children: h => Ae(OV, { item: h, style: NV, onEnter: () => n(h.id, "movies") }),
                    });
                  },
                }),
              ];
            },
          });
        },
      })
    );
  };
async function UV(u) {
  return await $d.get("/movie/" + u);
}
async function BV(u) {
  const n = await $d.get("/tv/" + u),
    {
      name: i,
      genres: o,
      episode_run_time: l,
      origin_country: h,
      first_air_date: p,
      poster_path: d,
      overview: y,
      backdrop_path: v,
      id: T,
      vote_average: S,
    } = n;
  return {
    title: i,
    genres: o,
    runtime: l,
    origin_country: h,
    release_date: p,
    poster_path: d,
    overview: y,
    backdrop_path: v,
    id: T,
    vote_average: S,
  };
}
const $V =
    "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAABQ0lEQVR4AczXgQ2CMBCFYWESR3EUnUSdRDfRUXQSfH9jyBmptEJzZ3qhtli+FFrOfrPgMwzDSbFfMMTsT/8GCnbT6EfFRfWdjk3KX0CBwFnUtolOg1YDJ3DXruuuGqtJqQJmcIcmsvegxUAPHMYioBeuCOiJmwV6434CI+CywCi4SaBwF3XYTZh9rulWoutly8cqfuPsu9UVh3oERsSNwAkcfU+1k614RbqTvRBUCFA2yFQ8I2VJ3OKHVUWr98pE7kKdFbaAps0zDtiYwY0qJ+nA6JBKyu9od4yUwiUgJCA6WuRRzydwNfuVEQghIvIDCFLB1IaZyS+gZpEFEgb5BdQMsmjCICeBkZBZYB2Ss9vETyCX9H4mZ4HeyCKgJ7IYOIO0GTinrhZVQK6aeSbTu5v+taMaCMAg+a9y1nc2drpWjxcAAAD//5aIUZAAAAAGSURBVAMA7GtAR3aIKhkAAAAASUVORK5CYII=",
  GV = {
    width: 112,
    height: 64,
    borderRadius: 300,
    display: "flex",
    justifyContent: "center",
    alignItems: "center",
    color: 791621631,
    $focus: { color: 3978044671 },
  },
  jV = u => (
    Ra(),
    Ae(pt, {
      style: GV,
      onEnter: () => history.back(),
      get children() {
        return Ae(pt, { src: $V, width: 48, height: 48 });
      },
    })
  ),
  VV =
    "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAASCAYAAABSO15qAAAA7ElEQVR4AaSQCxHCQAxE2ypAAjgACTgABRQFrQOKAloHVAFIwAE4AAfg4Hh7c2Wm9P+ZbJPcZTfJBR6fMSYyxqRgTjrIAkghjBRE4El+ADPiXqYJ/rsmMO+I7PCdJoG6IomeEbkAxXU19qxJwF7y24DWtboE4FtrXKuvgFS0itbS+yjWmTdEwBL4LYHWOuFHCYgnxDxwPGYCkQu8pwhkvu/nYwRutF9BjvGD3uAFIYS4Bg9ia30nOFKtrjm+ZF0CGndBxwR8SkyXNAlo3C0kjavYlVedBH77uOti3KvLW11AFxXuqcpA67jcV+wLAAD//znRRWQAAAAGSURBVAMAUnpQLAZjcHYAAAAASUVORK5CYII=",
  HV = {
    width: 286,
    height: 78,
    borderRadius: 300,
    gap: 10,
    color: 791621631,
    display: "flex",
    flexDirection: "row",
    justifyContent: "center",
    alignItems: "center",
    $focus: { color: 3978044671 },
  },
  KV = { fontFamily: "Inter", fontWeight: 600, fontSize: 20, lineHeight: 1, letterSpacing: 0.08 },
  WV = u => {
    const n = Ra();
    return Ae(pt, {
      style: HV,
      onEnter: () => {
        n("/player");
      },
      get children() {
        return [Ae(pt, { src: VV, width: 24, height: 24 }), Ae(Gn, { style: KV, children: "WATCH NOW" })];
      },
    });
  },
  wx = { fontFamily: "Inter", fontWeight: 400, fontSize: 20, lineHeight: 29, letterSpacing: 0 },
  zV = () => {
    const { id: u, mediaType: n } = E8(),
      [i] = Cg(() => u, n === "movies" ? UV : BV),
      o = Ra();
    (ld(1920), ud(1080), ru(" a"));
    const l = () => (o(-1), !0);
    return Ae(pt, {
      onBack: l,
      onBackspace: l,
      get children() {
        return Ae(gu, {
          get when() {
            return i();
          },
          get children() {
            return Ae(kg, {
              width: 1083,
              height: 700,
              x: 69,
              y: 65,
              gap: 44,
              display: "flex",
              flexDirection: "column",
              forwardFocus: 1,
              get children() {
                return [
                  Ae(jV, {}),
                  Ae(pt, {
                    width: 1083,
                    height: 592,
                    gap: 25,
                    display: "flex",
                    flexDirection: "column",
                    id: "data",
                    forwardFocus: 1,
                    autofocus: !0,
                    get children() {
                      return [
                        Ae(pt, {
                          id: "metaData",
                          width: 1083,
                          height: 82,
                          display: "flex",
                          flexDirection: "column",
                          get children() {
                            return [
                              Ae(Gn, { style: wx, children: "Drama" }),
                              Ae(Gn, { style: wx, children: "98 Minutes" }),
                              Ae(Gn, { style: wx, children: "US - 1987 - PG - IMDb: 7.7" }),
                            ];
                          },
                        }),
                        Ae(pt, {
                          id: "generalData",
                          width: 1083,
                          height: 485,
                          display: "flex",
                          gap: 60,
                          forwardFocus: 1,
                          get children() {
                            return [
                              Ae(pt, {
                                width: 325,
                                height: 485,
                                get src() {
                                  var h;
                                  return sS((h = i()) == null ? void 0 : h.poster_path, "w342");
                                },
                              }),
                              Ae(pt, {
                                id: "baseInfo",
                                width: 698,
                                height: 435,
                                gap: 37,
                                display: "flex",
                                flexDirection: "column",
                                alignSelf: "center",
                                forwardFocus: 2,
                                get children() {
                                  return [
                                    Ae(pt, {
                                      id: "titleAndDescription",
                                      width: 698,
                                      height: 182,
                                      gap: 40,
                                      display: "flex",
                                      flexDirection: "column",
                                      get children() {
                                        return [
                                          " ",
                                          Ae(Gn, {
                                            fontFamily: "Inter",
                                            fontWeight: 600,
                                            fontSize: 28,
                                            letterSpacing: 0,
                                            contain: "width",
                                            get children() {
                                              var h;
                                              return (h = i()) == null ? void 0 : h.title;
                                            },
                                          }),
                                          Ae(Gn, {
                                            fontFamily: "Inter",
                                            fontWeight: 600,
                                            fontSize: 22,
                                            lineHeight: 31,
                                            letterSpacing: 0,
                                            contain: "width",
                                            maxLines: 4,
                                            get children() {
                                              var h;
                                              return (h = i()) == null ? void 0 : h.overview;
                                            },
                                          }),
                                        ];
                                      },
                                    }),
                                    Ae(pt, {
                                      id: "castAndCrew",
                                      width: 698,
                                      height: 101,
                                      gap: 8,
                                      display: "flex",
                                      flexDirection: "column",
                                      get children() {
                                        return [
                                          Ae(pt, {
                                            display: "flex",
                                            width: 698,
                                            get children() {
                                              return Ae(Gn, {
                                                fontFamily: "Inter",
                                                fontWeight: 400,
                                                fontSize: 22,
                                                contain: "width",
                                                maxLines: 2,
                                                children:
                                                  "Director: Enzo G. Castellari, Enzo G. Castellari, Enzo G. Castellari, Enzo G. Castellari, Enzo G. Castellari, Enzo G. Castellari, Enzo G. Castellari, Enzo G. Castellari",
                                              });
                                            },
                                          }),
                                          Ae(pt, {
                                            display: "flex",
                                            width: 698,
                                            get children() {
                                              return Ae(Gn, {
                                                fontFamily: "Inter",
                                                fontWeight: 400,
                                                fontSize: 22,
                                                contain: "width",
                                                maxLines: 2,
                                                children:
                                                  "Cast: Enzo G. Castellari, Enzo G. Castellari, Enzo G. Castellari, Enzo G. Castellari, Enzo G. Castellari, Enzo G. Castellari, Enzo G. Castellari, Enzo G. Castellari, Enzo G. Castellari",
                                              });
                                            },
                                          }),
                                        ];
                                      },
                                    }),
                                    Ae(WV, {}),
                                  ];
                                },
                              }),
                            ];
                          },
                        }),
                      ];
                    },
                  }),
                ];
              },
            });
          },
        });
      },
    });
  },
  Ue =
    Number.isFinite ||
    function (u) {
      return typeof u == "number" && isFinite(u);
    },
  YV =
    Number.isSafeInteger ||
    function (u) {
      return typeof u == "number" && Math.abs(u) <= XV;
    },
  XV = Number.MAX_SAFE_INTEGER || 9007199254740991;
let et = (function (u) {
    return (
      (u.NETWORK_ERROR = "networkError"),
      (u.MEDIA_ERROR = "mediaError"),
      (u.KEY_SYSTEM_ERROR = "keySystemError"),
      (u.MUX_ERROR = "muxError"),
      (u.OTHER_ERROR = "otherError"),
      u
    );
  })({}),
  ge = (function (u) {
    return (
      (u.KEY_SYSTEM_NO_KEYS = "keySystemNoKeys"),
      (u.KEY_SYSTEM_NO_ACCESS = "keySystemNoAccess"),
      (u.KEY_SYSTEM_NO_SESSION = "keySystemNoSession"),
      (u.KEY_SYSTEM_NO_CONFIGURED_LICENSE = "keySystemNoConfiguredLicense"),
      (u.KEY_SYSTEM_LICENSE_REQUEST_FAILED = "keySystemLicenseRequestFailed"),
      (u.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED = "keySystemServerCertificateRequestFailed"),
      (u.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED = "keySystemServerCertificateUpdateFailed"),
      (u.KEY_SYSTEM_SESSION_UPDATE_FAILED = "keySystemSessionUpdateFailed"),
      (u.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED = "keySystemStatusOutputRestricted"),
      (u.KEY_SYSTEM_STATUS_INTERNAL_ERROR = "keySystemStatusInternalError"),
      (u.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR = "keySystemDestroyMediaKeysError"),
      (u.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR = "keySystemDestroyCloseSessionError"),
      (u.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR = "keySystemDestroyRemoveSessionError"),
      (u.MANIFEST_LOAD_ERROR = "manifestLoadError"),
      (u.MANIFEST_LOAD_TIMEOUT = "manifestLoadTimeOut"),
      (u.MANIFEST_PARSING_ERROR = "manifestParsingError"),
      (u.MANIFEST_INCOMPATIBLE_CODECS_ERROR = "manifestIncompatibleCodecsError"),
      (u.LEVEL_EMPTY_ERROR = "levelEmptyError"),
      (u.LEVEL_LOAD_ERROR = "levelLoadError"),
      (u.LEVEL_LOAD_TIMEOUT = "levelLoadTimeOut"),
      (u.LEVEL_PARSING_ERROR = "levelParsingError"),
      (u.LEVEL_SWITCH_ERROR = "levelSwitchError"),
      (u.AUDIO_TRACK_LOAD_ERROR = "audioTrackLoadError"),
      (u.AUDIO_TRACK_LOAD_TIMEOUT = "audioTrackLoadTimeOut"),
      (u.SUBTITLE_LOAD_ERROR = "subtitleTrackLoadError"),
      (u.SUBTITLE_TRACK_LOAD_TIMEOUT = "subtitleTrackLoadTimeOut"),
      (u.FRAG_LOAD_ERROR = "fragLoadError"),
      (u.FRAG_LOAD_TIMEOUT = "fragLoadTimeOut"),
      (u.FRAG_DECRYPT_ERROR = "fragDecryptError"),
      (u.FRAG_PARSING_ERROR = "fragParsingError"),
      (u.FRAG_GAP = "fragGap"),
      (u.REMUX_ALLOC_ERROR = "remuxAllocError"),
      (u.KEY_LOAD_ERROR = "keyLoadError"),
      (u.KEY_LOAD_TIMEOUT = "keyLoadTimeOut"),
      (u.BUFFER_ADD_CODEC_ERROR = "bufferAddCodecError"),
      (u.BUFFER_INCOMPATIBLE_CODECS_ERROR = "bufferIncompatibleCodecsError"),
      (u.BUFFER_APPEND_ERROR = "bufferAppendError"),
      (u.BUFFER_APPENDING_ERROR = "bufferAppendingError"),
      (u.BUFFER_STALLED_ERROR = "bufferStalledError"),
      (u.BUFFER_FULL_ERROR = "bufferFullError"),
      (u.BUFFER_SEEK_OVER_HOLE = "bufferSeekOverHole"),
      (u.BUFFER_NUDGE_ON_STALL = "bufferNudgeOnStall"),
      (u.ASSET_LIST_LOAD_ERROR = "assetListLoadError"),
      (u.ASSET_LIST_LOAD_TIMEOUT = "assetListLoadTimeout"),
      (u.ASSET_LIST_PARSING_ERROR = "assetListParsingError"),
      (u.INTERSTITIAL_ASSET_ITEM_ERROR = "interstitialAssetItemError"),
      (u.INTERNAL_EXCEPTION = "internalException"),
      (u.INTERNAL_ABORTED = "aborted"),
      (u.ATTACH_MEDIA_ERROR = "attachMediaError"),
      (u.UNKNOWN = "unknown"),
      u
    );
  })({}),
  F = (function (u) {
    return (
      (u.MEDIA_ATTACHING = "hlsMediaAttaching"),
      (u.MEDIA_ATTACHED = "hlsMediaAttached"),
      (u.MEDIA_DETACHING = "hlsMediaDetaching"),
      (u.MEDIA_DETACHED = "hlsMediaDetached"),
      (u.MEDIA_ENDED = "hlsMediaEnded"),
      (u.STALL_RESOLVED = "hlsStallResolved"),
      (u.BUFFER_RESET = "hlsBufferReset"),
      (u.BUFFER_CODECS = "hlsBufferCodecs"),
      (u.BUFFER_CREATED = "hlsBufferCreated"),
      (u.BUFFER_APPENDING = "hlsBufferAppending"),
      (u.BUFFER_APPENDED = "hlsBufferAppended"),
      (u.BUFFER_EOS = "hlsBufferEos"),
      (u.BUFFERED_TO_END = "hlsBufferedToEnd"),
      (u.BUFFER_FLUSHING = "hlsBufferFlushing"),
      (u.BUFFER_FLUSHED = "hlsBufferFlushed"),
      (u.MANIFEST_LOADING = "hlsManifestLoading"),
      (u.MANIFEST_LOADED = "hlsManifestLoaded"),
      (u.MANIFEST_PARSED = "hlsManifestParsed"),
      (u.LEVEL_SWITCHING = "hlsLevelSwitching"),
      (u.LEVEL_SWITCHED = "hlsLevelSwitched"),
      (u.LEVEL_LOADING = "hlsLevelLoading"),
      (u.LEVEL_LOADED = "hlsLevelLoaded"),
      (u.LEVEL_UPDATED = "hlsLevelUpdated"),
      (u.LEVEL_PTS_UPDATED = "hlsLevelPtsUpdated"),
      (u.LEVELS_UPDATED = "hlsLevelsUpdated"),
      (u.AUDIO_TRACKS_UPDATED = "hlsAudioTracksUpdated"),
      (u.AUDIO_TRACK_SWITCHING = "hlsAudioTrackSwitching"),
      (u.AUDIO_TRACK_SWITCHED = "hlsAudioTrackSwitched"),
      (u.AUDIO_TRACK_LOADING = "hlsAudioTrackLoading"),
      (u.AUDIO_TRACK_LOADED = "hlsAudioTrackLoaded"),
      (u.AUDIO_TRACK_UPDATED = "hlsAudioTrackUpdated"),
      (u.SUBTITLE_TRACKS_UPDATED = "hlsSubtitleTracksUpdated"),
      (u.SUBTITLE_TRACKS_CLEARED = "hlsSubtitleTracksCleared"),
      (u.SUBTITLE_TRACK_SWITCH = "hlsSubtitleTrackSwitch"),
      (u.SUBTITLE_TRACK_LOADING = "hlsSubtitleTrackLoading"),
      (u.SUBTITLE_TRACK_LOADED = "hlsSubtitleTrackLoaded"),
      (u.SUBTITLE_TRACK_UPDATED = "hlsSubtitleTrackUpdated"),
      (u.SUBTITLE_FRAG_PROCESSED = "hlsSubtitleFragProcessed"),
      (u.CUES_PARSED = "hlsCuesParsed"),
      (u.NON_NATIVE_TEXT_TRACKS_FOUND = "hlsNonNativeTextTracksFound"),
      (u.INIT_PTS_FOUND = "hlsInitPtsFound"),
      (u.FRAG_LOADING = "hlsFragLoading"),
      (u.FRAG_LOAD_EMERGENCY_ABORTED = "hlsFragLoadEmergencyAborted"),
      (u.FRAG_LOADED = "hlsFragLoaded"),
      (u.FRAG_DECRYPTED = "hlsFragDecrypted"),
      (u.FRAG_PARSING_INIT_SEGMENT = "hlsFragParsingInitSegment"),
      (u.FRAG_PARSING_USERDATA = "hlsFragParsingUserdata"),
      (u.FRAG_PARSING_METADATA = "hlsFragParsingMetadata"),
      (u.FRAG_PARSED = "hlsFragParsed"),
      (u.FRAG_BUFFERED = "hlsFragBuffered"),
      (u.FRAG_CHANGED = "hlsFragChanged"),
      (u.FPS_DROP = "hlsFpsDrop"),
      (u.FPS_DROP_LEVEL_CAPPING = "hlsFpsDropLevelCapping"),
      (u.MAX_AUTO_LEVEL_UPDATED = "hlsMaxAutoLevelUpdated"),
      (u.ERROR = "hlsError"),
      (u.DESTROYING = "hlsDestroying"),
      (u.KEY_LOADING = "hlsKeyLoading"),
      (u.KEY_LOADED = "hlsKeyLoaded"),
      (u.LIVE_BACK_BUFFER_REACHED = "hlsLiveBackBufferReached"),
      (u.BACK_BUFFER_REACHED = "hlsBackBufferReached"),
      (u.STEERING_MANIFEST_LOADED = "hlsSteeringManifestLoaded"),
      (u.ASSET_LIST_LOADING = "hlsAssetListLoading"),
      (u.ASSET_LIST_LOADED = "hlsAssetListLoaded"),
      (u.INTERSTITIALS_UPDATED = "hlsInterstitialsUpdated"),
      (u.INTERSTITIALS_BUFFERED_TO_BOUNDARY = "hlsInterstitialsBufferedToBoundary"),
      (u.INTERSTITIAL_ASSET_PLAYER_CREATED = "hlsInterstitialAssetPlayerCreated"),
      (u.INTERSTITIAL_STARTED = "hlsInterstitialStarted"),
      (u.INTERSTITIAL_ASSET_STARTED = "hlsInterstitialAssetStarted"),
      (u.INTERSTITIAL_ASSET_ENDED = "hlsInterstitialAssetEnded"),
      (u.INTERSTITIAL_ASSET_ERROR = "hlsInterstitialAssetError"),
      (u.INTERSTITIAL_ENDED = "hlsInterstitialEnded"),
      (u.INTERSTITIALS_PRIMARY_RESUMED = "hlsInterstitialsPrimaryResumed"),
      (u.PLAYOUT_LIMIT_REACHED = "hlsPlayoutLimitReached"),
      (u.EVENT_CUE_ENTER = "hlsEventCueEnter"),
      u
    );
  })({});
var Ot = { MANIFEST: "manifest", LEVEL: "level", AUDIO_TRACK: "audioTrack", SUBTITLE_TRACK: "subtitleTrack" },
  Xe = { MAIN: "main", AUDIO: "audio", SUBTITLE: "subtitle" };
class Fl {
  constructor(n, i = 0, o = 0) {
    ((this.halfLife = void 0),
      (this.alpha_ = void 0),
      (this.estimate_ = void 0),
      (this.totalWeight_ = void 0),
      (this.halfLife = n),
      (this.alpha_ = n ? Math.exp(Math.log(0.5) / n) : 0),
      (this.estimate_ = i),
      (this.totalWeight_ = o));
  }
  sample(n, i) {
    const o = Math.pow(this.alpha_, n);
    ((this.estimate_ = i * (1 - o) + o * this.estimate_), (this.totalWeight_ += n));
  }
  getTotalWeight() {
    return this.totalWeight_;
  }
  getEstimate() {
    if (this.alpha_) {
      const n = 1 - Math.pow(this.alpha_, this.totalWeight_);
      if (n) return this.estimate_ / n;
    }
    return this.estimate_;
  }
}
class qV {
  constructor(n, i, o, l = 100) {
    ((this.defaultEstimate_ = void 0),
      (this.minWeight_ = void 0),
      (this.minDelayMs_ = void 0),
      (this.slow_ = void 0),
      (this.fast_ = void 0),
      (this.defaultTTFB_ = void 0),
      (this.ttfb_ = void 0),
      (this.defaultEstimate_ = o),
      (this.minWeight_ = 0.001),
      (this.minDelayMs_ = 50),
      (this.slow_ = new Fl(n)),
      (this.fast_ = new Fl(i)),
      (this.defaultTTFB_ = l),
      (this.ttfb_ = new Fl(n)));
  }
  update(n, i) {
    const { slow_: o, fast_: l, ttfb_: h } = this;
    (o.halfLife !== n && (this.slow_ = new Fl(n, o.getEstimate(), o.getTotalWeight())),
      l.halfLife !== i && (this.fast_ = new Fl(i, l.getEstimate(), l.getTotalWeight())),
      h.halfLife !== n && (this.ttfb_ = new Fl(n, h.getEstimate(), h.getTotalWeight())));
  }
  sample(n, i) {
    n = Math.max(n, this.minDelayMs_);
    const o = 8 * i,
      l = n / 1e3,
      h = o / l;
    (this.fast_.sample(l, h), this.slow_.sample(l, h));
  }
  sampleTTFB(n) {
    const i = n / 1e3,
      o = Math.sqrt(2) * Math.exp(-Math.pow(i, 2) / 2);
    this.ttfb_.sample(o, Math.max(n, 5));
  }
  canEstimate() {
    return this.fast_.getTotalWeight() >= this.minWeight_;
  }
  getEstimate() {
    return this.canEstimate()
      ? Math.min(this.fast_.getEstimate(), this.slow_.getEstimate())
      : this.defaultEstimate_;
  }
  getEstimateTTFB() {
    return this.ttfb_.getTotalWeight() >= this.minWeight_ ? this.ttfb_.getEstimate() : this.defaultTTFB_;
  }
  get defaultEstimate() {
    return this.defaultEstimate_;
  }
  destroy() {}
}
function QV(u, n, i) {
  return (
    (n = ZV(n)) in u
      ? Object.defineProperty(u, n, { value: i, enumerable: !0, configurable: !0, writable: !0 })
      : (u[n] = i),
    u
  );
}
function rn() {
  return (
    (rn = Object.assign
      ? Object.assign.bind()
      : function (u) {
          for (var n = 1; n < arguments.length; n++) {
            var i = arguments[n];
            for (var o in i) ({}).hasOwnProperty.call(i, o) && (u[o] = i[o]);
          }
          return u;
        }),
    rn.apply(null, arguments)
  );
}
function O_(u, n) {
  var i = Object.keys(u);
  if (Object.getOwnPropertySymbols) {
    var o = Object.getOwnPropertySymbols(u);
    (n &&
      (o = o.filter(function (l) {
        return Object.getOwnPropertyDescriptor(u, l).enumerable;
      })),
      i.push.apply(i, o));
  }
  return i;
}
function Jt(u) {
  for (var n = 1; n < arguments.length; n++) {
    var i = arguments[n] != null ? arguments[n] : {};
    n % 2
      ? O_(Object(i), !0).forEach(function (o) {
          QV(u, o, i[o]);
        })
      : Object.getOwnPropertyDescriptors
        ? Object.defineProperties(u, Object.getOwnPropertyDescriptors(i))
        : O_(Object(i)).forEach(function (o) {
            Object.defineProperty(u, o, Object.getOwnPropertyDescriptor(i, o));
          });
  }
  return u;
}
function JV(u, n) {
  if (typeof u != "object" || !u) return u;
  var i = u[Symbol.toPrimitive];
  if (i !== void 0) {
    var o = i.call(u, n);
    if (typeof o != "object") return o;
    throw new TypeError("@@toPrimitive must return a primitive value.");
  }
  return (n === "string" ? String : Number)(u);
}
function ZV(u) {
  var n = JV(u, "string");
  return typeof n == "symbol" ? n : n + "";
}
class Pr {
  constructor(n, i) {
    ((this.trace = void 0),
      (this.debug = void 0),
      (this.log = void 0),
      (this.warn = void 0),
      (this.info = void 0),
      (this.error = void 0));
    const o = "[".concat(n, "]:");
    ((this.trace = Co),
      (this.debug = i.debug.bind(null, o)),
      (this.log = i.log.bind(null, o)),
      (this.warn = i.warn.bind(null, o)),
      (this.info = i.info.bind(null, o)),
      (this.error = i.error.bind(null, o)));
  }
}
const Co = function () {},
  eH = { trace: Co, debug: Co, log: Co, warn: Co, info: Co, error: Co };
function IT() {
  return rn({}, eH);
}
function tH(u, n) {
  const i = self.console[u];
  return i ? i.bind(self.console, "".concat(n ? "[" + n + "] " : "", "[").concat(u, "] >")) : Co;
}
function N_(u, n, i) {
  return n[u] ? n[u].bind(n) : tH(u, i);
}
const wT = IT();
function nH(u, n, i) {
  const o = IT();
  if ((typeof console == "object" && u === !0) || typeof u == "object") {
    const l = ["debug", "log", "info", "warn", "error"];
    l.forEach(h => {
      o[h] = N_(h, u, i);
    });
    try {
      o.log('Debug logs enabled for "'.concat(n, '" in hls.js version 1.6.15'));
    } catch (h) {
      return IT();
    }
    l.forEach(h => {
      wT[h] = N_(h, u);
    });
  } else rn(wT, o);
  return o;
}
const Zt = wT;
function Oo(u = !0) {
  return typeof self > "u"
    ? void 0
    : ((u || !self.MediaSource) && self.ManagedMediaSource) || self.MediaSource || self.WebKitMediaSource;
}
function iH(u) {
  return typeof self < "u" && u === self.ManagedMediaSource;
}
function Ek(u, n) {
  const i = Object.keys(u),
    o = Object.keys(n),
    l = i.length,
    h = o.length;
  return !l || !h || (l === h && !i.some(p => o.indexOf(p) === -1));
}
function Sr(u, n = !1) {
  if (typeof TextDecoder < "u") {
    const v = new TextDecoder("utf-8").decode(u);
    if (n) {
      const T = v.indexOf("\0");
      return T !== -1 ? v.substring(0, T) : v;
    }
    return v.replace(/\0/g, "");
  }
  const i = u.length;
  let o,
    l,
    h,
    p = "",
    d = 0;
  for (; d < i; ) {
    if (((o = u[d++]), o === 0 && n)) return p;
    if (o === 0 || o === 3) continue;
    switch (o >> 4) {
      case 0:
      case 1:
      case 2:
      case 3:
      case 4:
      case 5:
      case 6:
      case 7:
        p += String.fromCharCode(o);
        break;
      case 12:
      case 13:
        ((l = u[d++]), (p += String.fromCharCode(((o & 31) << 6) | (l & 63))));
        break;
      case 14:
        ((l = u[d++]),
          (h = u[d++]),
          (p += String.fromCharCode(((o & 15) << 12) | ((l & 63) << 6) | ((h & 63) << 0))));
        break;
    }
  }
  return p;
}
function yi(u) {
  let n = "";
  for (let i = 0; i < u.length; i++) {
    let o = u[i].toString(16);
    (o.length < 2 && (o = "0" + o), (n += o));
  }
  return n;
}
function Ak(u) {
  return Uint8Array.from(
    u
      .replace(/^0x/, "")
      .replace(/([\da-fA-F]{2}) ?/g, "0x$1 ")
      .replace(/ +$/, "")
      .split(" "),
  ).buffer;
}
function rH(u) {
  return u && u.__esModule && Object.prototype.hasOwnProperty.call(u, "default") ? u.default : u;
}
var Rx = { exports: {} },
  F_;
function sH() {
  return (
    F_ ||
      ((F_ = 1),
      (function (u, n) {
        (function (i) {
          var o =
              /^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,
            l = /^(?=([^\/?#]*))\1([^]*)$/,
            h = /(?:\/|^)\.(?=\/)/g,
            p = /(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,
            d = {
              buildAbsoluteURL: function (y, v, T) {
                if (((T = T || {}), (y = y.trim()), (v = v.trim()), !v)) {
                  if (!T.alwaysNormalize) return y;
                  var S = d.parseURL(y);
                  if (!S) throw new Error("Error trying to parse base URL.");
                  return ((S.path = d.normalizePath(S.path)), d.buildURLFromParts(S));
                }
                var w = d.parseURL(v);
                if (!w) throw new Error("Error trying to parse relative URL.");
                if (w.scheme)
                  return T.alwaysNormalize ? ((w.path = d.normalizePath(w.path)), d.buildURLFromParts(w)) : v;
                var C = d.parseURL(y);
                if (!C) throw new Error("Error trying to parse base URL.");
                if (!C.netLoc && C.path && C.path[0] !== "/") {
                  var L = l.exec(C.path);
                  ((C.netLoc = L[1]), (C.path = L[2]));
                }
                C.netLoc && !C.path && (C.path = "/");
                var k = {
                  scheme: C.scheme,
                  netLoc: w.netLoc,
                  path: null,
                  params: w.params,
                  query: w.query,
                  fragment: w.fragment,
                };
                if (!w.netLoc && ((k.netLoc = C.netLoc), w.path[0] !== "/"))
                  if (!w.path)
                    ((k.path = C.path), w.params || ((k.params = C.params), w.query || (k.query = C.query)));
                  else {
                    var O = C.path,
                      B = O.substring(0, O.lastIndexOf("/") + 1) + w.path;
                    k.path = d.normalizePath(B);
                  }
                return (
                  k.path === null && (k.path = T.alwaysNormalize ? d.normalizePath(w.path) : w.path),
                  d.buildURLFromParts(k)
                );
              },
              parseURL: function (y) {
                var v = o.exec(y);
                return v
                  ? {
                      scheme: v[1] || "",
                      netLoc: v[2] || "",
                      path: v[3] || "",
                      params: v[4] || "",
                      query: v[5] || "",
                      fragment: v[6] || "",
                    }
                  : null;
              },
              normalizePath: function (y) {
                for (
                  y = y.split("").reverse().join("").replace(h, "");
                  y.length !== (y = y.replace(p, "")).length;
                );
                return y.split("").reverse().join("");
              },
              buildURLFromParts: function (y) {
                return y.scheme + y.netLoc + y.path + y.params + y.query + y.fragment;
              },
            };
          u.exports = d;
        })();
      })(Rx)),
    Rx.exports
  );
}
var aS = sH();
class lS {
  constructor() {
    ((this.aborted = !1),
      (this.loaded = 0),
      (this.retry = 0),
      (this.total = 0),
      (this.chunkCount = 0),
      (this.bwEstimate = 0),
      (this.loading = { start: 0, first: 0, end: 0 }),
      (this.parsing = { start: 0, end: 0 }),
      (this.buffering = { start: 0, first: 0, end: 0 }));
  }
}
var an = { AUDIO: "audio", VIDEO: "video", AUDIOVIDEO: "audiovideo" };
class Ik {
  constructor(n) {
    ((this._byteRange = null),
      (this._url = null),
      (this._stats = null),
      (this._streams = null),
      (this.base = void 0),
      (this.relurl = void 0),
      typeof n == "string" && (n = { url: n }),
      (this.base = n),
      aH(this, "stats"));
  }
  setByteRange(n, i) {
    const o = n.split("@", 2);
    let l;
    (o.length === 1 ? (l = (i == null ? void 0 : i.byteRangeEndOffset) || 0) : (l = parseInt(o[1])),
      (this._byteRange = [l, parseInt(o[0]) + l]));
  }
  get baseurl() {
    return this.base.url;
  }
  get byteRange() {
    return this._byteRange === null ? [] : this._byteRange;
  }
  get byteRangeStartOffset() {
    return this.byteRange[0];
  }
  get byteRangeEndOffset() {
    return this.byteRange[1];
  }
  get elementaryStreams() {
    return (
      this._streams === null &&
        (this._streams = { [an.AUDIO]: null, [an.VIDEO]: null, [an.AUDIOVIDEO]: null }),
      this._streams
    );
  }
  set elementaryStreams(n) {
    this._streams = n;
  }
  get hasStats() {
    return this._stats !== null;
  }
  get hasStreams() {
    return this._streams !== null;
  }
  get stats() {
    return (this._stats === null && (this._stats = new lS()), this._stats);
  }
  set stats(n) {
    this._stats = n;
  }
  get url() {
    return (
      !this._url &&
        this.baseurl &&
        this.relurl &&
        (this._url = aS.buildAbsoluteURL(this.baseurl, this.relurl, { alwaysNormalize: !0 })),
      this._url || ""
    );
  }
  set url(n) {
    this._url = n;
  }
  clearElementaryStreamInfo() {
    const { elementaryStreams: n } = this;
    ((n[an.AUDIO] = null), (n[an.VIDEO] = null), (n[an.AUDIOVIDEO] = null));
  }
}
function On(u) {
  return u.sn !== "initSegment";
}
class Cx extends Ik {
  constructor(n, i) {
    (super(i),
      (this._decryptdata = null),
      (this._programDateTime = null),
      (this._ref = null),
      (this._bitrate = void 0),
      (this.rawProgramDateTime = null),
      (this.tagList = []),
      (this.duration = 0),
      (this.sn = 0),
      (this.levelkeys = void 0),
      (this.type = void 0),
      (this.loader = null),
      (this.keyLoader = null),
      (this.level = -1),
      (this.cc = 0),
      (this.startPTS = void 0),
      (this.endPTS = void 0),
      (this.startDTS = void 0),
      (this.endDTS = void 0),
      (this.start = 0),
      (this.playlistOffset = 0),
      (this.deltaPTS = void 0),
      (this.maxStartPTS = void 0),
      (this.minEndPTS = void 0),
      (this.data = void 0),
      (this.bitrateTest = !1),
      (this.title = null),
      (this.initSegment = null),
      (this.endList = void 0),
      (this.gap = void 0),
      (this.urlId = 0),
      (this.type = n));
  }
  get byteLength() {
    if (this.hasStats) {
      const n = this.stats.total;
      if (n) return n;
    }
    if (this.byteRange.length) {
      const n = this.byteRange[0],
        i = this.byteRange[1];
      if (Ue(n) && Ue(i)) return i - n;
    }
    return null;
  }
  get bitrate() {
    return this.byteLength ? (this.byteLength * 8) / this.duration : this._bitrate ? this._bitrate : null;
  }
  set bitrate(n) {
    this._bitrate = n;
  }
  get decryptdata() {
    var n;
    const { levelkeys: i } = this;
    if (!i || i.NONE) return null;
    if (i.identity) this._decryptdata || (this._decryptdata = i.identity.getDecryptData(this.sn));
    else if (!((n = this._decryptdata) != null && n.keyId)) {
      const o = Object.keys(i);
      if (o.length === 1) {
        const l = (this._decryptdata = i[o[0]] || null);
        l && (this._decryptdata = l.getDecryptData(this.sn, i));
      }
    }
    return this._decryptdata;
  }
  get end() {
    return this.start + this.duration;
  }
  get endProgramDateTime() {
    if (this.programDateTime === null) return null;
    const n = Ue(this.duration) ? this.duration : 0;
    return this.programDateTime + n * 1e3;
  }
  get encrypted() {
    var n;
    if ((n = this._decryptdata) != null && n.encrypted) return !0;
    if (this.levelkeys) {
      var i;
      const o = Object.keys(this.levelkeys),
        l = o.length;
      if (l > 1 || (l === 1 && (i = this.levelkeys[o[0]]) != null && i.encrypted)) return !0;
    }
    return !1;
  }
  get programDateTime() {
    return (
      this._programDateTime === null &&
        this.rawProgramDateTime &&
        (this.programDateTime = Date.parse(this.rawProgramDateTime)),
      this._programDateTime
    );
  }
  set programDateTime(n) {
    if (!Ue(n)) {
      this._programDateTime = this.rawProgramDateTime = null;
      return;
    }
    this._programDateTime = n;
  }
  get ref() {
    return On(this)
      ? (this._ref ||
          (this._ref = {
            base: this.base,
            start: this.start,
            duration: this.duration,
            sn: this.sn,
            programDateTime: this.programDateTime,
          }),
        this._ref)
      : null;
  }
  addStart(n) {
    this.setStart(this.start + n);
  }
  setStart(n) {
    ((this.start = n), this._ref && (this._ref.start = n));
  }
  setDuration(n) {
    ((this.duration = n), this._ref && (this._ref.duration = n));
  }
  setKeyFormat(n) {
    const i = this.levelkeys;
    if (i) {
      var o;
      const l = i[n];
      l &&
        !((o = this._decryptdata) != null && o.keyId) &&
        (this._decryptdata = l.getDecryptData(this.sn, i));
    }
  }
  abortRequests() {
    var n, i;
    ((n = this.loader) == null || n.abort(), (i = this.keyLoader) == null || i.abort());
  }
  setElementaryStreamInfo(n, i, o, l, h, p = !1) {
    const { elementaryStreams: d } = this,
      y = d[n];
    if (!y) {
      d[n] = { startPTS: i, endPTS: o, startDTS: l, endDTS: h, partial: p };
      return;
    }
    ((y.startPTS = Math.min(y.startPTS, i)),
      (y.endPTS = Math.max(y.endPTS, o)),
      (y.startDTS = Math.min(y.startDTS, l)),
      (y.endDTS = Math.max(y.endDTS, h)));
  }
}
class oH extends Ik {
  constructor(n, i, o, l, h) {
    (super(o),
      (this.fragOffset = 0),
      (this.duration = 0),
      (this.gap = !1),
      (this.independent = !1),
      (this.relurl = void 0),
      (this.fragment = void 0),
      (this.index = void 0),
      (this.duration = n.decimalFloatingPoint("DURATION")),
      (this.gap = n.bool("GAP")),
      (this.independent = n.bool("INDEPENDENT")),
      (this.relurl = n.enumeratedString("URI")),
      (this.fragment = i),
      (this.index = l));
    const p = n.enumeratedString("BYTERANGE");
    (p && this.setByteRange(p, h), h && (this.fragOffset = h.fragOffset + h.duration));
  }
  get start() {
    return this.fragment.start + this.fragOffset;
  }
  get end() {
    return this.start + this.duration;
  }
  get loaded() {
    const { elementaryStreams: n } = this;
    return !!(n.audio || n.video || n.audiovideo);
  }
}
function wk(u, n) {
  const i = Object.getPrototypeOf(u);
  if (i) {
    const o = Object.getOwnPropertyDescriptor(i, n);
    return o || wk(i, n);
  }
}
function aH(u, n) {
  const i = wk(u, n);
  i && ((i.enumerable = !0), Object.defineProperty(u, n, i));
}
const U_ = Math.pow(2, 32) - 1,
  lH = [].push,
  Rk = { video: 1, audio: 2, id3: 3, text: 4 };
function Jn(u) {
  return String.fromCharCode.apply(null, u);
}
function Ck(u, n) {
  const i = (u[n] << 8) | u[n + 1];
  return i < 0 ? 65536 + i : i;
}
function vt(u, n) {
  const i = Lk(u, n);
  return i < 0 ? 4294967296 + i : i;
}
function B_(u, n) {
  let i = vt(u, n);
  return ((i *= Math.pow(2, 32)), (i += vt(u, n + 4)), i);
}
function Lk(u, n) {
  return (u[n] << 24) | (u[n + 1] << 16) | (u[n + 2] << 8) | u[n + 3];
}
function uH(u) {
  const n = u.byteLength;
  for (let i = 0; i < n; ) {
    const o = vt(u, i);
    if (o > 8 && u[i + 4] === 109 && u[i + 5] === 111 && u[i + 6] === 111 && u[i + 7] === 102) return !0;
    i = o > 1 ? i + o : n;
  }
  return !1;
}
function kt(u, n) {
  const i = [];
  if (!n.length) return i;
  const o = u.byteLength;
  for (let l = 0; l < o; ) {
    const h = vt(u, l),
      p = Jn(u.subarray(l + 4, l + 8)),
      d = h > 1 ? l + h : o;
    if (p === n[0])
      if (n.length === 1) i.push(u.subarray(l + 8, d));
      else {
        const y = kt(u.subarray(l + 8, d), n.slice(1));
        y.length && lH.apply(i, y);
      }
    l = d;
  }
  return i;
}
function cH(u) {
  const n = [],
    i = u[0];
  let o = 8;
  const l = vt(u, o);
  o += 4;
  let h = 0,
    p = 0;
  (i === 0 ? ((h = vt(u, o)), (p = vt(u, o + 4)), (o += 8)) : ((h = B_(u, o)), (p = B_(u, o + 8)), (o += 16)),
    (o += 2));
  let d = u.length + p;
  const y = Ck(u, o);
  o += 2;
  for (let v = 0; v < y; v++) {
    let T = o;
    const S = vt(u, T);
    T += 4;
    const w = S & 2147483647;
    if ((S & 2147483648) >>> 31 === 1)
      return (Zt.warn("SIDX has hierarchical references (not supported)"), null);
    const L = vt(u, T);
    ((T += 4),
      n.push({
        referenceSize: w,
        subsegmentDuration: L,
        info: { duration: L / l, start: d, end: d + w - 1 },
      }),
      (d += w),
      (T += 4),
      (o = T));
  }
  return { earliestPresentationTime: h, timescale: l, version: i, referencesCount: y, references: n };
}
function _k(u) {
  const n = [],
    i = kt(u, ["moov", "trak"]);
  for (let l = 0; l < i.length; l++) {
    const h = i[l],
      p = kt(h, ["tkhd"])[0];
    if (p) {
      let d = p[0];
      const y = vt(p, d === 0 ? 12 : 20),
        v = kt(h, ["mdia", "mdhd"])[0];
      if (v) {
        d = v[0];
        const T = vt(v, d === 0 ? 12 : 20),
          S = kt(h, ["mdia", "hdlr"])[0];
        if (S) {
          const w = Jn(S.subarray(8, 12)),
            C = { soun: an.AUDIO, vide: an.VIDEO }[w],
            L = kt(h, ["mdia", "minf", "stbl", "stsd"])[0],
            k = dH(L);
          C
            ? ((n[y] = { timescale: T, type: C, stsd: k }), (n[C] = Jt({ timescale: T, id: y }, k)))
            : (n[y] = { timescale: T, type: w, stsd: k });
        }
      }
    }
  }
  return (
    kt(u, ["moov", "mvex", "trex"]).forEach(l => {
      const h = vt(l, 4),
        p = n[h];
      p && (p.default = { duration: vt(l, 12), flags: vt(l, 20) });
    }),
    n
  );
}
function dH(u) {
  const n = u.subarray(8),
    i = n.subarray(86),
    o = Jn(n.subarray(4, 8));
  let l = o,
    h;
  const p = o === "enca" || o === "encv";
  if (p) {
    const v = kt(n, [o])[0].subarray(o === "enca" ? 28 : 78);
    kt(v, ["sinf"]).forEach(S => {
      const w = kt(S, ["schm"])[0];
      if (w) {
        const C = Jn(w.subarray(4, 8));
        if (C === "cbcs" || C === "cenc") {
          const L = kt(S, ["frma"])[0];
          L && (l = Jn(L));
        }
      }
    });
  }
  const d = l;
  switch (l) {
    case "avc1":
    case "avc2":
    case "avc3":
    case "avc4": {
      const y = kt(i, ["avcC"])[0];
      y &&
        y.length > 3 &&
        ((l += "." + Vp(y[1]) + Vp(y[2]) + Vp(y[3])), (h = jp(d === "avc1" ? "dva1" : "dvav", i)));
      break;
    }
    case "mp4a": {
      const y = kt(n, [o])[0],
        v = kt(y.subarray(28), ["esds"])[0];
      if (v && v.length > 7) {
        let T = 4;
        if (v[T++] !== 3) break;
        ((T = Lx(v, T)), (T += 2));
        const S = v[T++];
        if ((S & 128 && (T += 2), S & 64 && (T += v[T++]), v[T++] !== 4)) break;
        T = Lx(v, T);
        const w = v[T++];
        if (w === 64) l += "." + Vp(w);
        else break;
        if (((T += 12), v[T++] !== 5)) break;
        T = Lx(v, T);
        const C = v[T++];
        let L = (C & 248) >> 3;
        (L === 31 && (L += 1 + ((C & 7) << 3) + ((v[T] & 224) >> 5)), (l += "." + L));
      }
      break;
    }
    case "hvc1":
    case "hev1": {
      const y = kt(i, ["hvcC"])[0];
      if (y && y.length > 12) {
        const v = y[1],
          T = ["", "A", "B", "C"][v >> 6],
          S = v & 31,
          w = vt(y, 2),
          C = (v & 32) >> 5 ? "H" : "L",
          L = y[12],
          k = y.subarray(6, 12);
        ((l += "." + T + S), (l += "." + hH(w).toString(16).toUpperCase()), (l += "." + C + L));
        let O = "";
        for (let B = k.length; B--; ) {
          const N = k[B];
          (N || O) && (O = "." + N.toString(16).toUpperCase() + O);
        }
        l += O;
      }
      h = jp(d == "hev1" ? "dvhe" : "dvh1", i);
      break;
    }
    case "dvh1":
    case "dvhe":
    case "dvav":
    case "dva1":
    case "dav1": {
      l = jp(l, i) || l;
      break;
    }
    case "vp09": {
      const y = kt(i, ["vpcC"])[0];
      if (y && y.length > 6) {
        const v = y[4],
          T = y[5],
          S = (y[6] >> 4) & 15;
        l += "." + os(v) + "." + os(T) + "." + os(S);
      }
      break;
    }
    case "av01": {
      const y = kt(i, ["av1C"])[0];
      if (y && y.length > 2) {
        const v = y[1] >>> 5,
          T = y[1] & 31,
          S = y[2] >>> 7 ? "H" : "M",
          w = (y[2] & 64) >> 6,
          C = (y[2] & 32) >> 5,
          L = v === 2 && w ? (C ? 12 : 10) : w ? 10 : 8,
          k = (y[2] & 16) >> 4,
          O = (y[2] & 8) >> 3,
          B = (y[2] & 4) >> 2,
          N = y[2] & 3;
        ((l +=
          "." +
          v +
          "." +
          os(T) +
          S +
          "." +
          os(L) +
          "." +
          k +
          "." +
          O +
          B +
          N +
          "." +
          os(1) +
          "." +
          os(1) +
          "." +
          os(1) +
          "." +
          0),
          (h = jp("dav1", i)));
      }
      break;
    }
  }
  return { codec: l, encrypted: p, supplemental: h };
}
function jp(u, n) {
  const i = kt(n, ["dvvC"]),
    o = i.length ? i[0] : kt(n, ["dvcC"])[0];
  if (o) {
    const l = (o[2] >> 1) & 127,
      h = ((o[2] << 5) & 32) | ((o[3] >> 3) & 31);
    return u + "." + os(l) + "." + os(h);
  }
}
function hH(u) {
  let n = 0;
  for (let i = 0; i < 32; i++) n |= ((u >> i) & 1) << (31 - i);
  return n >>> 0;
}
function Lx(u, n) {
  const i = n + 5;
  for (; u[n++] & 128 && n < i; );
  return n;
}
function Vp(u) {
  return ("0" + u.toString(16).toUpperCase()).slice(-2);
}
function os(u) {
  return (u < 10 ? "0" : "") + u;
}
function fH(u, n) {
  if (!u || !n) return;
  const i = n.keyId;
  i &&
    n.isCommonEncryption &&
    bk(u, (o, l) => {
      const h = o.subarray(8, 24);
      h.some(p => p !== 0) ||
        (Zt.log(
          "[eme] Patching keyId in 'enc"
            .concat(l ? "a" : "v", ">sinf>>tenc' box: ")
            .concat(yi(h), " -> ")
            .concat(yi(i)),
        ),
        o.set(i, 8));
    });
}
function pH(u) {
  const n = [];
  return (bk(u, i => n.push(i.subarray(8, 24))), n);
}
function bk(u, n) {
  kt(u, ["moov", "trak"]).forEach(o => {
    const l = kt(o, ["mdia", "minf", "stbl", "stsd"])[0];
    if (!l) return;
    const h = l.subarray(8);
    let p = kt(h, ["enca"]);
    const d = p.length > 0;
    (d || (p = kt(h, ["encv"])),
      p.forEach(y => {
        const v = d ? y.subarray(28) : y.subarray(78);
        kt(v, ["sinf"]).forEach(S => {
          const w = Dk(S);
          w && n(w, d);
        });
      }));
  });
}
function Dk(u) {
  const n = kt(u, ["schm"])[0];
  if (n) {
    const i = Jn(n.subarray(4, 8));
    if (i === "cbcs" || i === "cenc") {
      const o = kt(u, ["schi", "tenc"])[0];
      if (o) return o;
    }
  }
}
function gH(u, n, i) {
  const o = {},
    l = kt(u, ["moof", "traf"]);
  for (let h = 0; h < l.length; h++) {
    const p = l[h],
      d = kt(p, ["tfhd"])[0],
      y = vt(d, 4),
      v = n[y];
    if (!v) continue;
    o[y] || (o[y] = { start: NaN, duration: 0, sampleCount: 0, timescale: v.timescale, type: v.type });
    const T = o[y],
      S = kt(p, ["tfdt"])[0];
    if (S) {
      const $ = S[0];
      let I = vt(S, 4);
      ($ === 1 &&
        (I === U_
          ? i.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time")
          : ((I *= U_ + 1), (I += vt(S, 8)))),
        Ue(I) && (!Ue(T.start) || I < T.start) && (T.start = I));
    }
    const w = v.default,
      C = vt(d, 0) | (w == null ? void 0 : w.flags);
    let L = (w == null ? void 0 : w.duration) || 0;
    C & 8 && (C & 2 ? (L = vt(d, 12)) : (L = vt(d, 8)));
    const k = kt(p, ["trun"]);
    let O = T.start || 0,
      B = 0,
      N = L;
    for (let $ = 0; $ < k.length; $++) {
      const I = k[$],
        V = vt(I, 4),
        oe = T.sampleCount;
      T.sampleCount += V;
      const Y = I[3] & 1,
        te = I[3] & 4,
        _ = I[2] & 1,
        K = I[2] & 2,
        q = I[2] & 4,
        ce = I[2] & 8;
      let he = 8,
        ae = V;
      for (
        Y && (he += 4),
          te &&
            V &&
            (!(I[he + 1] & 1) && T.keyFrameIndex === void 0 && (T.keyFrameIndex = oe),
            (he += 4),
            _ ? ((N = vt(I, he)), (he += 4)) : (N = L),
            K && (he += 4),
            ce && (he += 4),
            (O += N),
            (B += N),
            ae--);
        ae--;
      )
        (_ ? ((N = vt(I, he)), (he += 4)) : (N = L),
          K && (he += 4),
          q &&
            (I[he + 1] & 1 ||
              (T.keyFrameIndex === void 0 &&
                ((T.keyFrameIndex = T.sampleCount - (ae + 1)), (T.keyFrameStart = O))),
            (he += 4)),
          ce && (he += 4),
          (O += N),
          (B += N));
      !B && L && (B += L * V);
    }
    T.duration += B;
  }
  if (!Object.keys(o).some(h => o[h].duration)) {
    let h = 1 / 0,
      p = 0;
    const d = kt(u, ["sidx"]);
    for (let y = 0; y < d.length; y++) {
      const v = cH(d[y]);
      if (v != null && v.references) {
        h = Math.min(h, v.earliestPresentationTime / v.timescale);
        const T = v.references.reduce((S, w) => S + w.info.duration || 0, 0);
        p = Math.max(p, T + v.earliestPresentationTime / v.timescale);
      }
    }
    p &&
      Ue(p) &&
      Object.keys(o).forEach(y => {
        o[y].duration || (o[y].duration = p * o[y].timescale - o[y].start);
      });
  }
  return o;
}
function mH(u) {
  const n = { valid: null, remainder: null },
    i = kt(u, ["moof"]);
  if (i.length < 2) return ((n.remainder = u), n);
  const o = i[i.length - 1];
  return ((n.valid = u.slice(0, o.byteOffset - 8)), (n.remainder = u.slice(o.byteOffset - 8)), n);
}
function Mr(u, n) {
  const i = new Uint8Array(u.length + n.length);
  return (i.set(u), i.set(n, u.length), i);
}
function $_(u, n) {
  const i = [],
    o = n.samples,
    l = n.timescale,
    h = n.id;
  let p = !1;
  return (
    kt(o, ["moof"]).map(y => {
      const v = y.byteOffset - 8;
      kt(y, ["traf"]).map(S => {
        const w = kt(S, ["tfdt"]).map(C => {
          const L = C[0];
          let k = vt(C, 4);
          return (L === 1 && ((k *= Math.pow(2, 32)), (k += vt(C, 8))), k / l);
        })[0];
        return (
          w !== void 0 && (u = w),
          kt(S, ["tfhd"]).map(C => {
            const L = vt(C, 4),
              k = vt(C, 0) & 16777215,
              O = (k & 1) !== 0,
              B = (k & 2) !== 0,
              N = (k & 8) !== 0;
            let $ = 0;
            const I = (k & 16) !== 0;
            let V = 0;
            const oe = (k & 32) !== 0;
            let Y = 8;
            L === h &&
              (O && (Y += 8),
              B && (Y += 4),
              N && (($ = vt(C, Y)), (Y += 4)),
              I && ((V = vt(C, Y)), (Y += 4)),
              oe && (Y += 4),
              n.type === "video" && (p = rm(n.codec)),
              kt(S, ["trun"]).map(te => {
                const _ = te[0],
                  K = vt(te, 0) & 16777215,
                  q = (K & 1) !== 0;
                let ce = 0;
                const he = (K & 4) !== 0,
                  ae = (K & 256) !== 0;
                let ye = 0;
                const ve = (K & 512) !== 0;
                let we = 0;
                const Le = (K & 1024) !== 0,
                  ke = (K & 2048) !== 0;
                let Ne = 0;
                const Re = vt(te, 4);
                let Ce = 8;
                (q && ((ce = vt(te, Ce)), (Ce += 4)), he && (Ce += 4));
                let W = ce + v;
                for (let Qe = 0; Qe < Re; Qe++) {
                  if (
                    (ae ? ((ye = vt(te, Ce)), (Ce += 4)) : (ye = $),
                    ve ? ((we = vt(te, Ce)), (Ce += 4)) : (we = V),
                    Le && (Ce += 4),
                    ke && (_ === 0 ? (Ne = vt(te, Ce)) : (Ne = Lk(te, Ce)), (Ce += 4)),
                    n.type === an.VIDEO)
                  ) {
                    let ot = 0;
                    for (; ot < we; ) {
                      const Je = vt(o, W);
                      if (((W += 4), yH(p, o[W]))) {
                        const Ut = o.subarray(W, W + Je);
                        uS(Ut, p ? 2 : 1, u + Ne / l, i);
                      }
                      ((W += Je), (ot += Je + 4));
                    }
                  }
                  u += ye / l;
                }
              }));
          })
        );
      });
    }),
    i
  );
}
function rm(u) {
  if (!u) return !1;
  const n = u.substring(0, 4);
  return n === "hvc1" || n === "hev1" || n === "dvh1" || n === "dvhe";
}
function yH(u, n) {
  if (u) {
    const i = (n >> 1) & 63;
    return i === 39 || i === 40;
  } else return (n & 31) === 6;
}
function uS(u, n, i, o) {
  const l = kk(u);
  let h = 0;
  h += n;
  let p = 0,
    d = 0,
    y = 0;
  for (; h < l.length; ) {
    p = 0;
    do {
      if (h >= l.length) break;
      ((y = l[h++]), (p += y));
    } while (y === 255);
    d = 0;
    do {
      if (h >= l.length) break;
      ((y = l[h++]), (d += y));
    } while (y === 255);
    const v = l.length - h;
    let T = h;
    if (d < v) h += d;
    else if (d > v) {
      Zt.error(
        "Malformed SEI payload. ".concat(d, " is too small, only ").concat(v, " bytes left to parse."),
      );
      break;
    }
    if (p === 4) {
      if (l[T++] === 181) {
        const w = Ck(l, T);
        if (((T += 2), w === 49)) {
          const C = vt(l, T);
          if (((T += 4), C === 1195456820)) {
            const L = l[T++];
            if (L === 3) {
              const k = l[T++],
                O = 31 & k,
                B = 64 & k,
                N = B ? 2 + O * 3 : 0,
                $ = new Uint8Array(N);
              if (B) {
                $[0] = k;
                for (let I = 1; I < N; I++) $[I] = l[T++];
              }
              o.push({ type: L, payloadType: p, pts: i, bytes: $ });
            }
          }
        }
      }
    } else if (p === 5 && d > 16) {
      const S = [];
      for (let L = 0; L < 16; L++) {
        const k = l[T++].toString(16);
        (S.push(k.length == 1 ? "0" + k : k), (L === 3 || L === 5 || L === 7 || L === 9) && S.push("-"));
      }
      const w = d - 16,
        C = new Uint8Array(w);
      for (let L = 0; L < w; L++) C[L] = l[T++];
      o.push({ payloadType: p, pts: i, uuid: S.join(""), userData: Sr(C), userDataBytes: C });
    }
  }
}
function kk(u) {
  const n = u.byteLength,
    i = [];
  let o = 1;
  for (; o < n - 2; ) u[o] === 0 && u[o + 1] === 0 && u[o + 2] === 3 ? (i.push(o + 2), (o += 2)) : o++;
  if (i.length === 0) return u;
  const l = n - i.length,
    h = new Uint8Array(l);
  let p = 0;
  for (o = 0; o < l; p++, o++) (p === i[0] && (p++, i.shift()), (h[o] = u[p]));
  return h;
}
function vH(u) {
  const n = u[0];
  let i = "",
    o = "",
    l = 0,
    h = 0,
    p = 0,
    d = 0,
    y = 0,
    v = 0;
  if (n === 0) {
    for (; Jn(u.subarray(v, v + 1)) !== "\0"; ) ((i += Jn(u.subarray(v, v + 1))), (v += 1));
    for (i += Jn(u.subarray(v, v + 1)), v += 1; Jn(u.subarray(v, v + 1)) !== "\0"; )
      ((o += Jn(u.subarray(v, v + 1))), (v += 1));
    ((o += Jn(u.subarray(v, v + 1))),
      (v += 1),
      (l = vt(u, 12)),
      (h = vt(u, 16)),
      (d = vt(u, 20)),
      (y = vt(u, 24)),
      (v = 28));
  } else if (n === 1) {
    ((v += 4), (l = vt(u, v)), (v += 4));
    const S = vt(u, v);
    v += 4;
    const w = vt(u, v);
    for (
      v += 4,
        p = 2 ** 32 * S + w,
        YV(p) ||
          ((p = Number.MAX_SAFE_INTEGER),
          Zt.warn(
            "Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box",
          )),
        d = vt(u, v),
        v += 4,
        y = vt(u, v),
        v += 4;
      Jn(u.subarray(v, v + 1)) !== "\0";
    )
      ((i += Jn(u.subarray(v, v + 1))), (v += 1));
    for (i += Jn(u.subarray(v, v + 1)), v += 1; Jn(u.subarray(v, v + 1)) !== "\0"; )
      ((o += Jn(u.subarray(v, v + 1))), (v += 1));
    ((o += Jn(u.subarray(v, v + 1))), (v += 1));
  }
  const T = u.subarray(v, u.byteLength);
  return {
    schemeIdUri: i,
    value: o,
    timeScale: l,
    presentationTime: p,
    presentationTimeDelta: h,
    eventDuration: d,
    id: y,
    payload: T,
  };
}
function xH(u, ...n) {
  const i = n.length;
  let o = 8,
    l = i;
  for (; l--; ) o += n[l].byteLength;
  const h = new Uint8Array(o);
  for (
    h[0] = (o >> 24) & 255,
      h[1] = (o >> 16) & 255,
      h[2] = (o >> 8) & 255,
      h[3] = o & 255,
      h.set(u, 4),
      l = 0,
      o = 8;
    l < i;
    l++
  )
    (h.set(n[l], o), (o += n[l].byteLength));
  return h;
}
function TH(u, n, i) {
  if (u.byteLength !== 16) throw new RangeError("Invalid system id");
  let o, l;
  ((o = 0), (l = new Uint8Array()));
  let h;
  o > 0
    ? ((h = new Uint8Array(4)), n.length > 0 && new DataView(h.buffer).setUint32(0, n.length, !1))
    : (h = new Uint8Array());
  const p = new Uint8Array(4);
  return (
    i.byteLength > 0 && new DataView(p.buffer).setUint32(0, i.byteLength, !1),
    xH([112, 115, 115, 104], new Uint8Array([o, 0, 0, 0]), u, h, l, p, i)
  );
}
function SH(u) {
  const n = [];
  if (u instanceof ArrayBuffer) {
    const i = u.byteLength;
    let o = 0;
    for (; o + 32 < i; ) {
      const l = new DataView(u, o),
        h = EH(l);
      (n.push(h), (o += h.size));
    }
  }
  return n;
}
function EH(u) {
  const n = u.getUint32(0),
    i = u.byteOffset,
    o = u.byteLength;
  if (o < n) return { offset: i, size: o };
  if (u.getUint32(4) !== 1886614376) return { offset: i, size: n };
  const h = u.getUint32(8) >>> 24;
  if (h !== 0 && h !== 1) return { offset: i, size: n };
  const p = u.buffer,
    d = yi(new Uint8Array(p, i + 12, 16));
  let y = null,
    v = null,
    T = 0;
  if (h === 0) T = 28;
  else {
    const w = u.getUint32(28);
    if (!w || o < 32 + w * 16) return { offset: i, size: n };
    y = [];
    for (let C = 0; C < w; C++) y.push(new Uint8Array(p, i + 32 + C * 16, 16));
    T = 32 + w * 16;
  }
  if (!T) return { offset: i, size: n };
  const S = u.getUint32(T);
  return n - 32 < S
    ? { offset: i, size: n }
    : ((v = new Uint8Array(p, i + T + 4, S)),
      { version: h, systemId: d, kids: y, data: v, offset: i, size: n });
}
const Mk = () => /\(Windows.+Firefox\//i.test(navigator.userAgent),
  uu = {
    audio: {
      a3ds: 1,
      "ac-3": 0.95,
      "ac-4": 1,
      alac: 0.9,
      alaw: 1,
      dra1: 1,
      "dts+": 1,
      "dts-": 1,
      dtsc: 1,
      dtse: 1,
      dtsh: 1,
      "ec-3": 0.9,
      enca: 1,
      fLaC: 0.9,
      flac: 0.9,
      FLAC: 0.9,
      g719: 1,
      g726: 1,
      m4ae: 1,
      mha1: 1,
      mha2: 1,
      mhm1: 1,
      mhm2: 1,
      mlpa: 1,
      mp4a: 1,
      "raw ": 1,
      Opus: 1,
      opus: 1,
      samr: 1,
      sawb: 1,
      sawp: 1,
      sevc: 1,
      sqcp: 1,
      ssmv: 1,
      twos: 1,
      ulaw: 1,
    },
    video: {
      avc1: 1,
      avc2: 1,
      avc3: 1,
      avc4: 1,
      avcp: 1,
      av01: 0.8,
      dav1: 0.8,
      drac: 1,
      dva1: 1,
      dvav: 1,
      dvh1: 0.7,
      dvhe: 0.7,
      encv: 1,
      hev1: 0.75,
      hvc1: 0.75,
      mjp2: 1,
      mp4v: 1,
      mvc1: 1,
      mvc2: 1,
      mvc3: 1,
      mvc4: 1,
      resv: 1,
      rv60: 1,
      s263: 1,
      svc1: 1,
      svc2: 1,
      "vc-1": 1,
      vp08: 1,
      vp09: 0.9,
    },
    text: { stpp: 1, wvtt: 1 },
  };
function cS(u, n) {
  const i = uu[n];
  return !!i && !!i[u.slice(0, 4)];
}
function Rd(u, n, i = !0) {
  return !u.split(",").some(o => !dS(o, n, i));
}
function dS(u, n, i = !0) {
  var o;
  const l = Oo(i);
  return (o = l == null ? void 0 : l.isTypeSupported(Cd(u, n))) != null ? o : !1;
}
function Cd(u, n) {
  return "".concat(n, "/mp4;codecs=").concat(u);
}
function G_(u) {
  if (u) {
    const n = u.substring(0, 4);
    return uu.video[n];
  }
  return 2;
}
function Og(u) {
  const n = Mk();
  return u.split(",").reduce((i, o) => {
    const h = n && rm(o) ? 9 : uu.video[o];
    return h ? (h * 2 + i) / (i ? 3 : 2) : (uu.audio[o] + i) / (i ? 2 : 1);
  }, 0);
}
const _x = {};
function AH(u, n = !0) {
  if (_x[u]) return _x[u];
  const i = { flac: ["flac", "fLaC", "FLAC"], opus: ["opus", "Opus"], "mp4a.40.34": ["mp3"] }[u];
  for (let l = 0; l < i.length; l++) {
    var o;
    if (dS(i[l], "audio", n)) return ((_x[u] = i[l]), i[l]);
    if (i[l] === "mp3" && (o = Oo(n)) != null && o.isTypeSupported("audio/mpeg")) return "";
  }
  return u;
}
const IH = /flac|opus|mp4a\.40\.34/i;
function Ng(u, n = !0) {
  return u.replace(IH, i => AH(i.toLowerCase(), n));
}
function wH(u, n) {
  const i = [];
  if (u) {
    const o = u.split(",");
    for (let l = 0; l < o.length; l++) cS(o[l], "video") || i.push(o[l]);
  }
  return (n && i.push(n), i.join(","));
}
function fg(u, n) {
  if (
    u &&
    (u.length > 4 || ["ac-3", "ec-3", "alac", "fLaC", "Opus"].indexOf(u) !== -1) &&
    (j_(u, "audio") || j_(u, "video"))
  )
    return u;
  if (n) {
    const i = n.split(",");
    if (i.length > 1) {
      if (u) {
        for (let o = i.length; o--; ) if (i[o].substring(0, 4) === u.substring(0, 4)) return i[o];
      }
      return i[0];
    }
  }
  return n || u;
}
function j_(u, n) {
  return cS(u, n) && dS(u, n);
}
function RH(u) {
  const n = u.split(",");
  for (let i = 0; i < n.length; i++) {
    const o = n[i].split(".");
    o.length > 2 &&
      o[0] === "avc1" &&
      (n[i] = "avc1."
        .concat(parseInt(o[1]).toString(16))
        .concat(("000" + parseInt(o[2]).toString(16)).slice(-4)));
  }
  return n.join(",");
}
function CH(u) {
  if (u.startsWith("av01.")) {
    const n = u.split("."),
      i = ["0", "111", "01", "01", "01", "0"];
    for (let o = n.length; o > 4 && o < 10; o++) n[o] = i[o - 4];
    return n.join(".");
  }
  return u;
}
function V_(u) {
  const n = Oo(u) || { isTypeSupported: () => !1 };
  return {
    mpeg: n.isTypeSupported("audio/mpeg"),
    mp3: n.isTypeSupported('audio/mp4; codecs="mp3"'),
    ac3: n.isTypeSupported('audio/mp4; codecs="ac-3"'),
  };
}
function RT(u) {
  return u.replace(/^.+codecs=["']?([^"']+).*$/, "$1");
}
const LH = { supported: !0, powerEfficient: !0, smooth: !0 },
  _H = { supported: !1, smooth: !1, powerEfficient: !1 },
  Pk = { supported: !0, configurations: [], decodingInfoResults: [LH] };
function Ok(u, n) {
  return { supported: !1, configurations: n, decodingInfoResults: [_H], error: u };
}
function bH(u, n, i, o, l, h) {
  const p = u.videoCodec,
    d = u.audioCodec ? u.audioGroups : null,
    y = h == null ? void 0 : h.audioCodec,
    v = h == null ? void 0 : h.channels,
    T = v ? parseInt(v) : y ? 1 / 0 : 2;
  let S = null;
  if (d != null && d.length)
    try {
      d.length === 1 && d[0]
        ? (S = n.groups[d[0]].channels)
        : (S = d.reduce(
            (w, C) => {
              if (C) {
                const L = n.groups[C];
                if (!L) throw new Error("Audio track group ".concat(C, " not found"));
                Object.keys(L.channels).forEach(k => {
                  w[k] = (w[k] || 0) + L.channels[k];
                });
              }
              return w;
            },
            { 2: 0 },
          ));
    } catch (w) {
      return !0;
    }
  return (
    (p !== void 0 &&
      (p.split(",").some(w => rm(w)) ||
        (u.width > 1920 && u.height > 1088) ||
        (u.height > 1920 && u.width > 1088) ||
        u.frameRate > Math.max(o, 30) ||
        (u.videoRange !== "SDR" && u.videoRange !== i) ||
        u.bitrate > Math.max(l, 8e6))) ||
    (!!S && Ue(T) && Object.keys(S).some(w => parseInt(w) > T))
  );
}
function Nk(u, n, i, o = {}) {
  const l = u.videoCodec;
  if ((!l && !u.audioCodec) || !i) return Promise.resolve(Pk);
  const h = [],
    p = DH(u),
    d = p.length,
    y = kH(u, n, d > 0),
    v = y.length;
  for (let T = d || 1 * v || 1; T--; ) {
    const S = { type: "media-source" };
    if ((d && (S.video = p[T % d]), v)) {
      S.audio = y[T % v];
      const w = S.audio.bitrate;
      S.video && w && (S.video.bitrate -= w);
    }
    h.push(S);
  }
  if (l) {
    const T = navigator.userAgent;
    if (l.split(",").some(S => rm(S)) && Mk())
      return Promise.resolve(
        Ok(
          new Error(
            "Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (".concat(
              T,
              ")",
            ),
          ),
          h,
        ),
      );
  }
  return Promise.all(
    h.map(T => {
      const S = PH(T);
      return o[S] || (o[S] = i.decodingInfo(T));
    }),
  )
    .then(T => ({ supported: !T.some(S => !S.supported), configurations: h, decodingInfoResults: T }))
    .catch(T => ({ supported: !1, configurations: h, decodingInfoResults: [], error: T }));
}
function DH(u) {
  var n;
  const i = (n = u.videoCodec) == null ? void 0 : n.split(","),
    o = Fk(u),
    l = u.width || 640,
    h = u.height || 480,
    p = u.frameRate || 30,
    d = u.videoRange.toLowerCase();
  return i
    ? i.map(y => {
        const v = { contentType: Cd(CH(y), "video"), width: l, height: h, bitrate: o, framerate: p };
        return (d !== "sdr" && (v.transferFunction = d), v);
      })
    : [];
}
function kH(u, n, i) {
  var o;
  const l = (o = u.audioCodec) == null ? void 0 : o.split(","),
    h = Fk(u);
  return l && u.audioGroups
    ? u.audioGroups.reduce((p, d) => {
        var y;
        const v = d ? ((y = n.groups[d]) == null ? void 0 : y.tracks) : null;
        return v
          ? v.reduce((T, S) => {
              if (S.groupId === d) {
                const w = parseFloat(S.channels || "");
                l.forEach(C => {
                  const L = { contentType: Cd(C, "audio"), bitrate: i ? MH(C, h) : h };
                  (w && (L.channels = "" + w), T.push(L));
                });
              }
              return T;
            }, p)
          : p;
      }, [])
    : [];
}
function MH(u, n) {
  if (n <= 1) return 1;
  let i = 128e3;
  return (u === "ec-3" ? (i = 768e3) : u === "ac-3" && (i = 64e4), Math.min(n / 2, i));
}
function Fk(u) {
  return Math.ceil(Math.max(u.bitrate * 0.9, u.averageBitrate) / 1e3) * 1e3 || 1;
}
function PH(u) {
  let n = "";
  const { audio: i, video: o } = u;
  if (o) {
    const l = RT(o.contentType);
    n += ""
      .concat(l, "_r")
      .concat(o.height, "x")
      .concat(o.width, "f")
      .concat(Math.ceil(o.framerate))
      .concat(o.transferFunction || "sd", "_")
      .concat(Math.ceil(o.bitrate / 1e5));
  }
  if (i) {
    const l = RT(i.contentType);
    n += ""
      .concat(o ? "_" : "")
      .concat(l, "_c")
      .concat(i.channels);
  }
  return n;
}
const CT = ["NONE", "TYPE-0", "TYPE-1", null];
function OH(u) {
  return CT.indexOf(u) > -1;
}
const Fg = ["SDR", "PQ", "HLG"];
function NH(u) {
  return !!u && Fg.indexOf(u) > -1;
}
var pg = { No: "", Yes: "YES", v2: "v2" };
function H_(u) {
  const { canSkipUntil: n, canSkipDateRanges: i, age: o } = u,
    l = o < n / 2;
  return n && l ? (i ? pg.v2 : pg.Yes) : pg.No;
}
class K_ {
  constructor(n, i, o) {
    ((this.msn = void 0),
      (this.part = void 0),
      (this.skip = void 0),
      (this.msn = n),
      (this.part = i),
      (this.skip = o));
  }
  addDirectives(n) {
    const i = new self.URL(n);
    return (
      this.msn !== void 0 && i.searchParams.set("_HLS_msn", this.msn.toString()),
      this.part !== void 0 && i.searchParams.set("_HLS_part", this.part.toString()),
      this.skip && i.searchParams.set("_HLS_skip", this.skip),
      i.href
    );
  }
}
class Ld {
  constructor(n) {
    if (
      ((this._attrs = void 0),
      (this.audioCodec = void 0),
      (this.bitrate = void 0),
      (this.codecSet = void 0),
      (this.url = void 0),
      (this.frameRate = void 0),
      (this.height = void 0),
      (this.id = void 0),
      (this.name = void 0),
      (this.supplemental = void 0),
      (this.videoCodec = void 0),
      (this.width = void 0),
      (this.details = void 0),
      (this.fragmentError = 0),
      (this.loadError = 0),
      (this.loaded = void 0),
      (this.realBitrate = 0),
      (this.supportedPromise = void 0),
      (this.supportedResult = void 0),
      (this._avgBitrate = 0),
      (this._audioGroups = void 0),
      (this._subtitleGroups = void 0),
      (this._urlId = 0),
      (this.url = [n.url]),
      (this._attrs = [n.attrs]),
      (this.bitrate = n.bitrate),
      n.details && (this.details = n.details),
      (this.id = n.id || 0),
      (this.name = n.name),
      (this.width = n.width || 0),
      (this.height = n.height || 0),
      (this.frameRate = n.attrs.optionalFloat("FRAME-RATE", 0)),
      (this._avgBitrate = n.attrs.decimalInteger("AVERAGE-BANDWIDTH")),
      (this.audioCodec = n.audioCodec),
      (this.videoCodec = n.videoCodec),
      (this.codecSet = [n.videoCodec, n.audioCodec]
        .filter(o => !!o)
        .map(o => o.substring(0, 4))
        .join(",")),
      "supplemental" in n)
    ) {
      var i;
      this.supplemental = n.supplemental;
      const o = (i = n.supplemental) == null ? void 0 : i.videoCodec;
      o && o !== n.videoCodec && (this.codecSet += ",".concat(o.substring(0, 4)));
    }
    (this.addGroupId("audio", n.attrs.AUDIO), this.addGroupId("text", n.attrs.SUBTITLES));
  }
  get maxBitrate() {
    return Math.max(this.realBitrate, this.bitrate);
  }
  get averageBitrate() {
    return this._avgBitrate || this.realBitrate || this.bitrate;
  }
  get attrs() {
    return this._attrs[0];
  }
  get codecs() {
    return this.attrs.CODECS || "";
  }
  get pathwayId() {
    return this.attrs["PATHWAY-ID"] || ".";
  }
  get videoRange() {
    return this.attrs["VIDEO-RANGE"] || "SDR";
  }
  get score() {
    return this.attrs.optionalFloat("SCORE", 0);
  }
  get uri() {
    return this.url[0] || "";
  }
  hasAudioGroup(n) {
    return W_(this._audioGroups, n);
  }
  hasSubtitleGroup(n) {
    return W_(this._subtitleGroups, n);
  }
  get audioGroups() {
    return this._audioGroups;
  }
  get subtitleGroups() {
    return this._subtitleGroups;
  }
  addGroupId(n, i) {
    if (i) {
      if (n === "audio") {
        let o = this._audioGroups;
        (o || (o = this._audioGroups = []), o.indexOf(i) === -1 && o.push(i));
      } else if (n === "text") {
        let o = this._subtitleGroups;
        (o || (o = this._subtitleGroups = []), o.indexOf(i) === -1 && o.push(i));
      }
    }
  }
  get urlId() {
    return 0;
  }
  set urlId(n) {}
  get audioGroupIds() {
    return this.audioGroups ? [this.audioGroupId] : void 0;
  }
  get textGroupIds() {
    return this.subtitleGroups ? [this.textGroupId] : void 0;
  }
  get audioGroupId() {
    var n;
    return (n = this.audioGroups) == null ? void 0 : n[0];
  }
  get textGroupId() {
    var n;
    return (n = this.subtitleGroups) == null ? void 0 : n[0];
  }
  addFallback() {}
}
function W_(u, n) {
  return !n || !u ? !1 : u.indexOf(n) !== -1;
}
function FH() {
  if (typeof matchMedia == "function") {
    const u = matchMedia("(dynamic-range: high)"),
      n = matchMedia("bad query");
    if (u.media !== n.media) return u.matches === !0;
  }
  return !1;
}
function UH(u, n) {
  let i = !1,
    o = [];
  if ((u && ((i = u !== "SDR"), (o = [u])), n)) {
    o = n.allowedVideoRanges || Fg.slice(0);
    const l = o.join("") !== "SDR" && !n.videoCodec;
    ((i = n.preferHDR !== void 0 ? n.preferHDR : l && FH()), i || (o = ["SDR"]));
  }
  return { preferHDR: i, allowedVideoRanges: o };
}
const BH = u => {
    const n = new WeakSet();
    return (i, o) => {
      if ((u && (o = u(i, o)), typeof o == "object" && o !== null)) {
        if (n.has(o)) return;
        n.add(o);
      }
      return o;
    };
  },
  ln = (u, n) => JSON.stringify(u, BH(n));
function $H(u, n, i, o, l) {
  const h = Object.keys(u),
    p = o == null ? void 0 : o.channels,
    d = o == null ? void 0 : o.audioCodec,
    y = l == null ? void 0 : l.videoCodec,
    v = p && parseInt(p) === 2;
  let T = !1,
    S = !1,
    w = 1 / 0,
    C = 1 / 0,
    L = 1 / 0,
    k = 1 / 0,
    O = 0,
    B = [];
  const { preferHDR: N, allowedVideoRanges: $ } = UH(n, l);
  for (let te = h.length; te--; ) {
    const _ = u[h[te]];
    (T || (T = _.channels[2] > 0),
      (w = Math.min(w, _.minHeight)),
      (C = Math.min(C, _.minFramerate)),
      (L = Math.min(L, _.minBitrate)),
      $.filter(q => _.videoRanges[q] > 0).length > 0 && (S = !0));
  }
  ((w = Ue(w) ? w : 0), (C = Ue(C) ? C : 0));
  const I = Math.max(1080, w),
    V = Math.max(30, C);
  ((L = Ue(L) ? L : i), (i = Math.max(L, i)), S || (n = void 0));
  const oe = h.length > 1;
  return {
    codecSet: h.reduce(
      (te, _) => {
        const K = u[_];
        if (_ === te) return te;
        if (((B = S ? $.filter(q => K.videoRanges[q] > 0) : []), oe)) {
          if (K.minBitrate > i)
            return (is(_, "min bitrate of ".concat(K.minBitrate, " > current estimate of ").concat(i)), te);
          if (!K.hasDefaultAudio) return (is(_, "no renditions with default or auto-select sound found"), te);
          if (d && _.indexOf(d.substring(0, 4)) % 5 !== 0)
            return (is(_, 'audio codec preference "'.concat(d, '" not found')), te);
          if (p && !v) {
            if (!K.channels[p])
              return (
                is(
                  _,
                  "no renditions with "
                    .concat(p, " channel sound found (channels options: ")
                    .concat(Object.keys(K.channels), ")"),
                ),
                te
              );
          } else if ((!d || v) && T && K.channels[2] === 0)
            return (is(_, "no renditions with stereo sound found"), te);
          if (K.minHeight > I)
            return (is(_, "min resolution of ".concat(K.minHeight, " > maximum of ").concat(I)), te);
          if (K.minFramerate > V)
            return (is(_, "min framerate of ".concat(K.minFramerate, " > maximum of ").concat(V)), te);
          if (!B.some(q => K.videoRanges[q] > 0))
            return (is(_, "no variants with VIDEO-RANGE of ".concat(ln(B), " found")), te);
          if (y && _.indexOf(y.substring(0, 4)) % 5 !== 0)
            return (is(_, 'video codec preference "'.concat(y, '" not found')), te);
          if (K.maxScore < O)
            return (is(_, "max score of ".concat(K.maxScore, " < selected max of ").concat(O)), te);
        }
        return te && (Og(_) >= Og(te) || K.fragmentError > u[te].fragmentError)
          ? te
          : ((k = K.minIndex), (O = K.maxScore), _);
      },
      void 0,
    ),
    videoRanges: B,
    preferHDR: N,
    minFramerate: C,
    minBitrate: L,
    minIndex: k,
  };
}
function is(u, n) {
  Zt.log('[abr] start candidates with "'.concat(u, '" ignored because ').concat(n));
}
function Uk(u) {
  return u.reduce(
    (n, i) => {
      let o = n.groups[i.groupId];
      (o || (o = n.groups[i.groupId] = { tracks: [], channels: { 2: 0 }, hasDefault: !1, hasAutoSelect: !1 }),
        o.tracks.push(i));
      const l = i.channels || "2";
      return (
        (o.channels[l] = (o.channels[l] || 0) + 1),
        (o.hasDefault = o.hasDefault || i.default),
        (o.hasAutoSelect = o.hasAutoSelect || i.autoselect),
        o.hasDefault && (n.hasDefaultAudio = !0),
        o.hasAutoSelect && (n.hasAutoSelectAudio = !0),
        n
      );
    },
    { hasDefaultAudio: !1, hasAutoSelectAudio: !1, groups: {} },
  );
}
function GH(u, n, i, o) {
  return u.slice(i, o + 1).reduce((l, h, p) => {
    if (!h.codecSet) return l;
    const d = h.audioGroups;
    let y = l[h.codecSet];
    (y ||
      (l[h.codecSet] = y =
        {
          minBitrate: 1 / 0,
          minHeight: 1 / 0,
          minFramerate: 1 / 0,
          minIndex: p,
          maxScore: 0,
          videoRanges: { SDR: 0 },
          channels: { 2: 0 },
          hasDefaultAudio: !d,
          fragmentError: 0,
        }),
      (y.minBitrate = Math.min(y.minBitrate, h.bitrate)));
    const v = Math.min(h.height, h.width);
    return (
      (y.minHeight = Math.min(y.minHeight, v)),
      (y.minFramerate = Math.min(y.minFramerate, h.frameRate)),
      (y.minIndex = Math.min(y.minIndex, p)),
      (y.maxScore = Math.max(y.maxScore, h.score)),
      (y.fragmentError += h.fragmentError),
      (y.videoRanges[h.videoRange] = (y.videoRanges[h.videoRange] || 0) + 1),
      d &&
        d.forEach(T => {
          if (!T) return;
          const S = n.groups[T];
          S &&
            ((y.hasDefaultAudio =
              y.hasDefaultAudio || n.hasDefaultAudio
                ? S.hasDefault
                : S.hasAutoSelect || (!n.hasDefaultAudio && !n.hasAutoSelectAudio)),
            Object.keys(S.channels).forEach(w => {
              y.channels[w] = (y.channels[w] || 0) + S.channels[w];
            }));
        }),
      l
    );
  }, {});
}
function z_(u) {
  if (!u) return u;
  const { lang: n, assocLang: i, characteristics: o, channels: l, audioCodec: h } = u;
  return { lang: n, assocLang: i, characteristics: o, channels: l, audioCodec: h };
}
function ls(u, n, i) {
  if ("attrs" in u) {
    const o = n.indexOf(u);
    if (o !== -1) return o;
  }
  for (let o = 0; o < n.length; o++) {
    const l = n[o];
    if (Ta(u, l, i)) return o;
  }
  return -1;
}
function Ta(u, n, i) {
  const { groupId: o, name: l, lang: h, assocLang: p, default: d } = u,
    y = u.forced;
  return (
    (o === void 0 || n.groupId === o) &&
    (l === void 0 || n.name === l) &&
    (h === void 0 || jH(h, n.lang)) &&
    (h === void 0 || n.assocLang === p) &&
    (d === void 0 || n.default === d) &&
    (y === void 0 || n.forced === y) &&
    (!("characteristics" in u) || VH(u.characteristics || "", n.characteristics)) &&
    (i === void 0 || i(u, n))
  );
}
function jH(u, n = "--") {
  return u.length === n.length ? u === n : u.startsWith(n) || n.startsWith(u);
}
function VH(u, n = "") {
  const i = u.split(","),
    o = n.split(",");
  return i.length === o.length && !i.some(l => o.indexOf(l) === -1);
}
function ya(u, n) {
  const { audioCodec: i, channels: o } = u;
  return (
    (i === void 0 || (n.audioCodec || "").substring(0, 4) === i.substring(0, 4)) &&
    (o === void 0 || o === (n.channels || "2"))
  );
}
function HH(u, n, i, o, l) {
  const h = n[o],
    d = n.reduce((w, C, L) => {
      const k = C.uri;
      return ((w[k] || (w[k] = [])).push(L), w);
    }, {})[h.uri];
  d.length > 1 && (o = Math.max.apply(Math, d));
  const y = h.videoRange,
    v = h.frameRate,
    T = h.codecSet.substring(0, 4),
    S = Y_(n, o, w => {
      if (w.videoRange !== y || w.frameRate !== v || w.codecSet.substring(0, 4) !== T) return !1;
      const C = w.audioGroups,
        L = i.filter(k => !C || C.indexOf(k.groupId) !== -1);
      return ls(u, L, l) > -1;
    });
  return S > -1
    ? S
    : Y_(n, o, w => {
        const C = w.audioGroups,
          L = i.filter(k => !C || C.indexOf(k.groupId) !== -1);
        return ls(u, L, l) > -1;
      });
}
function Y_(u, n, i) {
  for (let o = n; o > -1; o--) if (i(u[o])) return o;
  for (let o = n + 1; o < u.length; o++) if (i(u[o])) return o;
  return -1;
}
function Ug(u, n) {
  var i;
  return !!u && u !== ((i = n.loadLevelObj) == null ? void 0 : i.uri);
}
class KH extends Pr {
  constructor(n) {
    (super("abr", n.logger),
      (this.hls = void 0),
      (this.lastLevelLoadSec = 0),
      (this.lastLoadedFragLevel = -1),
      (this.firstSelection = -1),
      (this._nextAutoLevel = -1),
      (this.nextAutoLevelKey = ""),
      (this.audioTracksByGroup = null),
      (this.codecTiers = null),
      (this.timer = -1),
      (this.fragCurrent = null),
      (this.partCurrent = null),
      (this.bitrateTestDelay = 0),
      (this.rebufferNotice = -1),
      (this.supportedCache = {}),
      (this.bwEstimator = void 0),
      (this._abandonRulesCheck = i => {
        var o;
        const { fragCurrent: l, partCurrent: h, hls: p } = this,
          { autoLevelEnabled: d, media: y } = p;
        if (!l || !y) return;
        const v = performance.now(),
          T = h ? h.stats : l.stats,
          S = h ? h.duration : l.duration,
          w = v - T.loading.start,
          C = p.minAutoLevel,
          L = l.level,
          k = this._nextAutoLevel;
        if (T.aborted || (T.loaded && T.loaded === T.total) || L <= C) {
          (this.clearTimer(), (this._nextAutoLevel = -1));
          return;
        }
        if (!d) return;
        const O = k > -1 && k !== L,
          B = !!i || O;
        if (!B && (y.paused || !y.playbackRate || !y.readyState)) return;
        const N = p.mainForwardBufferInfo;
        if (!B && N === null) return;
        const $ = this.bwEstimator.getEstimateTTFB(),
          I = Math.abs(y.playbackRate);
        if (w <= Math.max($, 1e3 * (S / (I * 2)))) return;
        const V = N ? N.len / I : 0,
          oe = T.loading.first ? T.loading.first - T.loading.start : -1,
          Y = T.loaded && oe > -1,
          te = this.getBwEstimate(),
          _ = p.levels,
          K = _[L],
          q = Math.max(T.loaded, Math.round((S * (l.bitrate || K.averageBitrate)) / 8));
        let ce = Y ? w - oe : w;
        ce < 1 && Y && (ce = Math.min(w, (T.loaded * 8) / te));
        const he = Y ? (T.loaded * 1e3) / ce : 0,
          ae = $ / 1e3,
          ye = he ? (q - T.loaded) / he : (q * 8) / te + ae;
        if (ye <= V) return;
        const ve = he ? he * 8 : te,
          we =
            ((o = (i == null ? void 0 : i.details) || this.hls.latestLevelDetails) == null
              ? void 0
              : o.live) === !0,
          Le = this.hls.config.abrBandWidthUpFactor;
        let ke = Number.POSITIVE_INFINITY,
          Ne;
        for (Ne = L - 1; Ne > C; Ne--) {
          const Qe = _[Ne].maxBitrate,
            ot = !_[Ne].details || we;
          if (((ke = this.getTimeToLoadFrag(ae, ve, S * Qe, ot)), ke < Math.min(V, S + ae))) break;
        }
        if (ke >= ye || ke > S * 10) return;
        Y ? this.bwEstimator.sample(w - Math.min($, oe), T.loaded) : this.bwEstimator.sampleTTFB(w);
        const Re = _[Ne].maxBitrate;
        this.getBwEstimate() * Le > Re && this.resetEstimator(Re);
        const Ce = this.findBestLevel(Re, C, Ne, 0, V, 1, 1);
        (Ce > -1 && (Ne = Ce),
          this.warn(
            "Fragment "
              .concat(l.sn)
              .concat(h ? " part " + h.index : "", " of level ")
              .concat(L, " is loading too slowly;\n      Fragment duration: ")
              .concat(l.duration.toFixed(3), "\n      Time to underbuffer: ")
              .concat(V.toFixed(3), " s\n      Estimated load time for current fragment: ")
              .concat(ye.toFixed(3), " s\n      Estimated load time for down switch fragment: ")
              .concat(ke.toFixed(3), " s\n      TTFB estimate: ")
              .concat(oe | 0, " ms\n      Current BW estimate: ")
              .concat(Ue(te) ? te | 0 : "Unknown", " bps\n      New BW estimate: ")
              .concat(this.getBwEstimate() | 0, " bps\n      Switching to level ")
              .concat(Ne, " @ ")
              .concat(Re | 0, " bps"),
          ),
          (p.nextLoadLevel = p.nextAutoLevel = Ne),
          this.clearTimer());
        const W = () => {
          if ((this.clearTimer(), this.fragCurrent === l && this.hls.loadLevel === Ne && Ne > 0)) {
            const Qe = this.getStarvationDelay();
            if (
              (this.warn(
                "Aborting inflight request "
                  .concat(Ne > 0 ? "and switching down" : "", "\n      Fragment duration: ")
                  .concat(l.duration.toFixed(3), " s\n      Time to underbuffer: ")
                  .concat(Qe.toFixed(3), " s"),
              ),
              l.abortRequests(),
              (this.fragCurrent = this.partCurrent = null),
              Ne > C)
            ) {
              let ot = this.findBestLevel(this.hls.levels[C].bitrate, C, Ne, 0, Qe, 1, 1);
              (ot === -1 && (ot = C),
                (this.hls.nextLoadLevel = this.hls.nextAutoLevel = ot),
                this.resetEstimator(this.hls.levels[ot].bitrate));
            }
          }
        };
        (O || ye > ke * 2 ? W() : (this.timer = self.setInterval(W, ke * 1e3)),
          p.trigger(F.FRAG_LOAD_EMERGENCY_ABORTED, { frag: l, part: h, stats: T }));
      }),
      (this.hls = n),
      (this.bwEstimator = this.initEstimator()),
      this.registerListeners());
  }
  resetEstimator(n) {
    (n && (this.log("setting initial bwe to ".concat(n)), (this.hls.config.abrEwmaDefaultEstimate = n)),
      (this.firstSelection = -1),
      (this.bwEstimator = this.initEstimator()));
  }
  initEstimator() {
    const n = this.hls.config;
    return new qV(n.abrEwmaSlowVoD, n.abrEwmaFastVoD, n.abrEwmaDefaultEstimate);
  }
  registerListeners() {
    const { hls: n } = this;
    (n.on(F.MANIFEST_LOADING, this.onManifestLoading, this),
      n.on(F.FRAG_LOADING, this.onFragLoading, this),
      n.on(F.FRAG_LOADED, this.onFragLoaded, this),
      n.on(F.FRAG_BUFFERED, this.onFragBuffered, this),
      n.on(F.LEVEL_SWITCHING, this.onLevelSwitching, this),
      n.on(F.LEVEL_LOADED, this.onLevelLoaded, this),
      n.on(F.LEVELS_UPDATED, this.onLevelsUpdated, this),
      n.on(F.MAX_AUTO_LEVEL_UPDATED, this.onMaxAutoLevelUpdated, this),
      n.on(F.ERROR, this.onError, this));
  }
  unregisterListeners() {
    const { hls: n } = this;
    n &&
      (n.off(F.MANIFEST_LOADING, this.onManifestLoading, this),
      n.off(F.FRAG_LOADING, this.onFragLoading, this),
      n.off(F.FRAG_LOADED, this.onFragLoaded, this),
      n.off(F.FRAG_BUFFERED, this.onFragBuffered, this),
      n.off(F.LEVEL_SWITCHING, this.onLevelSwitching, this),
      n.off(F.LEVEL_LOADED, this.onLevelLoaded, this),
      n.off(F.LEVELS_UPDATED, this.onLevelsUpdated, this),
      n.off(F.MAX_AUTO_LEVEL_UPDATED, this.onMaxAutoLevelUpdated, this),
      n.off(F.ERROR, this.onError, this));
  }
  destroy() {
    (this.unregisterListeners(),
      this.clearTimer(),
      (this.hls = this._abandonRulesCheck = this.supportedCache = null),
      (this.fragCurrent = this.partCurrent = null));
  }
  onManifestLoading(n, i) {
    ((this.lastLoadedFragLevel = -1),
      (this.firstSelection = -1),
      (this.lastLevelLoadSec = 0),
      (this.supportedCache = {}),
      (this.fragCurrent = this.partCurrent = null),
      this.onLevelsUpdated(),
      this.clearTimer());
  }
  onLevelsUpdated() {
    (this.lastLoadedFragLevel > -1 && this.fragCurrent && (this.lastLoadedFragLevel = this.fragCurrent.level),
      (this._nextAutoLevel = -1),
      this.onMaxAutoLevelUpdated(),
      (this.codecTiers = null),
      (this.audioTracksByGroup = null));
  }
  onMaxAutoLevelUpdated() {
    ((this.firstSelection = -1), (this.nextAutoLevelKey = ""));
  }
  onFragLoading(n, i) {
    const o = i.frag;
    if (!this.ignoreFragment(o)) {
      if (!o.bitrateTest) {
        var l;
        ((this.fragCurrent = o), (this.partCurrent = (l = i.part) != null ? l : null));
      }
      (this.clearTimer(), (this.timer = self.setInterval(this._abandonRulesCheck, 100)));
    }
  }
  onLevelSwitching(n, i) {
    this.clearTimer();
  }
  onError(n, i) {
    if (!i.fatal)
      switch (i.details) {
        case ge.BUFFER_ADD_CODEC_ERROR:
        case ge.BUFFER_APPEND_ERROR:
          ((this.lastLoadedFragLevel = -1), (this.firstSelection = -1));
          break;
        case ge.FRAG_LOAD_TIMEOUT: {
          const o = i.frag,
            { fragCurrent: l, partCurrent: h } = this;
          if (o && l && o.sn === l.sn && o.level === l.level) {
            const p = performance.now(),
              d = h ? h.stats : o.stats,
              y = p - d.loading.start,
              v = d.loading.first ? d.loading.first - d.loading.start : -1;
            if (d.loaded && v > -1) {
              const S = this.bwEstimator.getEstimateTTFB();
              this.bwEstimator.sample(y - Math.min(S, v), d.loaded);
            } else this.bwEstimator.sampleTTFB(y);
          }
          break;
        }
      }
  }
  getTimeToLoadFrag(n, i, o, l) {
    const h = n + o / i,
      p = l ? n + this.lastLevelLoadSec : 0;
    return h + p;
  }
  onLevelLoaded(n, i) {
    const o = this.hls.config,
      { loading: l } = i.stats,
      h = l.end - l.first;
    (Ue(h) && (this.lastLevelLoadSec = h / 1e3),
      i.details.live
        ? this.bwEstimator.update(o.abrEwmaSlowLive, o.abrEwmaFastLive)
        : this.bwEstimator.update(o.abrEwmaSlowVoD, o.abrEwmaFastVoD),
      this.timer > -1 && this._abandonRulesCheck(i.levelInfo));
  }
  onFragLoaded(n, { frag: i, part: o }) {
    const l = o ? o.stats : i.stats;
    if (
      (i.type === Xe.MAIN && this.bwEstimator.sampleTTFB(l.loading.first - l.loading.start),
      !this.ignoreFragment(i))
    ) {
      if (
        (this.clearTimer(),
        i.level === this._nextAutoLevel && (this._nextAutoLevel = -1),
        (this.firstSelection = -1),
        this.hls.config.abrMaxWithRealBitrate)
      ) {
        const h = o ? o.duration : i.duration,
          p = this.hls.levels[i.level],
          d = (p.loaded ? p.loaded.bytes : 0) + l.loaded,
          y = (p.loaded ? p.loaded.duration : 0) + h;
        ((p.loaded = { bytes: d, duration: y }), (p.realBitrate = Math.round((8 * d) / y)));
      }
      if (i.bitrateTest) {
        const h = { stats: l, frag: i, part: o, id: i.type };
        (this.onFragBuffered(F.FRAG_BUFFERED, h), (i.bitrateTest = !1));
      } else this.lastLoadedFragLevel = i.level;
    }
  }
  onFragBuffered(n, i) {
    const { frag: o, part: l } = i,
      h = l != null && l.stats.loaded ? l.stats : o.stats;
    if (h.aborted || this.ignoreFragment(o)) return;
    const p =
      h.parsing.end -
      h.loading.start -
      Math.min(h.loading.first - h.loading.start, this.bwEstimator.getEstimateTTFB());
    (this.bwEstimator.sample(p, h.loaded),
      (h.bwEstimate = this.getBwEstimate()),
      o.bitrateTest ? (this.bitrateTestDelay = p / 1e3) : (this.bitrateTestDelay = 0));
  }
  ignoreFragment(n) {
    return n.type !== Xe.MAIN || n.sn === "initSegment";
  }
  clearTimer() {
    this.timer > -1 && (self.clearInterval(this.timer), (this.timer = -1));
  }
  get firstAutoLevel() {
    const { maxAutoLevel: n, minAutoLevel: i } = this.hls,
      o = this.getBwEstimate(),
      l = this.hls.config.maxStarvationDelay,
      h = this.findBestLevel(o, i, n, 0, l, 1, 1);
    if (h > -1) return h;
    const p = this.hls.firstLevel,
      d = Math.min(Math.max(p, i), n);
    return (
      this.warn(
        "Could not find best starting auto level. Defaulting to first in playlist "
          .concat(p, " clamped to ")
          .concat(d),
      ),
      d
    );
  }
  get forcedAutoLevel() {
    return this.nextAutoLevelKey ? -1 : this._nextAutoLevel;
  }
  get nextAutoLevel() {
    const n = this.forcedAutoLevel,
      o = this.bwEstimator.canEstimate(),
      l = this.lastLoadedFragLevel > -1;
    if (n !== -1 && (!o || !l || this.nextAutoLevelKey === this.getAutoLevelKey())) return n;
    const h = o && l ? this.getNextABRAutoLevel() : this.firstAutoLevel;
    if (n !== -1) {
      const p = this.hls.levels;
      if (p.length > Math.max(n, h) && p[n].loadError <= p[h].loadError) return n;
    }
    return ((this._nextAutoLevel = h), (this.nextAutoLevelKey = this.getAutoLevelKey()), h);
  }
  getAutoLevelKey() {
    return "".concat(this.getBwEstimate(), "_").concat(this.getStarvationDelay().toFixed(2));
  }
  getNextABRAutoLevel() {
    const { fragCurrent: n, partCurrent: i, hls: o } = this;
    if (o.levels.length <= 1) return o.loadLevel;
    const { maxAutoLevel: l, config: h, minAutoLevel: p } = o,
      d = i ? i.duration : n ? n.duration : 0,
      y = this.getBwEstimate(),
      v = this.getStarvationDelay();
    let T = h.abrBandWidthFactor,
      S = h.abrBandWidthUpFactor;
    if (v) {
      const O = this.findBestLevel(y, p, l, v, 0, T, S);
      if (O >= 0) return ((this.rebufferNotice = -1), O);
    }
    let w = d ? Math.min(d, h.maxStarvationDelay) : h.maxStarvationDelay;
    if (!v) {
      const O = this.bitrateTestDelay;
      O &&
        ((w = (d ? Math.min(d, h.maxLoadingDelay) : h.maxLoadingDelay) - O),
        this.info(
          "bitrate test took "
            .concat(Math.round(1e3 * O), "ms, set first fragment max fetchDuration to ")
            .concat(Math.round(1e3 * w), " ms"),
        ),
        (T = S = 1));
    }
    const C = this.findBestLevel(y, p, l, v, w, T, S);
    if (
      (this.rebufferNotice !== C &&
        ((this.rebufferNotice = C),
        this.info(
          "".concat(v ? "rebuffering expected" : "buffer is empty", ", optimal quality level ").concat(C),
        )),
      C > -1)
    )
      return C;
    const L = o.levels[p],
      k = o.loadLevelObj;
    return k && (L == null ? void 0 : L.bitrate) < k.bitrate ? p : o.loadLevel;
  }
  getStarvationDelay() {
    const n = this.hls,
      i = n.media;
    if (!i) return 1 / 0;
    const o = i && i.playbackRate !== 0 ? Math.abs(i.playbackRate) : 1,
      l = n.mainForwardBufferInfo;
    return (l ? l.len : 0) / o;
  }
  getBwEstimate() {
    return this.bwEstimator.canEstimate()
      ? this.bwEstimator.getEstimate()
      : this.hls.config.abrEwmaDefaultEstimate;
  }
  findBestLevel(n, i, o, l, h, p, d) {
    var y;
    const v = l + h,
      T = this.lastLoadedFragLevel,
      S = T === -1 ? this.hls.firstLevel : T,
      { fragCurrent: w, partCurrent: C } = this,
      { levels: L, allAudioTracks: k, loadLevel: O, config: B } = this.hls;
    if (L.length === 1) return 0;
    const N = L[S],
      $ = !!((y = this.hls.latestLevelDetails) != null && y.live),
      I = O === -1 || T === -1;
    let V,
      oe = "SDR",
      Y = (N == null ? void 0 : N.frameRate) || 0;
    const { audioPreference: te, videoPreference: _ } = B,
      K = this.audioTracksByGroup || (this.audioTracksByGroup = Uk(k));
    let q = -1;
    if (I) {
      if (this.firstSelection !== -1) return this.firstSelection;
      const ve = this.codecTiers || (this.codecTiers = GH(L, K, i, o)),
        we = $H(ve, oe, n, te, _),
        { codecSet: Le, videoRanges: ke, minFramerate: Ne, minBitrate: Re, minIndex: Ce, preferHDR: W } = we;
      ((q = Ce),
        (V = Le),
        (oe = W ? ke[ke.length - 1] : ke[0]),
        (Y = Ne),
        (n = Math.max(n, Re)),
        this.log("picked start tier ".concat(ln(we))));
    } else ((V = N == null ? void 0 : N.codecSet), (oe = N == null ? void 0 : N.videoRange));
    const ce = C ? C.duration : w ? w.duration : 0,
      he = this.bwEstimator.getEstimateTTFB() / 1e3,
      ae = [];
    for (let ve = o; ve >= i; ve--) {
      var ye;
      const we = L[ve],
        Le = ve > S;
      if (!we) continue;
      if (B.useMediaCapabilities && !we.supportedResult && !we.supportedPromise) {
        const ot = navigator.mediaCapabilities;
        typeof (ot == null ? void 0 : ot.decodingInfo) == "function" && bH(we, K, oe, Y, n, te)
          ? ((we.supportedPromise = Nk(we, K, ot, this.supportedCache)),
            we.supportedPromise
              .then(Je => {
                if (!this.hls) return;
                we.supportedResult = Je;
                const Ut = this.hls.levels,
                  St = Ut.indexOf(we);
                Je.error
                  ? this.warn(
                      'MediaCapabilities decodingInfo error: "'
                        .concat(Je.error, '" for level ')
                        .concat(St, " ")
                        .concat(ln(Je)),
                    )
                  : Je.supported
                    ? Je.decodingInfoResults.some(Xt => Xt.smooth === !1 || Xt.powerEfficient === !1) &&
                      this.log(
                        "MediaCapabilities decodingInfo for level "
                          .concat(St, " not smooth or powerEfficient: ")
                          .concat(ln(Je)),
                      )
                    : (this.warn(
                        "Unsupported MediaCapabilities decodingInfo result for level "
                          .concat(St, " ")
                          .concat(ln(Je)),
                      ),
                      St > -1 &&
                        Ut.length > 1 &&
                        (this.log("Removing unsupported level ".concat(St)),
                        this.hls.removeLevel(St),
                        this.hls.loadLevel === -1 && (this.hls.nextLoadLevel = 0)));
              })
              .catch(Je => {
                this.warn("Error handling MediaCapabilities decodingInfo: ".concat(Je));
              }))
          : (we.supportedResult = Pk);
      }
      if (
        ((V && we.codecSet !== V) ||
          (oe && we.videoRange !== oe) ||
          (Le && Y > we.frameRate) ||
          (!Le && Y > 0 && Y < we.frameRate) ||
          ((ye = we.supportedResult) != null &&
            (ye = ye.decodingInfoResults) != null &&
            ye.some(ot => ot.smooth === !1))) &&
        (!I || ve !== q)
      ) {
        ae.push(ve);
        continue;
      }
      const ke = we.details,
        Ne =
          (C ? (ke == null ? void 0 : ke.partTarget) : ke == null ? void 0 : ke.averagetargetduration) || ce;
      let Re;
      Le ? (Re = d * n) : (Re = p * n);
      const Ce = ce && l >= ce * 2 && h === 0 ? we.averageBitrate : we.maxBitrate,
        W = this.getTimeToLoadFrag(he, Re, Ce * Ne, ke === void 0);
      if (
        Re >= Ce &&
        (ve === T || (we.loadError === 0 && we.fragmentError === 0)) &&
        (W <= he || !Ue(W) || ($ && !this.bitrateTestDelay) || W < v)
      ) {
        const ot = this.forcedAutoLevel;
        return (
          ve !== O &&
            (ot === -1 || ot !== O) &&
            (ae.length &&
              this.trace(
                "Skipped level(s) "
                  .concat(ae.join(","), " of ")
                  .concat(o, ' max with CODECS and VIDEO-RANGE:"')
                  .concat(L[ae[0]].codecs, '" ')
                  .concat(L[ae[0]].videoRange, '; not compatible with "')
                  .concat(V, '" ')
                  .concat(oe),
              ),
            this.info(
              "switch candidate:"
                .concat(S, "->")
                .concat(ve, " adjustedbw(")
                .concat(Math.round(Re), ")-bitrate=")
                .concat(Math.round(Re - Ce), " ttfb:")
                .concat(he.toFixed(1), " avgDuration:")
                .concat(Ne.toFixed(1), " maxFetchDuration:")
                .concat(v.toFixed(1), " fetchDuration:")
                .concat(W.toFixed(1), " firstSelection:")
                .concat(I, " codecSet:")
                .concat(we.codecSet, " videoRange:")
                .concat(we.videoRange, " hls.loadLevel:")
                .concat(O),
            )),
          I && (this.firstSelection = ve),
          ve
        );
      }
    }
    return -1;
  }
  set nextAutoLevel(n) {
    const i = this.deriveNextAutoLevel(n);
    this._nextAutoLevel !== i && ((this.nextAutoLevelKey = ""), (this._nextAutoLevel = i));
  }
  deriveNextAutoLevel(n) {
    const { maxAutoLevel: i, minAutoLevel: o } = this.hls;
    return Math.min(Math.max(n, o), i);
  }
}
const Bk = {
  search: function (u, n) {
    let i = 0,
      o = u.length - 1,
      l = null,
      h = null;
    for (; i <= o; ) {
      ((l = ((i + o) / 2) | 0), (h = u[l]));
      const p = n(h);
      if (p > 0) i = l + 1;
      else if (p < 0) o = l - 1;
      else return h;
    }
    return null;
  },
};
function WH(u, n, i) {
  if (n === null || !Array.isArray(u) || !u.length || !Ue(n)) return null;
  const o = u[0].programDateTime;
  if (n < (o || 0)) return null;
  const l = u[u.length - 1].endProgramDateTime;
  if (n >= (l || 0)) return null;
  for (let h = 0; h < u.length; ++h) {
    const p = u[h];
    if (YH(n, i, p)) return p;
  }
  return null;
}
function Aa(u, n, i = 0, o = 0, l = 0.005) {
  let h = null;
  if (u) {
    h = n[1 + u.sn - n[0].sn] || null;
    const d = u.endDTS - i;
    (d > 0 && d < 15e-7 && (i += 15e-7),
      h && u.level !== h.level && h.end <= u.end && (h = n[2 + u.sn - n[0].sn] || null));
  } else i === 0 && n[0].start === 0 && (h = n[0]);
  if (h && (((!u || u.level === h.level) && X_(i, o, h) === 0) || zH(h, u, Math.min(l, o)))) return h;
  const p = Bk.search(n, X_.bind(null, i, o));
  return p && (p !== u || !h) ? p : h;
}
function zH(u, n, i) {
  if (n && n.start === 0 && n.level < u.level && (n.endPTS || 0) > 0) {
    const o = n.tagList.reduce((l, h) => (h[0] === "INF" && (l += parseFloat(h[1])), l), i);
    return u.start <= o;
  }
  return !1;
}
function X_(u = 0, n = 0, i) {
  if (i.start <= u && i.start + i.duration > u) return 0;
  const o = Math.min(n, i.duration + (i.deltaPTS ? i.deltaPTS : 0));
  return i.start + i.duration - o <= u ? 1 : i.start - o > u && i.start ? -1 : 0;
}
function YH(u, n, i) {
  const o = Math.min(n, i.duration + (i.deltaPTS ? i.deltaPTS : 0)) * 1e3;
  return (i.endProgramDateTime || 0) - o > u;
}
function $k(u, n, i) {
  if (u && u.startCC <= n && u.endCC >= n) {
    let o = u.fragments;
    const { fragmentHint: l } = u;
    l && (o = o.concat(l));
    let h;
    return (
      Bk.search(o, p => (p.cc < n ? 1 : p.cc > n ? -1 : ((h = p), p.end <= i ? 1 : p.start > i ? -1 : 0))),
      h || null
    );
  }
  return null;
}
function Bg(u) {
  switch (u.details) {
    case ge.FRAG_LOAD_TIMEOUT:
    case ge.KEY_LOAD_TIMEOUT:
    case ge.LEVEL_LOAD_TIMEOUT:
    case ge.MANIFEST_LOAD_TIMEOUT:
      return !0;
  }
  return !1;
}
function Gk(u) {
  return u.details.startsWith("key");
}
function jk(u) {
  return Gk(u) && !!u.frag && !u.frag.decryptdata;
}
function q_(u, n) {
  const i = Bg(n);
  return u.default["".concat(i ? "timeout" : "error", "Retry")];
}
function hS(u, n) {
  const i = u.backoff === "linear" ? 1 : Math.pow(2, n);
  return Math.min(i * u.retryDelayMs, u.maxRetryDelayMs);
}
function Q_(u) {
  return Jt(Jt({}, u), { errorRetry: null, timeoutRetry: null });
}
function $g(u, n, i, o) {
  if (!u) return !1;
  const l = o == null ? void 0 : o.code,
    h = n < u.maxNumRetry && (XH(l) || !!i);
  return u.shouldRetry ? u.shouldRetry(u, n, i, o, h) : h;
}
function XH(u) {
  return LT(u) || (!!u && (u < 400 || u > 499));
}
function LT(u) {
  return u === 0 && navigator.onLine === !1;
}
var mi = { DoNothing: 0, SendAlternateToPenaltyBox: 2, RemoveAlternatePermanently: 3, RetryRequest: 5 },
  vr = {
    None: 0,
    MoveAllAlternatesMatchingHost: 1,
    MoveAllAlternatesMatchingHDCP: 2,
    MoveAllAlternatesMatchingKey: 4,
  };
class qH extends Pr {
  constructor(n) {
    (super("error-controller", n.logger),
      (this.hls = void 0),
      (this.playlistError = 0),
      (this.hls = n),
      this.registerListeners());
  }
  registerListeners() {
    const n = this.hls;
    (n.on(F.ERROR, this.onError, this),
      n.on(F.MANIFEST_LOADING, this.onManifestLoading, this),
      n.on(F.LEVEL_UPDATED, this.onLevelUpdated, this));
  }
  unregisterListeners() {
    const n = this.hls;
    n &&
      (n.off(F.ERROR, this.onError, this),
      n.off(F.ERROR, this.onErrorOut, this),
      n.off(F.MANIFEST_LOADING, this.onManifestLoading, this),
      n.off(F.LEVEL_UPDATED, this.onLevelUpdated, this));
  }
  destroy() {
    (this.unregisterListeners(), (this.hls = null));
  }
  startLoad(n) {}
  stopLoad() {
    this.playlistError = 0;
  }
  getVariantLevelIndex(n) {
    return (n == null ? void 0 : n.type) === Xe.MAIN ? n.level : this.getVariantIndex();
  }
  getVariantIndex() {
    var n;
    const i = this.hls,
      o = i.currentLevel;
    return ((n = i.loadLevelObj) != null && n.details) || o === -1 ? i.loadLevel : o;
  }
  variantHasKey(n, i) {
    if (n) {
      var o;
      if ((o = n.details) != null && o.hasKey(i)) return !0;
      const l = n.audioGroups;
      if (l)
        return this.hls.allAudioTracks
          .filter(p => l.indexOf(p.groupId) >= 0)
          .some(p => {
            var d;
            return (d = p.details) == null ? void 0 : d.hasKey(i);
          });
    }
    return !1;
  }
  onManifestLoading() {
    this.playlistError = 0;
  }
  onLevelUpdated() {
    this.playlistError = 0;
  }
  onError(n, i) {
    var o;
    if (i.fatal) return;
    const l = this.hls,
      h = i.context;
    switch (i.details) {
      case ge.FRAG_LOAD_ERROR:
      case ge.FRAG_LOAD_TIMEOUT:
      case ge.KEY_LOAD_ERROR:
      case ge.KEY_LOAD_TIMEOUT:
        i.errorAction = this.getFragRetryOrSwitchAction(i);
        return;
      case ge.FRAG_PARSING_ERROR:
        if ((o = i.frag) != null && o.gap) {
          i.errorAction = su();
          return;
        }
      case ge.FRAG_GAP:
      case ge.FRAG_DECRYPT_ERROR: {
        ((i.errorAction = this.getFragRetryOrSwitchAction(i)),
          (i.errorAction.action = mi.SendAlternateToPenaltyBox));
        return;
      }
      case ge.LEVEL_EMPTY_ERROR:
      case ge.LEVEL_PARSING_ERROR:
        {
          var p;
          const y = i.parent === Xe.MAIN ? i.level : l.loadLevel;
          i.details === ge.LEVEL_EMPTY_ERROR &&
          (p = i.context) != null &&
          (p = p.levelDetails) != null &&
          p.live
            ? (i.errorAction = this.getPlaylistRetryOrSwitchAction(i, y))
            : ((i.levelRetry = !1), (i.errorAction = this.getLevelSwitchAction(i, y)));
        }
        return;
      case ge.LEVEL_LOAD_ERROR:
      case ge.LEVEL_LOAD_TIMEOUT:
        typeof (h == null ? void 0 : h.level) == "number" &&
          (i.errorAction = this.getPlaylistRetryOrSwitchAction(i, h.level));
        return;
      case ge.AUDIO_TRACK_LOAD_ERROR:
      case ge.AUDIO_TRACK_LOAD_TIMEOUT:
      case ge.SUBTITLE_LOAD_ERROR:
      case ge.SUBTITLE_TRACK_LOAD_TIMEOUT:
        if (h) {
          const y = l.loadLevelObj;
          if (
            y &&
            ((h.type === Ot.AUDIO_TRACK && y.hasAudioGroup(h.groupId)) ||
              (h.type === Ot.SUBTITLE_TRACK && y.hasSubtitleGroup(h.groupId)))
          ) {
            ((i.errorAction = this.getPlaylistRetryOrSwitchAction(i, l.loadLevel)),
              (i.errorAction.action = mi.SendAlternateToPenaltyBox),
              (i.errorAction.flags = vr.MoveAllAlternatesMatchingHost));
            return;
          }
        }
        return;
      case ge.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:
        i.errorAction = { action: mi.SendAlternateToPenaltyBox, flags: vr.MoveAllAlternatesMatchingHDCP };
        return;
      case ge.KEY_SYSTEM_SESSION_UPDATE_FAILED:
      case ge.KEY_SYSTEM_STATUS_INTERNAL_ERROR:
      case ge.KEY_SYSTEM_NO_SESSION:
        i.errorAction = { action: mi.SendAlternateToPenaltyBox, flags: vr.MoveAllAlternatesMatchingKey };
        return;
      case ge.BUFFER_ADD_CODEC_ERROR:
      case ge.REMUX_ALLOC_ERROR:
      case ge.BUFFER_APPEND_ERROR:
        if (!i.errorAction) {
          var d;
          i.errorAction = this.getLevelSwitchAction(i, (d = i.level) != null ? d : l.loadLevel);
        }
        return;
      case ge.INTERNAL_EXCEPTION:
      case ge.BUFFER_APPENDING_ERROR:
      case ge.BUFFER_FULL_ERROR:
      case ge.LEVEL_SWITCH_ERROR:
      case ge.BUFFER_STALLED_ERROR:
      case ge.BUFFER_SEEK_OVER_HOLE:
      case ge.BUFFER_NUDGE_ON_STALL:
        i.errorAction = su();
        return;
    }
    i.type === et.KEY_SYSTEM_ERROR && ((i.levelRetry = !1), (i.errorAction = su()));
  }
  getPlaylistRetryOrSwitchAction(n, i) {
    const o = this.hls,
      l = q_(o.config.playlistLoadPolicy, n),
      h = this.playlistError++;
    if ($g(l, h, Bg(n), n.response))
      return { action: mi.RetryRequest, flags: vr.None, retryConfig: l, retryCount: h };
    const d = this.getLevelSwitchAction(n, i);
    return (l && ((d.retryConfig = l), (d.retryCount = h)), d);
  }
  getFragRetryOrSwitchAction(n) {
    const i = this.hls,
      o = this.getVariantLevelIndex(n.frag),
      l = i.levels[o],
      { fragLoadPolicy: h, keyLoadPolicy: p } = i.config,
      d = q_(Gk(n) ? p : h, n),
      y = i.levels.reduce((T, S) => T + S.fragmentError, 0);
    if (l && (n.details !== ge.FRAG_GAP && l.fragmentError++, !jk(n) && $g(d, y, Bg(n), n.response)))
      return { action: mi.RetryRequest, flags: vr.None, retryConfig: d, retryCount: y };
    const v = this.getLevelSwitchAction(n, o);
    return (d && ((v.retryConfig = d), (v.retryCount = y)), v);
  }
  getLevelSwitchAction(n, i) {
    const o = this.hls;
    i == null && (i = o.loadLevel);
    const l = this.hls.levels[i];
    if (l) {
      var h, p;
      const v = n.details;
      (l.loadError++, v === ge.BUFFER_APPEND_ERROR && l.fragmentError++);
      let T = -1;
      const { levels: S, loadLevel: w, minAutoLevel: C, maxAutoLevel: L } = o;
      !o.autoLevelEnabled && !o.config.preserveManualLevelOnError && (o.loadLevel = -1);
      const k = (h = n.frag) == null ? void 0 : h.type,
        B =
          ((k === Xe.AUDIO && v === ge.FRAG_PARSING_ERROR) ||
            (n.sourceBufferName === "audio" &&
              (v === ge.BUFFER_ADD_CODEC_ERROR || v === ge.BUFFER_APPEND_ERROR))) &&
          S.some(({ audioCodec: oe }) => l.audioCodec !== oe),
        $ =
          n.sourceBufferName === "video" &&
          (v === ge.BUFFER_ADD_CODEC_ERROR || v === ge.BUFFER_APPEND_ERROR) &&
          S.some(({ codecSet: oe, audioCodec: Y }) => l.codecSet !== oe && l.audioCodec === Y),
        { type: I, groupId: V } = (p = n.context) != null ? p : {};
      for (let oe = S.length; oe--; ) {
        const Y = (oe + w) % S.length;
        if (Y !== w && Y >= C && Y <= L && S[Y].loadError === 0) {
          var d, y;
          const te = S[Y];
          if (v === ge.FRAG_GAP && k === Xe.MAIN && n.frag) {
            const _ = S[Y].details;
            if (_) {
              const K = Aa(n.frag, _.fragments, n.frag.start);
              if (K != null && K.gap) continue;
            }
          } else {
            if (
              (I === Ot.AUDIO_TRACK && te.hasAudioGroup(V)) ||
              (I === Ot.SUBTITLE_TRACK && te.hasSubtitleGroup(V))
            )
              continue;
            if (
              (k === Xe.AUDIO && (d = l.audioGroups) != null && d.some(_ => te.hasAudioGroup(_))) ||
              (k === Xe.SUBTITLE && (y = l.subtitleGroups) != null && y.some(_ => te.hasSubtitleGroup(_))) ||
              (B && l.audioCodec === te.audioCodec) ||
              ($ && l.codecSet === te.codecSet) ||
              (!B && l.codecSet !== te.codecSet)
            )
              continue;
          }
          T = Y;
          break;
        }
      }
      if (T > -1 && o.loadLevel !== T)
        return (
          (n.levelRetry = !0),
          (this.playlistError = 0),
          { action: mi.SendAlternateToPenaltyBox, flags: vr.None, nextAutoLevel: T }
        );
    }
    return { action: mi.SendAlternateToPenaltyBox, flags: vr.MoveAllAlternatesMatchingHost };
  }
  onErrorOut(n, i) {
    var o;
    switch ((o = i.errorAction) == null ? void 0 : o.action) {
      case mi.DoNothing:
        break;
      case mi.SendAlternateToPenaltyBox:
        (this.sendAlternateToPenaltyBox(i),
          !i.errorAction.resolved && i.details !== ge.FRAG_GAP
            ? (i.fatal = !0)
            : /MediaSource readyState: ended/.test(i.error.message) &&
              (this.warn(
                'MediaSource ended after "'.concat(
                  i.sourceBufferName,
                  '" sourceBuffer append error. Attempting to recover from media error.',
                ),
              ),
              this.hls.recoverMediaError()));
        break;
    }
    if (i.fatal) {
      this.hls.stopLoad();
      return;
    }
  }
  sendAlternateToPenaltyBox(n) {
    const i = this.hls,
      o = n.errorAction;
    if (!o) return;
    const { flags: l } = o,
      h = o.nextAutoLevel;
    switch (l) {
      case vr.None:
        this.switchLevel(n, h);
        break;
      case vr.MoveAllAlternatesMatchingHDCP: {
        const y = this.getVariantLevelIndex(n.frag),
          v = i.levels[y],
          T = v == null ? void 0 : v.attrs["HDCP-LEVEL"];
        if (((o.hdcpLevel = T), T === "NONE")) this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");
        else if (T) {
          ((i.maxHdcpLevel = CT[CT.indexOf(T) - 1]),
            (o.resolved = !0),
            this.warn('Restricting playback to HDCP-LEVEL of "'.concat(i.maxHdcpLevel, '" or lower')));
          break;
        }
      }
      case vr.MoveAllAlternatesMatchingKey: {
        const y = n.decryptdata;
        if (y) {
          const v = this.hls.levels,
            T = v.length;
          for (let w = T; w--; )
            if (this.variantHasKey(v[w], y)) {
              var p, d;
              (this.log(
                "Banned key found in level "
                  .concat(w, " (")
                  .concat(v[w].bitrate, 'bps) or audio group "')
                  .concat((p = v[w].audioGroups) == null ? void 0 : p.join(","), '" (')
                  .concat((d = n.frag) == null ? void 0 : d.type, " fragment) ")
                  .concat(yi(y.keyId || [])),
              ),
                v[w].fragmentError++,
                v[w].loadError++,
                this.log("Removing level ".concat(w, " with key error (").concat(n.error, ")")),
                this.hls.removeLevel(w));
            }
          const S = n.frag;
          if (this.hls.levels.length < T) o.resolved = !0;
          else if (S && S.type !== Xe.MAIN) {
            const w = S.decryptdata;
            w && !y.matches(w) && (o.resolved = !0);
          }
        }
        break;
      }
    }
    o.resolved || this.switchLevel(n, h);
  }
  switchLevel(n, i) {
    if (
      i !== void 0 &&
      n.errorAction &&
      (this.warn("switching to level ".concat(i, " after ").concat(n.details)),
      (this.hls.nextAutoLevel = i),
      (n.errorAction.resolved = !0),
      (this.hls.nextLoadLevel = this.hls.nextAutoLevel),
      n.details === ge.BUFFER_ADD_CODEC_ERROR && n.mimeType && n.sourceBufferName !== "audiovideo")
    ) {
      const o = RT(n.mimeType),
        l = this.hls.levels;
      for (let h = l.length; h--; )
        l[h]["".concat(n.sourceBufferName, "Codec")] === o &&
          (this.log(
            "Removing level ".concat(h, " for ").concat(n.details, ' ("').concat(o, '" not supported)'),
          ),
          this.hls.removeLevel(h));
    }
  }
}
function su(u) {
  const n = { action: mi.DoNothing, flags: vr.None };
  return (u && (n.resolved = !0), n);
}
var ei = { NOT_LOADED: "NOT_LOADED", APPENDING: "APPENDING", PARTIAL: "PARTIAL", OK: "OK" };
class QH {
  constructor(n) {
    ((this.activePartLists = Object.create(null)),
      (this.endListFragments = Object.create(null)),
      (this.fragments = Object.create(null)),
      (this.timeRanges = Object.create(null)),
      (this.bufferPadding = 0.2),
      (this.hls = void 0),
      (this.hasGaps = !1),
      (this.hls = n),
      this._registerListeners());
  }
  _registerListeners() {
    const { hls: n } = this;
    n &&
      (n.on(F.MANIFEST_LOADING, this.onManifestLoading, this),
      n.on(F.BUFFER_APPENDED, this.onBufferAppended, this),
      n.on(F.FRAG_BUFFERED, this.onFragBuffered, this),
      n.on(F.FRAG_LOADED, this.onFragLoaded, this));
  }
  _unregisterListeners() {
    const { hls: n } = this;
    n &&
      (n.off(F.MANIFEST_LOADING, this.onManifestLoading, this),
      n.off(F.BUFFER_APPENDED, this.onBufferAppended, this),
      n.off(F.FRAG_BUFFERED, this.onFragBuffered, this),
      n.off(F.FRAG_LOADED, this.onFragLoaded, this));
  }
  destroy() {
    (this._unregisterListeners(),
      (this.hls = this.fragments = this.activePartLists = this.endListFragments = this.timeRanges = null));
  }
  getAppendedFrag(n, i) {
    const o = this.activePartLists[i];
    if (o)
      for (let l = o.length; l--; ) {
        const h = o[l];
        if (!h) break;
        if (h.start <= n && n <= h.end && h.loaded) return h;
      }
    return this.getBufferedFrag(n, i);
  }
  getBufferedFrag(n, i) {
    return this.getFragAtPos(n, i, !0);
  }
  getFragAtPos(n, i, o) {
    const { fragments: l } = this,
      h = Object.keys(l);
    for (let p = h.length; p--; ) {
      const d = l[h[p]];
      if ((d == null ? void 0 : d.body.type) === i && (!o || d.buffered)) {
        const y = d.body;
        if (y.start <= n && n <= y.end) return y;
      }
    }
    return null;
  }
  detectEvictedFragments(n, i, o, l, h) {
    this.timeRanges && (this.timeRanges[n] = i);
    const p = (l == null ? void 0 : l.fragment.sn) || -1;
    Object.keys(this.fragments).forEach(d => {
      const y = this.fragments[d];
      if (!y || p >= y.body.sn) return;
      if (!y.buffered && (!y.loaded || h)) {
        y.body.type === o && this.removeFragment(y.body);
        return;
      }
      const v = y.range[n];
      if (v) {
        if (v.time.length === 0) {
          this.removeFragment(y.body);
          return;
        }
        v.time.some(T => {
          const S = !this.isTimeBuffered(T.startPTS, T.endPTS, i);
          return (S && this.removeFragment(y.body), S);
        });
      }
    });
  }
  detectPartialFragments(n) {
    const i = this.timeRanges;
    if (!i || n.frag.sn === "initSegment") return;
    const o = n.frag,
      l = Ul(o),
      h = this.fragments[l];
    if (!h || (h.buffered && o.gap)) return;
    const p = !o.relurl;
    (Object.keys(i).forEach(d => {
      const y = o.elementaryStreams[d];
      if (!y) return;
      const v = i[d],
        T = p || y.partial === !0;
      h.range[d] = this.getBufferedTimes(o, n.part, T, v);
    }),
      (h.loaded = null),
      Object.keys(h.range).length
        ? (this.bufferedEnd(h, o), Hp(h) || this.removeParts(o.sn - 1, o.type))
        : this.removeFragment(h.body));
  }
  bufferedEnd(n, i) {
    ((n.buffered = !0),
      (n.body.endList = i.endList || n.body.endList) && (this.endListFragments[n.body.type] = n));
  }
  removeParts(n, i) {
    const o = this.activePartLists[i];
    o && (this.activePartLists[i] = J_(o, l => l.fragment.sn >= n));
  }
  fragBuffered(n, i) {
    const o = Ul(n);
    let l = this.fragments[o];
    (!l &&
      i &&
      ((l = this.fragments[o] =
        { body: n, appendedPTS: null, loaded: null, buffered: !1, range: Object.create(null) }),
      n.gap && (this.hasGaps = !0)),
      l && ((l.loaded = null), this.bufferedEnd(l, n)));
  }
  getBufferedTimes(n, i, o, l) {
    const h = { time: [], partial: o },
      p = n.start,
      d = n.end,
      y = n.minEndPTS || d,
      v = n.maxStartPTS || p;
    for (let T = 0; T < l.length; T++) {
      const S = l.start(T) - this.bufferPadding,
        w = l.end(T) + this.bufferPadding;
      if (v >= S && y <= w) {
        h.time.push({ startPTS: Math.max(p, l.start(T)), endPTS: Math.min(d, l.end(T)) });
        break;
      } else if (p < w && d > S) {
        const C = Math.max(p, l.start(T)),
          L = Math.min(d, l.end(T));
        L > C && ((h.partial = !0), h.time.push({ startPTS: C, endPTS: L }));
      } else if (d <= S) break;
    }
    return h;
  }
  getPartialFragment(n) {
    let i = null,
      o,
      l,
      h,
      p = 0;
    const { bufferPadding: d, fragments: y } = this;
    return (
      Object.keys(y).forEach(v => {
        const T = y[v];
        T &&
          Hp(T) &&
          ((l = T.body.start - d),
          (h = T.body.end + d),
          n >= l && n <= h && ((o = Math.min(n - l, h - n)), p <= o && ((i = T.body), (p = o))));
      }),
      i
    );
  }
  isEndListAppended(n) {
    const i = this.endListFragments[n];
    return i !== void 0 && (i.buffered || Hp(i));
  }
  getState(n) {
    const i = Ul(n),
      o = this.fragments[i];
    return o ? (o.buffered ? (Hp(o) ? ei.PARTIAL : ei.OK) : ei.APPENDING) : ei.NOT_LOADED;
  }
  isTimeBuffered(n, i, o) {
    let l, h;
    for (let p = 0; p < o.length; p++) {
      if (((l = o.start(p) - this.bufferPadding), (h = o.end(p) + this.bufferPadding), n >= l && i <= h))
        return !0;
      if (i <= l) return !1;
    }
    return !1;
  }
  onManifestLoading() {
    this.removeAllFragments();
  }
  onFragLoaded(n, i) {
    if (i.frag.sn === "initSegment" || i.frag.bitrateTest) return;
    const o = i.frag,
      l = i.part ? null : i,
      h = Ul(o);
    this.fragments[h] = { body: o, appendedPTS: null, loaded: l, buffered: !1, range: Object.create(null) };
  }
  onBufferAppended(n, i) {
    const { frag: o, part: l, timeRanges: h, type: p } = i;
    if (o.sn === "initSegment") return;
    const d = o.type;
    if (l) {
      let v = this.activePartLists[d];
      (v || (this.activePartLists[d] = v = []), v.push(l));
    }
    this.timeRanges = h;
    const y = h[p];
    this.detectEvictedFragments(p, y, d, l);
  }
  onFragBuffered(n, i) {
    this.detectPartialFragments(i);
  }
  hasFragment(n) {
    const i = Ul(n);
    return !!this.fragments[i];
  }
  hasFragments(n) {
    const { fragments: i } = this,
      o = Object.keys(i);
    if (!n) return o.length > 0;
    for (let l = o.length; l--; ) {
      const h = i[o[l]];
      if ((h == null ? void 0 : h.body.type) === n) return !0;
    }
    return !1;
  }
  hasParts(n) {
    var i;
    return !!((i = this.activePartLists[n]) != null && i.length);
  }
  removeFragmentsInRange(n, i, o, l, h) {
    (l && !this.hasGaps) ||
      Object.keys(this.fragments).forEach(p => {
        const d = this.fragments[p];
        if (!d) return;
        const y = d.body;
        y.type !== o ||
          (l && !y.gap) ||
          (y.start < i && y.end > n && (d.buffered || h) && this.removeFragment(y));
      });
  }
  removeFragment(n) {
    const i = Ul(n);
    n.clearElementaryStreamInfo();
    const o = this.activePartLists[n.type];
    if (o) {
      const l = n.sn;
      this.activePartLists[n.type] = J_(o, h => h.fragment.sn !== l);
    }
    (delete this.fragments[i], n.endList && delete this.endListFragments[n.type]);
  }
  removeAllFragments() {
    var n;
    ((this.fragments = Object.create(null)),
      (this.endListFragments = Object.create(null)),
      (this.activePartLists = Object.create(null)),
      (this.hasGaps = !1));
    const i = (n = this.hls) == null || (n = n.latestLevelDetails) == null ? void 0 : n.partList;
    i && i.forEach(o => o.clearElementaryStreamInfo());
  }
}
function Hp(u) {
  var n, i, o;
  return (
    u.buffered &&
    !!(
      u.body.gap ||
      ((n = u.range.video) != null && n.partial) ||
      ((i = u.range.audio) != null && i.partial) ||
      ((o = u.range.audiovideo) != null && o.partial)
    )
  );
}
function Ul(u) {
  return "".concat(u.type, "_").concat(u.level, "_").concat(u.sn);
}
function J_(u, n) {
  return u.filter(i => {
    const o = n(i);
    return (o || i.clearElementaryStreamInfo(), o);
  });
}
var No = { cbc: 0, ctr: 1 };
class JH {
  constructor(n, i, o) {
    ((this.subtle = void 0),
      (this.aesIV = void 0),
      (this.aesMode = void 0),
      (this.subtle = n),
      (this.aesIV = i),
      (this.aesMode = o));
  }
  decrypt(n, i) {
    switch (this.aesMode) {
      case No.cbc:
        return this.subtle.decrypt({ name: "AES-CBC", iv: this.aesIV }, i, n);
      case No.ctr:
        return this.subtle.decrypt({ name: "AES-CTR", counter: this.aesIV, length: 64 }, i, n);
      default:
        throw new Error("[AESCrypto] invalid aes mode ".concat(this.aesMode));
    }
  }
}
function ZH(u) {
  const n = u.byteLength,
    i = n && new DataView(u.buffer).getUint8(n - 1);
  return i ? u.slice(0, n - i) : u;
}
class eK {
  constructor() {
    ((this.rcon = [0, 1, 2, 4, 8, 16, 32, 64, 128, 27, 54]),
      (this.subMix = [
        new Uint32Array(256),
        new Uint32Array(256),
        new Uint32Array(256),
        new Uint32Array(256),
      ]),
      (this.invSubMix = [
        new Uint32Array(256),
        new Uint32Array(256),
        new Uint32Array(256),
        new Uint32Array(256),
      ]),
      (this.sBox = new Uint32Array(256)),
      (this.invSBox = new Uint32Array(256)),
      (this.key = new Uint32Array(0)),
      (this.ksRows = 0),
      (this.keySize = 0),
      (this.keySchedule = void 0),
      (this.invKeySchedule = void 0),
      this.initTable());
  }
  uint8ArrayToUint32Array_(n) {
    const i = new DataView(n),
      o = new Uint32Array(4);
    for (let l = 0; l < 4; l++) o[l] = i.getUint32(l * 4);
    return o;
  }
  initTable() {
    const n = this.sBox,
      i = this.invSBox,
      o = this.subMix,
      l = o[0],
      h = o[1],
      p = o[2],
      d = o[3],
      y = this.invSubMix,
      v = y[0],
      T = y[1],
      S = y[2],
      w = y[3],
      C = new Uint32Array(256);
    let L = 0,
      k = 0,
      O = 0;
    for (O = 0; O < 256; O++) O < 128 ? (C[O] = O << 1) : (C[O] = (O << 1) ^ 283);
    for (O = 0; O < 256; O++) {
      let B = k ^ (k << 1) ^ (k << 2) ^ (k << 3) ^ (k << 4);
      ((B = (B >>> 8) ^ (B & 255) ^ 99), (n[L] = B), (i[B] = L));
      const N = C[L],
        $ = C[N],
        I = C[$];
      let V = (C[B] * 257) ^ (B * 16843008);
      ((l[L] = (V << 24) | (V >>> 8)),
        (h[L] = (V << 16) | (V >>> 16)),
        (p[L] = (V << 8) | (V >>> 24)),
        (d[L] = V),
        (V = (I * 16843009) ^ ($ * 65537) ^ (N * 257) ^ (L * 16843008)),
        (v[B] = (V << 24) | (V >>> 8)),
        (T[B] = (V << 16) | (V >>> 16)),
        (S[B] = (V << 8) | (V >>> 24)),
        (w[B] = V),
        L ? ((L = N ^ C[C[C[I ^ N]]]), (k ^= C[C[k]])) : (L = k = 1));
    }
  }
  expandKey(n) {
    const i = this.uint8ArrayToUint32Array_(n);
    let o = !0,
      l = 0;
    for (; l < i.length && o; ) ((o = i[l] === this.key[l]), l++);
    if (o) return;
    this.key = i;
    const h = (this.keySize = i.length);
    if (h !== 4 && h !== 6 && h !== 8) throw new Error("Invalid aes key size=" + h);
    const p = (this.ksRows = (h + 6 + 1) * 4);
    let d, y;
    const v = (this.keySchedule = new Uint32Array(p)),
      T = (this.invKeySchedule = new Uint32Array(p)),
      S = this.sBox,
      w = this.rcon,
      C = this.invSubMix,
      L = C[0],
      k = C[1],
      O = C[2],
      B = C[3];
    let N, $;
    for (d = 0; d < p; d++) {
      if (d < h) {
        N = v[d] = i[d];
        continue;
      }
      (($ = N),
        d % h === 0
          ? (($ = ($ << 8) | ($ >>> 24)),
            ($ = (S[$ >>> 24] << 24) | (S[($ >>> 16) & 255] << 16) | (S[($ >>> 8) & 255] << 8) | S[$ & 255]),
            ($ ^= w[(d / h) | 0] << 24))
          : h > 6 &&
            d % h === 4 &&
            ($ = (S[$ >>> 24] << 24) | (S[($ >>> 16) & 255] << 16) | (S[($ >>> 8) & 255] << 8) | S[$ & 255]),
        (v[d] = N = (v[d - h] ^ $) >>> 0));
    }
    for (y = 0; y < p; y++)
      ((d = p - y),
        y & 3 ? ($ = v[d]) : ($ = v[d - 4]),
        y < 4 || d <= 4
          ? (T[y] = $)
          : (T[y] = L[S[$ >>> 24]] ^ k[S[($ >>> 16) & 255]] ^ O[S[($ >>> 8) & 255]] ^ B[S[$ & 255]]),
        (T[y] = T[y] >>> 0));
  }
  networkToHostOrderSwap(n) {
    return (n << 24) | ((n & 65280) << 8) | ((n & 16711680) >> 8) | (n >>> 24);
  }
  decrypt(n, i, o) {
    const l = this.keySize + 6,
      h = this.invKeySchedule,
      p = this.invSBox,
      d = this.invSubMix,
      y = d[0],
      v = d[1],
      T = d[2],
      S = d[3],
      w = this.uint8ArrayToUint32Array_(o);
    let C = w[0],
      L = w[1],
      k = w[2],
      O = w[3];
    const B = new Int32Array(n),
      N = new Int32Array(B.length);
    let $, I, V, oe, Y, te, _, K, q, ce, he, ae, ye, ve;
    const we = this.networkToHostOrderSwap;
    for (; i < B.length; ) {
      for (
        q = we(B[i]),
          ce = we(B[i + 1]),
          he = we(B[i + 2]),
          ae = we(B[i + 3]),
          Y = q ^ h[0],
          te = ae ^ h[1],
          _ = he ^ h[2],
          K = ce ^ h[3],
          ye = 4,
          ve = 1;
        ve < l;
        ve++
      )
        (($ = y[Y >>> 24] ^ v[(te >> 16) & 255] ^ T[(_ >> 8) & 255] ^ S[K & 255] ^ h[ye]),
          (I = y[te >>> 24] ^ v[(_ >> 16) & 255] ^ T[(K >> 8) & 255] ^ S[Y & 255] ^ h[ye + 1]),
          (V = y[_ >>> 24] ^ v[(K >> 16) & 255] ^ T[(Y >> 8) & 255] ^ S[te & 255] ^ h[ye + 2]),
          (oe = y[K >>> 24] ^ v[(Y >> 16) & 255] ^ T[(te >> 8) & 255] ^ S[_ & 255] ^ h[ye + 3]),
          (Y = $),
          (te = I),
          (_ = V),
          (K = oe),
          (ye = ye + 4));
      (($ =
        (p[Y >>> 24] << 24) ^ (p[(te >> 16) & 255] << 16) ^ (p[(_ >> 8) & 255] << 8) ^ p[K & 255] ^ h[ye]),
        (I =
          (p[te >>> 24] << 24) ^
          (p[(_ >> 16) & 255] << 16) ^
          (p[(K >> 8) & 255] << 8) ^
          p[Y & 255] ^
          h[ye + 1]),
        (V =
          (p[_ >>> 24] << 24) ^
          (p[(K >> 16) & 255] << 16) ^
          (p[(Y >> 8) & 255] << 8) ^
          p[te & 255] ^
          h[ye + 2]),
        (oe =
          (p[K >>> 24] << 24) ^
          (p[(Y >> 16) & 255] << 16) ^
          (p[(te >> 8) & 255] << 8) ^
          p[_ & 255] ^
          h[ye + 3]),
        (N[i] = we($ ^ C)),
        (N[i + 1] = we(oe ^ L)),
        (N[i + 2] = we(V ^ k)),
        (N[i + 3] = we(I ^ O)),
        (C = q),
        (L = ce),
        (k = he),
        (O = ae),
        (i = i + 4));
    }
    return N.buffer;
  }
}
class tK {
  constructor(n, i, o) {
    ((this.subtle = void 0),
      (this.key = void 0),
      (this.aesMode = void 0),
      (this.subtle = n),
      (this.key = i),
      (this.aesMode = o));
  }
  expandKey() {
    const n = nK(this.aesMode);
    return this.subtle.importKey("raw", this.key, { name: n }, !1, ["encrypt", "decrypt"]);
  }
}
function nK(u) {
  switch (u) {
    case No.cbc:
      return "AES-CBC";
    case No.ctr:
      return "AES-CTR";
    default:
      throw new Error("[FastAESKey] invalid aes mode ".concat(u));
  }
}
const iK = 16;
class fS {
  constructor(n, { removePKCS7Padding: i = !0 } = {}) {
    if (
      ((this.logEnabled = !0),
      (this.removePKCS7Padding = void 0),
      (this.subtle = null),
      (this.softwareDecrypter = null),
      (this.key = null),
      (this.fastAesKey = null),
      (this.remainderData = null),
      (this.currentIV = null),
      (this.currentResult = null),
      (this.useSoftware = void 0),
      (this.enableSoftwareAES = void 0),
      (this.enableSoftwareAES = n.enableSoftwareAES),
      (this.removePKCS7Padding = i),
      i)
    )
      try {
        const o = self.crypto;
        o && (this.subtle = o.subtle || o.webkitSubtle);
      } catch (o) {}
    this.useSoftware = !this.subtle;
  }
  destroy() {
    ((this.subtle = null),
      (this.softwareDecrypter = null),
      (this.key = null),
      (this.fastAesKey = null),
      (this.remainderData = null),
      (this.currentIV = null),
      (this.currentResult = null));
  }
  isSync() {
    return this.useSoftware;
  }
  flush() {
    const { currentResult: n, remainderData: i } = this;
    if (!n || i) return (this.reset(), null);
    const o = new Uint8Array(n);
    return (this.reset(), this.removePKCS7Padding ? ZH(o) : o);
  }
  reset() {
    ((this.currentResult = null),
      (this.currentIV = null),
      (this.remainderData = null),
      this.softwareDecrypter && (this.softwareDecrypter = null));
  }
  decrypt(n, i, o, l) {
    return this.useSoftware
      ? new Promise((h, p) => {
          const d = ArrayBuffer.isView(n) ? n : new Uint8Array(n);
          this.softwareDecrypt(d, i, o, l);
          const y = this.flush();
          y ? h(y.buffer) : p(new Error("[softwareDecrypt] Failed to decrypt data"));
        })
      : this.webCryptoDecrypt(new Uint8Array(n), i, o, l);
  }
  softwareDecrypt(n, i, o, l) {
    const { currentIV: h, currentResult: p, remainderData: d } = this;
    if (l !== No.cbc || i.byteLength !== 16)
      return (Zt.warn("SoftwareDecrypt: can only handle AES-128-CBC"), null);
    (this.logOnce("JS AES decrypt"), d && ((n = Mr(d, n)), (this.remainderData = null)));
    const y = this.getValidChunk(n);
    if (!y.length) return null;
    h && (o = h);
    let v = this.softwareDecrypter;
    (v || (v = this.softwareDecrypter = new eK()), v.expandKey(i));
    const T = p;
    return (
      (this.currentResult = v.decrypt(y.buffer, 0, o)),
      (this.currentIV = y.slice(-16).buffer),
      T || null
    );
  }
  webCryptoDecrypt(n, i, o, l) {
    if (this.key !== i || !this.fastAesKey) {
      if (!this.subtle) return Promise.resolve(this.onWebCryptoError(n, i, o, l));
      ((this.key = i), (this.fastAesKey = new tK(this.subtle, i, l)));
    }
    return this.fastAesKey
      .expandKey()
      .then(h =>
        this.subtle
          ? (this.logOnce("WebCrypto AES decrypt"),
            new JH(this.subtle, new Uint8Array(o), l).decrypt(n.buffer, h))
          : Promise.reject(new Error("web crypto not initialized")),
      )
      .catch(
        h => (
          Zt.warn(
            "[decrypter]: WebCrypto Error, disable WebCrypto API, ".concat(h.name, ": ").concat(h.message),
          ),
          this.onWebCryptoError(n, i, o, l)
        ),
      );
  }
  onWebCryptoError(n, i, o, l) {
    const h = this.enableSoftwareAES;
    if (h) {
      ((this.useSoftware = !0), (this.logEnabled = !0), this.softwareDecrypt(n, i, o, l));
      const p = this.flush();
      if (p) return p.buffer;
    }
    throw new Error("WebCrypto" + (h ? " and softwareDecrypt" : "") + ": failed to decrypt data");
  }
  getValidChunk(n) {
    let i = n;
    const o = n.length - (n.length % iK);
    return (o !== n.length && ((i = n.slice(0, o)), (this.remainderData = n.slice(o))), i);
  }
  logOnce(n) {
    this.logEnabled && (Zt.log("[decrypter]: ".concat(n)), (this.logEnabled = !1));
  }
}
const Z_ = Math.pow(2, 17);
class rK {
  constructor(n) {
    ((this.config = void 0), (this.loader = null), (this.partLoadTimeout = -1), (this.config = n));
  }
  destroy() {
    this.loader && (this.loader.destroy(), (this.loader = null));
  }
  abort() {
    this.loader && this.loader.abort();
  }
  load(n, i) {
    const o = n.url;
    if (!o)
      return Promise.reject(
        new Vs({
          type: et.NETWORK_ERROR,
          details: ge.FRAG_LOAD_ERROR,
          fatal: !1,
          frag: n,
          error: new Error("Fragment does not have a ".concat(o ? "part list" : "url")),
          networkDetails: null,
        }),
      );
    this.abort();
    const l = this.config,
      h = l.fLoader,
      p = l.loader;
    return new Promise((d, y) => {
      if ((this.loader && this.loader.destroy(), n.gap))
        if (n.tagList.some(L => L[0] === "GAP")) {
          y(tb(n));
          return;
        } else n.gap = !1;
      const v = (this.loader = h ? new h(l) : new p(l)),
        T = eb(n);
      n.loader = v;
      const S = Q_(l.fragLoadPolicy.default),
        w = {
          loadPolicy: S,
          timeout: S.maxLoadTimeMs,
          maxRetry: 0,
          retryDelay: 0,
          maxRetryDelay: 0,
          highWaterMark: n.sn === "initSegment" ? 1 / 0 : Z_,
        };
      n.stats = v.stats;
      const C = {
        onSuccess: (L, k, O, B) => {
          this.resetLoader(n, v);
          let N = L.data;
          (O.resetIV &&
            n.decryptdata &&
            ((n.decryptdata.iv = new Uint8Array(N.slice(0, 16))), (N = N.slice(16))),
            d({ frag: n, part: null, payload: N, networkDetails: B }));
        },
        onError: (L, k, O, B) => {
          (this.resetLoader(n, v),
            y(
              new Vs({
                type: et.NETWORK_ERROR,
                details: ge.FRAG_LOAD_ERROR,
                fatal: !1,
                frag: n,
                response: Jt({ url: o, data: void 0 }, L),
                error: new Error("HTTP Error ".concat(L.code, " ").concat(L.text)),
                networkDetails: O,
                stats: B,
              }),
            ));
        },
        onAbort: (L, k, O) => {
          (this.resetLoader(n, v),
            y(
              new Vs({
                type: et.NETWORK_ERROR,
                details: ge.INTERNAL_ABORTED,
                fatal: !1,
                frag: n,
                error: new Error("Aborted"),
                networkDetails: O,
                stats: L,
              }),
            ));
        },
        onTimeout: (L, k, O) => {
          (this.resetLoader(n, v),
            y(
              new Vs({
                type: et.NETWORK_ERROR,
                details: ge.FRAG_LOAD_TIMEOUT,
                fatal: !1,
                frag: n,
                error: new Error("Timeout after ".concat(w.timeout, "ms")),
                networkDetails: O,
                stats: L,
              }),
            ));
        },
      };
      (i && (C.onProgress = (L, k, O, B) => i({ frag: n, part: null, payload: O, networkDetails: B })),
        v.load(T, w, C));
    });
  }
  loadPart(n, i, o) {
    this.abort();
    const l = this.config,
      h = l.fLoader,
      p = l.loader;
    return new Promise((d, y) => {
      if ((this.loader && this.loader.destroy(), n.gap || i.gap)) {
        y(tb(n, i));
        return;
      }
      const v = (this.loader = h ? new h(l) : new p(l)),
        T = eb(n, i);
      n.loader = v;
      const S = Q_(l.fragLoadPolicy.default),
        w = {
          loadPolicy: S,
          timeout: S.maxLoadTimeMs,
          maxRetry: 0,
          retryDelay: 0,
          maxRetryDelay: 0,
          highWaterMark: Z_,
        };
      ((i.stats = v.stats),
        v.load(T, w, {
          onSuccess: (C, L, k, O) => {
            (this.resetLoader(n, v), this.updateStatsFromPart(n, i));
            const B = { frag: n, part: i, payload: C.data, networkDetails: O };
            (o(B), d(B));
          },
          onError: (C, L, k, O) => {
            (this.resetLoader(n, v),
              y(
                new Vs({
                  type: et.NETWORK_ERROR,
                  details: ge.FRAG_LOAD_ERROR,
                  fatal: !1,
                  frag: n,
                  part: i,
                  response: Jt({ url: T.url, data: void 0 }, C),
                  error: new Error("HTTP Error ".concat(C.code, " ").concat(C.text)),
                  networkDetails: k,
                  stats: O,
                }),
              ));
          },
          onAbort: (C, L, k) => {
            ((n.stats.aborted = i.stats.aborted),
              this.resetLoader(n, v),
              y(
                new Vs({
                  type: et.NETWORK_ERROR,
                  details: ge.INTERNAL_ABORTED,
                  fatal: !1,
                  frag: n,
                  part: i,
                  error: new Error("Aborted"),
                  networkDetails: k,
                  stats: C,
                }),
              ));
          },
          onTimeout: (C, L, k) => {
            (this.resetLoader(n, v),
              y(
                new Vs({
                  type: et.NETWORK_ERROR,
                  details: ge.FRAG_LOAD_TIMEOUT,
                  fatal: !1,
                  frag: n,
                  part: i,
                  error: new Error("Timeout after ".concat(w.timeout, "ms")),
                  networkDetails: k,
                  stats: C,
                }),
              ));
          },
        }));
    });
  }
  updateStatsFromPart(n, i) {
    const o = n.stats,
      l = i.stats,
      h = l.total;
    if (((o.loaded += l.loaded), h)) {
      const y = Math.round(n.duration / i.duration),
        v = Math.min(Math.round(o.loaded / h), y),
        S = (y - v) * Math.round(o.loaded / v);
      o.total = o.loaded + S;
    } else o.total = Math.max(o.loaded, o.total);
    const p = o.loading,
      d = l.loading;
    (p.start ? (p.first += d.first - d.start) : ((p.start = d.start), (p.first = d.first)), (p.end = d.end));
  }
  resetLoader(n, i) {
    ((n.loader = null),
      this.loader === i && (self.clearTimeout(this.partLoadTimeout), (this.loader = null)),
      i.destroy());
  }
}
function eb(u, n = null) {
  const i = n || u,
    o = {
      frag: u,
      part: n,
      responseType: "arraybuffer",
      url: i.url,
      headers: {},
      rangeStart: 0,
      rangeEnd: 0,
    },
    l = i.byteRangeStartOffset,
    h = i.byteRangeEndOffset;
  if (Ue(l) && Ue(h)) {
    var p;
    let d = l,
      y = h;
    if (u.sn === "initSegment" && sK((p = u.decryptdata) == null ? void 0 : p.method)) {
      const v = h - l;
      (v % 16 && (y = h + (16 - (v % 16))), l !== 0 && ((o.resetIV = !0), (d = l - 16)));
    }
    ((o.rangeStart = d), (o.rangeEnd = y));
  }
  return o;
}
function tb(u, n) {
  const i = new Error("GAP ".concat(u.gap ? "tag" : "attribute", " found")),
    o = { type: et.MEDIA_ERROR, details: ge.FRAG_GAP, fatal: !1, frag: u, error: i, networkDetails: null };
  return (n && (o.part = n), ((n || u).stats.aborted = !0), new Vs(o));
}
function sK(u) {
  return u === "AES-128" || u === "AES-256";
}
class Vs extends Error {
  constructor(n) {
    (super(n.error.message), (this.data = void 0), (this.data = n));
  }
}
class Vk extends Pr {
  constructor(n, i) {
    (super(n, i),
      (this._boundTick = void 0),
      (this._tickTimer = null),
      (this._tickInterval = null),
      (this._tickCallCount = 0),
      (this._boundTick = this.tick.bind(this)));
  }
  destroy() {
    (this.onHandlerDestroying(), this.onHandlerDestroyed());
  }
  onHandlerDestroying() {
    (this.clearNextTick(), this.clearInterval());
  }
  onHandlerDestroyed() {}
  hasInterval() {
    return !!this._tickInterval;
  }
  hasNextTick() {
    return !!this._tickTimer;
  }
  setInterval(n) {
    return this._tickInterval
      ? !1
      : ((this._tickCallCount = 0), (this._tickInterval = self.setInterval(this._boundTick, n)), !0);
  }
  clearInterval() {
    return this._tickInterval
      ? (self.clearInterval(this._tickInterval), (this._tickInterval = null), !0)
      : !1;
  }
  clearNextTick() {
    return this._tickTimer ? (self.clearTimeout(this._tickTimer), (this._tickTimer = null), !0) : !1;
  }
  tick() {
    (this._tickCallCount++,
      this._tickCallCount === 1 &&
        (this.doTick(), this._tickCallCount > 1 && this.tickImmediate(), (this._tickCallCount = 0)));
  }
  tickImmediate() {
    (this.clearNextTick(), (this._tickTimer = self.setTimeout(this._boundTick, 0)));
  }
  doTick() {}
}
class pS {
  constructor(n, i, o, l = 0, h = -1, p = !1) {
    ((this.level = void 0),
      (this.sn = void 0),
      (this.part = void 0),
      (this.id = void 0),
      (this.size = void 0),
      (this.partial = void 0),
      (this.transmuxing = Kp()),
      (this.buffering = { audio: Kp(), video: Kp(), audiovideo: Kp() }),
      (this.level = n),
      (this.sn = i),
      (this.id = o),
      (this.size = l),
      (this.part = h),
      (this.partial = p));
  }
}
function Kp() {
  return { start: 0, executeStart: 0, executeEnd: 0, end: 0 };
}
const nb = { length: 0, start: () => 0, end: () => 0 };
class Tt {
  static isBuffered(n, i) {
    if (n) {
      const o = Tt.getBuffered(n);
      for (let l = o.length; l--; ) if (i >= o.start(l) && i <= o.end(l)) return !0;
    }
    return !1;
  }
  static bufferedRanges(n) {
    if (n) {
      const i = Tt.getBuffered(n);
      return Tt.timeRangesToArray(i);
    }
    return [];
  }
  static timeRangesToArray(n) {
    const i = [];
    for (let o = 0; o < n.length; o++) i.push({ start: n.start(o), end: n.end(o) });
    return i;
  }
  static bufferInfo(n, i, o) {
    if (n) {
      const l = Tt.bufferedRanges(n);
      if (l.length) return Tt.bufferedInfo(l, i, o);
    }
    return { len: 0, start: i, end: i, bufferedIndex: -1 };
  }
  static bufferedInfo(n, i, o) {
    ((i = Math.max(0, i)), n.length > 1 && n.sort((T, S) => T.start - S.start || S.end - T.end));
    let l = -1,
      h = [];
    if (o)
      for (let T = 0; T < n.length; T++) {
        i >= n[T].start && i <= n[T].end && (l = T);
        const S = h.length;
        if (S) {
          const w = h[S - 1].end;
          n[T].start - w < o ? n[T].end > w && (h[S - 1].end = n[T].end) : h.push(n[T]);
        } else h.push(n[T]);
      }
    else h = n;
    let p = 0,
      d,
      y = i,
      v = i;
    for (let T = 0; T < h.length; T++) {
      const S = h[T].start,
        w = h[T].end;
      if ((l === -1 && i >= S && i <= w && (l = T), i + o >= S && i < w)) ((y = S), (v = w), (p = v - i));
      else if (i + o < S) {
        d = S;
        break;
      }
    }
    return { len: p, start: y || 0, end: v || 0, nextStart: d, buffered: n, bufferedIndex: l };
  }
  static getBuffered(n) {
    try {
      return n.buffered || nb;
    } catch (i) {
      return (Zt.log("failed to get media.buffered", i), nb);
    }
  }
}
const Hk = /\{\$([a-zA-Z0-9-_]+)\}/g;
function ib(u) {
  return Hk.test(u);
}
function _T(u, n) {
  if (u.variableList !== null || u.hasVariableRefs) {
    const i = u.variableList;
    return n.replace(Hk, o => {
      const l = o.substring(2, o.length - 1),
        h = i == null ? void 0 : i[l];
      return h === void 0
        ? (u.playlistParsingError ||
            (u.playlistParsingError = new Error(
              'Missing preceding EXT-X-DEFINE tag for Variable Reference: "'.concat(l, '"'),
            )),
          o)
        : h;
    });
  }
  return n;
}
function rb(u, n, i) {
  let o = u.variableList;
  o || (u.variableList = o = {});
  let l, h;
  if ("QUERYPARAM" in n) {
    l = n.QUERYPARAM;
    try {
      const p = new self.URL(i).searchParams;
      if (p.has(l)) h = p.get(l);
      else throw new Error('"'.concat(l, '" does not match any query parameter in URI: "').concat(i, '"'));
    } catch (p) {
      u.playlistParsingError ||
        (u.playlistParsingError = new Error("EXT-X-DEFINE QUERYPARAM: ".concat(p.message)));
    }
  } else ((l = n.NAME), (h = n.VALUE));
  l in o
    ? u.playlistParsingError ||
      (u.playlistParsingError = new Error(
        'EXT-X-DEFINE duplicate Variable Name declarations: "'.concat(l, '"'),
      ))
    : (o[l] = h || "");
}
function oK(u, n, i) {
  const o = n.IMPORT;
  if (i && o in i) {
    let l = u.variableList;
    (l || (u.variableList = l = {}), (l[o] = i[o]));
  } else
    u.playlistParsingError ||
      (u.playlistParsingError = new Error(
        'EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "'.concat(o, '"'),
      ));
}
const aK = /^(\d+)x(\d+)$/,
  sb = /(.+?)=(".*?"|.*?)(?:,|$)/g;
class In {
  constructor(n, i) {
    (typeof n == "string" && (n = In.parseAttrList(n, i)), rn(this, n));
  }
  get clientAttrs() {
    return Object.keys(this).filter(n => n.substring(0, 2) === "X-");
  }
  decimalInteger(n) {
    const i = parseInt(this[n], 10);
    return i > Number.MAX_SAFE_INTEGER ? 1 / 0 : i;
  }
  hexadecimalInteger(n) {
    if (this[n]) {
      let i = (this[n] || "0x").slice(2);
      i = (i.length & 1 ? "0" : "") + i;
      const o = new Uint8Array(i.length / 2);
      for (let l = 0; l < i.length / 2; l++) o[l] = parseInt(i.slice(l * 2, l * 2 + 2), 16);
      return o;
    }
    return null;
  }
  hexadecimalIntegerAsNumber(n) {
    const i = parseInt(this[n], 16);
    return i > Number.MAX_SAFE_INTEGER ? 1 / 0 : i;
  }
  decimalFloatingPoint(n) {
    return parseFloat(this[n]);
  }
  optionalFloat(n, i) {
    const o = this[n];
    return o ? parseFloat(o) : i;
  }
  enumeratedString(n) {
    return this[n];
  }
  enumeratedStringList(n, i) {
    const o = this[n];
    return (o ? o.split(/[ ,]+/) : []).reduce((l, h) => ((l[h.toLowerCase()] = !0), l), i);
  }
  bool(n) {
    return this[n] === "YES";
  }
  decimalResolution(n) {
    const i = aK.exec(this[n]);
    if (i !== null) return { width: parseInt(i[1], 10), height: parseInt(i[2], 10) };
  }
  static parseAttrList(n, i) {
    let o;
    const l = {};
    for (sb.lastIndex = 0; (o = sb.exec(n)) !== null; ) {
      const p = o[1].trim();
      let d = o[2];
      const y = d.indexOf('"') === 0 && d.lastIndexOf('"') === d.length - 1;
      let v = !1;
      if (y) d = d.slice(1, -1);
      else
        switch (p) {
          case "IV":
          case "SCTE35-CMD":
          case "SCTE35-IN":
          case "SCTE35-OUT":
            v = !0;
        }
      if (i && (y || v)) d = _T(i, d);
      else if (!v && !y)
        switch (p) {
          case "CLOSED-CAPTIONS":
            if (d === "NONE") break;
          case "ALLOWED-CPC":
          case "CLASS":
          case "ASSOC-LANGUAGE":
          case "AUDIO":
          case "BYTERANGE":
          case "CHANNELS":
          case "CHARACTERISTICS":
          case "CODECS":
          case "DATA-ID":
          case "END-DATE":
          case "GROUP-ID":
          case "ID":
          case "IMPORT":
          case "INSTREAM-ID":
          case "KEYFORMAT":
          case "KEYFORMATVERSIONS":
          case "LANGUAGE":
          case "NAME":
          case "PATHWAY-ID":
          case "QUERYPARAM":
          case "RECENTLY-REMOVED-DATERANGES":
          case "SERVER-URI":
          case "STABLE-RENDITION-ID":
          case "STABLE-VARIANT-ID":
          case "START-DATE":
          case "SUBTITLES":
          case "SUPPLEMENTAL-CODECS":
          case "URI":
          case "VALUE":
          case "VIDEO":
          case "X-ASSET-LIST":
          case "X-ASSET-URI":
            Zt.warn("".concat(n, ": attribute ").concat(p, " is missing quotes"));
        }
      l[p] = d;
    }
    return l;
  }
}
const lK = "com.apple.hls.interstitial";
function uK(u) {
  return (
    u !== "ID" &&
    u !== "CLASS" &&
    u !== "CUE" &&
    u !== "START-DATE" &&
    u !== "DURATION" &&
    u !== "END-DATE" &&
    u !== "END-ON-NEXT"
  );
}
function cK(u) {
  return u === "SCTE35-OUT" || u === "SCTE35-IN" || u === "SCTE35-CMD";
}
class Kk {
  constructor(n, i, o = 0) {
    var l;
    if (
      ((this.attr = void 0),
      (this.tagAnchor = void 0),
      (this.tagOrder = void 0),
      (this._startDate = void 0),
      (this._endDate = void 0),
      (this._dateAtEnd = void 0),
      (this._cue = void 0),
      (this._badValueForSameId = void 0),
      (this.tagAnchor = (i == null ? void 0 : i.tagAnchor) || null),
      (this.tagOrder = (l = i == null ? void 0 : i.tagOrder) != null ? l : o),
      i)
    ) {
      const h = i.attr;
      for (const p in h)
        if (Object.prototype.hasOwnProperty.call(n, p) && n[p] !== h[p]) {
          (Zt.warn(
            'DATERANGE tag attribute: "'.concat(p, '" does not match for tags with ID: "').concat(n.ID, '"'),
          ),
            (this._badValueForSameId = p));
          break;
        }
      n = rn(new In({}), h, n);
    }
    if (
      ((this.attr = n),
      i
        ? ((this._startDate = i._startDate),
          (this._cue = i._cue),
          (this._endDate = i._endDate),
          (this._dateAtEnd = i._dateAtEnd))
        : (this._startDate = new Date(n["START-DATE"])),
      "END-DATE" in this.attr)
    ) {
      const h = (i == null ? void 0 : i.endDate) || new Date(this.attr["END-DATE"]);
      Ue(h.getTime()) && (this._endDate = h);
    }
  }
  get id() {
    return this.attr.ID;
  }
  get class() {
    return this.attr.CLASS;
  }
  get cue() {
    const n = this._cue;
    return n === void 0
      ? (this._cue = this.attr.enumeratedStringList(this.attr.CUE ? "CUE" : "X-CUE", {
          pre: !1,
          post: !1,
          once: !1,
        }))
      : n;
  }
  get startTime() {
    const { tagAnchor: n } = this;
    return n === null || n.programDateTime === null
      ? (Zt.warn('Expected tagAnchor Fragment with PDT set for DateRange "'.concat(this.id, '": ').concat(n)),
        NaN)
      : n.start + (this.startDate.getTime() - n.programDateTime) / 1e3;
  }
  get startDate() {
    return this._startDate;
  }
  get endDate() {
    const n = this._endDate || this._dateAtEnd;
    if (n) return n;
    const i = this.duration;
    return i !== null ? (this._dateAtEnd = new Date(this._startDate.getTime() + i * 1e3)) : null;
  }
  get duration() {
    if ("DURATION" in this.attr) {
      const n = this.attr.decimalFloatingPoint("DURATION");
      if (Ue(n)) return n;
    } else if (this._endDate) return (this._endDate.getTime() - this._startDate.getTime()) / 1e3;
    return null;
  }
  get plannedDuration() {
    return "PLANNED-DURATION" in this.attr ? this.attr.decimalFloatingPoint("PLANNED-DURATION") : null;
  }
  get endOnNext() {
    return this.attr.bool("END-ON-NEXT");
  }
  get isInterstitial() {
    return this.class === lK;
  }
  get isValid() {
    return (
      !!this.id &&
      !this._badValueForSameId &&
      Ue(this.startDate.getTime()) &&
      (this.duration === null || this.duration >= 0) &&
      (!this.endOnNext || !!this.class) &&
      (!this.attr.CUE || (!this.cue.pre && !this.cue.post) || this.cue.pre !== this.cue.post) &&
      (!this.isInterstitial || "X-ASSET-URI" in this.attr || "X-ASSET-LIST" in this.attr)
    );
  }
}
const dK = 10;
class hK {
  constructor(n) {
    ((this.PTSKnown = !1),
      (this.alignedSliding = !1),
      (this.averagetargetduration = void 0),
      (this.endCC = 0),
      (this.endSN = 0),
      (this.fragments = void 0),
      (this.fragmentHint = void 0),
      (this.partList = null),
      (this.dateRanges = void 0),
      (this.dateRangeTagCount = 0),
      (this.live = !0),
      (this.requestScheduled = -1),
      (this.ageHeader = 0),
      (this.advancedDateTime = void 0),
      (this.updated = !0),
      (this.advanced = !0),
      (this.misses = 0),
      (this.startCC = 0),
      (this.startSN = 0),
      (this.startTimeOffset = null),
      (this.targetduration = 0),
      (this.totalduration = 0),
      (this.type = null),
      (this.url = void 0),
      (this.m3u8 = ""),
      (this.version = null),
      (this.canBlockReload = !1),
      (this.canSkipUntil = 0),
      (this.canSkipDateRanges = !1),
      (this.skippedSegments = 0),
      (this.recentlyRemovedDateranges = void 0),
      (this.partHoldBack = 0),
      (this.holdBack = 0),
      (this.partTarget = 0),
      (this.preloadHint = void 0),
      (this.renditionReports = void 0),
      (this.tuneInGoal = 0),
      (this.deltaUpdateFailed = void 0),
      (this.driftStartTime = 0),
      (this.driftEndTime = 0),
      (this.driftStart = 0),
      (this.driftEnd = 0),
      (this.encryptedFragments = void 0),
      (this.playlistParsingError = null),
      (this.variableList = null),
      (this.hasVariableRefs = !1),
      (this.appliedTimelineOffset = void 0),
      (this.fragments = []),
      (this.encryptedFragments = []),
      (this.dateRanges = {}),
      (this.url = n));
  }
  reloaded(n) {
    if (!n) {
      ((this.advanced = !0), (this.updated = !0));
      return;
    }
    const i = this.lastPartSn - n.lastPartSn,
      o = this.lastPartIndex - n.lastPartIndex;
    ((this.updated = this.endSN !== n.endSN || !!o || !!i || !this.live),
      (this.advanced = this.endSN > n.endSN || i > 0 || (i === 0 && o > 0)),
      this.updated || this.advanced
        ? (this.misses = Math.floor(n.misses * 0.6))
        : (this.misses = n.misses + 1));
  }
  hasKey(n) {
    return this.encryptedFragments.some(i => {
      let o = i.decryptdata;
      return (o || (i.setKeyFormat(n.keyFormat), (o = i.decryptdata)), !!o && n.matches(o));
    });
  }
  get hasProgramDateTime() {
    return this.fragments.length ? Ue(this.fragments[this.fragments.length - 1].programDateTime) : !1;
  }
  get levelTargetDuration() {
    return this.averagetargetduration || this.targetduration || dK;
  }
  get drift() {
    const n = this.driftEndTime - this.driftStartTime;
    return n > 0 ? ((this.driftEnd - this.driftStart) * 1e3) / n : 1;
  }
  get edge() {
    return this.partEnd || this.fragmentEnd;
  }
  get partEnd() {
    var n;
    return (n = this.partList) != null && n.length
      ? this.partList[this.partList.length - 1].end
      : this.fragmentEnd;
  }
  get fragmentEnd() {
    return this.fragments.length ? this.fragments[this.fragments.length - 1].end : 0;
  }
  get fragmentStart() {
    return this.fragments.length ? this.fragments[0].start : 0;
  }
  get age() {
    return this.advancedDateTime ? Math.max(Date.now() - this.advancedDateTime, 0) / 1e3 : 0;
  }
  get lastPartIndex() {
    var n;
    return (n = this.partList) != null && n.length ? this.partList[this.partList.length - 1].index : -1;
  }
  get maxPartIndex() {
    const n = this.partList;
    if (n) {
      const i = this.lastPartIndex;
      if (i !== -1) {
        for (let o = n.length; o--; ) if (n[o].index > i) return n[o].index;
        return i;
      }
    }
    return 0;
  }
  get lastPartSn() {
    var n;
    return (n = this.partList) != null && n.length
      ? this.partList[this.partList.length - 1].fragment.sn
      : this.endSN;
  }
  get expired() {
    if (this.live && this.age && this.misses < 3) {
      const n = this.partEnd - this.fragmentStart;
      return this.age > Math.max(n, this.totalduration) + this.levelTargetDuration;
    }
    return !1;
  }
}
function Gg(u, n) {
  return u.length === n.length ? !u.some((i, o) => i !== n[o]) : !1;
}
function ob(u, n) {
  return !u && !n ? !0 : !u || !n ? !1 : Gg(u, n);
}
function ou(u) {
  return u === "AES-128" || u === "AES-256" || u === "AES-256-CTR";
}
function gS(u) {
  switch (u) {
    case "AES-128":
    case "AES-256":
      return No.cbc;
    case "AES-256-CTR":
      return No.ctr;
    default:
      throw new Error("invalid full segment method ".concat(u));
  }
}
function mS(u) {
  return Uint8Array.from(atob(u), n => n.charCodeAt(0));
}
function bT(u) {
  return Uint8Array.from(unescape(encodeURIComponent(u)), n => n.charCodeAt(0));
}
function fK(u) {
  const n = bT(u).subarray(0, 16),
    i = new Uint8Array(16);
  return (i.set(n, 16 - n.length), i);
}
function Wk(u) {
  const n = function (o, l, h) {
    const p = o[l];
    ((o[l] = o[h]), (o[h] = p));
  };
  (n(u, 0, 3), n(u, 1, 2), n(u, 4, 5), n(u, 6, 7));
}
function zk(u) {
  const n = u.split(":");
  let i = null;
  if (n[0] === "data" && n.length === 2) {
    const o = n[1].split(";"),
      l = o[o.length - 1].split(",");
    if (l.length === 2) {
      const h = l[0] === "base64",
        p = l[1];
      h ? (o.splice(-1, 1), (i = mS(p))) : (i = fK(p));
    }
  }
  return i;
}
const jg = typeof self < "u" ? self : void 0;
var wn = {
    CLEARKEY: "org.w3.clearkey",
    FAIRPLAY: "com.apple.fps",
    PLAYREADY: "com.microsoft.playready",
    WIDEVINE: "com.widevine.alpha",
  },
  vi = {
    CLEARKEY: "org.w3.clearkey",
    FAIRPLAY: "com.apple.streamingkeydelivery",
    PLAYREADY: "com.microsoft.playready",
    WIDEVINE: "urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",
  };
function gg(u) {
  switch (u) {
    case vi.FAIRPLAY:
      return wn.FAIRPLAY;
    case vi.PLAYREADY:
      return wn.PLAYREADY;
    case vi.WIDEVINE:
      return wn.WIDEVINE;
    case vi.CLEARKEY:
      return wn.CLEARKEY;
  }
}
function bx(u) {
  switch (u) {
    case wn.FAIRPLAY:
      return vi.FAIRPLAY;
    case wn.PLAYREADY:
      return vi.PLAYREADY;
    case wn.WIDEVINE:
      return vi.WIDEVINE;
    case wn.CLEARKEY:
      return vi.CLEARKEY;
  }
}
function rd(u) {
  const { drmSystems: n, widevineLicenseUrl: i } = u,
    o = n ? [wn.FAIRPLAY, wn.WIDEVINE, wn.PLAYREADY, wn.CLEARKEY].filter(l => !!n[l]) : [];
  return (!o[wn.WIDEVINE] && i && o.push(wn.WIDEVINE), o);
}
const Yk = (function (u) {
  return jg != null && (u = jg.navigator) != null && u.requestMediaKeySystemAccess
    ? self.navigator.requestMediaKeySystemAccess.bind(self.navigator)
    : null;
})();
function pK(u, n, i, o) {
  let l;
  switch (u) {
    case wn.FAIRPLAY:
      l = ["cenc", "sinf"];
      break;
    case wn.WIDEVINE:
    case wn.PLAYREADY:
      l = ["cenc"];
      break;
    case wn.CLEARKEY:
      l = ["cenc", "keyids"];
      break;
    default:
      throw new Error("Unknown key-system: ".concat(u));
  }
  return gK(l, n, i, o);
}
function gK(u, n, i, o) {
  return [
    {
      initDataTypes: u,
      persistentState: o.persistentState || "optional",
      distinctiveIdentifier: o.distinctiveIdentifier || "optional",
      sessionTypes: o.sessionTypes || [o.sessionType || "temporary"],
      audioCapabilities: n.map(h => ({
        contentType: "audio/mp4; codecs=".concat(h),
        robustness: o.audioRobustness || "",
        encryptionScheme: o.audioEncryptionScheme || null,
      })),
      videoCapabilities: i.map(h => ({
        contentType: "video/mp4; codecs=".concat(h),
        robustness: o.videoRobustness || "",
        encryptionScheme: o.videoEncryptionScheme || null,
      })),
    },
  ];
}
function mK(u) {
  var n;
  return (
    !!u &&
    (u.sessionType === "persistent-license" ||
      !!((n = u.sessionTypes) != null && n.some(i => i === "persistent-license")))
  );
}
function Xk(u) {
  const n = new Uint16Array(u.buffer, u.byteOffset, u.byteLength / 2),
    i = String.fromCharCode.apply(null, Array.from(n)),
    o = i.substring(i.indexOf("<"), i.length),
    p = new DOMParser().parseFromString(o, "text/xml").getElementsByTagName("KID")[0];
  if (p) {
    const d = p.childNodes[0] ? p.childNodes[0].nodeValue : p.getAttribute("VALUE");
    if (d) {
      const y = mS(d).subarray(0, 16);
      return (Wk(y), y);
    }
  }
  return null;
}
let Bl = {};
class Mo {
  static clearKeyUriToKeyIdMap() {
    Bl = {};
  }
  static setKeyIdForUri(n, i) {
    Bl[n] = i;
  }
  static addKeyIdForUri(n) {
    const i = Object.keys(Bl).length % Number.MAX_SAFE_INTEGER,
      o = new Uint8Array(16);
    return (new DataView(o.buffer, 12, 4).setUint32(0, i), (Bl[n] = o), o);
  }
  constructor(n, i, o, l = [1], h = null, p) {
    ((this.uri = void 0),
      (this.method = void 0),
      (this.keyFormat = void 0),
      (this.keyFormatVersions = void 0),
      (this.encrypted = void 0),
      (this.isCommonEncryption = void 0),
      (this.iv = null),
      (this.key = null),
      (this.keyId = null),
      (this.pssh = null),
      (this.method = n),
      (this.uri = i),
      (this.keyFormat = o),
      (this.keyFormatVersions = l),
      (this.iv = h),
      (this.encrypted = n ? n !== "NONE" : !1),
      (this.isCommonEncryption = this.encrypted && !ou(n)),
      p != null && p.startsWith("0x") && (this.keyId = new Uint8Array(Ak(p))));
  }
  matches(n) {
    return (
      n.uri === this.uri &&
      n.method === this.method &&
      n.encrypted === this.encrypted &&
      n.keyFormat === this.keyFormat &&
      Gg(n.keyFormatVersions, this.keyFormatVersions) &&
      ob(n.iv, this.iv) &&
      ob(n.keyId, this.keyId)
    );
  }
  isSupported() {
    if (this.method) {
      if (ou(this.method) || this.method === "NONE") return !0;
      if (this.keyFormat === "identity") return this.method === "SAMPLE-AES";
      switch (this.keyFormat) {
        case vi.FAIRPLAY:
        case vi.WIDEVINE:
        case vi.PLAYREADY:
        case vi.CLEARKEY:
          return ["SAMPLE-AES", "SAMPLE-AES-CENC", "SAMPLE-AES-CTR"].indexOf(this.method) !== -1;
      }
    }
    return !1;
  }
  getDecryptData(n, i) {
    if (!this.encrypted || !this.uri) return null;
    if (ou(this.method)) {
      let h = this.iv;
      return (
        h ||
          (typeof n != "number" &&
            (Zt.warn(
              'missing IV for initialization segment with method="'.concat(
                this.method,
                '" - compliance issue',
              ),
            ),
            (n = 0)),
          (h = vK(n))),
        new Mo(this.method, this.uri, "identity", this.keyFormatVersions, h)
      );
    }
    if (this.keyId) {
      const h = Bl[this.uri];
      if ((h && !Gg(this.keyId, h) && Mo.setKeyIdForUri(this.uri, this.keyId), this.pssh)) return this;
    }
    const o = zk(this.uri);
    if (o)
      switch (this.keyFormat) {
        case vi.WIDEVINE:
          if (((this.pssh = o), !this.keyId)) {
            const h = SH(o.buffer);
            if (h.length) {
              var l;
              const p = h[0];
              this.keyId = (l = p.kids) != null && l.length ? p.kids[0] : null;
            }
          }
          this.keyId || (this.keyId = ab(i));
          break;
        case vi.PLAYREADY: {
          const h = new Uint8Array([
            154, 4, 240, 121, 152, 64, 66, 134, 171, 146, 230, 91, 224, 136, 95, 149,
          ]);
          ((this.pssh = TH(h, null, o)), (this.keyId = Xk(o)));
          break;
        }
        default: {
          let h = o.subarray(0, 16);
          if (h.length !== 16) {
            const p = new Uint8Array(16);
            (p.set(h, 16 - h.length), (h = p));
          }
          this.keyId = h;
          break;
        }
      }
    if (!this.keyId || this.keyId.byteLength !== 16) {
      let h;
      ((h = yK(i)),
        h || ((h = ab(i)), h || (h = Bl[this.uri])),
        h && ((this.keyId = h), Mo.setKeyIdForUri(this.uri, h)));
    }
    return this;
  }
}
function yK(u) {
  const n = u == null ? void 0 : u[vi.WIDEVINE];
  return n ? n.keyId : null;
}
function ab(u) {
  const n = u == null ? void 0 : u[vi.PLAYREADY];
  if (n) {
    const i = zk(n.uri);
    if (i) return Xk(i);
  }
  return null;
}
function vK(u) {
  const n = new Uint8Array(16);
  for (let i = 12; i < 16; i++) n[i] = (u >> (8 * (15 - i))) & 255;
  return n;
}
const lb =
    /#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,
  ub = /#EXT-X-MEDIA:(.*)/g,
  xK = /^#EXT(?:INF|-X-TARGETDURATION):/m,
  Dx = new RegExp(
    [/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source, /(?!#) *(\S[^\r\n]*)/.source, /#.*/.source].join("|"),
    "g",
  ),
  TK = new RegExp(
    [
      /#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/
        .source,
      /#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,
      /#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,
      /(#)([^:]*):(.*)/.source,
      /(#)(.*)(?:.*)\r?\n?/.source,
    ].join("|"),
  );
class us {
  static findGroup(n, i) {
    for (let o = 0; o < n.length; o++) {
      const l = n[o];
      if (l.id === i) return l;
    }
  }
  static resolve(n, i) {
    return aS.buildAbsoluteURL(i, n, { alwaysNormalize: !0 });
  }
  static isMediaPlaylist(n) {
    return xK.test(n);
  }
  static parseMasterPlaylist(n, i) {
    const o = ib(n),
      l = {
        contentSteering: null,
        levels: [],
        playlistParsingError: null,
        sessionData: null,
        sessionKeys: null,
        startTimeOffset: null,
        variableList: null,
        hasVariableRefs: o,
      },
      h = [];
    if (((lb.lastIndex = 0), !n.startsWith("#EXTM3U")))
      return ((l.playlistParsingError = new Error("no EXTM3U delimiter")), l);
    let p;
    for (; (p = lb.exec(n)) != null; )
      if (p[1]) {
        var d;
        const v = new In(p[1], l),
          T = _T(l, p[2]),
          S = {
            attrs: v,
            bitrate: v.decimalInteger("BANDWIDTH") || v.decimalInteger("AVERAGE-BANDWIDTH"),
            name: v.NAME,
            url: us.resolve(T, i),
          },
          w = v.decimalResolution("RESOLUTION");
        (w && ((S.width = w.width), (S.height = w.height)), hb(v.CODECS, S));
        const C = v["SUPPLEMENTAL-CODECS"];
        (C && ((S.supplemental = {}), hb(C, S.supplemental)),
          ((d = S.unknownCodecs) != null && d.length) || h.push(S),
          l.levels.push(S));
      } else if (p[3]) {
        const v = p[3],
          T = p[4];
        switch (v) {
          case "SESSION-DATA": {
            const S = new In(T, l),
              w = S["DATA-ID"];
            w && (l.sessionData === null && (l.sessionData = {}), (l.sessionData[w] = S));
            break;
          }
          case "SESSION-KEY": {
            const S = cb(T, i, l);
            S.encrypted && S.isSupported()
              ? (l.sessionKeys === null && (l.sessionKeys = []), l.sessionKeys.push(S))
              : Zt.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'.concat(T, '"'));
            break;
          }
          case "DEFINE": {
            {
              const S = new In(T, l);
              rb(l, S, i);
            }
            break;
          }
          case "CONTENT-STEERING": {
            const S = new In(T, l);
            l.contentSteering = { uri: us.resolve(S["SERVER-URI"], i), pathwayId: S["PATHWAY-ID"] || "." };
            break;
          }
          case "START": {
            l.startTimeOffset = db(T);
            break;
          }
        }
      }
    const y = h.length > 0 && h.length < l.levels.length;
    return (
      (l.levels = y ? h : l.levels),
      l.levels.length === 0 && (l.playlistParsingError = new Error("no levels found in manifest")),
      l
    );
  }
  static parseMasterPlaylistMedia(n, i, o) {
    let l;
    const h = {},
      p = o.levels,
      d = {
        AUDIO: p.map(v => ({ id: v.attrs.AUDIO, audioCodec: v.audioCodec })),
        SUBTITLES: p.map(v => ({ id: v.attrs.SUBTITLES, textCodec: v.textCodec })),
        "CLOSED-CAPTIONS": [],
      };
    let y = 0;
    for (ub.lastIndex = 0; (l = ub.exec(n)) !== null; ) {
      const v = new In(l[1], o),
        T = v.TYPE;
      if (T) {
        const S = d[T],
          w = h[T] || [];
        h[T] = w;
        const C = v.LANGUAGE,
          L = v["ASSOC-LANGUAGE"],
          k = v.CHANNELS,
          O = v.CHARACTERISTICS,
          B = v["INSTREAM-ID"],
          N = {
            attrs: v,
            bitrate: 0,
            id: y++,
            groupId: v["GROUP-ID"] || "",
            name: v.NAME || C || "",
            type: T,
            default: v.bool("DEFAULT"),
            autoselect: v.bool("AUTOSELECT"),
            forced: v.bool("FORCED"),
            lang: C,
            url: v.URI ? us.resolve(v.URI, i) : "",
          };
        if (
          (L && (N.assocLang = L),
          k && (N.channels = k),
          O && (N.characteristics = O),
          B && (N.instreamId = B),
          S != null && S.length)
        ) {
          const $ = us.findGroup(S, N.groupId) || S[0];
          (fb(N, $, "audioCodec"), fb(N, $, "textCodec"));
        }
        w.push(N);
      }
    }
    return h;
  }
  static parseLevelPlaylist(n, i, o, l, h, p) {
    var d;
    const y = { url: i },
      v = new hK(i),
      T = v.fragments,
      S = [];
    let w = null,
      C = 0,
      L = 0,
      k = 0,
      O = 0,
      B = 0,
      N = null,
      $ = new Cx(l, y),
      I,
      V,
      oe,
      Y = -1,
      te = !1,
      _ = null,
      K;
    if (
      ((Dx.lastIndex = 0),
      (v.m3u8 = n),
      (v.hasVariableRefs = ib(n)),
      ((d = Dx.exec(n)) == null ? void 0 : d[0]) !== "#EXTM3U")
    )
      return ((v.playlistParsingError = new Error("Missing format identifier #EXTM3U")), v);
    for (; (I = Dx.exec(n)) !== null; ) {
      te &&
        ((te = !1),
        ($ = new Cx(l, y)),
        ($.playlistOffset = k),
        $.setStart(k),
        ($.sn = C),
        ($.cc = O),
        B && ($.bitrate = B),
        ($.level = o),
        w &&
          (($.initSegment = w),
          w.rawProgramDateTime &&
            (($.rawProgramDateTime = w.rawProgramDateTime), (w.rawProgramDateTime = null)),
          _ && ($.setByteRange(_), (_ = null))));
      const ae = I[1];
      if (ae) {
        $.duration = parseFloat(ae);
        const ye = (" " + I[2]).slice(1);
        (($.title = ye || null), $.tagList.push(ye ? ["INF", ae, ye] : ["INF", ae]));
      } else if (I[3]) {
        if (Ue($.duration)) {
          (($.playlistOffset = k),
            $.setStart(k),
            oe && gb($, oe, v),
            ($.sn = C),
            ($.level = o),
            ($.cc = O),
            T.push($));
          const ye = (" " + I[3]).slice(1);
          (($.relurl = _T(v, ye)), DT($, N, S), (N = $), (k += $.duration), C++, (L = 0), (te = !0));
        }
      } else {
        if (((I = I[0].match(TK)), !I)) {
          Zt.warn("No matches on slow regex match for level playlist!");
          continue;
        }
        for (V = 1; V < I.length && I[V] === void 0; V++);
        const ye = (" " + I[V]).slice(1),
          ve = (" " + I[V + 1]).slice(1),
          we = I[V + 2] ? (" " + I[V + 2]).slice(1) : null;
        switch (ye) {
          case "BYTERANGE":
            N ? $.setByteRange(ve, N) : $.setByteRange(ve);
            break;
          case "PROGRAM-DATE-TIME":
            (($.rawProgramDateTime = ve),
              $.tagList.push(["PROGRAM-DATE-TIME", ve]),
              Y === -1 && (Y = T.length));
            break;
          case "PLAYLIST-TYPE":
            (v.type && $s(v, ye, I), (v.type = ve.toUpperCase()));
            break;
          case "MEDIA-SEQUENCE":
            (v.startSN !== 0 ? $s(v, ye, I) : T.length > 0 && mb(v, ye, I), (C = v.startSN = parseInt(ve)));
            break;
          case "SKIP": {
            v.skippedSegments && $s(v, ye, I);
            const Le = new In(ve, v),
              ke = Le.decimalInteger("SKIPPED-SEGMENTS");
            if (Ue(ke)) {
              v.skippedSegments += ke;
              for (let Re = ke; Re--; ) T.push(null);
              C += ke;
            }
            const Ne = Le.enumeratedString("RECENTLY-REMOVED-DATERANGES");
            Ne && (v.recentlyRemovedDateranges = (v.recentlyRemovedDateranges || []).concat(Ne.split("	")));
            break;
          }
          case "TARGETDURATION":
            (v.targetduration !== 0 && $s(v, ye, I), (v.targetduration = Math.max(parseInt(ve), 1)));
            break;
          case "VERSION":
            (v.version !== null && $s(v, ye, I), (v.version = parseInt(ve)));
            break;
          case "INDEPENDENT-SEGMENTS":
            break;
          case "ENDLIST":
            (v.live || $s(v, ye, I), (v.live = !1));
            break;
          case "#":
            (ve || we) && $.tagList.push(we ? [ve, we] : [ve]);
            break;
          case "DISCONTINUITY":
            (O++, $.tagList.push(["DIS"]));
            break;
          case "GAP":
            (($.gap = !0), $.tagList.push([ye]));
            break;
          case "BITRATE":
            ($.tagList.push([ye, ve]), (B = parseInt(ve) * 1e3), Ue(B) ? ($.bitrate = B) : (B = 0));
            break;
          case "DATERANGE": {
            const Le = new In(ve, v),
              ke = new Kk(Le, v.dateRanges[Le.ID], v.dateRangeTagCount);
            (v.dateRangeTagCount++,
              ke.isValid || v.skippedSegments
                ? (v.dateRanges[ke.id] = ke)
                : Zt.warn('Ignoring invalid DATERANGE tag: "'.concat(ve, '"')),
              $.tagList.push(["EXT-X-DATERANGE", ve]));
            break;
          }
          case "DEFINE": {
            {
              const Le = new In(ve, v);
              "IMPORT" in Le ? oK(v, Le, p) : rb(v, Le, i);
            }
            break;
          }
          case "DISCONTINUITY-SEQUENCE":
            (v.startCC !== 0 ? $s(v, ye, I) : T.length > 0 && mb(v, ye, I), (v.startCC = O = parseInt(ve)));
            break;
          case "KEY": {
            const Le = cb(ve, i, v);
            if (Le.isSupported()) {
              if (Le.method === "NONE") {
                oe = void 0;
                break;
              }
              oe || (oe = {});
              const ke = oe[Le.keyFormat];
              (ke != null && ke.matches(Le)) || (ke && (oe = rn({}, oe)), (oe[Le.keyFormat] = Le));
            } else Zt.warn('[Keys] Ignoring unsupported EXT-X-KEY tag: "'.concat(ve, '"'));
            break;
          }
          case "START":
            v.startTimeOffset = db(ve);
            break;
          case "MAP": {
            const Le = new In(ve, v);
            if ($.duration) {
              const ke = new Cx(l, y);
              (pb(ke, Le, o, oe),
                (w = ke),
                ($.initSegment = w),
                w.rawProgramDateTime &&
                  !$.rawProgramDateTime &&
                  ($.rawProgramDateTime = w.rawProgramDateTime));
            } else {
              const ke = $.byteRangeEndOffset;
              if (ke) {
                const Ne = $.byteRangeStartOffset;
                _ = "".concat(ke - Ne, "@").concat(Ne);
              } else _ = null;
              (pb($, Le, o, oe), (w = $), (te = !0));
            }
            w.cc = O;
            break;
          }
          case "SERVER-CONTROL": {
            (K && $s(v, ye, I),
              (K = new In(ve)),
              (v.canBlockReload = K.bool("CAN-BLOCK-RELOAD")),
              (v.canSkipUntil = K.optionalFloat("CAN-SKIP-UNTIL", 0)),
              (v.canSkipDateRanges = v.canSkipUntil > 0 && K.bool("CAN-SKIP-DATERANGES")),
              (v.partHoldBack = K.optionalFloat("PART-HOLD-BACK", 0)),
              (v.holdBack = K.optionalFloat("HOLD-BACK", 0)));
            break;
          }
          case "PART-INF": {
            v.partTarget && $s(v, ye, I);
            const Le = new In(ve);
            v.partTarget = Le.decimalFloatingPoint("PART-TARGET");
            break;
          }
          case "PART": {
            let Le = v.partList;
            Le || (Le = v.partList = []);
            const ke = L > 0 ? Le[Le.length - 1] : void 0,
              Ne = L++,
              Re = new In(ve, v),
              Ce = new oH(Re, $, y, Ne, ke);
            (Le.push(Ce), ($.duration += Ce.duration));
            break;
          }
          case "PRELOAD-HINT": {
            const Le = new In(ve, v);
            v.preloadHint = Le;
            break;
          }
          case "RENDITION-REPORT": {
            const Le = new In(ve, v);
            ((v.renditionReports = v.renditionReports || []), v.renditionReports.push(Le));
            break;
          }
          default:
            Zt.warn("line parsed but not handled: ".concat(I));
            break;
        }
      }
    }
    (N && !N.relurl
      ? (T.pop(), (k -= N.duration), v.partList && (v.fragmentHint = N))
      : v.partList && (DT($, N, S), ($.cc = O), (v.fragmentHint = $), oe && gb($, oe, v)),
      v.targetduration || (v.playlistParsingError = new Error("Missing Target Duration")));
    const q = T.length,
      ce = T[0],
      he = T[q - 1];
    if (((k += v.skippedSegments * v.targetduration), k > 0 && q && he)) {
      v.averagetargetduration = k / q;
      const ae = he.sn;
      ((v.endSN = ae !== "initSegment" ? ae : 0),
        v.live || (he.endList = !0),
        Y > 0 && (EK(T, Y), ce && S.unshift(ce)));
    }
    return (
      v.fragmentHint && (k += v.fragmentHint.duration),
      (v.totalduration = k),
      S.length && v.dateRangeTagCount && ce && qk(S, v),
      (v.endCC = O),
      v
    );
  }
}
function qk(u, n) {
  let i = u.length;
  if (!i)
    if (n.hasProgramDateTime) {
      const d = n.fragments[n.fragments.length - 1];
      (u.push(d), i++);
    } else return;
  const o = u[i - 1],
    l = n.live ? 1 / 0 : n.totalduration,
    h = Object.keys(n.dateRanges);
  for (let d = h.length; d--; ) {
    const y = n.dateRanges[h[d]],
      v = y.startDate.getTime();
    y.tagAnchor = o.ref;
    for (let T = i; T--; ) {
      var p;
      if (((p = u[T]) == null ? void 0 : p.sn) < n.startSN) break;
      const S = SK(n, v, u, T, l);
      if (S !== -1) {
        y.tagAnchor = n.fragments[S].ref;
        break;
      }
    }
  }
}
function SK(u, n, i, o, l) {
  const h = i[o];
  if (h) {
    const d = h.programDateTime;
    if (n >= d || o === 0) {
      var p;
      const y = (((p = i[o + 1]) == null ? void 0 : p.start) || l) - h.start;
      if (n <= d + y * 1e3) {
        const v = i[o].sn - u.startSN;
        if (v < 0) return -1;
        const T = u.fragments;
        if (T.length > i.length) {
          const w = (i[o + 1] || T[T.length - 1]).sn - u.startSN;
          for (let C = w; C > v; C--) {
            const L = T[C].programDateTime;
            if (n >= L && n < L + T[C].duration * 1e3) return C;
          }
        }
        return v;
      }
    }
  }
  return -1;
}
function cb(u, n, i) {
  var o, l;
  const h = new In(u, i),
    p = (o = h.METHOD) != null ? o : "",
    d = h.URI,
    y = h.hexadecimalInteger("IV"),
    v = h.KEYFORMATVERSIONS,
    T = (l = h.KEYFORMAT) != null ? l : "identity";
  d && h.IV && !y && Zt.error("Invalid IV: ".concat(h.IV));
  const S = d ? us.resolve(d, n) : "",
    w = (v || "1").split("/").map(Number).filter(Number.isFinite);
  return new Mo(p, S, T, w, y, h.KEYID);
}
function db(u) {
  const i = new In(u).decimalFloatingPoint("TIME-OFFSET");
  return Ue(i) ? i : null;
}
function hb(u, n) {
  let i = (u || "").split(/[ ,]+/).filter(o => o);
  (["video", "audio", "text"].forEach(o => {
    const l = i.filter(h => cS(h, o));
    l.length &&
      ((n["".concat(o, "Codec")] = l.map(h => h.split("/")[0]).join(",")),
      (i = i.filter(h => l.indexOf(h) === -1)));
  }),
    (n.unknownCodecs = i));
}
function fb(u, n, i) {
  const o = n[i];
  o && (u[i] = o);
}
function EK(u, n) {
  let i = u[n];
  for (let o = n; o--; ) {
    const l = u[o];
    if (!l) return;
    ((l.programDateTime = i.programDateTime - l.duration * 1e3), (i = l));
  }
}
function DT(u, n, i) {
  u.rawProgramDateTime
    ? i.push(u)
    : n != null && n.programDateTime && (u.programDateTime = n.endProgramDateTime);
}
function pb(u, n, i, o) {
  ((u.relurl = n.URI),
    n.BYTERANGE && u.setByteRange(n.BYTERANGE),
    (u.level = i),
    (u.sn = "initSegment"),
    o && (u.levelkeys = o),
    (u.initSegment = null));
}
function gb(u, n, i) {
  u.levelkeys = n;
  const { encryptedFragments: o } = i;
  (!o.length || o[o.length - 1].levelkeys !== n) &&
    Object.keys(n).some(l => n[l].isCommonEncryption) &&
    o.push(u);
}
function $s(u, n, i) {
  u.playlistParsingError = new Error(
    "#EXT-X-".concat(n, " must not appear more than once (").concat(i[0], ")"),
  );
}
function mb(u, n, i) {
  u.playlistParsingError = new Error(
    "#EXT-X-".concat(n, " must appear before the first Media Segment (").concat(i[0], ")"),
  );
}
function kx(u, n) {
  const i = n.startPTS;
  if (Ue(i)) {
    let o = 0,
      l;
    (n.sn > u.sn ? ((o = i - u.start), (l = u)) : ((o = u.start - i), (l = n)),
      l.duration !== o && l.setDuration(o));
  } else
    n.sn > u.sn
      ? u.cc === n.cc && u.minEndPTS
        ? n.setStart(u.start + (u.minEndPTS - u.start))
        : n.setStart(u.start + u.duration)
      : n.setStart(Math.max(u.start - n.duration, 0));
}
function Qk(u, n, i, o, l, h, p) {
  o - i <= 0 &&
    (p.warn("Fragment should have a positive duration", n), (o = i + n.duration), (h = l + n.duration));
  let y = i,
    v = o;
  const T = n.startPTS,
    S = n.endPTS;
  if (Ue(T)) {
    const B = Math.abs(T - i);
    (u && B > u.totalduration
      ? p.warn(
          "media timestamps and playlist times differ by "
            .concat(B, "s for level ")
            .concat(n.level, " ")
            .concat(u.url),
        )
      : Ue(n.deltaPTS)
        ? (n.deltaPTS = Math.max(B, n.deltaPTS))
        : (n.deltaPTS = B),
      (y = Math.max(i, T)),
      (i = Math.min(i, T)),
      (l = n.startDTS !== void 0 ? Math.min(l, n.startDTS) : l),
      (v = Math.min(o, S)),
      (o = Math.max(o, S)),
      (h = n.endDTS !== void 0 ? Math.max(h, n.endDTS) : h));
  }
  const w = i - n.start;
  (n.start !== 0 && n.setStart(i),
    n.setDuration(o - n.start),
    (n.startPTS = i),
    (n.maxStartPTS = y),
    (n.startDTS = l),
    (n.endPTS = o),
    (n.minEndPTS = v),
    (n.endDTS = h));
  const C = n.sn;
  if (!u || C < u.startSN || C > u.endSN) return 0;
  let L;
  const k = C - u.startSN,
    O = u.fragments;
  for (O[k] = n, L = k; L > 0; L--) kx(O[L], O[L - 1]);
  for (L = k; L < O.length - 1; L++) kx(O[L], O[L + 1]);
  return (u.fragmentHint && kx(O[O.length - 1], u.fragmentHint), (u.PTSKnown = u.alignedSliding = !0), w);
}
function AK(u, n, i) {
  if (u === n) return;
  let o = null;
  const l = u.fragments;
  for (let T = l.length - 1; T >= 0; T--) {
    const S = l[T].initSegment;
    if (S) {
      o = S;
      break;
    }
  }
  u.fragmentHint && delete u.fragmentHint.endPTS;
  let h;
  RK(u, n, (T, S, w, C) => {
    if ((!n.startCC || n.skippedSegments) && S.cc !== T.cc) {
      const L = T.cc - S.cc;
      for (let k = w; k < C.length; k++) C[k].cc += L;
      n.endCC = C[C.length - 1].cc;
    }
    (Ue(T.startPTS) &&
      Ue(T.endPTS) &&
      (S.setStart((S.startPTS = T.startPTS)),
      (S.startDTS = T.startDTS),
      (S.maxStartPTS = T.maxStartPTS),
      (S.endPTS = T.endPTS),
      (S.endDTS = T.endDTS),
      (S.minEndPTS = T.minEndPTS),
      S.setDuration(T.endPTS - T.startPTS),
      S.duration && (h = S),
      (n.PTSKnown = n.alignedSliding = !0)),
      T.hasStreams && (S.elementaryStreams = T.elementaryStreams),
      (S.loader = T.loader),
      T.hasStats && (S.stats = T.stats),
      T.initSegment && ((S.initSegment = T.initSegment), (o = T.initSegment)));
  });
  const p = n.fragments,
    d = n.fragmentHint ? p.concat(n.fragmentHint) : p;
  if (
    (o &&
      d.forEach(T => {
        var S;
        T &&
          (!T.initSegment || T.initSegment.relurl === ((S = o) == null ? void 0 : S.relurl)) &&
          (T.initSegment = o);
      }),
    n.skippedSegments)
  ) {
    if (((n.deltaUpdateFailed = p.some(T => !T)), n.deltaUpdateFailed)) {
      i.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");
      for (let T = n.skippedSegments; T--; ) p.shift();
      n.startSN = p[0].sn;
    } else {
      n.canSkipDateRanges && (n.dateRanges = IK(u.dateRanges, n, i));
      const T = u.fragments.filter(S => S.rawProgramDateTime);
      if (u.hasProgramDateTime && !n.hasProgramDateTime)
        for (let S = 1; S < d.length; S++) d[S].programDateTime === null && DT(d[S], d[S - 1], T);
      qk(T, n);
    }
    n.endCC = p[p.length - 1].cc;
  }
  if (!n.startCC) {
    var y;
    const T = eM(u, n.startSN - 1);
    n.startCC = (y = T == null ? void 0 : T.cc) != null ? y : p[0].cc;
  }
  (wK(u.partList, n.partList, (T, S) => {
    ((S.elementaryStreams = T.elementaryStreams), (S.stats = T.stats));
  }),
    h ? Qk(n, h, h.startPTS, h.endPTS, h.startDTS, h.endDTS, i) : Jk(u, n),
    p.length && (n.totalduration = n.edge - p[0].start),
    (n.driftStartTime = u.driftStartTime),
    (n.driftStart = u.driftStart));
  const v = n.advancedDateTime;
  if (n.advanced && v) {
    const T = n.edge;
    (n.driftStart || ((n.driftStartTime = v), (n.driftStart = T)), (n.driftEndTime = v), (n.driftEnd = T));
  } else
    ((n.driftEndTime = u.driftEndTime), (n.driftEnd = u.driftEnd), (n.advancedDateTime = u.advancedDateTime));
  n.requestScheduled === -1 && (n.requestScheduled = u.requestScheduled);
}
function IK(u, n, i) {
  const { dateRanges: o, recentlyRemovedDateranges: l } = n,
    h = rn({}, u);
  l &&
    l.forEach(y => {
      delete h[y];
    });
  const d = Object.keys(h).length;
  return d
    ? (Object.keys(o).forEach(y => {
        const v = h[y],
          T = new Kk(o[y].attr, v);
        T.isValid
          ? ((h[y] = T), v || (T.tagOrder += d))
          : i.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'.concat(ln(o[y].attr), '"'));
      }),
      h)
    : o;
}
function wK(u, n, i) {
  if (u && n) {
    let o = 0;
    for (let l = 0, h = u.length; l <= h; l++) {
      const p = u[l],
        d = n[l + o];
      p && d && p.index === d.index && p.fragment.sn === d.fragment.sn ? i(p, d) : o--;
    }
  }
}
function RK(u, n, i) {
  const o = n.skippedSegments,
    l = Math.max(u.startSN, n.startSN) - n.startSN,
    h = (u.fragmentHint ? 1 : 0) + (o ? n.endSN : Math.min(u.endSN, n.endSN)) - n.startSN,
    p = n.startSN - u.startSN,
    d = n.fragmentHint ? n.fragments.concat(n.fragmentHint) : n.fragments,
    y = u.fragmentHint ? u.fragments.concat(u.fragmentHint) : u.fragments;
  for (let v = l; v <= h; v++) {
    const T = y[p + v];
    let S = d[v];
    if ((o && !S && T && (S = n.fragments[v] = T), T && S)) {
      i(T, S, v, d);
      const w = T.relurl,
        C = S.relurl;
      if (w && CK(w, C)) {
        n.playlistParsingError = yb("media sequence mismatch ".concat(S.sn, ":"), u, n, T, S);
        return;
      } else if (T.cc !== S.cc) {
        n.playlistParsingError = yb(
          "discontinuity sequence mismatch (".concat(T.cc, "!=").concat(S.cc, ")"),
          u,
          n,
          T,
          S,
        );
        return;
      }
    }
  }
}
function yb(u, n, i, o, l) {
  return new Error(
    ""
      .concat(u, " ")
      .concat(l.url, "\nPlaylist starting @")
      .concat(n.startSN, "\n")
      .concat(n.m3u8, "\n\nPlaylist starting @")
      .concat(i.startSN, "\n")
      .concat(i.m3u8),
  );
}
function Jk(u, n, i = !0) {
  const o = n.startSN + n.skippedSegments - u.startSN,
    l = u.fragments,
    h = o >= 0;
  let p = 0;
  if (h && o < l.length) p = l[o].start;
  else if (h && n.startSN === u.endSN + 1) p = u.fragmentEnd;
  else if (h && i) p = u.fragmentStart + o * n.levelTargetDuration;
  else if (!n.skippedSegments && n.fragmentStart === 0) p = u.fragmentStart;
  else return;
  kT(n, p);
}
function kT(u, n) {
  if (n) {
    const i = u.fragments;
    for (let o = u.skippedSegments; o < i.length; o++) i[o].addStart(n);
    u.fragmentHint && u.fragmentHint.addStart(n);
  }
}
function Zk(u, n = 1 / 0) {
  let i = 1e3 * u.targetduration;
  if (u.updated) {
    const o = u.fragments;
    if (o.length && i * 4 > n) {
      const h = o[o.length - 1].duration * 1e3;
      h < i && (i = h);
    }
  } else i /= 2;
  return Math.round(i);
}
function eM(u, n, i) {
  if (!u) return null;
  let o = u.fragments[n - u.startSN];
  return o || ((o = u.fragmentHint), o && o.sn === n) ? o : n < u.startSN && i && i.sn === n ? i : null;
}
function vb(u, n, i) {
  return u ? tM(u.partList, n, i) : null;
}
function tM(u, n, i) {
  if (u)
    for (let o = u.length; o--; ) {
      const l = u[o];
      if (l.index === i && l.fragment.sn === n) return l;
    }
  return null;
}
function nM(u) {
  u.forEach((n, i) => {
    var o;
    (o = n.details) == null ||
      o.fragments.forEach(l => {
        ((l.level = i), l.initSegment && (l.initSegment.level = i));
      });
  });
}
function CK(u, n) {
  return u !== n && n ? xb(u) !== xb(n) : !1;
}
function xb(u) {
  return u.replace(/\?[^?]*$/, "");
}
function dd(u, n) {
  for (let o = 0, l = u.length; o < l; o++) {
    var i;
    if (((i = u[o]) == null ? void 0 : i.cc) === n) return u[o];
  }
  return null;
}
function LK(u, n) {
  return !!(u && n.startCC < u.endCC && n.endCC > u.startCC);
}
function Tb(u, n) {
  const i = u.start + n;
  ((u.startPTS = i), u.setStart(i), (u.endPTS = i + u.duration));
}
function iM(u, n) {
  const i = n.fragments;
  for (let o = 0, l = i.length; o < l; o++) Tb(i[o], u);
  (n.fragmentHint && Tb(n.fragmentHint, u), (n.alignedSliding = !0));
}
function _K(u, n) {
  u && (rM(n, u), n.alignedSliding || Vg(n, u), !n.alignedSliding && !n.skippedSegments && Jk(u, n, !1));
}
function rM(u, n) {
  if (!LK(n, u)) return;
  const i = Math.min(n.endCC, u.endCC),
    o = dd(n.fragments, i),
    l = dd(u.fragments, i);
  if (!o || !l) return;
  Zt.log("Aligning playlist at start of dicontinuity sequence ".concat(i));
  const h = o.start - l.start;
  iM(h, u);
}
function Vg(u, n) {
  if (!u.hasProgramDateTime || !n.hasProgramDateTime) return;
  const i = u.fragments,
    o = n.fragments;
  if (!i.length || !o.length) return;
  let l, h;
  const p = Math.min(n.endCC, u.endCC);
  (n.startCC < p && u.startCC < p && ((l = dd(o, p)), (h = dd(i, p))),
    (!l || !h) && ((l = o[Math.floor(o.length / 2)]), (h = dd(i, l.cc) || i[Math.floor(i.length / 2)])));
  const d = l.programDateTime,
    y = h.programDateTime;
  if (!d || !y) return;
  const v = (y - d) / 1e3 - (h.start - l.start);
  iM(v, u);
}
function ji(u, n, i) {
  (tr(u, n, i), u.addEventListener(n, i));
}
function tr(u, n, i) {
  u.removeEventListener(n, i);
}
const bK = {
    toString: function (u) {
      let n = "";
      const i = u.length;
      for (let o = 0; o < i; o++)
        n += "[".concat(u.start(o).toFixed(3), "-").concat(u.end(o).toFixed(3), "]");
      return n;
    },
  },
  Te = {
    STOPPED: "STOPPED",
    IDLE: "IDLE",
    KEY_LOADING: "KEY_LOADING",
    FRAG_LOADING: "FRAG_LOADING",
    FRAG_LOADING_WAITING_RETRY: "FRAG_LOADING_WAITING_RETRY",
    WAITING_TRACK: "WAITING_TRACK",
    PARSING: "PARSING",
    PARSED: "PARSED",
    ENDED: "ENDED",
    ERROR: "ERROR",
    WAITING_INIT_PTS: "WAITING_INIT_PTS",
    WAITING_LEVEL: "WAITING_LEVEL",
  };
class yS extends Vk {
  constructor(n, i, o, l, h) {
    (super(l, n.logger),
      (this.hls = void 0),
      (this.fragPrevious = null),
      (this.fragCurrent = null),
      (this.fragmentTracker = void 0),
      (this.transmuxer = null),
      (this._state = Te.STOPPED),
      (this.playlistType = void 0),
      (this.media = null),
      (this.mediaBuffer = null),
      (this.config = void 0),
      (this.bitrateTest = !1),
      (this.lastCurrentTime = 0),
      (this.nextLoadPosition = 0),
      (this.startPosition = 0),
      (this.startTimeOffset = null),
      (this.retryDate = 0),
      (this.levels = null),
      (this.fragmentLoader = void 0),
      (this.keyLoader = void 0),
      (this.levelLastLoaded = null),
      (this.startFragRequested = !1),
      (this.decrypter = void 0),
      (this.initPTS = []),
      (this.buffering = !0),
      (this.loadingParts = !1),
      (this.loopSn = void 0),
      (this.onMediaSeeking = () => {
        const { config: p, fragCurrent: d, media: y, mediaBuffer: v, state: T } = this,
          S = y ? y.currentTime : 0,
          w = Tt.bufferInfo(v || y, S, p.maxBufferHole),
          C = !w.len;
        if (
          (this.log(
            "Media seeking to "
              .concat(Ue(S) ? S.toFixed(3) : S, ", state: ")
              .concat(T, ", ")
              .concat(C ? "out of" : "in", " buffer"),
          ),
          this.state === Te.ENDED)
        )
          this.resetLoadingState();
        else if (d) {
          const L = p.maxFragLookUpTolerance,
            k = d.start - L,
            O = d.start + d.duration + L;
          if (C || O < w.start || k > w.end) {
            const B = S > O;
            (S < k || B) &&
              (B &&
                d.loader &&
                (this.log("Cancelling fragment load for seek (sn: ".concat(d.sn, ")")),
                d.abortRequests(),
                this.resetLoadingState()),
              (this.fragPrevious = null));
          }
        }
        if (y) {
          this.fragmentTracker.removeFragmentsInRange(S, 1 / 0, this.playlistType, !0);
          const L = this.lastCurrentTime;
          if ((S > L && (this.lastCurrentTime = S), !this.loadingParts)) {
            const k = Math.max(w.end, S),
              O = this.shouldLoadParts(this.getLevelDetails(), k);
            O &&
              (this.log(
                "LL-Part loading ON after seeking to "
                  .concat(S.toFixed(2), " with buffer @")
                  .concat(k.toFixed(2)),
              ),
              (this.loadingParts = O));
          }
        }
        (this.hls.hasEnoughToStart ||
          (this.log(
            "Setting "
              .concat(C ? "startPosition" : "nextLoadPosition", " to ")
              .concat(S, " for seek without enough to start"),
          ),
          (this.nextLoadPosition = S),
          C && (this.startPosition = S)),
          C && this.state === Te.IDLE && this.tickImmediate());
      }),
      (this.onMediaEnded = () => {
        (this.log("setting startPosition to 0 because media ended"),
          (this.startPosition = this.lastCurrentTime = 0));
      }),
      (this.playlistType = h),
      (this.hls = n),
      (this.fragmentLoader = new rK(n.config)),
      (this.keyLoader = o),
      (this.fragmentTracker = i),
      (this.config = n.config),
      (this.decrypter = new fS(n.config)));
  }
  registerListeners() {
    const { hls: n } = this;
    (n.on(F.MEDIA_ATTACHED, this.onMediaAttached, this),
      n.on(F.MEDIA_DETACHING, this.onMediaDetaching, this),
      n.on(F.MANIFEST_LOADING, this.onManifestLoading, this),
      n.on(F.MANIFEST_LOADED, this.onManifestLoaded, this),
      n.on(F.ERROR, this.onError, this));
  }
  unregisterListeners() {
    const { hls: n } = this;
    (n.off(F.MEDIA_ATTACHED, this.onMediaAttached, this),
      n.off(F.MEDIA_DETACHING, this.onMediaDetaching, this),
      n.off(F.MANIFEST_LOADING, this.onManifestLoading, this),
      n.off(F.MANIFEST_LOADED, this.onManifestLoaded, this),
      n.off(F.ERROR, this.onError, this));
  }
  doTick() {
    this.onTickEnd();
  }
  onTickEnd() {}
  startLoad(n) {}
  stopLoad() {
    if (this.state === Te.STOPPED) return;
    (this.fragmentLoader.abort(), this.keyLoader.abort(this.playlistType));
    const n = this.fragCurrent;
    (n != null && n.loader && (n.abortRequests(), this.fragmentTracker.removeFragment(n)),
      this.resetTransmuxer(),
      (this.fragCurrent = null),
      (this.fragPrevious = null),
      this.clearInterval(),
      this.clearNextTick(),
      (this.state = Te.STOPPED));
  }
  get startPositionValue() {
    const { nextLoadPosition: n, startPosition: i } = this;
    return i === -1 && n ? n : i;
  }
  get bufferingEnabled() {
    return this.buffering;
  }
  pauseBuffering() {
    this.buffering = !1;
  }
  resumeBuffering() {
    this.buffering = !0;
  }
  get inFlightFrag() {
    return { frag: this.fragCurrent, state: this.state };
  }
  _streamEnded(n, i) {
    if (i.live || !this.media) return !1;
    const o = n.end || 0,
      l = this.config.timelineOffset || 0;
    if (o <= l) return !1;
    const h = n.buffered;
    this.config.maxBufferHole && h && h.length > 1 && (n = Tt.bufferedInfo(h, n.start, 0));
    const p = n.nextStart;
    if ((p && p > l && p < i.edge) || this.media.currentTime < n.start) return !1;
    const y = i.partList;
    if (y != null && y.length) {
      const T = y[y.length - 1];
      return Tt.isBuffered(this.media, T.start + T.duration / 2);
    }
    const v = i.fragments[i.fragments.length - 1].type;
    return this.fragmentTracker.isEndListAppended(v);
  }
  getLevelDetails() {
    if (this.levels && this.levelLastLoaded !== null) return this.levelLastLoaded.details;
  }
  get timelineOffset() {
    const n = this.config.timelineOffset;
    if (n) {
      var i;
      return ((i = this.getLevelDetails()) == null ? void 0 : i.appliedTimelineOffset) || n;
    }
    return 0;
  }
  onMediaAttached(n, i) {
    const o = (this.media = this.mediaBuffer = i.media);
    (ji(o, "seeking", this.onMediaSeeking), ji(o, "ended", this.onMediaEnded));
    const l = this.config;
    this.levels && l.autoStartLoad && this.state === Te.STOPPED && this.startLoad(l.startPosition);
  }
  onMediaDetaching(n, i) {
    const o = !!i.transferMedia,
      l = this.media;
    if (l !== null) {
      if (
        (l.ended &&
          (this.log("MSE detaching and video ended, reset startPosition"),
          (this.startPosition = this.lastCurrentTime = 0)),
        tr(l, "seeking", this.onMediaSeeking),
        tr(l, "ended", this.onMediaEnded),
        this.keyLoader && !o && this.keyLoader.detach(),
        (this.media = this.mediaBuffer = null),
        (this.loopSn = void 0),
        o)
      ) {
        (this.resetLoadingState(), this.resetTransmuxer());
        return;
      }
      ((this.loadingParts = !1), this.fragmentTracker.removeAllFragments(), this.stopLoad());
    }
  }
  onManifestLoading() {
    ((this.initPTS = []),
      (this.levels = this.levelLastLoaded = this.fragCurrent = null),
      (this.lastCurrentTime = this.startPosition = 0),
      (this.startFragRequested = !1));
  }
  onError(n, i) {}
  onManifestLoaded(n, i) {
    this.startTimeOffset = i.startTimeOffset;
  }
  onHandlerDestroying() {
    (this.stopLoad(),
      this.transmuxer && (this.transmuxer.destroy(), (this.transmuxer = null)),
      super.onHandlerDestroying(),
      (this.hls = this.onMediaSeeking = this.onMediaEnded = null));
  }
  onHandlerDestroyed() {
    ((this.state = Te.STOPPED),
      this.fragmentLoader && this.fragmentLoader.destroy(),
      this.keyLoader && this.keyLoader.destroy(),
      this.decrypter && this.decrypter.destroy(),
      (this.hls =
        this.log =
        this.warn =
        this.decrypter =
        this.keyLoader =
        this.fragmentLoader =
        this.fragmentTracker =
          null),
      super.onHandlerDestroyed());
  }
  loadFragment(n, i, o) {
    ((this.startFragRequested = !0), this._loadFragForPlayback(n, i, o));
  }
  _loadFragForPlayback(n, i, o) {
    const l = h => {
      const p = h.frag;
      if (this.fragContextChanged(p)) {
        (this.warn(
          ""
            .concat(p.type, " sn: ")
            .concat(p.sn)
            .concat(h.part ? " part: " + h.part.index : "", " of ")
            .concat(this.fragInfo(p, !1, h.part), ") was dropped during download."),
        ),
          this.fragmentTracker.removeFragment(p));
        return;
      }
      (p.stats.chunkCount++, this._handleFragmentLoadProgress(h));
    };
    this._doFragLoad(n, i, o, l)
      .then(h => {
        if (!h) return;
        const p = this.state,
          d = h.frag;
        if (this.fragContextChanged(d)) {
          (p === Te.FRAG_LOADING || (!this.fragCurrent && p === Te.PARSING)) &&
            (this.fragmentTracker.removeFragment(d), (this.state = Te.IDLE));
          return;
        }
        ("payload" in h &&
          (this.log(
            "Loaded "
              .concat(d.type, " sn: ")
              .concat(d.sn, " of ")
              .concat(this.playlistLabel(), " ")
              .concat(d.level),
          ),
          this.hls.trigger(F.FRAG_LOADED, h)),
          this._handleFragmentLoadComplete(h));
      })
      .catch(h => {
        this.state === Te.STOPPED ||
          this.state === Te.ERROR ||
          (this.warn("Frag error: ".concat((h == null ? void 0 : h.message) || h)),
          this.resetFragmentLoading(n));
      });
  }
  clearTrackerIfNeeded(n) {
    var i;
    const { fragmentTracker: o } = this;
    if (o.getState(n) === ei.APPENDING) {
      const h = n.type,
        p = this.getFwdBufferInfo(this.mediaBuffer, h),
        d = Math.max(n.duration, p ? p.len : this.config.maxBufferLength),
        y = this.backtrackFragment;
      ((y ? n.sn - y.sn : 0) === 1 || this.reduceMaxBufferLength(d, n.duration)) && o.removeFragment(n);
    } else
      ((i = this.mediaBuffer) == null ? void 0 : i.buffered.length) === 0
        ? o.removeAllFragments()
        : o.hasParts(n.type) &&
          (o.detectPartialFragments({ frag: n, part: null, stats: n.stats, id: n.type }),
          o.getState(n) === ei.PARTIAL && o.removeFragment(n));
  }
  checkLiveUpdate(n) {
    if (n.updated && !n.live) {
      const i = n.fragments[n.fragments.length - 1];
      this.fragmentTracker.detectPartialFragments({ frag: i, part: null, stats: i.stats, id: i.type });
    }
    n.fragments[0] || (n.deltaUpdateFailed = !0);
  }
  waitForLive(n) {
    const i = n.details;
    return (i == null ? void 0 : i.live) && i.type !== "EVENT" && (this.levelLastLoaded !== n || i.expired);
  }
  flushMainBuffer(n, i, o = null) {
    if (!(n - i)) return;
    const l = { startOffset: n, endOffset: i, type: o };
    this.hls.trigger(F.BUFFER_FLUSHING, l);
  }
  _loadInitSegment(n, i) {
    this._doFragLoad(n, i)
      .then(o => {
        const l = o == null ? void 0 : o.frag;
        if (!l || this.fragContextChanged(l) || !this.levels) throw new Error("init load aborted");
        return o;
      })
      .then(o => {
        const { hls: l } = this,
          { frag: h, payload: p } = o,
          d = h.decryptdata;
        if (p && p.byteLength > 0 && d != null && d.key && d.iv && ou(d.method)) {
          const y = self.performance.now();
          return this.decrypter
            .decrypt(new Uint8Array(p), d.key.buffer, d.iv.buffer, gS(d.method))
            .catch(v => {
              throw (
                l.trigger(F.ERROR, {
                  type: et.MEDIA_ERROR,
                  details: ge.FRAG_DECRYPT_ERROR,
                  fatal: !1,
                  error: v,
                  reason: v.message,
                  frag: h,
                }),
                v
              );
            })
            .then(v => {
              const T = self.performance.now();
              return (
                l.trigger(F.FRAG_DECRYPTED, { frag: h, payload: v, stats: { tstart: y, tdecrypt: T } }),
                (o.payload = v),
                this.completeInitSegmentLoad(o)
              );
            });
        }
        return this.completeInitSegmentLoad(o);
      })
      .catch(o => {
        this.state === Te.STOPPED || this.state === Te.ERROR || (this.warn(o), this.resetFragmentLoading(n));
      });
  }
  completeInitSegmentLoad(n) {
    const { levels: i } = this;
    if (!i) throw new Error("init load aborted, missing levels");
    const o = n.frag.stats;
    (this.state !== Te.STOPPED && (this.state = Te.IDLE),
      (n.frag.data = new Uint8Array(n.payload)),
      (o.parsing.start = o.buffering.start = self.performance.now()),
      (o.parsing.end = o.buffering.end = self.performance.now()),
      this.tick());
  }
  unhandledEncryptionError(n, i) {
    var o, l;
    const h = n.tracks;
    if (
      h &&
      !i.encrypted &&
      (((o = h.audio) != null && o.encrypted) || ((l = h.video) != null && l.encrypted)) &&
      (!this.config.emeEnabled || !this.keyLoader.emeController)
    ) {
      const p = this.media,
        d = new Error(
          "Encrypted track with no key in "
            .concat(this.fragInfo(i), " (media ")
            .concat(p ? "attached mediaKeys: " + p.mediaKeys : "detached", ")"),
        );
      return (
        this.warn(d.message),
        !p || p.mediaKeys
          ? !1
          : (this.hls.trigger(F.ERROR, {
              type: et.KEY_SYSTEM_ERROR,
              details: ge.KEY_SYSTEM_NO_KEYS,
              fatal: !1,
              error: d,
              frag: i,
            }),
            this.resetTransmuxer(),
            !0)
      );
    }
    return !1;
  }
  fragContextChanged(n) {
    const { fragCurrent: i } = this;
    return !n || !i || n.sn !== i.sn || n.level !== i.level;
  }
  fragBufferedComplete(n, i) {
    const o = this.mediaBuffer ? this.mediaBuffer : this.media;
    if (
      (this.log(
        "Buffered "
          .concat(n.type, " sn: ")
          .concat(n.sn)
          .concat(i ? " part: " + i.index : "", " of ")
          .concat(this.fragInfo(n, !1, i), " > buffer:")
          .concat(o ? bK.toString(Tt.getBuffered(o)) : "(detached)", ")"),
      ),
      On(n))
    ) {
      var l;
      if (n.type !== Xe.SUBTITLE) {
        const p = n.elementaryStreams;
        if (!Object.keys(p).some(d => !!p[d])) {
          this.state = Te.IDLE;
          return;
        }
      }
      const h = (l = this.levels) == null ? void 0 : l[n.level];
      h != null &&
        h.fragmentError &&
        (this.log("Resetting level fragment error count of ".concat(h.fragmentError, " on frag buffered")),
        (h.fragmentError = 0));
    }
    this.state = Te.IDLE;
  }
  _handleFragmentLoadComplete(n) {
    const { transmuxer: i } = this;
    if (!i) return;
    const { frag: o, part: l, partsLoaded: h } = n,
      p = !h || h.length === 0 || h.some(y => !y),
      d = new pS(o.level, o.sn, o.stats.chunkCount + 1, 0, l ? l.index : -1, !p);
    i.flush(d);
  }
  _handleFragmentLoadProgress(n) {}
  _doFragLoad(n, i, o = null, l) {
    var h;
    this.fragCurrent = n;
    const p = i.details;
    if (!this.levels || !p)
      throw new Error("frag load aborted, missing level".concat(p ? "" : " detail", "s"));
    let d = null;
    if (n.encrypted && !((h = n.decryptdata) != null && h.key)) {
      if (
        (this.log(
          "Loading key for "
            .concat(n.sn, " of [")
            .concat(p.startSN, "-")
            .concat(p.endSN, "], ")
            .concat(this.playlistLabel(), " ")
            .concat(n.level),
        ),
        (this.state = Te.KEY_LOADING),
        (this.fragCurrent = n),
        (d = this.keyLoader.load(n).then(w => {
          if (!this.fragContextChanged(w.frag))
            return (
              this.hls.trigger(F.KEY_LOADED, w),
              this.state === Te.KEY_LOADING && (this.state = Te.IDLE),
              w
            );
        })),
        this.hls.trigger(F.KEY_LOADING, { frag: n }),
        this.fragCurrent === null)
      )
        return (this.log("context changed in KEY_LOADING"), Promise.resolve(null));
    } else
      n.encrypted ||
        ((d = this.keyLoader.loadClear(n, p.encryptedFragments, this.startFragRequested)),
        d && this.log("[eme] blocking frag load until media-keys acquired"));
    const y = this.fragPrevious;
    if (On(n) && (!y || n.sn !== y.sn)) {
      const w = this.shouldLoadParts(i.details, n.end);
      w !== this.loadingParts &&
        (this.log(
          "LL-Part loading "
            .concat(w ? "ON" : "OFF", " loading sn ")
            .concat(y == null ? void 0 : y.sn, "->")
            .concat(n.sn),
        ),
        (this.loadingParts = w));
    }
    if (((o = Math.max(n.start, o || 0)), this.loadingParts && On(n))) {
      const w = p.partList;
      if (w && l) {
        o > p.fragmentEnd && p.fragmentHint && (n = p.fragmentHint);
        const C = this.getNextPart(w, n, o);
        if (C > -1) {
          const L = w[C];
          ((n = this.fragCurrent = L.fragment),
            this.log(
              "Loading "
                .concat(n.type, " sn: ")
                .concat(n.sn, " part: ")
                .concat(L.index, " (")
                .concat(C, "/")
                .concat(w.length - 1, ") of ")
                .concat(this.fragInfo(n, !1, L), ") cc: ")
                .concat(n.cc, " [")
                .concat(p.startSN, "-")
                .concat(p.endSN, "], target: ")
                .concat(parseFloat(o.toFixed(3))),
            ),
            (this.nextLoadPosition = L.start + L.duration),
            (this.state = Te.FRAG_LOADING));
          let k;
          return (
            d
              ? (k = d
                  .then(O =>
                    !O || this.fragContextChanged(O.frag) ? null : this.doFragPartsLoad(n, L, i, l),
                  )
                  .catch(O => this.handleFragLoadError(O)))
              : (k = this.doFragPartsLoad(n, L, i, l).catch(O => this.handleFragLoadError(O))),
            this.hls.trigger(F.FRAG_LOADING, { frag: n, part: L, targetBufferTime: o }),
            this.fragCurrent === null
              ? Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts"))
              : k
          );
        } else if (!n.url || this.loadedEndOfParts(w, o)) return Promise.resolve(null);
      }
    }
    if (On(n) && this.loadingParts) {
      var v;
      (this.log(
        "LL-Part loading OFF after next part miss @"
          .concat(o.toFixed(2), " Check buffer at sn: ")
          .concat(n.sn, " loaded parts: ")
          .concat(
            (v = p.partList) == null
              ? void 0
              : v.filter(w => w.loaded).map(w => "[".concat(w.start, "-").concat(w.end, "]")),
          ),
      ),
        (this.loadingParts = !1));
    } else if (!n.url) return Promise.resolve(null);
    (this.log(
      "Loading "
        .concat(n.type, " sn: ")
        .concat(n.sn, " of ")
        .concat(this.fragInfo(n, !1), ") cc: ")
        .concat(n.cc, " ")
        .concat("[" + p.startSN + "-" + p.endSN + "]", ", target: ")
        .concat(parseFloat(o.toFixed(3))),
    ),
      Ue(n.sn) && !this.bitrateTest && (this.nextLoadPosition = n.start + n.duration),
      (this.state = Te.FRAG_LOADING));
    const T = this.config.progressive && n.type !== Xe.SUBTITLE;
    let S;
    return (
      T && d
        ? (S = d
            .then(w => (!w || this.fragContextChanged(w.frag) ? null : this.fragmentLoader.load(n, l)))
            .catch(w => this.handleFragLoadError(w)))
        : (S = Promise.all([this.fragmentLoader.load(n, T ? l : void 0), d])
            .then(([w]) => (!T && l && l(w), w))
            .catch(w => this.handleFragLoadError(w))),
      this.hls.trigger(F.FRAG_LOADING, { frag: n, targetBufferTime: o }),
      this.fragCurrent === null
        ? Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING"))
        : S
    );
  }
  doFragPartsLoad(n, i, o, l) {
    return new Promise((h, p) => {
      var d;
      const y = [],
        v = (d = o.details) == null ? void 0 : d.partList,
        T = S => {
          this.fragmentLoader
            .loadPart(n, S, l)
            .then(w => {
              y[S.index] = w;
              const C = w.part;
              this.hls.trigger(F.FRAG_LOADED, w);
              const L = vb(o.details, n.sn, S.index + 1) || tM(v, n.sn, S.index + 1);
              if (L) T(L);
              else return h({ frag: n, part: C, partsLoaded: y });
            })
            .catch(p);
        };
      T(i);
    });
  }
  handleFragLoadError(n) {
    if ("data" in n) {
      const i = n.data;
      i.frag && i.details === ge.INTERNAL_ABORTED
        ? this.handleFragLoadAborted(i.frag, i.part)
        : i.frag && i.type === et.KEY_SYSTEM_ERROR
          ? (i.frag.abortRequests(), this.resetStartWhenNotLoaded(), this.resetFragmentLoading(i.frag))
          : this.hls.trigger(F.ERROR, i);
    } else
      this.hls.trigger(F.ERROR, {
        type: et.OTHER_ERROR,
        details: ge.INTERNAL_EXCEPTION,
        err: n,
        error: n,
        fatal: !0,
      });
    return null;
  }
  _handleTransmuxerFlush(n) {
    const i = this.getCurrentContext(n);
    if (!i || this.state !== Te.PARSING) {
      !this.fragCurrent && this.state !== Te.STOPPED && this.state !== Te.ERROR && (this.state = Te.IDLE);
      return;
    }
    const { frag: o, part: l, level: h } = i,
      p = self.performance.now();
    ((o.stats.parsing.end = p), l && (l.stats.parsing.end = p));
    const d = this.getLevelDetails(),
      v = (d && o.sn > d.endSN) || this.shouldLoadParts(d, o.end);
    (v !== this.loadingParts &&
      (this.log(
        "LL-Part loading "
          .concat(v ? "ON" : "OFF", " after parsing segment ending @")
          .concat(o.end.toFixed(2)),
      ),
      (this.loadingParts = v)),
      this.updateLevelTiming(o, l, h, n.partial));
  }
  shouldLoadParts(n, i) {
    if (this.config.lowLatencyMode) {
      if (!n) return this.loadingParts;
      if (n.partList) {
        var o;
        const h = n.partList[0];
        if (h.fragment.type === Xe.SUBTITLE) return !1;
        const p = h.end + (((o = n.fragmentHint) == null ? void 0 : o.duration) || 0);
        if (i >= p) {
          var l;
          if (
            (this.hls.hasEnoughToStart
              ? ((l = this.media) == null ? void 0 : l.currentTime) || this.lastCurrentTime
              : this.getLoadPosition()) >
            h.start - h.fragment.duration
          )
            return !0;
        }
      }
    }
    return !1;
  }
  getCurrentContext(n) {
    const { levels: i, fragCurrent: o } = this,
      { level: l, sn: h, part: p } = n;
    if (!(i != null && i[l]))
      return (
        this.warn(
          "Levels object was unset while buffering fragment "
            .concat(h, " of ")
            .concat(this.playlistLabel(), " ")
            .concat(l, ". The current chunk will not be buffered."),
        ),
        null
      );
    const d = i[l],
      y = d.details,
      v = p > -1 ? vb(y, h, p) : null,
      T = v ? v.fragment : eM(y, h, o);
    return T ? (o && o !== T && (T.stats = o.stats), { frag: T, part: v, level: d }) : null;
  }
  bufferFragmentData(n, i, o, l, h) {
    if (this.state !== Te.PARSING) return;
    const { data1: p, data2: d } = n;
    let y = p;
    if ((d && (y = Mr(p, d)), !y.length)) return;
    const v = this.initPTS[i.cc],
      T = v ? -v.baseTime / v.timescale : void 0,
      S = { type: n.type, frag: i, part: o, chunkMeta: l, offset: T, parent: i.type, data: y };
    if ((this.hls.trigger(F.BUFFER_APPENDING, S), n.dropped && n.independent && !o)) {
      if (h) return;
      this.flushBufferGap(i);
    }
  }
  flushBufferGap(n) {
    const i = this.media;
    if (!i) return;
    if (!Tt.isBuffered(i, i.currentTime)) {
      this.flushMainBuffer(0, n.start);
      return;
    }
    const o = i.currentTime,
      l = Tt.bufferInfo(i, o, 0),
      h = n.duration,
      p = Math.min(this.config.maxFragLookUpTolerance * 2, h * 0.25),
      d = Math.max(Math.min(n.start - p, l.end - p), o + p);
    n.start - d > p && this.flushMainBuffer(d, n.start);
  }
  getFwdBufferInfo(n, i) {
    var o;
    const l = this.getLoadPosition();
    if (!Ue(l)) return null;
    const p =
      this.lastCurrentTime > l || ((o = this.media) != null && o.paused) ? 0 : this.config.maxBufferHole;
    return this.getFwdBufferInfoAtPos(n, l, i, p);
  }
  getFwdBufferInfoAtPos(n, i, o, l) {
    const h = Tt.bufferInfo(n, i, l);
    if (h.len === 0 && h.nextStart !== void 0) {
      const p = this.fragmentTracker.getBufferedFrag(i, o);
      if (p && (h.nextStart <= p.end || p.gap)) {
        const d = Math.max(Math.min(h.nextStart, p.end) - i, l);
        return Tt.bufferInfo(n, i, d);
      }
    }
    return h;
  }
  getMaxBufferLength(n) {
    const { config: i } = this;
    let o;
    return (
      n ? (o = Math.max((8 * i.maxBufferSize) / n, i.maxBufferLength)) : (o = i.maxBufferLength),
      Math.min(o, i.maxMaxBufferLength)
    );
  }
  reduceMaxBufferLength(n, i) {
    const o = this.config,
      l = Math.max(Math.min(n - i, o.maxBufferLength), i),
      h = Math.max(n - i * 3, o.maxMaxBufferLength / 2, l);
    return h >= l
      ? ((o.maxMaxBufferLength = h), this.warn("Reduce max buffer length to ".concat(h, "s")), !0)
      : !1;
  }
  getAppendedFrag(n, i = Xe.MAIN) {
    const o = this.fragmentTracker ? this.fragmentTracker.getAppendedFrag(n, i) : null;
    return o && "fragment" in o ? o.fragment : o;
  }
  getNextFragment(n, i) {
    const o = i.fragments,
      l = o.length;
    if (!l) return null;
    const { config: h } = this,
      p = o[0].start,
      d = h.lowLatencyMode && !!i.partList;
    let y = null;
    if (i.live) {
      const S = h.initialLiveManifestSize;
      if (l < S)
        return (
          this.warn("Not enough fragments to start playback (have: ".concat(l, ", need: ").concat(S, ")")),
          null
        );
      if ((!i.PTSKnown && !this.startFragRequested && this.startPosition === -1) || n < p) {
        var v;
        (d &&
          !this.loadingParts &&
          (this.log("LL-Part loading ON for initial live fragment"), (this.loadingParts = !0)),
          (y = this.getInitialLiveFragment(i)));
        const w = this.hls.startPosition,
          C = this.hls.liveSyncPosition,
          L = y ? (w !== -1 && w >= p ? w : C) || y.start : n;
        (this.log(
          "Setting startPosition to "
            .concat(L, " to match start frag at live edge. mainStart: ")
            .concat(w, " liveSyncPosition: ")
            .concat(C, " frag.start: ")
            .concat((v = y) == null ? void 0 : v.start),
        ),
          (this.startPosition = this.nextLoadPosition = L));
      }
    } else n <= p && (y = o[0]);
    if (!y) {
      const S = this.loadingParts ? i.partEnd : i.fragmentEnd;
      y = this.getFragmentAtPosition(n, S, i);
    }
    let T = this.filterReplacedPrimary(y, i);
    if (!T && y) {
      const S = y.sn - i.startSN;
      T = this.filterReplacedPrimary(o[S + 1] || null, i);
    }
    return this.mapToInitFragWhenRequired(T);
  }
  isLoopLoading(n, i) {
    const o = this.fragmentTracker.getState(n);
    return (o === ei.OK || (o === ei.PARTIAL && !!n.gap)) && this.nextLoadPosition > i;
  }
  getNextFragmentLoopLoading(n, i, o, l, h) {
    let p = null;
    if (n.gap && ((p = this.getNextFragment(this.nextLoadPosition, i)), p && !p.gap && o.nextStart)) {
      const d = this.getFwdBufferInfoAtPos(
        this.mediaBuffer ? this.mediaBuffer : this.media,
        o.nextStart,
        l,
        0,
      );
      if (d !== null && o.len + d.len >= h) {
        const y = p.sn;
        return (
          this.loopSn !== y &&
            (this.log('buffer full after gaps in "'.concat(l, '" playlist starting at sn: ').concat(y)),
            (this.loopSn = y)),
          null
        );
      }
    }
    return ((this.loopSn = void 0), p);
  }
  get primaryPrefetch() {
    if (Sb(this.config)) {
      var n;
      if ((n = this.hls.interstitialsManager) == null || (n = n.playingItem) == null ? void 0 : n.event)
        return !0;
    }
    return !1;
  }
  filterReplacedPrimary(n, i) {
    if (!n) return n;
    if (Sb(this.config) && n.type !== Xe.SUBTITLE) {
      const o = this.hls.interstitialsManager,
        l = o == null ? void 0 : o.bufferingItem;
      if (l) {
        const p = l.event;
        if (p) {
          if (p.appendInPlace || Math.abs(n.start - l.start) > 1 || l.start === 0) return null;
        } else if (
          (n.end <= l.start && (i == null ? void 0 : i.live) === !1) ||
          (n.start > l.end && l.nextEvent && (l.nextEvent.appendInPlace || n.start - l.end > 1))
        )
          return null;
      }
      const h = o == null ? void 0 : o.playerQueue;
      if (h)
        for (let p = h.length; p--; ) {
          const d = h[p].interstitial;
          if (d.appendInPlace && n.start >= d.startTime && n.end <= d.resumeTime) return null;
        }
    }
    return n;
  }
  mapToInitFragWhenRequired(n) {
    return n != null && n.initSegment && !n.initSegment.data && !this.bitrateTest ? n.initSegment : n;
  }
  getNextPart(n, i, o) {
    let l = -1,
      h = !1,
      p = !0;
    for (let d = 0, y = n.length; d < y; d++) {
      const v = n[d];
      if (((p = p && !v.independent), l > -1 && o < v.start)) break;
      const T = v.loaded;
      (T
        ? (l = -1)
        : (h || ((v.independent || p) && v.fragment === i)) &&
          (v.fragment !== i &&
            this.warn("Need buffer at ".concat(o, " but next unloaded part starts at ").concat(v.start)),
          (l = d)),
        (h = T));
    }
    return l;
  }
  loadedEndOfParts(n, i) {
    let o;
    for (let l = n.length; l--; ) {
      if (((o = n[l]), !o.loaded)) return !1;
      if (i > o.start) return !0;
    }
    return !1;
  }
  getInitialLiveFragment(n) {
    const i = n.fragments,
      o = this.fragPrevious;
    let l = null;
    if (o) {
      if (
        (n.hasProgramDateTime &&
          (this.log("Live playlist, switching playlist, load frag with same PDT: ".concat(o.programDateTime)),
          (l = WH(i, o.endProgramDateTime, this.config.maxFragLookUpTolerance))),
        !l)
      ) {
        const h = o.sn + 1;
        if (h >= n.startSN && h <= n.endSN) {
          const p = i[h - n.startSN];
          o.cc === p.cc &&
            ((l = p), this.log("Live playlist, switching playlist, load frag with next SN: ".concat(l.sn)));
        }
        l ||
          ((l = $k(n, o.cc, o.end)),
          l && this.log("Live playlist, switching playlist, load frag with same CC: ".concat(l.sn)));
      }
    } else {
      const h = this.hls.liveSyncPosition;
      h !== null && (l = this.getFragmentAtPosition(h, this.bitrateTest ? n.fragmentEnd : n.edge, n));
    }
    return l;
  }
  getFragmentAtPosition(n, i, o) {
    const { config: l } = this;
    let { fragPrevious: h } = this,
      { fragments: p, endSN: d } = o;
    const { fragmentHint: y } = o,
      { maxFragLookUpTolerance: v } = l,
      T = o.partList,
      S = !!(this.loadingParts && T != null && T.length && y);
    S && !this.bitrateTest && T[T.length - 1].fragment.sn === y.sn && ((p = p.concat(y)), (d = y.sn));
    let w;
    if (n < i) {
      var C;
      const k =
        n < this.lastCurrentTime ||
        n > i - v ||
        ((C = this.media) != null && C.paused) ||
        !this.startFragRequested
          ? 0
          : v;
      w = Aa(h, p, n, k);
    } else w = p[p.length - 1];
    if (w) {
      const L = w.sn - o.startSN,
        k = this.fragmentTracker.getState(w);
      if (
        ((k === ei.OK || (k === ei.PARTIAL && w.gap)) && (h = w),
        h && w.sn === h.sn && (!S || T[0].fragment.sn > w.sn || !o.live) && w.level === h.level)
      ) {
        const B = p[L + 1];
        w.sn < d && this.fragmentTracker.getState(B) !== ei.OK ? (w = B) : (w = null);
      }
    }
    return w;
  }
  alignPlaylists(n, i, o) {
    const l = n.fragments.length;
    if (!l) return (this.warn("No fragments in live playlist"), 0);
    const h = n.fragmentStart,
      p = !i,
      d = n.alignedSliding && Ue(h);
    if (p || (!d && !h)) {
      _K(o, n);
      const y = n.fragmentStart;
      return (
        this.log(
          "Live playlist sliding: "
            .concat(y.toFixed(2), " start-sn: ")
            .concat(i ? i.startSN : "na", "->")
            .concat(n.startSN, " fragments: ")
            .concat(l),
        ),
        y
      );
    }
    return h;
  }
  waitForCdnTuneIn(n) {
    return (
      n.live && n.canBlockReload && n.partTarget && n.tuneInGoal > Math.max(n.partHoldBack, n.partTarget * 3)
    );
  }
  setStartPosition(n, i) {
    let o = this.startPosition;
    o < i && (o = -1);
    const l = this.timelineOffset;
    if (o === -1) {
      const h = this.startTimeOffset !== null,
        p = h ? this.startTimeOffset : n.startTimeOffset;
      (p !== null && Ue(p)
        ? ((o = i + p),
          p < 0 && (o += n.edge),
          (o = Math.min(Math.max(i, o), i + n.totalduration)),
          this.log(
            "Setting startPosition to "
              .concat(o, " for start time offset ")
              .concat(p, " found in ")
              .concat(h ? "multivariant" : "media", " playlist"),
          ),
          (this.startPosition = o))
        : n.live
          ? ((o = this.hls.liveSyncPosition || i),
            this.log("Setting startPosition to -1 to start at live edge ".concat(o)),
            (this.startPosition = -1))
          : (this.log("setting startPosition to 0 by default"), (this.startPosition = o = 0)),
        (this.lastCurrentTime = o + l));
    }
    this.nextLoadPosition = o + l;
  }
  getLoadPosition() {
    var n;
    const { media: i } = this;
    let o = 0;
    return (
      (n = this.hls) != null && n.hasEnoughToStart && i
        ? (o = i.currentTime)
        : this.nextLoadPosition >= 0 && (o = this.nextLoadPosition),
      o
    );
  }
  handleFragLoadAborted(n, i) {
    this.transmuxer &&
      n.type === this.playlistType &&
      On(n) &&
      n.stats.aborted &&
      (this.log(
        "Fragment "
          .concat(n.sn)
          .concat(i ? " part " + i.index : "", " of ")
          .concat(this.playlistLabel(), " ")
          .concat(n.level, " was aborted"),
      ),
      this.resetFragmentLoading(n));
  }
  resetFragmentLoading(n) {
    (!this.fragCurrent || (!this.fragContextChanged(n) && this.state !== Te.FRAG_LOADING_WAITING_RETRY)) &&
      (this.state = Te.IDLE);
  }
  onFragmentOrKeyLoadError(n, i) {
    var o;
    if (i.chunkMeta && !i.frag) {
      const B = this.getCurrentContext(i.chunkMeta);
      B && (i.frag = B.frag);
    }
    const l = i.frag;
    if (!l || l.type !== n || !this.levels) return;
    if (this.fragContextChanged(l)) {
      var h;
      this.warn(
        "Frag load error must match current frag to retry "
          .concat(l.url, " > ")
          .concat((h = this.fragCurrent) == null ? void 0 : h.url),
      );
      return;
    }
    const p = i.details === ge.FRAG_GAP;
    p && this.fragmentTracker.fragBuffered(l, !0);
    const d = i.errorAction;
    if (!d) {
      this.state = Te.ERROR;
      return;
    }
    const { action: y, flags: v, retryCount: T = 0, retryConfig: S } = d,
      w = !!S,
      C = w && y === mi.RetryRequest,
      L = w && !d.resolved && v === vr.MoveAllAlternatesMatchingHost,
      k = (o = this.hls.latestLevelDetails) == null ? void 0 : o.live;
    if (!C && L && On(l) && !l.endList && k && !jk(i))
      (this.resetFragmentErrors(n), this.treatAsGap(l), (d.resolved = !0));
    else if ((C || L) && T < S.maxNumRetry) {
      var O;
      const B = LT((O = i.response) == null ? void 0 : O.code),
        N = hS(S, T);
      if (
        (this.resetStartWhenNotLoaded(),
        (this.retryDate = self.performance.now() + N),
        (this.state = Te.FRAG_LOADING_WAITING_RETRY),
        (d.resolved = !0),
        B)
      ) {
        (this.log("Waiting for connection (offline)"), (this.retryDate = 1 / 0), (i.reason = "offline"));
        return;
      }
      this.warn(
        "Fragment "
          .concat(l.sn, " of ")
          .concat(n, " ")
          .concat(l.level, " errored with ")
          .concat(i.details, ", retrying loading ")
          .concat(T + 1, "/")
          .concat(S.maxNumRetry, " in ")
          .concat(N, "ms"),
      );
    } else if (S)
      if ((this.resetFragmentErrors(n), T < S.maxNumRetry))
        !p && y !== mi.RemoveAlternatePermanently && (d.resolved = !0);
      else {
        this.warn("".concat(i.details, " reached or exceeded max retry (").concat(T, ")"));
        return;
      }
    else y === mi.SendAlternateToPenaltyBox ? (this.state = Te.WAITING_LEVEL) : (this.state = Te.ERROR);
    this.tickImmediate();
  }
  checkRetryDate() {
    const n = self.performance.now(),
      i = this.retryDate,
      o = i === 1 / 0;
    (!i || n >= i || (o && !LT(0))) &&
      (o && this.log("Connection restored (online)"), this.resetStartWhenNotLoaded(), (this.state = Te.IDLE));
  }
  reduceLengthAndFlushBuffer(n) {
    if (this.state === Te.PARSING || this.state === Te.PARSED) {
      const i = n.frag,
        o = n.parent,
        l = this.getFwdBufferInfo(this.mediaBuffer, o),
        h = l && l.len > 0.5;
      h && this.reduceMaxBufferLength(l.len, (i == null ? void 0 : i.duration) || 10);
      const p = !h;
      return (
        p &&
          this.warn(
            "Buffer full error while media.currentTime ("
              .concat(this.getLoadPosition(), ") is not buffered, flush ")
              .concat(o, " buffer"),
          ),
        i && (this.fragmentTracker.removeFragment(i), (this.nextLoadPosition = i.start)),
        this.resetLoadingState(),
        p
      );
    }
    return !1;
  }
  resetFragmentErrors(n) {
    (n === Xe.AUDIO && (this.fragCurrent = null),
      this.hls.hasEnoughToStart || (this.startFragRequested = !1),
      this.state !== Te.STOPPED && (this.state = Te.IDLE));
  }
  afterBufferFlushed(n, i, o) {
    if (!n) return;
    const l = Tt.getBuffered(n);
    (this.fragmentTracker.detectEvictedFragments(i, l, o),
      this.state === Te.ENDED && this.resetLoadingState());
  }
  resetLoadingState() {
    (this.log("Reset loading state"),
      (this.fragCurrent = null),
      (this.fragPrevious = null),
      this.state !== Te.STOPPED && (this.state = Te.IDLE));
  }
  resetStartWhenNotLoaded() {
    if (!this.hls.hasEnoughToStart) {
      this.startFragRequested = !1;
      const n = this.levelLastLoaded,
        i = n ? n.details : null;
      i != null && i.live
        ? (this.log("resetting startPosition for live start"),
          (this.startPosition = -1),
          this.setStartPosition(i, i.fragmentStart),
          this.resetLoadingState())
        : (this.nextLoadPosition = this.startPosition);
    }
  }
  resetWhenMissingContext(n) {
    (this.log(
      "Loading context changed while buffering sn "
        .concat(n.sn, " of ")
        .concat(this.playlistLabel(), " ")
        .concat(n.level === -1 ? "<removed>" : n.level, ". This chunk will not be buffered."),
    ),
      this.removeUnbufferedFrags(),
      this.resetStartWhenNotLoaded(),
      this.resetLoadingState());
  }
  removeUnbufferedFrags(n = 0) {
    this.fragmentTracker.removeFragmentsInRange(n, 1 / 0, this.playlistType, !1, !0);
  }
  updateLevelTiming(n, i, o, l) {
    const h = o.details;
    if (!h) {
      this.warn("level.details undefined");
      return;
    }
    if (
      !Object.keys(n.elementaryStreams).reduce((y, v) => {
        const T = n.elementaryStreams[v];
        if (T) {
          const S = T.endPTS - T.startPTS;
          if (S <= 0)
            return (
              this.warn(
                "Could not parse fragment "
                  .concat(n.sn, " ")
                  .concat(v, " duration reliably (")
                  .concat(S, ")"),
              ),
              y || !1
            );
          const w = l ? 0 : Qk(h, n, T.startPTS, T.endPTS, T.startDTS, T.endDTS, this);
          return (
            this.hls.trigger(F.LEVEL_PTS_UPDATED, {
              details: h,
              level: o,
              drift: w,
              type: v,
              frag: n,
              start: T.startPTS,
              end: T.endPTS,
            }),
            !0
          );
        }
        return y;
      }, !1)
    ) {
      var d;
      const y = ((d = this.transmuxer) == null ? void 0 : d.error) === null;
      if (
        ((o.fragmentError === 0 || (y && (o.fragmentError < 2 || n.endList))) && this.treatAsGap(n, o), y)
      ) {
        const v = new Error(
          "Found no media in fragment "
            .concat(n.sn, " of ")
            .concat(this.playlistLabel(), " ")
            .concat(n.level, " resetting transmuxer to fallback to playlist timing"),
        );
        if (
          (this.warn(v.message),
          this.hls.trigger(F.ERROR, {
            type: et.MEDIA_ERROR,
            details: ge.FRAG_PARSING_ERROR,
            fatal: !1,
            error: v,
            frag: n,
            reason: "Found no media in msn "
              .concat(n.sn, " of ")
              .concat(this.playlistLabel(), ' "')
              .concat(o.url, '"'),
          }),
          !this.hls)
        )
          return;
        this.resetTransmuxer();
      }
    }
    ((this.state = Te.PARSED),
      this.log(
        "Parsed "
          .concat(n.type, " sn: ")
          .concat(n.sn)
          .concat(i ? " part: " + i.index : "", " of ")
          .concat(this.fragInfo(n, !1, i), ")"),
      ),
      this.hls.trigger(F.FRAG_PARSED, { frag: n, part: i }));
  }
  playlistLabel() {
    return this.playlistType === Xe.MAIN ? "level" : "track";
  }
  fragInfo(n, i = !0, o) {
    var l, h;
    return ""
      .concat(this.playlistLabel(), " ")
      .concat(n.level, " (")
      .concat(o ? "part" : "frag", ":[")
      .concat(((l = i && !o ? n.startPTS : (o || n).start) != null ? l : NaN).toFixed(3), "-")
      .concat(((h = i && !o ? n.endPTS : (o || n).end) != null ? h : NaN).toFixed(3), "]")
      .concat(o && n.type === "main" ? "INDEPENDENT=" + (o.independent ? "YES" : "NO") : "");
  }
  treatAsGap(n, i) {
    (i && i.fragmentError++,
      (n.gap = !0),
      this.fragmentTracker.removeFragment(n),
      this.fragmentTracker.fragBuffered(n, !0));
  }
  resetTransmuxer() {
    var n;
    (n = this.transmuxer) == null || n.reset();
  }
  recoverWorkerError(n) {
    n.event === "demuxerWorker" &&
      (this.fragmentTracker.removeAllFragments(),
      this.transmuxer && (this.transmuxer.destroy(), (this.transmuxer = null)),
      this.resetStartWhenNotLoaded(),
      this.resetLoadingState());
  }
  set state(n) {
    const i = this._state;
    i !== n && ((this._state = n), this.log("".concat(i, "->").concat(n)));
  }
  get state() {
    return this._state;
  }
}
function Sb(u) {
  return !!u.interstitialsController && u.enableInterstitialPlayback !== !1;
}
class sM {
  constructor() {
    ((this.chunks = []), (this.dataLength = 0));
  }
  push(n) {
    (this.chunks.push(n), (this.dataLength += n.length));
  }
  flush() {
    const { chunks: n, dataLength: i } = this;
    let o;
    if (n.length) n.length === 1 ? (o = n[0]) : (o = DK(n, i));
    else return new Uint8Array(0);
    return (this.reset(), o);
  }
  reset() {
    ((this.chunks.length = 0), (this.dataLength = 0));
  }
}
function DK(u, n) {
  const i = new Uint8Array(n);
  let o = 0;
  for (let l = 0; l < u.length; l++) {
    const h = u[l];
    (i.set(h, o), (o += h.length));
  }
  return i;
}
var Mx = { exports: {} },
  Eb;
function kK() {
  return (
    Eb ||
      ((Eb = 1),
      (function (u) {
        var n = Object.prototype.hasOwnProperty,
          i = "~";
        function o() {}
        Object.create && ((o.prototype = Object.create(null)), new o().__proto__ || (i = !1));
        function l(y, v, T) {
          ((this.fn = y), (this.context = v), (this.once = T || !1));
        }
        function h(y, v, T, S, w) {
          if (typeof T != "function") throw new TypeError("The listener must be a function");
          var C = new l(T, S || y, w),
            L = i ? i + v : v;
          return (
            y._events[L]
              ? y._events[L].fn
                ? (y._events[L] = [y._events[L], C])
                : y._events[L].push(C)
              : ((y._events[L] = C), y._eventsCount++),
            y
          );
        }
        function p(y, v) {
          --y._eventsCount === 0 ? (y._events = new o()) : delete y._events[v];
        }
        function d() {
          ((this._events = new o()), (this._eventsCount = 0));
        }
        ((d.prototype.eventNames = function () {
          var v = [],
            T,
            S;
          if (this._eventsCount === 0) return v;
          for (S in (T = this._events)) n.call(T, S) && v.push(i ? S.slice(1) : S);
          return Object.getOwnPropertySymbols ? v.concat(Object.getOwnPropertySymbols(T)) : v;
        }),
          (d.prototype.listeners = function (v) {
            var T = i ? i + v : v,
              S = this._events[T];
            if (!S) return [];
            if (S.fn) return [S.fn];
            for (var w = 0, C = S.length, L = new Array(C); w < C; w++) L[w] = S[w].fn;
            return L;
          }),
          (d.prototype.listenerCount = function (v) {
            var T = i ? i + v : v,
              S = this._events[T];
            return S ? (S.fn ? 1 : S.length) : 0;
          }),
          (d.prototype.emit = function (v, T, S, w, C, L) {
            var k = i ? i + v : v;
            if (!this._events[k]) return !1;
            var O = this._events[k],
              B = arguments.length,
              N,
              $;
            if (O.fn) {
              switch ((O.once && this.removeListener(v, O.fn, void 0, !0), B)) {
                case 1:
                  return (O.fn.call(O.context), !0);
                case 2:
                  return (O.fn.call(O.context, T), !0);
                case 3:
                  return (O.fn.call(O.context, T, S), !0);
                case 4:
                  return (O.fn.call(O.context, T, S, w), !0);
                case 5:
                  return (O.fn.call(O.context, T, S, w, C), !0);
                case 6:
                  return (O.fn.call(O.context, T, S, w, C, L), !0);
              }
              for ($ = 1, N = new Array(B - 1); $ < B; $++) N[$ - 1] = arguments[$];
              O.fn.apply(O.context, N);
            } else {
              var I = O.length,
                V;
              for ($ = 0; $ < I; $++)
                switch ((O[$].once && this.removeListener(v, O[$].fn, void 0, !0), B)) {
                  case 1:
                    O[$].fn.call(O[$].context);
                    break;
                  case 2:
                    O[$].fn.call(O[$].context, T);
                    break;
                  case 3:
                    O[$].fn.call(O[$].context, T, S);
                    break;
                  case 4:
                    O[$].fn.call(O[$].context, T, S, w);
                    break;
                  default:
                    if (!N) for (V = 1, N = new Array(B - 1); V < B; V++) N[V - 1] = arguments[V];
                    O[$].fn.apply(O[$].context, N);
                }
            }
            return !0;
          }),
          (d.prototype.on = function (v, T, S) {
            return h(this, v, T, S, !1);
          }),
          (d.prototype.once = function (v, T, S) {
            return h(this, v, T, S, !0);
          }),
          (d.prototype.removeListener = function (v, T, S, w) {
            var C = i ? i + v : v;
            if (!this._events[C]) return this;
            if (!T) return (p(this, C), this);
            var L = this._events[C];
            if (L.fn) L.fn === T && (!w || L.once) && (!S || L.context === S) && p(this, C);
            else {
              for (var k = 0, O = [], B = L.length; k < B; k++)
                (L[k].fn !== T || (w && !L[k].once) || (S && L[k].context !== S)) && O.push(L[k]);
              O.length ? (this._events[C] = O.length === 1 ? O[0] : O) : p(this, C);
            }
            return this;
          }),
          (d.prototype.removeAllListeners = function (v) {
            var T;
            return (
              v
                ? ((T = i ? i + v : v), this._events[T] && p(this, T))
                : ((this._events = new o()), (this._eventsCount = 0)),
              this
            );
          }),
          (d.prototype.off = d.prototype.removeListener),
          (d.prototype.addListener = d.prototype.on),
          (d.prefixed = i),
          (d.EventEmitter = d),
          (u.exports = d));
      })(Mx)),
    Mx.exports
  );
}
var MK = kK(),
  vS = rH(MK);
const _d = "1.6.15",
  cu = {};
function PK() {
  return typeof __HLS_WORKER_BUNDLE__ == "function";
}
function OK() {
  const u = cu[_d];
  if (u) return (u.clientCount++, u);
  const n = new self.Blob(
      [
        "var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(".concat(
          __HLS_WORKER_BUNDLE__.toString(),
          ")(true);",
        ),
      ],
      { type: "text/javascript" },
    ),
    i = self.URL.createObjectURL(n),
    l = { worker: new self.Worker(i), objectURL: i, clientCount: 1 };
  return ((cu[_d] = l), l);
}
function NK(u) {
  const n = cu[u];
  if (n) return (n.clientCount++, n);
  const i = new self.URL(u, self.location.href).href,
    l = { worker: new self.Worker(i), scriptURL: i, clientCount: 1 };
  return ((cu[u] = l), l);
}
function FK(u) {
  const n = cu[u || _d];
  if (n && n.clientCount-- === 1) {
    const { worker: o, objectURL: l } = n;
    (delete cu[u || _d], l && self.URL.revokeObjectURL(l), o.terminate());
  }
}
function oM(u, n) {
  return (
    n + 10 <= u.length &&
    u[n] === 51 &&
    u[n + 1] === 68 &&
    u[n + 2] === 73 &&
    u[n + 3] < 255 &&
    u[n + 4] < 255 &&
    u[n + 6] < 128 &&
    u[n + 7] < 128 &&
    u[n + 8] < 128 &&
    u[n + 9] < 128
  );
}
function xS(u, n) {
  return (
    n + 10 <= u.length &&
    u[n] === 73 &&
    u[n + 1] === 68 &&
    u[n + 2] === 51 &&
    u[n + 3] < 255 &&
    u[n + 4] < 255 &&
    u[n + 6] < 128 &&
    u[n + 7] < 128 &&
    u[n + 8] < 128 &&
    u[n + 9] < 128
  );
}
function sm(u, n) {
  let i = 0;
  return (
    (i = (u[n] & 127) << 21),
    (i |= (u[n + 1] & 127) << 14),
    (i |= (u[n + 2] & 127) << 7),
    (i |= u[n + 3] & 127),
    i
  );
}
function bd(u, n) {
  const i = n;
  let o = 0;
  for (; xS(u, n); ) {
    o += 10;
    const l = sm(u, n + 6);
    ((o += l), oM(u, n + 10) && (o += 10), (n += o));
  }
  if (o > 0) return u.subarray(i, i + o);
}
function UK(u, n, i, o) {
  const l = [96e3, 88200, 64e3, 48e3, 44100, 32e3, 24e3, 22050, 16e3, 12e3, 11025, 8e3, 7350],
    h = n[i + 2],
    p = (h >> 2) & 15;
  if (p > 12) {
    const C = new Error("invalid ADTS sampling index:".concat(p));
    u.emit(F.ERROR, F.ERROR, {
      type: et.MEDIA_ERROR,
      details: ge.FRAG_PARSING_ERROR,
      fatal: !0,
      error: C,
      reason: C.message,
    });
    return;
  }
  const d = ((h >> 6) & 3) + 1,
    y = ((n[i + 3] >> 6) & 3) | ((h & 1) << 2),
    v = "mp4a.40." + d,
    T = l[p];
  let S = p;
  (d === 5 || d === 29) && (S -= 3);
  const w = [(d << 3) | ((S & 14) >> 1), ((S & 1) << 7) | (y << 3)];
  return (
    Zt.log(
      "manifest codec:"
        .concat(o, ", parsed codec:")
        .concat(v, ", channels:")
        .concat(y, ", rate:")
        .concat(T, " (ADTS object type:")
        .concat(d, " sampling index:")
        .concat(p, ")"),
    ),
    { config: w, samplerate: T, channelCount: y, codec: v, parsedCodec: v, manifestCodec: o }
  );
}
function aM(u, n) {
  return u[n] === 255 && (u[n + 1] & 246) === 240;
}
function lM(u, n) {
  return u[n + 1] & 1 ? 7 : 9;
}
function TS(u, n) {
  return ((u[n + 3] & 3) << 11) | (u[n + 4] << 3) | ((u[n + 5] & 224) >>> 5);
}
function BK(u, n) {
  return n + 5 < u.length;
}
function Hg(u, n) {
  return n + 1 < u.length && aM(u, n);
}
function $K(u, n) {
  return BK(u, n) && aM(u, n) && TS(u, n) <= u.length - n;
}
function GK(u, n) {
  if (Hg(u, n)) {
    const i = lM(u, n);
    if (n + i >= u.length) return !1;
    const o = TS(u, n);
    if (o <= i) return !1;
    const l = n + o;
    return l === u.length || Hg(u, l);
  }
  return !1;
}
function uM(u, n, i, o, l) {
  if (!u.samplerate) {
    const h = UK(n, i, o, l);
    if (!h) return;
    rn(u, h);
  }
}
function cM(u) {
  return (1024 * 9e4) / u;
}
function jK(u, n) {
  const i = lM(u, n);
  if (n + i <= u.length) {
    const o = TS(u, n) - i;
    if (o > 0) return { headerLength: i, frameLength: o };
  }
}
function dM(u, n, i, o, l) {
  const h = cM(u.samplerate),
    p = o + l * h,
    d = jK(n, i);
  let y;
  if (d) {
    const { frameLength: S, headerLength: w } = d,
      C = w + S,
      L = Math.max(0, i + C - n.length);
    L ? ((y = new Uint8Array(C - w)), y.set(n.subarray(i + w, n.length), 0)) : (y = n.subarray(i + w, i + C));
    const k = { unit: y, pts: p };
    return (L || u.samples.push(k), { sample: k, length: C, missing: L });
  }
  const v = n.length - i;
  return (
    (y = new Uint8Array(v)),
    y.set(n.subarray(i, n.length), 0),
    { sample: { unit: y, pts: p }, length: v, missing: -1 }
  );
}
function VK(u, n) {
  return xS(u, n) && sm(u, n + 6) + 10 <= u.length - n;
}
function HK(u) {
  return u instanceof ArrayBuffer
    ? u
    : u.byteOffset == 0 && u.byteLength == u.buffer.byteLength
      ? u.buffer
      : new Uint8Array(u).buffer;
}
function Px(u, n = 0, i = 1 / 0) {
  return KK(u, n, i, Uint8Array);
}
function KK(u, n, i, o) {
  const l = WK(u);
  let h = 1;
  "BYTES_PER_ELEMENT" in o && (h = o.BYTES_PER_ELEMENT);
  const p = zK(u) ? u.byteOffset : 0,
    d = (p + u.byteLength) / h,
    y = (p + n) / h,
    v = Math.floor(Math.max(0, Math.min(y, d))),
    T = Math.floor(Math.min(v + Math.max(i, 0), d));
  return new o(l, v, T - v);
}
function WK(u) {
  return u instanceof ArrayBuffer ? u : u.buffer;
}
function zK(u) {
  return u && u.buffer instanceof ArrayBuffer && u.byteLength !== void 0 && u.byteOffset !== void 0;
}
function YK(u) {
  const n = { key: u.type, description: "", data: "", mimeType: null, pictureType: null },
    i = 3;
  if (u.size < 2) return;
  if (u.data[0] !== i) {
    console.log("Ignore frame with unrecognized character encoding");
    return;
  }
  const o = u.data.subarray(1).indexOf(0);
  if (o === -1) return;
  const l = Sr(Px(u.data, 1, o)),
    h = u.data[2 + o],
    p = u.data.subarray(3 + o).indexOf(0);
  if (p === -1) return;
  const d = Sr(Px(u.data, 3 + o, p));
  let y;
  return (
    l === "-->" ? (y = Sr(Px(u.data, 4 + o + p))) : (y = HK(u.data.subarray(4 + o + p))),
    (n.mimeType = l),
    (n.pictureType = h),
    (n.description = d),
    (n.data = y),
    n
  );
}
function XK(u) {
  if (u.size < 2) return;
  const n = Sr(u.data, !0),
    i = new Uint8Array(u.data.subarray(n.length + 1));
  return { key: u.type, info: n, data: i.buffer };
}
function qK(u) {
  if (u.size < 2) return;
  if (u.type === "TXXX") {
    let i = 1;
    const o = Sr(u.data.subarray(i), !0);
    i += o.length + 1;
    const l = Sr(u.data.subarray(i));
    return { key: u.type, info: o, data: l };
  }
  const n = Sr(u.data.subarray(1));
  return { key: u.type, info: "", data: n };
}
function QK(u) {
  if (u.type === "WXXX") {
    if (u.size < 2) return;
    let i = 1;
    const o = Sr(u.data.subarray(i), !0);
    i += o.length + 1;
    const l = Sr(u.data.subarray(i));
    return { key: u.type, info: o, data: l };
  }
  const n = Sr(u.data);
  return { key: u.type, info: "", data: n };
}
function JK(u) {
  return u.type === "PRIV" ? XK(u) : u.type[0] === "W" ? QK(u) : u.type === "APIC" ? YK(u) : qK(u);
}
function ZK(u) {
  const n = String.fromCharCode(u[0], u[1], u[2], u[3]),
    i = sm(u, 4),
    o = 10;
  return { type: n, size: i, data: u.subarray(o, o + i) };
}
const Wp = 10,
  e9 = 10;
function hM(u) {
  let n = 0;
  const i = [];
  for (; xS(u, n); ) {
    const o = sm(u, n + 6);
    ((u[n + 5] >> 6) & 1 && (n += Wp), (n += Wp));
    const l = n + o;
    for (; n + e9 < l; ) {
      const h = ZK(u.subarray(n)),
        p = JK(h);
      (p && i.push(p), (n += h.size + Wp));
    }
    oM(u, n) && (n += Wp);
  }
  return i;
}
function fM(u) {
  return u && u.key === "PRIV" && u.info === "com.apple.streaming.transportStreamTimestamp";
}
function t9(u) {
  if (u.data.byteLength === 8) {
    const n = new Uint8Array(u.data),
      i = n[3] & 1;
    let o = (n[4] << 23) + (n[5] << 15) + (n[6] << 7) + n[7];
    return ((o /= 45), i && (o += 4772185884e-2), Math.round(o));
  }
}
function SS(u) {
  const n = hM(u);
  for (let i = 0; i < n.length; i++) {
    const o = n[i];
    if (fM(o)) return t9(o);
  }
}
let Tr = (function (u) {
  return (
    (u.audioId3 = "org.id3"),
    (u.dateRange = "com.apple.quicktime.HLS"),
    (u.emsg = "https://aomedia.org/emsg/ID3"),
    (u.misbklv = "urn:misb:KLV:bin:1910.1"),
    u
  );
})({});
function as(u = "", n = 9e4) {
  return { type: u, id: -1, pid: -1, inputTimeScale: n, sequenceNumber: -1, samples: [], dropped: 0 };
}
class ES {
  constructor() {
    ((this._audioTrack = void 0),
      (this._id3Track = void 0),
      (this.frameIndex = 0),
      (this.cachedData = null),
      (this.basePTS = null),
      (this.initPTS = null),
      (this.lastPTS = null));
  }
  resetInitSegment(n, i, o, l) {
    this._id3Track = {
      type: "id3",
      id: 3,
      pid: -1,
      inputTimeScale: 9e4,
      sequenceNumber: 0,
      samples: [],
      dropped: 0,
    };
  }
  resetTimeStamp(n) {
    ((this.initPTS = n), this.resetContiguity());
  }
  resetContiguity() {
    ((this.basePTS = null), (this.lastPTS = null), (this.frameIndex = 0));
  }
  canParse(n, i) {
    return !1;
  }
  appendFrame(n, i, o) {}
  demux(n, i) {
    this.cachedData && ((n = Mr(this.cachedData, n)), (this.cachedData = null));
    let o = bd(n, 0),
      l = o ? o.length : 0,
      h;
    const p = this._audioTrack,
      d = this._id3Track,
      y = o ? SS(o) : void 0,
      v = n.length;
    for (
      (this.basePTS === null || (this.frameIndex === 0 && Ue(y))) &&
        ((this.basePTS = n9(y, i, this.initPTS)), (this.lastPTS = this.basePTS)),
        this.lastPTS === null && (this.lastPTS = this.basePTS),
        o &&
          o.length > 0 &&
          d.samples.push({
            pts: this.lastPTS,
            dts: this.lastPTS,
            data: o,
            type: Tr.audioId3,
            duration: Number.POSITIVE_INFINITY,
          });
      l < v;
    ) {
      if (this.canParse(n, l)) {
        const T = this.appendFrame(p, n, l);
        T ? (this.frameIndex++, (this.lastPTS = T.sample.pts), (l += T.length), (h = l)) : (l = v);
      } else
        VK(n, l)
          ? ((o = bd(n, l)),
            d.samples.push({
              pts: this.lastPTS,
              dts: this.lastPTS,
              data: o,
              type: Tr.audioId3,
              duration: Number.POSITIVE_INFINITY,
            }),
            (l += o.length),
            (h = l))
          : l++;
      if (l === v && h !== v) {
        const T = n.slice(h);
        this.cachedData ? (this.cachedData = Mr(this.cachedData, T)) : (this.cachedData = T);
      }
    }
    return { audioTrack: p, videoTrack: as(), id3Track: d, textTrack: as() };
  }
  demuxSampleAes(n, i, o) {
    return Promise.reject(
      new Error("[".concat(this, "] This demuxer does not support Sample-AES decryption")),
    );
  }
  flush(n) {
    const i = this.cachedData;
    return (
      i && ((this.cachedData = null), this.demux(i, 0)),
      { audioTrack: this._audioTrack, videoTrack: as(), id3Track: this._id3Track, textTrack: as() }
    );
  }
  destroy() {
    ((this.cachedData = null), (this._audioTrack = this._id3Track = void 0));
  }
}
const n9 = (u, n, i) => {
  if (Ue(u)) return u * 90;
  const o = i ? (i.baseTime * 9e4) / i.timescale : 0;
  return n * 9e4 + o;
};
let zp = null;
const i9 = [
    32, 64, 96, 128, 160, 192, 224, 256, 288, 320, 352, 384, 416, 448, 32, 48, 56, 64, 80, 96, 112, 128, 160,
    192, 224, 256, 320, 384, 32, 40, 48, 56, 64, 80, 96, 112, 128, 160, 192, 224, 256, 320, 32, 48, 56, 64,
    80, 96, 112, 128, 144, 160, 176, 192, 224, 256, 8, 16, 24, 32, 40, 48, 56, 64, 80, 96, 112, 128, 144, 160,
  ],
  r9 = [44100, 48e3, 32e3, 22050, 24e3, 16e3, 11025, 12e3, 8e3],
  s9 = [
    [0, 72, 144, 12],
    [0, 0, 0, 0],
    [0, 72, 144, 12],
    [0, 144, 144, 12],
  ],
  o9 = [0, 1, 1, 4];
function pM(u, n, i, o, l) {
  if (i + 24 > n.length) return;
  const h = gM(n, i);
  if (h && i + h.frameLength <= n.length) {
    const p = (h.samplesPerFrame * 9e4) / h.sampleRate,
      d = o + l * p,
      y = { unit: n.subarray(i, i + h.frameLength), pts: d, dts: d };
    return (
      (u.config = []),
      (u.channelCount = h.channelCount),
      (u.samplerate = h.sampleRate),
      u.samples.push(y),
      { sample: y, length: h.frameLength, missing: 0 }
    );
  }
}
function gM(u, n) {
  const i = (u[n + 1] >> 3) & 3,
    o = (u[n + 1] >> 1) & 3,
    l = (u[n + 2] >> 4) & 15,
    h = (u[n + 2] >> 2) & 3;
  if (i !== 1 && l !== 0 && l !== 15 && h !== 3) {
    const p = (u[n + 2] >> 1) & 1,
      d = u[n + 3] >> 6,
      y = i === 3 ? 3 - o : o === 3 ? 3 : 4,
      v = i9[y * 14 + l - 1] * 1e3,
      S = r9[(i === 3 ? 0 : i === 2 ? 1 : 2) * 3 + h],
      w = d === 3 ? 1 : 2,
      C = s9[i][o],
      L = o9[o],
      k = C * 8 * L,
      O = Math.floor((C * v) / S + p) * L;
    if (zp === null) {
      const $ = (navigator.userAgent || "").match(/Chrome\/(\d+)/i);
      zp = $ ? parseInt($[1]) : 0;
    }
    return (
      !!zp && zp <= 87 && o === 2 && v >= 224e3 && d === 0 && (u[n + 3] = u[n + 3] | 128),
      { sampleRate: S, channelCount: w, frameLength: O, samplesPerFrame: k }
    );
  }
}
function AS(u, n) {
  return u[n] === 255 && (u[n + 1] & 224) === 224 && (u[n + 1] & 6) !== 0;
}
function mM(u, n) {
  return n + 1 < u.length && AS(u, n);
}
function a9(u, n) {
  return AS(u, n) && 4 <= u.length - n;
}
function yM(u, n) {
  if (n + 1 < u.length && AS(u, n)) {
    const o = gM(u, n);
    let l = 4;
    o != null && o.frameLength && (l = o.frameLength);
    const h = n + l;
    return h === u.length || mM(u, h);
  }
  return !1;
}
class l9 extends ES {
  constructor(n, i) {
    (super(), (this.observer = void 0), (this.config = void 0), (this.observer = n), (this.config = i));
  }
  resetInitSegment(n, i, o, l) {
    (super.resetInitSegment(n, i, o, l),
      (this._audioTrack = {
        container: "audio/adts",
        type: "audio",
        id: 2,
        pid: -1,
        sequenceNumber: 0,
        segmentCodec: "aac",
        samples: [],
        manifestCodec: i,
        duration: l,
        inputTimeScale: 9e4,
        dropped: 0,
      }));
  }
  static probe(n, i) {
    if (!n) return !1;
    const o = bd(n, 0);
    let l = (o == null ? void 0 : o.length) || 0;
    if (yM(n, l)) return !1;
    for (let h = n.length; l < h; l++) if (GK(n, l)) return (i.log("ADTS sync word found !"), !0);
    return !1;
  }
  canParse(n, i) {
    return $K(n, i);
  }
  appendFrame(n, i, o) {
    uM(n, this.observer, i, o, n.manifestCodec);
    const l = dM(n, i, o, this.basePTS, this.frameIndex);
    if (l && l.missing === 0) return l;
  }
}
const vM = (u, n) => {
  let i = 0,
    o = 5;
  n += o;
  const l = new Uint32Array(1),
    h = new Uint32Array(1),
    p = new Uint8Array(1);
  for (; o > 0; ) {
    p[0] = u[n];
    const d = Math.min(o, 8),
      y = 8 - d;
    ((h[0] = (4278190080 >>> (24 + y)) << y),
      (l[0] = (p[0] & h[0]) >> y),
      (i = i ? (i << d) | l[0] : l[0]),
      (n += 1),
      (o -= d));
  }
  return i;
};
class u9 extends ES {
  constructor(n) {
    (super(), (this.observer = void 0), (this.observer = n));
  }
  resetInitSegment(n, i, o, l) {
    (super.resetInitSegment(n, i, o, l),
      (this._audioTrack = {
        container: "audio/ac-3",
        type: "audio",
        id: 2,
        pid: -1,
        sequenceNumber: 0,
        segmentCodec: "ac3",
        samples: [],
        manifestCodec: i,
        duration: l,
        inputTimeScale: 9e4,
        dropped: 0,
      }));
  }
  canParse(n, i) {
    return i + 64 < n.length;
  }
  appendFrame(n, i, o) {
    const l = xM(n, i, o, this.basePTS, this.frameIndex);
    if (l !== -1) return { sample: n.samples[n.samples.length - 1], length: l, missing: 0 };
  }
  static probe(n) {
    if (!n) return !1;
    const i = bd(n, 0);
    if (!i) return !1;
    const o = i.length;
    return n[o] === 11 && n[o + 1] === 119 && SS(i) !== void 0 && vM(n, o) < 16;
  }
}
function xM(u, n, i, o, l) {
  if (i + 8 > n.length || n[i] !== 11 || n[i + 1] !== 119) return -1;
  const h = n[i + 4] >> 6;
  if (h >= 3) return -1;
  const d = [48e3, 44100, 32e3][h],
    y = n[i + 4] & 63,
    T =
      [
        64, 69, 96, 64, 70, 96, 80, 87, 120, 80, 88, 120, 96, 104, 144, 96, 105, 144, 112, 121, 168, 112, 122,
        168, 128, 139, 192, 128, 140, 192, 160, 174, 240, 160, 175, 240, 192, 208, 288, 192, 209, 288, 224,
        243, 336, 224, 244, 336, 256, 278, 384, 256, 279, 384, 320, 348, 480, 320, 349, 480, 384, 417, 576,
        384, 418, 576, 448, 487, 672, 448, 488, 672, 512, 557, 768, 512, 558, 768, 640, 696, 960, 640, 697,
        960, 768, 835, 1152, 768, 836, 1152, 896, 975, 1344, 896, 976, 1344, 1024, 1114, 1536, 1024, 1115,
        1536, 1152, 1253, 1728, 1152, 1254, 1728, 1280, 1393, 1920, 1280, 1394, 1920,
      ][y * 3 + h] * 2;
  if (i + T > n.length) return -1;
  const S = n[i + 6] >> 5;
  let w = 0;
  S === 2 ? (w += 2) : (S & 1 && S !== 1 && (w += 2), S & 4 && (w += 2));
  const C = (((n[i + 6] << 8) | n[i + 7]) >> (12 - w)) & 1,
    k = [2, 1, 2, 3, 3, 4, 4, 5][S] + C,
    O = n[i + 5] >> 3,
    B = n[i + 5] & 7,
    N = new Uint8Array([
      (h << 6) | (O << 1) | (B >> 2),
      ((B & 3) << 6) | (S << 3) | (C << 2) | (y >> 4),
      (y << 4) & 224,
    ]),
    $ = (1536 / d) * 9e4,
    I = o + l * $,
    V = n.subarray(i, i + T);
  return ((u.config = N), (u.channelCount = k), (u.samplerate = d), u.samples.push({ unit: V, pts: I }), T);
}
class c9 extends ES {
  resetInitSegment(n, i, o, l) {
    (super.resetInitSegment(n, i, o, l),
      (this._audioTrack = {
        container: "audio/mpeg",
        type: "audio",
        id: 2,
        pid: -1,
        sequenceNumber: 0,
        segmentCodec: "mp3",
        samples: [],
        manifestCodec: i,
        duration: l,
        inputTimeScale: 9e4,
        dropped: 0,
      }));
  }
  static probe(n) {
    if (!n) return !1;
    const i = bd(n, 0);
    let o = (i == null ? void 0 : i.length) || 0;
    if (i && n[o] === 11 && n[o + 1] === 119 && SS(i) !== void 0 && vM(n, o) <= 16) return !1;
    for (let l = n.length; o < l; o++) if (yM(n, o)) return (Zt.log("MPEG Audio sync word found !"), !0);
    return !1;
  }
  canParse(n, i) {
    return a9(n, i);
  }
  appendFrame(n, i, o) {
    if (this.basePTS !== null) return pM(n, i, o, this.basePTS, this.frameIndex);
  }
}
const d9 = /\/emsg[-/]ID3/i;
class h9 {
  constructor(n, i) {
    ((this.remainderData = null),
      (this.timeOffset = 0),
      (this.config = void 0),
      (this.videoTrack = void 0),
      (this.audioTrack = void 0),
      (this.id3Track = void 0),
      (this.txtTrack = void 0),
      (this.config = i));
  }
  resetTimeStamp() {}
  resetInitSegment(n, i, o, l) {
    const h = (this.videoTrack = as("video", 1)),
      p = (this.audioTrack = as("audio", 1)),
      d = (this.txtTrack = as("text", 1));
    if (((this.id3Track = as("id3", 1)), (this.timeOffset = 0), !(n != null && n.byteLength))) return;
    const y = _k(n);
    if (y.video) {
      const { id: v, timescale: T, codec: S, supplemental: w } = y.video;
      ((h.id = v), (h.timescale = d.timescale = T), (h.codec = S), (h.supplemental = w));
    }
    if (y.audio) {
      const { id: v, timescale: T, codec: S } = y.audio;
      ((p.id = v), (p.timescale = T), (p.codec = S));
    }
    ((d.id = Rk.text), (h.sampleDuration = 0), (h.duration = p.duration = l));
  }
  resetContiguity() {
    this.remainderData = null;
  }
  static probe(n) {
    return uH(n);
  }
  demux(n, i) {
    this.timeOffset = i;
    let o = n;
    const l = this.videoTrack,
      h = this.txtTrack;
    if (this.config.progressive) {
      this.remainderData && (o = Mr(this.remainderData, n));
      const d = mH(o);
      ((this.remainderData = d.remainder), (l.samples = d.valid || new Uint8Array()));
    } else l.samples = o;
    const p = this.extractID3Track(l, i);
    return (
      (h.samples = $_(i, l)),
      { videoTrack: l, audioTrack: this.audioTrack, id3Track: p, textTrack: this.txtTrack }
    );
  }
  flush() {
    const n = this.timeOffset,
      i = this.videoTrack,
      o = this.txtTrack;
    ((i.samples = this.remainderData || new Uint8Array()), (this.remainderData = null));
    const l = this.extractID3Track(i, this.timeOffset);
    return ((o.samples = $_(n, i)), { videoTrack: i, audioTrack: as(), id3Track: l, textTrack: as() });
  }
  extractID3Track(n, i) {
    const o = this.id3Track;
    if (n.samples.length) {
      const l = kt(n.samples, ["emsg"]);
      l &&
        l.forEach(h => {
          const p = vH(h);
          if (d9.test(p.schemeIdUri)) {
            const d = Ab(p, i);
            let y = p.eventDuration === 4294967295 ? Number.POSITIVE_INFINITY : p.eventDuration / p.timeScale;
            y <= 0.001 && (y = Number.POSITIVE_INFINITY);
            const v = p.payload;
            o.samples.push({ data: v, len: v.byteLength, dts: d, pts: d, type: Tr.emsg, duration: y });
          } else if (
            this.config.enableEmsgKLVMetadata &&
            p.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")
          ) {
            const d = Ab(p, i);
            o.samples.push({
              data: p.payload,
              len: p.payload.byteLength,
              dts: d,
              pts: d,
              type: Tr.misbklv,
              duration: Number.POSITIVE_INFINITY,
            });
          }
        });
    }
    return o;
  }
  demuxSampleAes(n, i, o) {
    return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"));
  }
  destroy() {
    ((this.config = null),
      (this.remainderData = null),
      (this.videoTrack = this.audioTrack = this.id3Track = this.txtTrack = void 0));
  }
}
function Ab(u, n) {
  return Ue(u.presentationTime)
    ? u.presentationTime / u.timeScale
    : n + u.presentationTimeDelta / u.timeScale;
}
class f9 {
  constructor(n, i, o) {
    ((this.keyData = void 0),
      (this.decrypter = void 0),
      (this.keyData = o),
      (this.decrypter = new fS(i, { removePKCS7Padding: !1 })));
  }
  decryptBuffer(n) {
    return this.decrypter.decrypt(n, this.keyData.key.buffer, this.keyData.iv.buffer, No.cbc);
  }
  decryptAacSample(n, i, o) {
    const l = n[i].unit;
    if (l.length <= 16) return;
    const h = l.subarray(16, l.length - (l.length % 16)),
      p = h.buffer.slice(h.byteOffset, h.byteOffset + h.length);
    this.decryptBuffer(p)
      .then(d => {
        const y = new Uint8Array(d);
        (l.set(y, 16), this.decrypter.isSync() || this.decryptAacSamples(n, i + 1, o));
      })
      .catch(o);
  }
  decryptAacSamples(n, i, o) {
    for (; ; i++) {
      if (i >= n.length) {
        o();
        return;
      }
      if (!(n[i].unit.length < 32) && (this.decryptAacSample(n, i, o), !this.decrypter.isSync())) return;
    }
  }
  getAvcEncryptedData(n) {
    const i = Math.floor((n.length - 48) / 160) * 16 + 16,
      o = new Int8Array(i);
    let l = 0;
    for (let h = 32; h < n.length - 16; h += 160, l += 16) o.set(n.subarray(h, h + 16), l);
    return o;
  }
  getAvcDecryptedUnit(n, i) {
    const o = new Uint8Array(i);
    let l = 0;
    for (let h = 32; h < n.length - 16; h += 160, l += 16) n.set(o.subarray(l, l + 16), h);
    return n;
  }
  decryptAvcSample(n, i, o, l, h) {
    const p = kk(h.data),
      d = this.getAvcEncryptedData(p);
    this.decryptBuffer(d.buffer)
      .then(y => {
        ((h.data = this.getAvcDecryptedUnit(p, y)),
          this.decrypter.isSync() || this.decryptAvcSamples(n, i, o + 1, l));
      })
      .catch(l);
  }
  decryptAvcSamples(n, i, o, l) {
    if (n instanceof Uint8Array) throw new Error("Cannot decrypt samples of type Uint8Array");
    for (; ; i++, o = 0) {
      if (i >= n.length) {
        l();
        return;
      }
      const h = n[i].units;
      for (; !(o >= h.length); o++) {
        const p = h[o];
        if (
          !(p.data.length <= 48 || (p.type !== 1 && p.type !== 5)) &&
          (this.decryptAvcSample(n, i, o, l, p), !this.decrypter.isSync())
        )
          return;
      }
    }
  }
}
class TM {
  constructor() {
    this.VideoSample = null;
  }
  createVideoSample(n, i, o) {
    return { key: n, frame: !1, pts: i, dts: o, units: [], length: 0 };
  }
  getLastNalUnit(n) {
    var i;
    let o = this.VideoSample,
      l;
    if (((!o || o.units.length === 0) && (o = n[n.length - 1]), (i = o) != null && i.units)) {
      const h = o.units;
      l = h[h.length - 1];
    }
    return l;
  }
  pushAccessUnit(n, i) {
    if (n.units.length && n.frame) {
      if (n.pts === void 0) {
        const o = i.samples,
          l = o.length;
        if (l) {
          const h = o[l - 1];
          ((n.pts = h.pts), (n.dts = h.dts));
        } else {
          i.dropped++;
          return;
        }
      }
      i.samples.push(n);
    }
  }
  parseNALu(n, i, o) {
    const l = i.byteLength;
    let h = n.naluState || 0;
    const p = h,
      d = [];
    let y = 0,
      v,
      T,
      S,
      w = -1,
      C = 0;
    for (h === -1 && ((w = 0), (C = this.getNALuType(i, 0)), (h = 0), (y = 1)); y < l; ) {
      if (((v = i[y++]), !h)) {
        h = v ? 0 : 1;
        continue;
      }
      if (h === 1) {
        h = v ? 0 : 2;
        continue;
      }
      if (!v) h = 3;
      else if (v === 1) {
        if (((T = y - h - 1), w >= 0)) {
          const L = { data: i.subarray(w, T), type: C };
          d.push(L);
        } else {
          const L = this.getLastNalUnit(n.samples);
          L &&
            (p && y <= 4 - p && L.state && (L.data = L.data.subarray(0, L.data.byteLength - p)),
            T > 0 && ((L.data = Mr(L.data, i.subarray(0, T))), (L.state = 0)));
        }
        y < l ? ((S = this.getNALuType(i, y)), (w = y), (C = S), (h = 0)) : (h = -1);
      } else h = 0;
    }
    if (w >= 0 && h >= 0) {
      const L = { data: i.subarray(w, l), type: C, state: h };
      d.push(L);
    }
    if (d.length === 0) {
      const L = this.getLastNalUnit(n.samples);
      L && (L.data = Mr(L.data, i));
    }
    return ((n.naluState = h), d);
  }
}
class hd {
  constructor(n) {
    ((this.data = void 0),
      (this.bytesAvailable = void 0),
      (this.word = void 0),
      (this.bitsAvailable = void 0),
      (this.data = n),
      (this.bytesAvailable = n.byteLength),
      (this.word = 0),
      (this.bitsAvailable = 0));
  }
  loadWord() {
    const n = this.data,
      i = this.bytesAvailable,
      o = n.byteLength - i,
      l = new Uint8Array(4),
      h = Math.min(4, i);
    if (h === 0) throw new Error("no bytes available");
    (l.set(n.subarray(o, o + h)),
      (this.word = new DataView(l.buffer).getUint32(0)),
      (this.bitsAvailable = h * 8),
      (this.bytesAvailable -= h));
  }
  skipBits(n) {
    let i;
    ((n = Math.min(n, this.bytesAvailable * 8 + this.bitsAvailable)),
      this.bitsAvailable > n
        ? ((this.word <<= n), (this.bitsAvailable -= n))
        : ((n -= this.bitsAvailable),
          (i = n >> 3),
          (n -= i << 3),
          (this.bytesAvailable -= i),
          this.loadWord(),
          (this.word <<= n),
          (this.bitsAvailable -= n)));
  }
  readBits(n) {
    let i = Math.min(this.bitsAvailable, n);
    const o = this.word >>> (32 - i);
    if (
      (n > 32 && Zt.error("Cannot read more than 32 bits at a time"),
      (this.bitsAvailable -= i),
      this.bitsAvailable > 0)
    )
      this.word <<= i;
    else if (this.bytesAvailable > 0) this.loadWord();
    else throw new Error("no bits available");
    return ((i = n - i), i > 0 && this.bitsAvailable ? (o << i) | this.readBits(i) : o);
  }
  skipLZ() {
    let n;
    for (n = 0; n < this.bitsAvailable; ++n)
      if ((this.word & (2147483648 >>> n)) !== 0) return ((this.word <<= n), (this.bitsAvailable -= n), n);
    return (this.loadWord(), n + this.skipLZ());
  }
  skipUEG() {
    this.skipBits(1 + this.skipLZ());
  }
  skipEG() {
    this.skipBits(1 + this.skipLZ());
  }
  readUEG() {
    const n = this.skipLZ();
    return this.readBits(n + 1) - 1;
  }
  readEG() {
    const n = this.readUEG();
    return 1 & n ? (1 + n) >>> 1 : -1 * (n >>> 1);
  }
  readBoolean() {
    return this.readBits(1) === 1;
  }
  readUByte() {
    return this.readBits(8);
  }
  readUShort() {
    return this.readBits(16);
  }
  readUInt() {
    return this.readBits(32);
  }
}
class p9 extends TM {
  parsePES(n, i, o, l) {
    const h = this.parseNALu(n, o.data, l);
    let p = this.VideoSample,
      d,
      y = !1;
    ((o.data = null),
      p &&
        h.length &&
        !n.audFound &&
        (this.pushAccessUnit(p, n), (p = this.VideoSample = this.createVideoSample(!1, o.pts, o.dts))),
      h.forEach(v => {
        var T, S;
        switch (v.type) {
          case 1: {
            let k = !1;
            d = !0;
            const O = v.data;
            if (y && O.length > 4) {
              const B = this.readSliceType(O);
              (B === 2 || B === 4 || B === 7 || B === 9) && (k = !0);
            }
            if (k) {
              var w;
              (w = p) != null &&
                w.frame &&
                !p.key &&
                (this.pushAccessUnit(p, n), (p = this.VideoSample = null));
            }
            (p || (p = this.VideoSample = this.createVideoSample(!0, o.pts, o.dts)),
              (p.frame = !0),
              (p.key = k));
            break;
          }
          case 5:
            ((d = !0),
              (T = p) != null &&
                T.frame &&
                !p.key &&
                (this.pushAccessUnit(p, n), (p = this.VideoSample = null)),
              p || (p = this.VideoSample = this.createVideoSample(!0, o.pts, o.dts)),
              (p.key = !0),
              (p.frame = !0));
            break;
          case 6: {
            ((d = !0), uS(v.data, 1, o.pts, i.samples));
            break;
          }
          case 7: {
            var C, L;
            ((d = !0), (y = !0));
            const k = v.data,
              O = this.readSPS(k);
            if (
              !n.sps ||
              n.width !== O.width ||
              n.height !== O.height ||
              ((C = n.pixelRatio) == null ? void 0 : C[0]) !== O.pixelRatio[0] ||
              ((L = n.pixelRatio) == null ? void 0 : L[1]) !== O.pixelRatio[1]
            ) {
              ((n.width = O.width), (n.height = O.height), (n.pixelRatio = O.pixelRatio), (n.sps = [k]));
              const B = k.subarray(1, 4);
              let N = "avc1.";
              for (let $ = 0; $ < 3; $++) {
                let I = B[$].toString(16);
                (I.length < 2 && (I = "0" + I), (N += I));
              }
              n.codec = N;
            }
            break;
          }
          case 8:
            ((d = !0), (n.pps = [v.data]));
            break;
          case 9:
            ((d = !0),
              (n.audFound = !0),
              (S = p) != null && S.frame && (this.pushAccessUnit(p, n), (p = null)),
              p || (p = this.VideoSample = this.createVideoSample(!1, o.pts, o.dts)));
            break;
          case 12:
            d = !0;
            break;
          default:
            d = !1;
            break;
        }
        p && d && p.units.push(v);
      }),
      l && p && (this.pushAccessUnit(p, n), (this.VideoSample = null)));
  }
  getNALuType(n, i) {
    return n[i] & 31;
  }
  readSliceType(n) {
    const i = new hd(n);
    return (i.readUByte(), i.readUEG(), i.readUEG());
  }
  skipScalingList(n, i) {
    let o = 8,
      l = 8,
      h;
    for (let p = 0; p < n; p++)
      (l !== 0 && ((h = i.readEG()), (l = (o + h + 256) % 256)), (o = l === 0 ? o : l));
  }
  readSPS(n) {
    const i = new hd(n);
    let o = 0,
      l = 0,
      h = 0,
      p = 0,
      d,
      y,
      v;
    const T = i.readUByte.bind(i),
      S = i.readBits.bind(i),
      w = i.readUEG.bind(i),
      C = i.readBoolean.bind(i),
      L = i.skipBits.bind(i),
      k = i.skipEG.bind(i),
      O = i.skipUEG.bind(i),
      B = this.skipScalingList.bind(this);
    T();
    const N = T();
    if (
      (S(5),
      L(3),
      T(),
      O(),
      N === 100 ||
        N === 110 ||
        N === 122 ||
        N === 244 ||
        N === 44 ||
        N === 83 ||
        N === 86 ||
        N === 118 ||
        N === 128)
    ) {
      const te = w();
      if ((te === 3 && L(1), O(), O(), L(1), C()))
        for (y = te !== 3 ? 8 : 12, v = 0; v < y; v++) C() && (v < 6 ? B(16, i) : B(64, i));
    }
    O();
    const $ = w();
    if ($ === 0) w();
    else if ($ === 1) for (L(1), k(), k(), d = w(), v = 0; v < d; v++) k();
    (O(), L(1));
    const I = w(),
      V = w(),
      oe = S(1);
    (oe === 0 && L(1), L(1), C() && ((o = w()), (l = w()), (h = w()), (p = w())));
    let Y = [1, 1];
    if (C() && C())
      switch (T()) {
        case 1:
          Y = [1, 1];
          break;
        case 2:
          Y = [12, 11];
          break;
        case 3:
          Y = [10, 11];
          break;
        case 4:
          Y = [16, 11];
          break;
        case 5:
          Y = [40, 33];
          break;
        case 6:
          Y = [24, 11];
          break;
        case 7:
          Y = [20, 11];
          break;
        case 8:
          Y = [32, 11];
          break;
        case 9:
          Y = [80, 33];
          break;
        case 10:
          Y = [18, 11];
          break;
        case 11:
          Y = [15, 11];
          break;
        case 12:
          Y = [64, 33];
          break;
        case 13:
          Y = [160, 99];
          break;
        case 14:
          Y = [4, 3];
          break;
        case 15:
          Y = [3, 2];
          break;
        case 16:
          Y = [2, 1];
          break;
        case 255: {
          Y = [(T() << 8) | T(), (T() << 8) | T()];
          break;
        }
      }
    return {
      width: Math.ceil((I + 1) * 16 - o * 2 - l * 2),
      height: (2 - oe) * (V + 1) * 16 - (oe ? 2 : 4) * (h + p),
      pixelRatio: Y,
    };
  }
}
class g9 extends TM {
  constructor(...n) {
    (super(...n), (this.initVPS = null));
  }
  parsePES(n, i, o, l) {
    const h = this.parseNALu(n, o.data, l);
    let p = this.VideoSample,
      d,
      y = !1;
    ((o.data = null),
      p &&
        h.length &&
        !n.audFound &&
        (this.pushAccessUnit(p, n), (p = this.VideoSample = this.createVideoSample(!1, o.pts, o.dts))),
      h.forEach(v => {
        var T, S;
        switch (v.type) {
          case 0:
          case 1:
          case 2:
          case 3:
          case 4:
          case 5:
          case 6:
          case 7:
          case 8:
          case 9:
            (p || (p = this.VideoSample = this.createVideoSample(!1, o.pts, o.dts)),
              (p.frame = !0),
              (d = !0));
            break;
          case 16:
          case 17:
          case 18:
          case 21:
            if (((d = !0), y)) {
              var w;
              (w = p) != null &&
                w.frame &&
                !p.key &&
                (this.pushAccessUnit(p, n), (p = this.VideoSample = null));
            }
            (p || (p = this.VideoSample = this.createVideoSample(!0, o.pts, o.dts)),
              (p.key = !0),
              (p.frame = !0));
            break;
          case 19:
          case 20:
            ((d = !0),
              (T = p) != null &&
                T.frame &&
                !p.key &&
                (this.pushAccessUnit(p, n), (p = this.VideoSample = null)),
              p || (p = this.VideoSample = this.createVideoSample(!0, o.pts, o.dts)),
              (p.key = !0),
              (p.frame = !0));
            break;
          case 39:
            ((d = !0), uS(v.data, 2, o.pts, i.samples));
            break;
          case 32:
            ((d = !0),
              n.vps ||
                (typeof n.params != "object" && (n.params = {}),
                (n.params = rn(n.params, this.readVPS(v.data))),
                (this.initVPS = v.data)),
              (n.vps = [v.data]));
            break;
          case 33:
            if (
              ((d = !0),
              (y = !0),
              n.vps !== void 0 &&
                n.vps[0] !== this.initVPS &&
                n.sps !== void 0 &&
                !this.matchSPS(n.sps[0], v.data) &&
                ((this.initVPS = n.vps[0]), (n.sps = n.pps = void 0)),
              !n.sps)
            ) {
              const C = this.readSPS(v.data);
              ((n.width = C.width),
                (n.height = C.height),
                (n.pixelRatio = C.pixelRatio),
                (n.codec = C.codecString),
                (n.sps = []),
                typeof n.params != "object" && (n.params = {}));
              for (const L in C.params) n.params[L] = C.params[L];
            }
            (this.pushParameterSet(n.sps, v.data, n.vps),
              p || (p = this.VideoSample = this.createVideoSample(!0, o.pts, o.dts)),
              (p.key = !0));
            break;
          case 34:
            if (((d = !0), typeof n.params == "object")) {
              if (!n.pps) {
                n.pps = [];
                const C = this.readPPS(v.data);
                for (const L in C) n.params[L] = C[L];
              }
              this.pushParameterSet(n.pps, v.data, n.vps);
            }
            break;
          case 35:
            ((d = !0),
              (n.audFound = !0),
              (S = p) != null && S.frame && (this.pushAccessUnit(p, n), (p = null)),
              p || (p = this.VideoSample = this.createVideoSample(!1, o.pts, o.dts)));
            break;
          default:
            d = !1;
            break;
        }
        p && d && p.units.push(v);
      }),
      l && p && (this.pushAccessUnit(p, n), (this.VideoSample = null)));
  }
  pushParameterSet(n, i, o) {
    ((o && o[0] === this.initVPS) || (!o && !n.length)) && n.push(i);
  }
  getNALuType(n, i) {
    return (n[i] & 126) >>> 1;
  }
  ebsp2rbsp(n) {
    const i = new Uint8Array(n.byteLength);
    let o = 0;
    for (let l = 0; l < n.byteLength; l++)
      (l >= 2 && n[l] === 3 && n[l - 1] === 0 && n[l - 2] === 0) || ((i[o] = n[l]), o++);
    return new Uint8Array(i.buffer, 0, o);
  }
  pushAccessUnit(n, i) {
    (super.pushAccessUnit(n, i), this.initVPS && (this.initVPS = null));
  }
  readVPS(n) {
    const i = new hd(n);
    (i.readUByte(), i.readUByte(), i.readBits(4), i.skipBits(2), i.readBits(6));
    const o = i.readBits(3),
      l = i.readBoolean();
    return { numTemporalLayers: o + 1, temporalIdNested: l };
  }
  readSPS(n) {
    const i = new hd(this.ebsp2rbsp(n));
    (i.readUByte(), i.readUByte(), i.readBits(4));
    const o = i.readBits(3);
    i.readBoolean();
    const l = i.readBits(2),
      h = i.readBoolean(),
      p = i.readBits(5),
      d = i.readUByte(),
      y = i.readUByte(),
      v = i.readUByte(),
      T = i.readUByte(),
      S = i.readUByte(),
      w = i.readUByte(),
      C = i.readUByte(),
      L = i.readUByte(),
      k = i.readUByte(),
      O = i.readUByte(),
      B = i.readUByte(),
      N = [],
      $ = [];
    for (let Et = 0; Et < o; Et++) (N.push(i.readBoolean()), $.push(i.readBoolean()));
    if (o > 0) for (let Et = o; Et < 8; Et++) i.readBits(2);
    for (let Et = 0; Et < o; Et++)
      (N[Et] &&
        (i.readUByte(),
        i.readUByte(),
        i.readUByte(),
        i.readUByte(),
        i.readUByte(),
        i.readUByte(),
        i.readUByte(),
        i.readUByte(),
        i.readUByte(),
        i.readUByte(),
        i.readUByte()),
        $[Et] && i.readUByte());
    i.readUEG();
    const I = i.readUEG();
    I == 3 && i.skipBits(1);
    const V = i.readUEG(),
      oe = i.readUEG(),
      Y = i.readBoolean();
    let te = 0,
      _ = 0,
      K = 0,
      q = 0;
    Y && ((te += i.readUEG()), (_ += i.readUEG()), (K += i.readUEG()), (q += i.readUEG()));
    const ce = i.readUEG(),
      he = i.readUEG(),
      ae = i.readUEG(),
      ye = i.readBoolean();
    for (let Et = ye ? 0 : o; Et <= o; Et++) (i.skipUEG(), i.skipUEG(), i.skipUEG());
    if (
      (i.skipUEG(),
      i.skipUEG(),
      i.skipUEG(),
      i.skipUEG(),
      i.skipUEG(),
      i.skipUEG(),
      i.readBoolean() && i.readBoolean())
    )
      for (let Bt = 0; Bt < 4; Bt++)
        for (let He = 0; He < (Bt === 3 ? 2 : 6); He++)
          if (!i.readBoolean()) i.readUEG();
          else {
            const Vn = Math.min(64, 1 << (4 + (Bt << 1)));
            Bt > 1 && i.readEG();
            for (let Wr = 0; Wr < Vn; Wr++) i.readEG();
          }
    (i.readBoolean(),
      i.readBoolean(),
      i.readBoolean() && (i.readUByte(), i.skipUEG(), i.skipUEG(), i.readBoolean()));
    const Le = i.readUEG();
    let ke = 0;
    for (let Et = 0; Et < Le; Et++) {
      let Bt = !1;
      if ((Et !== 0 && (Bt = i.readBoolean()), Bt)) {
        (Et === Le && i.readUEG(), i.readBoolean(), i.readUEG());
        let He = 0;
        for (let Cn = 0; Cn <= ke; Cn++) {
          const Vn = i.readBoolean();
          let Wr = !1;
          (Vn || (Wr = i.readBoolean()), (Vn || Wr) && He++);
        }
        ke = He;
      } else {
        const He = i.readUEG(),
          Cn = i.readUEG();
        ke = He + Cn;
        for (let Vn = 0; Vn < He; Vn++) (i.readUEG(), i.readBoolean());
        for (let Vn = 0; Vn < Cn; Vn++) (i.readUEG(), i.readBoolean());
      }
    }
    if (i.readBoolean()) {
      const Et = i.readUEG();
      for (let Bt = 0; Bt < Et; Bt++) {
        for (let He = 0; He < ae + 4; He++) i.readBits(1);
        i.readBits(1);
      }
    }
    let Re = 0,
      Ce = 1,
      W = 1,
      Qe = !0,
      ot = 1,
      Je = 0;
    (i.readBoolean(), i.readBoolean());
    let Ut = !1;
    if (i.readBoolean()) {
      if (i.readBoolean()) {
        const Or = i.readUByte(),
          Js = [1, 12, 10, 16, 40, 24, 20, 32, 80, 18, 15, 64, 160, 4, 3, 2],
          zr = [1, 11, 11, 11, 33, 11, 11, 11, 33, 11, 11, 33, 99, 3, 2, 1];
        Or > 0 && Or < 16
          ? ((Ce = Js[Or - 1]), (W = zr[Or - 1]))
          : Or === 255 && ((Ce = i.readBits(16)), (W = i.readBits(16)));
      }
      if (
        (i.readBoolean() && i.readBoolean(),
        i.readBoolean() &&
          (i.readBits(3), i.readBoolean(), i.readBoolean() && (i.readUByte(), i.readUByte(), i.readUByte())),
        i.readBoolean() && (i.readUEG(), i.readUEG()),
        i.readBoolean(),
        i.readBoolean(),
        i.readBoolean(),
        (Ut = i.readBoolean()),
        Ut && (i.skipUEG(), i.skipUEG(), i.skipUEG(), i.skipUEG()),
        i.readBoolean() &&
          ((ot = i.readBits(32)), (Je = i.readBits(32)), i.readBoolean() && i.readUEG(), i.readBoolean()))
      ) {
        const zr = i.readBoolean(),
          ki = i.readBoolean();
        let nr = !1;
        (zr || ki) &&
          ((nr = i.readBoolean()),
          nr && (i.readUByte(), i.readBits(5), i.readBoolean(), i.readBits(5)),
          i.readBits(4),
          i.readBits(4),
          nr && i.readBits(4),
          i.readBits(5),
          i.readBits(5),
          i.readBits(5));
        for (let Nr = 0; Nr <= o; Nr++) {
          Qe = i.readBoolean();
          const La = Qe || i.readBoolean();
          let gt = !1;
          La ? i.readEG() : (gt = i.readBoolean());
          const xu = gt ? 1 : i.readUEG() + 1;
          if (zr)
            for (let Uo = 0; Uo < xu; Uo++)
              (i.readUEG(), i.readUEG(), nr && (i.readUEG(), i.readUEG()), i.skipBits(1));
          if (ki)
            for (let Uo = 0; Uo < xu; Uo++)
              (i.readUEG(), i.readUEG(), nr && (i.readUEG(), i.readUEG()), i.skipBits(1));
        }
      }
      i.readBoolean() && (i.readBoolean(), i.readBoolean(), i.readBoolean(), (Re = i.readUEG()));
    }
    let Xt = V,
      vn = oe;
    if (Y) {
      let Et = 1,
        Bt = 1;
      (I === 1 ? (Et = Bt = 2) : I == 2 && (Et = 2),
        (Xt = V - Et * _ - Et * te),
        (vn = oe - Bt * q - Bt * K));
    }
    const Rn = l ? ["A", "B", "C"][l] : "",
      Ee = (d << 24) | (y << 16) | (v << 8) | T;
    let Di = 0;
    for (let Et = 0; Et < 32; Et++) Di = (Di | (((Ee >> Et) & 1) << (31 - Et))) >>> 0;
    let ai = Di.toString(16);
    p === 1 && ai === "2" && (ai = "6");
    const xi = h ? "H" : "L";
    return {
      codecString: "hvc1.".concat(Rn).concat(p, ".").concat(ai, ".").concat(xi).concat(B, ".B0"),
      params: {
        general_tier_flag: h,
        general_profile_idc: p,
        general_profile_space: l,
        general_profile_compatibility_flags: [d, y, v, T],
        general_constraint_indicator_flags: [S, w, C, L, k, O],
        general_level_idc: B,
        bit_depth: ce + 8,
        bit_depth_luma_minus8: ce,
        bit_depth_chroma_minus8: he,
        min_spatial_segmentation_idc: Re,
        chroma_format_idc: I,
        frame_rate: { fixed: Qe, fps: Je / ot },
      },
      width: Xt,
      height: vn,
      pixelRatio: [Ce, W],
    };
  }
  readPPS(n) {
    const i = new hd(this.ebsp2rbsp(n));
    (i.readUByte(),
      i.readUByte(),
      i.skipUEG(),
      i.skipUEG(),
      i.skipBits(2),
      i.skipBits(3),
      i.skipBits(2),
      i.skipUEG(),
      i.skipUEG(),
      i.skipEG(),
      i.skipBits(2),
      i.readBoolean() && i.skipUEG(),
      i.skipEG(),
      i.skipEG(),
      i.skipBits(4));
    const l = i.readBoolean(),
      h = i.readBoolean();
    let p = 1;
    return (h && l ? (p = 0) : h ? (p = 3) : l && (p = 2), { parallelismType: p });
  }
  matchSPS(n, i) {
    return String.fromCharCode.apply(null, n).substr(3) === String.fromCharCode.apply(null, i).substr(3);
  }
}
const ri = 188;
class Lo {
  constructor(n, i, o, l) {
    ((this.logger = void 0),
      (this.observer = void 0),
      (this.config = void 0),
      (this.typeSupported = void 0),
      (this.sampleAes = null),
      (this.pmtParsed = !1),
      (this.audioCodec = void 0),
      (this.videoCodec = void 0),
      (this._pmtId = -1),
      (this._videoTrack = void 0),
      (this._audioTrack = void 0),
      (this._id3Track = void 0),
      (this._txtTrack = void 0),
      (this.aacOverFlow = null),
      (this.remainderData = null),
      (this.videoParser = void 0),
      (this.observer = n),
      (this.config = i),
      (this.typeSupported = o),
      (this.logger = l),
      (this.videoParser = null));
  }
  static probe(n, i) {
    const o = Lo.syncOffset(n);
    return (o > 0 && i.warn("MPEG2-TS detected but first sync word found @ offset ".concat(o)), o !== -1);
  }
  static syncOffset(n) {
    const i = n.length;
    let o = Math.min(ri * 5, i - ri) + 1,
      l = 0;
    for (; l < o; ) {
      let h = !1,
        p = -1,
        d = 0;
      for (let y = l; y < i; y += ri)
        if (n[y] === 71 && (i - y === ri || n[y + ri] === 71)) {
          if (
            (d++,
            p === -1 && ((p = y), p !== 0 && (o = Math.min(p + ri * 99, n.length - ri) + 1)),
            h || (h = MT(n, y) === 0),
            h && d > 1 && ((p === 0 && d > 2) || y + ri > o))
          )
            return p;
        } else {
          if (d) return -1;
          break;
        }
      l++;
    }
    return -1;
  }
  static createTrack(n, i) {
    return {
      container: n === "video" || n === "audio" ? "video/mp2t" : void 0,
      type: n,
      id: Rk[n],
      pid: -1,
      inputTimeScale: 9e4,
      sequenceNumber: 0,
      samples: [],
      dropped: 0,
      duration: n === "audio" ? i : void 0,
    };
  }
  resetInitSegment(n, i, o, l) {
    ((this.pmtParsed = !1),
      (this._pmtId = -1),
      (this._videoTrack = Lo.createTrack("video")),
      (this._videoTrack.duration = l),
      (this._audioTrack = Lo.createTrack("audio", l)),
      (this._id3Track = Lo.createTrack("id3")),
      (this._txtTrack = Lo.createTrack("text")),
      (this._audioTrack.segmentCodec = "aac"),
      (this.videoParser = null),
      (this.aacOverFlow = null),
      (this.remainderData = null),
      (this.audioCodec = i),
      (this.videoCodec = o));
  }
  resetTimeStamp() {}
  resetContiguity() {
    const { _audioTrack: n, _videoTrack: i, _id3Track: o } = this;
    (n && (n.pesData = null),
      i && (i.pesData = null),
      o && (o.pesData = null),
      (this.aacOverFlow = null),
      (this.remainderData = null));
  }
  demux(n, i, o = !1, l = !1) {
    o || (this.sampleAes = null);
    let h;
    const p = this._videoTrack,
      d = this._audioTrack,
      y = this._id3Track,
      v = this._txtTrack;
    let T = p.pid,
      S = p.pesData,
      w = d.pid,
      C = y.pid,
      L = d.pesData,
      k = y.pesData,
      O = null,
      B = this.pmtParsed,
      N = this._pmtId,
      $ = n.length;
    if (
      (this.remainderData && ((n = Mr(this.remainderData, n)), ($ = n.length), (this.remainderData = null)),
      $ < ri && !l)
    )
      return ((this.remainderData = n), { audioTrack: d, videoTrack: p, id3Track: y, textTrack: v });
    const I = Math.max(0, Lo.syncOffset(n));
    (($ -= ($ - I) % ri),
      $ < n.byteLength && !l && (this.remainderData = new Uint8Array(n.buffer, $, n.buffer.byteLength - $)));
    let V = 0;
    for (let Y = I; Y < $; Y += ri)
      if (n[Y] === 71) {
        const te = !!(n[Y + 1] & 64),
          _ = MT(n, Y),
          K = (n[Y + 3] & 48) >> 4;
        let q;
        if (K > 1) {
          if (((q = Y + 5 + n[Y + 4]), q === Y + ri)) continue;
        } else q = Y + 4;
        switch (_) {
          case T:
            (te &&
              (S &&
                (h = $l(S, this.logger)) &&
                (this.readyVideoParser(p.segmentCodec),
                this.videoParser !== null && this.videoParser.parsePES(p, v, h, !1)),
              (S = { data: [], size: 0 })),
              S && (S.data.push(n.subarray(q, Y + ri)), (S.size += Y + ri - q)));
            break;
          case w:
            if (te) {
              if (L && (h = $l(L, this.logger)))
                switch (d.segmentCodec) {
                  case "aac":
                    this.parseAACPES(d, h);
                    break;
                  case "mp3":
                    this.parseMPEGPES(d, h);
                    break;
                  case "ac3":
                    this.parseAC3PES(d, h);
                    break;
                }
              L = { data: [], size: 0 };
            }
            L && (L.data.push(n.subarray(q, Y + ri)), (L.size += Y + ri - q));
            break;
          case C:
            (te && (k && (h = $l(k, this.logger)) && this.parseID3PES(y, h), (k = { data: [], size: 0 })),
              k && (k.data.push(n.subarray(q, Y + ri)), (k.size += Y + ri - q)));
            break;
          case 0:
            (te && (q += n[q] + 1), (N = this._pmtId = m9(n, q)));
            break;
          case N: {
            te && (q += n[q] + 1);
            const ce = y9(n, q, this.typeSupported, o, this.observer, this.logger);
            ((T = ce.videoPid),
              T > 0 && ((p.pid = T), (p.segmentCodec = ce.segmentVideoCodec)),
              (w = ce.audioPid),
              w > 0 && ((d.pid = w), (d.segmentCodec = ce.segmentAudioCodec)),
              (C = ce.id3Pid),
              C > 0 && (y.pid = C),
              O !== null &&
                !B &&
                (this.logger.warn(
                  "MPEG-TS PMT found at "
                    .concat(Y, " after unknown PID '")
                    .concat(O, "'. Backtracking to sync byte @")
                    .concat(I, " to parse all TS packets."),
                ),
                (O = null),
                (Y = I - 188)),
              (B = this.pmtParsed = !0));
            break;
          }
          case 17:
          case 8191:
            break;
          default:
            O = _;
            break;
        }
      } else V++;
    (V > 0 &&
      PT(
        this.observer,
        new Error("Found ".concat(V, " TS packet/s that do not start with 0x47")),
        void 0,
        this.logger,
      ),
      (p.pesData = S),
      (d.pesData = L),
      (y.pesData = k));
    const oe = { audioTrack: d, videoTrack: p, id3Track: y, textTrack: v };
    return (l && this.extractRemainingSamples(oe), oe);
  }
  flush() {
    const { remainderData: n } = this;
    this.remainderData = null;
    let i;
    return (
      n
        ? (i = this.demux(n, -1, !1, !0))
        : (i = {
            videoTrack: this._videoTrack,
            audioTrack: this._audioTrack,
            id3Track: this._id3Track,
            textTrack: this._txtTrack,
          }),
      this.extractRemainingSamples(i),
      this.sampleAes ? this.decrypt(i, this.sampleAes) : i
    );
  }
  extractRemainingSamples(n) {
    const { audioTrack: i, videoTrack: o, id3Track: l, textTrack: h } = n,
      p = o.pesData,
      d = i.pesData,
      y = l.pesData;
    let v;
    if (
      (p && (v = $l(p, this.logger))
        ? (this.readyVideoParser(o.segmentCodec),
          this.videoParser !== null && (this.videoParser.parsePES(o, h, v, !0), (o.pesData = null)))
        : (o.pesData = p),
      d && (v = $l(d, this.logger)))
    ) {
      switch (i.segmentCodec) {
        case "aac":
          this.parseAACPES(i, v);
          break;
        case "mp3":
          this.parseMPEGPES(i, v);
          break;
        case "ac3":
          this.parseAC3PES(i, v);
          break;
      }
      i.pesData = null;
    } else
      (d != null &&
        d.size &&
        this.logger.log("last AAC PES packet truncated,might overlap between fragments"),
        (i.pesData = d));
    y && (v = $l(y, this.logger)) ? (this.parseID3PES(l, v), (l.pesData = null)) : (l.pesData = y);
  }
  demuxSampleAes(n, i, o) {
    const l = this.demux(n, o, !0, !this.config.progressive),
      h = (this.sampleAes = new f9(this.observer, this.config, i));
    return this.decrypt(l, h);
  }
  readyVideoParser(n) {
    this.videoParser === null &&
      (n === "avc" ? (this.videoParser = new p9()) : n === "hevc" && (this.videoParser = new g9()));
  }
  decrypt(n, i) {
    return new Promise(o => {
      const { audioTrack: l, videoTrack: h } = n;
      l.samples && l.segmentCodec === "aac"
        ? i.decryptAacSamples(l.samples, 0, () => {
            h.samples
              ? i.decryptAvcSamples(h.samples, 0, 0, () => {
                  o(n);
                })
              : o(n);
          })
        : h.samples &&
          i.decryptAvcSamples(h.samples, 0, 0, () => {
            o(n);
          });
    });
  }
  destroy() {
    (this.observer && this.observer.removeAllListeners(),
      (this.config = this.logger = this.observer = null),
      (this.aacOverFlow = this.videoParser = this.remainderData = this.sampleAes = null),
      (this._videoTrack = this._audioTrack = this._id3Track = this._txtTrack = void 0));
  }
  parseAACPES(n, i) {
    let o = 0;
    const l = this.aacOverFlow;
    let h = i.data;
    if (l) {
      this.aacOverFlow = null;
      const S = l.missing,
        w = l.sample.unit.byteLength;
      if (S === -1) h = Mr(l.sample.unit, h);
      else {
        const C = w - S;
        (l.sample.unit.set(h.subarray(0, S), C), n.samples.push(l.sample), (o = l.missing));
      }
    }
    let p, d;
    for (p = o, d = h.length; p < d - 1 && !Hg(h, p); p++);
    if (p !== o) {
      let S;
      const w = p < d - 1;
      if (
        (w
          ? (S = "AAC PES did not start with ADTS header,offset:".concat(p))
          : (S = "No ADTS header found in AAC PES"),
        PT(this.observer, new Error(S), w, this.logger),
        !w)
      )
        return;
    }
    uM(n, this.observer, h, p, this.audioCodec);
    let y;
    if (i.pts !== void 0) y = i.pts;
    else if (l) {
      const S = cM(n.samplerate);
      y = l.sample.pts + S;
    } else {
      this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");
      return;
    }
    let v = 0,
      T;
    for (; p < d; )
      if (((T = dM(n, h, p, y, v)), (p += T.length), T.missing)) {
        this.aacOverFlow = T;
        break;
      } else for (v++; p < d - 1 && !Hg(h, p); p++);
  }
  parseMPEGPES(n, i) {
    const o = i.data,
      l = o.length;
    let h = 0,
      p = 0;
    const d = i.pts;
    if (d === void 0) {
      this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");
      return;
    }
    for (; p < l; )
      if (mM(o, p)) {
        const y = pM(n, o, p, d, h);
        if (y) ((p += y.length), h++);
        else break;
      } else p++;
  }
  parseAC3PES(n, i) {
    {
      const o = i.data,
        l = i.pts;
      if (l === void 0) {
        this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");
        return;
      }
      const h = o.length;
      let p = 0,
        d = 0,
        y;
      for (; d < h && (y = xM(n, o, d, l, p++)) > 0; ) d += y;
    }
  }
  parseID3PES(n, i) {
    if (i.pts === void 0) {
      this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");
      return;
    }
    const o = rn({}, i, {
      type: this._videoTrack ? Tr.emsg : Tr.audioId3,
      duration: Number.POSITIVE_INFINITY,
    });
    n.samples.push(o);
  }
}
function MT(u, n) {
  return ((u[n + 1] & 31) << 8) + u[n + 2];
}
function m9(u, n) {
  return ((u[n + 10] & 31) << 8) | u[n + 11];
}
function y9(u, n, i, o, l, h) {
  const p = { audioPid: -1, videoPid: -1, id3Pid: -1, segmentVideoCodec: "avc", segmentAudioCodec: "aac" },
    d = ((u[n + 1] & 15) << 8) | u[n + 2],
    y = n + 3 + d - 4,
    v = ((u[n + 10] & 15) << 8) | u[n + 11];
  for (n += 12 + v; n < y; ) {
    const T = MT(u, n),
      S = ((u[n + 3] & 15) << 8) | u[n + 4];
    switch (u[n]) {
      case 207:
        if (!o) {
          Ox("ADTS AAC", h);
          break;
        }
      case 15:
        p.audioPid === -1 && (p.audioPid = T);
        break;
      case 21:
        p.id3Pid === -1 && (p.id3Pid = T);
        break;
      case 219:
        if (!o) {
          Ox("H.264", h);
          break;
        }
      case 27:
        p.videoPid === -1 && (p.videoPid = T);
        break;
      case 3:
      case 4:
        !i.mpeg && !i.mp3
          ? h.log("MPEG audio found, not supported in this browser")
          : p.audioPid === -1 && ((p.audioPid = T), (p.segmentAudioCodec = "mp3"));
        break;
      case 193:
        if (!o) {
          Ox("AC-3", h);
          break;
        }
      case 129:
        i.ac3
          ? p.audioPid === -1 && ((p.audioPid = T), (p.segmentAudioCodec = "ac3"))
          : h.log("AC-3 audio found, not supported in this browser");
        break;
      case 6:
        if (p.audioPid === -1 && S > 0) {
          let w = n + 5,
            C = S;
          for (; C > 2; ) {
            switch (u[w]) {
              case 106:
                i.ac3 !== !0
                  ? h.log("AC-3 audio found, not supported in this browser for now")
                  : ((p.audioPid = T), (p.segmentAudioCodec = "ac3"));
                break;
            }
            const k = u[w + 1] + 2;
            ((w += k), (C -= k));
          }
        }
        break;
      case 194:
      case 135:
        return (PT(l, new Error("Unsupported EC-3 in M2TS found"), void 0, h), p);
      case 36:
        p.videoPid === -1 && ((p.videoPid = T), (p.segmentVideoCodec = "hevc"), h.log("HEVC in M2TS found"));
        break;
    }
    n += S + 5;
  }
  return p;
}
function PT(u, n, i, o) {
  (o.warn("parsing error: ".concat(n.message)),
    u.emit(F.ERROR, F.ERROR, {
      type: et.MEDIA_ERROR,
      details: ge.FRAG_PARSING_ERROR,
      fatal: !1,
      levelRetry: i,
      error: n,
      reason: n.message,
    }));
}
function Ox(u, n) {
  n.log("".concat(u, " with AES-128-CBC encryption found in unencrypted stream"));
}
function $l(u, n) {
  let i = 0,
    o,
    l,
    h,
    p,
    d;
  const y = u.data;
  if (!u || u.size === 0) return null;
  for (; y[0].length < 19 && y.length > 1; ) ((y[0] = Mr(y[0], y[1])), y.splice(1, 1));
  if (((o = y[0]), (o[0] << 16) + (o[1] << 8) + o[2] === 1)) {
    if (((l = (o[4] << 8) + o[5]), l && l > u.size - 6)) return null;
    const T = o[7];
    (T & 192 &&
      ((p =
        (o[9] & 14) * 536870912 +
        (o[10] & 255) * 4194304 +
        (o[11] & 254) * 16384 +
        (o[12] & 255) * 128 +
        (o[13] & 254) / 2),
      T & 64
        ? ((d =
            (o[14] & 14) * 536870912 +
            (o[15] & 255) * 4194304 +
            (o[16] & 254) * 16384 +
            (o[17] & 255) * 128 +
            (o[18] & 254) / 2),
          p - d > 60 * 9e4 &&
            (n.warn("".concat(Math.round((p - d) / 9e4), "s delta between PTS and DTS, align them")),
            (p = d)))
        : (d = p)),
      (h = o[8]));
    let S = h + 9;
    if (u.size <= S) return null;
    u.size -= S;
    const w = new Uint8Array(u.size);
    for (let C = 0, L = y.length; C < L; C++) {
      o = y[C];
      let k = o.byteLength;
      if (S)
        if (S > k) {
          S -= k;
          continue;
        } else ((o = o.subarray(S)), (k -= S), (S = 0));
      (w.set(o, i), (i += k));
    }
    return (l && (l -= h + 3), { data: w, pts: p, dts: d, len: l });
  }
  return null;
}
class v9 {
  static getSilentFrame(n, i) {
    switch (n) {
      case "mp4a.40.2":
        if (i === 1) return new Uint8Array([0, 200, 0, 128, 35, 128]);
        if (i === 2) return new Uint8Array([33, 0, 73, 144, 2, 25, 0, 35, 128]);
        if (i === 3) return new Uint8Array([0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 142]);
        if (i === 4)
          return new Uint8Array([0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 128, 44, 128, 8, 2, 56]);
        if (i === 5)
          return new Uint8Array([
            0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 130, 48, 4, 153, 0, 33, 144, 2, 56,
          ]);
        if (i === 6)
          return new Uint8Array([
            0, 200, 0, 128, 32, 132, 1, 38, 64, 8, 100, 0, 130, 48, 4, 153, 0, 33, 144, 2, 0, 178, 0, 32, 8,
            224,
          ]);
        break;
      default:
        if (i === 1)
          return new Uint8Array([
            1, 64, 34, 128, 163, 78, 230, 128, 186, 8, 0, 0, 0, 28, 6, 241, 193, 10, 90, 90, 90, 90, 90, 90,
            90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90,
            90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 94,
          ]);
        if (i === 2)
          return new Uint8Array([
            1, 64, 34, 128, 163, 94, 230, 128, 186, 8, 0, 0, 0, 0, 149, 0, 6, 241, 161, 10, 90, 90, 90, 90,
            90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90,
            90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 94,
          ]);
        if (i === 3)
          return new Uint8Array([
            1, 64, 34, 128, 163, 94, 230, 128, 186, 8, 0, 0, 0, 0, 149, 0, 6, 241, 161, 10, 90, 90, 90, 90,
            90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 90,
            90, 90, 90, 90, 90, 90, 90, 90, 90, 90, 94,
          ]);
        break;
    }
  }
}
const wo = Math.pow(2, 32) - 1;
class pe {
  static init() {
    pe.types = {
      avc1: [],
      avcC: [],
      hvc1: [],
      hvcC: [],
      btrt: [],
      dinf: [],
      dref: [],
      esds: [],
      ftyp: [],
      hdlr: [],
      mdat: [],
      mdhd: [],
      mdia: [],
      mfhd: [],
      minf: [],
      moof: [],
      moov: [],
      mp4a: [],
      ".mp3": [],
      dac3: [],
      "ac-3": [],
      mvex: [],
      mvhd: [],
      pasp: [],
      sdtp: [],
      stbl: [],
      stco: [],
      stsc: [],
      stsd: [],
      stsz: [],
      stts: [],
      tfdt: [],
      tfhd: [],
      traf: [],
      trak: [],
      trun: [],
      trex: [],
      tkhd: [],
      vmhd: [],
      smhd: [],
    };
    let n;
    for (n in pe.types)
      pe.types.hasOwnProperty(n) &&
        (pe.types[n] = [n.charCodeAt(0), n.charCodeAt(1), n.charCodeAt(2), n.charCodeAt(3)]);
    const i = new Uint8Array([
        0, 0, 0, 0, 0, 0, 0, 0, 118, 105, 100, 101, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 86, 105, 100, 101,
        111, 72, 97, 110, 100, 108, 101, 114, 0,
      ]),
      o = new Uint8Array([
        0, 0, 0, 0, 0, 0, 0, 0, 115, 111, 117, 110, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 83, 111, 117, 110,
        100, 72, 97, 110, 100, 108, 101, 114, 0,
      ]);
    pe.HDLR_TYPES = { video: i, audio: o };
    const l = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 12, 117, 114, 108, 32, 0, 0, 0, 1]),
      h = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0]);
    ((pe.STTS = pe.STSC = pe.STCO = h),
      (pe.STSZ = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0])),
      (pe.VMHD = new Uint8Array([0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0])),
      (pe.SMHD = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 0])),
      (pe.STSD = new Uint8Array([0, 0, 0, 0, 0, 0, 0, 1])));
    const p = new Uint8Array([105, 115, 111, 109]),
      d = new Uint8Array([97, 118, 99, 49]),
      y = new Uint8Array([0, 0, 0, 1]);
    ((pe.FTYP = pe.box(pe.types.ftyp, p, y, p, d)),
      (pe.DINF = pe.box(pe.types.dinf, pe.box(pe.types.dref, l))));
  }
  static box(n, ...i) {
    let o = 8,
      l = i.length;
    const h = l;
    for (; l--; ) o += i[l].byteLength;
    const p = new Uint8Array(o);
    for (
      p[0] = (o >> 24) & 255,
        p[1] = (o >> 16) & 255,
        p[2] = (o >> 8) & 255,
        p[3] = o & 255,
        p.set(n, 4),
        l = 0,
        o = 8;
      l < h;
      l++
    )
      (p.set(i[l], o), (o += i[l].byteLength));
    return p;
  }
  static hdlr(n) {
    return pe.box(pe.types.hdlr, pe.HDLR_TYPES[n]);
  }
  static mdat(n) {
    return pe.box(pe.types.mdat, n);
  }
  static mdhd(n, i) {
    i *= n;
    const o = Math.floor(i / (wo + 1)),
      l = Math.floor(i % (wo + 1));
    return pe.box(
      pe.types.mdhd,
      new Uint8Array([
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        2,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        3,
        (n >> 24) & 255,
        (n >> 16) & 255,
        (n >> 8) & 255,
        n & 255,
        o >> 24,
        (o >> 16) & 255,
        (o >> 8) & 255,
        o & 255,
        l >> 24,
        (l >> 16) & 255,
        (l >> 8) & 255,
        l & 255,
        85,
        196,
        0,
        0,
      ]),
    );
  }
  static mdia(n) {
    return pe.box(pe.types.mdia, pe.mdhd(n.timescale || 0, n.duration || 0), pe.hdlr(n.type), pe.minf(n));
  }
  static mfhd(n) {
    return pe.box(
      pe.types.mfhd,
      new Uint8Array([0, 0, 0, 0, n >> 24, (n >> 16) & 255, (n >> 8) & 255, n & 255]),
    );
  }
  static minf(n) {
    return n.type === "audio"
      ? pe.box(pe.types.minf, pe.box(pe.types.smhd, pe.SMHD), pe.DINF, pe.stbl(n))
      : pe.box(pe.types.minf, pe.box(pe.types.vmhd, pe.VMHD), pe.DINF, pe.stbl(n));
  }
  static moof(n, i, o) {
    return pe.box(pe.types.moof, pe.mfhd(n), pe.traf(o, i));
  }
  static moov(n) {
    let i = n.length;
    const o = [];
    for (; i--; ) o[i] = pe.trak(n[i]);
    return pe.box.apply(
      null,
      [pe.types.moov, pe.mvhd(n[0].timescale || 0, n[0].duration || 0)].concat(o).concat(pe.mvex(n)),
    );
  }
  static mvex(n) {
    let i = n.length;
    const o = [];
    for (; i--; ) o[i] = pe.trex(n[i]);
    return pe.box.apply(null, [pe.types.mvex, ...o]);
  }
  static mvhd(n, i) {
    i *= n;
    const o = Math.floor(i / (wo + 1)),
      l = Math.floor(i % (wo + 1)),
      h = new Uint8Array([
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        2,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        3,
        (n >> 24) & 255,
        (n >> 16) & 255,
        (n >> 8) & 255,
        n & 255,
        o >> 24,
        (o >> 16) & 255,
        (o >> 8) & 255,
        o & 255,
        l >> 24,
        (l >> 16) & 255,
        (l >> 8) & 255,
        l & 255,
        0,
        1,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        64,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        255,
        255,
        255,
        255,
      ]);
    return pe.box(pe.types.mvhd, h);
  }
  static sdtp(n) {
    const i = n.samples || [],
      o = new Uint8Array(4 + i.length);
    let l, h;
    for (l = 0; l < i.length; l++)
      ((h = i[l].flags), (o[l + 4] = (h.dependsOn << 4) | (h.isDependedOn << 2) | h.hasRedundancy));
    return pe.box(pe.types.sdtp, o);
  }
  static stbl(n) {
    return pe.box(
      pe.types.stbl,
      pe.stsd(n),
      pe.box(pe.types.stts, pe.STTS),
      pe.box(pe.types.stsc, pe.STSC),
      pe.box(pe.types.stsz, pe.STSZ),
      pe.box(pe.types.stco, pe.STCO),
    );
  }
  static avc1(n) {
    let i = [],
      o = [],
      l,
      h,
      p;
    for (l = 0; l < n.sps.length; l++)
      ((h = n.sps[l]),
        (p = h.byteLength),
        i.push((p >>> 8) & 255),
        i.push(p & 255),
        (i = i.concat(Array.prototype.slice.call(h))));
    for (l = 0; l < n.pps.length; l++)
      ((h = n.pps[l]),
        (p = h.byteLength),
        o.push((p >>> 8) & 255),
        o.push(p & 255),
        (o = o.concat(Array.prototype.slice.call(h))));
    const d = pe.box(
        pe.types.avcC,
        new Uint8Array(
          [1, i[3], i[4], i[5], 255, 224 | n.sps.length].concat(i).concat([n.pps.length]).concat(o),
        ),
      ),
      y = n.width,
      v = n.height,
      T = n.pixelRatio[0],
      S = n.pixelRatio[1];
    return pe.box(
      pe.types.avc1,
      new Uint8Array([
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        (y >> 8) & 255,
        y & 255,
        (v >> 8) & 255,
        v & 255,
        0,
        72,
        0,
        0,
        0,
        72,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        18,
        100,
        97,
        105,
        108,
        121,
        109,
        111,
        116,
        105,
        111,
        110,
        47,
        104,
        108,
        115,
        46,
        106,
        115,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        24,
        17,
        17,
      ]),
      d,
      pe.box(pe.types.btrt, new Uint8Array([0, 28, 156, 128, 0, 45, 198, 192, 0, 45, 198, 192])),
      pe.box(
        pe.types.pasp,
        new Uint8Array([
          T >> 24,
          (T >> 16) & 255,
          (T >> 8) & 255,
          T & 255,
          S >> 24,
          (S >> 16) & 255,
          (S >> 8) & 255,
          S & 255,
        ]),
      ),
    );
  }
  static esds(n) {
    const i = n.config;
    return new Uint8Array([
      0,
      0,
      0,
      0,
      3,
      25,
      0,
      1,
      0,
      4,
      17,
      64,
      21,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      5,
      2,
      ...i,
      6,
      1,
      2,
    ]);
  }
  static audioStsd(n) {
    const i = n.samplerate || 0;
    return new Uint8Array([
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      1,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      n.channelCount || 0,
      0,
      16,
      0,
      0,
      0,
      0,
      (i >> 8) & 255,
      i & 255,
      0,
      0,
    ]);
  }
  static mp4a(n) {
    return pe.box(pe.types.mp4a, pe.audioStsd(n), pe.box(pe.types.esds, pe.esds(n)));
  }
  static mp3(n) {
    return pe.box(pe.types[".mp3"], pe.audioStsd(n));
  }
  static ac3(n) {
    return pe.box(pe.types["ac-3"], pe.audioStsd(n), pe.box(pe.types.dac3, n.config));
  }
  static stsd(n) {
    const { segmentCodec: i } = n;
    if (n.type === "audio") {
      if (i === "aac") return pe.box(pe.types.stsd, pe.STSD, pe.mp4a(n));
      if (i === "ac3" && n.config) return pe.box(pe.types.stsd, pe.STSD, pe.ac3(n));
      if (i === "mp3" && n.codec === "mp3") return pe.box(pe.types.stsd, pe.STSD, pe.mp3(n));
    } else if (n.pps && n.sps) {
      if (i === "avc") return pe.box(pe.types.stsd, pe.STSD, pe.avc1(n));
      if (i === "hevc" && n.vps) return pe.box(pe.types.stsd, pe.STSD, pe.hvc1(n));
    } else throw new Error("video track missing pps or sps");
    throw new Error("unsupported ".concat(n.type, " segment codec (").concat(i, "/").concat(n.codec, ")"));
  }
  static tkhd(n) {
    const i = n.id,
      o = (n.duration || 0) * (n.timescale || 0),
      l = n.width || 0,
      h = n.height || 0,
      p = Math.floor(o / (wo + 1)),
      d = Math.floor(o % (wo + 1));
    return pe.box(
      pe.types.tkhd,
      new Uint8Array([
        1,
        0,
        0,
        7,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        2,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        3,
        (i >> 24) & 255,
        (i >> 16) & 255,
        (i >> 8) & 255,
        i & 255,
        0,
        0,
        0,
        0,
        p >> 24,
        (p >> 16) & 255,
        (p >> 8) & 255,
        p & 255,
        d >> 24,
        (d >> 16) & 255,
        (d >> 8) & 255,
        d & 255,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        64,
        0,
        0,
        0,
        (l >> 8) & 255,
        l & 255,
        0,
        0,
        (h >> 8) & 255,
        h & 255,
        0,
        0,
      ]),
    );
  }
  static traf(n, i) {
    const o = pe.sdtp(n),
      l = n.id,
      h = Math.floor(i / (wo + 1)),
      p = Math.floor(i % (wo + 1));
    return pe.box(
      pe.types.traf,
      pe.box(pe.types.tfhd, new Uint8Array([0, 0, 0, 0, l >> 24, (l >> 16) & 255, (l >> 8) & 255, l & 255])),
      pe.box(
        pe.types.tfdt,
        new Uint8Array([
          1,
          0,
          0,
          0,
          h >> 24,
          (h >> 16) & 255,
          (h >> 8) & 255,
          h & 255,
          p >> 24,
          (p >> 16) & 255,
          (p >> 8) & 255,
          p & 255,
        ]),
      ),
      pe.trun(n, o.length + 16 + 20 + 8 + 16 + 8 + 8),
      o,
    );
  }
  static trak(n) {
    return ((n.duration = n.duration || 4294967295), pe.box(pe.types.trak, pe.tkhd(n), pe.mdia(n)));
  }
  static trex(n) {
    const i = n.id;
    return pe.box(
      pe.types.trex,
      new Uint8Array([
        0,
        0,
        0,
        0,
        i >> 24,
        (i >> 16) & 255,
        (i >> 8) & 255,
        i & 255,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        1,
      ]),
    );
  }
  static trun(n, i) {
    const o = n.samples || [],
      l = o.length,
      h = 12 + 16 * l,
      p = new Uint8Array(h);
    let d, y, v, T, S, w;
    for (
      i += 8 + h,
        p.set(
          [
            n.type === "video" ? 1 : 0,
            0,
            15,
            1,
            (l >>> 24) & 255,
            (l >>> 16) & 255,
            (l >>> 8) & 255,
            l & 255,
            (i >>> 24) & 255,
            (i >>> 16) & 255,
            (i >>> 8) & 255,
            i & 255,
          ],
          0,
        ),
        d = 0;
      d < l;
      d++
    )
      ((y = o[d]),
        (v = y.duration),
        (T = y.size),
        (S = y.flags),
        (w = y.cts),
        p.set(
          [
            (v >>> 24) & 255,
            (v >>> 16) & 255,
            (v >>> 8) & 255,
            v & 255,
            (T >>> 24) & 255,
            (T >>> 16) & 255,
            (T >>> 8) & 255,
            T & 255,
            (S.isLeading << 2) | S.dependsOn,
            (S.isDependedOn << 6) | (S.hasRedundancy << 4) | (S.paddingValue << 1) | S.isNonSync,
            S.degradPrio & 61440,
            S.degradPrio & 15,
            (w >>> 24) & 255,
            (w >>> 16) & 255,
            (w >>> 8) & 255,
            w & 255,
          ],
          12 + 16 * d,
        ));
    return pe.box(pe.types.trun, p);
  }
  static initSegment(n) {
    pe.types || pe.init();
    const i = pe.moov(n);
    return Mr(pe.FTYP, i);
  }
  static hvc1(n) {
    const i = n.params,
      o = [n.vps, n.sps, n.pps],
      l = 4,
      h = new Uint8Array([
        1,
        (i.general_profile_space << 6) | (i.general_tier_flag ? 32 : 0) | i.general_profile_idc,
        i.general_profile_compatibility_flags[0],
        i.general_profile_compatibility_flags[1],
        i.general_profile_compatibility_flags[2],
        i.general_profile_compatibility_flags[3],
        i.general_constraint_indicator_flags[0],
        i.general_constraint_indicator_flags[1],
        i.general_constraint_indicator_flags[2],
        i.general_constraint_indicator_flags[3],
        i.general_constraint_indicator_flags[4],
        i.general_constraint_indicator_flags[5],
        i.general_level_idc,
        240 | (i.min_spatial_segmentation_idc >> 8),
        255 & i.min_spatial_segmentation_idc,
        252 | i.parallelismType,
        252 | i.chroma_format_idc,
        248 | i.bit_depth_luma_minus8,
        248 | i.bit_depth_chroma_minus8,
        0,
        parseInt(i.frame_rate.fps),
        (l - 1) | (i.temporal_id_nested << 2) | (i.num_temporal_layers << 3) | (i.frame_rate.fixed ? 64 : 0),
        o.length,
      ]);
    let p = h.length;
    for (let L = 0; L < o.length; L += 1) {
      p += 3;
      for (let k = 0; k < o[L].length; k += 1) p += 2 + o[L][k].length;
    }
    const d = new Uint8Array(p);
    (d.set(h, 0), (p = h.length));
    const y = o.length - 1;
    for (let L = 0; L < o.length; L += 1) {
      (d.set(new Uint8Array([(32 + L) | (L === y ? 128 : 0), 0, o[L].length]), p), (p += 3));
      for (let k = 0; k < o[L].length; k += 1)
        (d.set(new Uint8Array([o[L][k].length >> 8, o[L][k].length & 255]), p),
          (p += 2),
          d.set(o[L][k], p),
          (p += o[L][k].length));
    }
    const v = pe.box(pe.types.hvcC, d),
      T = n.width,
      S = n.height,
      w = n.pixelRatio[0],
      C = n.pixelRatio[1];
    return pe.box(
      pe.types.hvc1,
      new Uint8Array([
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        (T >> 8) & 255,
        T & 255,
        (S >> 8) & 255,
        S & 255,
        0,
        72,
        0,
        0,
        0,
        72,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        1,
        18,
        100,
        97,
        105,
        108,
        121,
        109,
        111,
        116,
        105,
        111,
        110,
        47,
        104,
        108,
        115,
        46,
        106,
        115,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        24,
        17,
        17,
      ]),
      v,
      pe.box(pe.types.btrt, new Uint8Array([0, 28, 156, 128, 0, 45, 198, 192, 0, 45, 198, 192])),
      pe.box(
        pe.types.pasp,
        new Uint8Array([
          w >> 24,
          (w >> 16) & 255,
          (w >> 8) & 255,
          w & 255,
          C >> 24,
          (C >> 16) & 255,
          (C >> 8) & 255,
          C & 255,
        ]),
      ),
    );
  }
}
pe.types = void 0;
pe.HDLR_TYPES = void 0;
pe.STTS = void 0;
pe.STSC = void 0;
pe.STCO = void 0;
pe.STSZ = void 0;
pe.VMHD = void 0;
pe.SMHD = void 0;
pe.STSD = void 0;
pe.FTYP = void 0;
pe.DINF = void 0;
const SM = 9e4;
function IS(u, n, i = 1, o = !1) {
  const l = u * n * i;
  return o ? Math.round(l) : l;
}
function x9(u, n, i = 1, o = !1) {
  return IS(u, n, 1 / i, o);
}
function Qc(u, n = !1) {
  return IS(u, 1e3, 1 / SM, n);
}
function T9(u, n = 1) {
  return IS(u, SM, 1 / n);
}
function Ib(u) {
  const { baseTime: n, timescale: i, trackId: o } = u;
  return ""
    .concat(n / i, " (")
    .concat(n, "/")
    .concat(i, ") trackId: ")
    .concat(o);
}
const S9 = 10 * 1e3,
  E9 = 1024,
  A9 = 1152,
  I9 = 1536;
let Gl = null,
  Nx = null;
function wb(u, n, i, o) {
  return {
    duration: n,
    size: i,
    cts: o,
    flags: {
      isLeading: 0,
      isDependedOn: 0,
      hasRedundancy: 0,
      degradPrio: 0,
      dependsOn: u ? 2 : 1,
      isNonSync: u ? 0 : 1,
    },
  };
}
class mg extends Pr {
  constructor(n, i, o, l) {
    if (
      (super("mp4-remuxer", l),
      (this.observer = void 0),
      (this.config = void 0),
      (this.typeSupported = void 0),
      (this.ISGenerated = !1),
      (this._initPTS = null),
      (this._initDTS = null),
      (this.nextVideoTs = null),
      (this.nextAudioTs = null),
      (this.videoSampleDuration = null),
      (this.isAudioContiguous = !1),
      (this.isVideoContiguous = !1),
      (this.videoTrackConfig = void 0),
      (this.observer = n),
      (this.config = i),
      (this.typeSupported = o),
      (this.ISGenerated = !1),
      Gl === null)
    ) {
      const p = (navigator.userAgent || "").match(/Chrome\/(\d+)/i);
      Gl = p ? parseInt(p[1]) : 0;
    }
    if (Nx === null) {
      const h = navigator.userAgent.match(/Safari\/(\d+)/i);
      Nx = h ? parseInt(h[1]) : 0;
    }
  }
  destroy() {
    this.config = this.videoTrackConfig = this._initPTS = this._initDTS = null;
  }
  resetTimeStamp(n) {
    const i = this._initPTS;
    ((!i || !n || n.trackId !== i.trackId || n.baseTime !== i.baseTime || n.timescale !== i.timescale) &&
      this.log("Reset initPTS: ".concat(i && Ib(i), " > ").concat(n && Ib(n))),
      (this._initPTS = this._initDTS = n));
  }
  resetNextTimestamp() {
    (this.log("reset next timestamp"), (this.isVideoContiguous = !1), (this.isAudioContiguous = !1));
  }
  resetInitSegment() {
    (this.log("ISGenerated flag reset"), (this.ISGenerated = !1), (this.videoTrackConfig = void 0));
  }
  getVideoStartPts(n) {
    let i = !1;
    const o = n[0].pts,
      l = n.reduce((h, p) => {
        let d = p.pts,
          y = d - h;
        return (y < -4294967296 && ((i = !0), (d = xr(d, o)), (y = d - h)), y > 0 ? h : d);
      }, o);
    return (i && this.debug("PTS rollover detected"), l);
  }
  remux(n, i, o, l, h, p, d, y) {
    let v,
      T,
      S,
      w,
      C,
      L,
      k = h,
      O = h;
    const B = n.pid > -1,
      N = i.pid > -1,
      $ = i.samples.length,
      I = n.samples.length > 0,
      V = (d && $ > 0) || $ > 1;
    if (((!B || I) && (!N || V)) || this.ISGenerated || d) {
      if (this.ISGenerated) {
        var Y, te, _, K;
        const ae = this.videoTrackConfig;
        ((ae &&
          (i.width !== ae.width ||
            i.height !== ae.height ||
            ((Y = i.pixelRatio) == null ? void 0 : Y[0]) !==
              ((te = ae.pixelRatio) == null ? void 0 : te[0]) ||
            ((_ = i.pixelRatio) == null ? void 0 : _[1]) !==
              ((K = ae.pixelRatio) == null ? void 0 : K[1]))) ||
          (!ae && V) ||
          (this.nextAudioTs === null && I)) &&
          this.resetInitSegment();
      }
      this.ISGenerated || (S = this.generateIS(n, i, h, p));
      const q = this.isVideoContiguous;
      let ce = -1,
        he;
      if (V && ((ce = w9(i.samples)), !q && this.config.forceKeyFrameOnDiscontinuity))
        if (((L = !0), ce > 0)) {
          this.warn("Dropped ".concat(ce, " out of ").concat($, " video samples due to a missing keyframe"));
          const ae = this.getVideoStartPts(i.samples);
          ((i.samples = i.samples.slice(ce)),
            (i.dropped += ce),
            (O += (i.samples[0].pts - ae) / i.inputTimeScale),
            (he = O));
        } else ce === -1 && (this.warn("No keyframe found out of ".concat($, " video samples")), (L = !1));
      if (this.ISGenerated) {
        if (I && V) {
          const ae = this.getVideoStartPts(i.samples),
            ve = (xr(n.samples[0].pts, ae) - ae) / i.inputTimeScale;
          ((k += Math.max(0, ve)), (O += Math.max(0, -ve)));
        }
        if (I) {
          if (
            (n.samplerate ||
              (this.warn("regenerate InitSegment as audio detected"), (S = this.generateIS(n, i, h, p))),
            (T = this.remuxAudio(n, k, this.isAudioContiguous, p, N || V || y === Xe.AUDIO ? O : void 0)),
            V)
          ) {
            const ae = T ? T.endPTS - T.startPTS : 0;
            (i.inputTimeScale ||
              (this.warn("regenerate InitSegment as video detected"), (S = this.generateIS(n, i, h, p))),
              (v = this.remuxVideo(i, O, q, ae)));
          }
        } else V && (v = this.remuxVideo(i, O, q, 0));
        v && ((v.firstKeyFrame = ce), (v.independent = ce !== -1), (v.firstKeyFramePTS = he));
      }
    }
    return (
      this.ISGenerated &&
        this._initPTS &&
        this._initDTS &&
        (o.samples.length && (C = EM(o, h, this._initPTS, this._initDTS)),
        l.samples.length && (w = AM(l, h, this._initPTS))),
      { audio: T, video: v, initSegment: S, independent: L, text: w, id3: C }
    );
  }
  computeInitPts(n, i, o, l) {
    const h = Math.round(o * i);
    let p = xr(n, h);
    if (p < h + i)
      for (
        this.log("Adjusting PTS for rollover in timeline near ".concat((h - p) / i, " ").concat(l));
        p < h + i;
      )
        p += 8589934592;
    return p - h;
  }
  generateIS(n, i, o, l) {
    const h = n.samples,
      p = i.samples,
      d = this.typeSupported,
      y = {},
      v = this._initPTS;
    let T = !v || l,
      S = "audio/mp4",
      w,
      C,
      L,
      k = -1;
    if ((T && (w = C = 1 / 0), n.config && h.length)) {
      switch (((n.timescale = n.samplerate), n.segmentCodec)) {
        case "mp3":
          d.mpeg ? ((S = "audio/mpeg"), (n.codec = "")) : d.mp3 && (n.codec = "mp3");
          break;
        case "ac3":
          n.codec = "ac-3";
          break;
      }
      ((y.audio = {
        id: "audio",
        container: S,
        codec: n.codec,
        initSegment: n.segmentCodec === "mp3" && d.mpeg ? new Uint8Array(0) : pe.initSegment([n]),
        metadata: { channelCount: n.channelCount },
      }),
        T &&
          ((k = n.id),
          (L = n.inputTimeScale),
          !v || L !== v.timescale ? (w = C = this.computeInitPts(h[0].pts, L, o, "audio")) : (T = !1)));
    }
    if (i.sps && i.pps && p.length) {
      if (
        ((i.timescale = i.inputTimeScale),
        (y.video = {
          id: "main",
          container: "video/mp4",
          codec: i.codec,
          initSegment: pe.initSegment([i]),
          metadata: { width: i.width, height: i.height },
        }),
        T)
      )
        if (((k = i.id), (L = i.inputTimeScale), !v || L !== v.timescale)) {
          const O = this.getVideoStartPts(p),
            B = xr(p[0].dts, O),
            N = this.computeInitPts(B, L, o, "video"),
            $ = this.computeInitPts(O, L, o, "video");
          ((C = Math.min(C, N)), (w = Math.min(w, $)));
        } else T = !1;
      this.videoTrackConfig = { width: i.width, height: i.height, pixelRatio: i.pixelRatio };
    }
    if (Object.keys(y).length)
      return (
        (this.ISGenerated = !0),
        T
          ? (v &&
              this.warn(
                "Timestamps at playlist time: "
                  .concat(l ? "" : "~")
                  .concat(o, " ")
                  .concat(w / L, " != initPTS: ")
                  .concat(v.baseTime / v.timescale, " (")
                  .concat(v.baseTime, "/")
                  .concat(v.timescale, ") trackId: ")
                  .concat(v.trackId),
              ),
            this.log(
              "Found initPTS at playlist time: "
                .concat(o, " offset: ")
                .concat(w / L, " (")
                .concat(w, "/")
                .concat(L, ") trackId: ")
                .concat(k),
            ),
            (this._initPTS = { baseTime: w, timescale: L, trackId: k }),
            (this._initDTS = { baseTime: C, timescale: L, trackId: k }))
          : (w = L = void 0),
        { tracks: y, initPTS: w, timescale: L, trackId: k }
      );
  }
  remuxVideo(n, i, o, l) {
    const h = n.inputTimeScale,
      p = n.samples,
      d = [],
      y = p.length,
      v = this._initPTS,
      T = (v.baseTime * h) / v.timescale;
    let S = this.nextVideoTs,
      w = 8,
      C = this.videoSampleDuration,
      L,
      k,
      O = Number.POSITIVE_INFINITY,
      B = Number.NEGATIVE_INFINITY,
      N = !1;
    if (!o || S === null) {
      const Re = T + i * h,
        Ce = p[0].pts - xr(p[0].dts, p[0].pts);
      Gl && S !== null && Math.abs(Re - Ce - (S + T)) < 15e3 ? (o = !0) : (S = Re - Ce - T);
    }
    const $ = S + T;
    for (let Re = 0; Re < y; Re++) {
      const Ce = p[Re];
      ((Ce.pts = xr(Ce.pts, $)), (Ce.dts = xr(Ce.dts, $)), Ce.dts < p[Re > 0 ? Re - 1 : Re].dts && (N = !0));
    }
    (N &&
      p.sort(function (Re, Ce) {
        const W = Re.dts - Ce.dts,
          Qe = Re.pts - Ce.pts;
        return W || Qe;
      }),
      (L = p[0].dts),
      (k = p[p.length - 1].dts));
    const I = k - L,
      V = I ? Math.round(I / (y - 1)) : C || n.inputTimeScale / 30;
    if (o) {
      const Re = L - $,
        Ce = Re > V,
        W = Re < -1;
      if (
        (Ce || W) &&
        (Ce
          ? this.warn(
              ""
                .concat((n.segmentCodec || "").toUpperCase(), ": ")
                .concat(Qc(Re, !0), " ms (")
                .concat(Re, "dts) hole between fragments detected at ")
                .concat(i.toFixed(3)),
            )
          : this.warn(
              ""
                .concat((n.segmentCodec || "").toUpperCase(), ": ")
                .concat(Qc(-Re, !0), " ms (")
                .concat(Re, "dts) overlapping between fragments detected at ")
                .concat(i.toFixed(3)),
            ),
        !W || $ >= p[0].pts || Gl)
      ) {
        L = $;
        const Qe = p[0].pts - Re;
        if (Ce) ((p[0].dts = L), (p[0].pts = Qe));
        else {
          let ot = !0;
          for (let Je = 0; Je < p.length && !(p[Je].dts > Qe && ot); Je++) {
            const Ut = p[Je].pts;
            if (((p[Je].dts -= Re), (p[Je].pts -= Re), Je < p.length - 1)) {
              const St = p[Je + 1].pts,
                Xt = p[Je].pts,
                vn = St <= Xt,
                Rn = St <= Ut;
              ot = vn == Rn;
            }
          }
        }
        this.log(
          "Video: Initial PTS/DTS adjusted: "
            .concat(Qc(Qe, !0), "/")
            .concat(Qc(L, !0), ", delta: ")
            .concat(Qc(Re, !0), " ms"),
        );
      }
    }
    L = Math.max(0, L);
    let oe = 0,
      Y = 0,
      te = L;
    for (let Re = 0; Re < y; Re++) {
      const Ce = p[Re],
        W = Ce.units,
        Qe = W.length;
      let ot = 0;
      for (let Je = 0; Je < Qe; Je++) ot += W[Je].data.length;
      ((Y += ot),
        (oe += Qe),
        (Ce.length = ot),
        Ce.dts < te ? ((Ce.dts = te), (te += (V / 4) | 0 || 1)) : (te = Ce.dts),
        (O = Math.min(Ce.pts, O)),
        (B = Math.max(Ce.pts, B)));
    }
    k = p[y - 1].dts;
    const _ = Y + 4 * oe + 8;
    let K;
    try {
      K = new Uint8Array(_);
    } catch (Re) {
      this.observer.emit(F.ERROR, F.ERROR, {
        type: et.MUX_ERROR,
        details: ge.REMUX_ALLOC_ERROR,
        fatal: !1,
        error: Re,
        bytes: _,
        reason: "fail allocating video mdat ".concat(_),
      });
      return;
    }
    const q = new DataView(K.buffer);
    (q.setUint32(0, _), K.set(pe.types.mdat, 4));
    let ce = !1,
      he = Number.POSITIVE_INFINITY,
      ae = Number.POSITIVE_INFINITY,
      ye = Number.NEGATIVE_INFINITY,
      ve = Number.NEGATIVE_INFINITY;
    for (let Re = 0; Re < y; Re++) {
      const Ce = p[Re],
        W = Ce.units;
      let Qe = 0;
      for (let Ut = 0, St = W.length; Ut < St; Ut++) {
        const Xt = W[Ut],
          vn = Xt.data,
          Rn = Xt.data.byteLength;
        (q.setUint32(w, Rn), (w += 4), K.set(vn, w), (w += Rn), (Qe += 4 + Rn));
      }
      let ot;
      if (Re < y - 1) ((C = p[Re + 1].dts - Ce.dts), (ot = p[Re + 1].pts - Ce.pts));
      else {
        const Ut = this.config,
          St = Re > 0 ? Ce.dts - p[Re - 1].dts : V;
        if (
          ((ot = Re > 0 ? Ce.pts - p[Re - 1].pts : V), Ut.stretchShortVideoTrack && this.nextAudioTs !== null)
        ) {
          const Xt = Math.floor(Ut.maxBufferHole * h),
            vn = (l ? O + l * h : this.nextAudioTs + T) - Ce.pts;
          vn > Xt
            ? ((C = vn - St),
              C < 0 ? (C = St) : (ce = !0),
              this.log(
                "It is approximately "
                  .concat(vn / 90, " ms to the next segment; using duration ")
                  .concat(C / 90, " ms for the last video frame."),
              ))
            : (C = St);
        } else C = St;
      }
      const Je = Math.round(Ce.pts - Ce.dts);
      ((he = Math.min(he, C)),
        (ye = Math.max(ye, C)),
        (ae = Math.min(ae, ot)),
        (ve = Math.max(ve, ot)),
        d.push(wb(Ce.key, C, Qe, Je)));
    }
    if (d.length) {
      if (Gl) {
        if (Gl < 70) {
          const Re = d[0].flags;
          ((Re.dependsOn = 2), (Re.isNonSync = 0));
        }
      } else if (Nx && ve - ae < ye - he && V / ye < 0.025 && d[0].cts === 0) {
        this.warn(
          "Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.",
        );
        let Re = L;
        for (let Ce = 0, W = d.length; Ce < W; Ce++) {
          const Qe = Re + d[Ce].duration,
            ot = Re + d[Ce].cts;
          if (Ce < W - 1) {
            const Je = Qe + d[Ce + 1].cts;
            d[Ce].duration = Je - ot;
          } else d[Ce].duration = Ce ? d[Ce - 1].duration : V;
          ((d[Ce].cts = 0), (Re = Qe));
        }
      }
    }
    C = ce || !C ? V : C;
    const we = k + C;
    ((this.nextVideoTs = S = we - T), (this.videoSampleDuration = C), (this.isVideoContiguous = !0));
    const Ne = {
      data1: pe.moof(n.sequenceNumber++, L, rn(n, { samples: d })),
      data2: K,
      startPTS: (O - T) / h,
      endPTS: (B + C - T) / h,
      startDTS: (L - T) / h,
      endDTS: S / h,
      type: "video",
      hasAudio: !1,
      hasVideo: !0,
      nb: d.length,
      dropped: n.dropped,
    };
    return ((n.samples = []), (n.dropped = 0), Ne);
  }
  getSamplesPerFrame(n) {
    switch (n.segmentCodec) {
      case "mp3":
        return A9;
      case "ac3":
        return I9;
      default:
        return E9;
    }
  }
  remuxAudio(n, i, o, l, h) {
    const p = n.inputTimeScale,
      d = n.samplerate ? n.samplerate : p,
      y = p / d,
      v = this.getSamplesPerFrame(n),
      T = v * y,
      S = this._initPTS,
      w = n.segmentCodec === "mp3" && this.typeSupported.mpeg,
      C = [],
      L = h !== void 0;
    let k = n.samples,
      O = w ? 0 : 8,
      B = this.nextAudioTs || -1;
    const N = (S.baseTime * p) / S.timescale,
      $ = N + i * p;
    if (
      ((this.isAudioContiguous = o =
        o ||
        (k.length &&
          B > 0 &&
          ((l && Math.abs($ - (B + N)) < 9e3) || Math.abs(xr(k[0].pts, $) - (B + N)) < 20 * T))),
      k.forEach(function (ve) {
        ve.pts = xr(ve.pts, $);
      }),
      !o || B < 0)
    ) {
      const ve = k.length;
      if (
        ((k = k.filter(we => we.pts >= 0)),
        ve !== k.length &&
          this.warn(
            "Removed "
              .concat(k.length - ve, " of ")
              .concat(ve, " samples (initPTS ")
              .concat(N, " / ")
              .concat(p, ")"),
          ),
        !k.length)
      )
        return;
      h === 0 ? (B = 0) : l && !L ? (B = Math.max(0, $ - N)) : (B = k[0].pts - N);
    }
    if (n.segmentCodec === "aac") {
      const ve = this.config.maxAudioFramesDrift;
      for (let we = 0, Le = B + N; we < k.length; we++) {
        const ke = k[we],
          Ne = ke.pts,
          Re = Ne - Le,
          Ce = Math.abs((1e3 * Re) / p);
        if (Re <= -ve * T && L)
          we === 0 &&
            (this.warn(
              "Audio frame @ "
                .concat((Ne / p).toFixed(3), "s overlaps marker by ")
                .concat(Math.round((1e3 * Re) / p), " ms."),
            ),
            (this.nextAudioTs = B = Ne - N),
            (Le = Ne));
        else if (Re >= ve * T && Ce < S9 && L) {
          let W = Math.round(Re / T);
          for (Le = Ne - W * T; Le < 0 && W && T; ) (W--, (Le += T));
          (we === 0 && (this.nextAudioTs = B = Le - N),
            this.warn(
              "Injecting "
                .concat(W, " audio frames @ ")
                .concat(((Le - N) / p).toFixed(3), "s due to ")
                .concat(Math.round((1e3 * Re) / p), " ms gap."),
            ));
          for (let Qe = 0; Qe < W; Qe++) {
            let ot = v9.getSilentFrame(n.parsedCodec || n.manifestCodec || n.codec, n.channelCount);
            (ot ||
              (this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),
              (ot = ke.unit.subarray())),
              k.splice(we, 0, { unit: ot, pts: Le }),
              (Le += T),
              we++);
          }
        }
        ((ke.pts = Le), (Le += T));
      }
    }
    let I = null,
      V = null,
      oe,
      Y = 0,
      te = k.length;
    for (; te--; ) Y += k[te].unit.byteLength;
    for (let ve = 0, we = k.length; ve < we; ve++) {
      const Le = k[ve],
        ke = Le.unit;
      let Ne = Le.pts;
      if (V !== null) {
        const Ce = C[ve - 1];
        Ce.duration = Math.round((Ne - V) / y);
      } else if ((o && n.segmentCodec === "aac" && (Ne = B + N), (I = Ne), Y > 0)) {
        Y += O;
        try {
          oe = new Uint8Array(Y);
        } catch (Ce) {
          this.observer.emit(F.ERROR, F.ERROR, {
            type: et.MUX_ERROR,
            details: ge.REMUX_ALLOC_ERROR,
            fatal: !1,
            error: Ce,
            bytes: Y,
            reason: "fail allocating audio mdat ".concat(Y),
          });
          return;
        }
        w || (new DataView(oe.buffer).setUint32(0, Y), oe.set(pe.types.mdat, 4));
      } else return;
      oe.set(ke, O);
      const Re = ke.byteLength;
      ((O += Re), C.push(wb(!0, v, Re, 0)), (V = Ne));
    }
    const _ = C.length;
    if (!_) return;
    const K = C[C.length - 1];
    ((B = V - N), (this.nextAudioTs = B + y * K.duration));
    const q = w ? new Uint8Array(0) : pe.moof(n.sequenceNumber++, I / y, rn({}, n, { samples: C }));
    n.samples = [];
    const ce = (I - N) / p,
      he = this.nextAudioTs / p,
      ye = {
        data1: q,
        data2: oe,
        startPTS: ce,
        endPTS: he,
        startDTS: ce,
        endDTS: he,
        type: "audio",
        hasAudio: !0,
        hasVideo: !1,
        nb: _,
      };
    return ((this.isAudioContiguous = !0), ye);
  }
}
function xr(u, n) {
  let i;
  if (n === null) return u;
  for (n < u ? (i = -8589934592) : (i = 8589934592); Math.abs(u - n) > 4294967296; ) u += i;
  return u;
}
function w9(u) {
  for (let n = 0; n < u.length; n++) if (u[n].key) return n;
  return -1;
}
function EM(u, n, i, o) {
  const l = u.samples.length;
  if (!l) return;
  const h = u.inputTimeScale;
  for (let d = 0; d < l; d++) {
    const y = u.samples[d];
    ((y.pts = xr(y.pts - (i.baseTime * h) / i.timescale, n * h) / h),
      (y.dts = xr(y.dts - (o.baseTime * h) / o.timescale, n * h) / h));
  }
  const p = u.samples;
  return ((u.samples = []), { samples: p });
}
function AM(u, n, i) {
  const o = u.samples.length;
  if (!o) return;
  const l = u.inputTimeScale;
  for (let p = 0; p < o; p++) {
    const d = u.samples[p];
    d.pts = xr(d.pts - (i.baseTime * l) / i.timescale, n * l) / l;
  }
  u.samples.sort((p, d) => p.pts - d.pts);
  const h = u.samples;
  return ((u.samples = []), { samples: h });
}
class R9 extends Pr {
  constructor(n, i, o, l) {
    (super("passthrough-remuxer", l),
      (this.emitInitSegment = !1),
      (this.audioCodec = void 0),
      (this.videoCodec = void 0),
      (this.initData = void 0),
      (this.initPTS = null),
      (this.initTracks = void 0),
      (this.lastEndTime = null),
      (this.isVideoContiguous = !1));
  }
  destroy() {}
  resetTimeStamp(n) {
    this.lastEndTime = null;
    const i = this.initPTS;
    (i && n && i.baseTime === n.baseTime && i.timescale === n.timescale) || (this.initPTS = n);
  }
  resetNextTimestamp() {
    ((this.isVideoContiguous = !1), (this.lastEndTime = null));
  }
  resetInitSegment(n, i, o, l) {
    ((this.audioCodec = i),
      (this.videoCodec = o),
      this.generateInitSegment(n, l),
      (this.emitInitSegment = !0));
  }
  generateInitSegment(n, i) {
    let { audioCodec: o, videoCodec: l } = this;
    if (!(n != null && n.byteLength)) {
      ((this.initTracks = void 0), (this.initData = void 0));
      return;
    }
    const { audio: h, video: p } = (this.initData = _k(n));
    if (i) fH(n, i);
    else {
      const y = h || p;
      y != null &&
        y.encrypted &&
        this.warn('Init segment with encrypted track with has no key ("'.concat(y.codec, '")!'));
    }
    (h && (o = Rb(h, an.AUDIO, this)), p && (l = Rb(p, an.VIDEO, this)));
    const d = {};
    (h && p
      ? (d.audiovideo = {
          container: "video/mp4",
          codec: o + "," + l,
          supplemental: p.supplemental,
          encrypted: p.encrypted,
          initSegment: n,
          id: "main",
        })
      : h
        ? (d.audio = {
            container: "audio/mp4",
            codec: o,
            encrypted: h.encrypted,
            initSegment: n,
            id: "audio",
          })
        : p
          ? (d.video = {
              container: "video/mp4",
              codec: l,
              supplemental: p.supplemental,
              encrypted: p.encrypted,
              initSegment: n,
              id: "main",
            })
          : this.warn("initSegment does not contain moov or trak boxes."),
      (this.initTracks = d));
  }
  remux(n, i, o, l, h, p) {
    var d, y;
    let { initPTS: v, lastEndTime: T } = this;
    const S = { audio: void 0, video: void 0, text: l, id3: o, initSegment: void 0 };
    Ue(T) || (T = this.lastEndTime = h || 0);
    const w = i.samples;
    if (!w.length) return S;
    const C = { initPTS: void 0, timescale: void 0, trackId: void 0 };
    let L = this.initData;
    if (
      (((d = L) != null && d.length) || (this.generateInitSegment(w), (L = this.initData)),
      !((y = L) != null && y.length))
    )
      return (this.warn("Failed to generate initSegment."), S);
    this.emitInitSegment && ((C.tracks = this.initTracks), (this.emitInitSegment = !1));
    const k = gH(w, L, this),
      O = L.audio ? k[L.audio.id] : null,
      B = L.video ? k[L.video.id] : null,
      N = Yp(B, 1 / 0),
      $ = Yp(O, 1 / 0),
      I = Yp(B, 0, !0),
      V = Yp(O, 0, !0);
    let oe = h,
      Y = 0;
    const te = O && (!B || (!v && $ < N) || (v && v.trackId === L.audio.id)),
      _ = te ? O : B;
    if (_) {
      const Le = _.timescale,
        ke = _.start - h * Le,
        Ne = te ? L.audio.id : L.video.id;
      ((oe = _.start / Le),
        (Y = te ? V - $ : I - N),
        (p || !v) &&
          (C9(v, oe, h, Y) || Le !== v.timescale) &&
          (v &&
            this.warn(
              "Timestamps at playlist time: "
                .concat(p ? "" : "~")
                .concat(h, " ")
                .concat(ke / Le, " != initPTS: ")
                .concat(v.baseTime / v.timescale, " (")
                .concat(v.baseTime, "/")
                .concat(v.timescale, ") trackId: ")
                .concat(v.trackId),
            ),
          this.log(
            "Found initPTS at playlist time: "
              .concat(h, " offset: ")
              .concat(oe - h, " (")
              .concat(ke, "/")
              .concat(Le, ") trackId: ")
              .concat(Ne),
          ),
          (v = null),
          (C.initPTS = ke),
          (C.timescale = Le),
          (C.trackId = Ne)));
    } else this.warn("No audio or video samples found for initPTS at playlist time: ".concat(h));
    v
      ? ((C.initPTS = v.baseTime), (C.timescale = v.timescale), (C.trackId = v.trackId))
      : ((!C.timescale || C.trackId === void 0 || C.initPTS === void 0) &&
          (this.warn("Could not set initPTS"), (C.initPTS = oe), (C.timescale = 1), (C.trackId = -1)),
        (this.initPTS = v = { baseTime: C.initPTS, timescale: C.timescale, trackId: C.trackId }));
    const K = oe - v.baseTime / v.timescale,
      q = K + Y;
    Y > 0
      ? (this.lastEndTime = q)
      : (this.warn("Duration parsed from mp4 should be greater than zero"), this.resetNextTimestamp());
    const ce = !!L.audio,
      he = !!L.video;
    let ae = "";
    (ce && (ae += "audio"), he && (ae += "video"));
    const ye = (L.audio ? L.audio.encrypted : !1) || (L.video ? L.video.encrypted : !1),
      ve = {
        data1: w,
        startPTS: K,
        startDTS: K,
        endPTS: q,
        endDTS: q,
        type: ae,
        hasAudio: ce,
        hasVideo: he,
        nb: 1,
        dropped: 0,
        encrypted: ye,
      };
    ((S.audio = ce && !he ? ve : void 0), (S.video = he ? ve : void 0));
    const we = B == null ? void 0 : B.sampleCount;
    if (we) {
      const Le = B.keyFrameIndex,
        ke = Le !== -1;
      ((ve.nb = we),
        (ve.dropped = Le === 0 || this.isVideoContiguous ? 0 : ke ? Le : we),
        (ve.independent = ke),
        (ve.firstKeyFrame = Le),
        ke && B.keyFrameStart && (ve.firstKeyFramePTS = (B.keyFrameStart - v.baseTime) / v.timescale),
        this.isVideoContiguous || (S.independent = ke),
        this.isVideoContiguous || (this.isVideoContiguous = ke),
        ve.dropped &&
          this.warn(
            "fmp4 does not start with IDR: firstIDR "
              .concat(Le, "/")
              .concat(we, " dropped: ")
              .concat(ve.dropped, " start: ")
              .concat(ve.firstKeyFramePTS || "NA"),
          ));
    }
    return ((S.initSegment = C), (S.id3 = EM(o, h, v, v)), l.samples.length && (S.text = AM(l, h, v)), S);
  }
}
function Yp(u, n, i = !1) {
  return (u == null ? void 0 : u.start) !== void 0 ? (u.start + (i ? u.duration : 0)) / u.timescale : n;
}
function C9(u, n, i, o) {
  if (u === null) return !0;
  const l = Math.max(o, 1),
    h = n - u.baseTime / u.timescale;
  return Math.abs(h - i) > l;
}
function Rb(u, n, i) {
  const o = u.codec;
  return o && o.length > 4
    ? o
    : n === an.AUDIO
      ? o === "ec-3" || o === "ac-3" || o === "alac"
        ? o
        : o === "fLaC" || o === "Opus"
          ? Ng(o, !1)
          : (i.warn('Unhandled audio codec "'.concat(o, '" in mp4 MAP')), o || "mp4a")
      : (i.warn('Unhandled video codec "'.concat(o, '" in mp4 MAP')), o || "avc1");
}
let Hs;
try {
  Hs = self.performance.now.bind(self.performance);
} catch (u) {
  Hs = Date.now;
}
const yg = [
  { demux: h9, remux: R9 },
  { demux: Lo, remux: mg },
  { demux: l9, remux: mg },
  { demux: c9, remux: mg },
];
yg.splice(2, 0, { demux: u9, remux: mg });
class Cb {
  constructor(n, i, o, l, h, p) {
    ((this.asyncResult = !1),
      (this.logger = void 0),
      (this.observer = void 0),
      (this.typeSupported = void 0),
      (this.config = void 0),
      (this.id = void 0),
      (this.demuxer = void 0),
      (this.remuxer = void 0),
      (this.decrypter = void 0),
      (this.probe = void 0),
      (this.decryptionPromise = null),
      (this.transmuxConfig = void 0),
      (this.currentTransmuxState = void 0),
      (this.observer = n),
      (this.typeSupported = i),
      (this.config = o),
      (this.id = h),
      (this.logger = p));
  }
  configure(n) {
    ((this.transmuxConfig = n), this.decrypter && this.decrypter.reset());
  }
  push(n, i, o, l) {
    const h = o.transmuxing;
    h.executeStart = Hs();
    let p = new Uint8Array(n);
    const { currentTransmuxState: d, transmuxConfig: y } = this;
    l && (this.currentTransmuxState = l);
    const {
        contiguous: v,
        discontinuity: T,
        trackSwitch: S,
        accurateTimeOffset: w,
        timeOffset: C,
        initSegmentChange: L,
      } = l || d,
      { audioCodec: k, videoCodec: O, defaultInitPts: B, duration: N, initSegmentData: $ } = y,
      I = L9(p, i);
    if (I && ou(I.method)) {
      const te = this.getDecrypter(),
        _ = gS(I.method);
      if (te.isSync()) {
        let K = te.softwareDecrypt(p, I.key.buffer, I.iv.buffer, _);
        if (o.part > -1) {
          const ce = te.flush();
          K = ce && ce.buffer;
        }
        if (!K) return ((h.executeEnd = Hs()), Fx(o));
        p = new Uint8Array(K);
      } else
        return (
          (this.asyncResult = !0),
          (this.decryptionPromise = te.webCryptoDecrypt(p, I.key.buffer, I.iv.buffer, _).then(K => {
            const q = this.push(K, null, o);
            return ((this.decryptionPromise = null), q);
          })),
          this.decryptionPromise
        );
    }
    const V = this.needsProbing(T, S);
    if (V) {
      const te = this.configureTransmuxer(p);
      if (te)
        return (
          this.logger.warn("[transmuxer] ".concat(te.message)),
          this.observer.emit(F.ERROR, F.ERROR, {
            type: et.MEDIA_ERROR,
            details: ge.FRAG_PARSING_ERROR,
            fatal: !1,
            error: te,
            reason: te.message,
          }),
          (h.executeEnd = Hs()),
          Fx(o)
        );
    }
    ((T || S || L || V) && this.resetInitSegment($, k, O, N, i),
      (T || L || V) && this.resetInitialTimestamp(B),
      v || this.resetContiguity());
    const oe = this.transmux(p, I, C, w, o);
    this.asyncResult = Dd(oe);
    const Y = this.currentTransmuxState;
    return ((Y.contiguous = !0), (Y.discontinuity = !1), (Y.trackSwitch = !1), (h.executeEnd = Hs()), oe);
  }
  flush(n) {
    const i = n.transmuxing;
    i.executeStart = Hs();
    const { decrypter: o, currentTransmuxState: l, decryptionPromise: h } = this;
    if (h) return ((this.asyncResult = !0), h.then(() => this.flush(n)));
    const p = [],
      { timeOffset: d } = l;
    if (o) {
      const S = o.flush();
      S && p.push(this.push(S.buffer, null, n));
    }
    const { demuxer: y, remuxer: v } = this;
    if (!y || !v) {
      i.executeEnd = Hs();
      const S = [Fx(n)];
      return this.asyncResult ? Promise.resolve(S) : S;
    }
    const T = y.flush(d);
    return Dd(T)
      ? ((this.asyncResult = !0), T.then(S => (this.flushRemux(p, S, n), p)))
      : (this.flushRemux(p, T, n), this.asyncResult ? Promise.resolve(p) : p);
  }
  flushRemux(n, i, o) {
    const { audioTrack: l, videoTrack: h, id3Track: p, textTrack: d } = i,
      { accurateTimeOffset: y, timeOffset: v } = this.currentTransmuxState;
    this.logger.log(
      "[transmuxer.ts]: Flushed "
        .concat(this.id, " sn: ")
        .concat(o.sn)
        .concat(o.part > -1 ? " part: " + o.part : "", " of ")
        .concat(this.id === Xe.MAIN ? "level" : "track", " ")
        .concat(o.level),
    );
    const T = this.remuxer.remux(l, h, p, d, v, y, !0, this.id);
    (n.push({ remuxResult: T, chunkMeta: o }), (o.transmuxing.executeEnd = Hs()));
  }
  resetInitialTimestamp(n) {
    const { demuxer: i, remuxer: o } = this;
    !i || !o || (i.resetTimeStamp(n), o.resetTimeStamp(n));
  }
  resetContiguity() {
    const { demuxer: n, remuxer: i } = this;
    !n || !i || (n.resetContiguity(), i.resetNextTimestamp());
  }
  resetInitSegment(n, i, o, l, h) {
    const { demuxer: p, remuxer: d } = this;
    !p || !d || (p.resetInitSegment(n, i, o, l), d.resetInitSegment(n, i, o, h));
  }
  destroy() {
    (this.demuxer && (this.demuxer.destroy(), (this.demuxer = void 0)),
      this.remuxer && (this.remuxer.destroy(), (this.remuxer = void 0)));
  }
  transmux(n, i, o, l, h) {
    let p;
    return (
      i && i.method === "SAMPLE-AES"
        ? (p = this.transmuxSampleAes(n, i, o, l, h))
        : (p = this.transmuxUnencrypted(n, o, l, h)),
      p
    );
  }
  transmuxUnencrypted(n, i, o, l) {
    const {
      audioTrack: h,
      videoTrack: p,
      id3Track: d,
      textTrack: y,
    } = this.demuxer.demux(n, i, !1, !this.config.progressive);
    return { remuxResult: this.remuxer.remux(h, p, d, y, i, o, !1, this.id), chunkMeta: l };
  }
  transmuxSampleAes(n, i, o, l, h) {
    return this.demuxer
      .demuxSampleAes(n, i, o)
      .then(p => ({
        remuxResult: this.remuxer.remux(
          p.audioTrack,
          p.videoTrack,
          p.id3Track,
          p.textTrack,
          o,
          l,
          !1,
          this.id,
        ),
        chunkMeta: h,
      }));
  }
  configureTransmuxer(n) {
    const { config: i, observer: o, typeSupported: l } = this;
    let h;
    for (let S = 0, w = yg.length; S < w; S++) {
      var p;
      if ((p = yg[S].demux) != null && p.probe(n, this.logger)) {
        h = yg[S];
        break;
      }
    }
    if (!h) return new Error("Failed to find demuxer by probing fragment data");
    const d = this.demuxer,
      y = this.remuxer,
      v = h.remux,
      T = h.demux;
    ((!y || !(y instanceof v)) && (this.remuxer = new v(o, i, l, this.logger)),
      (!d || !(d instanceof T)) && ((this.demuxer = new T(o, i, l, this.logger)), (this.probe = T.probe)));
  }
  needsProbing(n, i) {
    return !this.demuxer || !this.remuxer || n || i;
  }
  getDecrypter() {
    let n = this.decrypter;
    return (n || (n = this.decrypter = new fS(this.config)), n);
  }
}
function L9(u, n) {
  let i = null;
  return (
    u.byteLength > 0 && (n == null ? void 0 : n.key) != null && n.iv !== null && n.method != null && (i = n),
    i
  );
}
const Fx = u => ({ remuxResult: {}, chunkMeta: u });
function Dd(u) {
  return "then" in u && u.then instanceof Function;
}
class _9 {
  constructor(n, i, o, l, h) {
    ((this.audioCodec = void 0),
      (this.videoCodec = void 0),
      (this.initSegmentData = void 0),
      (this.duration = void 0),
      (this.defaultInitPts = void 0),
      (this.audioCodec = n),
      (this.videoCodec = i),
      (this.initSegmentData = o),
      (this.duration = l),
      (this.defaultInitPts = h || null));
  }
}
class b9 {
  constructor(n, i, o, l, h, p) {
    ((this.discontinuity = void 0),
      (this.contiguous = void 0),
      (this.accurateTimeOffset = void 0),
      (this.trackSwitch = void 0),
      (this.timeOffset = void 0),
      (this.initSegmentChange = void 0),
      (this.discontinuity = n),
      (this.contiguous = i),
      (this.accurateTimeOffset = o),
      (this.trackSwitch = l),
      (this.timeOffset = h),
      (this.initSegmentChange = p));
  }
}
let Lb = 0;
class IM {
  constructor(n, i, o, l) {
    ((this.error = null),
      (this.hls = void 0),
      (this.id = void 0),
      (this.instanceNo = Lb++),
      (this.observer = void 0),
      (this.frag = null),
      (this.part = null),
      (this.useWorker = void 0),
      (this.workerContext = null),
      (this.transmuxer = null),
      (this.onTransmuxComplete = void 0),
      (this.onFlush = void 0),
      (this.onWorkerMessage = y => {
        const v = y.data,
          T = this.hls;
        if (!(!T || !(v != null && v.event) || v.instanceNo !== this.instanceNo))
          switch (v.event) {
            case "init": {
              var S;
              const w = (S = this.workerContext) == null ? void 0 : S.objectURL;
              w && self.URL.revokeObjectURL(w);
              break;
            }
            case "transmuxComplete": {
              this.handleTransmuxComplete(v.data);
              break;
            }
            case "flush": {
              this.onFlush(v.data);
              break;
            }
            case "workerLog": {
              T.logger[v.data.logType] && T.logger[v.data.logType](v.data.message);
              break;
            }
            default: {
              ((v.data = v.data || {}),
                (v.data.frag = this.frag),
                (v.data.part = this.part),
                (v.data.id = this.id),
                T.trigger(v.event, v.data));
              break;
            }
          }
      }),
      (this.onWorkerError = y => {
        if (!this.hls) return;
        const v = new Error("".concat(y.message, "  (").concat(y.filename, ":").concat(y.lineno, ")"));
        ((this.hls.config.enableWorker = !1),
          this.hls.logger.warn('Error in "'.concat(this.id, '" Web Worker, fallback to inline')),
          this.hls.trigger(F.ERROR, {
            type: et.OTHER_ERROR,
            details: ge.INTERNAL_EXCEPTION,
            fatal: !1,
            event: "demuxerWorker",
            error: v,
          }));
      }));
    const h = n.config;
    ((this.hls = n),
      (this.id = i),
      (this.useWorker = !!h.enableWorker),
      (this.onTransmuxComplete = o),
      (this.onFlush = l));
    const p = (y, v) => {
      ((v = v || {}),
        (v.frag = this.frag || void 0),
        y === F.ERROR && ((v = v), (v.parent = this.id), (v.part = this.part), (this.error = v.error)),
        this.hls.trigger(y, v));
    };
    ((this.observer = new vS()), this.observer.on(F.FRAG_DECRYPTED, p), this.observer.on(F.ERROR, p));
    const d = V_(h.preferManagedMediaSource);
    if (this.useWorker && typeof Worker < "u") {
      const y = this.hls.logger;
      if (h.workerPath || PK()) {
        try {
          h.workerPath
            ? (y.log("loading Web Worker ".concat(h.workerPath, ' for "').concat(i, '"')),
              (this.workerContext = NK(h.workerPath)))
            : (y.log('injecting Web Worker for "'.concat(i, '"')), (this.workerContext = OK()));
          const { worker: T } = this.workerContext;
          (T.addEventListener("message", this.onWorkerMessage),
            T.addEventListener("error", this.onWorkerError),
            T.postMessage({
              instanceNo: this.instanceNo,
              cmd: "init",
              typeSupported: d,
              id: i,
              config: ln(h),
            }));
        } catch (T) {
          (y.warn('Error setting up "'.concat(i, '" Web Worker, fallback to inline'), T),
            this.terminateWorker(),
            (this.error = null),
            (this.transmuxer = new Cb(this.observer, d, h, "", i, n.logger)));
        }
        return;
      }
    }
    this.transmuxer = new Cb(this.observer, d, h, "", i, n.logger);
  }
  reset() {
    if (((this.frag = null), (this.part = null), this.workerContext)) {
      const n = this.instanceNo;
      this.instanceNo = Lb++;
      const i = this.hls.config,
        o = V_(i.preferManagedMediaSource);
      this.workerContext.worker.postMessage({
        instanceNo: this.instanceNo,
        cmd: "reset",
        resetNo: n,
        typeSupported: o,
        id: this.id,
        config: ln(i),
      });
    }
  }
  terminateWorker() {
    if (this.workerContext) {
      const { worker: n } = this.workerContext;
      ((this.workerContext = null),
        n.removeEventListener("message", this.onWorkerMessage),
        n.removeEventListener("error", this.onWorkerError),
        FK(this.hls.config.workerPath));
    }
  }
  destroy() {
    if (this.workerContext) (this.terminateWorker(), (this.onWorkerMessage = this.onWorkerError = null));
    else {
      const i = this.transmuxer;
      i && (i.destroy(), (this.transmuxer = null));
    }
    const n = this.observer;
    (n && n.removeAllListeners(),
      (this.frag = null),
      (this.part = null),
      (this.observer = null),
      (this.hls = null));
  }
  push(n, i, o, l, h, p, d, y, v, T) {
    var S, w;
    v.transmuxing.start = self.performance.now();
    const { instanceNo: C, transmuxer: L } = this,
      k = p ? p.start : h.start,
      O = h.decryptdata,
      B = this.frag,
      N = !(B && h.cc === B.cc),
      $ = !(B && v.level === B.level),
      I = B ? v.sn - B.sn : -1,
      V = this.part ? v.part - this.part.index : -1,
      oe = I === 0 && v.id > 1 && v.id === (B == null ? void 0 : B.stats.chunkCount),
      Y = !$ && (I === 1 || (I === 0 && (V === 1 || (oe && V <= 0)))),
      te = self.performance.now();
    (($ || I || h.stats.parsing.start === 0) && (h.stats.parsing.start = te),
      p && (V || !Y) && (p.stats.parsing.start = te));
    const _ = !(
        B && ((S = h.initSegment) == null ? void 0 : S.url) === ((w = B.initSegment) == null ? void 0 : w.url)
      ),
      K = new b9(N, Y, y, $, k, _);
    if (!Y || N || _) {
      this.hls.logger.log(
        "[transmuxer-interface]: Starting new transmux session for "
          .concat(h.type, " sn: ")
          .concat(v.sn)
          .concat(v.part > -1 ? " part: " + v.part : "", " ")
          .concat(this.id === Xe.MAIN ? "level" : "track", ": ")
          .concat(v.level, " id: ")
          .concat(v.id, "\n        discontinuity: ")
          .concat(N, "\n        trackSwitch: ")
          .concat($, "\n        contiguous: ")
          .concat(Y, "\n        accurateTimeOffset: ")
          .concat(y, "\n        timeOffset: ")
          .concat(k, "\n        initSegmentChange: ")
          .concat(_),
      );
      const q = new _9(o, l, i, d, T);
      this.configureTransmuxer(q);
    }
    if (((this.frag = h), (this.part = p), this.workerContext))
      this.workerContext.worker.postMessage(
        { instanceNo: C, cmd: "demux", data: n, decryptdata: O, chunkMeta: v, state: K },
        n instanceof ArrayBuffer ? [n] : [],
      );
    else if (L) {
      const q = L.push(n, O, v, K);
      Dd(q)
        ? q
            .then(ce => {
              this.handleTransmuxComplete(ce);
            })
            .catch(ce => {
              this.transmuxerError(ce, v, "transmuxer-interface push error");
            })
        : this.handleTransmuxComplete(q);
    }
  }
  flush(n) {
    n.transmuxing.start = self.performance.now();
    const { instanceNo: i, transmuxer: o } = this;
    if (this.workerContext)
      this.workerContext.worker.postMessage({ instanceNo: i, cmd: "flush", chunkMeta: n });
    else if (o) {
      const l = o.flush(n);
      Dd(l)
        ? l
            .then(h => {
              this.handleFlushResult(h, n);
            })
            .catch(h => {
              this.transmuxerError(h, n, "transmuxer-interface flush error");
            })
        : this.handleFlushResult(l, n);
    }
  }
  transmuxerError(n, i, o) {
    this.hls &&
      ((this.error = n),
      this.hls.trigger(F.ERROR, {
        type: et.MEDIA_ERROR,
        details: ge.FRAG_PARSING_ERROR,
        chunkMeta: i,
        frag: this.frag || void 0,
        part: this.part || void 0,
        fatal: !1,
        error: n,
        err: n,
        reason: o,
      }));
  }
  handleFlushResult(n, i) {
    (n.forEach(o => {
      this.handleTransmuxComplete(o);
    }),
      this.onFlush(i));
  }
  configureTransmuxer(n) {
    const { instanceNo: i, transmuxer: o } = this;
    this.workerContext
      ? this.workerContext.worker.postMessage({ instanceNo: i, cmd: "configure", config: n })
      : o && o.configure(n);
  }
  handleTransmuxComplete(n) {
    ((n.chunkMeta.transmuxing.end = self.performance.now()), this.onTransmuxComplete(n));
  }
}
const _b = 100;
class D9 extends yS {
  constructor(n, i, o) {
    (super(n, i, o, "audio-stream-controller", Xe.AUDIO),
      (this.mainAnchor = null),
      (this.mainFragLoading = null),
      (this.audioOnly = !1),
      (this.bufferedTrack = null),
      (this.switchingTrack = null),
      (this.trackId = -1),
      (this.waitingData = null),
      (this.mainDetails = null),
      (this.flushing = !1),
      (this.bufferFlushed = !1),
      (this.cachedTrackLoadedData = null),
      this.registerListeners());
  }
  onHandlerDestroying() {
    (this.unregisterListeners(), super.onHandlerDestroying(), this.resetItem());
  }
  resetItem() {
    this.mainDetails =
      this.mainAnchor =
      this.mainFragLoading =
      this.bufferedTrack =
      this.switchingTrack =
      this.waitingData =
      this.cachedTrackLoadedData =
        null;
  }
  registerListeners() {
    super.registerListeners();
    const { hls: n } = this;
    (n.on(F.LEVEL_LOADED, this.onLevelLoaded, this),
      n.on(F.AUDIO_TRACKS_UPDATED, this.onAudioTracksUpdated, this),
      n.on(F.AUDIO_TRACK_SWITCHING, this.onAudioTrackSwitching, this),
      n.on(F.AUDIO_TRACK_LOADED, this.onAudioTrackLoaded, this),
      n.on(F.BUFFER_RESET, this.onBufferReset, this),
      n.on(F.BUFFER_CREATED, this.onBufferCreated, this),
      n.on(F.BUFFER_FLUSHING, this.onBufferFlushing, this),
      n.on(F.BUFFER_FLUSHED, this.onBufferFlushed, this),
      n.on(F.INIT_PTS_FOUND, this.onInitPtsFound, this),
      n.on(F.FRAG_LOADING, this.onFragLoading, this),
      n.on(F.FRAG_BUFFERED, this.onFragBuffered, this));
  }
  unregisterListeners() {
    const { hls: n } = this;
    n &&
      (super.unregisterListeners(),
      n.off(F.LEVEL_LOADED, this.onLevelLoaded, this),
      n.off(F.AUDIO_TRACKS_UPDATED, this.onAudioTracksUpdated, this),
      n.off(F.AUDIO_TRACK_SWITCHING, this.onAudioTrackSwitching, this),
      n.off(F.AUDIO_TRACK_LOADED, this.onAudioTrackLoaded, this),
      n.off(F.BUFFER_RESET, this.onBufferReset, this),
      n.off(F.BUFFER_CREATED, this.onBufferCreated, this),
      n.off(F.BUFFER_FLUSHING, this.onBufferFlushing, this),
      n.off(F.BUFFER_FLUSHED, this.onBufferFlushed, this),
      n.off(F.INIT_PTS_FOUND, this.onInitPtsFound, this),
      n.off(F.FRAG_LOADING, this.onFragLoading, this),
      n.off(F.FRAG_BUFFERED, this.onFragBuffered, this));
  }
  onInitPtsFound(n, { frag: i, id: o, initPTS: l, timescale: h, trackId: p }) {
    if (o === Xe.MAIN) {
      const d = i.cc,
        y = this.fragCurrent;
      if (
        ((this.initPTS[d] = { baseTime: l, timescale: h, trackId: p }),
        this.log(
          "InitPTS for cc: "
            .concat(d, " found from main: ")
            .concat(l / h, " (")
            .concat(l, "/")
            .concat(h, ") trackId: ")
            .concat(p),
        ),
        (this.mainAnchor = i),
        this.state === Te.WAITING_INIT_PTS)
      ) {
        const v = this.waitingData;
        ((!v && !this.loadingParts) || (v && v.frag.cc !== d)) &&
          this.syncWithAnchor(i, v == null ? void 0 : v.frag);
      } else
        !this.hls.hasEnoughToStart && y && y.cc !== d
          ? (y.abortRequests(), this.syncWithAnchor(i, y))
          : this.state === Te.IDLE && this.tick();
    }
  }
  getLoadPosition() {
    return !this.startFragRequested && this.nextLoadPosition >= 0
      ? this.nextLoadPosition
      : super.getLoadPosition();
  }
  syncWithAnchor(n, i) {
    var o;
    const l = ((o = this.mainFragLoading) == null ? void 0 : o.frag) || null;
    if (i && (l == null ? void 0 : l.cc) === i.cc) return;
    const h = (l || n).cc,
      p = this.getLevelDetails(),
      d = this.getLoadPosition(),
      y = $k(p, h, d);
    y &&
      (this.log("Syncing with main frag at ".concat(y.start, " cc ").concat(y.cc)),
      (this.startFragRequested = !1),
      (this.nextLoadPosition = y.start),
      this.resetLoadingState(),
      this.state === Te.IDLE && this.doTickIdle());
  }
  startLoad(n, i) {
    if (!this.levels) {
      ((this.startPosition = n), (this.state = Te.STOPPED));
      return;
    }
    const o = this.lastCurrentTime;
    (this.stopLoad(),
      this.setInterval(_b),
      o > 0 && n === -1
        ? (this.log("Override startPosition with lastCurrentTime @".concat(o.toFixed(3))),
          (n = o),
          (this.state = Te.IDLE))
        : (this.state = Te.WAITING_TRACK),
      (this.nextLoadPosition = this.lastCurrentTime = n + this.timelineOffset),
      (this.startPosition = i ? -1 : n),
      this.tick());
  }
  doTick() {
    switch (this.state) {
      case Te.IDLE:
        this.doTickIdle();
        break;
      case Te.WAITING_TRACK: {
        const { levels: n, trackId: i } = this,
          o = n == null ? void 0 : n[i],
          l = o == null ? void 0 : o.details;
        if (l && !this.waitForLive(o)) {
          if (this.waitForCdnTuneIn(l)) break;
          this.state = Te.WAITING_INIT_PTS;
        }
        break;
      }
      case Te.FRAG_LOADING_WAITING_RETRY: {
        this.checkRetryDate();
        break;
      }
      case Te.WAITING_INIT_PTS: {
        const n = this.waitingData;
        if (n) {
          const { frag: i, part: o, cache: l, complete: h } = n,
            p = this.mainAnchor;
          if (this.initPTS[i.cc] !== void 0) {
            ((this.waitingData = null), (this.state = Te.FRAG_LOADING));
            const d = l.flush().buffer,
              y = { frag: i, part: o, payload: d, networkDetails: null };
            (this._handleFragmentLoadProgress(y), h && super._handleFragmentLoadComplete(y));
          } else p && p.cc !== n.frag.cc && this.syncWithAnchor(p, n.frag);
        } else this.state = Te.IDLE;
      }
    }
    this.onTickEnd();
  }
  resetLoadingState() {
    const n = this.waitingData;
    (n && (this.fragmentTracker.removeFragment(n.frag), (this.waitingData = null)),
      super.resetLoadingState());
  }
  onTickEnd() {
    const { media: n } = this;
    n != null && n.readyState && (this.lastCurrentTime = n.currentTime);
  }
  doTickIdle() {
    var n;
    const { hls: i, levels: o, media: l, trackId: h } = this,
      p = i.config;
    if (
      !this.buffering ||
      (!l && !this.primaryPrefetch && (this.startFragRequested || !p.startFragPrefetch)) ||
      !(o != null && o[h])
    )
      return;
    const d = o[h],
      y = d.details;
    if (!y || this.waitForLive(d) || this.waitForCdnTuneIn(y)) {
      ((this.state = Te.WAITING_TRACK), (this.startFragRequested = !1));
      return;
    }
    const v = this.mediaBuffer ? this.mediaBuffer : this.media;
    this.bufferFlushed && v && ((this.bufferFlushed = !1), this.afterBufferFlushed(v, an.AUDIO, Xe.AUDIO));
    const T = this.getFwdBufferInfo(v, Xe.AUDIO);
    if (T === null) return;
    if (!this.switchingTrack && this._streamEnded(T, y)) {
      (i.trigger(F.BUFFER_EOS, { type: "audio" }), (this.state = Te.ENDED));
      return;
    }
    const S = T.len,
      w = i.maxBufferLength,
      C = y.fragments,
      L = C[0].start,
      k = this.getLoadPosition(),
      O = this.flushing ? k : T.end;
    if (this.switchingTrack && l) {
      const $ = k;
      y.PTSKnown &&
        $ < L &&
        (T.end > L || T.nextStart) &&
        (this.log("Alt audio track ahead of main track, seek to start of alt audio track"),
        (l.currentTime = L + 0.05));
    }
    if (S >= w && !this.switchingTrack && O < C[C.length - 1].start) return;
    let B = this.getNextFragment(O, y);
    if ((B && this.isLoopLoading(B, O) && (B = this.getNextFragmentLoopLoading(B, y, T, Xe.MAIN, w)), !B)) {
      this.bufferFlushed = !0;
      return;
    }
    let N = ((n = this.mainFragLoading) == null ? void 0 : n.frag) || null;
    if (
      !this.audioOnly &&
      this.startFragRequested &&
      N &&
      On(B) &&
      !B.endList &&
      (!y.live || (!this.loadingParts && O < this.hls.liveSyncPosition)) &&
      (this.fragmentTracker.getState(N) === ei.OK && (this.mainFragLoading = N = null), N && On(N))
    ) {
      if (B.start > N.end) {
        const I = this.fragmentTracker.getFragAtPos(O, Xe.MAIN);
        I && I.end > N.end && ((N = I), (this.mainFragLoading = { frag: I, targetBufferTime: null }));
      }
      if (B.start > N.end) return;
    }
    this.loadFragment(B, d, O);
  }
  onMediaDetaching(n, i) {
    ((this.bufferFlushed = this.flushing = !1), super.onMediaDetaching(n, i));
  }
  onAudioTracksUpdated(n, { audioTracks: i }) {
    (this.resetTransmuxer(), (this.levels = i.map(o => new Ld(o))));
  }
  onAudioTrackSwitching(n, i) {
    const o = !!i.url;
    this.trackId = i.id;
    const { fragCurrent: l } = this;
    (l && (l.abortRequests(), this.removeUnbufferedFrags(l.start)),
      this.resetLoadingState(),
      o
        ? ((this.switchingTrack = i),
          this.flushAudioIfNeeded(i),
          this.state !== Te.STOPPED && (this.setInterval(_b), (this.state = Te.IDLE), this.tick()))
        : (this.resetTransmuxer(),
          (this.switchingTrack = null),
          (this.bufferedTrack = i),
          this.clearInterval()));
  }
  onManifestLoading() {
    (super.onManifestLoading(),
      (this.bufferFlushed = this.flushing = this.audioOnly = !1),
      this.resetItem(),
      (this.trackId = -1));
  }
  onLevelLoaded(n, i) {
    this.mainDetails = i.details;
    const o = this.cachedTrackLoadedData;
    o && ((this.cachedTrackLoadedData = null), this.onAudioTrackLoaded(F.AUDIO_TRACK_LOADED, o));
  }
  onAudioTrackLoaded(n, i) {
    var o;
    const { levels: l } = this,
      { details: h, id: p, groupId: d, track: y } = i;
    if (!l) {
      this.warn(
        "Audio tracks reset while loading track ".concat(p, ' "').concat(y.name, '" of "').concat(d, '"'),
      );
      return;
    }
    const v = this.mainDetails;
    if (!v || h.endCC > v.endCC || v.expired) {
      ((this.cachedTrackLoadedData = i), this.state !== Te.STOPPED && (this.state = Te.WAITING_TRACK));
      return;
    }
    ((this.cachedTrackLoadedData = null),
      this.log(
        "Audio track "
          .concat(p, ' "')
          .concat(y.name, '" of "')
          .concat(d, '" loaded [')
          .concat(h.startSN, ",")
          .concat(h.endSN, "]")
          .concat(
            h.lastPartSn ? "[part-".concat(h.lastPartSn, "-").concat(h.lastPartIndex, "]") : "",
            ",duration:",
          )
          .concat(h.totalduration),
      ));
    const T = l[p];
    let S = 0;
    if (h.live || ((o = T.details) != null && o.live)) {
      if ((this.checkLiveUpdate(h), h.deltaUpdateFailed)) return;
      if (T.details) {
        var w;
        S = this.alignPlaylists(h, T.details, (w = this.levelLastLoaded) == null ? void 0 : w.details);
      }
      h.alignedSliding || (rM(h, v), h.alignedSliding || Vg(h, v), (S = h.fragmentStart));
    }
    ((T.details = h),
      (this.levelLastLoaded = T),
      this.startFragRequested || this.setStartPosition(v, S),
      this.hls.trigger(F.AUDIO_TRACK_UPDATED, { details: h, id: p, groupId: i.groupId }),
      this.state === Te.WAITING_TRACK && !this.waitForCdnTuneIn(h) && (this.state = Te.IDLE),
      this.tick());
  }
  _handleFragmentLoadProgress(n) {
    var i;
    const o = n.frag,
      { part: l, payload: h } = n,
      { config: p, trackId: d, levels: y } = this;
    if (!y) {
      this.warn(
        "Audio tracks were reset while fragment load was in progress. Fragment "
          .concat(o.sn, " of level ")
          .concat(o.level, " will not be buffered"),
      );
      return;
    }
    const v = y[d];
    if (!v) {
      this.warn("Audio track is undefined on fragment load progress");
      return;
    }
    const T = v.details;
    if (!T) {
      (this.warn("Audio track details undefined on fragment load progress"),
        this.removeUnbufferedFrags(o.start));
      return;
    }
    const S = p.defaultAudioCodec || v.audioCodec || "mp4a.40.2";
    let w = this.transmuxer;
    w ||
      (w = this.transmuxer =
        new IM(
          this.hls,
          Xe.AUDIO,
          this._handleTransmuxComplete.bind(this),
          this._handleTransmuxerFlush.bind(this),
        ));
    const C = this.initPTS[o.cc],
      L = (i = o.initSegment) == null ? void 0 : i.data;
    if (C !== void 0) {
      const O = l ? l.index : -1,
        B = O !== -1,
        N = new pS(o.level, o.sn, o.stats.chunkCount, h.byteLength, O, B);
      w.push(h, L, S, "", o, l, T.totalduration, !1, N, C);
    } else {
      this.log(
        "Unknown video PTS for cc "
          .concat(o.cc, ", waiting for video PTS before demuxing audio frag ")
          .concat(o.sn, " of [")
          .concat(T.startSN, " ,")
          .concat(T.endSN, "],track ")
          .concat(d),
      );
      const { cache: k } = (this.waitingData = this.waitingData || {
        frag: o,
        part: l,
        cache: new sM(),
        complete: !1,
      });
      (k.push(new Uint8Array(h)), this.state !== Te.STOPPED && (this.state = Te.WAITING_INIT_PTS));
    }
  }
  _handleFragmentLoadComplete(n) {
    if (this.waitingData) {
      this.waitingData.complete = !0;
      return;
    }
    super._handleFragmentLoadComplete(n);
  }
  onBufferReset() {
    this.mediaBuffer = null;
  }
  onBufferCreated(n, i) {
    this.bufferFlushed = this.flushing = !1;
    const o = i.tracks.audio;
    o && (this.mediaBuffer = o.buffer || null);
  }
  onFragLoading(n, i) {
    !this.audioOnly &&
      i.frag.type === Xe.MAIN &&
      On(i.frag) &&
      ((this.mainFragLoading = i), this.state === Te.IDLE && this.tick());
  }
  onFragBuffered(n, i) {
    const { frag: o, part: l } = i;
    if (o.type !== Xe.AUDIO) {
      !this.audioOnly &&
        o.type === Xe.MAIN &&
        !o.elementaryStreams.video &&
        !o.elementaryStreams.audiovideo &&
        ((this.audioOnly = !0), (this.mainFragLoading = null));
      return;
    }
    if (this.fragContextChanged(o)) {
      this.warn(
        "Fragment "
          .concat(o.sn)
          .concat(l ? " p: " + l.index : "", " of level ")
          .concat(o.level, " finished buffering, but was aborted. state: ")
          .concat(this.state, ", audioSwitch: ")
          .concat(this.switchingTrack ? this.switchingTrack.name : "false"),
      );
      return;
    }
    if (On(o)) {
      this.fragPrevious = o;
      const h = this.switchingTrack;
      h &&
        ((this.bufferedTrack = h),
        (this.switchingTrack = null),
        this.hls.trigger(F.AUDIO_TRACK_SWITCHED, Jt({}, h)));
    }
    (this.fragBufferedComplete(o, l), this.media && this.tick());
  }
  onError(n, i) {
    var o;
    if (i.fatal) {
      this.state = Te.ERROR;
      return;
    }
    switch (i.details) {
      case ge.FRAG_GAP:
      case ge.FRAG_PARSING_ERROR:
      case ge.FRAG_DECRYPT_ERROR:
      case ge.FRAG_LOAD_ERROR:
      case ge.FRAG_LOAD_TIMEOUT:
      case ge.KEY_LOAD_ERROR:
      case ge.KEY_LOAD_TIMEOUT:
        this.onFragmentOrKeyLoadError(Xe.AUDIO, i);
        break;
      case ge.AUDIO_TRACK_LOAD_ERROR:
      case ge.AUDIO_TRACK_LOAD_TIMEOUT:
      case ge.LEVEL_PARSING_ERROR:
        !i.levelRetry &&
          this.state === Te.WAITING_TRACK &&
          ((o = i.context) == null ? void 0 : o.type) === Ot.AUDIO_TRACK &&
          (this.state = Te.IDLE);
        break;
      case ge.BUFFER_ADD_CODEC_ERROR:
      case ge.BUFFER_APPEND_ERROR:
        if (i.parent !== "audio") return;
        this.reduceLengthAndFlushBuffer(i) || this.resetLoadingState();
        break;
      case ge.BUFFER_FULL_ERROR:
        if (i.parent !== "audio") return;
        this.reduceLengthAndFlushBuffer(i) &&
          ((this.bufferedTrack = null), super.flushMainBuffer(0, Number.POSITIVE_INFINITY, "audio"));
        break;
      case ge.INTERNAL_EXCEPTION:
        this.recoverWorkerError(i);
        break;
    }
  }
  onBufferFlushing(n, { type: i }) {
    i !== an.VIDEO && (this.flushing = !0);
  }
  onBufferFlushed(n, { type: i }) {
    if (i !== an.VIDEO) {
      ((this.flushing = !1), (this.bufferFlushed = !0), this.state === Te.ENDED && (this.state = Te.IDLE));
      const o = this.mediaBuffer || this.media;
      o && (this.afterBufferFlushed(o, i, Xe.AUDIO), this.tick());
    }
  }
  _handleTransmuxComplete(n) {
    var i;
    const o = "audio",
      { hls: l } = this,
      { remuxResult: h, chunkMeta: p } = n,
      d = this.getCurrentContext(p);
    if (!d) {
      this.resetWhenMissingContext(p);
      return;
    }
    const { frag: y, part: v, level: T } = d,
      { details: S } = T,
      { audio: w, text: C, id3: L, initSegment: k } = h;
    if (this.fragContextChanged(y) || !S) {
      this.fragmentTracker.removeFragment(y);
      return;
    }
    if (
      ((this.state = Te.PARSING),
      this.switchingTrack && w && this.completeAudioSwitch(this.switchingTrack),
      k != null && k.tracks)
    ) {
      const O = y.initSegment || y;
      if (this.unhandledEncryptionError(k, y)) return;
      (this._bufferInitSegment(T, k.tracks, O, p),
        l.trigger(F.FRAG_PARSING_INIT_SEGMENT, { frag: O, id: o, tracks: k.tracks }));
    }
    if (w) {
      const { startPTS: O, endPTS: B, startDTS: N, endDTS: $ } = w;
      (v && (v.elementaryStreams[an.AUDIO] = { startPTS: O, endPTS: B, startDTS: N, endDTS: $ }),
        y.setElementaryStreamInfo(an.AUDIO, O, B, N, $),
        this.bufferFragmentData(w, y, v, p));
    }
    if (L != null && (i = L.samples) != null && i.length) {
      const O = rn({ id: o, frag: y, details: S }, L);
      l.trigger(F.FRAG_PARSING_METADATA, O);
    }
    if (C) {
      const O = rn({ id: o, frag: y, details: S }, C);
      l.trigger(F.FRAG_PARSING_USERDATA, O);
    }
  }
  _bufferInitSegment(n, i, o, l) {
    if (
      this.state !== Te.PARSING ||
      (i.video && delete i.video, i.audiovideo && delete i.audiovideo, !i.audio)
    )
      return;
    const h = i.audio;
    h.id = Xe.AUDIO;
    const p = n.audioCodec;
    (this.log(
      "Init audio buffer, container:"
        .concat(h.container, ", codecs[level/parsed]=[")
        .concat(p, "/")
        .concat(h.codec, "]"),
    ),
      p && p.split(",").length === 1 && (h.levelCodec = p),
      this.hls.trigger(F.BUFFER_CODECS, i));
    const d = h.initSegment;
    if (d != null && d.byteLength) {
      const y = { type: "audio", frag: o, part: null, chunkMeta: l, parent: o.type, data: d };
      this.hls.trigger(F.BUFFER_APPENDING, y);
    }
    this.tickImmediate();
  }
  loadFragment(n, i, o) {
    const l = this.fragmentTracker.getState(n);
    if (this.switchingTrack || l === ei.NOT_LOADED || l === ei.PARTIAL) {
      var h;
      if (!On(n)) this._loadInitSegment(n, i);
      else if ((h = i.details) != null && h.live && !this.initPTS[n.cc]) {
        (this.log(
          "Waiting for video PTS in continuity counter "
            .concat(n.cc, " of live stream before loading audio fragment ")
            .concat(n.sn, " of level ")
            .concat(this.trackId),
        ),
          (this.state = Te.WAITING_INIT_PTS));
        const p = this.mainDetails;
        p && p.fragmentStart !== i.details.fragmentStart && Vg(i.details, p);
      } else super.loadFragment(n, i, o);
    } else this.clearTrackerIfNeeded(n);
  }
  flushAudioIfNeeded(n) {
    if (this.media && this.bufferedTrack) {
      const {
        name: i,
        lang: o,
        assocLang: l,
        characteristics: h,
        audioCodec: p,
        channels: d,
      } = this.bufferedTrack;
      Ta({ name: i, lang: o, assocLang: l, characteristics: h, audioCodec: p, channels: d }, n, ya) ||
        (Ug(n.url, this.hls)
          ? (this.log("Switching audio track : flushing all audio"),
            super.flushMainBuffer(0, Number.POSITIVE_INFINITY, "audio"),
            (this.bufferedTrack = null))
          : (this.bufferedTrack = n));
    }
  }
  completeAudioSwitch(n) {
    const { hls: i } = this;
    (this.flushAudioIfNeeded(n),
      (this.bufferedTrack = n),
      (this.switchingTrack = null),
      i.trigger(F.AUDIO_TRACK_SWITCHED, Jt({}, n)));
  }
}
class wS extends Pr {
  constructor(n, i) {
    (super(i, n.logger), (this.hls = void 0), (this.canLoad = !1), (this.timer = -1), (this.hls = n));
  }
  destroy() {
    (this.clearTimer(), (this.hls = this.log = this.warn = null));
  }
  clearTimer() {
    this.timer !== -1 && (self.clearTimeout(this.timer), (this.timer = -1));
  }
  startLoad() {
    ((this.canLoad = !0), this.loadPlaylist());
  }
  stopLoad() {
    ((this.canLoad = !1), this.clearTimer());
  }
  switchParams(n, i, o) {
    const l = i == null ? void 0 : i.renditionReports;
    if (l) {
      let h = -1;
      for (let p = 0; p < l.length; p++) {
        const d = l[p];
        let y;
        try {
          y = new self.URL(d.URI, i.url).href;
        } catch (v) {
          (this.warn("Could not construct new URL for Rendition Report: ".concat(v)), (y = d.URI || ""));
        }
        if (y === n) {
          h = p;
          break;
        } else y === n.substring(0, y.length) && (h = p);
      }
      if (h !== -1) {
        const p = l[h],
          d = parseInt(p["LAST-MSN"]) || i.lastPartSn;
        let y = parseInt(p["LAST-PART"]) || i.lastPartIndex;
        if (this.hls.config.lowLatencyMode) {
          const T = Math.min(i.age - i.partTarget, i.targetduration);
          y >= 0 && T > i.partTarget && (y += 1);
        }
        const v = o && H_(o);
        return new K_(d, y >= 0 ? y : void 0, v);
      }
    }
  }
  loadPlaylist(n) {
    this.clearTimer();
  }
  loadingPlaylist(n, i) {
    this.clearTimer();
  }
  shouldLoadPlaylist(n) {
    return this.canLoad && !!n && !!n.url && (!n.details || n.details.live);
  }
  getUrlWithDirectives(n, i) {
    if (i)
      try {
        return i.addDirectives(n);
      } catch (o) {
        this.warn("Could not construct new URL with HLS Delivery Directives: ".concat(o));
      }
    return n;
  }
  playlistLoaded(n, i, o) {
    const { details: l, stats: h } = i,
      p = self.performance.now(),
      d = h.loading.first ? Math.max(0, p - h.loading.first) : 0;
    l.advancedDateTime = Date.now() - d;
    const y = this.hls.config.timelineOffset;
    if (y !== l.appliedTimelineOffset) {
      const T = Math.max(y || 0, 0);
      ((l.appliedTimelineOffset = T),
        l.fragments.forEach(S => {
          S.setStart(S.playlistOffset + T);
        }));
    }
    if (l.live || (o != null && o.live)) {
      const T = "levelInfo" in i ? i.levelInfo : i.track;
      if ((l.reloaded(o), o && l.fragments.length > 0)) {
        AK(o, l, this);
        const N = l.playlistParsingError;
        if (N) {
          this.warn(N);
          const $ = this.hls;
          if (!$.config.ignorePlaylistParsingErrors) {
            var v;
            const { networkDetails: I } = i;
            $.trigger(F.ERROR, {
              type: et.NETWORK_ERROR,
              details: ge.LEVEL_PARSING_ERROR,
              fatal: !1,
              url: l.url,
              error: N,
              reason: N.message,
              level: i.level || void 0,
              parent: (v = l.fragments[0]) == null ? void 0 : v.type,
              networkDetails: I,
              stats: h,
            });
            return;
          }
          l.playlistParsingError = null;
        }
      }
      l.requestScheduled === -1 && (l.requestScheduled = h.loading.start);
      const S = this.hls.mainForwardBufferInfo,
        w = S ? S.end - S.len : 0,
        C = (l.edge - w) * 1e3,
        L = Zk(l, C);
      if (
        (l.requestScheduled + L < p ? (l.requestScheduled = p) : (l.requestScheduled += L),
        this.log(
          "live playlist "
            .concat(n, " ")
            .concat(
              l.advanced
                ? "REFRESHED " + l.lastPartSn + "-" + l.lastPartIndex
                : l.updated
                  ? "UPDATED"
                  : "MISSED",
            ),
        ),
        !this.canLoad || !l.live)
      )
        return;
      let k, O, B;
      if (l.canBlockReload && l.endSN && l.advanced) {
        const N = this.hls.config.lowLatencyMode,
          $ = l.lastPartSn,
          I = l.endSN,
          V = l.lastPartIndex,
          oe = V !== -1,
          Y = $ === I;
        oe ? (Y ? ((O = I + 1), (B = N ? 0 : V)) : ((O = $), (B = N ? V + 1 : l.maxPartIndex))) : (O = I + 1);
        const te = l.age,
          _ = te + l.ageHeader;
        let K = Math.min(_ - l.partTarget, l.targetduration * 1.5);
        if (K > 0) {
          if (_ > l.targetduration * 3)
            (this.log(
              "Playlist last advanced ".concat(te.toFixed(2), "s ago. Omitting segment and part directives."),
            ),
              (O = void 0),
              (B = void 0));
          else if (o != null && o.tuneInGoal && _ - l.partTarget > o.tuneInGoal)
            (this.warn(
              "CDN Tune-in goal increased from: "
                .concat(o.tuneInGoal, " to: ")
                .concat(K, " with playlist age: ")
                .concat(l.age),
            ),
              (K = 0));
          else {
            const q = Math.floor(K / l.targetduration);
            if (((O += q), B !== void 0)) {
              const ce = Math.round((K % l.targetduration) / l.partTarget);
              B += ce;
            }
            this.log(
              "CDN Tune-in age: "
                .concat(l.ageHeader, "s last advanced ")
                .concat(te.toFixed(2), "s goal: ")
                .concat(K, " skip sn ")
                .concat(q, " to part ")
                .concat(B),
            );
          }
          l.tuneInGoal = K;
        }
        if (((k = this.getDeliveryDirectives(l, i.deliveryDirectives, O, B)), N || !Y)) {
          ((l.requestScheduled = p), this.loadingPlaylist(T, k));
          return;
        }
      } else
        (l.canBlockReload || l.canSkipUntil) &&
          (k = this.getDeliveryDirectives(l, i.deliveryDirectives, O, B));
      (k &&
        O !== void 0 &&
        l.canBlockReload &&
        (l.requestScheduled = h.loading.first + Math.max(L - d * 2, L / 2)),
        this.scheduleLoading(T, k, l));
    } else this.clearTimer();
  }
  scheduleLoading(n, i, o) {
    const l = o || n.details;
    if (!l) {
      this.loadingPlaylist(n, i);
      return;
    }
    const h = self.performance.now(),
      p = l.requestScheduled;
    if (h >= p) {
      this.loadingPlaylist(n, i);
      return;
    }
    const d = p - h;
    (this.log(
      "reload live playlist ".concat(n.name || n.bitrate + "bps", " in ").concat(Math.round(d), " ms"),
    ),
      this.clearTimer(),
      (this.timer = self.setTimeout(() => this.loadingPlaylist(n, i), d)));
  }
  getDeliveryDirectives(n, i, o, l) {
    let h = H_(n);
    return (
      i != null && i.skip && n.deltaUpdateFailed && ((o = i.msn), (l = i.part), (h = pg.No)),
      new K_(o, l, h)
    );
  }
  checkRetry(n) {
    const i = n.details,
      o = Bg(n),
      l = n.errorAction,
      { action: h, retryCount: p = 0, retryConfig: d } = l || {},
      y = !!l && !!d && (h === mi.RetryRequest || (!l.resolved && h === mi.SendAlternateToPenaltyBox));
    if (y) {
      var v;
      if (p >= d.maxNumRetry) return !1;
      if (o && (v = n.context) != null && v.deliveryDirectives)
        (this.warn(
          "Retrying playlist loading "
            .concat(p + 1, "/")
            .concat(d.maxNumRetry, ' after "')
            .concat(i, '" without delivery-directives'),
        ),
          this.loadPlaylist());
      else {
        const T = hS(d, p);
        (this.clearTimer(),
          (this.timer = self.setTimeout(() => this.loadPlaylist(), T)),
          this.warn(
            "Retrying playlist loading "
              .concat(p + 1, "/")
              .concat(d.maxNumRetry, ' after "')
              .concat(i, '" in ')
              .concat(T, "ms"),
          ));
      }
      ((n.levelRetry = !0), (l.resolved = !0));
    }
    return y;
  }
}
function wM(u, n) {
  if (u.length !== n.length) return !1;
  for (let i = 0; i < u.length; i++) if (!kd(u[i].attrs, n[i].attrs)) return !1;
  return !0;
}
function kd(u, n, i) {
  const o = u["STABLE-RENDITION-ID"];
  return o && !i
    ? o === n["STABLE-RENDITION-ID"]
    : !(
        i || ["LANGUAGE", "NAME", "CHARACTERISTICS", "AUTOSELECT", "DEFAULT", "FORCED", "ASSOC-LANGUAGE"]
      ).some(l => u[l] !== n[l]);
}
function OT(u, n) {
  return (
    n.label.toLowerCase() === u.name.toLowerCase() &&
    (!n.language || n.language.toLowerCase() === (u.lang || "").toLowerCase())
  );
}
class k9 extends wS {
  constructor(n) {
    (super(n, "audio-track-controller"),
      (this.tracks = []),
      (this.groupIds = null),
      (this.tracksInGroup = []),
      (this.trackId = -1),
      (this.currentTrack = null),
      (this.selectDefaultTrack = !0),
      this.registerListeners());
  }
  registerListeners() {
    const { hls: n } = this;
    (n.on(F.MANIFEST_LOADING, this.onManifestLoading, this),
      n.on(F.MANIFEST_PARSED, this.onManifestParsed, this),
      n.on(F.LEVEL_LOADING, this.onLevelLoading, this),
      n.on(F.LEVEL_SWITCHING, this.onLevelSwitching, this),
      n.on(F.AUDIO_TRACK_LOADED, this.onAudioTrackLoaded, this),
      n.on(F.ERROR, this.onError, this));
  }
  unregisterListeners() {
    const { hls: n } = this;
    (n.off(F.MANIFEST_LOADING, this.onManifestLoading, this),
      n.off(F.MANIFEST_PARSED, this.onManifestParsed, this),
      n.off(F.LEVEL_LOADING, this.onLevelLoading, this),
      n.off(F.LEVEL_SWITCHING, this.onLevelSwitching, this),
      n.off(F.AUDIO_TRACK_LOADED, this.onAudioTrackLoaded, this),
      n.off(F.ERROR, this.onError, this));
  }
  destroy() {
    (this.unregisterListeners(),
      (this.tracks.length = 0),
      (this.tracksInGroup.length = 0),
      (this.currentTrack = null),
      super.destroy());
  }
  onManifestLoading() {
    ((this.tracks = []),
      (this.tracksInGroup = []),
      (this.groupIds = null),
      (this.currentTrack = null),
      (this.trackId = -1),
      (this.selectDefaultTrack = !0));
  }
  onManifestParsed(n, i) {
    this.tracks = i.audioTracks || [];
  }
  onAudioTrackLoaded(n, i) {
    const { id: o, groupId: l, details: h } = i,
      p = this.tracksInGroup[o];
    if (!p || p.groupId !== l) {
      this.warn(
        "Audio track with id:"
          .concat(o, " and group:")
          .concat(l, " not found in active group ")
          .concat(p == null ? void 0 : p.groupId),
      );
      return;
    }
    const d = p.details;
    ((p.details = i.details),
      this.log(
        "Audio track "
          .concat(o, ' "')
          .concat(p.name, '" lang:')
          .concat(p.lang, " group:")
          .concat(l, " loaded [")
          .concat(h.startSN, "-")
          .concat(h.endSN, "]"),
      ),
      o === this.trackId && this.playlistLoaded(o, i, d));
  }
  onLevelLoading(n, i) {
    this.switchLevel(i.level);
  }
  onLevelSwitching(n, i) {
    this.switchLevel(i.level);
  }
  switchLevel(n) {
    const i = this.hls.levels[n];
    if (!i) return;
    const o = i.audioGroups || null,
      l = this.groupIds;
    let h = this.currentTrack;
    if (
      !o ||
      (l == null ? void 0 : l.length) !== (o == null ? void 0 : o.length) ||
      (o != null && o.some(d => (l == null ? void 0 : l.indexOf(d)) === -1))
    ) {
      ((this.groupIds = o), (this.trackId = -1), (this.currentTrack = null));
      const d = this.tracks.filter(w => !o || o.indexOf(w.groupId) !== -1);
      if (d.length)
        (this.selectDefaultTrack && !d.some(w => w.default) && (this.selectDefaultTrack = !1),
          d.forEach((w, C) => {
            w.id = C;
          }));
      else if (!h && !this.tracksInGroup.length) return;
      this.tracksInGroup = d;
      const y = this.hls.config.audioPreference;
      if (!h && y) {
        const w = ls(y, d, ya);
        if (w > -1) h = d[w];
        else {
          const C = ls(y, this.tracks);
          h = this.tracks[C];
        }
      }
      let v = this.findTrackId(h);
      v === -1 && h && (v = this.findTrackId(null));
      const T = { audioTracks: d };
      (this.log(
        "Updating audio tracks, "
          .concat(d.length, " track(s) found in group(s): ")
          .concat(o == null ? void 0 : o.join(",")),
      ),
        this.hls.trigger(F.AUDIO_TRACKS_UPDATED, T));
      const S = this.trackId;
      if (v !== -1 && S === -1) this.setAudioTrack(v);
      else if (d.length && S === -1) {
        var p;
        const w = new Error(
          "No audio track selected for current audio group-ID(s): "
            .concat((p = this.groupIds) == null ? void 0 : p.join(","), " track count: ")
            .concat(d.length),
        );
        (this.warn(w.message),
          this.hls.trigger(F.ERROR, {
            type: et.MEDIA_ERROR,
            details: ge.AUDIO_TRACK_LOAD_ERROR,
            fatal: !0,
            error: w,
          }));
      }
    }
  }
  onError(n, i) {
    i.fatal ||
      !i.context ||
      (i.context.type === Ot.AUDIO_TRACK &&
        i.context.id === this.trackId &&
        (!this.groupIds || this.groupIds.indexOf(i.context.groupId) !== -1) &&
        this.checkRetry(i));
  }
  get allAudioTracks() {
    return this.tracks;
  }
  get audioTracks() {
    return this.tracksInGroup;
  }
  get audioTrack() {
    return this.trackId;
  }
  set audioTrack(n) {
    ((this.selectDefaultTrack = !1), this.setAudioTrack(n));
  }
  setAudioOption(n) {
    const i = this.hls;
    if (((i.config.audioPreference = n), n)) {
      const o = this.allAudioTracks;
      if (((this.selectDefaultTrack = !1), o.length)) {
        const l = this.currentTrack;
        if (l && Ta(n, l, ya)) return l;
        const h = ls(n, this.tracksInGroup, ya);
        if (h > -1) {
          const p = this.tracksInGroup[h];
          return (this.setAudioTrack(h), p);
        } else if (l) {
          let p = i.loadLevel;
          p === -1 && (p = i.firstAutoLevel);
          const d = HH(n, i.levels, o, p, ya);
          if (d === -1) return null;
          i.nextLoadLevel = d;
        }
        if (n.channels || n.audioCodec) {
          const p = ls(n, o);
          if (p > -1) return o[p];
        }
      }
    }
    return null;
  }
  setAudioTrack(n) {
    const i = this.tracksInGroup;
    if (n < 0 || n >= i.length) {
      this.warn("Invalid audio track id: ".concat(n));
      return;
    }
    this.selectDefaultTrack = !1;
    const o = this.currentTrack,
      l = i[n],
      h = l.details && !l.details.live;
    if (
      (n === this.trackId && l === o && h) ||
      (this.log(
        "Switching to audio-track "
          .concat(n, ' "')
          .concat(l.name, '" lang:')
          .concat(l.lang, " group:")
          .concat(l.groupId, " channels:")
          .concat(l.channels),
      ),
      (this.trackId = n),
      (this.currentTrack = l),
      this.hls.trigger(F.AUDIO_TRACK_SWITCHING, Jt({}, l)),
      h)
    )
      return;
    const p = this.switchParams(l.url, o == null ? void 0 : o.details, l.details);
    this.loadPlaylist(p);
  }
  findTrackId(n) {
    const i = this.tracksInGroup;
    for (let o = 0; o < i.length; o++) {
      const l = i[o];
      if (!(this.selectDefaultTrack && !l.default) && (!n || Ta(n, l, ya))) return o;
    }
    if (n) {
      const { name: o, lang: l, assocLang: h, characteristics: p, audioCodec: d, channels: y } = n;
      for (let v = 0; v < i.length; v++) {
        const T = i[v];
        if (Ta({ name: o, lang: l, assocLang: h, characteristics: p, audioCodec: d, channels: y }, T, ya))
          return v;
      }
      for (let v = 0; v < i.length; v++) {
        const T = i[v];
        if (kd(n.attrs, T.attrs, ["LANGUAGE", "ASSOC-LANGUAGE", "CHARACTERISTICS"])) return v;
      }
      for (let v = 0; v < i.length; v++) {
        const T = i[v];
        if (kd(n.attrs, T.attrs, ["LANGUAGE"])) return v;
      }
    }
    return -1;
  }
  loadPlaylist(n) {
    super.loadPlaylist();
    const i = this.currentTrack;
    this.shouldLoadPlaylist(i) && Ug(i.url, this.hls) && this.scheduleLoading(i, n);
  }
  loadingPlaylist(n, i) {
    super.loadingPlaylist(n, i);
    const o = n.id,
      l = n.groupId,
      h = this.getUrlWithDirectives(n.url, i),
      p = n.details,
      d = p == null ? void 0 : p.age;
    (this.log(
      "Loading audio-track "
        .concat(o, ' "')
        .concat(n.name, '" lang:')
        .concat(n.lang, " group:")
        .concat(l)
        .concat((i == null ? void 0 : i.msn) !== void 0 ? " at sn " + i.msn + " part " + i.part : "")
        .concat(d && p.live ? " age " + d.toFixed(1) + ((p.type && " " + p.type) || "") : "", " ")
        .concat(h),
    ),
      this.hls.trigger(F.AUDIO_TRACK_LOADING, {
        url: h,
        id: o,
        groupId: l,
        deliveryDirectives: i || null,
        track: n,
      }));
  }
}
class M9 {
  constructor(n) {
    ((this.tracks = void 0), (this.queues = { video: [], audio: [], audiovideo: [] }), (this.tracks = n));
  }
  destroy() {
    this.tracks = this.queues = null;
  }
  append(n, i, o) {
    if (this.queues === null || this.tracks === null) return;
    const l = this.queues[i];
    (l.push(n), l.length === 1 && !o && this.executeNext(i));
  }
  appendBlocker(n) {
    return new Promise(i => {
      const o = {
        label: "async-blocker",
        execute: i,
        onStart: () => {},
        onComplete: () => {},
        onError: () => {},
      };
      this.append(o, n);
    });
  }
  prependBlocker(n) {
    return new Promise(i => {
      if (this.queues) {
        const o = {
          label: "async-blocker-prepend",
          execute: i,
          onStart: () => {},
          onComplete: () => {},
          onError: () => {},
        };
        this.queues[n].unshift(o);
      }
    });
  }
  removeBlockers() {
    this.queues !== null &&
      [this.queues.video, this.queues.audio, this.queues.audiovideo].forEach(n => {
        var i;
        const o = (i = n[0]) == null ? void 0 : i.label;
        (o === "async-blocker" || o === "async-blocker-prepend") && (n[0].execute(), n.splice(0, 1));
      });
  }
  unblockAudio(n) {
    if (this.queues === null) return;
    this.queues.audio[0] === n && this.shiftAndExecuteNext("audio");
  }
  executeNext(n) {
    if (this.queues === null || this.tracks === null) return;
    const i = this.queues[n];
    if (i.length) {
      const l = i[0];
      try {
        l.execute();
      } catch (h) {
        var o;
        if ((l.onError(h), this.queues === null || this.tracks === null)) return;
        const p = (o = this.tracks[n]) == null ? void 0 : o.buffer;
        (p != null && p.updating) || this.shiftAndExecuteNext(n);
      }
    }
  }
  shiftAndExecuteNext(n) {
    this.queues !== null && (this.queues[n].shift(), this.executeNext(n));
  }
  current(n) {
    var i;
    return ((i = this.queues) == null ? void 0 : i[n][0]) || null;
  }
  toString() {
    const { queues: n, tracks: i } = this;
    return n === null || i === null
      ? "<destroyed>"
      : "\n"
          .concat(this.list("video"), "\n")
          .concat(this.list("audio"), "\n")
          .concat(this.list("audiovideo"), "}");
  }
  list(n) {
    var i, o;
    return ((i = this.queues) != null && i[n]) || ((o = this.tracks) != null && o[n])
      ? "".concat(n, ": (").concat(this.listSbInfo(n), ") ").concat(this.listOps(n))
      : "";
  }
  listSbInfo(n) {
    var i;
    const o = (i = this.tracks) == null ? void 0 : i[n],
      l = o == null ? void 0 : o.buffer;
    return l
      ? "SourceBuffer"
          .concat(l.updating ? " updating" : "")
          .concat(o.ended ? " ended" : "")
          .concat(o.ending ? " ending" : "")
      : "none";
  }
  listOps(n) {
    var i;
    return ((i = this.queues) == null ? void 0 : i[n].map(o => o.label).join(", ")) || "";
  }
}
const bb = /(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,
  RM = "HlsJsTrackRemovedError";
class P9 extends Error {
  constructor(n) {
    (super(n), (this.name = RM));
  }
}
class O9 extends Pr {
  constructor(n, i) {
    (super("buffer-controller", n.logger),
      (this.hls = void 0),
      (this.fragmentTracker = void 0),
      (this.details = null),
      (this._objectUrl = null),
      (this.operationQueue = null),
      (this.bufferCodecEventsTotal = 0),
      (this.media = null),
      (this.mediaSource = null),
      (this.lastMpegAudioChunk = null),
      (this.blockedAudioAppend = null),
      (this.lastVideoAppendEnd = 0),
      (this.appendSource = void 0),
      (this.transferData = void 0),
      (this.overrides = void 0),
      (this.appendErrors = { audio: 0, video: 0, audiovideo: 0 }),
      (this.tracks = {}),
      (this.sourceBuffers = [
        [null, null],
        [null, null],
      ]),
      (this._onEndStreaming = o => {
        var l;
        this.hls &&
          ((l = this.mediaSource) == null ? void 0 : l.readyState) === "open" &&
          this.hls.pauseBuffering();
      }),
      (this._onStartStreaming = o => {
        this.hls && this.hls.resumeBuffering();
      }),
      (this._onMediaSourceOpen = o => {
        const { media: l, mediaSource: h } = this;
        (o && this.log("Media source opened"),
          !(!l || !h) &&
            (h.removeEventListener("sourceopen", this._onMediaSourceOpen),
            l.removeEventListener("emptied", this._onMediaEmptied),
            this.updateDuration(),
            this.hls.trigger(F.MEDIA_ATTACHED, { media: l, mediaSource: h }),
            this.mediaSource !== null && this.checkPendingTracks()));
      }),
      (this._onMediaSourceClose = () => {
        this.log("Media source closed");
      }),
      (this._onMediaSourceEnded = () => {
        this.log("Media source ended");
      }),
      (this._onMediaEmptied = () => {
        const { mediaSrc: o, _objectUrl: l } = this;
        o !== l &&
          this.error(
            "Media element src was set while attaching MediaSource (".concat(l, " > ").concat(o, ")"),
          );
      }),
      (this.hls = n),
      (this.fragmentTracker = i),
      (this.appendSource = iH(Oo(n.config.preferManagedMediaSource))),
      this.initTracks(),
      this.registerListeners());
  }
  hasSourceTypes() {
    return Object.keys(this.tracks).length > 0;
  }
  destroy() {
    (this.unregisterListeners(),
      (this.details = null),
      (this.lastMpegAudioChunk = this.blockedAudioAppend = null),
      (this.transferData = this.overrides = void 0),
      this.operationQueue && (this.operationQueue.destroy(), (this.operationQueue = null)),
      (this.hls = this.fragmentTracker = null),
      (this._onMediaSourceOpen = this._onMediaSourceClose = null),
      (this._onMediaSourceEnded = null),
      (this._onStartStreaming = this._onEndStreaming = null));
  }
  registerListeners() {
    const { hls: n } = this;
    (n.on(F.MEDIA_ATTACHING, this.onMediaAttaching, this),
      n.on(F.MEDIA_DETACHING, this.onMediaDetaching, this),
      n.on(F.MANIFEST_LOADING, this.onManifestLoading, this),
      n.on(F.MANIFEST_PARSED, this.onManifestParsed, this),
      n.on(F.BUFFER_RESET, this.onBufferReset, this),
      n.on(F.BUFFER_APPENDING, this.onBufferAppending, this),
      n.on(F.BUFFER_CODECS, this.onBufferCodecs, this),
      n.on(F.BUFFER_EOS, this.onBufferEos, this),
      n.on(F.BUFFER_FLUSHING, this.onBufferFlushing, this),
      n.on(F.LEVEL_UPDATED, this.onLevelUpdated, this),
      n.on(F.FRAG_PARSED, this.onFragParsed, this),
      n.on(F.FRAG_CHANGED, this.onFragChanged, this),
      n.on(F.ERROR, this.onError, this));
  }
  unregisterListeners() {
    const { hls: n } = this;
    (n.off(F.MEDIA_ATTACHING, this.onMediaAttaching, this),
      n.off(F.MEDIA_DETACHING, this.onMediaDetaching, this),
      n.off(F.MANIFEST_LOADING, this.onManifestLoading, this),
      n.off(F.MANIFEST_PARSED, this.onManifestParsed, this),
      n.off(F.BUFFER_RESET, this.onBufferReset, this),
      n.off(F.BUFFER_APPENDING, this.onBufferAppending, this),
      n.off(F.BUFFER_CODECS, this.onBufferCodecs, this),
      n.off(F.BUFFER_EOS, this.onBufferEos, this),
      n.off(F.BUFFER_FLUSHING, this.onBufferFlushing, this),
      n.off(F.LEVEL_UPDATED, this.onLevelUpdated, this),
      n.off(F.FRAG_PARSED, this.onFragParsed, this),
      n.off(F.FRAG_CHANGED, this.onFragChanged, this),
      n.off(F.ERROR, this.onError, this));
  }
  transferMedia() {
    const { media: n, mediaSource: i } = this;
    if (!n) return null;
    const o = {};
    if (this.operationQueue) {
      const h = this.isUpdating();
      h || this.operationQueue.removeBlockers();
      const p = this.isQueued();
      ((h || p) &&
        this.warn(
          "Transfering MediaSource with"
            .concat(p ? " operations in queue" : "")
            .concat(h ? " updating SourceBuffer(s)" : "", " ")
            .concat(this.operationQueue),
        ),
        this.operationQueue.destroy());
    }
    const l = this.transferData;
    return (
      !this.sourceBufferCount && l && l.mediaSource === i
        ? rn(o, l.tracks)
        : this.sourceBuffers.forEach(h => {
            const [p] = h;
            (p && ((o[p] = rn({}, this.tracks[p])), this.removeBuffer(p)), (h[0] = h[1] = null));
          }),
      { media: n, mediaSource: i, tracks: o }
    );
  }
  initTracks() {
    const n = {};
    ((this.sourceBuffers = [
      [null, null],
      [null, null],
    ]),
      (this.tracks = n),
      this.resetQueue(),
      this.resetAppendErrors(),
      (this.lastMpegAudioChunk = this.blockedAudioAppend = null),
      (this.lastVideoAppendEnd = 0));
  }
  onManifestLoading() {
    ((this.bufferCodecEventsTotal = 0), (this.details = null));
  }
  onManifestParsed(n, i) {
    var o;
    let l = 2;
    (((i.audio && !i.video) || !i.altAudio) && (l = 1),
      (this.bufferCodecEventsTotal = l),
      this.log("".concat(l, " bufferCodec event(s) expected.")),
      (o = this.transferData) != null &&
        o.mediaSource &&
        this.sourceBufferCount &&
        l &&
        this.bufferCreated());
  }
  onMediaAttaching(n, i) {
    const o = (this.media = i.media);
    this.transferData = this.overrides = void 0;
    const l = Oo(this.appendSource);
    if (l) {
      const h = !!i.mediaSource;
      (h || i.overrides) && ((this.transferData = i), (this.overrides = i.overrides));
      const p = (this.mediaSource = i.mediaSource || new l());
      if ((this.assignMediaSource(p), h)) ((this._objectUrl = o.src), this.attachTransferred());
      else {
        const d = (this._objectUrl = self.URL.createObjectURL(p));
        if (this.appendSource)
          try {
            o.removeAttribute("src");
            const y = self.ManagedMediaSource;
            ((o.disableRemotePlayback = o.disableRemotePlayback || (y && p instanceof y)),
              Db(o),
              N9(o, d),
              o.load());
          } catch (y) {
            o.src = d;
          }
        else o.src = d;
      }
      o.addEventListener("emptied", this._onMediaEmptied);
    }
  }
  assignMediaSource(n) {
    var i, o;
    (this.log(
      ""
        .concat(
          ((i = this.transferData) == null ? void 0 : i.mediaSource) === n ? "transferred" : "created",
          " media source: ",
        )
        .concat((o = n.constructor) == null ? void 0 : o.name),
    ),
      n.addEventListener("sourceopen", this._onMediaSourceOpen),
      n.addEventListener("sourceended", this._onMediaSourceEnded),
      n.addEventListener("sourceclose", this._onMediaSourceClose),
      this.appendSource &&
        (n.addEventListener("startstreaming", this._onStartStreaming),
        n.addEventListener("endstreaming", this._onEndStreaming)));
  }
  attachTransferred() {
    const n = this.media,
      i = this.transferData;
    if (!i || !n) return;
    const o = this.tracks,
      l = i.tracks,
      h = l ? Object.keys(l) : null,
      p = h ? h.length : 0,
      d = () => {
        Promise.resolve().then(() => {
          this.media && this.mediaSourceOpenOrEnded && this._onMediaSourceOpen();
        });
      };
    if (l && h && p) {
      if (!this.tracksReady) {
        ((this.hls.config.startFragPrefetch = !0),
          this.log("attachTransferred: waiting for SourceBuffer track info"));
        return;
      }
      if (
        (this.log(
          "attachTransferred: (bufferCodecEventsTotal "
            .concat(this.bufferCodecEventsTotal, ")\nrequired tracks: ")
            .concat(
              ln(o, (y, v) => (y === "initSegment" ? void 0 : v)),
              ";\ntransfer tracks: ",
            )
            .concat(
              ln(l, (y, v) => (y === "initSegment" ? void 0 : v)),
              "}",
            ),
        ),
        !Ek(l, o))
      ) {
        ((i.mediaSource = null), (i.tracks = void 0));
        const y = n.currentTime,
          v = this.details,
          T = Math.max(y, (v == null ? void 0 : v.fragments[0].start) || 0);
        if (T - y > 1) {
          this.log(
            "attachTransferred: waiting for playback to reach new tracks start time "
              .concat(y, " -> ")
              .concat(T),
          );
          return;
        }
        (this.warn(
          'attachTransferred: resetting MediaSource for incompatible tracks ("'
            .concat(Object.keys(l), '"->"')
            .concat(Object.keys(o), '") start time: ')
            .concat(T, " currentTime: ")
            .concat(y),
        ),
          this.onMediaDetaching(F.MEDIA_DETACHING, {}),
          this.onMediaAttaching(F.MEDIA_ATTACHING, i),
          (n.currentTime = T));
        return;
      }
      ((this.transferData = void 0),
        h.forEach(y => {
          const v = y,
            T = l[v];
          if (T) {
            const S = T.buffer;
            if (S) {
              const w = this.fragmentTracker,
                C = T.id;
              if (w.hasFragments(C) || w.hasParts(C)) {
                const O = Tt.getBuffered(S);
                w.detectEvictedFragments(v, O, C, null, !0);
              }
              const L = Ux(v),
                k = [v, S];
              ((this.sourceBuffers[L] = k),
                S.updating && this.operationQueue && this.operationQueue.prependBlocker(v),
                this.trackSourceBuffer(v, T));
            }
          }
        }),
        d(),
        this.bufferCreated());
    } else (this.log("attachTransferred: MediaSource w/o SourceBuffers"), d());
  }
  get mediaSourceOpenOrEnded() {
    var n;
    const i = (n = this.mediaSource) == null ? void 0 : n.readyState;
    return i === "open" || i === "ended";
  }
  onMediaDetaching(n, i) {
    const o = !!i.transferMedia;
    this.transferData = this.overrides = void 0;
    const { media: l, mediaSource: h, _objectUrl: p } = this;
    if (h) {
      if ((this.log("media source ".concat(o ? "transferring" : "detaching")), o))
        (this.sourceBuffers.forEach(([d]) => {
          d && this.removeBuffer(d);
        }),
          this.resetQueue());
      else {
        if (this.mediaSourceOpenOrEnded) {
          const d = h.readyState === "open";
          try {
            const y = h.sourceBuffers;
            for (let v = y.length; v--; ) (d && y[v].abort(), h.removeSourceBuffer(y[v]));
            d && h.endOfStream();
          } catch (y) {
            this.warn("onMediaDetaching: ".concat(y.message, " while calling endOfStream"));
          }
        }
        this.sourceBufferCount && this.onBufferReset();
      }
      (h.removeEventListener("sourceopen", this._onMediaSourceOpen),
        h.removeEventListener("sourceended", this._onMediaSourceEnded),
        h.removeEventListener("sourceclose", this._onMediaSourceClose),
        this.appendSource &&
          (h.removeEventListener("startstreaming", this._onStartStreaming),
          h.removeEventListener("endstreaming", this._onEndStreaming)),
        (this.mediaSource = null),
        (this._objectUrl = null));
    }
    (l &&
      (l.removeEventListener("emptied", this._onMediaEmptied),
      o ||
        (p && self.URL.revokeObjectURL(p),
        this.mediaSrc === p
          ? (l.removeAttribute("src"), this.appendSource && Db(l), l.load())
          : this.warn("media|source.src was changed by a third party - skip cleanup")),
      (this.media = null)),
      this.hls.trigger(F.MEDIA_DETACHED, i));
  }
  onBufferReset() {
    (this.sourceBuffers.forEach(([n]) => {
      n && this.resetBuffer(n);
    }),
      this.initTracks());
  }
  resetBuffer(n) {
    var i;
    const o = (i = this.tracks[n]) == null ? void 0 : i.buffer;
    if ((this.removeBuffer(n), o))
      try {
        var l;
        (l = this.mediaSource) != null && l.sourceBuffers.length && this.mediaSource.removeSourceBuffer(o);
      } catch (h) {
        this.warn("onBufferReset ".concat(n), h);
      }
    delete this.tracks[n];
  }
  removeBuffer(n) {
    (this.removeBufferListeners(n), (this.sourceBuffers[Ux(n)] = [null, null]));
    const i = this.tracks[n];
    i && (i.buffer = void 0);
  }
  resetQueue() {
    (this.operationQueue && this.operationQueue.destroy(), (this.operationQueue = new M9(this.tracks)));
  }
  onBufferCodecs(n, i) {
    var o;
    const l = this.tracks,
      h = Object.keys(i);
    this.log('BUFFER_CODECS: "'.concat(h, '" (current SB count ').concat(this.sourceBufferCount, ")"));
    const p = ("audiovideo" in i && (l.audio || l.video)) || (l.audiovideo && ("audio" in i || "video" in i)),
      d = !p && this.sourceBufferCount && this.media && h.some(y => !l[y]);
    if (p || d) {
      this.warn(
        'Unsupported transition between "'.concat(Object.keys(l), '" and "').concat(h, '" SourceBuffers'),
      );
      return;
    }
    (h.forEach(y => {
      var v, T;
      const S = i[y],
        { id: w, codec: C, levelCodec: L, container: k, metadata: O, supplemental: B } = S;
      let N = l[y];
      const $ = (v = this.transferData) == null || (v = v.tracks) == null ? void 0 : v[y],
        I = $ != null && $.buffer ? $ : N,
        V = (I == null ? void 0 : I.pendingCodec) || (I == null ? void 0 : I.codec),
        oe = I == null ? void 0 : I.levelCodec;
      N ||
        (N = l[y] =
          {
            buffer: void 0,
            listeners: [],
            codec: C,
            supplemental: B,
            container: k,
            levelCodec: L,
            metadata: O,
            id: w,
          });
      const Y = fg(V, oe),
        te = Y == null ? void 0 : Y.replace(bb, "$1");
      let _ = fg(C, L);
      const K = (T = _) == null ? void 0 : T.replace(bb, "$1");
      _ &&
        Y &&
        te !== K &&
        (y.slice(0, 5) === "audio" && (_ = Ng(_, this.appendSource)),
        this.log("switching codec ".concat(V, " to ").concat(_)),
        _ !== (N.pendingCodec || N.codec) && (N.pendingCodec = _),
        (N.container = k),
        this.appendChangeType(y, k, _));
    }),
      (this.tracksReady || this.sourceBufferCount) && (i.tracks = this.sourceBufferTracks),
      !this.sourceBufferCount &&
        (this.bufferCodecEventsTotal > 1 &&
          !this.tracks.video &&
          !i.video &&
          ((o = i.audio) == null ? void 0 : o.id) === "main" &&
          (this.log("Main audio-only"), (this.bufferCodecEventsTotal = 1)),
        this.mediaSourceOpenOrEnded && this.checkPendingTracks()));
  }
  get sourceBufferTracks() {
    return Object.keys(this.tracks).reduce((n, i) => {
      const o = this.tracks[i];
      return ((n[i] = { id: o.id, container: o.container, codec: o.codec, levelCodec: o.levelCodec }), n);
    }, {});
  }
  appendChangeType(n, i, o) {
    const l = "".concat(i, ";codecs=").concat(o),
      h = {
        label: "change-type=".concat(l),
        execute: () => {
          const p = this.tracks[n];
          if (p) {
            const d = p.buffer;
            d != null &&
              d.changeType &&
              (this.log("changing ".concat(n, " sourceBuffer type to ").concat(l)),
              d.changeType(l),
              (p.codec = o),
              (p.container = i));
          }
          this.shiftAndExecuteNext(n);
        },
        onStart: () => {},
        onComplete: () => {},
        onError: p => {
          this.warn("Failed to change ".concat(n, " SourceBuffer type"), p);
        },
      };
    this.append(h, n, this.isPending(this.tracks[n]));
  }
  blockAudio(n) {
    var i;
    const o = n.start,
      l = o + n.duration * 0.05;
    if (((i = this.fragmentTracker.getAppendedFrag(o, Xe.MAIN)) == null ? void 0 : i.gap) === !0) return;
    const p = {
      label: "block-audio",
      execute: () => {
        var d;
        const y = this.tracks.video;
        (this.lastVideoAppendEnd > l ||
          (y != null && y.buffer && Tt.isBuffered(y.buffer, l)) ||
          ((d = this.fragmentTracker.getAppendedFrag(l, Xe.MAIN)) == null ? void 0 : d.gap) === !0) &&
          ((this.blockedAudioAppend = null), this.shiftAndExecuteNext("audio"));
      },
      onStart: () => {},
      onComplete: () => {},
      onError: d => {
        this.warn("Error executing block-audio operation", d);
      },
    };
    ((this.blockedAudioAppend = { op: p, frag: n }), this.append(p, "audio", !0));
  }
  unblockAudio() {
    const { blockedAudioAppend: n, operationQueue: i } = this;
    n && i && ((this.blockedAudioAppend = null), i.unblockAudio(n.op));
  }
  onBufferAppending(n, i) {
    const { tracks: o } = this,
      { data: l, type: h, parent: p, frag: d, part: y, chunkMeta: v, offset: T } = i,
      S = v.buffering[h],
      { sn: w, cc: C } = d,
      L = self.performance.now();
    S.start = L;
    const k = d.stats.buffering,
      O = y ? y.stats.buffering : null;
    (k.start === 0 && (k.start = L), O && O.start === 0 && (O.start = L));
    const B = o.audio;
    let N = !1;
    h === "audio" &&
      (B == null ? void 0 : B.container) === "audio/mpeg" &&
      ((N = !this.lastMpegAudioChunk || v.id === 1 || this.lastMpegAudioChunk.sn !== v.sn),
      (this.lastMpegAudioChunk = v));
    const $ = o.video,
      I = $ == null ? void 0 : $.buffer;
    if (I && w !== "initSegment") {
      const Y = y || d,
        te = this.blockedAudioAppend;
      if (h === "audio" && p !== "main" && !this.blockedAudioAppend && !($.ending || $.ended)) {
        const K = Y.start + Y.duration * 0.05,
          q = I.buffered,
          ce = this.currentOp("video");
        !q.length && !ce
          ? this.blockAudio(Y)
          : !ce && !Tt.isBuffered(I, K) && this.lastVideoAppendEnd < K && this.blockAudio(Y);
      } else if (h === "video") {
        const _ = Y.end;
        if (te) {
          const K = te.frag.start;
          (_ > K || _ < this.lastVideoAppendEnd || Tt.isBuffered(I, K)) && this.unblockAudio();
        }
        this.lastVideoAppendEnd = _;
      }
    }
    const V = (y || d).start,
      oe = {
        label: "append-".concat(h),
        execute: () => {
          var Y;
          S.executeStart = self.performance.now();
          const te = (Y = this.tracks[h]) == null ? void 0 : Y.buffer;
          (te &&
            (N
              ? this.updateTimestampOffset(te, V, 0.1, h, w, C)
              : T !== void 0 && Ue(T) && this.updateTimestampOffset(te, T, 1e-6, h, w, C)),
            this.appendExecutor(l, h));
        },
        onStart: () => {},
        onComplete: () => {
          const Y = self.performance.now();
          ((S.executeEnd = S.end = Y), k.first === 0 && (k.first = Y), O && O.first === 0 && (O.first = Y));
          const te = {};
          (this.sourceBuffers.forEach(([_, K]) => {
            _ && (te[_] = Tt.getBuffered(K));
          }),
            (this.appendErrors[h] = 0),
            h === "audio" || h === "video"
              ? (this.appendErrors.audiovideo = 0)
              : ((this.appendErrors.audio = 0), (this.appendErrors.video = 0)),
            this.hls.trigger(F.BUFFER_APPENDED, {
              type: h,
              frag: d,
              part: y,
              chunkMeta: v,
              parent: d.type,
              timeRanges: te,
            }));
        },
        onError: Y => {
          var te;
          const _ = {
              type: et.MEDIA_ERROR,
              parent: d.type,
              details: ge.BUFFER_APPEND_ERROR,
              sourceBufferName: h,
              frag: d,
              part: y,
              chunkMeta: v,
              error: Y,
              err: Y,
              fatal: !1,
            },
            K = (te = this.media) == null ? void 0 : te.error;
          if (Y.code === DOMException.QUOTA_EXCEEDED_ERR || Y.name == "QuotaExceededError" || "quota" in Y)
            _.details = ge.BUFFER_FULL_ERROR;
          else if (Y.code === DOMException.INVALID_STATE_ERR && this.mediaSourceOpenOrEnded && !K)
            _.errorAction = su(!0);
          else if (Y.name === RM && this.sourceBufferCount === 0) _.errorAction = su(!0);
          else {
            const q = ++this.appendErrors[h];
            (this.warn(
              "Failed "
                .concat(q, "/")
                .concat(this.hls.config.appendErrorMaxRetry, ' times to append segment in "')
                .concat(h, '" sourceBuffer (')
                .concat(K || "no media error", ")"),
            ),
              (q >= this.hls.config.appendErrorMaxRetry || K) && (_.fatal = !0));
          }
          this.hls.trigger(F.ERROR, _);
        },
      };
    (this.log(
      'queuing "'
        .concat(h, '" append sn: ')
        .concat(w)
        .concat(y ? " p: " + y.index : "", " of ")
        .concat(d.type === Xe.MAIN ? "level" : "track", " ")
        .concat(d.level, " cc: ")
        .concat(C),
    ),
      this.append(oe, h, this.isPending(this.tracks[h])));
  }
  getFlushOp(n, i, o) {
    return (
      this.log('queuing "'.concat(n, '" remove ').concat(i, "-").concat(o)),
      {
        label: "remove",
        execute: () => {
          this.removeExecutor(n, i, o);
        },
        onStart: () => {},
        onComplete: () => {
          this.hls.trigger(F.BUFFER_FLUSHED, { type: n });
        },
        onError: l => {
          this.warn("Failed to remove ".concat(i, "-").concat(o, ' from "').concat(n, '" SourceBuffer'), l);
        },
      }
    );
  }
  onBufferFlushing(n, i) {
    const { type: o, startOffset: l, endOffset: h } = i;
    o
      ? this.append(this.getFlushOp(o, l, h), o)
      : this.sourceBuffers.forEach(([p]) => {
          p && this.append(this.getFlushOp(p, l, h), p);
        });
  }
  onFragParsed(n, i) {
    const { frag: o, part: l } = i,
      h = [],
      p = l ? l.elementaryStreams : o.elementaryStreams;
    p[an.AUDIOVIDEO]
      ? h.push("audiovideo")
      : (p[an.AUDIO] && h.push("audio"), p[an.VIDEO] && h.push("video"));
    const d = () => {
      const y = self.performance.now();
      ((o.stats.buffering.end = y), l && (l.stats.buffering.end = y));
      const v = l ? l.stats : o.stats;
      this.hls.trigger(F.FRAG_BUFFERED, { frag: o, part: l, stats: v, id: o.type });
    };
    (h.length === 0 &&
      this.warn(
        "Fragments must have at least one ElementaryStreamType set. type: "
          .concat(o.type, " level: ")
          .concat(o.level, " sn: ")
          .concat(o.sn),
      ),
      this.blockBuffers(d, h).catch(y => {
        (this.warn("Fragment buffered callback ".concat(y)), this.stepOperationQueue(this.sourceBufferTypes));
      }));
  }
  onFragChanged(n, i) {
    this.trimBuffers();
  }
  get bufferedToEnd() {
    return (
      this.sourceBufferCount > 0 &&
      !this.sourceBuffers.some(([n]) => {
        if (n) {
          const i = this.tracks[n];
          if (i) return !i.ended || i.ending;
        }
        return !1;
      })
    );
  }
  onBufferEos(n, i) {
    var o;
    this.sourceBuffers.forEach(([p]) => {
      if (p) {
        const d = this.tracks[p];
        (!i.type || i.type === p) &&
          ((d.ending = !0), d.ended || ((d.ended = !0), this.log("".concat(p, " buffer reached EOS"))));
      }
    });
    const l = ((o = this.overrides) == null ? void 0 : o.endOfStream) !== !1;
    this.sourceBufferCount > 0 &&
    !this.sourceBuffers.some(([p]) => {
      var d;
      return p && !((d = this.tracks[p]) != null && d.ended);
    })
      ? l
        ? (this.log("Queueing EOS"),
          this.blockUntilOpen(() => {
            this.tracksEnded();
            const { mediaSource: p } = this;
            if (!p || p.readyState !== "open") {
              p &&
                this.log(
                  "Could not call mediaSource.endOfStream(). mediaSource.readyState: ".concat(p.readyState),
                );
              return;
            }
            (this.log("Calling mediaSource.endOfStream()"),
              p.endOfStream(),
              this.hls.trigger(F.BUFFERED_TO_END, void 0));
          }))
        : (this.tracksEnded(), this.hls.trigger(F.BUFFERED_TO_END, void 0))
      : i.type === "video" && this.unblockAudio();
  }
  tracksEnded() {
    this.sourceBuffers.forEach(([n]) => {
      if (n !== null) {
        const i = this.tracks[n];
        i && (i.ending = !1);
      }
    });
  }
  onLevelUpdated(n, { details: i }) {
    i.fragments.length && ((this.details = i), this.updateDuration());
  }
  updateDuration() {
    this.blockUntilOpen(() => {
      const n = this.getDurationAndRange();
      n && this.updateMediaSource(n);
    });
  }
  onError(n, i) {
    if (i.details === ge.BUFFER_APPEND_ERROR && i.frag) {
      var o;
      const l = (o = i.errorAction) == null ? void 0 : o.nextAutoLevel;
      Ue(l) && l !== i.frag.level && this.resetAppendErrors();
    }
  }
  resetAppendErrors() {
    this.appendErrors = { audio: 0, video: 0, audiovideo: 0 };
  }
  trimBuffers() {
    const { hls: n, details: i, media: o } = this;
    if (!o || i === null || !this.sourceBufferCount) return;
    const l = n.config,
      h = o.currentTime,
      p = i.levelTargetDuration,
      d = i.live && l.liveBackBufferLength !== null ? l.liveBackBufferLength : l.backBufferLength;
    if (Ue(d) && d >= 0) {
      const v = Math.max(d, p),
        T = Math.floor(h / p) * p - v;
      this.flushBackBuffer(h, p, T);
    }
    const y = l.frontBufferFlushThreshold;
    if (Ue(y) && y > 0) {
      const v = Math.max(l.maxBufferLength, y),
        T = Math.max(v, p),
        S = Math.floor(h / p) * p + T;
      this.flushFrontBuffer(h, p, S);
    }
  }
  flushBackBuffer(n, i, o) {
    this.sourceBuffers.forEach(([l, h]) => {
      if (h) {
        const d = Tt.getBuffered(h);
        if (d.length > 0 && o > d.start(0)) {
          var p;
          this.hls.trigger(F.BACK_BUFFER_REACHED, { bufferEnd: o });
          const y = this.tracks[l];
          if ((p = this.details) != null && p.live)
            this.hls.trigger(F.LIVE_BACK_BUFFER_REACHED, { bufferEnd: o });
          else if (y != null && y.ended) {
            this.log("Cannot flush ".concat(l, " back buffer while SourceBuffer is in ended state"));
            return;
          }
          this.hls.trigger(F.BUFFER_FLUSHING, { startOffset: 0, endOffset: o, type: l });
        }
      }
    });
  }
  flushFrontBuffer(n, i, o) {
    this.sourceBuffers.forEach(([l, h]) => {
      if (h) {
        const p = Tt.getBuffered(h),
          d = p.length;
        if (d < 2) return;
        const y = p.start(d - 1),
          v = p.end(d - 1);
        if (o > y || (n >= y && n <= v)) return;
        this.hls.trigger(F.BUFFER_FLUSHING, { startOffset: y, endOffset: 1 / 0, type: l });
      }
    });
  }
  getDurationAndRange() {
    var n;
    const { details: i, mediaSource: o } = this;
    if (!i || !this.media || (o == null ? void 0 : o.readyState) !== "open") return null;
    const l = i.edge;
    if (i.live && this.hls.config.liveDurationInfinity) {
      if (i.fragments.length && o.setLiveSeekableRange) {
        const v = Math.max(0, i.fragmentStart),
          T = Math.max(v, l);
        return { duration: 1 / 0, start: v, end: T };
      }
      return { duration: 1 / 0 };
    }
    const h = (n = this.overrides) == null ? void 0 : n.duration;
    if (h) return Ue(h) ? { duration: h } : null;
    const p = this.media.duration,
      d = Ue(o.duration) ? o.duration : 0;
    return (l > d && l > p) || !Ue(p) ? { duration: l } : null;
  }
  updateMediaSource({ duration: n, start: i, end: o }) {
    const l = this.mediaSource;
    !this.media ||
      !l ||
      l.readyState !== "open" ||
      (l.duration !== n &&
        (Ue(n) && this.log("Updating MediaSource duration to ".concat(n.toFixed(3))), (l.duration = n)),
      i !== void 0 &&
        o !== void 0 &&
        (this.log(
          "MediaSource duration is set to "
            .concat(l.duration, ". Setting seekable range to ")
            .concat(i, "-")
            .concat(o, "."),
        ),
        l.setLiveSeekableRange(i, o)));
  }
  get tracksReady() {
    const n = this.pendingTrackCount;
    return n > 0 && (n >= this.bufferCodecEventsTotal || this.isPending(this.tracks.audiovideo));
  }
  checkPendingTracks() {
    const { bufferCodecEventsTotal: n, pendingTrackCount: i, tracks: o } = this;
    if (
      (this.log(
        "checkPendingTracks (pending: ".concat(i, " codec events expected: ").concat(n, ") ").concat(ln(o)),
      ),
      this.tracksReady)
    ) {
      var l;
      const h = (l = this.transferData) == null ? void 0 : l.tracks;
      h && Object.keys(h).length ? this.attachTransferred() : this.createSourceBuffers();
    }
  }
  bufferCreated() {
    if (this.sourceBufferCount) {
      const n = {};
      (this.sourceBuffers.forEach(([i, o]) => {
        if (i) {
          const l = this.tracks[i];
          n[i] = {
            buffer: o,
            container: l.container,
            codec: l.codec,
            supplemental: l.supplemental,
            levelCodec: l.levelCodec,
            id: l.id,
            metadata: l.metadata,
          };
        }
      }),
        this.hls.trigger(F.BUFFER_CREATED, { tracks: n }),
        this.log("SourceBuffers created. Running queue: ".concat(this.operationQueue)),
        this.sourceBuffers.forEach(([i]) => {
          this.executeNext(i);
        }));
    } else {
      const n = new Error("could not create source buffer for media codec(s)");
      this.hls.trigger(F.ERROR, {
        type: et.MEDIA_ERROR,
        details: ge.BUFFER_INCOMPATIBLE_CODECS_ERROR,
        fatal: !0,
        error: n,
        reason: n.message,
      });
    }
  }
  createSourceBuffers() {
    const { tracks: n, sourceBuffers: i, mediaSource: o } = this;
    if (!o) throw new Error("createSourceBuffers called when mediaSource was null");
    for (const h in n) {
      const p = h,
        d = n[p];
      if (this.isPending(d)) {
        const y = this.getTrackCodec(d, p),
          v = "".concat(d.container, ";codecs=").concat(y);
        ((d.codec = y),
          this.log(
            "creating sourceBuffer("
              .concat(v, ")")
              .concat(this.currentOp(p) ? " Queued" : "", " ")
              .concat(ln(d)),
          ));
        try {
          const T = o.addSourceBuffer(v),
            S = Ux(p),
            w = [p, T];
          ((i[S] = w), (d.buffer = T));
        } catch (T) {
          var l;
          (this.error("error while trying to add sourceBuffer: ".concat(T.message)),
            this.shiftAndExecuteNext(p),
            (l = this.operationQueue) == null || l.removeBlockers(),
            delete this.tracks[p],
            this.hls.trigger(F.ERROR, {
              type: et.MEDIA_ERROR,
              details: ge.BUFFER_ADD_CODEC_ERROR,
              fatal: !1,
              error: T,
              sourceBufferName: p,
              mimeType: v,
              parent: d.id,
            }));
          return;
        }
        this.trackSourceBuffer(p, d);
      }
    }
    this.bufferCreated();
  }
  getTrackCodec(n, i) {
    const o = n.supplemental;
    let l = n.codec;
    o && (i === "video" || i === "audiovideo") && Rd(o, "video") && (l = wH(l, o));
    const h = fg(l, n.levelCodec);
    return h ? (i.slice(0, 5) === "audio" ? Ng(h, this.appendSource) : h) : "";
  }
  trackSourceBuffer(n, i) {
    const o = i.buffer;
    if (!o) return;
    const l = this.getTrackCodec(i, n);
    ((this.tracks[n] = {
      buffer: o,
      codec: l,
      container: i.container,
      levelCodec: i.levelCodec,
      supplemental: i.supplemental,
      metadata: i.metadata,
      id: i.id,
      listeners: [],
    }),
      this.removeBufferListeners(n),
      this.addBufferListener(n, "updatestart", this.onSBUpdateStart),
      this.addBufferListener(n, "updateend", this.onSBUpdateEnd),
      this.addBufferListener(n, "error", this.onSBUpdateError),
      this.appendSource &&
        this.addBufferListener(n, "bufferedchange", (h, p) => {
          const d = p.removedRanges;
          d != null && d.length && this.hls.trigger(F.BUFFER_FLUSHED, { type: h });
        }));
  }
  get mediaSrc() {
    var n, i;
    const o =
      ((n = this.media) == null || (i = n.querySelector) == null ? void 0 : i.call(n, "source")) ||
      this.media;
    return o == null ? void 0 : o.src;
  }
  onSBUpdateStart(n) {
    const i = this.currentOp(n);
    i && i.onStart();
  }
  onSBUpdateEnd(n) {
    var i;
    if (((i = this.mediaSource) == null ? void 0 : i.readyState) === "closed") {
      this.resetBuffer(n);
      return;
    }
    const o = this.currentOp(n);
    o && (o.onComplete(), this.shiftAndExecuteNext(n));
  }
  onSBUpdateError(n, i) {
    var o;
    const l = new Error(
      ""
        .concat(n, " SourceBuffer error. MediaSource readyState: ")
        .concat((o = this.mediaSource) == null ? void 0 : o.readyState),
    );
    (this.error("".concat(l), i),
      this.hls.trigger(F.ERROR, {
        type: et.MEDIA_ERROR,
        details: ge.BUFFER_APPENDING_ERROR,
        sourceBufferName: n,
        error: l,
        fatal: !1,
      }));
    const h = this.currentOp(n);
    h && h.onError(l);
  }
  updateTimestampOffset(n, i, o, l, h, p) {
    const d = i - n.timestampOffset;
    Math.abs(d) >= o &&
      (this.log(
        "Updating "
          .concat(l, " SourceBuffer timestampOffset to ")
          .concat(i, " (sn: ")
          .concat(h, " cc: ")
          .concat(p, ")"),
      ),
      (n.timestampOffset = i));
  }
  removeExecutor(n, i, o) {
    const { media: l, mediaSource: h } = this,
      p = this.tracks[n],
      d = p == null ? void 0 : p.buffer;
    if (!l || !h || !d) {
      (this.warn("Attempting to remove from the ".concat(n, " SourceBuffer, but it does not exist")),
        this.shiftAndExecuteNext(n));
      return;
    }
    const y = Ue(l.duration) ? l.duration : 1 / 0,
      v = Ue(h.duration) ? h.duration : 1 / 0,
      T = Math.max(0, i),
      S = Math.min(o, y, v);
    S > T && (!p.ending || p.ended)
      ? ((p.ended = !1),
        this.log("Removing [".concat(T, ",").concat(S, "] from the ").concat(n, " SourceBuffer")),
        d.remove(T, S))
      : this.shiftAndExecuteNext(n);
  }
  appendExecutor(n, i) {
    const o = this.tracks[i],
      l = o == null ? void 0 : o.buffer;
    if (!l) throw new P9("Attempting to append to the ".concat(i, " SourceBuffer, but it does not exist"));
    ((o.ending = !1), (o.ended = !1), l.appendBuffer(n));
  }
  blockUntilOpen(n) {
    if (this.isUpdating() || this.isQueued())
      this.blockBuffers(n).catch(i => {
        (this.warn("SourceBuffer blocked callback ".concat(i)),
          this.stepOperationQueue(this.sourceBufferTypes));
      });
    else
      try {
        n();
      } catch (i) {
        this.warn("Callback run without blocking ".concat(this.operationQueue, " ").concat(i));
      }
  }
  isUpdating() {
    return this.sourceBuffers.some(([n, i]) => n && i.updating);
  }
  isQueued() {
    return this.sourceBuffers.some(([n]) => n && !!this.currentOp(n));
  }
  isPending(n) {
    return !!n && !n.buffer;
  }
  blockBuffers(n, i = this.sourceBufferTypes) {
    if (!i.length)
      return (
        this.log("Blocking operation requested, but no SourceBuffers exist"),
        Promise.resolve().then(n)
      );
    const { operationQueue: o } = this,
      l = i.map(p => this.appendBlocker(p));
    return (
      i.length > 1 && !!this.blockedAudioAppend && this.unblockAudio(),
      Promise.all(l).then(p => {
        o === this.operationQueue && (n(), this.stepOperationQueue(this.sourceBufferTypes));
      })
    );
  }
  stepOperationQueue(n) {
    n.forEach(i => {
      var o;
      const l = (o = this.tracks[i]) == null ? void 0 : o.buffer;
      !l || l.updating || this.shiftAndExecuteNext(i);
    });
  }
  append(n, i, o) {
    this.operationQueue && this.operationQueue.append(n, i, o);
  }
  appendBlocker(n) {
    if (this.operationQueue) return this.operationQueue.appendBlocker(n);
  }
  currentOp(n) {
    return this.operationQueue ? this.operationQueue.current(n) : null;
  }
  executeNext(n) {
    n && this.operationQueue && this.operationQueue.executeNext(n);
  }
  shiftAndExecuteNext(n) {
    this.operationQueue && this.operationQueue.shiftAndExecuteNext(n);
  }
  get pendingTrackCount() {
    return Object.keys(this.tracks).reduce((n, i) => n + (this.isPending(this.tracks[i]) ? 1 : 0), 0);
  }
  get sourceBufferCount() {
    return this.sourceBuffers.reduce((n, [i]) => n + (i ? 1 : 0), 0);
  }
  get sourceBufferTypes() {
    return this.sourceBuffers.map(([n]) => n).filter(n => !!n);
  }
  addBufferListener(n, i, o) {
    const l = this.tracks[n];
    if (!l) return;
    const h = l.buffer;
    if (!h) return;
    const p = o.bind(this, n);
    (l.listeners.push({ event: i, listener: p }), h.addEventListener(i, p));
  }
  removeBufferListeners(n) {
    const i = this.tracks[n];
    if (!i) return;
    const o = i.buffer;
    o &&
      (i.listeners.forEach(l => {
        o.removeEventListener(l.event, l.listener);
      }),
      (i.listeners.length = 0));
  }
}
function Db(u) {
  const n = u.querySelectorAll("source");
  [].slice.call(n).forEach(i => {
    u.removeChild(i);
  });
}
function N9(u, n) {
  const i = self.document.createElement("source");
  ((i.type = "video/mp4"), (i.src = n), u.appendChild(i));
}
function Ux(u) {
  return u === "audio" ? 1 : 0;
}
class RS {
  constructor(n) {
    ((this.hls = void 0),
      (this.autoLevelCapping = void 0),
      (this.firstLevel = void 0),
      (this.media = void 0),
      (this.restrictedLevels = void 0),
      (this.timer = void 0),
      (this.clientRect = void 0),
      (this.streamController = void 0),
      (this.hls = n),
      (this.autoLevelCapping = Number.POSITIVE_INFINITY),
      (this.firstLevel = -1),
      (this.media = null),
      (this.restrictedLevels = []),
      (this.timer = void 0),
      (this.clientRect = null),
      this.registerListeners());
  }
  setStreamController(n) {
    this.streamController = n;
  }
  destroy() {
    (this.hls && this.unregisterListener(),
      this.timer && this.stopCapping(),
      (this.media = null),
      (this.clientRect = null),
      (this.hls = this.streamController = null));
  }
  registerListeners() {
    const { hls: n } = this;
    (n.on(F.FPS_DROP_LEVEL_CAPPING, this.onFpsDropLevelCapping, this),
      n.on(F.MEDIA_ATTACHING, this.onMediaAttaching, this),
      n.on(F.MANIFEST_PARSED, this.onManifestParsed, this),
      n.on(F.LEVELS_UPDATED, this.onLevelsUpdated, this),
      n.on(F.BUFFER_CODECS, this.onBufferCodecs, this),
      n.on(F.MEDIA_DETACHING, this.onMediaDetaching, this));
  }
  unregisterListener() {
    const { hls: n } = this;
    (n.off(F.FPS_DROP_LEVEL_CAPPING, this.onFpsDropLevelCapping, this),
      n.off(F.MEDIA_ATTACHING, this.onMediaAttaching, this),
      n.off(F.MANIFEST_PARSED, this.onManifestParsed, this),
      n.off(F.LEVELS_UPDATED, this.onLevelsUpdated, this),
      n.off(F.BUFFER_CODECS, this.onBufferCodecs, this),
      n.off(F.MEDIA_DETACHING, this.onMediaDetaching, this));
  }
  onFpsDropLevelCapping(n, i) {
    const o = this.hls.levels[i.droppedLevel];
    this.isLevelAllowed(o) &&
      this.restrictedLevels.push({ bitrate: o.bitrate, height: o.height, width: o.width });
  }
  onMediaAttaching(n, i) {
    ((this.media = i.media instanceof HTMLVideoElement ? i.media : null),
      (this.clientRect = null),
      this.timer && this.hls.levels.length && this.detectPlayerSize());
  }
  onManifestParsed(n, i) {
    const o = this.hls;
    ((this.restrictedLevels = []),
      (this.firstLevel = i.firstLevel),
      o.config.capLevelToPlayerSize && i.video && this.startCapping());
  }
  onLevelsUpdated(n, i) {
    this.timer && Ue(this.autoLevelCapping) && this.detectPlayerSize();
  }
  onBufferCodecs(n, i) {
    this.hls.config.capLevelToPlayerSize && i.video && this.startCapping();
  }
  onMediaDetaching() {
    (this.stopCapping(), (this.media = null));
  }
  detectPlayerSize() {
    if (this.media) {
      if (this.mediaHeight <= 0 || this.mediaWidth <= 0) {
        this.clientRect = null;
        return;
      }
      const n = this.hls.levels;
      if (n.length) {
        const i = this.hls,
          o = this.getMaxLevel(n.length - 1);
        (o !== this.autoLevelCapping &&
          i.logger.log(
            "Setting autoLevelCapping to "
              .concat(o, ": ")
              .concat(n[o].height, "p@")
              .concat(n[o].bitrate, " for media ")
              .concat(this.mediaWidth, "x")
              .concat(this.mediaHeight),
          ),
          (i.autoLevelCapping = o),
          i.autoLevelEnabled &&
            i.autoLevelCapping > this.autoLevelCapping &&
            this.streamController &&
            this.streamController.nextLevelSwitch(),
          (this.autoLevelCapping = i.autoLevelCapping));
      }
    }
  }
  getMaxLevel(n) {
    const i = this.hls.levels;
    if (!i.length) return -1;
    const o = i.filter((l, h) => this.isLevelAllowed(l) && h <= n);
    return ((this.clientRect = null), RS.getMaxLevelByMediaSize(o, this.mediaWidth, this.mediaHeight));
  }
  startCapping() {
    this.timer ||
      ((this.autoLevelCapping = Number.POSITIVE_INFINITY),
      self.clearInterval(this.timer),
      (this.timer = self.setInterval(this.detectPlayerSize.bind(this), 1e3)),
      this.detectPlayerSize());
  }
  stopCapping() {
    ((this.restrictedLevels = []),
      (this.firstLevel = -1),
      (this.autoLevelCapping = Number.POSITIVE_INFINITY),
      this.timer && (self.clearInterval(this.timer), (this.timer = void 0)));
  }
  getDimensions() {
    if (this.clientRect) return this.clientRect;
    const n = this.media,
      i = { width: 0, height: 0 };
    if (n) {
      const o = n.getBoundingClientRect();
      ((i.width = o.width),
        (i.height = o.height),
        !i.width &&
          !i.height &&
          ((i.width = o.right - o.left || n.width || 0), (i.height = o.bottom - o.top || n.height || 0)));
    }
    return ((this.clientRect = i), i);
  }
  get mediaWidth() {
    return this.getDimensions().width * this.contentScaleFactor;
  }
  get mediaHeight() {
    return this.getDimensions().height * this.contentScaleFactor;
  }
  get contentScaleFactor() {
    let n = 1;
    if (!this.hls.config.ignoreDevicePixelRatio)
      try {
        n = self.devicePixelRatio;
      } catch (i) {}
    return Math.min(n, this.hls.config.maxDevicePixelRatio);
  }
  isLevelAllowed(n) {
    return !this.restrictedLevels.some(
      o => n.bitrate === o.bitrate && n.width === o.width && n.height === o.height,
    );
  }
  static getMaxLevelByMediaSize(n, i, o) {
    if (!(n != null && n.length)) return -1;
    const l = (d, y) => (y ? d.width !== y.width || d.height !== y.height : !0);
    let h = n.length - 1;
    const p = Math.max(i, o);
    for (let d = 0; d < n.length; d += 1) {
      const y = n[d];
      if ((y.width >= p || y.height >= p) && l(y, n[d + 1])) {
        h = d;
        break;
      }
    }
    return h;
  }
}
const F9 = {
    MANIFEST: "m",
    AUDIO: "a",
    VIDEO: "v",
    MUXED: "av",
    INIT: "i",
    CAPTION: "c",
    TIMED_TEXT: "tt",
    KEY: "k",
    OTHER: "o",
  },
  er = F9,
  U9 = { HLS: "h" },
  B9 = U9;
class ds {
  constructor(n, i) {
    (Array.isArray(n) && (n = n.map(o => (o instanceof ds ? o : new ds(o)))),
      (this.value = n),
      (this.params = i));
  }
}
const $9 = "Dict";
function G9(u) {
  return Array.isArray(u)
    ? JSON.stringify(u)
    : u instanceof Map
      ? "Map{}"
      : u instanceof Set
        ? "Set{}"
        : typeof u == "object"
          ? JSON.stringify(u)
          : String(u);
}
function j9(u, n, i, o) {
  return new Error("failed to ".concat(u, ' "').concat(G9(n), '" as ').concat(i), { cause: o });
}
function hs(u, n, i) {
  return j9("serialize", u, n, i);
}
class CM {
  constructor(n) {
    this.description = n;
  }
}
const kb = "Bare Item",
  V9 = "Boolean";
function H9(u) {
  if (typeof u != "boolean") throw hs(u, V9);
  return u ? "?1" : "?0";
}
function K9(u) {
  return btoa(String.fromCharCode(...u));
}
const W9 = "Byte Sequence";
function z9(u) {
  if (ArrayBuffer.isView(u) === !1) throw hs(u, W9);
  return ":".concat(K9(u), ":");
}
const Y9 = "Integer";
function X9(u) {
  return u < -999999999999999 || 999999999999999 < u;
}
function LM(u) {
  if (X9(u)) throw hs(u, Y9);
  return u.toString();
}
function q9(u) {
  return "@".concat(LM(u.getTime() / 1e3));
}
function _M(u, n) {
  if (u < 0) return -_M(-u, n);
  const i = Math.pow(10, n);
  if (Math.abs(((u * i) % 1) - 0.5) < Number.EPSILON) {
    const l = Math.floor(u * i);
    return (l % 2 === 0 ? l : l + 1) / i;
  } else return Math.round(u * i) / i;
}
const Q9 = "Decimal";
function J9(u) {
  const n = _M(u, 3);
  if (Math.floor(Math.abs(n)).toString().length > 12) throw hs(u, Q9);
  const i = n.toString();
  return i.includes(".") ? i : "".concat(i, ".0");
}
const Z9 = "String",
  eW = /[\x00-\x1f\x7f]+/;
function tW(u) {
  if (eW.test(u)) throw hs(u, Z9);
  return '"'.concat(u.replace(/\\/g, "\\\\").replace(/"/g, '\\"'), '"');
}
function nW(u) {
  return u.description || u.toString().slice(7, -1);
}
const iW = "Token";
function Mb(u) {
  const n = nW(u);
  if (/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(n) === !1) throw hs(n, iW);
  return n;
}
function NT(u) {
  switch (typeof u) {
    case "number":
      if (!Ue(u)) throw hs(u, kb);
      return Number.isInteger(u) ? LM(u) : J9(u);
    case "string":
      return tW(u);
    case "symbol":
      return Mb(u);
    case "boolean":
      return H9(u);
    case "object":
      if (u instanceof Date) return q9(u);
      if (u instanceof Uint8Array) return z9(u);
      if (u instanceof CM) return Mb(u);
    default:
      throw hs(u, kb);
  }
}
const rW = "Key";
function FT(u) {
  if (/^[a-z*][a-z0-9\-_.*]*$/.test(u) === !1) throw hs(u, rW);
  return u;
}
function CS(u) {
  return u == null
    ? ""
    : Object.entries(u)
        .map(([n, i]) => (i === !0 ? ";".concat(FT(n)) : ";".concat(FT(n), "=").concat(NT(i))))
        .join("");
}
function bM(u) {
  return u instanceof ds ? "".concat(NT(u.value)).concat(CS(u.params)) : NT(u);
}
function sW(u) {
  return "(".concat(u.value.map(bM).join(" "), ")").concat(CS(u.params));
}
function oW(u, n = { whitespace: !0 }) {
  if (typeof u != "object" || u == null) throw hs(u, $9);
  const i = u instanceof Map ? u.entries() : Object.entries(u),
    o = n != null && n.whitespace ? " " : "";
  return Array.from(i)
    .map(([l, h]) => {
      h instanceof ds || (h = new ds(h));
      let p = FT(l);
      return (
        h.value === !0
          ? (p += CS(h.params))
          : ((p += "="), Array.isArray(h.value) ? (p += sW(h)) : (p += bM(h))),
        p
      );
    })
    .join(",".concat(o));
}
function DM(u, n) {
  return oW(u, n);
}
const rs = "CMCD-Object",
  Dn = "CMCD-Request",
  pa = "CMCD-Session",
  Ro = "CMCD-Status",
  aW = {
    br: rs,
    ab: rs,
    d: rs,
    ot: rs,
    tb: rs,
    tpb: rs,
    lb: rs,
    tab: rs,
    lab: rs,
    url: rs,
    pb: Dn,
    bl: Dn,
    tbl: Dn,
    dl: Dn,
    ltc: Dn,
    mtp: Dn,
    nor: Dn,
    nrr: Dn,
    rc: Dn,
    sn: Dn,
    sta: Dn,
    su: Dn,
    ttfb: Dn,
    ttfbb: Dn,
    ttlb: Dn,
    cmsdd: Dn,
    cmsds: Dn,
    smrt: Dn,
    df: Dn,
    cs: Dn,
    ts: Dn,
    cid: pa,
    pr: pa,
    sf: pa,
    sid: pa,
    st: pa,
    v: pa,
    msd: pa,
    bs: Ro,
    bsd: Ro,
    cdn: Ro,
    rtp: Ro,
    bg: Ro,
    pt: Ro,
    ec: Ro,
    e: Ro,
  },
  lW = { REQUEST: Dn };
function uW(u) {
  return Object.keys(u).reduce((n, i) => {
    var o;
    return ((o = u[i]) === null || o === void 0 || o.forEach(l => (n[l] = i)), n);
  }, {});
}
function cW(u, n) {
  const i = {};
  if (!u) return i;
  const o = Object.keys(u),
    l = n ? uW(n) : {};
  return o.reduce((h, p) => {
    var d;
    const y = aW[p] || l[p] || lW.REQUEST,
      v = (d = h[y]) !== null && d !== void 0 ? d : (h[y] = {});
    return ((v[p] = u[p]), h);
  }, i);
}
function dW(u) {
  return ["ot", "sf", "st", "e", "sta"].includes(u);
}
function hW(u) {
  return typeof u == "number" ? Ue(u) : u != null && u !== "" && u !== !1;
}
const kM = "event";
function fW(u, n) {
  const i = new URL(u),
    o = new URL(n);
  if (i.origin !== o.origin) return u;
  const l = i.pathname.split("/").slice(1),
    h = o.pathname.split("/").slice(1, -1);
  for (; l[0] === h[0]; ) (l.shift(), h.shift());
  for (; h.length; ) (h.shift(), l.unshift(".."));
  return l.join("/") + i.search + i.hash;
}
const vg = u => Math.round(u),
  UT = (u, n) =>
    Array.isArray(u)
      ? u.map(i => UT(i, n))
      : u instanceof ds && typeof u.value == "string"
        ? new ds(UT(u.value, n), u.params)
        : (n.baseUrl && (u = fW(u, n.baseUrl)), n.version === 1 ? encodeURIComponent(u) : u),
  Xp = u => vg(u / 100) * 100,
  pW = (u, n) => {
    let i = u;
    return (
      n.version >= 2 &&
        (u instanceof ds && typeof u.value == "string"
          ? (i = new ds([u]))
          : typeof u == "string" && (i = [u])),
      UT(i, n)
    );
  },
  gW = { br: vg, d: vg, bl: Xp, dl: Xp, mtp: Xp, nor: pW, rtp: Xp, tb: vg },
  MM = "request",
  PM = "response",
  LS = [
    "ab",
    "bg",
    "bl",
    "br",
    "bs",
    "bsd",
    "cdn",
    "cid",
    "cs",
    "df",
    "ec",
    "lab",
    "lb",
    "ltc",
    "msd",
    "mtp",
    "pb",
    "pr",
    "pt",
    "sf",
    "sid",
    "sn",
    "st",
    "sta",
    "tab",
    "tb",
    "tbl",
    "tpb",
    "ts",
    "v",
  ],
  mW = ["e"],
  yW = /^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;
function om(u) {
  return yW.test(u);
}
function vW(u) {
  return LS.includes(u) || mW.includes(u) || om(u);
}
const OM = ["d", "dl", "nor", "ot", "rtp", "su"];
function xW(u) {
  return LS.includes(u) || OM.includes(u) || om(u);
}
const TW = ["cmsdd", "cmsds", "rc", "smrt", "ttfb", "ttfbb", "ttlb", "url"];
function SW(u) {
  return LS.includes(u) || OM.includes(u) || TW.includes(u) || om(u);
}
const EW = [
  "bl",
  "br",
  "bs",
  "cid",
  "d",
  "dl",
  "mtp",
  "nor",
  "nrr",
  "ot",
  "pr",
  "rtp",
  "sf",
  "sid",
  "st",
  "su",
  "tb",
  "v",
];
function AW(u) {
  return EW.includes(u) || om(u);
}
const IW = { [PM]: SW, [kM]: vW, [MM]: xW };
function NM(u, n = {}) {
  const i = {};
  if (u == null || typeof u != "object") return i;
  const o = n.version || u.v || 1,
    l = n.reportingMode || MM,
    h = o === 1 ? AW : IW[l];
  let p = Object.keys(u).filter(h);
  const d = n.filter;
  typeof d == "function" && (p = p.filter(d));
  const y = l === PM || l === kM;
  (y && !p.includes("ts") && p.push("ts"), o > 1 && !p.includes("v") && p.push("v"));
  const v = rn({}, gW, n.formatters),
    T = { version: o, reportingMode: l, baseUrl: n.baseUrl };
  return (
    p.sort().forEach(S => {
      let w = u[S];
      const C = v[S];
      if ((typeof C == "function" && (w = C(w, T)), S === "v")) {
        if (o === 1) return;
        w = o;
      }
      (S == "pr" && w === 1) ||
        (y && S === "ts" && !Ue(w) && (w = Date.now()),
        hW(w) && (dW(S) && typeof w == "string" && (w = new CM(w)), (i[S] = w)));
    }),
    i
  );
}
function wW(u, n = {}) {
  const i = {};
  if (!u) return i;
  const o = NM(u, n),
    l = cW(o, n == null ? void 0 : n.customHeaderMap);
  return Object.entries(l).reduce((h, [p, d]) => {
    const y = DM(d, { whitespace: !1 });
    return (y && (h[p] = y), h);
  }, i);
}
function RW(u, n, i) {
  return rn(u, wW(n, i));
}
const CW = "CMCD";
function LW(u, n = {}) {
  return u ? DM(NM(u, n), { whitespace: !1 }) : "";
}
function _W(u, n = {}) {
  if (!u) return "";
  const i = LW(u, n);
  return encodeURIComponent(i);
}
function bW(u, n = {}) {
  if (!u) return "";
  const i = _W(u, n);
  return "".concat(CW, "=").concat(i);
}
const Pb = /CMCD=[^&#]+/;
function DW(u, n, i) {
  const o = bW(n, i);
  if (!o) return u;
  if (Pb.test(u)) return u.replace(Pb, o);
  const l = u.includes("?") ? "&" : "?";
  return "".concat(u).concat(l).concat(o);
}
class kW {
  constructor(n) {
    ((this.hls = void 0),
      (this.config = void 0),
      (this.media = void 0),
      (this.sid = void 0),
      (this.cid = void 0),
      (this.useHeaders = !1),
      (this.includeKeys = void 0),
      (this.initialized = !1),
      (this.starved = !1),
      (this.buffering = !0),
      (this.audioBuffer = void 0),
      (this.videoBuffer = void 0),
      (this.onWaiting = () => {
        (this.initialized && (this.starved = !0), (this.buffering = !0));
      }),
      (this.onPlaying = () => {
        (this.initialized || (this.initialized = !0), (this.buffering = !1));
      }),
      (this.applyPlaylistData = l => {
        try {
          this.apply(l, { ot: er.MANIFEST, su: !this.initialized });
        } catch (h) {
          this.hls.logger.warn("Could not generate manifest CMCD data.", h);
        }
      }),
      (this.applyFragmentData = l => {
        try {
          const { frag: h, part: p } = l,
            d = this.hls.levels[h.level],
            y = this.getObjectType(h),
            v = { d: (p || h).duration * 1e3, ot: y };
          (y === er.VIDEO || y === er.AUDIO || y == er.MUXED) &&
            ((v.br = d.bitrate / 1e3),
            (v.tb = this.getTopBandwidth(y) / 1e3),
            (v.bl = this.getBufferLength(y)));
          const T = p ? this.getNextPart(p) : this.getNextFrag(h);
          (T != null && T.url && T.url !== h.url && (v.nor = T.url), this.apply(l, v));
        } catch (h) {
          this.hls.logger.warn("Could not generate segment CMCD data.", h);
        }
      }),
      (this.hls = n));
    const i = (this.config = n.config),
      { cmcd: o } = i;
    o != null &&
      ((i.pLoader = this.createPlaylistLoader()),
      (i.fLoader = this.createFragmentLoader()),
      (this.sid = o.sessionId || n.sessionId),
      (this.cid = o.contentId),
      (this.useHeaders = o.useHeaders === !0),
      (this.includeKeys = o.includeKeys),
      this.registerListeners());
  }
  registerListeners() {
    const n = this.hls;
    (n.on(F.MEDIA_ATTACHED, this.onMediaAttached, this),
      n.on(F.MEDIA_DETACHED, this.onMediaDetached, this),
      n.on(F.BUFFER_CREATED, this.onBufferCreated, this));
  }
  unregisterListeners() {
    const n = this.hls;
    (n.off(F.MEDIA_ATTACHED, this.onMediaAttached, this),
      n.off(F.MEDIA_DETACHED, this.onMediaDetached, this),
      n.off(F.BUFFER_CREATED, this.onBufferCreated, this));
  }
  destroy() {
    (this.unregisterListeners(),
      this.onMediaDetached(),
      (this.hls = this.config = this.audioBuffer = this.videoBuffer = null),
      (this.onWaiting = this.onPlaying = this.media = null));
  }
  onMediaAttached(n, i) {
    ((this.media = i.media),
      this.media.addEventListener("waiting", this.onWaiting),
      this.media.addEventListener("playing", this.onPlaying));
  }
  onMediaDetached() {
    this.media &&
      (this.media.removeEventListener("waiting", this.onWaiting),
      this.media.removeEventListener("playing", this.onPlaying),
      (this.media = null));
  }
  onBufferCreated(n, i) {
    var o, l;
    ((this.audioBuffer = (o = i.tracks.audio) == null ? void 0 : o.buffer),
      (this.videoBuffer = (l = i.tracks.video) == null ? void 0 : l.buffer));
  }
  createData() {
    var n;
    return {
      v: 1,
      sf: B9.HLS,
      sid: this.sid,
      cid: this.cid,
      pr: (n = this.media) == null ? void 0 : n.playbackRate,
      mtp: this.hls.bandwidthEstimate / 1e3,
    };
  }
  apply(n, i = {}) {
    rn(i, this.createData());
    const o = i.ot === er.INIT || i.ot === er.VIDEO || i.ot === er.MUXED;
    (this.starved && o && ((i.bs = !0), (i.su = !0), (this.starved = !1)),
      i.su == null && (i.su = this.buffering));
    const { includeKeys: l } = this;
    l && (i = Object.keys(i).reduce((p, d) => (l.includes(d) && (p[d] = i[d]), p), {}));
    const h = { baseUrl: n.url };
    this.useHeaders ? (n.headers || (n.headers = {}), RW(n.headers, i, h)) : (n.url = DW(n.url, i, h));
  }
  getNextFrag(n) {
    var i;
    const o = (i = this.hls.levels[n.level]) == null ? void 0 : i.details;
    if (o) {
      const l = n.sn - o.startSN;
      return o.fragments[l + 1];
    }
  }
  getNextPart(n) {
    var i;
    const { index: o, fragment: l } = n,
      h = (i = this.hls.levels[l.level]) == null || (i = i.details) == null ? void 0 : i.partList;
    if (h) {
      const { sn: p } = l;
      for (let d = h.length - 1; d >= 0; d--) {
        const y = h[d];
        if (y.index === o && y.fragment.sn === p) return h[d + 1];
      }
    }
  }
  getObjectType(n) {
    const { type: i } = n;
    if (i === "subtitle") return er.TIMED_TEXT;
    if (n.sn === "initSegment") return er.INIT;
    if (i === "audio") return er.AUDIO;
    if (i === "main") return this.hls.audioTracks.length ? er.VIDEO : er.MUXED;
  }
  getTopBandwidth(n) {
    let i = 0,
      o;
    const l = this.hls;
    if (n === er.AUDIO) o = l.audioTracks;
    else {
      const h = l.maxAutoLevel,
        p = h > -1 ? h + 1 : l.levels.length;
      o = l.levels.slice(0, p);
    }
    return (
      o.forEach(h => {
        h.bitrate > i && (i = h.bitrate);
      }),
      i > 0 ? i : NaN
    );
  }
  getBufferLength(n) {
    const i = this.media,
      o = n === er.AUDIO ? this.audioBuffer : this.videoBuffer;
    return !o || !i ? NaN : Tt.bufferInfo(o, i.currentTime, this.config.maxBufferHole).len * 1e3;
  }
  createPlaylistLoader() {
    const { pLoader: n } = this.config,
      i = this.applyPlaylistData,
      o = n || this.config.loader;
    return class {
      constructor(h) {
        ((this.loader = void 0), (this.loader = new o(h)));
      }
      get stats() {
        return this.loader.stats;
      }
      get context() {
        return this.loader.context;
      }
      destroy() {
        this.loader.destroy();
      }
      abort() {
        this.loader.abort();
      }
      load(h, p, d) {
        (i(h), this.loader.load(h, p, d));
      }
    };
  }
  createFragmentLoader() {
    const { fLoader: n } = this.config,
      i = this.applyFragmentData,
      o = n || this.config.loader;
    return class {
      constructor(h) {
        ((this.loader = void 0), (this.loader = new o(h)));
      }
      get stats() {
        return this.loader.stats;
      }
      get context() {
        return this.loader.context;
      }
      destroy() {
        this.loader.destroy();
      }
      abort() {
        this.loader.abort();
      }
      load(h, p, d) {
        (i(h), this.loader.load(h, p, d));
      }
    };
  }
}
const MW = 3e5;
class PW extends Pr {
  constructor(n) {
    (super("content-steering", n.logger),
      (this.hls = void 0),
      (this.loader = null),
      (this.uri = null),
      (this.pathwayId = "."),
      (this._pathwayPriority = null),
      (this.timeToLoad = 300),
      (this.reloadTimer = -1),
      (this.updated = 0),
      (this.started = !1),
      (this.enabled = !0),
      (this.levels = null),
      (this.audioTracks = null),
      (this.subtitleTracks = null),
      (this.penalizedPathways = {}),
      (this.hls = n),
      this.registerListeners());
  }
  registerListeners() {
    const n = this.hls;
    (n.on(F.MANIFEST_LOADING, this.onManifestLoading, this),
      n.on(F.MANIFEST_LOADED, this.onManifestLoaded, this),
      n.on(F.MANIFEST_PARSED, this.onManifestParsed, this),
      n.on(F.ERROR, this.onError, this));
  }
  unregisterListeners() {
    const n = this.hls;
    n &&
      (n.off(F.MANIFEST_LOADING, this.onManifestLoading, this),
      n.off(F.MANIFEST_LOADED, this.onManifestLoaded, this),
      n.off(F.MANIFEST_PARSED, this.onManifestParsed, this),
      n.off(F.ERROR, this.onError, this));
  }
  pathways() {
    return (this.levels || []).reduce(
      (n, i) => (n.indexOf(i.pathwayId) === -1 && n.push(i.pathwayId), n),
      [],
    );
  }
  get pathwayPriority() {
    return this._pathwayPriority;
  }
  set pathwayPriority(n) {
    this.updatePathwayPriority(n);
  }
  startLoad() {
    if (((this.started = !0), this.clearTimeout(), this.enabled && this.uri)) {
      if (this.updated) {
        const n = this.timeToLoad * 1e3 - (performance.now() - this.updated);
        if (n > 0) {
          this.scheduleRefresh(this.uri, n);
          return;
        }
      }
      this.loadSteeringManifest(this.uri);
    }
  }
  stopLoad() {
    ((this.started = !1), this.loader && (this.loader.destroy(), (this.loader = null)), this.clearTimeout());
  }
  clearTimeout() {
    this.reloadTimer !== -1 && (self.clearTimeout(this.reloadTimer), (this.reloadTimer = -1));
  }
  destroy() {
    (this.unregisterListeners(),
      this.stopLoad(),
      (this.hls = null),
      (this.levels = this.audioTracks = this.subtitleTracks = null));
  }
  removeLevel(n) {
    const i = this.levels;
    i && (this.levels = i.filter(o => o !== n));
  }
  onManifestLoading() {
    (this.stopLoad(),
      (this.enabled = !0),
      (this.timeToLoad = 300),
      (this.updated = 0),
      (this.uri = null),
      (this.pathwayId = "."),
      (this.levels = this.audioTracks = this.subtitleTracks = null));
  }
  onManifestLoaded(n, i) {
    const { contentSteering: o } = i;
    o !== null && ((this.pathwayId = o.pathwayId), (this.uri = o.uri), this.started && this.startLoad());
  }
  onManifestParsed(n, i) {
    ((this.audioTracks = i.audioTracks), (this.subtitleTracks = i.subtitleTracks));
  }
  onError(n, i) {
    const { errorAction: o } = i;
    if (
      (o == null ? void 0 : o.action) === mi.SendAlternateToPenaltyBox &&
      o.flags === vr.MoveAllAlternatesMatchingHost
    ) {
      const l = this.levels;
      let h = this._pathwayPriority,
        p = this.pathwayId;
      if (i.context) {
        const { groupId: d, pathwayId: y, type: v } = i.context;
        d && l ? (p = this.getPathwayForGroupId(d, v, p)) : y && (p = y);
      }
      (p in this.penalizedPathways || (this.penalizedPathways[p] = performance.now()),
        !h && l && (h = this.pathways()),
        h && h.length > 1 && (this.updatePathwayPriority(h), (o.resolved = this.pathwayId !== p)),
        i.details === ge.BUFFER_APPEND_ERROR && !i.fatal
          ? (o.resolved = !0)
          : o.resolved ||
            this.warn(
              "Could not resolve "
                .concat(i.details, ' ("')
                .concat(i.error.message, '") with content-steering for Pathway: ')
                .concat(p, " levels: ")
                .concat(l && l.length, " priorities: ")
                .concat(ln(h), " penalized: ")
                .concat(ln(this.penalizedPathways)),
            ));
    }
  }
  filterParsedLevels(n) {
    this.levels = n;
    let i = this.getLevelsForPathway(this.pathwayId);
    if (i.length === 0) {
      const o = n[0].pathwayId;
      (this.log(
        "No levels found in Pathway ".concat(this.pathwayId, '. Setting initial Pathway to "').concat(o, '"'),
      ),
        (i = this.getLevelsForPathway(o)),
        (this.pathwayId = o));
    }
    return (
      i.length !== n.length &&
        this.log(
          "Found ".concat(i.length, "/").concat(n.length, ' levels in Pathway "').concat(this.pathwayId, '"'),
        ),
      i
    );
  }
  getLevelsForPathway(n) {
    return this.levels === null ? [] : this.levels.filter(i => n === i.pathwayId);
  }
  updatePathwayPriority(n) {
    this._pathwayPriority = n;
    let i;
    const o = this.penalizedPathways,
      l = performance.now();
    Object.keys(o).forEach(h => {
      l - o[h] > MW && delete o[h];
    });
    for (let h = 0; h < n.length; h++) {
      const p = n[h];
      if (p in o) continue;
      if (p === this.pathwayId) return;
      const d = this.hls.nextLoadLevel,
        y = this.hls.levels[d];
      if (((i = this.getLevelsForPathway(p)), i.length > 0)) {
        (this.log('Setting Pathway to "'.concat(p, '"')),
          (this.pathwayId = p),
          nM(i),
          this.hls.trigger(F.LEVELS_UPDATED, { levels: i }));
        const v = this.hls.levels[d];
        y &&
          v &&
          this.levels &&
          (v.attrs["STABLE-VARIANT-ID"] !== y.attrs["STABLE-VARIANT-ID"] &&
            v.bitrate !== y.bitrate &&
            this.log("Unstable Pathways change from bitrate ".concat(y.bitrate, " to ").concat(v.bitrate)),
          (this.hls.nextLoadLevel = d));
        break;
      }
    }
  }
  getPathwayForGroupId(n, i, o) {
    const l = this.getLevelsForPathway(o).concat(this.levels || []);
    for (let h = 0; h < l.length; h++)
      if (
        (i === Ot.AUDIO_TRACK && l[h].hasAudioGroup(n)) ||
        (i === Ot.SUBTITLE_TRACK && l[h].hasSubtitleGroup(n))
      )
        return l[h].pathwayId;
    return o;
  }
  clonePathways(n) {
    const i = this.levels;
    if (!i) return;
    const o = {},
      l = {};
    n.forEach(h => {
      const { ID: p, "BASE-ID": d, "URI-REPLACEMENT": y } = h;
      if (i.some(T => T.pathwayId === p)) return;
      const v = this.getLevelsForPathway(d).map(T => {
        const S = new In(T.attrs);
        S["PATHWAY-ID"] = p;
        const w = S.AUDIO && "".concat(S.AUDIO, "_clone_").concat(p),
          C = S.SUBTITLES && "".concat(S.SUBTITLES, "_clone_").concat(p);
        (w && ((o[S.AUDIO] = w), (S.AUDIO = w)), C && ((l[S.SUBTITLES] = C), (S.SUBTITLES = C)));
        const L = FM(T.uri, S["STABLE-VARIANT-ID"], "PER-VARIANT-URIS", y),
          k = new Ld({
            attrs: S,
            audioCodec: T.audioCodec,
            bitrate: T.bitrate,
            height: T.height,
            name: T.name,
            url: L,
            videoCodec: T.videoCodec,
            width: T.width,
          });
        if (T.audioGroups)
          for (let O = 1; O < T.audioGroups.length; O++)
            k.addGroupId("audio", "".concat(T.audioGroups[O], "_clone_").concat(p));
        if (T.subtitleGroups)
          for (let O = 1; O < T.subtitleGroups.length; O++)
            k.addGroupId("text", "".concat(T.subtitleGroups[O], "_clone_").concat(p));
        return k;
      });
      (i.push(...v), Ob(this.audioTracks, o, y, p), Ob(this.subtitleTracks, l, y, p));
    });
  }
  loadSteeringManifest(n) {
    const i = this.hls.config,
      o = i.loader;
    (this.loader && this.loader.destroy(), (this.loader = new o(i)));
    let l;
    try {
      l = new self.URL(n);
    } catch (T) {
      ((this.enabled = !1), this.log("Failed to parse Steering Manifest URI: ".concat(n)));
      return;
    }
    if (l.protocol !== "data:") {
      const T = (this.hls.bandwidthEstimate || i.abrEwmaDefaultEstimate) | 0;
      (l.searchParams.set("_HLS_pathway", this.pathwayId), l.searchParams.set("_HLS_throughput", "" + T));
    }
    const h = { responseType: "json", url: l.href },
      p = i.steeringManifestLoadPolicy.default,
      d = p.errorRetry || p.timeoutRetry || {},
      y = {
        loadPolicy: p,
        timeout: p.maxLoadTimeMs,
        maxRetry: d.maxNumRetry || 0,
        retryDelay: d.retryDelayMs || 0,
        maxRetryDelay: d.maxRetryDelayMs || 0,
      },
      v = {
        onSuccess: (T, S, w, C) => {
          this.log('Loaded steering manifest: "'.concat(l, '"'));
          const L = T.data;
          if ((L == null ? void 0 : L.VERSION) !== 1) {
            this.log("Steering VERSION ".concat(L.VERSION, " not supported!"));
            return;
          }
          ((this.updated = performance.now()), (this.timeToLoad = L.TTL));
          const { "RELOAD-URI": k, "PATHWAY-CLONES": O, "PATHWAY-PRIORITY": B } = L;
          if (k)
            try {
              this.uri = new self.URL(k, l).href;
            } catch ($) {
              ((this.enabled = !1), this.log("Failed to parse Steering Manifest RELOAD-URI: ".concat(k)));
              return;
            }
          (this.scheduleRefresh(this.uri || w.url), O && this.clonePathways(O));
          const N = { steeringManifest: L, url: l.toString() };
          (this.hls.trigger(F.STEERING_MANIFEST_LOADED, N), B && this.updatePathwayPriority(B));
        },
        onError: (T, S, w, C) => {
          if (
            (this.log(
              "Error loading steering manifest: ".concat(T.code, " ").concat(T.text, " (").concat(S.url, ")"),
            ),
            this.stopLoad(),
            T.code === 410)
          ) {
            ((this.enabled = !1), this.log("Steering manifest ".concat(S.url, " no longer available")));
            return;
          }
          let L = this.timeToLoad * 1e3;
          if (T.code === 429) {
            const k = this.loader;
            if (typeof (k == null ? void 0 : k.getResponseHeader) == "function") {
              const O = k.getResponseHeader("Retry-After");
              O && (L = parseFloat(O) * 1e3);
            }
            this.log("Steering manifest ".concat(S.url, " rate limited"));
            return;
          }
          this.scheduleRefresh(this.uri || S.url, L);
        },
        onTimeout: (T, S, w) => {
          (this.log("Timeout loading steering manifest (".concat(S.url, ")")),
            this.scheduleRefresh(this.uri || S.url));
        },
      };
    (this.log("Requesting steering manifest: ".concat(l)), this.loader.load(h, y, v));
  }
  scheduleRefresh(n, i = this.timeToLoad * 1e3) {
    (this.clearTimeout(),
      (this.reloadTimer = self.setTimeout(() => {
        var o;
        const l = (o = this.hls) == null ? void 0 : o.media;
        if (l && !l.ended) {
          this.loadSteeringManifest(n);
          return;
        }
        this.scheduleRefresh(n, this.timeToLoad * 1e3);
      }, i)));
  }
}
function Ob(u, n, i, o) {
  u &&
    Object.keys(n).forEach(l => {
      const h = u
        .filter(p => p.groupId === l)
        .map(p => {
          const d = rn({}, p);
          return (
            (d.details = void 0),
            (d.attrs = new In(d.attrs)),
            (d.url = d.attrs.URI = FM(p.url, p.attrs["STABLE-RENDITION-ID"], "PER-RENDITION-URIS", i)),
            (d.groupId = d.attrs["GROUP-ID"] = n[l]),
            (d.attrs["PATHWAY-ID"] = o),
            d
          );
        });
      u.push(...h);
    });
}
function FM(u, n, i, o) {
  const { HOST: l, PARAMS: h, [i]: p } = o;
  let d;
  n && ((d = p == null ? void 0 : p[n]), d && (u = d));
  const y = new self.URL(u);
  return (
    l && !d && (y.host = l),
    h &&
      Object.keys(h)
        .sort()
        .forEach(v => {
          v && y.searchParams.set(v, h[v]);
        }),
    y.href
  );
}
class au extends Pr {
  constructor(n) {
    (super("eme", n.logger),
      (this.hls = void 0),
      (this.config = void 0),
      (this.media = null),
      (this.mediaResolved = void 0),
      (this.keyFormatPromise = null),
      (this.keySystemAccessPromises = {}),
      (this._requestLicenseFailureCount = 0),
      (this.mediaKeySessions = []),
      (this.keyIdToKeySessionPromise = {}),
      (this.mediaKeys = null),
      (this.setMediaKeysQueue = au.CDMCleanupPromise ? [au.CDMCleanupPromise] : []),
      (this.bannedKeyIds = {}),
      (this.onMediaEncrypted = i => {
        const { initDataType: o, initData: l } = i,
          h = '"'.concat(i.type, '" event: init data type: "').concat(o, '"');
        if ((this.debug(h), l !== null)) {
          if (!this.keyFormatPromise) {
            let p = Object.keys(this.keySystemAccessPromises);
            p.length || (p = rd(this.config));
            const d = p.map(bx).filter(y => !!y);
            this.keyFormatPromise = this.getKeyFormatPromise(d);
          }
          this.keyFormatPromise
            .then(p => {
              const d = gg(p);
              if (o !== "sinf" || d !== wn.FAIRPLAY) {
                this.log(
                  'Ignoring "'
                    .concat(i.type, '" event with init data type: "')
                    .concat(o, '" for selected key-system ')
                    .concat(d),
                );
                return;
              }
              let y;
              try {
                const C = Jn(new Uint8Array(l)),
                  L = mS(JSON.parse(C).sinf),
                  k = Dk(L);
                if (!k) throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");
                y = new Uint8Array(k.subarray(8, 24));
              } catch (C) {
                this.warn("".concat(h, " Failed to parse sinf: ").concat(C));
                return;
              }
              const v = yi(y),
                { keyIdToKeySessionPromise: T, mediaKeySessions: S } = this;
              let w = T[v];
              for (let C = 0; C < S.length; C++) {
                const L = S[C],
                  k = L.decryptdata;
                if (!k.keyId) continue;
                const O = yi(k.keyId);
                if (Gg(y, k.keyId) || k.uri.replace(/-/g, "").indexOf(v) !== -1) {
                  if (((w = T[O]), !w)) continue;
                  if (k.pssh) break;
                  (delete T[O],
                    (k.pssh = new Uint8Array(l)),
                    (k.keyId = y),
                    (w = T[v] =
                      w.then(() =>
                        this.generateRequestWithPreferredKeySession(L, o, l, "encrypted-event-key-match"),
                      )),
                    w.catch(B => this.handleError(B)));
                  break;
                }
              }
              w ||
                this.handleError(
                  new Error(
                    "Key ID "
                      .concat(v, " not encountered in playlist. Key-system sessions ")
                      .concat(S.length, "."),
                  ),
                );
            })
            .catch(p => this.handleError(p));
        }
      }),
      (this.onWaitingForKey = i => {
        this.log('"'.concat(i.type, '" event'));
      }),
      (this.hls = n),
      (this.config = n.config),
      this.registerListeners());
  }
  destroy() {
    (this.onDestroying(), this.onMediaDetached());
    const n = this.config;
    ((n.requestMediaKeySystemAccessFunc = null),
      (n.licenseXhrSetup = n.licenseResponseCallback = void 0),
      (n.drmSystems = n.drmSystemOptions = {}),
      (this.hls = this.config = this.keyIdToKeySessionPromise = null),
      (this.onMediaEncrypted = this.onWaitingForKey = null));
  }
  registerListeners() {
    (this.hls.on(F.MEDIA_ATTACHED, this.onMediaAttached, this),
      this.hls.on(F.MEDIA_DETACHED, this.onMediaDetached, this),
      this.hls.on(F.MANIFEST_LOADING, this.onManifestLoading, this),
      this.hls.on(F.MANIFEST_LOADED, this.onManifestLoaded, this),
      this.hls.on(F.DESTROYING, this.onDestroying, this));
  }
  unregisterListeners() {
    (this.hls.off(F.MEDIA_ATTACHED, this.onMediaAttached, this),
      this.hls.off(F.MEDIA_DETACHED, this.onMediaDetached, this),
      this.hls.off(F.MANIFEST_LOADING, this.onManifestLoading, this),
      this.hls.off(F.MANIFEST_LOADED, this.onManifestLoaded, this),
      this.hls.off(F.DESTROYING, this.onDestroying, this));
  }
  getLicenseServerUrl(n) {
    const { drmSystems: i, widevineLicenseUrl: o } = this.config,
      l = i == null ? void 0 : i[n];
    if (l) return l.licenseUrl;
    if (n === wn.WIDEVINE && o) return o;
  }
  getLicenseServerUrlOrThrow(n) {
    const i = this.getLicenseServerUrl(n);
    if (i === void 0) throw new Error('no license server URL configured for key-system "'.concat(n, '"'));
    return i;
  }
  getServerCertificateUrl(n) {
    const { drmSystems: i } = this.config,
      o = i == null ? void 0 : i[n];
    if (o) return o.serverCertificateUrl;
    this.log('No Server Certificate in config.drmSystems["'.concat(n, '"]'));
  }
  attemptKeySystemAccess(n) {
    const i = this.hls.levels,
      o = (p, d, y) => !!p && y.indexOf(p) === d,
      l = i.map(p => p.audioCodec).filter(o),
      h = i.map(p => p.videoCodec).filter(o);
    return (
      l.length + h.length === 0 && h.push("avc1.42e01e"),
      new Promise((p, d) => {
        const y = v => {
          const T = v.shift();
          this.getMediaKeysPromise(T, l, h)
            .then(S => p({ keySystem: T, mediaKeys: S }))
            .catch(S => {
              v.length
                ? y(v)
                : S instanceof yr
                  ? d(S)
                  : d(
                      new yr(
                        { type: et.KEY_SYSTEM_ERROR, details: ge.KEY_SYSTEM_NO_ACCESS, error: S, fatal: !0 },
                        S.message,
                      ),
                    );
            });
        };
        y(n);
      })
    );
  }
  requestMediaKeySystemAccess(n, i) {
    const { requestMediaKeySystemAccessFunc: o } = this.config;
    if (typeof o != "function") {
      let l = "Configured requestMediaKeySystemAccess is not a function ".concat(o);
      return (
        Yk === null &&
          self.location.protocol === "http:" &&
          (l = "navigator.requestMediaKeySystemAccess is not available over insecure protocol ".concat(
            location.protocol,
          )),
        Promise.reject(new Error(l))
      );
    }
    return o(n, i);
  }
  getMediaKeysPromise(n, i, o) {
    var l;
    const h = pK(n, i, o, this.config.drmSystemOptions || {});
    let p = this.keySystemAccessPromises[n],
      d = (l = p) == null ? void 0 : l.keySystemAccess;
    if (!d) {
      (this.log('Requesting encrypted media "'.concat(n, '" key-system access with config: ').concat(ln(h))),
        (d = this.requestMediaKeySystemAccess(n, h)));
      const y = (p = this.keySystemAccessPromises[n] = { keySystemAccess: d });
      return (
        d.catch(v => {
          this.log('Failed to obtain access to key-system "'.concat(n, '": ').concat(v));
        }),
        d.then(v => {
          this.log('Access for key-system "'.concat(v.keySystem, '" obtained'));
          const T = this.fetchServerCertificate(n);
          this.log('Create media-keys for "'.concat(n, '"'));
          const S = (y.mediaKeys = v
            .createMediaKeys()
            .then(
              w => (
                this.log('Media-keys created for "'.concat(n, '"')),
                (y.hasMediaKeys = !0),
                T.then(C => (C ? this.setMediaKeysServerCertificate(w, n, C) : w))
              ),
            ));
          return (
            S.catch(w => {
              this.error('Failed to create media-keys for "'.concat(n, '"}: ').concat(w));
            }),
            S
          );
        })
      );
    }
    return d.then(() => p.mediaKeys);
  }
  createMediaKeySessionContext({ decryptdata: n, keySystem: i, mediaKeys: o }) {
    this.log(
      'Creating key-system session "'
        .concat(i, '" keyId: ')
        .concat(yi(n.keyId || []), " keyUri: ")
        .concat(n.uri),
    );
    const l = o.createSession(),
      h = { decryptdata: n, keySystem: i, mediaKeys: o, mediaKeysSession: l, keyStatus: "status-pending" };
    return (this.mediaKeySessions.push(h), h);
  }
  renewKeySession(n) {
    const i = n.decryptdata;
    if (i.pssh) {
      const o = this.createMediaKeySessionContext(n),
        l = qp(i),
        h = "cenc";
      this.keyIdToKeySessionPromise[l] = this.generateRequestWithPreferredKeySession(
        o,
        h,
        i.pssh.buffer,
        "expired",
      );
    } else this.warn("Could not renew expired session. Missing pssh initData.");
    this.removeSession(n);
  }
  updateKeySession(n, i) {
    const o = n.mediaKeysSession;
    return (
      this.log(
        'Updating key-session "'
          .concat(o.sessionId, '" for keyId ')
          .concat(yi(n.decryptdata.keyId || []), "\n      } (data length: ")
          .concat(i.byteLength, ")"),
      ),
      o.update(i)
    );
  }
  getSelectedKeySystemFormats() {
    return Object.keys(this.keySystemAccessPromises)
      .map(n => ({ keySystem: n, hasMediaKeys: this.keySystemAccessPromises[n].hasMediaKeys }))
      .filter(({ hasMediaKeys: n }) => !!n)
      .map(({ keySystem: n }) => bx(n))
      .filter(n => !!n);
  }
  getKeySystemAccess(n) {
    return this.getKeySystemSelectionPromise(n).then(({ keySystem: i, mediaKeys: o }) =>
      this.attemptSetMediaKeys(i, o),
    );
  }
  selectKeySystem(n) {
    return new Promise((i, o) => {
      this.getKeySystemSelectionPromise(n)
        .then(({ keySystem: l }) => {
          const h = bx(l);
          h ? i(h) : o(new Error('Unable to find format for key-system "'.concat(l, '"')));
        })
        .catch(o);
    });
  }
  selectKeySystemFormat(n) {
    const i = Object.keys(n.levelkeys || {});
    return (
      this.keyFormatPromise ||
        (this.log(
          "Selecting key-system from fragment (sn: "
            .concat(n.sn, " ")
            .concat(n.type, ": ")
            .concat(n.level, ") key formats ")
            .concat(i.join(", ")),
        ),
        (this.keyFormatPromise = this.getKeyFormatPromise(i))),
      this.keyFormatPromise
    );
  }
  getKeyFormatPromise(n) {
    const i = rd(this.config),
      o = n.map(gg).filter(l => !!l && i.indexOf(l) !== -1);
    return this.selectKeySystem(o);
  }
  getKeyStatus(n) {
    const { mediaKeySessions: i } = this;
    for (let o = 0; o < i.length; o++) {
      const l = OW(n, i[o]);
      if (l) return l;
    }
  }
  loadKey(n) {
    const i = n.keyInfo.decryptdata,
      o = qp(i),
      l = this.bannedKeyIds[o];
    if (l || this.getKeyStatus(i) === "internal-error") {
      const d = Nb(l || "internal-error", i);
      return (this.handleError(d, n.frag), Promise.reject(d));
    }
    const h = "(keyId: "
      .concat(o, ' format: "')
      .concat(i.keyFormat, '" method: ')
      .concat(i.method, " uri: ")
      .concat(i.uri, ")");
    this.log("Starting session for key ".concat(h));
    const p = this.keyIdToKeySessionPromise[o];
    if (!p) {
      const d = this.getKeySystemForKeyPromise(i)
        .then(
          ({ keySystem: y, mediaKeys: v }) => (
            this.throwIfDestroyed(),
            this.log(
              "Handle encrypted media sn: "
                .concat(n.frag.sn, " ")
                .concat(n.frag.type, ": ")
                .concat(n.frag.level, " using key ")
                .concat(h),
            ),
            this.attemptSetMediaKeys(y, v).then(
              () => (
                this.throwIfDestroyed(),
                this.createMediaKeySessionContext({ keySystem: y, mediaKeys: v, decryptdata: i })
              ),
            )
          ),
        )
        .then(y => {
          const v = "cenc",
            T = i.pssh ? i.pssh.buffer : null;
          return this.generateRequestWithPreferredKeySession(y, v, T, "playlist-key");
        });
      return (d.catch(y => this.handleError(y, n.frag)), (this.keyIdToKeySessionPromise[o] = d), d);
    }
    return (
      p.catch(d => {
        if (d instanceof yr) {
          const y = Jt({}, d.data);
          this.getKeyStatus(i) === "internal-error" && (y.decryptdata = i);
          const v = new yr(y, d.message);
          this.handleError(v, n.frag);
        }
      }),
      p
    );
  }
  throwIfDestroyed(n = "Invalid state") {
    if (!this.hls) throw new Error("invalid state");
  }
  handleError(n, i) {
    if (this.hls)
      if (n instanceof yr) {
        i && (n.data.frag = i);
        const o = n.data.decryptdata;
        (this.error("".concat(n.message).concat(o ? " (".concat(yi(o.keyId || []), ")") : "")),
          this.hls.trigger(F.ERROR, n.data));
      } else
        (this.error(n.message),
          this.hls.trigger(F.ERROR, {
            type: et.KEY_SYSTEM_ERROR,
            details: ge.KEY_SYSTEM_NO_KEYS,
            error: n,
            fatal: !0,
          }));
  }
  getKeySystemForKeyPromise(n) {
    const i = qp(n),
      o = this.keyIdToKeySessionPromise[i];
    if (!o) {
      const l = gg(n.keyFormat),
        h = l ? [l] : rd(this.config);
      return this.attemptKeySystemAccess(h);
    }
    return o;
  }
  getKeySystemSelectionPromise(n) {
    if ((n.length || (n = rd(this.config)), n.length === 0))
      throw new yr(
        { type: et.KEY_SYSTEM_ERROR, details: ge.KEY_SYSTEM_NO_CONFIGURED_LICENSE, fatal: !0 },
        "Missing key-system license configuration options ".concat(
          ln({ drmSystems: this.config.drmSystems }),
        ),
      );
    return this.attemptKeySystemAccess(n);
  }
  attemptSetMediaKeys(n, i) {
    if (((this.mediaResolved = void 0), this.mediaKeys === i)) return Promise.resolve();
    const o = this.setMediaKeysQueue.slice();
    this.log('Setting media-keys for "'.concat(n, '"'));
    const l = Promise.all(o).then(() =>
      this.media
        ? this.media.setMediaKeys(i)
        : new Promise((h, p) => {
            this.mediaResolved = () => {
              if (((this.mediaResolved = void 0), !this.media))
                return p(new Error("Attempted to set mediaKeys without media element attached"));
              ((this.mediaKeys = i), this.media.setMediaKeys(i).then(h).catch(p));
            };
          }),
    );
    return (
      (this.mediaKeys = i),
      this.setMediaKeysQueue.push(l),
      l.then(() => {
        (this.log('Media-keys set for "'.concat(n, '"')),
          o.push(l),
          (this.setMediaKeysQueue = this.setMediaKeysQueue.filter(h => o.indexOf(h) === -1)));
      })
    );
  }
  generateRequestWithPreferredKeySession(n, i, o, l) {
    var h;
    const p =
      (h = this.config.drmSystems) == null || (h = h[n.keySystem]) == null ? void 0 : h.generateRequest;
    if (p)
      try {
        const L = p.call(this.hls, i, o, n);
        if (!L) throw new Error("Invalid response from configured generateRequest filter");
        ((i = L.initDataType),
          (o = L.initData ? L.initData : null),
          (n.decryptdata.pssh = o ? new Uint8Array(o) : null));
      } catch (L) {
        if ((this.warn(L.message), this.hls && this.hls.config.debug)) throw L;
      }
    if (o === null)
      return (
        this.log('Skipping key-session request for "'.concat(l, '" (no initData)')),
        Promise.resolve(n)
      );
    const d = qp(n.decryptdata),
      y = n.decryptdata.uri;
    this.log(
      'Generating key-session request for "'
        .concat(l, '" keyId: ')
        .concat(d, " URI: ")
        .concat(y, " (init data type: ")
        .concat(i, " length: ")
        .concat(o.byteLength, ")"),
    );
    const v = new vS(),
      T = (n._onmessage = L => {
        const k = n.mediaKeysSession;
        if (!k) {
          v.emit("error", new Error("invalid state"));
          return;
        }
        const { messageType: O, message: B } = L;
        (this.log(
          '"'
            .concat(O, '" message event for session "')
            .concat(k.sessionId, '" message size: ')
            .concat(B.byteLength),
        ),
          O === "license-request" || O === "license-renewal"
            ? this.renewLicense(n, B).catch(N => {
                v.eventNames().length ? v.emit("error", N) : this.handleError(N);
              })
            : O === "license-release"
              ? n.keySystem === wn.FAIRPLAY &&
                this.updateKeySession(n, bT("acknowledged"))
                  .then(() => this.removeSession(n))
                  .catch(N => this.handleError(N))
              : this.warn('unhandled media key message type "'.concat(O, '"')));
      }),
      S = (L, k) => {
        k.keyStatus = L;
        let O;
        (L.startsWith("usable")
          ? v.emit("resolved")
          : L === "internal-error" || L === "output-restricted" || L === "output-downscaled"
            ? (O = Nb(L, k.decryptdata))
            : L === "expired"
              ? (O = new Error("key expired (keyId: ".concat(d, ")")))
              : L === "released"
                ? (O = new Error("key released"))
                : L === "status-pending" ||
                  this.warn('unhandled key status change "'.concat(L, '" (keyId: ').concat(d, ")")),
          O && (v.eventNames().length ? v.emit("error", O) : this.handleError(O)));
      },
      w = (n._onkeystatuseschange = L => {
        if (!n.mediaKeysSession) {
          v.emit("error", new Error("invalid state"));
          return;
        }
        const O = this.getKeyStatuses(n);
        if (!Object.keys(O).some(I => O[I] !== "status-pending")) return;
        if (O[d] === "expired") {
          (this.log(
            "Expired key ".concat(ln(O), ' in key-session "').concat(n.mediaKeysSession.sessionId, '"'),
          ),
            this.renewKeySession(n));
          return;
        }
        let N = O[d];
        if (N) S(N, n);
        else {
          var $;
          (n.keyStatusTimeouts || (n.keyStatusTimeouts = {}),
            ($ = n.keyStatusTimeouts)[d] ||
              ($[d] = self.setTimeout(() => {
                if (!n.mediaKeysSession || !this.mediaKeys) return;
                const V = this.getKeyStatus(n.decryptdata);
                if (V && V !== "status-pending")
                  return (
                    this.log(
                      "No status for keyId "
                        .concat(d, ' in key-session "')
                        .concat(n.mediaKeysSession.sessionId, '". Using session key-status ')
                        .concat(V, " from other session."),
                    ),
                    S(V, n)
                  );
                (this.log(
                  "key status for "
                    .concat(d, ' in key-session "')
                    .concat(n.mediaKeysSession.sessionId, '" timed out after 1000ms'),
                ),
                  (N = "internal-error"),
                  S(N, n));
              }, 1e3)),
            this.log("No status for keyId ".concat(d, " (").concat(ln(O), ").")));
        }
      });
    (ji(n.mediaKeysSession, "message", T), ji(n.mediaKeysSession, "keystatuseschange", w));
    const C = new Promise((L, k) => {
      (v.on("error", k), v.on("resolved", L));
    });
    return n.mediaKeysSession
      .generateRequest(i, o)
      .then(() => {
        this.log(
          'Request generated for key-session "'
            .concat(n.mediaKeysSession.sessionId, '" keyId: ')
            .concat(d, " URI: ")
            .concat(y),
        );
      })
      .catch(L => {
        throw new yr(
          {
            type: et.KEY_SYSTEM_ERROR,
            details: ge.KEY_SYSTEM_NO_SESSION,
            error: L,
            decryptdata: n.decryptdata,
            fatal: !1,
          },
          "Error generating key-session request: ".concat(L),
        );
      })
      .then(() => C)
      .catch(
        L => (
          v.removeAllListeners(),
          this.removeSession(n).then(() => {
            throw L;
          })
        ),
      )
      .then(() => (v.removeAllListeners(), n));
  }
  getKeyStatuses(n) {
    const i = {};
    return (
      n.mediaKeysSession.keyStatuses.forEach((o, l) => {
        if (typeof l == "string" && typeof o == "object") {
          const d = l;
          ((l = o), (o = d));
        }
        const h = "buffer" in l ? new Uint8Array(l.buffer, l.byteOffset, l.byteLength) : new Uint8Array(l);
        if (n.keySystem === wn.PLAYREADY && h.length === 16) {
          const d = yi(h);
          ((i[d] = o), Wk(h));
        }
        const p = yi(h);
        (o === "internal-error" && (this.bannedKeyIds[p] = o),
          this.log(
            'key status change "'
              .concat(o, '" for keyStatuses keyId: ')
              .concat(p, ' key-session "')
              .concat(n.mediaKeysSession.sessionId, '"'),
          ),
          (i[p] = o));
      }),
      i
    );
  }
  fetchServerCertificate(n) {
    const i = this.config,
      o = i.loader,
      l = new o(i),
      h = this.getServerCertificateUrl(n);
    return h
      ? (this.log('Fetching server certificate for "'.concat(n, '"')),
        new Promise((p, d) => {
          const y = { responseType: "arraybuffer", url: h },
            v = i.certLoadPolicy.default,
            T = { loadPolicy: v, timeout: v.maxLoadTimeMs, maxRetry: 0, retryDelay: 0, maxRetryDelay: 0 },
            S = {
              onSuccess: (w, C, L, k) => {
                p(w.data);
              },
              onError: (w, C, L, k) => {
                d(
                  new yr(
                    {
                      type: et.KEY_SYSTEM_ERROR,
                      details: ge.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,
                      fatal: !0,
                      networkDetails: L,
                      response: Jt({ url: y.url, data: void 0 }, w),
                    },
                    '"'
                      .concat(n, '" certificate request failed (')
                      .concat(h, "). Status: ")
                      .concat(w.code, " (")
                      .concat(w.text, ")"),
                  ),
                );
              },
              onTimeout: (w, C, L) => {
                d(
                  new yr(
                    {
                      type: et.KEY_SYSTEM_ERROR,
                      details: ge.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,
                      fatal: !0,
                      networkDetails: L,
                      response: { url: y.url, data: void 0 },
                    },
                    '"'.concat(n, '" certificate request timed out (').concat(h, ")"),
                  ),
                );
              },
              onAbort: (w, C, L) => {
                d(new Error("aborted"));
              },
            };
          l.load(y, T, S);
        }))
      : Promise.resolve();
  }
  setMediaKeysServerCertificate(n, i, o) {
    return new Promise((l, h) => {
      n.setServerCertificate(o)
        .then(p => {
          (this.log(
            "setServerCertificate "
              .concat(p ? "success" : "not supported by CDM", " (")
              .concat(o.byteLength, ') on "')
              .concat(i, '"'),
          ),
            l(n));
        })
        .catch(p => {
          h(
            new yr(
              {
                type: et.KEY_SYSTEM_ERROR,
                details: ge.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,
                error: p,
                fatal: !0,
              },
              p.message,
            ),
          );
        });
    });
  }
  renewLicense(n, i) {
    return this.requestLicense(n, new Uint8Array(i)).then(o =>
      this.updateKeySession(n, new Uint8Array(o)).catch(l => {
        throw new yr(
          {
            type: et.KEY_SYSTEM_ERROR,
            details: ge.KEY_SYSTEM_SESSION_UPDATE_FAILED,
            decryptdata: n.decryptdata,
            error: l,
            fatal: !1,
          },
          l.message,
        );
      }),
    );
  }
  unpackPlayReadyKeyMessage(n, i) {
    const o = String.fromCharCode.apply(null, new Uint16Array(i.buffer));
    if (!o.includes("PlayReadyKeyMessage"))
      return (n.setRequestHeader("Content-Type", "text/xml; charset=utf-8"), i);
    const l = new DOMParser().parseFromString(o, "application/xml"),
      h = l.querySelectorAll("HttpHeader");
    if (h.length > 0) {
      let T;
      for (let S = 0, w = h.length; S < w; S++) {
        var p, d;
        T = h[S];
        const C = (p = T.querySelector("name")) == null ? void 0 : p.textContent,
          L = (d = T.querySelector("value")) == null ? void 0 : d.textContent;
        C && L && n.setRequestHeader(C, L);
      }
    }
    const y = l.querySelector("Challenge"),
      v = y == null ? void 0 : y.textContent;
    if (!v) throw new Error("Cannot find <Challenge> in key message");
    return bT(atob(v));
  }
  setupLicenseXHR(n, i, o, l) {
    const h = this.config.licenseXhrSetup;
    return h
      ? Promise.resolve()
          .then(() => {
            if (!o.decryptdata) throw new Error("Key removed");
            return h.call(this.hls, n, i, o, l);
          })
          .catch(p => {
            if (!o.decryptdata) throw p;
            return (n.open("POST", i, !0), h.call(this.hls, n, i, o, l));
          })
          .then(p => (n.readyState || n.open("POST", i, !0), { xhr: n, licenseChallenge: p || l }))
      : (n.open("POST", i, !0), Promise.resolve({ xhr: n, licenseChallenge: l }));
  }
  requestLicense(n, i) {
    const o = this.config.keyLoadPolicy.default;
    return new Promise((l, h) => {
      const p = this.getLicenseServerUrlOrThrow(n.keySystem);
      this.log("Sending license request to URL: ".concat(p));
      const d = new XMLHttpRequest();
      ((d.responseType = "arraybuffer"),
        (d.onreadystatechange = () => {
          if (!this.hls || !n.mediaKeysSession) return h(new Error("invalid state"));
          if (d.readyState === 4)
            if (d.status === 200) {
              this._requestLicenseFailureCount = 0;
              let y = d.response;
              this.log("License received ".concat(y instanceof ArrayBuffer ? y.byteLength : y));
              const v = this.config.licenseResponseCallback;
              if (v)
                try {
                  y = v.call(this.hls, d, p, n);
                } catch (T) {
                  this.error(T);
                }
              l(y);
            } else {
              const y = o.errorRetry,
                v = y ? y.maxNumRetry : 0;
              if (
                (this._requestLicenseFailureCount++,
                this._requestLicenseFailureCount > v || (d.status >= 400 && d.status < 500))
              )
                h(
                  new yr(
                    {
                      type: et.KEY_SYSTEM_ERROR,
                      details: ge.KEY_SYSTEM_LICENSE_REQUEST_FAILED,
                      decryptdata: n.decryptdata,
                      fatal: !0,
                      networkDetails: d,
                      response: { url: p, data: void 0, code: d.status, text: d.statusText },
                    },
                    "License Request XHR failed ("
                      .concat(p, "). Status: ")
                      .concat(d.status, " (")
                      .concat(d.statusText, ")"),
                  ),
                );
              else {
                const T = v - this._requestLicenseFailureCount + 1;
                (this.warn("Retrying license request, ".concat(T, " attempts left")),
                  this.requestLicense(n, i).then(l, h));
              }
            }
        }),
        n.licenseXhr && n.licenseXhr.readyState !== XMLHttpRequest.DONE && n.licenseXhr.abort(),
        (n.licenseXhr = d),
        this.setupLicenseXHR(d, p, n, i)
          .then(({ xhr: y, licenseChallenge: v }) => {
            (n.keySystem == wn.PLAYREADY && (v = this.unpackPlayReadyKeyMessage(y, v)), y.send(v));
          })
          .catch(h));
    });
  }
  onDestroying() {
    (this.unregisterListeners(), this._clear());
  }
  onMediaAttached(n, i) {
    if (!this.config.emeEnabled) return;
    const o = i.media;
    ((this.media = o),
      ji(o, "encrypted", this.onMediaEncrypted),
      ji(o, "waitingforkey", this.onWaitingForKey));
    const l = this.mediaResolved;
    l ? l() : (this.mediaKeys = o.mediaKeys);
  }
  onMediaDetached() {
    const n = this.media;
    n &&
      (tr(n, "encrypted", this.onMediaEncrypted),
      tr(n, "waitingforkey", this.onWaitingForKey),
      (this.media = null),
      (this.mediaKeys = null));
  }
  _clear() {
    var n;
    ((this._requestLicenseFailureCount = 0), (this.keyIdToKeySessionPromise = {}), (this.bannedKeyIds = {}));
    const i = this.mediaResolved;
    if ((i && i(), !this.mediaKeys && !this.mediaKeySessions.length)) return;
    const o = this.media,
      l = this.mediaKeySessions.slice();
    ((this.mediaKeySessions = []), (this.mediaKeys = null), Mo.clearKeyUriToKeyIdMap());
    const h = l.length;
    au.CDMCleanupPromise = Promise.all(
      l
        .map(p => this.removeSession(p))
        .concat(
          (o == null || (n = o.setMediaKeys(null)) == null
            ? void 0
            : n.catch(p => {
                (this.log("Could not clear media keys: ".concat(p)),
                  this.hls &&
                    this.hls.trigger(F.ERROR, {
                      type: et.OTHER_ERROR,
                      details: ge.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,
                      fatal: !1,
                      error: new Error("Could not clear media keys: ".concat(p)),
                    }));
              })) || Promise.resolve(),
        ),
    )
      .catch(p => {
        (this.log("Could not close sessions and clear media keys: ".concat(p)),
          this.hls &&
            this.hls.trigger(F.ERROR, {
              type: et.OTHER_ERROR,
              details: ge.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,
              fatal: !1,
              error: new Error("Could not close sessions and clear media keys: ".concat(p)),
            }));
      })
      .then(() => {
        h && this.log("finished closing key sessions and clearing media keys");
      });
  }
  onManifestLoading() {
    this._clear();
  }
  onManifestLoaded(n, { sessionKeys: i }) {
    if (!(!i || !this.config.emeEnabled) && !this.keyFormatPromise) {
      const o = i.reduce((l, h) => (l.indexOf(h.keyFormat) === -1 && l.push(h.keyFormat), l), []);
      (this.log("Selecting key-system from session-keys ".concat(o.join(", "))),
        (this.keyFormatPromise = this.getKeyFormatPromise(o)));
    }
  }
  removeSession(n) {
    const { mediaKeysSession: i, licenseXhr: o, decryptdata: l } = n;
    if (i) {
      (this.log(
        'Remove licenses and keys and close session "'
          .concat(i.sessionId, '" keyId: ')
          .concat(yi((l == null ? void 0 : l.keyId) || [])),
      ),
        n._onmessage && (i.removeEventListener("message", n._onmessage), (n._onmessage = void 0)),
        n._onkeystatuseschange &&
          (i.removeEventListener("keystatuseschange", n._onkeystatuseschange),
          (n._onkeystatuseschange = void 0)),
        o && o.readyState !== XMLHttpRequest.DONE && o.abort(),
        (n.mediaKeysSession = n.decryptdata = n.licenseXhr = void 0));
      const h = this.mediaKeySessions.indexOf(n);
      h > -1 && this.mediaKeySessions.splice(h, 1);
      const { keyStatusTimeouts: p } = n;
      p && Object.keys(p).forEach(v => self.clearTimeout(p[v]));
      const { drmSystemOptions: d } = this.config;
      return (
        mK(d)
          ? new Promise((v, T) => {
              (self.setTimeout(() => T(new Error("MediaKeySession.remove() timeout")), 8e3),
                i.remove().then(v).catch(T));
            })
          : Promise.resolve()
      )
        .catch(v => {
          (this.log("Could not remove session: ".concat(v)),
            this.hls &&
              this.hls.trigger(F.ERROR, {
                type: et.OTHER_ERROR,
                details: ge.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,
                fatal: !1,
                error: new Error("Could not remove session: ".concat(v)),
              }));
        })
        .then(() => i.close())
        .catch(v => {
          (this.log("Could not close session: ".concat(v)),
            this.hls &&
              this.hls.trigger(F.ERROR, {
                type: et.OTHER_ERROR,
                details: ge.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,
                fatal: !1,
                error: new Error("Could not close session: ".concat(v)),
              }));
        });
    }
    return Promise.resolve();
  }
}
au.CDMCleanupPromise = void 0;
function qp(u) {
  if (!u) throw new Error("Could not read keyId of undefined decryptdata");
  if (u.keyId === null) throw new Error("keyId is null");
  return yi(u.keyId);
}
function OW(u, n) {
  if (u.keyId && n.mediaKeysSession.keyStatuses.has(u.keyId))
    return n.mediaKeysSession.keyStatuses.get(u.keyId);
  if (u.matches(n.decryptdata)) return n.keyStatus;
}
class yr extends Error {
  constructor(n, i) {
    (super(i), (this.data = void 0), n.error || (n.error = new Error(i)), (this.data = n), (n.err = n.error));
  }
}
function Nb(u, n) {
  const i = u === "output-restricted",
    o = i ? ge.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED : ge.KEY_SYSTEM_STATUS_INTERNAL_ERROR;
  return new yr(
    { type: et.KEY_SYSTEM_ERROR, details: o, fatal: !1, decryptdata: n },
    i ? "HDCP level output restricted" : 'key status changed to "'.concat(u, '"'),
  );
}
class NW {
  constructor(n) {
    ((this.hls = void 0),
      (this.isVideoPlaybackQualityAvailable = !1),
      (this.timer = void 0),
      (this.media = null),
      (this.lastTime = void 0),
      (this.lastDroppedFrames = 0),
      (this.lastDecodedFrames = 0),
      (this.streamController = void 0),
      (this.hls = n),
      this.registerListeners());
  }
  setStreamController(n) {
    this.streamController = n;
  }
  registerListeners() {
    (this.hls.on(F.MEDIA_ATTACHING, this.onMediaAttaching, this),
      this.hls.on(F.MEDIA_DETACHING, this.onMediaDetaching, this));
  }
  unregisterListeners() {
    (this.hls.off(F.MEDIA_ATTACHING, this.onMediaAttaching, this),
      this.hls.off(F.MEDIA_DETACHING, this.onMediaDetaching, this));
  }
  destroy() {
    (this.timer && clearInterval(this.timer),
      this.unregisterListeners(),
      (this.isVideoPlaybackQualityAvailable = !1),
      (this.media = null));
  }
  onMediaAttaching(n, i) {
    const o = this.hls.config;
    if (o.capLevelOnFPSDrop) {
      const l = i.media instanceof self.HTMLVideoElement ? i.media : null;
      ((this.media = l),
        l && typeof l.getVideoPlaybackQuality == "function" && (this.isVideoPlaybackQualityAvailable = !0),
        self.clearInterval(this.timer),
        (this.timer = self.setInterval(this.checkFPSInterval.bind(this), o.fpsDroppedMonitoringPeriod)));
    }
  }
  onMediaDetaching() {
    this.media = null;
  }
  checkFPS(n, i, o) {
    const l = performance.now();
    if (i) {
      if (this.lastTime) {
        const h = l - this.lastTime,
          p = o - this.lastDroppedFrames,
          d = i - this.lastDecodedFrames,
          y = (1e3 * p) / h,
          v = this.hls;
        if (
          (v.trigger(F.FPS_DROP, { currentDropped: p, currentDecoded: d, totalDroppedFrames: o }),
          y > 0 && p > v.config.fpsDroppedMonitoringThreshold * d)
        ) {
          let T = v.currentLevel;
          (v.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: " + T),
            T > 0 &&
              (v.autoLevelCapping === -1 || v.autoLevelCapping >= T) &&
              ((T = T - 1),
              v.trigger(F.FPS_DROP_LEVEL_CAPPING, { level: T, droppedLevel: v.currentLevel }),
              (v.autoLevelCapping = T),
              this.streamController.nextLevelSwitch()));
        }
      }
      ((this.lastTime = l), (this.lastDroppedFrames = o), (this.lastDecodedFrames = i));
    }
  }
  checkFPSInterval() {
    const n = this.media;
    if (n)
      if (this.isVideoPlaybackQualityAvailable) {
        const i = n.getVideoPlaybackQuality();
        this.checkFPS(n, i.totalVideoFrames, i.droppedVideoFrames);
      } else this.checkFPS(n, n.webkitDecodedFrameCount, n.webkitDroppedFrameCount);
  }
}
function UM(u, n) {
  let i;
  try {
    i = new Event("addtrack");
  } catch (o) {
    ((i = document.createEvent("Event")), i.initEvent("addtrack", !1, !1));
  }
  ((i.track = u), n.dispatchEvent(i));
}
function BM(u, n) {
  const i = u.mode;
  if ((i === "disabled" && (u.mode = "hidden"), u.cues && !u.cues.getCueById(n.id)))
    try {
      if ((u.addCue(n), !u.cues.getCueById(n.id))) throw new Error("addCue is failed for: ".concat(n));
    } catch (o) {
      Zt.debug("[texttrack-utils]: ".concat(o));
      try {
        const l = new self.TextTrackCue(n.startTime, n.endTime, n.text);
        ((l.id = n.id), u.addCue(l));
      } catch (l) {
        Zt.debug("[texttrack-utils]: Legacy TextTrackCue fallback failed: ".concat(l));
      }
    }
  i === "disabled" && (u.mode = i);
}
function tu(u, n) {
  const i = u.mode;
  if ((i === "disabled" && (u.mode = "hidden"), u.cues))
    for (let o = u.cues.length; o--; )
      (n && u.cues[o].removeEventListener("enter", n), u.removeCue(u.cues[o]));
  i === "disabled" && (u.mode = i);
}
function BT(u, n, i, o) {
  const l = u.mode;
  if ((l === "disabled" && (u.mode = "hidden"), u.cues && u.cues.length > 0)) {
    const h = UW(u.cues, n, i);
    for (let p = 0; p < h.length; p++) (!o || o(h[p])) && u.removeCue(h[p]);
  }
  l === "disabled" && (u.mode = l);
}
function FW(u, n) {
  if (n <= u[0].startTime) return 0;
  const i = u.length - 1;
  if (n > u[i].endTime) return -1;
  let o = 0,
    l = i,
    h;
  for (; o <= l; )
    if (((h = Math.floor((l + o) / 2)), n < u[h].startTime)) l = h - 1;
    else if (n > u[h].startTime && o < i) o = h + 1;
    else return h;
  return u[o].startTime - n < n - u[l].startTime ? o : l;
}
function UW(u, n, i) {
  const o = [],
    l = FW(u, n);
  if (l > -1)
    for (let h = l, p = u.length; h < p; h++) {
      const d = u[h];
      if (d.startTime >= n && d.endTime <= i) o.push(d);
      else if (d.startTime > i) return o;
    }
  return o;
}
function xg(u) {
  const n = [];
  for (let i = 0; i < u.length; i++) {
    const o = u[i];
    (o.kind === "subtitles" || o.kind === "captions") && o.label && n.push(u[i]);
  }
  return n;
}
class BW extends wS {
  constructor(n) {
    (super(n, "subtitle-track-controller"),
      (this.media = null),
      (this.tracks = []),
      (this.groupIds = null),
      (this.tracksInGroup = []),
      (this.trackId = -1),
      (this.currentTrack = null),
      (this.selectDefaultTrack = !0),
      (this.queuedDefaultTrack = -1),
      (this.useTextTrackPolling = !1),
      (this.subtitlePollingInterval = -1),
      (this._subtitleDisplay = !0),
      (this.asyncPollTrackChange = () => this.pollTrackChange(0)),
      (this.onTextTracksChanged = () => {
        if (
          (this.useTextTrackPolling || self.clearInterval(this.subtitlePollingInterval),
          !this.media || !this.hls.config.renderTextTracksNatively)
        )
          return;
        let i = null;
        const o = xg(this.media.textTracks);
        for (let h = 0; h < o.length; h++)
          if (o[h].mode === "hidden") i = o[h];
          else if (o[h].mode === "showing") {
            i = o[h];
            break;
          }
        const l = this.findTrackForTextTrack(i);
        this.subtitleTrack !== l && this.setSubtitleTrack(l);
      }),
      this.registerListeners());
  }
  destroy() {
    (this.unregisterListeners(),
      (this.tracks.length = 0),
      (this.tracksInGroup.length = 0),
      (this.currentTrack = null),
      (this.onTextTracksChanged = this.asyncPollTrackChange = null),
      super.destroy());
  }
  get subtitleDisplay() {
    return this._subtitleDisplay;
  }
  set subtitleDisplay(n) {
    ((this._subtitleDisplay = n), this.trackId > -1 && this.toggleTrackModes());
  }
  registerListeners() {
    const { hls: n } = this;
    (n.on(F.MEDIA_ATTACHED, this.onMediaAttached, this),
      n.on(F.MEDIA_DETACHING, this.onMediaDetaching, this),
      n.on(F.MANIFEST_LOADING, this.onManifestLoading, this),
      n.on(F.MANIFEST_PARSED, this.onManifestParsed, this),
      n.on(F.LEVEL_LOADING, this.onLevelLoading, this),
      n.on(F.LEVEL_SWITCHING, this.onLevelSwitching, this),
      n.on(F.SUBTITLE_TRACK_LOADED, this.onSubtitleTrackLoaded, this),
      n.on(F.ERROR, this.onError, this));
  }
  unregisterListeners() {
    const { hls: n } = this;
    (n.off(F.MEDIA_ATTACHED, this.onMediaAttached, this),
      n.off(F.MEDIA_DETACHING, this.onMediaDetaching, this),
      n.off(F.MANIFEST_LOADING, this.onManifestLoading, this),
      n.off(F.MANIFEST_PARSED, this.onManifestParsed, this),
      n.off(F.LEVEL_LOADING, this.onLevelLoading, this),
      n.off(F.LEVEL_SWITCHING, this.onLevelSwitching, this),
      n.off(F.SUBTITLE_TRACK_LOADED, this.onSubtitleTrackLoaded, this),
      n.off(F.ERROR, this.onError, this));
  }
  onMediaAttached(n, i) {
    ((this.media = i.media),
      this.media &&
        (this.queuedDefaultTrack > -1 &&
          ((this.subtitleTrack = this.queuedDefaultTrack), (this.queuedDefaultTrack = -1)),
        (this.useTextTrackPolling = !(this.media.textTracks && "onchange" in this.media.textTracks)),
        this.useTextTrackPolling
          ? this.pollTrackChange(500)
          : this.media.textTracks.addEventListener("change", this.asyncPollTrackChange)));
  }
  pollTrackChange(n) {
    (self.clearInterval(this.subtitlePollingInterval),
      (this.subtitlePollingInterval = self.setInterval(this.onTextTracksChanged, n)));
  }
  onMediaDetaching(n, i) {
    const o = this.media;
    if (!o) return;
    const l = !!i.transferMedia;
    if (
      (self.clearInterval(this.subtitlePollingInterval),
      this.useTextTrackPolling || o.textTracks.removeEventListener("change", this.asyncPollTrackChange),
      this.trackId > -1 && (this.queuedDefaultTrack = this.trackId),
      (this.subtitleTrack = -1),
      (this.media = null),
      l)
    )
      return;
    xg(o.textTracks).forEach(p => {
      tu(p);
    });
  }
  onManifestLoading() {
    ((this.tracks = []),
      (this.groupIds = null),
      (this.tracksInGroup = []),
      (this.trackId = -1),
      (this.currentTrack = null),
      (this.selectDefaultTrack = !0));
  }
  onManifestParsed(n, i) {
    this.tracks = i.subtitleTracks;
  }
  onSubtitleTrackLoaded(n, i) {
    const { id: o, groupId: l, details: h } = i,
      p = this.tracksInGroup[o];
    if (!p || p.groupId !== l) {
      this.warn(
        "Subtitle track with id:"
          .concat(o, " and group:")
          .concat(l, " not found in active group ")
          .concat(p == null ? void 0 : p.groupId),
      );
      return;
    }
    const d = p.details;
    ((p.details = i.details),
      this.log(
        "Subtitle track "
          .concat(o, ' "')
          .concat(p.name, '" lang:')
          .concat(p.lang, " group:")
          .concat(l, " loaded [")
          .concat(h.startSN, "-")
          .concat(h.endSN, "]"),
      ),
      o === this.trackId && this.playlistLoaded(o, i, d));
  }
  onLevelLoading(n, i) {
    this.switchLevel(i.level);
  }
  onLevelSwitching(n, i) {
    this.switchLevel(i.level);
  }
  switchLevel(n) {
    const i = this.hls.levels[n];
    if (!i) return;
    const o = i.subtitleGroups || null,
      l = this.groupIds;
    let h = this.currentTrack;
    if (
      !o ||
      (l == null ? void 0 : l.length) !== (o == null ? void 0 : o.length) ||
      (o != null && o.some(p => (l == null ? void 0 : l.indexOf(p)) === -1))
    ) {
      ((this.groupIds = o), (this.trackId = -1), (this.currentTrack = null));
      const p = this.tracks.filter(T => !o || o.indexOf(T.groupId) !== -1);
      if (p.length)
        (this.selectDefaultTrack && !p.some(T => T.default) && (this.selectDefaultTrack = !1),
          p.forEach((T, S) => {
            T.id = S;
          }));
      else if (!h && !this.tracksInGroup.length) return;
      this.tracksInGroup = p;
      const d = this.hls.config.subtitlePreference;
      if (!h && d) {
        this.selectDefaultTrack = !1;
        const T = ls(d, p);
        if (T > -1) h = p[T];
        else {
          const S = ls(d, this.tracks);
          h = this.tracks[S];
        }
      }
      let y = this.findTrackId(h);
      y === -1 && h && (y = this.findTrackId(null));
      const v = { subtitleTracks: p };
      (this.log(
        "Updating subtitle tracks, "
          .concat(p.length, ' track(s) found in "')
          .concat(o == null ? void 0 : o.join(","), '" group-id'),
      ),
        this.hls.trigger(F.SUBTITLE_TRACKS_UPDATED, v),
        y !== -1 && this.trackId === -1 && this.setSubtitleTrack(y));
    }
  }
  findTrackId(n) {
    const i = this.tracksInGroup,
      o = this.selectDefaultTrack;
    for (let l = 0; l < i.length; l++) {
      const h = i[l];
      if (!((o && !h.default) || (!o && !n)) && (!n || Ta(h, n))) return l;
    }
    if (n) {
      for (let l = 0; l < i.length; l++) {
        const h = i[l];
        if (kd(n.attrs, h.attrs, ["LANGUAGE", "ASSOC-LANGUAGE", "CHARACTERISTICS"])) return l;
      }
      for (let l = 0; l < i.length; l++) {
        const h = i[l];
        if (kd(n.attrs, h.attrs, ["LANGUAGE"])) return l;
      }
    }
    return -1;
  }
  findTrackForTextTrack(n) {
    if (n) {
      const i = this.tracksInGroup;
      for (let o = 0; o < i.length; o++) {
        const l = i[o];
        if (OT(l, n)) return o;
      }
    }
    return -1;
  }
  onError(n, i) {
    i.fatal ||
      !i.context ||
      (i.context.type === Ot.SUBTITLE_TRACK &&
        i.context.id === this.trackId &&
        (!this.groupIds || this.groupIds.indexOf(i.context.groupId) !== -1) &&
        this.checkRetry(i));
  }
  get allSubtitleTracks() {
    return this.tracks;
  }
  get subtitleTracks() {
    return this.tracksInGroup;
  }
  get subtitleTrack() {
    return this.trackId;
  }
  set subtitleTrack(n) {
    ((this.selectDefaultTrack = !1), this.setSubtitleTrack(n));
  }
  setSubtitleOption(n) {
    if (((this.hls.config.subtitlePreference = n), n)) {
      if (n.id === -1) return (this.setSubtitleTrack(-1), null);
      const i = this.allSubtitleTracks;
      if (((this.selectDefaultTrack = !1), i.length)) {
        const o = this.currentTrack;
        if (o && Ta(n, o)) return o;
        const l = ls(n, this.tracksInGroup);
        if (l > -1) {
          const h = this.tracksInGroup[l];
          return (this.setSubtitleTrack(l), h);
        } else {
          if (o) return null;
          {
            const h = ls(n, i);
            if (h > -1) return i[h];
          }
        }
      }
    }
    return null;
  }
  loadPlaylist(n) {
    (super.loadPlaylist(),
      this.shouldLoadPlaylist(this.currentTrack) && this.scheduleLoading(this.currentTrack, n));
  }
  loadingPlaylist(n, i) {
    super.loadingPlaylist(n, i);
    const o = n.id,
      l = n.groupId,
      h = this.getUrlWithDirectives(n.url, i),
      p = n.details,
      d = p == null ? void 0 : p.age;
    (this.log(
      "Loading subtitle "
        .concat(o, ' "')
        .concat(n.name, '" lang:')
        .concat(n.lang, " group:")
        .concat(l)
        .concat((i == null ? void 0 : i.msn) !== void 0 ? " at sn " + i.msn + " part " + i.part : "")
        .concat(d && p.live ? " age " + d.toFixed(1) + ((p.type && " " + p.type) || "") : "", " ")
        .concat(h),
    ),
      this.hls.trigger(F.SUBTITLE_TRACK_LOADING, {
        url: h,
        id: o,
        groupId: l,
        deliveryDirectives: i || null,
        track: n,
      }));
  }
  toggleTrackModes() {
    const { media: n } = this;
    if (!n) return;
    const i = xg(n.textTracks),
      o = this.currentTrack;
    let l;
    if (
      (o &&
        ((l = i.filter(h => OT(o, h))[0]),
        l ||
          this.warn(
            'Unable to find subtitle TextTrack with name "'
              .concat(o.name, '" and language "')
              .concat(o.lang, '"'),
          )),
      [].slice.call(i).forEach(h => {
        h.mode !== "disabled" && h !== l && (h.mode = "disabled");
      }),
      l)
    ) {
      const h = this.subtitleDisplay ? "showing" : "hidden";
      l.mode !== h && (l.mode = h);
    }
  }
  setSubtitleTrack(n) {
    const i = this.tracksInGroup;
    if (!this.media) {
      this.queuedDefaultTrack = n;
      return;
    }
    if (n < -1 || n >= i.length || !Ue(n)) {
      this.warn("Invalid subtitle track id: ".concat(n));
      return;
    }
    this.selectDefaultTrack = !1;
    const o = this.currentTrack,
      l = i[n] || null;
    if (((this.trackId = n), (this.currentTrack = l), this.toggleTrackModes(), !l)) {
      this.hls.trigger(F.SUBTITLE_TRACK_SWITCH, { id: n });
      return;
    }
    const h = !!l.details && !l.details.live;
    if (n === this.trackId && l === o && h) return;
    this.log(
      "Switching to subtitle-track ".concat(n) +
        (l ? ' "'.concat(l.name, '" lang:').concat(l.lang, " group:").concat(l.groupId) : ""),
    );
    const { id: p, groupId: d = "", name: y, type: v, url: T } = l;
    this.hls.trigger(F.SUBTITLE_TRACK_SWITCH, { id: p, groupId: d, name: y, type: v, url: T });
    const S = this.switchParams(l.url, o == null ? void 0 : o.details, l.details);
    this.loadPlaylist(S);
  }
}
function $W() {
  try {
    return crypto.randomUUID();
  } catch (u) {
    try {
      const n = URL.createObjectURL(new Blob()),
        i = n.toString();
      return (URL.revokeObjectURL(n), i.slice(i.lastIndexOf("/") + 1));
    } catch (n) {
      let i = new Date().getTime();
      return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, l => {
        const h = ((i + Math.random() * 16) % 16) | 0;
        return ((i = Math.floor(i / 16)), (l == "x" ? h : (h & 3) | 8).toString(16));
      });
    }
  }
}
function fd(u) {
  let n = 5381,
    i = u.length;
  for (; i; ) n = (n * 33) ^ u.charCodeAt(--i);
  return (n >>> 0).toString();
}
const lu = 0.025;
let Kg = (function (u) {
  return ((u[(u.Point = 0)] = "Point"), (u[(u.Range = 1)] = "Range"), u);
})({});
function GW(u, n, i) {
  return ""
    .concat(u.identifier, "-")
    .concat(i + 1, "-")
    .concat(fd(n));
}
class jW {
  constructor(n, i) {
    ((this.base = void 0),
      (this._duration = null),
      (this._timelineStart = null),
      (this.appendInPlaceDisabled = void 0),
      (this.appendInPlaceStarted = void 0),
      (this.dateRange = void 0),
      (this.hasPlayed = !1),
      (this.cumulativeDuration = 0),
      (this.resumeOffset = NaN),
      (this.playoutLimit = NaN),
      (this.restrictions = { skip: !1, jump: !1 }),
      (this.snapOptions = { out: !1, in: !1 }),
      (this.assetList = []),
      (this.assetListLoader = void 0),
      (this.assetListResponse = null),
      (this.resumeAnchor = void 0),
      (this.error = void 0),
      (this.resetOnResume = void 0),
      (this.base = i),
      (this.dateRange = n),
      this.setDateRange(n));
  }
  setDateRange(n) {
    ((this.dateRange = n),
      (this.resumeOffset = n.attr.optionalFloat("X-RESUME-OFFSET", this.resumeOffset)),
      (this.playoutLimit = n.attr.optionalFloat("X-PLAYOUT-LIMIT", this.playoutLimit)),
      (this.restrictions = n.attr.enumeratedStringList("X-RESTRICT", this.restrictions)),
      (this.snapOptions = n.attr.enumeratedStringList("X-SNAP", this.snapOptions)));
  }
  reset() {
    var n;
    ((this.appendInPlaceStarted = !1),
      (n = this.assetListLoader) == null || n.destroy(),
      (this.assetListLoader = void 0),
      this.supplementsPrimary ||
        ((this.assetListResponse = null), (this.assetList = []), (this._duration = null)));
  }
  isAssetPastPlayoutLimit(n) {
    var i;
    if (n > 0 && n >= this.assetList.length) return !0;
    const o = this.playoutLimit;
    return n <= 0 || isNaN(o)
      ? !1
      : o === 0
        ? !0
        : (((i = this.assetList[n]) == null ? void 0 : i.startOffset) || 0) > o;
  }
  findAssetIndex(n) {
    return this.assetList.indexOf(n);
  }
  get identifier() {
    return this.dateRange.id;
  }
  get startDate() {
    return this.dateRange.startDate;
  }
  get startTime() {
    const n = this.dateRange.startTime;
    if (this.snapOptions.out) {
      const i = this.dateRange.tagAnchor;
      if (i) return Bx(n, i);
    }
    return n;
  }
  get startOffset() {
    return this.cue.pre ? 0 : this.startTime;
  }
  get startIsAligned() {
    if (this.startTime === 0 || this.snapOptions.out) return !0;
    const n = this.dateRange.tagAnchor;
    if (n) {
      const i = this.dateRange.startTime,
        o = Bx(i, n);
      return i - o < 0.1;
    }
    return !1;
  }
  get resumptionOffset() {
    const n = this.resumeOffset,
      i = Ue(n) ? n : this.duration;
    return this.cumulativeDuration + i;
  }
  get resumeTime() {
    const n = this.startOffset + this.resumptionOffset;
    if (this.snapOptions.in) {
      const i = this.resumeAnchor;
      if (i) return Bx(n, i);
    }
    return n;
  }
  get appendInPlace() {
    return this.appendInPlaceStarted
      ? !0
      : this.appendInPlaceDisabled
        ? !1
        : !!(
            !this.cue.once &&
            !this.cue.pre &&
            this.startIsAligned &&
            ((isNaN(this.playoutLimit) && isNaN(this.resumeOffset)) ||
              (this.resumeOffset && this.duration && Math.abs(this.resumeOffset - this.duration) < lu))
          );
  }
  set appendInPlace(n) {
    if (this.appendInPlaceStarted) {
      this.resetOnResume = !n;
      return;
    }
    this.appendInPlaceDisabled = !n;
  }
  get timelineStart() {
    return this._timelineStart !== null ? this._timelineStart : this.startTime;
  }
  set timelineStart(n) {
    this._timelineStart = n;
  }
  get duration() {
    const n = this.playoutLimit;
    let i;
    return (
      this._duration !== null
        ? (i = this._duration)
        : this.dateRange.duration
          ? (i = this.dateRange.duration)
          : (i = this.dateRange.plannedDuration || 0),
      !isNaN(n) && n < i && (i = n),
      i
    );
  }
  set duration(n) {
    this._duration = n;
  }
  get cue() {
    return this.dateRange.cue;
  }
  get timelineOccupancy() {
    return this.dateRange.attr["X-TIMELINE-OCCUPIES"] === "RANGE" ? Kg.Range : Kg.Point;
  }
  get supplementsPrimary() {
    return this.dateRange.attr["X-TIMELINE-STYLE"] === "PRIMARY";
  }
  get contentMayVary() {
    return this.dateRange.attr["X-CONTENT-MAY-VARY"] !== "NO";
  }
  get assetUrl() {
    return this.dateRange.attr["X-ASSET-URI"];
  }
  get assetListUrl() {
    return this.dateRange.attr["X-ASSET-LIST"];
  }
  get baseUrl() {
    return this.base.url;
  }
  get assetListLoaded() {
    return this.assetList.length > 0 || this.assetListResponse !== null;
  }
  toString() {
    return VW(this);
  }
}
function Bx(u, n) {
  return u - n.start < n.duration / 2 && !(Math.abs(u - (n.start + n.duration)) < lu)
    ? n.start
    : n.start + n.duration;
}
function $M(u, n, i) {
  const o = new self.URL(u, i);
  return (o.protocol !== "data:" && o.searchParams.set("_HLS_primary_id", n), o);
}
function $x(u, n) {
  for (; (i = u.assetList[++n]) != null && i.error; ) var i;
  return n;
}
function VW(u) {
  return '["'
    .concat(u.identifier, '" ')
    .concat(u.cue.pre ? "<pre>" : u.cue.post ? "<post>" : "")
    .concat(u.timelineStart.toFixed(2), "-")
    .concat(u.resumeTime.toFixed(2), "]");
}
function Ql(u) {
  const n = u.timelineStart,
    i = u.duration || 0;
  return '["'
    .concat(u.identifier, '" ')
    .concat(n.toFixed(2), "-")
    .concat((n + i).toFixed(2), "]");
}
class HW {
  constructor(n, i, o, l) {
    ((this.hls = void 0),
      (this.interstitial = void 0),
      (this.assetItem = void 0),
      (this.tracks = null),
      (this.hasDetails = !1),
      (this.mediaAttached = null),
      (this._currentTime = void 0),
      (this._bufferedEosTime = void 0),
      (this.checkPlayout = () => {
        this.reachedPlayout(this.currentTime) && this.hls && this.hls.trigger(F.PLAYOUT_LIMIT_REACHED, {});
      }));
    const h = (this.hls = new n(i));
    ((this.interstitial = o), (this.assetItem = l));
    const p = () => {
      this.hasDetails = !0;
    };
    (h.once(F.LEVEL_LOADED, p),
      h.once(F.AUDIO_TRACK_LOADED, p),
      h.once(F.SUBTITLE_TRACK_LOADED, p),
      h.on(F.MEDIA_ATTACHING, (d, { media: y }) => {
        (this.removeMediaListeners(),
          (this.mediaAttached = y),
          this.interstitial.playoutLimit &&
            (y.addEventListener("timeupdate", this.checkPlayout),
            this.appendInPlace &&
              h.on(F.BUFFER_APPENDED, () => {
                const T = this.bufferedEnd;
                this.reachedPlayout(T) && ((this._bufferedEosTime = T), h.trigger(F.BUFFERED_TO_END, void 0));
              })));
      }));
  }
  get appendInPlace() {
    return this.interstitial.appendInPlace;
  }
  loadSource() {
    const n = this.hls;
    if (n)
      if (n.url) n.levels.length && !n.started && n.startLoad(-1, !0);
      else {
        let i = this.assetItem.uri;
        try {
          i = $M(i, n.config.primarySessionId || "").href;
        } catch (o) {}
        n.loadSource(i);
      }
  }
  bufferedInPlaceToEnd(n) {
    var i;
    if (!this.appendInPlace) return !1;
    if ((i = this.hls) != null && i.bufferedToEnd) return !0;
    if (!n) return !1;
    const o = Math.min(this._bufferedEosTime || 1 / 0, this.duration),
      l = this.timelineOffset,
      h = Tt.bufferInfo(n, l, 0);
    return this.getAssetTime(h.end) >= o - 0.02;
  }
  reachedPlayout(n) {
    const o = this.interstitial.playoutLimit;
    return this.startOffset + n >= o;
  }
  get destroyed() {
    var n;
    return !((n = this.hls) != null && n.userConfig);
  }
  get assetId() {
    return this.assetItem.identifier;
  }
  get interstitialId() {
    return this.assetItem.parentIdentifier;
  }
  get media() {
    var n;
    return ((n = this.hls) == null ? void 0 : n.media) || null;
  }
  get bufferedEnd() {
    const n = this.media || this.mediaAttached;
    if (!n) return this._bufferedEosTime ? this._bufferedEosTime : this.currentTime;
    const i = Tt.bufferInfo(n, n.currentTime, 0.001);
    return this.getAssetTime(i.end);
  }
  get currentTime() {
    const n = this.media || this.mediaAttached;
    return n ? this.getAssetTime(n.currentTime) : this._currentTime || 0;
  }
  get duration() {
    const n = this.assetItem.duration;
    if (!n) return 0;
    const i = this.interstitial.playoutLimit;
    if (i) {
      const o = i - this.startOffset;
      if (o > 0 && o < n) return o;
    }
    return n;
  }
  get remaining() {
    const n = this.duration;
    return n ? Math.max(0, n - this.currentTime) : 0;
  }
  get startOffset() {
    return this.assetItem.startOffset;
  }
  get timelineOffset() {
    var n;
    return ((n = this.hls) == null ? void 0 : n.config.timelineOffset) || 0;
  }
  set timelineOffset(n) {
    const i = this.timelineOffset;
    if (n !== i) {
      const o = n - i;
      if (Math.abs(o) > 1 / 9e4 && this.hls) {
        if (this.hasDetails) throw new Error("Cannot set timelineOffset after playlists are loaded");
        this.hls.config.timelineOffset = n;
      }
    }
  }
  getAssetTime(n) {
    const i = this.timelineOffset,
      o = this.duration;
    return Math.min(Math.max(0, n - i), o);
  }
  removeMediaListeners() {
    const n = this.mediaAttached;
    n &&
      ((this._currentTime = n.currentTime),
      this.bufferSnapShot(),
      n.removeEventListener("timeupdate", this.checkPlayout));
  }
  bufferSnapShot() {
    if (this.mediaAttached) {
      var n;
      (n = this.hls) != null && n.bufferedToEnd && (this._bufferedEosTime = this.bufferedEnd);
    }
  }
  destroy() {
    (this.removeMediaListeners(),
      this.hls && this.hls.destroy(),
      (this.hls = null),
      (this.tracks = this.mediaAttached = this.checkPlayout = null));
  }
  attachMedia(n) {
    var i;
    (this.loadSource(), (i = this.hls) == null || i.attachMedia(n));
  }
  detachMedia() {
    var n;
    (this.removeMediaListeners(), (this.mediaAttached = null), (n = this.hls) == null || n.detachMedia());
  }
  resumeBuffering() {
    var n;
    (n = this.hls) == null || n.resumeBuffering();
  }
  pauseBuffering() {
    var n;
    (n = this.hls) == null || n.pauseBuffering();
  }
  transferMedia() {
    var n;
    return (this.bufferSnapShot(), ((n = this.hls) == null ? void 0 : n.transferMedia()) || null);
  }
  resetDetails() {
    const n = this.hls;
    if (n && this.hasDetails) {
      n.stopLoad();
      const i = o => delete o.details;
      (n.levels.forEach(i),
        n.allAudioTracks.forEach(i),
        n.allSubtitleTracks.forEach(i),
        (this.hasDetails = !1));
    }
  }
  on(n, i, o) {
    var l;
    (l = this.hls) == null || l.on(n, i);
  }
  once(n, i, o) {
    var l;
    (l = this.hls) == null || l.once(n, i);
  }
  off(n, i, o) {
    var l;
    (l = this.hls) == null || l.off(n, i);
  }
  toString() {
    var n;
    return "HlsAssetPlayer: "
      .concat(Ql(this.assetItem), " ")
      .concat((n = this.hls) == null ? void 0 : n.sessionId, " ")
      .concat(this.appendInPlace ? "append-in-place" : "");
  }
}
const Fb = 0.033;
class KW extends Pr {
  constructor(n, i) {
    (super("interstitials-sched", i),
      (this.onScheduleUpdate = void 0),
      (this.eventMap = {}),
      (this.events = null),
      (this.items = null),
      (this.durations = { primary: 0, playout: 0, integrated: 0 }),
      (this.onScheduleUpdate = n));
  }
  destroy() {
    (this.reset(), (this.onScheduleUpdate = null));
  }
  reset() {
    ((this.eventMap = {}),
      this.setDurations(0, 0, 0),
      this.events && this.events.forEach(n => n.reset()),
      (this.events = this.items = null));
  }
  resetErrorsInRange(n, i) {
    return this.events
      ? this.events.reduce(
          (o, l) => (n <= l.startOffset && i > l.startOffset ? (delete l.error, o + 1) : o),
          0,
        )
      : 0;
  }
  get duration() {
    const n = this.items;
    return n ? n[n.length - 1].end : 0;
  }
  get length() {
    return this.items ? this.items.length : 0;
  }
  getEvent(n) {
    return (n && this.eventMap[n]) || null;
  }
  hasEvent(n) {
    return n in this.eventMap;
  }
  findItemIndex(n, i) {
    if (n.event) return this.findEventIndex(n.event.identifier);
    let o = -1;
    n.nextEvent
      ? (o = this.findEventIndex(n.nextEvent.identifier) - 1)
      : n.previousEvent && (o = this.findEventIndex(n.previousEvent.identifier) + 1);
    const l = this.items;
    if (l)
      for (
        l[o] || (i === void 0 && (i = n.start), (o = this.findItemIndexAtTime(i)));
        o >= 0 && (h = l[o]) != null && h.event;
      ) {
        var h;
        o--;
      }
    return o;
  }
  findItemIndexAtTime(n, i) {
    const o = this.items;
    if (o)
      for (let l = 0; l < o.length; l++) {
        let h = o[l];
        if ((i && i !== "primary" && (h = h[i]), n === h.start || (n > h.start && n < h.end))) return l;
      }
    return -1;
  }
  findJumpRestrictedIndex(n, i) {
    const o = this.items;
    if (o)
      for (let l = n; l <= i && o[l]; l++) {
        const h = o[l].event;
        if (h != null && h.restrictions.jump && !h.appendInPlace) return l;
      }
    return -1;
  }
  findEventIndex(n) {
    const i = this.items;
    if (i)
      for (let l = i.length; l--; ) {
        var o;
        if (((o = i[l].event) == null ? void 0 : o.identifier) === n) return l;
      }
    return -1;
  }
  findAssetIndex(n, i) {
    const o = n.assetList,
      l = o.length;
    if (l > 1)
      for (let h = 0; h < l; h++) {
        const p = o[h];
        if (!p.error) {
          const d = p.timelineStart;
          if (i === d || (i > d && (i < d + (p.duration || 0) || h === l - 1))) return h;
        }
      }
    return 0;
  }
  get assetIdAtEnd() {
    var n;
    const i = (n = this.items) == null || (n = n[this.length - 1]) == null ? void 0 : n.event;
    if (i) {
      const o = i.assetList,
        l = o[o.length - 1];
      if (l) return l.identifier;
    }
    return null;
  }
  parseInterstitialDateRanges(n, i) {
    const o = n.main.details,
      { dateRanges: l } = o,
      h = this.events,
      p = this.parseDateRanges(l, { url: o.url }, i),
      d = Object.keys(l),
      y = h ? h.filter(v => !d.includes(v.identifier)) : [];
    (p.length &&
      p.sort((v, T) => {
        const S = v.cue.pre,
          w = v.cue.post,
          C = T.cue.pre,
          L = T.cue.post;
        if (S && !C) return -1;
        if ((C && !S) || (w && !L)) return 1;
        if (L && !w) return -1;
        if (!S && !C && !w && !L) {
          const k = v.startTime,
            O = T.startTime;
          if (k !== O) return k - O;
        }
        return v.dateRange.tagOrder - T.dateRange.tagOrder;
      }),
      (this.events = p),
      y.forEach(v => {
        this.removeEvent(v);
      }),
      this.updateSchedule(n, y));
  }
  updateSchedule(n, i = [], o = !1) {
    const l = this.events || [];
    if (l.length || i.length || this.length < 2) {
      const h = this.items,
        p = this.parseSchedule(l, n);
      (o ||
        i.length ||
        (h == null ? void 0 : h.length) !== p.length ||
        p.some(
          (y, v) =>
            Math.abs(y.playout.start - h[v].playout.start) > 0.005 ||
            Math.abs(y.playout.end - h[v].playout.end) > 0.005,
        )) &&
        ((this.items = p), this.onScheduleUpdate(i, h));
    }
  }
  parseDateRanges(n, i, o) {
    const l = [],
      h = Object.keys(n);
    for (let p = 0; p < h.length; p++) {
      const d = h[p],
        y = n[d];
      if (y.isInterstitial) {
        let v = this.eventMap[d];
        (v
          ? v.setDateRange(y)
          : ((v = new jW(y, i)), (this.eventMap[d] = v), o === !1 && (v.appendInPlace = o)),
          l.push(v));
      }
    }
    return l;
  }
  parseSchedule(n, i) {
    const o = [],
      l = i.main.details,
      h = l.live ? 1 / 0 : l.edge;
    let p = 0;
    if (((n = n.filter(y => !y.error && !(y.cue.once && y.hasPlayed))), n.length)) {
      this.resolveOffsets(n, i);
      let y = 0,
        v = 0;
      if (
        (n.forEach((T, S) => {
          const w = T.cue.pre,
            C = T.cue.post,
            L = n[S - 1] || null,
            k = T.appendInPlace,
            O = C ? h : T.startOffset,
            B = T.duration,
            N = T.timelineOccupancy === Kg.Range ? B : 0,
            $ = T.resumptionOffset,
            I = (L == null ? void 0 : L.startTime) === O,
            V = O + T.cumulativeDuration;
          let oe = k ? V + B : O + $;
          if (w || (!C && O <= 0)) {
            const te = v;
            ((v += N), (T.timelineStart = V));
            const _ = p;
            ((p += B),
              o.push({
                event: T,
                start: V,
                end: oe,
                playout: { start: _, end: p },
                integrated: { start: te, end: v },
              }));
          } else if (O <= h) {
            if (!I) {
              const K = O - y;
              if (K > Fb) {
                const q = y,
                  ce = v;
                v += K;
                const he = p;
                p += K;
                const ae = {
                  previousEvent: n[S - 1] || null,
                  nextEvent: T,
                  start: q,
                  end: q + K,
                  playout: { start: he, end: p },
                  integrated: { start: ce, end: v },
                };
                o.push(ae);
              } else K > 0 && L && ((L.cumulativeDuration += K), (o[o.length - 1].end = O));
            }
            (C && (oe = V), (T.timelineStart = V));
            const te = v;
            v += N;
            const _ = p;
            ((p += B),
              o.push({
                event: T,
                start: V,
                end: oe,
                playout: { start: _, end: p },
                integrated: { start: te, end: v },
              }));
          } else return;
          const Y = T.resumeTime;
          C || Y > h ? (y = h) : (y = Y);
        }),
        y < h)
      ) {
        var d;
        const T = y,
          S = v,
          w = h - y;
        v += w;
        const C = p;
        ((p += w),
          o.push({
            previousEvent: ((d = o[o.length - 1]) == null ? void 0 : d.event) || null,
            nextEvent: null,
            start: y,
            end: T + w,
            playout: { start: C, end: p },
            integrated: { start: S, end: v },
          }));
      }
      this.setDurations(h, p, v);
    } else
      (o.push({
        previousEvent: null,
        nextEvent: null,
        start: 0,
        end: h,
        playout: { start: 0, end: h },
        integrated: { start: 0, end: h },
      }),
        this.setDurations(h, h, h));
    return o;
  }
  setDurations(n, i, o) {
    this.durations = { primary: n, playout: i, integrated: o };
  }
  resolveOffsets(n, i) {
    const o = i.main.details,
      l = o.live ? 1 / 0 : o.edge;
    let h = 0,
      p = -1;
    n.forEach((d, y) => {
      const v = d.cue.pre,
        T = d.cue.post,
        S = v ? 0 : T ? l : d.startTime;
      (this.updateAssetDurations(d),
        p === S ? (d.cumulativeDuration = h) : ((h = 0), (p = S)),
        !T &&
          d.snapOptions.in &&
          (d.resumeAnchor = Aa(null, o.fragments, d.startOffset + d.resumptionOffset, 0, 0) || void 0),
        d.appendInPlace &&
          !d.appendInPlaceStarted &&
          (this.primaryCanResumeInPlaceAt(d, i) || (d.appendInPlace = !1)),
        !d.appendInPlace &&
          y + 1 < n.length &&
          n[y + 1].startTime - n[y].resumeTime < Fb &&
          ((n[y + 1].appendInPlace = !1),
          n[y + 1].appendInPlace &&
            this.warn("Could not change append strategy for abutting event ".concat(d))));
      const C = Ue(d.resumeOffset) ? d.resumeOffset : d.duration;
      h += C;
    });
  }
  primaryCanResumeInPlaceAt(n, i) {
    const o = n.resumeTime,
      l = n.startTime + n.resumptionOffset;
    return Math.abs(o - l) > lu
      ? (this.log(
          '"'
            .concat(n.identifier, '" resumption ')
            .concat(o, " not aligned with estimated timeline end ")
            .concat(l),
        ),
        !1)
      : !Object.keys(i).some(p => {
          const d = i[p].details,
            y = d.edge;
          if (o >= y)
            return (
              this.log(
                '"'
                  .concat(n.identifier, '" resumption ')
                  .concat(o, " past ")
                  .concat(p, " playlist end ")
                  .concat(y),
              ),
              !1
            );
          const v = Aa(null, d.fragments, o);
          if (!v)
            return (
              this.log(
                '"'
                  .concat(n.identifier, '" resumption ')
                  .concat(o, " does not align with any fragments in ")
                  .concat(p, " playlist (")
                  .concat(d.fragStart, "-")
                  .concat(d.fragmentEnd, ")"),
              ),
              !0
            );
          const T = p === "audio" ? 0.175 : 0;
          return Math.abs(v.start - o) < lu + T || Math.abs(v.end - o) < lu + T
            ? !1
            : (this.log(
                '"'
                  .concat(n.identifier, '" resumption ')
                  .concat(o, " not aligned with ")
                  .concat(p, " fragment bounds (")
                  .concat(v.start, "-")
                  .concat(v.end, " sn: ")
                  .concat(v.sn, " cc: ")
                  .concat(v.cc, ")"),
              ),
              !0);
        });
  }
  updateAssetDurations(n) {
    if (!n.assetListLoaded) return;
    const i = n.timelineStart;
    let o = 0,
      l = !1,
      h = !1;
    for (let p = 0; p < n.assetList.length; p++) {
      const d = n.assetList[p],
        y = i + o;
      ((d.startOffset = o), (d.timelineStart = y), l || (l = d.duration === null), h || (h = !!d.error));
      const v = d.error ? 0 : d.duration || 0;
      o += v;
    }
    l && !h ? (n.duration = Math.max(o, n.duration)) : (n.duration = o);
  }
  removeEvent(n) {
    (n.reset(), delete this.eventMap[n.identifier]);
  }
}
function Vr(u) {
  return "["
    .concat(u.event ? '"' + u.event.identifier + '"' : "primary", ": ")
    .concat(u.start.toFixed(2), "-")
    .concat(u.end.toFixed(2), "]");
}
class WW {
  constructor(n) {
    ((this.hls = void 0), (this.hls = n));
  }
  destroy() {
    this.hls = null;
  }
  loadAssetList(n, i) {
    const o = n.assetListUrl;
    let l;
    try {
      l = $M(o, this.hls.sessionId, n.baseUrl);
    } catch (w) {
      const C = this.assignAssetListError(n, ge.ASSET_LIST_LOAD_ERROR, w, o);
      this.hls.trigger(F.ERROR, C);
      return;
    }
    i && l.protocol !== "data:" && l.searchParams.set("_HLS_start_offset", "" + i);
    const h = this.hls.config,
      p = h.loader,
      d = new p(h),
      y = { responseType: "json", url: l.href },
      v = h.interstitialAssetListLoadPolicy.default,
      T = { loadPolicy: v, timeout: v.maxLoadTimeMs, maxRetry: 0, retryDelay: 0, maxRetryDelay: 0 },
      S = {
        onSuccess: (w, C, L, k) => {
          const O = w.data,
            B = O == null ? void 0 : O.ASSETS;
          if (!Array.isArray(B)) {
            const N = this.assignAssetListError(
              n,
              ge.ASSET_LIST_PARSING_ERROR,
              new Error("Invalid interstitial asset list"),
              L.url,
              C,
              k,
            );
            this.hls.trigger(F.ERROR, N);
            return;
          }
          ((n.assetListResponse = O),
            this.hls.trigger(F.ASSET_LIST_LOADED, { event: n, assetListResponse: O, networkDetails: k }));
        },
        onError: (w, C, L, k) => {
          const O = this.assignAssetListError(
            n,
            ge.ASSET_LIST_LOAD_ERROR,
            new Error(
              "Error loading X-ASSET-LIST: HTTP status "
                .concat(w.code, " ")
                .concat(w.text, " (")
                .concat(C.url, ")"),
            ),
            C.url,
            k,
            L,
          );
          this.hls.trigger(F.ERROR, O);
        },
        onTimeout: (w, C, L) => {
          const k = this.assignAssetListError(
            n,
            ge.ASSET_LIST_LOAD_TIMEOUT,
            new Error("Timeout loading X-ASSET-LIST (".concat(C.url, ")")),
            C.url,
            w,
            L,
          );
          this.hls.trigger(F.ERROR, k);
        },
      };
    return (d.load(y, T, S), this.hls.trigger(F.ASSET_LIST_LOADING, { event: n }), d);
  }
  assignAssetListError(n, i, o, l, h, p) {
    return (
      (n.error = o),
      {
        type: et.NETWORK_ERROR,
        details: i,
        fatal: !1,
        interstitial: n,
        url: l,
        error: o,
        networkDetails: p,
        stats: h,
      }
    );
  }
}
function Ub(u) {
  var n;
  u == null || (n = u.play()) == null || n.catch(() => {});
}
function Qp(u, n) {
  return "[".concat(u, "] Advancing timeline position to ").concat(n);
}
class zW extends Pr {
  constructor(n, i) {
    (super("interstitials", n.logger),
      (this.HlsPlayerClass = void 0),
      (this.hls = void 0),
      (this.assetListLoader = void 0),
      (this.mediaSelection = null),
      (this.altSelection = null),
      (this.media = null),
      (this.detachedData = null),
      (this.requiredTracks = null),
      (this.manager = null),
      (this.playerQueue = []),
      (this.bufferedPos = -1),
      (this.timelinePos = -1),
      (this.schedule = void 0),
      (this.playingItem = null),
      (this.bufferingItem = null),
      (this.waitingItem = null),
      (this.endedItem = null),
      (this.playingAsset = null),
      (this.endedAsset = null),
      (this.bufferingAsset = null),
      (this.shouldPlay = !1),
      (this.onPlay = () => {
        this.shouldPlay = !0;
      }),
      (this.onPause = () => {
        this.shouldPlay = !1;
      }),
      (this.onSeeking = () => {
        const o = this.currentTime;
        if (o === void 0 || this.playbackDisabled || !this.schedule) return;
        const l = o - this.timelinePos;
        if (Math.abs(l) < 1 / 7056e5) return;
        const p = l <= -0.01;
        ((this.timelinePos = o), (this.bufferedPos = o));
        const d = this.playingItem;
        if (!d) {
          this.checkBuffer();
          return;
        }
        if (
          (p && this.schedule.resetErrorsInRange(o, o - l) && this.updateSchedule(!0),
          this.checkBuffer(),
          (p && o < d.start) || o >= d.end)
        ) {
          var y;
          const C = this.findItemIndex(d);
          let L = this.schedule.findItemIndexAtTime(o);
          if (
            (L === -1 &&
              ((L = C + (p ? -1 : 1)),
              this.log(
                "seeked "
                  .concat(p ? "back " : "", "to position not covered by schedule ")
                  .concat(o, " (resolving from ")
                  .concat(C, " to ")
                  .concat(L, ")"),
              )),
            !this.isInterstitial(d) && (y = this.media) != null && y.paused && (this.shouldPlay = !1),
            !p && L > C)
          ) {
            const k = this.schedule.findJumpRestrictedIndex(C + 1, L);
            if (k > C) {
              this.setSchedulePosition(k);
              return;
            }
          }
          this.setSchedulePosition(L);
          return;
        }
        const v = this.playingAsset;
        if (!v) {
          if (this.playingLastItem && this.isInterstitial(d)) {
            const C = d.event.assetList[0];
            C &&
              ((this.endedItem = this.playingItem),
              (this.playingItem = null),
              this.setScheduleToAssetAtTime(o, C));
          }
          return;
        }
        const T = v.timelineStart,
          S = v.duration || 0;
        if ((p && o < T) || o >= T + S) {
          var w;
          ((w = d.event) != null &&
            w.appendInPlace &&
            (this.clearAssetPlayers(d.event, d), this.flushFrontBuffer(o)),
            this.setScheduleToAssetAtTime(o, v));
        }
      }),
      (this.onTimeupdate = () => {
        const o = this.currentTime;
        if (o === void 0 || this.playbackDisabled) return;
        if (o > this.timelinePos) ((this.timelinePos = o), o > this.bufferedPos && this.checkBuffer());
        else return;
        const l = this.playingItem;
        if (!l || this.playingLastItem) return;
        if (o >= l.end) {
          this.timelinePos = l.end;
          const d = this.findItemIndex(l);
          this.setSchedulePosition(d + 1);
        }
        const h = this.playingAsset;
        if (!h) return;
        const p = h.timelineStart + (h.duration || 0);
        o >= p && this.setScheduleToAssetAtTime(o, h);
      }),
      (this.onScheduleUpdate = (o, l) => {
        const h = this.schedule;
        if (!h) return;
        const p = this.playingItem,
          d = h.events || [],
          y = h.items || [],
          v = h.durations,
          T = o.map(k => k.identifier),
          S = !!(d.length || T.length);
        ((S || l) &&
          this.log(
            "INTERSTITIALS_UPDATED ("
              .concat(d.length, "): ")
              .concat(d, "\nSchedule: ")
              .concat(
                y.map(k => Vr(k)),
                " pos: ",
              )
              .concat(this.timelinePos),
          ),
          T.length && this.log("Removed events ".concat(T)));
        let w = null,
          C = null;
        (p &&
          ((w = this.updateItem(p, this.timelinePos)),
          this.itemsMatch(p, w) ? (this.playingItem = w) : (this.waitingItem = this.endedItem = null)),
          (this.waitingItem = this.updateItem(this.waitingItem)),
          (this.endedItem = this.updateItem(this.endedItem)));
        const L = this.bufferingItem;
        if (
          (L &&
            ((C = this.updateItem(L, this.bufferedPos)),
            this.itemsMatch(L, C)
              ? (this.bufferingItem = C)
              : L.event && ((this.bufferingItem = this.playingItem), this.clearInterstitial(L.event, null))),
          o.forEach(k => {
            k.assetList.forEach(O => {
              this.clearAssetPlayer(O.identifier, null);
            });
          }),
          this.playerQueue.forEach(k => {
            if (k.interstitial.appendInPlace) {
              const O = k.assetItem.timelineStart,
                B = k.timelineOffset - O;
              if (B)
                try {
                  k.timelineOffset = O;
                } catch (N) {
                  Math.abs(B) > lu &&
                    this.warn(
                      ""
                        .concat(N, ' ("')
                        .concat(k.assetId, '" ')
                        .concat(k.timelineOffset, "->")
                        .concat(O, ")"),
                    );
                }
            }
          }),
          S || l)
        ) {
          if (
            (this.hls.trigger(F.INTERSTITIALS_UPDATED, {
              events: d.slice(0),
              schedule: y.slice(0),
              durations: v,
              removedIds: T,
            }),
            this.isInterstitial(p) && T.includes(p.event.identifier))
          ) {
            (this.warn('Interstitial "'.concat(p.event.identifier, '" removed while playing')),
              this.primaryFallback(p.event));
            return;
          }
          (p && this.trimInPlace(w, p), L && C !== w && this.trimInPlace(C, L), this.checkBuffer());
        }
      }),
      (this.hls = n),
      (this.HlsPlayerClass = i),
      (this.assetListLoader = new WW(n)),
      (this.schedule = new KW(this.onScheduleUpdate, n.logger)),
      this.registerListeners());
  }
  registerListeners() {
    const n = this.hls;
    n &&
      (n.on(F.MEDIA_ATTACHING, this.onMediaAttaching, this),
      n.on(F.MEDIA_ATTACHED, this.onMediaAttached, this),
      n.on(F.MEDIA_DETACHING, this.onMediaDetaching, this),
      n.on(F.MANIFEST_LOADING, this.onManifestLoading, this),
      n.on(F.LEVEL_UPDATED, this.onLevelUpdated, this),
      n.on(F.AUDIO_TRACK_SWITCHING, this.onAudioTrackSwitching, this),
      n.on(F.AUDIO_TRACK_UPDATED, this.onAudioTrackUpdated, this),
      n.on(F.SUBTITLE_TRACK_SWITCH, this.onSubtitleTrackSwitch, this),
      n.on(F.SUBTITLE_TRACK_UPDATED, this.onSubtitleTrackUpdated, this),
      n.on(F.EVENT_CUE_ENTER, this.onInterstitialCueEnter, this),
      n.on(F.ASSET_LIST_LOADED, this.onAssetListLoaded, this),
      n.on(F.BUFFER_APPENDED, this.onBufferAppended, this),
      n.on(F.BUFFER_FLUSHED, this.onBufferFlushed, this),
      n.on(F.BUFFERED_TO_END, this.onBufferedToEnd, this),
      n.on(F.MEDIA_ENDED, this.onMediaEnded, this),
      n.on(F.ERROR, this.onError, this),
      n.on(F.DESTROYING, this.onDestroying, this));
  }
  unregisterListeners() {
    const n = this.hls;
    n &&
      (n.off(F.MEDIA_ATTACHING, this.onMediaAttaching, this),
      n.off(F.MEDIA_ATTACHED, this.onMediaAttached, this),
      n.off(F.MEDIA_DETACHING, this.onMediaDetaching, this),
      n.off(F.MANIFEST_LOADING, this.onManifestLoading, this),
      n.off(F.LEVEL_UPDATED, this.onLevelUpdated, this),
      n.off(F.AUDIO_TRACK_SWITCHING, this.onAudioTrackSwitching, this),
      n.off(F.AUDIO_TRACK_UPDATED, this.onAudioTrackUpdated, this),
      n.off(F.SUBTITLE_TRACK_SWITCH, this.onSubtitleTrackSwitch, this),
      n.off(F.SUBTITLE_TRACK_UPDATED, this.onSubtitleTrackUpdated, this),
      n.off(F.EVENT_CUE_ENTER, this.onInterstitialCueEnter, this),
      n.off(F.ASSET_LIST_LOADED, this.onAssetListLoaded, this),
      n.off(F.BUFFER_CODECS, this.onBufferCodecs, this),
      n.off(F.BUFFER_APPENDED, this.onBufferAppended, this),
      n.off(F.BUFFER_FLUSHED, this.onBufferFlushed, this),
      n.off(F.BUFFERED_TO_END, this.onBufferedToEnd, this),
      n.off(F.MEDIA_ENDED, this.onMediaEnded, this),
      n.off(F.ERROR, this.onError, this),
      n.off(F.DESTROYING, this.onDestroying, this));
  }
  startLoad() {
    this.resumeBuffering();
  }
  stopLoad() {
    this.pauseBuffering();
  }
  resumeBuffering() {
    var n;
    (n = this.getBufferingPlayer()) == null || n.resumeBuffering();
  }
  pauseBuffering() {
    var n;
    (n = this.getBufferingPlayer()) == null || n.pauseBuffering();
  }
  destroy() {
    (this.unregisterListeners(),
      this.stopLoad(),
      this.assetListLoader && this.assetListLoader.destroy(),
      this.emptyPlayerQueue(),
      this.clearScheduleState(),
      this.schedule && this.schedule.destroy(),
      (this.media =
        this.detachedData =
        this.mediaSelection =
        this.requiredTracks =
        this.altSelection =
        this.schedule =
        this.manager =
          null),
      (this.hls = this.HlsPlayerClass = this.log = null),
      (this.assetListLoader = null),
      (this.onPlay = this.onPause = this.onSeeking = this.onTimeupdate = null),
      (this.onScheduleUpdate = null));
  }
  onDestroying() {
    const n = this.primaryMedia || this.media;
    n && this.removeMediaListeners(n);
  }
  removeMediaListeners(n) {
    (tr(n, "play", this.onPlay),
      tr(n, "pause", this.onPause),
      tr(n, "seeking", this.onSeeking),
      tr(n, "timeupdate", this.onTimeupdate));
  }
  onMediaAttaching(n, i) {
    const o = (this.media = i.media);
    (ji(o, "seeking", this.onSeeking),
      ji(o, "timeupdate", this.onTimeupdate),
      ji(o, "play", this.onPlay),
      ji(o, "pause", this.onPause));
  }
  onMediaAttached(n, i) {
    const o = this.effectivePlayingItem,
      l = this.detachedData;
    if (((this.detachedData = null), o === null)) this.checkStart();
    else if (!l) {
      this.clearScheduleState();
      const h = this.findItemIndex(o);
      this.setSchedulePosition(h);
    }
  }
  clearScheduleState() {
    (this.log("clear schedule state"),
      (this.playingItem =
        this.bufferingItem =
        this.waitingItem =
        this.endedItem =
        this.playingAsset =
        this.endedAsset =
        this.bufferingAsset =
          null));
  }
  onMediaDetaching(n, i) {
    const o = !!i.transferMedia,
      l = this.media;
    if (((this.media = null), !o && (l && this.removeMediaListeners(l), this.detachedData))) {
      const h = this.getBufferingPlayer();
      (h &&
        (this.log("Removing schedule state for detachedData and ".concat(h)),
        (this.playingAsset =
          this.endedAsset =
          this.bufferingAsset =
          this.bufferingItem =
          this.waitingItem =
          this.detachedData =
            null),
        h.detachMedia()),
        (this.shouldPlay = !1));
    }
  }
  get interstitialsManager() {
    if (!this.hls) return null;
    if (this.manager) return this.manager;
    const n = this,
      i = () => n.bufferingItem || n.waitingItem,
      o = S => S && n.getAssetPlayer(S.identifier),
      l = (S, w, C, L, k) => {
        if (S) {
          let O = S[w].start;
          const B = S.event;
          if (B) {
            if (w === "playout" || B.timelineOccupancy !== Kg.Point) {
              const N = o(C);
              (N == null ? void 0 : N.interstitial) === B && (O += N.assetItem.startOffset + N[k]);
            }
          } else {
            const N = L === "bufferedPos" ? p() : n[L];
            O += N - S.start;
          }
          return O;
        }
        return 0;
      },
      h = (S, w) => {
        var C;
        if (S !== 0 && w !== "primary" && (C = n.schedule) != null && C.length) {
          var L;
          const k = n.schedule.findItemIndexAtTime(S),
            O = (L = n.schedule.items) == null ? void 0 : L[k];
          if (O) {
            const B = O[w].start - O.start;
            return S + B;
          }
        }
        return S;
      },
      p = () => {
        const S = n.bufferedPos;
        return S === Number.MAX_VALUE ? d("primary") : Math.max(S, 0);
      },
      d = S => {
        var w, C;
        return (w = n.primaryDetails) != null && w.live
          ? n.primaryDetails.edge
          : ((C = n.schedule) == null ? void 0 : C.durations[S]) || 0;
      },
      y = (S, w) => {
        var C, L;
        const k = n.effectivePlayingItem;
        if ((k != null && (C = k.event) != null && C.restrictions.skip) || !n.schedule) return;
        n.log("seek to ".concat(S, ' "').concat(w, '"'));
        const O = n.effectivePlayingItem,
          B = n.schedule.findItemIndexAtTime(S, w),
          N = (L = n.schedule.items) == null ? void 0 : L[B],
          $ = n.getBufferingPlayer(),
          I = $ == null ? void 0 : $.interstitial,
          V = I == null ? void 0 : I.appendInPlace,
          oe = O && n.itemsMatch(O, N);
        if (O && (V || oe)) {
          const Y = o(n.playingAsset),
            te = (Y == null ? void 0 : Y.media) || n.primaryMedia;
          if (te) {
            const _ =
                w === "primary" ? te.currentTime : l(O, w, n.playingAsset, "timelinePos", "currentTime"),
              K = S - _,
              q = (V ? _ : te.currentTime) + K;
            if (q >= 0 && (!Y || V || q <= Y.duration)) {
              te.currentTime = q;
              return;
            }
          }
        }
        if (N) {
          let Y = S;
          if (w !== "primary") {
            const _ = N[w].start,
              K = S - _;
            Y = N.start + K;
          }
          const te = !n.isInterstitial(N);
          if ((!n.isInterstitial(O) || O.event.appendInPlace) && (te || N.event.appendInPlace)) {
            const _ = n.media || (V ? ($ == null ? void 0 : $.media) : null);
            _ && (_.currentTime = Y);
          } else if (O) {
            const _ = n.findItemIndex(O);
            if (B > _) {
              const q = n.schedule.findJumpRestrictedIndex(_ + 1, B);
              if (q > _) {
                n.setSchedulePosition(q);
                return;
              }
            }
            let K = 0;
            if (te) ((n.timelinePos = Y), n.checkBuffer());
            else {
              const q = N.event.assetList,
                ce = S - (N[w] || N).start;
              for (let he = q.length; he--; ) {
                const ae = q[he];
                if (ae.duration && ce >= ae.startOffset && ce < ae.startOffset + ae.duration) {
                  K = he;
                  break;
                }
              }
            }
            n.setSchedulePosition(B, K);
          }
        }
      },
      v = () => {
        const S = n.effectivePlayingItem;
        if (n.isInterstitial(S)) return S;
        const w = i();
        return n.isInterstitial(w) ? w : null;
      },
      T = {
        get bufferedEnd() {
          const S = i(),
            w = n.bufferingItem;
          if (w && w === S) {
            var C;
            return (
              l(w, "playout", n.bufferingAsset, "bufferedPos", "bufferedEnd") - w.playout.start ||
              ((C = n.bufferingAsset) == null ? void 0 : C.startOffset) ||
              0
            );
          }
          return 0;
        },
        get currentTime() {
          const S = v(),
            w = n.effectivePlayingItem;
          return w && w === S
            ? l(w, "playout", n.effectivePlayingAsset, "timelinePos", "currentTime") - w.playout.start
            : 0;
        },
        set currentTime(S) {
          const w = v(),
            C = n.effectivePlayingItem;
          C && C === w && y(S + C.playout.start, "playout");
        },
        get duration() {
          const S = v();
          return S ? S.playout.end - S.playout.start : 0;
        },
        get assetPlayers() {
          var S;
          const w = (S = v()) == null ? void 0 : S.event.assetList;
          return w ? w.map(C => n.getAssetPlayer(C.identifier)) : [];
        },
        get playingIndex() {
          var S;
          const w = (S = v()) == null ? void 0 : S.event;
          return w && n.effectivePlayingAsset ? w.findAssetIndex(n.effectivePlayingAsset) : -1;
        },
        get scheduleItem() {
          return v();
        },
      };
    return (this.manager = {
      get events() {
        var S;
        return ((S = n.schedule) == null || (S = S.events) == null ? void 0 : S.slice(0)) || [];
      },
      get schedule() {
        var S;
        return ((S = n.schedule) == null || (S = S.items) == null ? void 0 : S.slice(0)) || [];
      },
      get interstitialPlayer() {
        return v() ? T : null;
      },
      get playerQueue() {
        return n.playerQueue.slice(0);
      },
      get bufferingAsset() {
        return n.bufferingAsset;
      },
      get bufferingItem() {
        return i();
      },
      get bufferingIndex() {
        const S = i();
        return n.findItemIndex(S);
      },
      get playingAsset() {
        return n.effectivePlayingAsset;
      },
      get playingItem() {
        return n.effectivePlayingItem;
      },
      get playingIndex() {
        const S = n.effectivePlayingItem;
        return n.findItemIndex(S);
      },
      primary: {
        get bufferedEnd() {
          return p();
        },
        get currentTime() {
          const S = n.timelinePos;
          return S > 0 ? S : 0;
        },
        set currentTime(S) {
          y(S, "primary");
        },
        get duration() {
          return d("primary");
        },
        get seekableStart() {
          var S;
          return ((S = n.primaryDetails) == null ? void 0 : S.fragmentStart) || 0;
        },
      },
      integrated: {
        get bufferedEnd() {
          return l(i(), "integrated", n.bufferingAsset, "bufferedPos", "bufferedEnd");
        },
        get currentTime() {
          return l(
            n.effectivePlayingItem,
            "integrated",
            n.effectivePlayingAsset,
            "timelinePos",
            "currentTime",
          );
        },
        set currentTime(S) {
          y(S, "integrated");
        },
        get duration() {
          return d("integrated");
        },
        get seekableStart() {
          var S;
          return h(((S = n.primaryDetails) == null ? void 0 : S.fragmentStart) || 0, "integrated");
        },
      },
      skip: () => {
        const S = n.effectivePlayingItem,
          w = S == null ? void 0 : S.event;
        if (w && !w.restrictions.skip) {
          const C = n.findItemIndex(S);
          if (w.appendInPlace) {
            const L = S.playout.start + S.event.duration;
            y(L + 0.001, "playout");
          } else n.advanceAfterAssetEnded(w, C, 1 / 0);
        }
      },
    });
  }
  get effectivePlayingItem() {
    return this.waitingItem || this.playingItem || this.endedItem;
  }
  get effectivePlayingAsset() {
    return this.playingAsset || this.endedAsset;
  }
  get playingLastItem() {
    var n;
    const i = this.playingItem,
      o = (n = this.schedule) == null ? void 0 : n.items;
    return !this.playbackStarted || !i || !o ? !1 : this.findItemIndex(i) === o.length - 1;
  }
  get playbackStarted() {
    return this.effectivePlayingItem !== null;
  }
  get currentTime() {
    var n, i;
    if (this.mediaSelection === null) return;
    const o = this.waitingItem || this.playingItem;
    if (this.isInterstitial(o) && !o.event.appendInPlace) return;
    let l = this.media;
    !l &&
      (n = this.bufferingItem) != null &&
      (n = n.event) != null &&
      n.appendInPlace &&
      (l = this.primaryMedia);
    const h = (i = l) == null ? void 0 : i.currentTime;
    if (!(h === void 0 || !Ue(h))) return h;
  }
  get primaryMedia() {
    var n;
    return this.media || ((n = this.detachedData) == null ? void 0 : n.media) || null;
  }
  isInterstitial(n) {
    return !!(n != null && n.event);
  }
  retreiveMediaSource(n, i) {
    const o = this.getAssetPlayer(n);
    o && this.transferMediaFromPlayer(o, i);
  }
  transferMediaFromPlayer(n, i) {
    const o = n.interstitial.appendInPlace,
      l = n.media;
    if (o && l === this.primaryMedia) {
      if (
        ((this.bufferingAsset = null), (!i || (this.isInterstitial(i) && !i.event.appendInPlace)) && i && l)
      ) {
        this.detachedData = { media: l };
        return;
      }
      const h = n.transferMedia();
      (this.log("transfer MediaSource from ".concat(n, " ").concat(ln(h))), (this.detachedData = h));
    } else i && l && (this.shouldPlay || (this.shouldPlay = !l.paused));
  }
  transferMediaTo(n, i) {
    var o, l;
    if (n.media === i) return;
    let h = null;
    const p = this.hls,
      d = n !== p,
      y = d && n.interstitial.appendInPlace,
      v = (o = this.detachedData) == null ? void 0 : o.mediaSource;
    let T;
    if (p.media) (y && ((h = p.transferMedia()), (this.detachedData = h)), (T = "Primary"));
    else if (v) {
      const L = this.getBufferingPlayer();
      L ? ((h = L.transferMedia()), (T = "".concat(L))) : (T = "detached MediaSource");
    } else T = "detached media";
    if (!h) {
      if (v) ((h = this.detachedData), this.log("using detachedData: MediaSource ".concat(ln(h))));
      else if (!this.detachedData || p.media === i) {
        const L = this.playerQueue;
        (L.length > 1 &&
          L.forEach(k => {
            if (d && k.interstitial.appendInPlace !== y) {
              const O = k.interstitial;
              (this.clearInterstitial(k.interstitial, null),
                (O.appendInPlace = !1),
                O.appendInPlace &&
                  this.warn("Could not change append strategy for queued assets ".concat(O)));
            }
          }),
          this.hls.detachMedia(),
          (this.detachedData = { media: i }));
      }
    }
    const S = h && "mediaSource" in h && ((l = h.mediaSource) == null ? void 0 : l.readyState) !== "closed",
      w = S && h ? h : i;
    this.log(
      ""
        .concat(S ? "transfering MediaSource" : "attaching media", " to ")
        .concat(d ? n : "Primary", " from ")
        .concat(T, " (media.currentTime: ")
        .concat(i.currentTime, ")"),
    );
    const C = this.schedule;
    if (w === h && C) {
      const L = d && n.assetId === C.assetIdAtEnd;
      w.overrides = { duration: C.duration, endOfStream: !d || L, cueRemoval: !d };
    }
    n.attachMedia(w);
  }
  onInterstitialCueEnter() {
    this.onTimeupdate();
  }
  checkStart() {
    const n = this.schedule,
      i = n == null ? void 0 : n.events;
    if (!i || this.playbackDisabled || !this.media) return;
    this.bufferedPos === -1 && (this.bufferedPos = 0);
    const o = this.timelinePos,
      l = this.effectivePlayingItem;
    if (o === -1) {
      const h = this.hls.startPosition;
      if ((this.log(Qp("checkStart", h)), (this.timelinePos = h), i.length && i[0].cue.pre)) {
        const p = n.findEventIndex(i[0].identifier);
        this.setSchedulePosition(p);
      } else if (h >= 0 || !this.primaryLive) {
        const p = (this.timelinePos = h > 0 ? h : 0),
          d = n.findItemIndexAtTime(p);
        this.setSchedulePosition(d);
      }
    } else if (l && !this.playingItem) {
      const h = n.findItemIndex(l);
      this.setSchedulePosition(h);
    }
  }
  advanceAssetBuffering(n, i) {
    const o = n.event,
      l = o.findAssetIndex(i),
      h = $x(o, l);
    if (!o.isAssetPastPlayoutLimit(h)) this.bufferedToEvent(n, h);
    else if (this.schedule) {
      var p;
      const d = (p = this.schedule.items) == null ? void 0 : p[this.findItemIndex(n) + 1];
      d && this.bufferedToItem(d);
    }
  }
  advanceAfterAssetEnded(n, i, o) {
    const l = $x(n, o);
    if (n.isAssetPastPlayoutLimit(l)) {
      if (this.schedule) {
        const h = this.schedule.items;
        if (h) {
          const p = i + 1,
            d = h.length;
          if (p >= d) {
            this.setSchedulePosition(-1);
            return;
          }
          const y = n.resumeTime;
          (this.timelinePos < y &&
            (this.log(Qp("advanceAfterAssetEnded", y)),
            (this.timelinePos = y),
            n.appendInPlace && this.advanceInPlace(y),
            this.checkBuffer(this.bufferedPos < y)),
            this.setSchedulePosition(p));
        }
      }
    } else {
      if (n.appendInPlace) {
        const h = n.assetList[l];
        h && this.advanceInPlace(h.timelineStart);
      }
      this.setSchedulePosition(i, l);
    }
  }
  setScheduleToAssetAtTime(n, i) {
    const o = this.schedule;
    if (!o) return;
    const l = i.parentIdentifier,
      h = o.getEvent(l);
    if (h) {
      const p = o.findEventIndex(l),
        d = o.findAssetIndex(h, n);
      this.advanceAfterAssetEnded(h, p, d - 1);
    }
  }
  setSchedulePosition(n, i) {
    var o;
    const l = (o = this.schedule) == null ? void 0 : o.items;
    if (!l || this.playbackDisabled) return;
    const h = n >= 0 ? l[n] : null;
    this.log(
      "setSchedulePosition "
        .concat(n, ", ")
        .concat(i, " (")
        .concat(h && Vr(h), ") pos: ")
        .concat(this.timelinePos),
    );
    const p = this.waitingItem || this.playingItem,
      d = this.playingLastItem;
    if (this.isInterstitial(p)) {
      const T = p.event,
        S = this.playingAsset,
        w = S == null ? void 0 : S.identifier,
        C = w ? this.getAssetPlayer(w) : null;
      if (C && w && (!this.eventItemsMatch(p, h) || (i !== void 0 && w !== T.assetList[i].identifier))) {
        var y;
        const L = T.findAssetIndex(S);
        if (
          (this.log(
            "INTERSTITIAL_ASSET_ENDED "
              .concat(L + 1, "/")
              .concat(T.assetList.length, " ")
              .concat(Ql(S)),
          ),
          (this.endedAsset = S),
          (this.playingAsset = null),
          this.hls.trigger(F.INTERSTITIAL_ASSET_ENDED, {
            asset: S,
            assetListIndex: L,
            event: T,
            schedule: l.slice(0),
            scheduleIndex: n,
            player: C,
          }),
          p !== this.playingItem)
        ) {
          this.itemsMatch(p, this.playingItem) &&
            !this.playingAsset &&
            this.advanceAfterAssetEnded(T, this.findItemIndex(this.playingItem), L);
          return;
        }
        (this.retreiveMediaSource(w, h),
          C.media && !((y = this.detachedData) != null && y.mediaSource) && C.detachMedia());
      }
      if (
        !this.eventItemsMatch(p, h) &&
        ((this.endedItem = p),
        (this.playingItem = null),
        this.log("INTERSTITIAL_ENDED ".concat(T, " ").concat(Vr(p))),
        (T.hasPlayed = !0),
        this.hls.trigger(F.INTERSTITIAL_ENDED, { event: T, schedule: l.slice(0), scheduleIndex: n }),
        T.cue.once)
      ) {
        var v;
        this.updateSchedule();
        const L = (v = this.schedule) == null ? void 0 : v.items;
        if (h && L) {
          const k = this.findItemIndex(h);
          this.advanceSchedule(k, L, i, p, d);
        }
        return;
      }
    }
    this.advanceSchedule(n, l, i, p, d);
  }
  advanceSchedule(n, i, o, l, h) {
    const p = this.schedule;
    if (!p) return;
    const d = i[n] || null,
      y = this.primaryMedia,
      v = this.playerQueue;
    if (
      (v.length &&
        v.forEach(T => {
          const S = T.interstitial,
            w = p.findEventIndex(S.identifier);
          (w < n || w > n + 1) && this.clearInterstitial(S, d);
        }),
      this.isInterstitial(d))
    ) {
      this.timelinePos = Math.min(Math.max(this.timelinePos, d.start), d.end);
      const T = d.event;
      if (o === void 0) {
        o = p.findAssetIndex(T, this.timelinePos);
        const L = $x(T, o - 1);
        if (T.isAssetPastPlayoutLimit(L) || (T.appendInPlace && this.timelinePos === d.end)) {
          this.advanceAfterAssetEnded(T, n, o);
          return;
        }
        o = L;
      }
      const S = this.waitingItem;
      this.assetsBuffered(d, y) || this.setBufferingItem(d);
      let w = this.preloadAssets(T, o);
      if (
        (this.eventItemsMatch(d, S || l) ||
          ((this.waitingItem = d),
          this.log(
            "INTERSTITIAL_STARTED ".concat(Vr(d), " ").concat(T.appendInPlace ? "append in place" : ""),
          ),
          this.hls.trigger(F.INTERSTITIAL_STARTED, { event: T, schedule: i.slice(0), scheduleIndex: n })),
        !T.assetListLoaded)
      ) {
        this.log("Waiting for ASSET-LIST to complete loading ".concat(T));
        return;
      }
      if ((T.assetListLoader && (T.assetListLoader.destroy(), (T.assetListLoader = void 0)), !y)) {
        this.log("Waiting for attachMedia to start Interstitial ".concat(T));
        return;
      }
      ((this.waitingItem = this.endedItem = null), (this.playingItem = d));
      const C = T.assetList[o];
      if (!C) {
        this.advanceAfterAssetEnded(T, n, o || 0);
        return;
      }
      if ((w || (w = this.getAssetPlayer(C.identifier)), w === null || w.destroyed)) {
        const L = T.assetList.length;
        (this.warn(
          "asset "
            .concat(o + 1, "/")
            .concat(L, " player destroyed ")
            .concat(T),
        ),
          (w = this.createAssetPlayer(T, C, o)),
          w.loadSource());
      }
      if (!this.eventItemsMatch(d, this.bufferingItem) && T.appendInPlace && this.isAssetBuffered(C)) return;
      (this.startAssetPlayer(w, o, i, n, y), this.shouldPlay && Ub(w.media));
    } else
      d
        ? (this.resumePrimary(d, n, l), this.shouldPlay && Ub(this.hls.media))
        : h &&
          this.isInterstitial(l) &&
          ((this.endedItem = null),
          (this.playingItem = l),
          l.event.appendInPlace || this.attachPrimary(p.durations.primary, null));
  }
  get playbackDisabled() {
    return this.hls.config.enableInterstitialPlayback === !1;
  }
  get primaryDetails() {
    var n;
    return (n = this.mediaSelection) == null ? void 0 : n.main.details;
  }
  get primaryLive() {
    var n;
    return !!((n = this.primaryDetails) != null && n.live);
  }
  resumePrimary(n, i, o) {
    var l, h;
    if (
      ((this.playingItem = n),
      (this.playingAsset = this.endedAsset = null),
      (this.waitingItem = this.endedItem = null),
      this.bufferedToItem(n),
      this.log("resuming ".concat(Vr(n))),
      !((l = this.detachedData) != null && l.mediaSource))
    ) {
      let d = this.timelinePos;
      ((d < n.start || d >= n.end) &&
        ((d = this.getPrimaryResumption(n, i)), this.log(Qp("resumePrimary", d)), (this.timelinePos = d)),
        this.attachPrimary(d, n));
    }
    if (!o) return;
    const p = (h = this.schedule) == null ? void 0 : h.items;
    p &&
      (this.log("INTERSTITIALS_PRIMARY_RESUMED ".concat(Vr(n))),
      this.hls.trigger(F.INTERSTITIALS_PRIMARY_RESUMED, { schedule: p.slice(0), scheduleIndex: i }),
      this.checkBuffer());
  }
  getPrimaryResumption(n, i) {
    const o = n.start;
    if (this.primaryLive) {
      const l = this.primaryDetails;
      if (i === 0) return this.hls.startPosition;
      if (l && (o < l.fragmentStart || o > l.edge)) return this.hls.liveSyncPosition || -1;
    }
    return o;
  }
  isAssetBuffered(n) {
    const i = this.getAssetPlayer(n.identifier);
    return i != null && i.hls
      ? i.hls.bufferedToEnd
      : Tt.bufferInfo(this.primaryMedia, this.timelinePos, 0).end + 1 >= n.timelineStart + (n.duration || 0);
  }
  attachPrimary(n, i, o) {
    (i ? this.setBufferingItem(i) : (this.bufferingItem = this.playingItem), (this.bufferingAsset = null));
    const l = this.primaryMedia;
    if (!l) return;
    const h = this.hls;
    (h.media ? this.checkBuffer() : (this.transferMediaTo(h, l), o && this.startLoadingPrimaryAt(n, o)),
      o || (this.log(Qp("attachPrimary", n)), (this.timelinePos = n), this.startLoadingPrimaryAt(n, o)));
  }
  startLoadingPrimaryAt(n, i) {
    var o;
    const l = this.hls;
    !l.loadingEnabled ||
    !l.media ||
    Math.abs((((o = l.mainForwardBufferInfo) == null ? void 0 : o.start) || l.media.currentTime) - n) > 0.5
      ? l.startLoad(n, i)
      : l.bufferingEnabled || l.resumeBuffering();
  }
  onManifestLoading() {
    var n;
    (this.stopLoad(),
      (n = this.schedule) == null || n.reset(),
      this.emptyPlayerQueue(),
      this.clearScheduleState(),
      (this.shouldPlay = !1),
      (this.bufferedPos = this.timelinePos = -1),
      (this.mediaSelection = this.altSelection = this.manager = this.requiredTracks = null),
      this.hls.off(F.BUFFER_CODECS, this.onBufferCodecs, this),
      this.hls.on(F.BUFFER_CODECS, this.onBufferCodecs, this));
  }
  onLevelUpdated(n, i) {
    if (i.level === -1 || !this.schedule) return;
    const o = this.hls.levels[i.level];
    if (!o.details) return;
    const l = Jt(Jt({}, this.mediaSelection || this.altSelection), {}, { main: o });
    ((this.mediaSelection = l),
      this.schedule.parseInterstitialDateRanges(l, this.hls.config.interstitialAppendInPlace),
      !this.effectivePlayingItem && this.schedule.items && this.checkStart());
  }
  onAudioTrackUpdated(n, i) {
    const o = this.hls.audioTracks[i.id],
      l = this.mediaSelection;
    if (!l) {
      this.altSelection = Jt(Jt({}, this.altSelection), {}, { audio: o });
      return;
    }
    const h = Jt(Jt({}, l), {}, { audio: o });
    this.mediaSelection = h;
  }
  onSubtitleTrackUpdated(n, i) {
    const o = this.hls.subtitleTracks[i.id],
      l = this.mediaSelection;
    if (!l) {
      this.altSelection = Jt(Jt({}, this.altSelection), {}, { subtitles: o });
      return;
    }
    const h = Jt(Jt({}, l), {}, { subtitles: o });
    this.mediaSelection = h;
  }
  onAudioTrackSwitching(n, i) {
    const o = z_(i);
    this.playerQueue.forEach(({ hls: l }) => l && (l.setAudioOption(i) || l.setAudioOption(o)));
  }
  onSubtitleTrackSwitch(n, i) {
    const o = z_(i);
    this.playerQueue.forEach(
      ({ hls: l }) => l && (l.setSubtitleOption(i) || (i.id !== -1 && l.setSubtitleOption(o))),
    );
  }
  onBufferCodecs(n, i) {
    const o = i.tracks;
    o && (this.requiredTracks = o);
  }
  onBufferAppended(n, i) {
    this.checkBuffer();
  }
  onBufferFlushed(n, i) {
    const o = this.playingItem;
    if (o && !this.itemsMatch(o, this.bufferingItem) && !this.isInterstitial(o)) {
      const l = this.timelinePos;
      ((this.bufferedPos = l), this.checkBuffer());
    }
  }
  onBufferedToEnd(n) {
    if (!this.schedule) return;
    const i = this.schedule.events;
    if (this.bufferedPos < Number.MAX_VALUE && i) {
      for (let l = 0; l < i.length; l++) {
        const h = i[l];
        if (h.cue.post) {
          var o;
          const p = this.schedule.findEventIndex(h.identifier),
            d = (o = this.schedule.items) == null ? void 0 : o[p];
          this.isInterstitial(d) && this.eventItemsMatch(d, this.bufferingItem) && this.bufferedToItem(d, 0);
          break;
        }
      }
      this.bufferedPos = Number.MAX_VALUE;
    }
  }
  onMediaEnded(n) {
    const i = this.playingItem;
    if (!this.playingLastItem && i) {
      const o = this.findItemIndex(i);
      this.setSchedulePosition(o + 1);
    } else this.shouldPlay = !1;
  }
  updateItem(n, i) {
    var o;
    const l = (o = this.schedule) == null ? void 0 : o.items;
    if (n && l) {
      const h = this.findItemIndex(n, i);
      return l[h] || null;
    }
    return null;
  }
  trimInPlace(n, i) {
    if (this.isInterstitial(n) && n.event.appendInPlace && i.end - n.end > 0.25) {
      n.event.assetList.forEach((h, p) => {
        n.event.isAssetPastPlayoutLimit(p) && this.clearAssetPlayer(h.identifier, null);
      });
      const o = n.end + 0.25,
        l = Tt.bufferInfo(this.primaryMedia, o, 0);
      (l.end > o || (l.nextStart || 0) > o) &&
        (this.log("trim buffered interstitial ".concat(Vr(n), " (was ").concat(Vr(i), ")")),
        this.attachPrimary(o, null, !0),
        this.flushFrontBuffer(o));
    }
  }
  itemsMatch(n, i) {
    return (
      !!i &&
      (n === i ||
        (n.event && i.event && this.eventItemsMatch(n, i)) ||
        (!n.event && !i.event && this.findItemIndex(n) === this.findItemIndex(i)))
    );
  }
  eventItemsMatch(n, i) {
    var o;
    return !!i && (n === i || n.event.identifier === ((o = i.event) == null ? void 0 : o.identifier));
  }
  findItemIndex(n, i) {
    return n && this.schedule ? this.schedule.findItemIndex(n, i) : -1;
  }
  updateSchedule(n = !1) {
    var i;
    const o = this.mediaSelection;
    o && ((i = this.schedule) == null || i.updateSchedule(o, [], n));
  }
  checkBuffer(n) {
    var i;
    const o = (i = this.schedule) == null ? void 0 : i.items;
    if (!o) return;
    const l = Tt.bufferInfo(this.primaryMedia, this.timelinePos, 0);
    (n && (this.bufferedPos = this.timelinePos), n || (n = l.len < 1), this.updateBufferedPos(l.end, o, n));
  }
  updateBufferedPos(n, i, o) {
    const l = this.schedule,
      h = this.bufferingItem;
    if (this.bufferedPos > n || !l) return;
    if (i.length === 1 && this.itemsMatch(i[0], h)) {
      this.bufferedPos = n;
      return;
    }
    const p = this.playingItem,
      d = this.findItemIndex(p);
    let y = l.findItemIndexAtTime(n);
    if (this.bufferedPos < n) {
      var v;
      const T = this.findItemIndex(h),
        S = Math.min(T + 1, i.length - 1),
        w = i[S];
      if (
        (((y === -1 && h && n >= h.end) ||
          ((v = w.event) != null && v.appendInPlace && n + 0.01 >= w.start)) &&
          (y = S),
        this.isInterstitial(h))
      ) {
        const C = h.event;
        if ((S - d > 1 && C.appendInPlace === !1) || (C.assetList.length === 0 && C.assetListLoader)) return;
      }
      if (((this.bufferedPos = n), y > T && y > d)) this.bufferedToItem(w);
      else {
        const C = this.primaryDetails;
        this.primaryLive &&
          C &&
          n > C.edge - C.targetduration &&
          w.start < C.edge + this.hls.config.interstitialLiveLookAhead &&
          this.isInterstitial(w) &&
          this.preloadAssets(w.event, 0);
      }
    } else
      o &&
        p &&
        !this.itemsMatch(p, h) &&
        (y === d ? this.bufferedToItem(p) : y === d + 1 && this.bufferedToItem(i[y]));
  }
  assetsBuffered(n, i) {
    return n.event.assetList.length === 0
      ? !1
      : !n.event.assetList.some(l => {
          const h = this.getAssetPlayer(l.identifier);
          return !(h != null && h.bufferedInPlaceToEnd(i));
        });
  }
  setBufferingItem(n) {
    const i = this.bufferingItem,
      o = this.schedule;
    if (!this.itemsMatch(n, i) && o) {
      const { items: l, events: h } = o;
      if (!l || !h) return i;
      const p = this.isInterstitial(n),
        d = this.getBufferingPlayer();
      ((this.bufferingItem = n), (this.bufferedPos = Math.max(n.start, Math.min(n.end, this.timelinePos))));
      const y = d ? d.remaining : i ? i.end - this.timelinePos : 0;
      if (
        (this.log(
          "INTERSTITIALS_BUFFERED_TO_BOUNDARY ".concat(Vr(n)) +
            (i ? " (".concat(y.toFixed(2), " remaining)") : ""),
        ),
        !this.playbackDisabled)
      )
        if (p) {
          const v = o.findAssetIndex(n.event, this.bufferedPos);
          n.event.assetList.forEach((T, S) => {
            const w = this.getAssetPlayer(T.identifier);
            w && (S === v && w.loadSource(), w.resumeBuffering());
          });
        } else (this.hls.resumeBuffering(), this.playerQueue.forEach(v => v.pauseBuffering()));
      this.hls.trigger(F.INTERSTITIALS_BUFFERED_TO_BOUNDARY, {
        events: h.slice(0),
        schedule: l.slice(0),
        bufferingIndex: this.findItemIndex(n),
        playingIndex: this.findItemIndex(this.playingItem),
      });
    } else this.bufferingItem !== n && (this.bufferingItem = n);
    return i;
  }
  bufferedToItem(n, i = 0) {
    const o = this.setBufferingItem(n);
    if (!this.playbackDisabled) {
      if (this.isInterstitial(n)) this.bufferedToEvent(n, i);
      else if (o !== null) {
        this.bufferingAsset = null;
        const l = this.detachedData;
        l
          ? l.mediaSource
            ? this.attachPrimary(n.start, n, !0)
            : this.preloadPrimary(n)
          : this.preloadPrimary(n);
      }
    }
  }
  preloadPrimary(n) {
    const i = this.findItemIndex(n),
      o = this.getPrimaryResumption(n, i);
    this.startLoadingPrimaryAt(o);
  }
  bufferedToEvent(n, i) {
    const o = n.event,
      l = o.assetList.length === 0 && !o.assetListLoader,
      h = o.cue.once;
    if (l || !h) {
      const p = this.preloadAssets(o, i);
      if (p != null && p.interstitial.appendInPlace) {
        const d = this.primaryMedia;
        d && this.bufferAssetPlayer(p, d);
      }
    }
  }
  preloadAssets(n, i) {
    const o = n.assetUrl,
      l = n.assetList.length,
      h = l === 0 && !n.assetListLoader,
      p = n.cue.once;
    if (h) {
      const y = n.timelineStart;
      if (n.appendInPlace) {
        var d;
        const w = this.playingItem;
        !this.isInterstitial(w) &&
          (w == null || (d = w.nextEvent) == null ? void 0 : d.identifier) === n.identifier &&
          this.flushFrontBuffer(y + 0.25);
      }
      let v,
        T = 0;
      if (
        (!this.playingItem &&
          this.primaryLive &&
          ((T = this.hls.startPosition), T === -1 && (T = this.hls.liveSyncPosition || 0)),
        T && !(n.cue.pre || n.cue.post))
      ) {
        const w = T - y;
        w > 0 && (v = Math.round(w * 1e3) / 1e3);
      }
      if (
        (this.log(
          "Load interstitial asset "
            .concat(i + 1, "/")
            .concat(o ? 1 : l, " ")
            .concat(n)
            .concat(v ? " live-start: ".concat(T, " start-offset: ").concat(v) : ""),
        ),
        o)
      )
        return this.createAsset(n, 0, 0, y, n.duration, o);
      const S = this.assetListLoader.loadAssetList(n, v);
      S && (n.assetListLoader = S);
    } else if (!p && l) {
      for (let v = i; v < l; v++) {
        const T = n.assetList[v],
          S = this.getAssetPlayerQueueIndex(T.identifier);
        (S === -1 || this.playerQueue[S].destroyed) && !T.error && this.createAssetPlayer(n, T, v);
      }
      const y = n.assetList[i];
      if (y) {
        const v = this.getAssetPlayer(y.identifier);
        return (v && v.loadSource(), v);
      }
    }
    return null;
  }
  flushFrontBuffer(n) {
    const i = this.requiredTracks;
    if (!i) return;
    (this.log("Removing front buffer starting at ".concat(n)),
      Object.keys(i).forEach(l => {
        this.hls.trigger(F.BUFFER_FLUSHING, { startOffset: n, endOffset: 1 / 0, type: l });
      }));
  }
  getAssetPlayerQueueIndex(n) {
    const i = this.playerQueue;
    for (let o = 0; o < i.length; o++) if (n === i[o].assetId) return o;
    return -1;
  }
  getAssetPlayer(n) {
    const i = this.getAssetPlayerQueueIndex(n);
    return this.playerQueue[i] || null;
  }
  getBufferingPlayer() {
    const { playerQueue: n, primaryMedia: i } = this;
    if (i) {
      for (let o = 0; o < n.length; o++) if (n[o].media === i) return n[o];
    }
    return null;
  }
  createAsset(n, i, o, l, h, p) {
    const d = {
      parentIdentifier: n.identifier,
      identifier: GW(n, p, i),
      duration: h,
      startOffset: o,
      timelineStart: l,
      uri: p,
    };
    return this.createAssetPlayer(n, d, i);
  }
  createAssetPlayer(n, i, o) {
    const l = this.hls,
      h = l.userConfig;
    let p = h.videoPreference;
    const d = l.loadLevelObj || l.levels[l.currentLevel];
    (p || d) &&
      ((p = rn({}, p)),
      d.videoCodec && (p.videoCodec = d.videoCodec),
      d.videoRange && (p.allowedVideoRanges = [d.videoRange]));
    const y = l.audioTracks[l.audioTrack],
      v = l.subtitleTracks[l.subtitleTrack];
    let T = 0;
    if (this.primaryLive || n.appendInPlace) {
      const I = this.timelinePos - i.timelineStart;
      if (I > 1) {
        const V = i.duration;
        V && I < V && (T = I);
      }
    }
    const S = i.identifier,
      w = Jt(
        Jt({}, h),
        {},
        {
          maxMaxBufferLength: Math.min(180, l.config.maxMaxBufferLength),
          autoStartLoad: !0,
          startFragPrefetch: !0,
          primarySessionId: l.sessionId,
          assetPlayerId: S,
          abrEwmaDefaultEstimate: l.bandwidthEstimate,
          interstitialsController: void 0,
          startPosition: T,
          liveDurationInfinity: !1,
          testBandwidth: !1,
          videoPreference: p,
          audioPreference: y || h.audioPreference,
          subtitlePreference: v || h.subtitlePreference,
        },
      );
    n.appendInPlace &&
      ((n.appendInPlaceStarted = !0), i.timelineStart && (w.timelineOffset = i.timelineStart));
    const C = w.cmcd;
    (C != null && C.sessionId && C.contentId && (w.cmcd = rn({}, C, { contentId: fd(i.uri) })),
      this.getAssetPlayer(S) &&
        this.warn("Duplicate date range identifier ".concat(n, " and asset ").concat(S)));
    const L = new HW(this.HlsPlayerClass, w, n, i);
    (this.playerQueue.push(L), (n.assetList[o] = i));
    let k = !0;
    const O = I => {
      if (I.live) {
        var V;
        const te = new Error("Interstitials MUST be VOD assets ".concat(n)),
          _ = { fatal: !0, type: et.OTHER_ERROR, details: ge.INTERSTITIAL_ASSET_ITEM_ERROR, error: te },
          K = ((V = this.schedule) == null ? void 0 : V.findEventIndex(n.identifier)) || -1;
        this.handleAssetItemError(_, n, K, o, te.message);
        return;
      }
      const oe = I.edge - I.fragmentStart,
        Y = i.duration;
      (k || Y === null || oe > Y) &&
        ((k = !1),
        this.log('Interstitial asset "'.concat(S, '" duration change ').concat(Y, " > ").concat(oe)),
        (i.duration = oe),
        this.updateSchedule());
    };
    (L.on(F.LEVEL_UPDATED, (I, { details: V }) => O(V)),
      L.on(F.LEVEL_PTS_UPDATED, (I, { details: V }) => O(V)),
      L.on(F.EVENT_CUE_ENTER, () => this.onInterstitialCueEnter()));
    const B = (I, V) => {
      const oe = this.getAssetPlayer(S);
      if (oe && V.tracks) {
        (oe.off(F.BUFFER_CODECS, B), (oe.tracks = V.tracks));
        const Y = this.primaryMedia;
        this.bufferingAsset === oe.assetItem && Y && !oe.media && this.bufferAssetPlayer(oe, Y);
      }
    };
    L.on(F.BUFFER_CODECS, B);
    const N = () => {
      var I;
      const V = this.getAssetPlayer(S);
      if ((this.log("buffered to end of asset ".concat(V)), !V || !this.schedule)) return;
      const oe = this.schedule.findEventIndex(n.identifier),
        Y = (I = this.schedule.items) == null ? void 0 : I[oe];
      this.isInterstitial(Y) && this.advanceAssetBuffering(Y, i);
    };
    L.on(F.BUFFERED_TO_END, N);
    const $ = I => () => {
      if (!this.getAssetPlayer(S) || !this.schedule) return;
      this.shouldPlay = !0;
      const oe = this.schedule.findEventIndex(n.identifier);
      this.advanceAfterAssetEnded(n, oe, I);
    };
    return (
      L.once(F.MEDIA_ENDED, $(o)),
      L.once(F.PLAYOUT_LIMIT_REACHED, $(1 / 0)),
      L.on(F.ERROR, (I, V) => {
        if (!this.schedule) return;
        const oe = this.getAssetPlayer(S);
        if (V.details === ge.BUFFER_STALLED_ERROR) {
          if (oe != null && oe.appendInPlace) {
            this.handleInPlaceStall(n);
            return;
          }
          (this.onTimeupdate(), this.checkBuffer(!0));
          return;
        }
        this.handleAssetItemError(
          V,
          n,
          this.schedule.findEventIndex(n.identifier),
          o,
          "Asset player error ".concat(V.error, " ").concat(n),
        );
      }),
      L.on(F.DESTROYING, () => {
        if (!this.getAssetPlayer(S) || !this.schedule) return;
        const V = new Error("Asset player destroyed unexpectedly ".concat(S)),
          oe = { fatal: !0, type: et.OTHER_ERROR, details: ge.INTERSTITIAL_ASSET_ITEM_ERROR, error: V };
        this.handleAssetItemError(oe, n, this.schedule.findEventIndex(n.identifier), o, V.message);
      }),
      this.log("INTERSTITIAL_ASSET_PLAYER_CREATED ".concat(Ql(i))),
      this.hls.trigger(F.INTERSTITIAL_ASSET_PLAYER_CREATED, {
        asset: i,
        assetListIndex: o,
        event: n,
        player: L,
      }),
      L
    );
  }
  clearInterstitial(n, i) {
    (this.clearAssetPlayers(n, i), n.reset());
  }
  clearAssetPlayers(n, i) {
    n.assetList.forEach(o => {
      this.clearAssetPlayer(o.identifier, i);
    });
  }
  resetAssetPlayer(n) {
    const i = this.getAssetPlayerQueueIndex(n);
    if (i !== -1) {
      this.log('reset asset player "'.concat(n, '" after error'));
      const o = this.playerQueue[i];
      (this.transferMediaFromPlayer(o, null), o.resetDetails());
    }
  }
  clearAssetPlayer(n, i) {
    const o = this.getAssetPlayerQueueIndex(n);
    if (o !== -1) {
      const l = this.playerQueue[o];
      (this.log("clear ".concat(l, " toSegment: ").concat(i && Vr(i))),
        this.transferMediaFromPlayer(l, i),
        this.playerQueue.splice(o, 1),
        l.destroy());
    }
  }
  emptyPlayerQueue() {
    let n;
    for (; (n = this.playerQueue.pop()); ) n.destroy();
    this.playerQueue = [];
  }
  startAssetPlayer(n, i, o, l, h) {
    const { interstitial: p, assetItem: d, assetId: y } = n,
      v = p.assetList.length,
      T = this.playingAsset;
    ((this.endedAsset = null),
      (this.playingAsset = d),
      (!T || T.identifier !== y) &&
        (T && (this.clearAssetPlayer(T.identifier, o[l]), delete T.error),
        this.log(
          "INTERSTITIAL_ASSET_STARTED "
            .concat(i + 1, "/")
            .concat(v, " ")
            .concat(Ql(d)),
        ),
        this.hls.trigger(F.INTERSTITIAL_ASSET_STARTED, {
          asset: d,
          assetListIndex: i,
          event: p,
          schedule: o.slice(0),
          scheduleIndex: l,
          player: n,
        })),
      this.bufferAssetPlayer(n, h));
  }
  bufferAssetPlayer(n, i) {
    var o, l;
    if (!this.schedule) return;
    const { interstitial: h, assetItem: p } = n,
      d = this.schedule.findEventIndex(h.identifier),
      y = (o = this.schedule.items) == null ? void 0 : o[d];
    if (!y) return;
    (n.loadSource(), this.setBufferingItem(y), (this.bufferingAsset = p));
    const v = this.getBufferingPlayer();
    if (v === n) return;
    const T = h.appendInPlace;
    if (T && (v == null ? void 0 : v.interstitial.appendInPlace) === !1) return;
    const S =
      (v == null ? void 0 : v.tracks) ||
      ((l = this.detachedData) == null ? void 0 : l.tracks) ||
      this.requiredTracks;
    if (T && p !== this.playingAsset) {
      if (!n.tracks) {
        this.log("Waiting for track info before buffering ".concat(n));
        return;
      }
      if (S && !Ek(S, n.tracks)) {
        const w = new Error(
            "Asset "
              .concat(Ql(p), " SourceBuffer tracks ('")
              .concat(Object.keys(n.tracks), "') are not compatible with primary content tracks ('")
              .concat(Object.keys(S), "')"),
          ),
          C = { fatal: !0, type: et.OTHER_ERROR, details: ge.INTERSTITIAL_ASSET_ITEM_ERROR, error: w },
          L = h.findAssetIndex(p);
        this.handleAssetItemError(C, h, d, L, w.message);
        return;
      }
    }
    this.transferMediaTo(n, i);
  }
  handleInPlaceStall(n) {
    const i = this.schedule,
      o = this.primaryMedia;
    if (!i || !o) return;
    const l = o.currentTime,
      h = i.findAssetIndex(n, l),
      p = n.assetList[h];
    if (p) {
      const d = this.getAssetPlayer(p.identifier);
      if (d) {
        const y = d.currentTime || l - p.timelineStart,
          v = d.duration - y;
        if (
          (this.warn(
            "Stalled at "
              .concat(y, " of ")
              .concat(y + v, " in ")
              .concat(d, " ")
              .concat(n, " (media.currentTime: ")
              .concat(l, ")"),
          ),
          y && (v / o.playbackRate < 0.5 || d.bufferedInPlaceToEnd(o)) && d.hls)
        ) {
          const T = i.findEventIndex(n.identifier);
          this.advanceAfterAssetEnded(n, T, h);
        }
      }
    }
  }
  advanceInPlace(n) {
    const i = this.primaryMedia;
    i && i.currentTime < n && (i.currentTime = n);
  }
  handleAssetItemError(n, i, o, l, h) {
    if (n.details === ge.BUFFER_STALLED_ERROR) return;
    const p = i.assetList[l] || null;
    if ((this.warn("INTERSTITIAL_ASSET_ERROR ".concat(p && Ql(p), " ").concat(n.error)), !this.schedule))
      return;
    const d = (p == null ? void 0 : p.identifier) || "",
      y = this.getAssetPlayerQueueIndex(d),
      v = this.playerQueue[y] || null,
      T = this.schedule.items,
      S = rn({}, n, {
        fatal: !1,
        errorAction: su(!0),
        asset: p,
        assetListIndex: l,
        event: i,
        schedule: T,
        scheduleIndex: o,
        player: v,
      });
    if ((this.hls.trigger(F.INTERSTITIAL_ASSET_ERROR, S), !n.fatal)) return;
    const w = this.playingAsset,
      C = this.bufferingAsset,
      L = new Error(h);
    if ((p && (this.clearAssetPlayer(d, null), (p.error = L)), !i.assetList.some(k => !k.error))) i.error = L;
    else for (let k = l; k < i.assetList.length; k++) this.resetAssetPlayer(i.assetList[k].identifier);
    (this.updateSchedule(!0),
      i.error
        ? this.primaryFallback(i)
        : w && w.identifier === d
          ? this.advanceAfterAssetEnded(i, o, l)
          : C &&
            C.identifier === d &&
            this.isInterstitial(this.bufferingItem) &&
            this.advanceAssetBuffering(this.bufferingItem, C));
  }
  primaryFallback(n) {
    const i = n.timelineStart,
      o = this.effectivePlayingItem;
    let l = this.timelinePos;
    if (o) {
      (this.log(
        'Fallback to primary from event "'
          .concat(n.identifier, '" start: ')
          .concat(i, " pos: ")
          .concat(l, " playing: ")
          .concat(Vr(o), " error: ")
          .concat(n.error),
      ),
        l === -1 && (l = this.hls.startPosition));
      const p = this.updateItem(o, l);
      (this.itemsMatch(o, p) && this.clearInterstitial(n, null),
        n.appendInPlace && (this.attachPrimary(i, null), this.flushFrontBuffer(i)));
    } else if (l === -1) {
      this.checkStart();
      return;
    }
    if (!this.schedule) return;
    const h = this.schedule.findItemIndexAtTime(l);
    this.setSchedulePosition(h);
  }
  onAssetListLoaded(n, i) {
    var o, l;
    const h = i.event,
      p = h.identifier,
      d = i.assetListResponse.ASSETS;
    if (!((o = this.schedule) != null && o.hasEvent(p))) return;
    const y = h.timelineStart,
      v = h.duration;
    let T = 0;
    (d.forEach((k, O) => {
      const B = parseFloat(k.DURATION);
      (this.createAsset(h, O, T, y + T, B, k.URI), (T += B));
    }),
      (h.duration = T),
      this.log("Loaded asset-list with duration: ".concat(T, " (was: ").concat(v, ") ").concat(h)));
    const S = this.waitingItem,
      w = (S == null ? void 0 : S.event.identifier) === p;
    this.updateSchedule();
    const C = (l = this.bufferingItem) == null ? void 0 : l.event;
    if (w) {
      var L;
      const k = this.schedule.findEventIndex(p),
        O = (L = this.schedule.items) == null ? void 0 : L[k];
      if (O) {
        if (
          !this.playingItem &&
          this.timelinePos > O.end &&
          this.schedule.findItemIndexAtTime(this.timelinePos) !== k
        ) {
          ((h.error = new Error(
            "Interstitial "
              .concat(d.length ? "no longer within playback range" : "asset-list is empty", " ")
              .concat(this.timelinePos, " ")
              .concat(h),
          )),
            this.log(h.error.message),
            this.updateSchedule(!0),
            this.primaryFallback(h));
          return;
        }
        this.setBufferingItem(O);
      }
      this.setSchedulePosition(k);
    } else if ((C == null ? void 0 : C.identifier) === p) {
      const k = h.assetList[0];
      if (k) {
        const O = this.getAssetPlayer(k.identifier);
        if (C.appendInPlace) {
          const B = this.primaryMedia;
          O && B && this.bufferAssetPlayer(O, B);
        } else O && O.loadSource();
      }
    }
  }
  onError(n, i) {
    if (this.schedule)
      switch (i.details) {
        case ge.ASSET_LIST_PARSING_ERROR:
        case ge.ASSET_LIST_LOAD_ERROR:
        case ge.ASSET_LIST_LOAD_TIMEOUT: {
          const o = i.interstitial;
          o && (this.updateSchedule(!0), this.primaryFallback(o));
          break;
        }
        case ge.BUFFER_STALLED_ERROR: {
          const o = this.endedItem || this.waitingItem || this.playingItem;
          if (this.isInterstitial(o) && o.event.appendInPlace) {
            this.handleInPlaceStall(o.event);
            return;
          }
          (this.log(
            "Primary player stall @".concat(this.timelinePos, " bufferedPos: ").concat(this.bufferedPos),
          ),
            this.onTimeupdate(),
            this.checkBuffer(!0));
          break;
        }
      }
  }
}
const Bb = 500;
class YW extends yS {
  constructor(n, i, o) {
    (super(n, i, o, "subtitle-stream-controller", Xe.SUBTITLE),
      (this.currentTrackId = -1),
      (this.tracksBuffered = []),
      (this.mainDetails = null),
      this.registerListeners());
  }
  onHandlerDestroying() {
    (this.unregisterListeners(), super.onHandlerDestroying(), (this.mainDetails = null));
  }
  registerListeners() {
    super.registerListeners();
    const { hls: n } = this;
    (n.on(F.LEVEL_LOADED, this.onLevelLoaded, this),
      n.on(F.SUBTITLE_TRACKS_UPDATED, this.onSubtitleTracksUpdated, this),
      n.on(F.SUBTITLE_TRACK_SWITCH, this.onSubtitleTrackSwitch, this),
      n.on(F.SUBTITLE_TRACK_LOADED, this.onSubtitleTrackLoaded, this),
      n.on(F.SUBTITLE_FRAG_PROCESSED, this.onSubtitleFragProcessed, this),
      n.on(F.BUFFER_FLUSHING, this.onBufferFlushing, this));
  }
  unregisterListeners() {
    super.unregisterListeners();
    const { hls: n } = this;
    (n.off(F.LEVEL_LOADED, this.onLevelLoaded, this),
      n.off(F.SUBTITLE_TRACKS_UPDATED, this.onSubtitleTracksUpdated, this),
      n.off(F.SUBTITLE_TRACK_SWITCH, this.onSubtitleTrackSwitch, this),
      n.off(F.SUBTITLE_TRACK_LOADED, this.onSubtitleTrackLoaded, this),
      n.off(F.SUBTITLE_FRAG_PROCESSED, this.onSubtitleFragProcessed, this),
      n.off(F.BUFFER_FLUSHING, this.onBufferFlushing, this));
  }
  startLoad(n, i) {
    (this.stopLoad(),
      (this.state = Te.IDLE),
      this.setInterval(Bb),
      (this.nextLoadPosition = this.lastCurrentTime = n + this.timelineOffset),
      (this.startPosition = i ? -1 : n),
      this.tick());
  }
  onManifestLoading() {
    (super.onManifestLoading(), (this.mainDetails = null));
  }
  onMediaDetaching(n, i) {
    ((this.tracksBuffered = []), super.onMediaDetaching(n, i));
  }
  onLevelLoaded(n, i) {
    this.mainDetails = i.details;
  }
  onSubtitleFragProcessed(n, i) {
    const { frag: o, success: l } = i;
    if ((this.fragContextChanged(o) || (On(o) && (this.fragPrevious = o), (this.state = Te.IDLE)), !l))
      return;
    const h = this.tracksBuffered[this.currentTrackId];
    if (!h) return;
    let p;
    const d = o.start;
    for (let v = 0; v < h.length; v++)
      if (d >= h[v].start && d <= h[v].end) {
        p = h[v];
        break;
      }
    const y = o.start + o.duration;
    (p ? (p.end = y) : ((p = { start: d, end: y }), h.push(p)),
      this.fragmentTracker.fragBuffered(o),
      this.fragBufferedComplete(o, null),
      this.media && this.tick());
  }
  onBufferFlushing(n, i) {
    const { startOffset: o, endOffset: l } = i;
    if (o === 0 && l !== Number.POSITIVE_INFINITY) {
      const h = l - 1;
      if (h <= 0) return;
      ((i.endOffsetSubtitles = Math.max(0, h)),
        this.tracksBuffered.forEach(p => {
          for (let d = 0; d < p.length; ) {
            if (p[d].end <= h) {
              p.shift();
              continue;
            } else if (p[d].start < h) p[d].start = h;
            else break;
            d++;
          }
        }),
        this.fragmentTracker.removeFragmentsInRange(o, h, Xe.SUBTITLE));
    }
  }
  onError(n, i) {
    const o = i.frag;
    (o == null ? void 0 : o.type) === Xe.SUBTITLE &&
      (i.details === ge.FRAG_GAP && this.fragmentTracker.fragBuffered(o, !0),
      this.fragCurrent && this.fragCurrent.abortRequests(),
      this.state !== Te.STOPPED && (this.state = Te.IDLE));
  }
  onSubtitleTracksUpdated(n, { subtitleTracks: i }) {
    if (this.levels && wM(this.levels, i)) {
      this.levels = i.map(o => new Ld(o));
      return;
    }
    ((this.tracksBuffered = []),
      (this.levels = i.map(o => {
        const l = new Ld(o);
        return ((this.tracksBuffered[l.id] = []), l);
      })),
      this.fragmentTracker.removeFragmentsInRange(0, Number.POSITIVE_INFINITY, Xe.SUBTITLE),
      (this.fragPrevious = null),
      (this.mediaBuffer = null));
  }
  onSubtitleTrackSwitch(n, i) {
    var o;
    if (
      ((this.currentTrackId = i.id), !((o = this.levels) != null && o.length) || this.currentTrackId === -1)
    ) {
      this.clearInterval();
      return;
    }
    const l = this.levels[this.currentTrackId];
    (l != null && l.details ? (this.mediaBuffer = this.mediaBufferTimeRanges) : (this.mediaBuffer = null),
      l && this.state !== Te.STOPPED && this.setInterval(Bb));
  }
  onSubtitleTrackLoaded(n, i) {
    var o;
    const { currentTrackId: l, levels: h } = this,
      { details: p, id: d } = i;
    if (!h) {
      this.warn("Subtitle tracks were reset while loading level ".concat(d));
      return;
    }
    const y = h[d];
    if (d >= h.length || !y) return;
    (this.log(
      "Subtitle track "
        .concat(d, " loaded [")
        .concat(p.startSN, ",")
        .concat(p.endSN, "]")
        .concat(
          p.lastPartSn ? "[part-".concat(p.lastPartSn, "-").concat(p.lastPartIndex, "]") : "",
          ",duration:",
        )
        .concat(p.totalduration),
    ),
      (this.mediaBuffer = this.mediaBufferTimeRanges));
    let v = 0;
    if (p.live || ((o = y.details) != null && o.live)) {
      if (p.deltaUpdateFailed) return;
      const S = this.mainDetails;
      if (!S) {
        this.startFragRequested = !1;
        return;
      }
      const w = S.fragments[0];
      if (!y.details)
        p.hasProgramDateTime && S.hasProgramDateTime
          ? (Vg(p, S), (v = p.fragmentStart))
          : w && ((v = w.start), kT(p, v));
      else {
        var T;
        ((v = this.alignPlaylists(p, y.details, (T = this.levelLastLoaded) == null ? void 0 : T.details)),
          v === 0 && w && ((v = w.start), kT(p, v)));
      }
      S && !this.startFragRequested && this.setStartPosition(S, v);
    }
    ((y.details = p),
      (this.levelLastLoaded = y),
      d === l &&
        (this.hls.trigger(F.SUBTITLE_TRACK_UPDATED, { details: p, id: d, groupId: i.groupId }),
        this.tick(),
        p.live &&
          !this.fragCurrent &&
          this.media &&
          this.state === Te.IDLE &&
          (Aa(null, p.fragments, this.media.currentTime, 0) ||
            (this.warn("Subtitle playlist not aligned with playback"), (y.details = void 0)))));
  }
  _handleFragmentLoadComplete(n) {
    const { frag: i, payload: o } = n,
      l = i.decryptdata,
      h = this.hls;
    if (!this.fragContextChanged(i) && o && o.byteLength > 0 && l != null && l.key && l.iv && ou(l.method)) {
      const p = performance.now();
      this.decrypter
        .decrypt(new Uint8Array(o), l.key.buffer, l.iv.buffer, gS(l.method))
        .catch(d => {
          throw (
            h.trigger(F.ERROR, {
              type: et.MEDIA_ERROR,
              details: ge.FRAG_DECRYPT_ERROR,
              fatal: !1,
              error: d,
              reason: d.message,
              frag: i,
            }),
            d
          );
        })
        .then(d => {
          const y = performance.now();
          h.trigger(F.FRAG_DECRYPTED, { frag: i, payload: d, stats: { tstart: p, tdecrypt: y } });
        })
        .catch(d => {
          (this.warn("".concat(d.name, ": ").concat(d.message)), (this.state = Te.IDLE));
        });
    }
  }
  doTick() {
    if (!this.media) {
      this.state = Te.IDLE;
      return;
    }
    if (this.state === Te.IDLE) {
      const { currentTrackId: n, levels: i } = this,
        o = i == null ? void 0 : i[n];
      if (!o || !i.length || !o.details || this.waitForLive(o)) return;
      const { config: l } = this,
        h = this.getLoadPosition(),
        p = Tt.bufferedInfo(this.tracksBuffered[this.currentTrackId] || [], h, l.maxBufferHole),
        { end: d, len: y } = p,
        v = o.details,
        T = this.hls.maxBufferLength + v.levelTargetDuration;
      if (y > T) return;
      const S = v.fragments,
        w = S.length,
        C = v.edge;
      let L = null;
      const k = this.fragPrevious;
      if (d < C) {
        const N = l.maxFragLookUpTolerance,
          $ = d > C - N ? 0 : N;
        ((L = Aa(k, S, Math.max(S[0].start, d), $)), !L && k && k.start < S[0].start && (L = S[0]));
      } else L = S[w - 1];
      if (((L = this.filterReplacedPrimary(L, o.details)), !L)) return;
      const O = L.sn - v.startSN,
        B = S[O - 1];
      if (
        (B && B.cc === L.cc && this.fragmentTracker.getState(B) === ei.NOT_LOADED && (L = B),
        this.fragmentTracker.getState(L) === ei.NOT_LOADED)
      ) {
        const N = this.mapToInitFragWhenRequired(L);
        N && this.loadFragment(N, o, d);
      }
    }
  }
  loadFragment(n, i, o) {
    On(n) ? super.loadFragment(n, i, o) : this._loadInitSegment(n, i);
  }
  get mediaBufferTimeRanges() {
    return new XW(this.tracksBuffered[this.currentTrackId] || []);
  }
}
class XW {
  constructor(n) {
    this.buffered = void 0;
    const i = (o, l, h) => {
      if (((l = l >>> 0), l > h - 1))
        throw new DOMException(
          "Failed to execute '"
            .concat(o, "' on 'TimeRanges': The index provided (")
            .concat(l, ") is greater than the maximum bound (")
            .concat(h, ")"),
        );
      return n[l][o];
    };
    this.buffered = {
      get length() {
        return n.length;
      },
      end(o) {
        return i("end", o, n.length);
      },
      start(o) {
        return i("start", o, n.length);
      },
    };
  }
}
const qW = {
    42: 225,
    92: 233,
    94: 237,
    95: 243,
    96: 250,
    123: 231,
    124: 247,
    125: 209,
    126: 241,
    127: 9608,
    128: 174,
    129: 176,
    130: 189,
    131: 191,
    132: 8482,
    133: 162,
    134: 163,
    135: 9834,
    136: 224,
    137: 32,
    138: 232,
    139: 226,
    140: 234,
    141: 238,
    142: 244,
    143: 251,
    144: 193,
    145: 201,
    146: 211,
    147: 218,
    148: 220,
    149: 252,
    150: 8216,
    151: 161,
    152: 42,
    153: 8217,
    154: 9473,
    155: 169,
    156: 8480,
    157: 8226,
    158: 8220,
    159: 8221,
    160: 192,
    161: 194,
    162: 199,
    163: 200,
    164: 202,
    165: 203,
    166: 235,
    167: 206,
    168: 207,
    169: 239,
    170: 212,
    171: 217,
    172: 249,
    173: 219,
    174: 171,
    175: 187,
    176: 195,
    177: 227,
    178: 205,
    179: 204,
    180: 236,
    181: 210,
    182: 242,
    183: 213,
    184: 245,
    185: 123,
    186: 125,
    187: 92,
    188: 94,
    189: 95,
    190: 124,
    191: 8764,
    192: 196,
    193: 228,
    194: 214,
    195: 246,
    196: 223,
    197: 165,
    198: 164,
    199: 9475,
    200: 197,
    201: 229,
    202: 216,
    203: 248,
    204: 9487,
    205: 9491,
    206: 9495,
    207: 9499,
  },
  GM = u => String.fromCharCode(qW[u] || u),
  Hr = 15,
  Gs = 100,
  QW = { 17: 1, 18: 3, 21: 5, 22: 7, 23: 9, 16: 11, 19: 12, 20: 14 },
  JW = { 17: 2, 18: 4, 21: 6, 22: 8, 23: 10, 19: 13, 20: 15 },
  ZW = { 25: 1, 26: 3, 29: 5, 30: 7, 31: 9, 24: 11, 27: 12, 28: 14 },
  ez = { 25: 2, 26: 4, 29: 6, 30: 8, 31: 10, 27: 13, 28: 15 },
  tz = ["white", "green", "blue", "cyan", "red", "yellow", "magenta", "black", "transparent"];
class nz {
  constructor() {
    ((this.time = null), (this.verboseLevel = 0));
  }
  log(n, i) {
    if (this.verboseLevel >= n) {
      const o = typeof i == "function" ? i() : i;
      Zt.log("".concat(this.time, " [").concat(n, "] ").concat(o));
    }
  }
}
const ga = function (n) {
  const i = [];
  for (let o = 0; o < n.length; o++) i.push(n[o].toString(16));
  return i;
};
class jM {
  constructor() {
    ((this.foreground = "white"),
      (this.underline = !1),
      (this.italics = !1),
      (this.background = "black"),
      (this.flash = !1));
  }
  reset() {
    ((this.foreground = "white"),
      (this.underline = !1),
      (this.italics = !1),
      (this.background = "black"),
      (this.flash = !1));
  }
  setStyles(n) {
    const i = ["foreground", "underline", "italics", "background", "flash"];
    for (let o = 0; o < i.length; o++) {
      const l = i[o];
      n.hasOwnProperty(l) && (this[l] = n[l]);
    }
  }
  isDefault() {
    return (
      this.foreground === "white" &&
      !this.underline &&
      !this.italics &&
      this.background === "black" &&
      !this.flash
    );
  }
  equals(n) {
    return (
      this.foreground === n.foreground &&
      this.underline === n.underline &&
      this.italics === n.italics &&
      this.background === n.background &&
      this.flash === n.flash
    );
  }
  copy(n) {
    ((this.foreground = n.foreground),
      (this.underline = n.underline),
      (this.italics = n.italics),
      (this.background = n.background),
      (this.flash = n.flash));
  }
  toString() {
    return (
      "color=" +
      this.foreground +
      ", underline=" +
      this.underline +
      ", italics=" +
      this.italics +
      ", background=" +
      this.background +
      ", flash=" +
      this.flash
    );
  }
}
class iz {
  constructor() {
    ((this.uchar = " "), (this.penState = new jM()));
  }
  reset() {
    ((this.uchar = " "), this.penState.reset());
  }
  setChar(n, i) {
    ((this.uchar = n), this.penState.copy(i));
  }
  setPenState(n) {
    this.penState.copy(n);
  }
  equals(n) {
    return this.uchar === n.uchar && this.penState.equals(n.penState);
  }
  copy(n) {
    ((this.uchar = n.uchar), this.penState.copy(n.penState));
  }
  isEmpty() {
    return this.uchar === " " && this.penState.isDefault();
  }
}
class rz {
  constructor(n) {
    ((this.chars = []),
      (this.pos = 0),
      (this.currPenState = new jM()),
      (this.cueStartTime = null),
      (this.logger = void 0));
    for (let i = 0; i < Gs; i++) this.chars.push(new iz());
    this.logger = n;
  }
  equals(n) {
    for (let i = 0; i < Gs; i++) if (!this.chars[i].equals(n.chars[i])) return !1;
    return !0;
  }
  copy(n) {
    for (let i = 0; i < Gs; i++) this.chars[i].copy(n.chars[i]);
  }
  isEmpty() {
    let n = !0;
    for (let i = 0; i < Gs; i++)
      if (!this.chars[i].isEmpty()) {
        n = !1;
        break;
      }
    return n;
  }
  setCursor(n) {
    (this.pos !== n && (this.pos = n),
      this.pos < 0
        ? (this.logger.log(3, "Negative cursor position " + this.pos), (this.pos = 0))
        : this.pos > Gs && (this.logger.log(3, "Too large cursor position " + this.pos), (this.pos = Gs)));
  }
  moveCursor(n) {
    const i = this.pos + n;
    if (n > 1) for (let o = this.pos + 1; o < i + 1; o++) this.chars[o].setPenState(this.currPenState);
    this.setCursor(i);
  }
  backSpace() {
    (this.moveCursor(-1), this.chars[this.pos].setChar(" ", this.currPenState));
  }
  insertChar(n) {
    n >= 144 && this.backSpace();
    const i = GM(n);
    if (this.pos >= Gs) {
      this.logger.log(
        0,
        () => "Cannot insert " + n.toString(16) + " (" + i + ") at position " + this.pos + ". Skipping it!",
      );
      return;
    }
    (this.chars[this.pos].setChar(i, this.currPenState), this.moveCursor(1));
  }
  clearFromPos(n) {
    let i;
    for (i = n; i < Gs; i++) this.chars[i].reset();
  }
  clear() {
    (this.clearFromPos(0), (this.pos = 0), this.currPenState.reset());
  }
  clearToEndOfRow() {
    this.clearFromPos(this.pos);
  }
  getTextString() {
    const n = [];
    let i = !0;
    for (let o = 0; o < Gs; o++) {
      const l = this.chars[o].uchar;
      (l !== " " && (i = !1), n.push(l));
    }
    return i ? "" : n.join("");
  }
  setPenStyles(n) {
    (this.currPenState.setStyles(n), this.chars[this.pos].setPenState(this.currPenState));
  }
}
class Gx {
  constructor(n) {
    ((this.rows = []),
      (this.currRow = Hr - 1),
      (this.nrRollUpRows = null),
      (this.lastOutputScreen = null),
      (this.logger = void 0));
    for (let i = 0; i < Hr; i++) this.rows.push(new rz(n));
    this.logger = n;
  }
  reset() {
    for (let n = 0; n < Hr; n++) this.rows[n].clear();
    this.currRow = Hr - 1;
  }
  equals(n) {
    let i = !0;
    for (let o = 0; o < Hr; o++)
      if (!this.rows[o].equals(n.rows[o])) {
        i = !1;
        break;
      }
    return i;
  }
  copy(n) {
    for (let i = 0; i < Hr; i++) this.rows[i].copy(n.rows[i]);
  }
  isEmpty() {
    let n = !0;
    for (let i = 0; i < Hr; i++)
      if (!this.rows[i].isEmpty()) {
        n = !1;
        break;
      }
    return n;
  }
  backSpace() {
    this.rows[this.currRow].backSpace();
  }
  clearToEndOfRow() {
    this.rows[this.currRow].clearToEndOfRow();
  }
  insertChar(n) {
    this.rows[this.currRow].insertChar(n);
  }
  setPen(n) {
    this.rows[this.currRow].setPenStyles(n);
  }
  moveCursor(n) {
    this.rows[this.currRow].moveCursor(n);
  }
  setCursor(n) {
    (this.logger.log(2, "setCursor: " + n), this.rows[this.currRow].setCursor(n));
  }
  setPAC(n) {
    this.logger.log(2, () => "pacData = " + ln(n));
    let i = n.row - 1;
    if (
      (this.nrRollUpRows && i < this.nrRollUpRows - 1 && (i = this.nrRollUpRows - 1),
      this.nrRollUpRows && this.currRow !== i)
    ) {
      for (let d = 0; d < Hr; d++) this.rows[d].clear();
      const h = this.currRow + 1 - this.nrRollUpRows,
        p = this.lastOutputScreen;
      if (p) {
        const d = p.rows[h].cueStartTime,
          y = this.logger.time;
        if (d !== null && y !== null && d < y)
          for (let v = 0; v < this.nrRollUpRows; v++)
            this.rows[i - this.nrRollUpRows + v + 1].copy(p.rows[h + v]);
      }
    }
    this.currRow = i;
    const o = this.rows[this.currRow];
    if (n.indent !== null) {
      const h = n.indent,
        p = Math.max(h - 1, 0);
      (o.setCursor(n.indent), (n.color = o.chars[p].penState.foreground));
    }
    const l = {
      foreground: n.color,
      underline: n.underline,
      italics: n.italics,
      background: "black",
      flash: !1,
    };
    this.setPen(l);
  }
  setBkgData(n) {
    (this.logger.log(2, () => "bkgData = " + ln(n)), this.backSpace(), this.setPen(n), this.insertChar(32));
  }
  setRollUpRows(n) {
    this.nrRollUpRows = n;
  }
  rollUp() {
    if (this.nrRollUpRows === null) {
      this.logger.log(3, "roll_up but nrRollUpRows not set yet");
      return;
    }
    this.logger.log(1, () => this.getDisplayText());
    const n = this.currRow + 1 - this.nrRollUpRows,
      i = this.rows.splice(n, 1)[0];
    (i.clear(), this.rows.splice(this.currRow, 0, i), this.logger.log(2, "Rolling up"));
  }
  getDisplayText(n) {
    n = n || !1;
    const i = [];
    let o = "",
      l = -1;
    for (let h = 0; h < Hr; h++) {
      const p = this.rows[h].getTextString();
      p && ((l = h + 1), n ? i.push("Row " + l + ": '" + p + "'") : i.push(p.trim()));
    }
    return (i.length > 0 && (n ? (o = "[" + i.join(" | ") + "]") : (o = i.join("\n"))), o);
  }
  getTextAndFormat() {
    return this.rows;
  }
}
class $b {
  constructor(n, i, o) {
    ((this.chNr = void 0),
      (this.outputFilter = void 0),
      (this.mode = void 0),
      (this.verbose = void 0),
      (this.displayedMemory = void 0),
      (this.nonDisplayedMemory = void 0),
      (this.lastOutputScreen = void 0),
      (this.currRollUpRow = void 0),
      (this.writeScreen = void 0),
      (this.cueStartTime = void 0),
      (this.logger = void 0),
      (this.chNr = n),
      (this.outputFilter = i),
      (this.mode = null),
      (this.verbose = 0),
      (this.displayedMemory = new Gx(o)),
      (this.nonDisplayedMemory = new Gx(o)),
      (this.lastOutputScreen = new Gx(o)),
      (this.currRollUpRow = this.displayedMemory.rows[Hr - 1]),
      (this.writeScreen = this.displayedMemory),
      (this.mode = null),
      (this.cueStartTime = null),
      (this.logger = o));
  }
  reset() {
    ((this.mode = null),
      this.displayedMemory.reset(),
      this.nonDisplayedMemory.reset(),
      this.lastOutputScreen.reset(),
      this.outputFilter.reset(),
      (this.currRollUpRow = this.displayedMemory.rows[Hr - 1]),
      (this.writeScreen = this.displayedMemory),
      (this.mode = null),
      (this.cueStartTime = null));
  }
  getHandler() {
    return this.outputFilter;
  }
  setHandler(n) {
    this.outputFilter = n;
  }
  setPAC(n) {
    this.writeScreen.setPAC(n);
  }
  setBkgData(n) {
    this.writeScreen.setBkgData(n);
  }
  setMode(n) {
    n !== this.mode &&
      ((this.mode = n),
      this.logger.log(2, () => "MODE=" + n),
      this.mode === "MODE_POP-ON"
        ? (this.writeScreen = this.nonDisplayedMemory)
        : ((this.writeScreen = this.displayedMemory), this.writeScreen.reset()),
      this.mode !== "MODE_ROLL-UP" &&
        ((this.displayedMemory.nrRollUpRows = null), (this.nonDisplayedMemory.nrRollUpRows = null)),
      (this.mode = n));
  }
  insertChars(n) {
    for (let o = 0; o < n.length; o++) this.writeScreen.insertChar(n[o]);
    const i = this.writeScreen === this.displayedMemory ? "DISP" : "NON_DISP";
    (this.logger.log(2, () => i + ": " + this.writeScreen.getDisplayText(!0)),
      (this.mode === "MODE_PAINT-ON" || this.mode === "MODE_ROLL-UP") &&
        (this.logger.log(1, () => "DISPLAYED: " + this.displayedMemory.getDisplayText(!0)),
        this.outputDataUpdate()));
  }
  ccRCL() {
    (this.logger.log(2, "RCL - Resume Caption Loading"), this.setMode("MODE_POP-ON"));
  }
  ccBS() {
    (this.logger.log(2, "BS - BackSpace"),
      this.mode !== "MODE_TEXT" &&
        (this.writeScreen.backSpace(), this.writeScreen === this.displayedMemory && this.outputDataUpdate()));
  }
  ccAOF() {}
  ccAON() {}
  ccDER() {
    (this.logger.log(2, "DER- Delete to End of Row"),
      this.writeScreen.clearToEndOfRow(),
      this.outputDataUpdate());
  }
  ccRU(n) {
    (this.logger.log(2, "RU(" + n + ") - Roll Up"),
      (this.writeScreen = this.displayedMemory),
      this.setMode("MODE_ROLL-UP"),
      this.writeScreen.setRollUpRows(n));
  }
  ccFON() {
    (this.logger.log(2, "FON - Flash On"), this.writeScreen.setPen({ flash: !0 }));
  }
  ccRDC() {
    (this.logger.log(2, "RDC - Resume Direct Captioning"), this.setMode("MODE_PAINT-ON"));
  }
  ccTR() {
    (this.logger.log(2, "TR"), this.setMode("MODE_TEXT"));
  }
  ccRTD() {
    (this.logger.log(2, "RTD"), this.setMode("MODE_TEXT"));
  }
  ccEDM() {
    (this.logger.log(2, "EDM - Erase Displayed Memory"),
      this.displayedMemory.reset(),
      this.outputDataUpdate(!0));
  }
  ccCR() {
    (this.logger.log(2, "CR - Carriage Return"), this.writeScreen.rollUp(), this.outputDataUpdate(!0));
  }
  ccENM() {
    (this.logger.log(2, "ENM - Erase Non-displayed Memory"), this.nonDisplayedMemory.reset());
  }
  ccEOC() {
    if ((this.logger.log(2, "EOC - End Of Caption"), this.mode === "MODE_POP-ON")) {
      const n = this.displayedMemory;
      ((this.displayedMemory = this.nonDisplayedMemory),
        (this.nonDisplayedMemory = n),
        (this.writeScreen = this.nonDisplayedMemory),
        this.logger.log(1, () => "DISP: " + this.displayedMemory.getDisplayText()));
    }
    this.outputDataUpdate(!0);
  }
  ccTO(n) {
    (this.logger.log(2, "TO(" + n + ") - Tab Offset"), this.writeScreen.moveCursor(n));
  }
  ccMIDROW(n) {
    const i = { flash: !1 };
    if (((i.underline = n % 2 === 1), (i.italics = n >= 46), i.italics)) i.foreground = "white";
    else {
      const o = Math.floor(n / 2) - 16,
        l = ["white", "green", "blue", "cyan", "red", "yellow", "magenta"];
      i.foreground = l[o];
    }
    (this.logger.log(2, "MIDROW: " + ln(i)), this.writeScreen.setPen(i));
  }
  outputDataUpdate(n = !1) {
    const i = this.logger.time;
    i !== null &&
      this.outputFilter &&
      (this.cueStartTime === null && !this.displayedMemory.isEmpty()
        ? (this.cueStartTime = i)
        : this.displayedMemory.equals(this.lastOutputScreen) ||
          (this.outputFilter.newCue(this.cueStartTime, i, this.lastOutputScreen),
          n && this.outputFilter.dispatchCue && this.outputFilter.dispatchCue(),
          (this.cueStartTime = this.displayedMemory.isEmpty() ? null : i)),
      this.lastOutputScreen.copy(this.displayedMemory));
  }
  cueSplitAtTime(n) {
    this.outputFilter &&
      (this.displayedMemory.isEmpty() ||
        (this.outputFilter.newCue && this.outputFilter.newCue(this.cueStartTime, n, this.displayedMemory),
        (this.cueStartTime = n)));
  }
}
class Gb {
  constructor(n, i, o) {
    ((this.channels = void 0), (this.currentChannel = 0), (this.cmdHistory = oz()), (this.logger = void 0));
    const l = (this.logger = new nz());
    this.channels = [null, new $b(n, i, l), new $b(n + 1, o, l)];
  }
  getHandler(n) {
    return this.channels[n].getHandler();
  }
  setHandler(n, i) {
    this.channels[n].setHandler(i);
  }
  addData(n, i) {
    this.logger.time = n;
    for (let o = 0; o < i.length; o += 2) {
      const l = i[o] & 127,
        h = i[o + 1] & 127;
      let p = !1,
        d = null;
      if (l === 0 && h === 0) continue;
      this.logger.log(3, () => "[" + ga([i[o], i[o + 1]]) + "] -> (" + ga([l, h]) + ")");
      const y = this.cmdHistory;
      if (l >= 16 && l <= 31) {
        if (sz(l, h, y)) {
          (Jp(null, null, y), this.logger.log(3, () => "Repeated command (" + ga([l, h]) + ") is dropped"));
          continue;
        }
        (Jp(l, h, this.cmdHistory),
          (p = this.parseCmd(l, h)),
          p || (p = this.parseMidrow(l, h)),
          p || (p = this.parsePAC(l, h)),
          p || (p = this.parseBackgroundAttributes(l, h)));
      } else Jp(null, null, y);
      if (!p && ((d = this.parseChars(l, h)), d)) {
        const T = this.currentChannel;
        T && T > 0 ? this.channels[T].insertChars(d) : this.logger.log(2, "No channel found yet. TEXT-MODE?");
      }
      !p &&
        !d &&
        this.logger.log(
          2,
          () => "Couldn't parse cleaned data " + ga([l, h]) + " orig: " + ga([i[o], i[o + 1]]),
        );
    }
  }
  parseCmd(n, i) {
    const o = (n === 20 || n === 28 || n === 21 || n === 29) && i >= 32 && i <= 47,
      l = (n === 23 || n === 31) && i >= 33 && i <= 35;
    if (!(o || l)) return !1;
    const h = n === 20 || n === 21 || n === 23 ? 1 : 2,
      p = this.channels[h];
    return (
      n === 20 || n === 21 || n === 28 || n === 29
        ? i === 32
          ? p.ccRCL()
          : i === 33
            ? p.ccBS()
            : i === 34
              ? p.ccAOF()
              : i === 35
                ? p.ccAON()
                : i === 36
                  ? p.ccDER()
                  : i === 37
                    ? p.ccRU(2)
                    : i === 38
                      ? p.ccRU(3)
                      : i === 39
                        ? p.ccRU(4)
                        : i === 40
                          ? p.ccFON()
                          : i === 41
                            ? p.ccRDC()
                            : i === 42
                              ? p.ccTR()
                              : i === 43
                                ? p.ccRTD()
                                : i === 44
                                  ? p.ccEDM()
                                  : i === 45
                                    ? p.ccCR()
                                    : i === 46
                                      ? p.ccENM()
                                      : i === 47 && p.ccEOC()
        : p.ccTO(i - 32),
      (this.currentChannel = h),
      !0
    );
  }
  parseMidrow(n, i) {
    let o = 0;
    if ((n === 17 || n === 25) && i >= 32 && i <= 47) {
      if ((n === 17 ? (o = 1) : (o = 2), o !== this.currentChannel))
        return (this.logger.log(0, "Mismatch channel in midrow parsing"), !1);
      const l = this.channels[o];
      return l ? (l.ccMIDROW(i), this.logger.log(3, () => "MIDROW (" + ga([n, i]) + ")"), !0) : !1;
    }
    return !1;
  }
  parsePAC(n, i) {
    let o;
    const l = ((n >= 17 && n <= 23) || (n >= 25 && n <= 31)) && i >= 64 && i <= 127,
      h = (n === 16 || n === 24) && i >= 64 && i <= 95;
    if (!(l || h)) return !1;
    const p = n <= 23 ? 1 : 2;
    i >= 64 && i <= 95 ? (o = p === 1 ? QW[n] : ZW[n]) : (o = p === 1 ? JW[n] : ez[n]);
    const d = this.channels[p];
    return d ? (d.setPAC(this.interpretPAC(o, i)), (this.currentChannel = p), !0) : !1;
  }
  interpretPAC(n, i) {
    let o;
    const l = { color: null, italics: !1, indent: null, underline: !1, row: n };
    return (
      i > 95 ? (o = i - 96) : (o = i - 64),
      (l.underline = (o & 1) === 1),
      o <= 13
        ? (l.color = ["white", "green", "blue", "cyan", "red", "yellow", "magenta", "white"][
            Math.floor(o / 2)
          ])
        : o <= 15
          ? ((l.italics = !0), (l.color = "white"))
          : (l.indent = Math.floor((o - 16) / 2) * 4),
      l
    );
  }
  parseChars(n, i) {
    let o,
      l = null,
      h = null;
    if ((n >= 25 ? ((o = 2), (h = n - 8)) : ((o = 1), (h = n)), h >= 17 && h <= 19)) {
      let p;
      (h === 17 ? (p = i + 80) : h === 18 ? (p = i + 112) : (p = i + 144),
        this.logger.log(2, () => "Special char '" + GM(p) + "' in channel " + o),
        (l = [p]));
    } else n >= 32 && n <= 127 && (l = i === 0 ? [n] : [n, i]);
    return (l && this.logger.log(3, () => "Char codes =  " + ga(l).join(",")), l);
  }
  parseBackgroundAttributes(n, i) {
    const o = (n === 16 || n === 24) && i >= 32 && i <= 47,
      l = (n === 23 || n === 31) && i >= 45 && i <= 47;
    if (!(o || l)) return !1;
    let h;
    const p = {};
    n === 16 || n === 24
      ? ((h = Math.floor((i - 32) / 2)),
        (p.background = tz[h]),
        i % 2 === 1 && (p.background = p.background + "_semi"))
      : i === 45
        ? (p.background = "transparent")
        : ((p.foreground = "black"), i === 47 && (p.underline = !0));
    const d = n <= 23 ? 1 : 2;
    return (this.channels[d].setBkgData(p), !0);
  }
  reset() {
    for (let n = 0; n < Object.keys(this.channels).length; n++) {
      const i = this.channels[n];
      i && i.reset();
    }
    Jp(null, null, this.cmdHistory);
  }
  cueSplitAtTime(n) {
    for (let i = 0; i < this.channels.length; i++) {
      const o = this.channels[i];
      o && o.cueSplitAtTime(n);
    }
  }
}
function Jp(u, n, i) {
  ((i.a = u), (i.b = n));
}
function sz(u, n, i) {
  return i.a === u && i.b === n;
}
function oz() {
  return { a: null, b: null };
}
var _S = (function () {
  if (jg != null && jg.VTTCue) return self.VTTCue;
  const u = ["", "lr", "rl"],
    n = ["start", "middle", "end", "left", "right"];
  function i(d, y) {
    if (typeof y != "string" || !Array.isArray(d)) return !1;
    const v = y.toLowerCase();
    return ~d.indexOf(v) ? v : !1;
  }
  function o(d) {
    return i(u, d);
  }
  function l(d) {
    return i(n, d);
  }
  function h(d, ...y) {
    let v = 1;
    for (; v < arguments.length; v++) {
      const T = arguments[v];
      for (const S in T) d[S] = T[S];
    }
    return d;
  }
  function p(d, y, v) {
    const T = this,
      S = { enumerable: !0 };
    T.hasBeenReset = !1;
    let w = "",
      C = !1,
      L = d,
      k = y,
      O = v,
      B = null,
      N = "",
      $ = !0,
      I = "auto",
      V = "start",
      oe = 50,
      Y = "middle",
      te = 50,
      _ = "middle";
    (Object.defineProperty(
      T,
      "id",
      h({}, S, {
        get: function () {
          return w;
        },
        set: function (K) {
          w = "" + K;
        },
      }),
    ),
      Object.defineProperty(
        T,
        "pauseOnExit",
        h({}, S, {
          get: function () {
            return C;
          },
          set: function (K) {
            C = !!K;
          },
        }),
      ),
      Object.defineProperty(
        T,
        "startTime",
        h({}, S, {
          get: function () {
            return L;
          },
          set: function (K) {
            if (typeof K != "number") throw new TypeError("Start time must be set to a number.");
            ((L = K), (this.hasBeenReset = !0));
          },
        }),
      ),
      Object.defineProperty(
        T,
        "endTime",
        h({}, S, {
          get: function () {
            return k;
          },
          set: function (K) {
            if (typeof K != "number") throw new TypeError("End time must be set to a number.");
            ((k = K), (this.hasBeenReset = !0));
          },
        }),
      ),
      Object.defineProperty(
        T,
        "text",
        h({}, S, {
          get: function () {
            return O;
          },
          set: function (K) {
            ((O = "" + K), (this.hasBeenReset = !0));
          },
        }),
      ),
      Object.defineProperty(
        T,
        "region",
        h({}, S, {
          get: function () {
            return B;
          },
          set: function (K) {
            ((B = K), (this.hasBeenReset = !0));
          },
        }),
      ),
      Object.defineProperty(
        T,
        "vertical",
        h({}, S, {
          get: function () {
            return N;
          },
          set: function (K) {
            const q = o(K);
            if (q === !1) throw new SyntaxError("An invalid or illegal string was specified.");
            ((N = q), (this.hasBeenReset = !0));
          },
        }),
      ),
      Object.defineProperty(
        T,
        "snapToLines",
        h({}, S, {
          get: function () {
            return $;
          },
          set: function (K) {
            (($ = !!K), (this.hasBeenReset = !0));
          },
        }),
      ),
      Object.defineProperty(
        T,
        "line",
        h({}, S, {
          get: function () {
            return I;
          },
          set: function (K) {
            if (typeof K != "number" && K !== "auto")
              throw new SyntaxError("An invalid number or illegal string was specified.");
            ((I = K), (this.hasBeenReset = !0));
          },
        }),
      ),
      Object.defineProperty(
        T,
        "lineAlign",
        h({}, S, {
          get: function () {
            return V;
          },
          set: function (K) {
            const q = l(K);
            if (!q) throw new SyntaxError("An invalid or illegal string was specified.");
            ((V = q), (this.hasBeenReset = !0));
          },
        }),
      ),
      Object.defineProperty(
        T,
        "position",
        h({}, S, {
          get: function () {
            return oe;
          },
          set: function (K) {
            if (K < 0 || K > 100) throw new Error("Position must be between 0 and 100.");
            ((oe = K), (this.hasBeenReset = !0));
          },
        }),
      ),
      Object.defineProperty(
        T,
        "positionAlign",
        h({}, S, {
          get: function () {
            return Y;
          },
          set: function (K) {
            const q = l(K);
            if (!q) throw new SyntaxError("An invalid or illegal string was specified.");
            ((Y = q), (this.hasBeenReset = !0));
          },
        }),
      ),
      Object.defineProperty(
        T,
        "size",
        h({}, S, {
          get: function () {
            return te;
          },
          set: function (K) {
            if (K < 0 || K > 100) throw new Error("Size must be between 0 and 100.");
            ((te = K), (this.hasBeenReset = !0));
          },
        }),
      ),
      Object.defineProperty(
        T,
        "align",
        h({}, S, {
          get: function () {
            return _;
          },
          set: function (K) {
            const q = l(K);
            if (!q) throw new SyntaxError("An invalid or illegal string was specified.");
            ((_ = q), (this.hasBeenReset = !0));
          },
        }),
      ),
      (T.displayState = void 0));
  }
  return (
    (p.prototype.getCueAsHTML = function () {
      return self.WebVTT.convertCueToDOMTree(self, this.text);
    }),
    p
  );
})();
class az {
  decode(n, i) {
    if (!n) return "";
    if (typeof n != "string") throw new Error("Error - expected string data.");
    return decodeURIComponent(encodeURIComponent(n));
  }
}
function VM(u) {
  function n(o, l, h, p) {
    return (o | 0) * 3600 + (l | 0) * 60 + (h | 0) + parseFloat(p || 0);
  }
  const i = u.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);
  return i ? (parseFloat(i[2]) > 59 ? n(i[2], i[3], 0, i[4]) : n(i[1], i[2], i[3], i[4])) : null;
}
class lz {
  constructor() {
    this.values = Object.create(null);
  }
  set(n, i) {
    !this.get(n) && i !== "" && (this.values[n] = i);
  }
  get(n, i, o) {
    return o ? (this.has(n) ? this.values[n] : i[o]) : this.has(n) ? this.values[n] : i;
  }
  has(n) {
    return n in this.values;
  }
  alt(n, i, o) {
    for (let l = 0; l < o.length; ++l)
      if (i === o[l]) {
        this.set(n, i);
        break;
      }
  }
  integer(n, i) {
    /^-?\d+$/.test(i) && this.set(n, parseInt(i, 10));
  }
  percent(n, i) {
    if (/^([\d]{1,3})(\.[\d]*)?%$/.test(i)) {
      const o = parseFloat(i);
      if (o >= 0 && o <= 100) return (this.set(n, o), !0);
    }
    return !1;
  }
}
function HM(u, n, i, o) {
  const l = o ? u.split(o) : [u];
  for (const h in l) {
    if (typeof l[h] != "string") continue;
    const p = l[h].split(i);
    if (p.length !== 2) continue;
    const d = p[0],
      y = p[1];
    n(d, y);
  }
}
const $T = new _S(0, 0, ""),
  Zp = $T.align === "middle" ? "middle" : "center";
function uz(u, n, i) {
  const o = u;
  function l() {
    const d = VM(u);
    if (d === null) throw new Error("Malformed timestamp: " + o);
    return ((u = u.replace(/^[^\sa-zA-Z-]+/, "")), d);
  }
  function h(d, y) {
    const v = new lz();
    (HM(
      d,
      function (w, C) {
        let L;
        switch (w) {
          case "region":
            for (let k = i.length - 1; k >= 0; k--)
              if (i[k].id === C) {
                v.set(w, i[k].region);
                break;
              }
            break;
          case "vertical":
            v.alt(w, C, ["rl", "lr"]);
            break;
          case "line":
            ((L = C.split(",")),
              v.integer(w, L[0]),
              v.percent(w, L[0]) && v.set("snapToLines", !1),
              v.alt(w, L[0], ["auto"]),
              L.length === 2 && v.alt("lineAlign", L[1], ["start", Zp, "end"]));
            break;
          case "position":
            ((L = C.split(",")),
              v.percent(w, L[0]),
              L.length === 2 &&
                v.alt("positionAlign", L[1], ["start", Zp, "end", "line-left", "line-right", "auto"]));
            break;
          case "size":
            v.percent(w, C);
            break;
          case "align":
            v.alt(w, C, ["start", Zp, "end", "left", "right"]);
            break;
        }
      },
      /:/,
      /\s/,
    ),
      (y.region = v.get("region", null)),
      (y.vertical = v.get("vertical", "")));
    let T = v.get("line", "auto");
    (T === "auto" && $T.line === -1 && (T = -1),
      (y.line = T),
      (y.lineAlign = v.get("lineAlign", "start")),
      (y.snapToLines = v.get("snapToLines", !0)),
      (y.size = v.get("size", 100)),
      (y.align = v.get("align", Zp)));
    let S = v.get("position", "auto");
    (S === "auto" &&
      $T.position === 50 &&
      (S =
        y.align === "start" || y.align === "left" ? 0 : y.align === "end" || y.align === "right" ? 100 : 50),
      (y.position = S));
  }
  function p() {
    u = u.replace(/^\s+/, "");
  }
  if ((p(), (n.startTime = l()), p(), u.slice(0, 3) !== "-->"))
    throw new Error("Malformed time stamp (time stamps must be separated by '-->'): " + o);
  ((u = u.slice(3)), p(), (n.endTime = l()), p(), h(u, n));
}
function KM(u) {
  return u.replace(/<br(?: \/)?>/gi, "\n");
}
class cz {
  constructor() {
    ((this.state = "INITIAL"),
      (this.buffer = ""),
      (this.decoder = new az()),
      (this.regionList = []),
      (this.cue = null),
      (this.oncue = void 0),
      (this.onparsingerror = void 0),
      (this.onflush = void 0));
  }
  parse(n) {
    const i = this;
    n && (i.buffer += i.decoder.decode(n, { stream: !0 }));
    function o() {
      let h = i.buffer,
        p = 0;
      for (h = KM(h); p < h.length && h[p] !== "\r" && h[p] !== "\n"; ) ++p;
      const d = h.slice(0, p);
      return (h[p] === "\r" && ++p, h[p] === "\n" && ++p, (i.buffer = h.slice(p)), d);
    }
    function l(h) {
      HM(h, function (p, d) {}, /:/);
    }
    try {
      let h = "";
      if (i.state === "INITIAL") {
        if (!/\r\n|\n/.test(i.buffer)) return this;
        h = o();
        const d = h.match(/^()?WEBVTT([ \t].*)?$/);
        if (!(d != null && d[0])) throw new Error("Malformed WebVTT signature.");
        i.state = "HEADER";
      }
      let p = !1;
      for (; i.buffer; ) {
        if (!/\r\n|\n/.test(i.buffer)) return this;
        switch ((p ? (p = !1) : (h = o()), i.state)) {
          case "HEADER":
            /:/.test(h) ? l(h) : h || (i.state = "ID");
            continue;
          case "NOTE":
            h || (i.state = "ID");
            continue;
          case "ID":
            if (/^NOTE($|[ \t])/.test(h)) {
              i.state = "NOTE";
              break;
            }
            if (!h) continue;
            if (((i.cue = new _S(0, 0, "")), (i.state = "CUE"), h.indexOf("-->") === -1)) {
              i.cue.id = h;
              continue;
            }
          case "CUE":
            if (!i.cue) {
              i.state = "BADCUE";
              continue;
            }
            try {
              uz(h, i.cue, i.regionList);
            } catch (d) {
              ((i.cue = null), (i.state = "BADCUE"));
              continue;
            }
            i.state = "CUETEXT";
            continue;
          case "CUETEXT":
            {
              const d = h.indexOf("-->") !== -1;
              if (!h || (d && (p = !0))) {
                (i.oncue && i.cue && i.oncue(i.cue), (i.cue = null), (i.state = "ID"));
                continue;
              }
              if (i.cue === null) continue;
              (i.cue.text && (i.cue.text += "\n"), (i.cue.text += h));
            }
            continue;
          case "BADCUE":
            h || (i.state = "ID");
        }
      }
    } catch (h) {
      (i.state === "CUETEXT" && i.cue && i.oncue && i.oncue(i.cue),
        (i.cue = null),
        (i.state = i.state === "INITIAL" ? "BADWEBVTT" : "BADCUE"));
    }
    return this;
  }
  flush() {
    const n = this;
    try {
      if (
        ((n.cue || n.state === "HEADER") && ((n.buffer += "\n\n"), n.parse()),
        n.state === "INITIAL" || n.state === "BADWEBVTT")
      )
        throw new Error("Malformed WebVTT signature.");
    } catch (i) {
      n.onparsingerror && n.onparsingerror(i);
    }
    return (n.onflush && n.onflush(), this);
  }
}
const dz = /\r\n|\n\r|\n|\r/g,
  jx = function (n, i, o = 0) {
    return n.slice(o, o + i.length) === i;
  },
  hz = function (n) {
    let i = parseInt(n.slice(-3));
    const o = parseInt(n.slice(-6, -4)),
      l = parseInt(n.slice(-9, -7)),
      h = n.length > 9 ? parseInt(n.substring(0, n.indexOf(":"))) : 0;
    if (!Ue(i) || !Ue(o) || !Ue(l) || !Ue(h)) throw Error("Malformed X-TIMESTAMP-MAP: Local:".concat(n));
    return ((i += 1e3 * o), (i += 60 * 1e3 * l), (i += 3600 * 1e3 * h), i);
  };
function bS(u, n, i) {
  return fd(u.toString()) + fd(n.toString()) + fd(i);
}
const fz = function (n, i, o) {
  let l = n[i],
    h = n[l.prevCC];
  if (!h || (!h.new && l.new)) {
    ((n.ccOffset = n.presentationOffset = l.start), (l.new = !1));
    return;
  }
  for (; (p = h) != null && p.new; ) {
    var p;
    ((n.ccOffset += l.start - h.start), (l.new = !1), (l = h), (h = n[l.prevCC]));
  }
  n.presentationOffset = o;
};
function pz(u, n, i, o, l, h, p) {
  const d = new cz(),
    y = Sr(new Uint8Array(u)).trim().replace(dz, "\n").split("\n"),
    v = [],
    T = n ? T9(n.baseTime, n.timescale) : 0;
  let S = "00:00.000",
    w = 0,
    C = 0,
    L,
    k = !0;
  ((d.oncue = function (O) {
    const B = i[o];
    let N = i.ccOffset;
    const $ = (w - T) / 9e4;
    if ((B != null && B.new && (C !== void 0 ? (N = i.ccOffset = B.start) : fz(i, o, $)), $)) {
      if (!n) {
        L = new Error("Missing initPTS for VTT MPEGTS");
        return;
      }
      N = $ - i.presentationOffset;
    }
    const I = O.endTime - O.startTime,
      V = xr((O.startTime + N - C) * 9e4, l * 9e4) / 9e4;
    ((O.startTime = Math.max(V, 0)), (O.endTime = Math.max(V + I, 0)));
    const oe = O.text.trim();
    ((O.text = decodeURIComponent(encodeURIComponent(oe))),
      O.id || (O.id = bS(O.startTime, O.endTime, oe)),
      O.endTime > 0 && v.push(O));
  }),
    (d.onparsingerror = function (O) {
      L = O;
    }),
    (d.onflush = function () {
      if (L) {
        p(L);
        return;
      }
      h(v);
    }),
    y.forEach(O => {
      if (k)
        if (jx(O, "X-TIMESTAMP-MAP=")) {
          ((k = !1),
            O.slice(16)
              .split(",")
              .forEach(B => {
                jx(B, "LOCAL:") ? (S = B.slice(6)) : jx(B, "MPEGTS:") && (w = parseInt(B.slice(7)));
              }));
          try {
            C = hz(S) / 1e3;
          } catch (B) {
            L = B;
          }
          return;
        } else O === "" && (k = !1);
      d.parse(O + "\n");
    }),
    d.flush());
}
const Vx = "stpp.ttml.im1t",
  WM = /^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,
  zM = /^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,
  gz = { left: "start", center: "center", right: "end", start: "start", end: "end" };
function jb(u, n, i, o) {
  const l = kt(new Uint8Array(u), ["mdat"]);
  if (l.length === 0) {
    o(new Error("Could not parse IMSC1 mdat"));
    return;
  }
  const h = l.map(d => Sr(d)),
    p = x9(n.baseTime, 1, n.timescale);
  try {
    h.forEach(d => i(mz(d, p)));
  } catch (d) {
    o(d);
  }
}
function mz(u, n) {
  const l = new DOMParser().parseFromString(u, "text/xml").getElementsByTagName("tt")[0];
  if (!l) throw new Error("Invalid ttml");
  const h = { frameRate: 30, subFrameRate: 1, frameRateMultiplier: 0, tickRate: 0 },
    p = Object.keys(h).reduce((S, w) => ((S[w] = l.getAttribute("ttp:".concat(w)) || h[w]), S), {}),
    d = l.getAttribute("xml:space") !== "preserve",
    y = Vb(Hx(l, "styling", "style")),
    v = Vb(Hx(l, "layout", "region")),
    T = Hx(l, "body", "[begin]");
  return [].map
    .call(T, S => {
      const w = YM(S, d);
      if (!w || !S.hasAttribute("begin")) return null;
      const C = Wx(S.getAttribute("begin"), p),
        L = Wx(S.getAttribute("dur"), p);
      let k = Wx(S.getAttribute("end"), p);
      if (C === null) throw Hb(S);
      if (k === null) {
        if (L === null) throw Hb(S);
        k = C + L;
      }
      const O = new _S(C - n, k - n, w);
      O.id = bS(O.startTime, O.endTime, O.text);
      const B = v[S.getAttribute("region")],
        N = y[S.getAttribute("style")],
        $ = yz(B, N, y),
        { textAlign: I } = $;
      if (I) {
        const V = gz[I];
        (V && (O.lineAlign = V), (O.align = I));
      }
      return (rn(O, $), O);
    })
    .filter(S => S !== null);
}
function Hx(u, n, i) {
  const o = u.getElementsByTagName(n)[0];
  return o ? [].slice.call(o.querySelectorAll(i)) : [];
}
function Vb(u) {
  return u.reduce((n, i) => {
    const o = i.getAttribute("xml:id");
    return (o && (n[o] = i), n);
  }, {});
}
function YM(u, n) {
  return [].slice.call(u.childNodes).reduce((i, o, l) => {
    var h;
    return o.nodeName === "br" && l
      ? i + "\n"
      : (h = o.childNodes) != null && h.length
        ? YM(o, n)
        : n
          ? i + o.textContent.trim().replace(/\s+/g, " ")
          : i + o.textContent;
  }, "");
}
function yz(u, n, i) {
  const o = "http://www.w3.org/ns/ttml#styling";
  let l = null;
  const h = ["displayAlign", "textAlign", "color", "backgroundColor", "fontSize", "fontFamily"],
    p = u != null && u.hasAttribute("style") ? u.getAttribute("style") : null;
  return (
    p && i.hasOwnProperty(p) && (l = i[p]),
    h.reduce((d, y) => {
      const v = Kx(n, o, y) || Kx(u, o, y) || Kx(l, o, y);
      return (v && (d[y] = v), d);
    }, {})
  );
}
function Kx(u, n, i) {
  return u && u.hasAttributeNS(n, i) ? u.getAttributeNS(n, i) : null;
}
function Hb(u) {
  return new Error("Could not parse ttml timestamp ".concat(u));
}
function Wx(u, n) {
  if (!u) return null;
  let i = VM(u);
  return (i === null && (WM.test(u) ? (i = vz(u, n)) : zM.test(u) && (i = xz(u, n))), i);
}
function vz(u, n) {
  const i = WM.exec(u),
    o = (i[4] | 0) + (i[5] | 0) / n.subFrameRate;
  return (i[1] | 0) * 3600 + (i[2] | 0) * 60 + (i[3] | 0) + o / n.frameRate;
}
function xz(u, n) {
  const i = zM.exec(u),
    o = Number(i[1]);
  switch (i[2]) {
    case "h":
      return o * 3600;
    case "m":
      return o * 60;
    case "ms":
      return o * 1e3;
    case "f":
      return o / n.frameRate;
    case "t":
      return o / n.tickRate;
  }
  return o;
}
class eg {
  constructor(n, i) {
    ((this.timelineController = void 0),
      (this.cueRanges = []),
      (this.trackName = void 0),
      (this.startTime = null),
      (this.endTime = null),
      (this.screen = null),
      (this.timelineController = n),
      (this.trackName = i));
  }
  dispatchCue() {
    this.startTime !== null &&
      (this.timelineController.addCues(
        this.trackName,
        this.startTime,
        this.endTime,
        this.screen,
        this.cueRanges,
      ),
      (this.startTime = null));
  }
  newCue(n, i, o) {
    ((this.startTime === null || this.startTime > n) && (this.startTime = n),
      (this.endTime = i),
      (this.screen = o),
      this.timelineController.createCaptionsTrack(this.trackName));
  }
  reset() {
    ((this.cueRanges = []), (this.startTime = null));
  }
}
class Tz {
  constructor(n) {
    ((this.hls = void 0),
      (this.media = null),
      (this.config = void 0),
      (this.enabled = !0),
      (this.Cues = void 0),
      (this.textTracks = []),
      (this.tracks = []),
      (this.initPTS = []),
      (this.unparsedVttFrags = []),
      (this.captionsTracks = {}),
      (this.nonNativeCaptionsTracks = {}),
      (this.cea608Parser1 = void 0),
      (this.cea608Parser2 = void 0),
      (this.lastCc = -1),
      (this.lastSn = -1),
      (this.lastPartIndex = -1),
      (this.prevCC = -1),
      (this.vttCCs = Wb()),
      (this.captionsProperties = void 0),
      (this.hls = n),
      (this.config = n.config),
      (this.Cues = n.config.cueHandler),
      (this.captionsProperties = {
        textTrack1: {
          label: this.config.captionsTextTrack1Label,
          languageCode: this.config.captionsTextTrack1LanguageCode,
        },
        textTrack2: {
          label: this.config.captionsTextTrack2Label,
          languageCode: this.config.captionsTextTrack2LanguageCode,
        },
        textTrack3: {
          label: this.config.captionsTextTrack3Label,
          languageCode: this.config.captionsTextTrack3LanguageCode,
        },
        textTrack4: {
          label: this.config.captionsTextTrack4Label,
          languageCode: this.config.captionsTextTrack4LanguageCode,
        },
      }),
      n.on(F.MEDIA_ATTACHING, this.onMediaAttaching, this),
      n.on(F.MEDIA_DETACHING, this.onMediaDetaching, this),
      n.on(F.MANIFEST_LOADING, this.onManifestLoading, this),
      n.on(F.MANIFEST_LOADED, this.onManifestLoaded, this),
      n.on(F.SUBTITLE_TRACKS_UPDATED, this.onSubtitleTracksUpdated, this),
      n.on(F.FRAG_LOADING, this.onFragLoading, this),
      n.on(F.FRAG_LOADED, this.onFragLoaded, this),
      n.on(F.FRAG_PARSING_USERDATA, this.onFragParsingUserdata, this),
      n.on(F.FRAG_DECRYPTED, this.onFragDecrypted, this),
      n.on(F.INIT_PTS_FOUND, this.onInitPtsFound, this),
      n.on(F.SUBTITLE_TRACKS_CLEARED, this.onSubtitleTracksCleared, this),
      n.on(F.BUFFER_FLUSHING, this.onBufferFlushing, this));
  }
  destroy() {
    const { hls: n } = this;
    (n.off(F.MEDIA_ATTACHING, this.onMediaAttaching, this),
      n.off(F.MEDIA_DETACHING, this.onMediaDetaching, this),
      n.off(F.MANIFEST_LOADING, this.onManifestLoading, this),
      n.off(F.MANIFEST_LOADED, this.onManifestLoaded, this),
      n.off(F.SUBTITLE_TRACKS_UPDATED, this.onSubtitleTracksUpdated, this),
      n.off(F.FRAG_LOADING, this.onFragLoading, this),
      n.off(F.FRAG_LOADED, this.onFragLoaded, this),
      n.off(F.FRAG_PARSING_USERDATA, this.onFragParsingUserdata, this),
      n.off(F.FRAG_DECRYPTED, this.onFragDecrypted, this),
      n.off(F.INIT_PTS_FOUND, this.onInitPtsFound, this),
      n.off(F.SUBTITLE_TRACKS_CLEARED, this.onSubtitleTracksCleared, this),
      n.off(F.BUFFER_FLUSHING, this.onBufferFlushing, this),
      (this.hls = this.config = this.media = null),
      (this.cea608Parser1 = this.cea608Parser2 = void 0));
  }
  initCea608Parsers() {
    const n = new eg(this, "textTrack1"),
      i = new eg(this, "textTrack2"),
      o = new eg(this, "textTrack3"),
      l = new eg(this, "textTrack4");
    ((this.cea608Parser1 = new Gb(1, n, i)), (this.cea608Parser2 = new Gb(3, o, l)));
  }
  addCues(n, i, o, l, h) {
    let p = !1;
    for (let d = h.length; d--; ) {
      const y = h[d],
        v = Sz(y[0], y[1], i, o);
      if (v >= 0 && ((y[0] = Math.min(y[0], i)), (y[1] = Math.max(y[1], o)), (p = !0), v / (o - i) > 0.5))
        return;
    }
    if ((p || h.push([i, o]), this.config.renderTextTracksNatively)) {
      const d = this.captionsTracks[n];
      this.Cues.newCue(d, i, o, l);
    } else {
      const d = this.Cues.newCue(null, i, o, l);
      this.hls.trigger(F.CUES_PARSED, { type: "captions", cues: d, track: n });
    }
  }
  onInitPtsFound(n, { frag: i, id: o, initPTS: l, timescale: h, trackId: p }) {
    const { unparsedVttFrags: d } = this;
    (o === Xe.MAIN && (this.initPTS[i.cc] = { baseTime: l, timescale: h, trackId: p }),
      d.length &&
        ((this.unparsedVttFrags = []),
        d.forEach(y => {
          this.initPTS[y.frag.cc]
            ? this.onFragLoaded(F.FRAG_LOADED, y)
            : this.hls.trigger(F.SUBTITLE_FRAG_PROCESSED, {
                success: !1,
                frag: y.frag,
                error: new Error("Subtitle discontinuity domain does not match main"),
              });
        })));
  }
  getExistingTrack(n, i) {
    const { media: o } = this;
    if (o)
      for (let l = 0; l < o.textTracks.length; l++) {
        const h = o.textTracks[l];
        if (
          Kb(h, { name: n, lang: i, characteristics: "transcribes-spoken-dialog,describes-music-and-sound" })
        )
          return h;
      }
    return null;
  }
  createCaptionsTrack(n) {
    this.config.renderTextTracksNatively ? this.createNativeTrack(n) : this.createNonNativeTrack(n);
  }
  createNativeTrack(n) {
    if (this.captionsTracks[n]) return;
    const { captionsProperties: i, captionsTracks: o, media: l } = this,
      { label: h, languageCode: p } = i[n],
      d = this.getExistingTrack(h, p);
    if (d) ((o[n] = d), tu(o[n]), UM(o[n], l));
    else {
      const y = this.createTextTrack("captions", h, p);
      y && ((y[n] = !0), (o[n] = y));
    }
  }
  createNonNativeTrack(n) {
    if (this.nonNativeCaptionsTracks[n]) return;
    const i = this.captionsProperties[n];
    if (!i) return;
    const o = i.label,
      l = {
        _id: n,
        label: o,
        kind: "captions",
        default: i.media ? !!i.media.default : !1,
        closedCaptions: i.media,
      };
    ((this.nonNativeCaptionsTracks[n] = l),
      this.hls.trigger(F.NON_NATIVE_TEXT_TRACKS_FOUND, { tracks: [l] }));
  }
  createTextTrack(n, i, o) {
    const l = this.media;
    if (l) return l.addTextTrack(n, i, o);
  }
  onMediaAttaching(n, i) {
    ((this.media = i.media), i.mediaSource || this._cleanTracks());
  }
  onMediaDetaching(n, i) {
    const o = !!i.transferMedia;
    if (((this.media = null), o)) return;
    const { captionsTracks: l } = this;
    (Object.keys(l).forEach(h => {
      (tu(l[h]), delete l[h]);
    }),
      (this.nonNativeCaptionsTracks = {}));
  }
  onManifestLoading() {
    ((this.lastCc = -1),
      (this.lastSn = -1),
      (this.lastPartIndex = -1),
      (this.prevCC = -1),
      (this.vttCCs = Wb()),
      this._cleanTracks(),
      (this.tracks = []),
      (this.captionsTracks = {}),
      (this.nonNativeCaptionsTracks = {}),
      (this.textTracks = []),
      (this.unparsedVttFrags = []),
      (this.initPTS = []),
      this.cea608Parser1 && this.cea608Parser2 && (this.cea608Parser1.reset(), this.cea608Parser2.reset()));
  }
  _cleanTracks() {
    const { media: n } = this;
    if (!n) return;
    const i = n.textTracks;
    if (i) for (let o = 0; o < i.length; o++) tu(i[o]);
  }
  onSubtitleTracksUpdated(n, i) {
    const o = i.subtitleTracks || [],
      l = o.some(h => h.textCodec === Vx);
    if (this.config.enableWebVTT || (l && this.config.enableIMSC1)) {
      if (wM(this.tracks, o)) {
        this.tracks = o;
        return;
      }
      if (((this.textTracks = []), (this.tracks = o), this.config.renderTextTracksNatively)) {
        const p = this.media,
          d = p ? xg(p.textTracks) : null;
        if (
          (this.tracks.forEach((y, v) => {
            let T;
            if (d) {
              let S = null;
              for (let w = 0; w < d.length; w++)
                if (d[w] && Kb(d[w], y)) {
                  ((S = d[w]), (d[w] = null));
                  break;
                }
              S && (T = S);
            }
            if (T) tu(T);
            else {
              const S = XM(y);
              ((T = this.createTextTrack(S, y.name, y.lang)), T && (T.mode = "disabled"));
            }
            T && this.textTracks.push(T);
          }),
          d != null && d.length)
        ) {
          const y = d.filter(v => v !== null).map(v => v.label);
          y.length &&
            this.hls.logger.warn(
              "Media element contains unused subtitle tracks: ".concat(
                y.join(", "),
                ". Replace media element for each source to clear TextTracks and captions menu.",
              ),
            );
        }
      } else if (this.tracks.length) {
        const p = this.tracks.map(d => ({
          label: d.name,
          kind: d.type.toLowerCase(),
          default: d.default,
          subtitleTrack: d,
        }));
        this.hls.trigger(F.NON_NATIVE_TEXT_TRACKS_FOUND, { tracks: p });
      }
    }
  }
  onManifestLoaded(n, i) {
    this.config.enableCEA708Captions &&
      i.captions &&
      i.captions.forEach(o => {
        const l = /(?:CC|SERVICE)([1-4])/.exec(o.instreamId);
        if (!l) return;
        const h = "textTrack".concat(l[1]),
          p = this.captionsProperties[h];
        p && ((p.label = o.name), o.lang && (p.languageCode = o.lang), (p.media = o));
      });
  }
  closedCaptionsForLevel(n) {
    const i = this.hls.levels[n.level];
    return i == null ? void 0 : i.attrs["CLOSED-CAPTIONS"];
  }
  onFragLoading(n, i) {
    if (this.enabled && i.frag.type === Xe.MAIN) {
      var o, l;
      const { cea608Parser1: h, cea608Parser2: p, lastSn: d } = this,
        { cc: y, sn: v } = i.frag,
        T = (o = (l = i.part) == null ? void 0 : l.index) != null ? o : -1;
      (h &&
        p &&
        (v !== d + 1 || (v === d && T !== this.lastPartIndex + 1) || y !== this.lastCc) &&
        (h.reset(), p.reset()),
        (this.lastCc = y),
        (this.lastSn = v),
        (this.lastPartIndex = T));
    }
  }
  onFragLoaded(n, i) {
    const { frag: o, payload: l } = i;
    if (o.type === Xe.SUBTITLE)
      if (l.byteLength) {
        const h = o.decryptdata,
          p = "stats" in i;
        if (h == null || !h.encrypted || p) {
          const d = this.tracks[o.level],
            y = this.vttCCs;
          (y[o.cc] || ((y[o.cc] = { start: o.start, prevCC: this.prevCC, new: !0 }), (this.prevCC = o.cc)),
            d && d.textCodec === Vx ? this._parseIMSC1(o, l) : this._parseVTTs(i));
        }
      } else
        this.hls.trigger(F.SUBTITLE_FRAG_PROCESSED, {
          success: !1,
          frag: o,
          error: new Error("Empty subtitle payload"),
        });
  }
  _parseIMSC1(n, i) {
    const o = this.hls;
    jb(
      i,
      this.initPTS[n.cc],
      l => {
        (this._appendCues(l, n.level), o.trigger(F.SUBTITLE_FRAG_PROCESSED, { success: !0, frag: n }));
      },
      l => {
        (o.logger.log("Failed to parse IMSC1: ".concat(l)),
          o.trigger(F.SUBTITLE_FRAG_PROCESSED, { success: !1, frag: n, error: l }));
      },
    );
  }
  _parseVTTs(n) {
    var i;
    const { frag: o, payload: l } = n,
      { initPTS: h, unparsedVttFrags: p } = this,
      d = h.length - 1;
    if (!h[o.cc] && d === -1) {
      p.push(n);
      return;
    }
    const y = this.hls,
      v = (i = o.initSegment) != null && i.data ? Mr(o.initSegment.data, new Uint8Array(l)).buffer : l;
    pz(
      v,
      this.initPTS[o.cc],
      this.vttCCs,
      o.cc,
      o.start,
      T => {
        (this._appendCues(T, o.level), y.trigger(F.SUBTITLE_FRAG_PROCESSED, { success: !0, frag: o }));
      },
      T => {
        const S = T.message === "Missing initPTS for VTT MPEGTS";
        (S ? p.push(n) : this._fallbackToIMSC1(o, l),
          y.logger.log("Failed to parse VTT cue: ".concat(T)),
          !(S && d > o.cc) && y.trigger(F.SUBTITLE_FRAG_PROCESSED, { success: !1, frag: o, error: T }));
      },
    );
  }
  _fallbackToIMSC1(n, i) {
    const o = this.tracks[n.level];
    o.textCodec ||
      jb(
        i,
        this.initPTS[n.cc],
        () => {
          ((o.textCodec = Vx), this._parseIMSC1(n, i));
        },
        () => {
          o.textCodec = "wvtt";
        },
      );
  }
  _appendCues(n, i) {
    const o = this.hls;
    if (this.config.renderTextTracksNatively) {
      const l = this.textTracks[i];
      if (!l || l.mode === "disabled") return;
      n.forEach(h => BM(l, h));
    } else {
      const l = this.tracks[i];
      if (!l) return;
      const h = l.default ? "default" : "subtitles" + i;
      o.trigger(F.CUES_PARSED, { type: "subtitles", cues: n, track: h });
    }
  }
  onFragDecrypted(n, i) {
    const { frag: o } = i;
    o.type === Xe.SUBTITLE && this.onFragLoaded(F.FRAG_LOADED, i);
  }
  onSubtitleTracksCleared() {
    ((this.tracks = []), (this.captionsTracks = {}));
  }
  onFragParsingUserdata(n, i) {
    if (!this.enabled || !this.config.enableCEA708Captions) return;
    const { frag: o, samples: l } = i;
    if (!(o.type === Xe.MAIN && this.closedCaptionsForLevel(o) === "NONE"))
      for (let h = 0; h < l.length; h++) {
        const p = l[h].bytes;
        if (p) {
          this.cea608Parser1 || this.initCea608Parsers();
          const d = this.extractCea608Data(p);
          (this.cea608Parser1.addData(l[h].pts, d[0]), this.cea608Parser2.addData(l[h].pts, d[1]));
        }
      }
  }
  onBufferFlushing(n, { startOffset: i, endOffset: o, endOffsetSubtitles: l, type: h }) {
    const { media: p } = this;
    if (!(!p || p.currentTime < o)) {
      if (!h || h === "video") {
        const { captionsTracks: d } = this;
        Object.keys(d).forEach(y => BT(d[y], i, o));
      }
      if (this.config.renderTextTracksNatively && i === 0 && l !== void 0) {
        const { textTracks: d } = this;
        Object.keys(d).forEach(y => BT(d[y], i, l));
      }
    }
  }
  extractCea608Data(n) {
    const i = [[], []],
      o = n[0] & 31;
    let l = 2;
    for (let h = 0; h < o; h++) {
      const p = n[l++],
        d = 127 & n[l++],
        y = 127 & n[l++];
      if (d === 0 && y === 0) continue;
      if ((4 & p) !== 0) {
        const T = 3 & p;
        (T === 0 || T === 1) && (i[T].push(d), i[T].push(y));
      }
    }
    return i;
  }
}
function XM(u) {
  return u.characteristics &&
    /transcribes-spoken-dialog/gi.test(u.characteristics) &&
    /describes-music-and-sound/gi.test(u.characteristics)
    ? "captions"
    : "subtitles";
}
function Kb(u, n) {
  return !!u && u.kind === XM(n) && OT(n, u);
}
function Sz(u, n, i, o) {
  return Math.min(n, o) - Math.max(u, i);
}
function Wb() {
  return { ccOffset: 0, presentationOffset: 0, 0: { start: 0, prevCC: -1, new: !0 } };
}
const Ez = /\s/,
  Az = {
    newCue(u, n, i, o) {
      const l = [];
      let h, p, d, y, v;
      const T = self.VTTCue || self.TextTrackCue;
      for (let w = 0; w < o.rows.length; w++)
        if (((h = o.rows[w]), (d = !0), (y = 0), (v = ""), !h.isEmpty())) {
          var S;
          for (let k = 0; k < h.chars.length; k++)
            Ez.test(h.chars[k].uchar) && d ? y++ : ((v += h.chars[k].uchar), (d = !1));
          ((h.cueStartTime = n), n === i && (i += 1e-4), y >= 16 ? y-- : y++);
          const C = KM(v.trim()),
            L = bS(n, i, C);
          (u != null && (S = u.cues) != null && S.getCueById(L)) ||
            ((p = new T(n, i, C)),
            (p.id = L),
            (p.line = w + 1),
            (p.align = "left"),
            (p.position = 10 + Math.min(80, Math.floor((y * 8) / 32) * 10)),
            l.push(p));
        }
      return (
        u &&
          l.length &&
          (l.sort((w, C) =>
            w.line === "auto" || C.line === "auto"
              ? 0
              : w.line > 8 && C.line > 8
                ? C.line - w.line
                : w.line - C.line,
          ),
          l.forEach(w => BM(u, w))),
        l
      );
    },
  };
function Iz() {
  if (self.fetch && self.AbortController && self.ReadableStream && self.Request)
    try {
      return (new self.ReadableStream({}), !0);
    } catch (u) {}
  return !1;
}
const wz = /(\d+)-(\d+)\/(\d+)/;
class zb {
  constructor(n) {
    ((this.fetchSetup = void 0),
      (this.requestTimeout = void 0),
      (this.request = null),
      (this.response = null),
      (this.controller = void 0),
      (this.context = null),
      (this.config = null),
      (this.callbacks = null),
      (this.stats = void 0),
      (this.loader = null),
      (this.fetchSetup = n.fetchSetup || _z),
      (this.controller = new self.AbortController()),
      (this.stats = new lS()));
  }
  destroy() {
    ((this.loader = this.callbacks = this.context = this.config = this.request = null),
      this.abortInternal(),
      (this.response = null),
      (this.fetchSetup = this.controller = this.stats = null));
  }
  abortInternal() {
    this.controller && !this.stats.loading.end && ((this.stats.aborted = !0), this.controller.abort());
  }
  abort() {
    var n;
    (this.abortInternal(),
      (n = this.callbacks) != null &&
        n.onAbort &&
        this.callbacks.onAbort(this.stats, this.context, this.response));
  }
  load(n, i, o) {
    const l = this.stats;
    if (l.loading.start) throw new Error("Loader can only be used once.");
    l.loading.start = self.performance.now();
    const h = Rz(n, this.controller.signal),
      p = n.responseType === "arraybuffer",
      d = p ? "byteLength" : "length",
      { maxTimeToFirstByteMs: y, maxLoadTimeMs: v } = i.loadPolicy;
    ((this.context = n),
      (this.config = i),
      (this.callbacks = o),
      (this.request = this.fetchSetup(n, h)),
      self.clearTimeout(this.requestTimeout),
      (i.timeout = y && Ue(y) ? y : v),
      (this.requestTimeout = self.setTimeout(() => {
        this.callbacks && (this.abortInternal(), this.callbacks.onTimeout(l, n, this.response));
      }, i.timeout)),
      (Dd(this.request) ? this.request.then(self.fetch) : self.fetch(this.request))
        .then(S => {
          var w;
          this.response = this.loader = S;
          const C = Math.max(self.performance.now(), l.loading.start);
          if (
            (self.clearTimeout(this.requestTimeout),
            (i.timeout = v),
            (this.requestTimeout = self.setTimeout(
              () => {
                this.callbacks && (this.abortInternal(), this.callbacks.onTimeout(l, n, this.response));
              },
              v - (C - l.loading.start),
            )),
            !S.ok)
          ) {
            const { status: k, statusText: O } = S;
            throw new bz(O || "fetch, bad network response", k, S);
          }
          ((l.loading.first = C), (l.total = Lz(S.headers) || l.total));
          const L = (w = this.callbacks) == null ? void 0 : w.onProgress;
          return L && Ue(i.highWaterMark)
            ? this.loadProgressively(S, l, n, i.highWaterMark, L)
            : p
              ? S.arrayBuffer()
              : n.responseType === "json"
                ? S.json()
                : S.text();
        })
        .then(S => {
          var w, C;
          const L = this.response;
          if (!L) throw new Error("loader destroyed");
          (self.clearTimeout(this.requestTimeout),
            (l.loading.end = Math.max(self.performance.now(), l.loading.first)));
          const k = S[d];
          k && (l.loaded = l.total = k);
          const O = { url: L.url, data: S, code: L.status },
            B = (w = this.callbacks) == null ? void 0 : w.onProgress;
          (B && !Ue(i.highWaterMark) && B(l, n, S, L),
            (C = this.callbacks) == null || C.onSuccess(O, l, n, L));
        })
        .catch(S => {
          var w;
          if ((self.clearTimeout(this.requestTimeout), l.aborted)) return;
          const C = (S && S.code) || 0,
            L = S ? S.message : null;
          (w = this.callbacks) == null || w.onError({ code: C, text: L }, n, S ? S.details : null, l);
        }));
  }
  getCacheAge() {
    let n = null;
    if (this.response) {
      const i = this.response.headers.get("age");
      n = i ? parseFloat(i) : null;
    }
    return n;
  }
  getResponseHeader(n) {
    return this.response ? this.response.headers.get(n) : null;
  }
  loadProgressively(n, i, o, l = 0, h) {
    const p = new sM(),
      d = n.body.getReader(),
      y = () =>
        d
          .read()
          .then(v => {
            if (v.done)
              return (p.dataLength && h(i, o, p.flush().buffer, n), Promise.resolve(new ArrayBuffer(0)));
            const T = v.value,
              S = T.length;
            return (
              (i.loaded += S),
              S < l || p.dataLength
                ? (p.push(T), p.dataLength >= l && h(i, o, p.flush().buffer, n))
                : h(i, o, T.buffer, n),
              y()
            );
          })
          .catch(() => Promise.reject());
    return y();
  }
}
function Rz(u, n) {
  const i = {
    method: "GET",
    mode: "cors",
    credentials: "same-origin",
    signal: n,
    headers: new self.Headers(rn({}, u.headers)),
  };
  return (u.rangeEnd && i.headers.set("Range", "bytes=" + u.rangeStart + "-" + String(u.rangeEnd - 1)), i);
}
function Cz(u) {
  const n = wz.exec(u);
  if (n) return parseInt(n[2]) - parseInt(n[1]) + 1;
}
function Lz(u) {
  const n = u.get("Content-Range");
  if (n) {
    const o = Cz(n);
    if (Ue(o)) return o;
  }
  const i = u.get("Content-Length");
  if (i) return parseInt(i);
}
function _z(u, n) {
  return new self.Request(u.url, n);
}
class bz extends Error {
  constructor(n, i, o) {
    (super(n), (this.code = void 0), (this.details = void 0), (this.code = i), (this.details = o));
  }
}
const Dz = /^age:\s*[\d.]+\s*$/im;
class qM {
  constructor(n) {
    ((this.xhrSetup = void 0),
      (this.requestTimeout = void 0),
      (this.retryTimeout = void 0),
      (this.retryDelay = void 0),
      (this.config = null),
      (this.callbacks = null),
      (this.context = null),
      (this.loader = null),
      (this.stats = void 0),
      (this.xhrSetup = (n && n.xhrSetup) || null),
      (this.stats = new lS()),
      (this.retryDelay = 0));
  }
  destroy() {
    ((this.callbacks = null),
      this.abortInternal(),
      (this.loader = null),
      (this.config = null),
      (this.context = null),
      (this.xhrSetup = null));
  }
  abortInternal() {
    const n = this.loader;
    (self.clearTimeout(this.requestTimeout),
      self.clearTimeout(this.retryTimeout),
      n &&
        ((n.onreadystatechange = null),
        (n.onprogress = null),
        n.readyState !== 4 && ((this.stats.aborted = !0), n.abort())));
  }
  abort() {
    var n;
    (this.abortInternal(),
      (n = this.callbacks) != null &&
        n.onAbort &&
        this.callbacks.onAbort(this.stats, this.context, this.loader));
  }
  load(n, i, o) {
    if (this.stats.loading.start) throw new Error("Loader can only be used once.");
    ((this.stats.loading.start = self.performance.now()),
      (this.context = n),
      (this.config = i),
      (this.callbacks = o),
      this.loadInternal());
  }
  loadInternal() {
    const { config: n, context: i } = this;
    if (!n || !i) return;
    const o = (this.loader = new self.XMLHttpRequest()),
      l = this.stats;
    ((l.loading.first = 0), (l.loaded = 0), (l.aborted = !1));
    const h = this.xhrSetup;
    h
      ? Promise.resolve()
          .then(() => {
            if (!(this.loader !== o || this.stats.aborted)) return h(o, i.url);
          })
          .catch(p => {
            if (!(this.loader !== o || this.stats.aborted)) return (o.open("GET", i.url, !0), h(o, i.url));
          })
          .then(() => {
            this.loader !== o || this.stats.aborted || this.openAndSendXhr(o, i, n);
          })
          .catch(p => {
            var d;
            (d = this.callbacks) == null || d.onError({ code: o.status, text: p.message }, i, o, l);
          })
      : this.openAndSendXhr(o, i, n);
  }
  openAndSendXhr(n, i, o) {
    n.readyState || n.open("GET", i.url, !0);
    const l = i.headers,
      { maxTimeToFirstByteMs: h, maxLoadTimeMs: p } = o.loadPolicy;
    if (l) for (const d in l) n.setRequestHeader(d, l[d]);
    (i.rangeEnd && n.setRequestHeader("Range", "bytes=" + i.rangeStart + "-" + (i.rangeEnd - 1)),
      (n.onreadystatechange = this.readystatechange.bind(this)),
      (n.onprogress = this.loadprogress.bind(this)),
      (n.responseType = i.responseType),
      self.clearTimeout(this.requestTimeout),
      (o.timeout = h && Ue(h) ? h : p),
      (this.requestTimeout = self.setTimeout(this.loadtimeout.bind(this), o.timeout)),
      n.send());
  }
  readystatechange() {
    const { context: n, loader: i, stats: o } = this;
    if (!n || !i) return;
    const l = i.readyState,
      h = this.config;
    if (
      !o.aborted &&
      l >= 2 &&
      (o.loading.first === 0 &&
        ((o.loading.first = Math.max(self.performance.now(), o.loading.start)),
        h.timeout !== h.loadPolicy.maxLoadTimeMs &&
          (self.clearTimeout(this.requestTimeout),
          (h.timeout = h.loadPolicy.maxLoadTimeMs),
          (this.requestTimeout = self.setTimeout(
            this.loadtimeout.bind(this),
            h.loadPolicy.maxLoadTimeMs - (o.loading.first - o.loading.start),
          )))),
      l === 4)
    ) {
      (self.clearTimeout(this.requestTimeout), (i.onreadystatechange = null), (i.onprogress = null));
      const v = i.status,
        T = i.responseType === "text" ? i.responseText : null;
      if (v >= 200 && v < 300) {
        const L = T != null ? T : i.response;
        if (L != null) {
          var p, d;
          o.loading.end = Math.max(self.performance.now(), o.loading.first);
          const k = i.responseType === "arraybuffer" ? L.byteLength : L.length;
          ((o.loaded = o.total = k), (o.bwEstimate = (o.total * 8e3) / (o.loading.end - o.loading.first)));
          const O = (p = this.callbacks) == null ? void 0 : p.onProgress;
          O && O(o, n, L, i);
          const B = { url: i.responseURL, data: L, code: v };
          (d = this.callbacks) == null || d.onSuccess(B, o, n, i);
          return;
        }
      }
      const S = h.loadPolicy.errorRetry,
        w = o.retry,
        C = { url: n.url, data: void 0, code: v };
      if ($g(S, w, !1, C)) this.retry(S);
      else {
        var y;
        (Zt.error("".concat(v, " while loading ").concat(n.url)),
          (y = this.callbacks) == null || y.onError({ code: v, text: i.statusText }, n, i, o));
      }
    }
  }
  loadtimeout() {
    if (!this.config) return;
    const n = this.config.loadPolicy.timeoutRetry,
      i = this.stats.retry;
    if ($g(n, i, !0)) this.retry(n);
    else {
      var o;
      Zt.warn("timeout while loading ".concat((o = this.context) == null ? void 0 : o.url));
      const l = this.callbacks;
      l && (this.abortInternal(), l.onTimeout(this.stats, this.context, this.loader));
    }
  }
  retry(n) {
    const { context: i, stats: o } = this;
    ((this.retryDelay = hS(n, o.retry)),
      o.retry++,
      Zt.warn(
        ""
          .concat(status ? "HTTP Status " + status : "Timeout", " while loading ")
          .concat(i == null ? void 0 : i.url, ", retrying ")
          .concat(o.retry, "/")
          .concat(n.maxNumRetry, " in ")
          .concat(this.retryDelay, "ms"),
      ),
      this.abortInternal(),
      (this.loader = null),
      self.clearTimeout(this.retryTimeout),
      (this.retryTimeout = self.setTimeout(this.loadInternal.bind(this), this.retryDelay)));
  }
  loadprogress(n) {
    const i = this.stats;
    ((i.loaded = n.loaded), n.lengthComputable && (i.total = n.total));
  }
  getCacheAge() {
    let n = null;
    if (this.loader && Dz.test(this.loader.getAllResponseHeaders())) {
      const i = this.loader.getResponseHeader("age");
      n = i ? parseFloat(i) : null;
    }
    return n;
  }
  getResponseHeader(n) {
    return this.loader &&
      new RegExp("^".concat(n, ":\\s*[\\d.]+\\s*$"), "im").test(this.loader.getAllResponseHeaders())
      ? this.loader.getResponseHeader(n)
      : null;
  }
}
const kz = { maxTimeToFirstByteMs: 8e3, maxLoadTimeMs: 2e4, timeoutRetry: null, errorRetry: null },
  Mz = Jt(
    Jt(
      {
        autoStartLoad: !0,
        startPosition: -1,
        defaultAudioCodec: void 0,
        debug: !1,
        capLevelOnFPSDrop: !1,
        capLevelToPlayerSize: !1,
        ignoreDevicePixelRatio: !1,
        maxDevicePixelRatio: Number.POSITIVE_INFINITY,
        preferManagedMediaSource: !0,
        initialLiveManifestSize: 1,
        maxBufferLength: 30,
        backBufferLength: 1 / 0,
        frontBufferFlushThreshold: 1 / 0,
        startOnSegmentBoundary: !1,
        maxBufferSize: 60 * 1e3 * 1e3,
        maxFragLookUpTolerance: 0.25,
        maxBufferHole: 0.1,
        detectStallWithCurrentTimeMs: 1250,
        highBufferWatchdogPeriod: 2,
        nudgeOffset: 0.1,
        nudgeMaxRetry: 3,
        nudgeOnVideoHole: !0,
        liveSyncMode: "edge",
        liveSyncDurationCount: 3,
        liveSyncOnStallIncrease: 1,
        liveMaxLatencyDurationCount: 1 / 0,
        liveSyncDuration: void 0,
        liveMaxLatencyDuration: void 0,
        maxLiveSyncPlaybackRate: 1,
        liveDurationInfinity: !1,
        liveBackBufferLength: null,
        maxMaxBufferLength: 600,
        enableWorker: !0,
        workerPath: null,
        enableSoftwareAES: !0,
        startLevel: void 0,
        startFragPrefetch: !1,
        fpsDroppedMonitoringPeriod: 5e3,
        fpsDroppedMonitoringThreshold: 0.2,
        appendErrorMaxRetry: 3,
        ignorePlaylistParsingErrors: !1,
        loader: qM,
        fLoader: void 0,
        pLoader: void 0,
        xhrSetup: void 0,
        licenseXhrSetup: void 0,
        licenseResponseCallback: void 0,
        abrController: KH,
        bufferController: O9,
        capLevelController: RS,
        errorController: qH,
        fpsController: NW,
        stretchShortVideoTrack: !1,
        maxAudioFramesDrift: 1,
        forceKeyFrameOnDiscontinuity: !0,
        abrEwmaFastLive: 3,
        abrEwmaSlowLive: 9,
        abrEwmaFastVoD: 3,
        abrEwmaSlowVoD: 9,
        abrEwmaDefaultEstimate: 5e5,
        abrEwmaDefaultEstimateMax: 5e6,
        abrBandWidthFactor: 0.95,
        abrBandWidthUpFactor: 0.7,
        abrMaxWithRealBitrate: !1,
        maxStarvationDelay: 4,
        maxLoadingDelay: 4,
        minAutoBitrate: 0,
        emeEnabled: !1,
        widevineLicenseUrl: void 0,
        drmSystems: {},
        drmSystemOptions: {},
        requestMediaKeySystemAccessFunc: Yk,
        requireKeySystemAccessOnStart: !1,
        testBandwidth: !0,
        progressive: !1,
        lowLatencyMode: !0,
        cmcd: void 0,
        enableDateRangeMetadataCues: !0,
        enableEmsgMetadataCues: !0,
        enableEmsgKLVMetadata: !1,
        enableID3MetadataCues: !0,
        enableInterstitialPlayback: !0,
        interstitialAppendInPlace: !0,
        interstitialLiveLookAhead: 10,
        useMediaCapabilities: !0,
        preserveManualLevelOnError: !1,
        certLoadPolicy: { default: kz },
        keyLoadPolicy: {
          default: {
            maxTimeToFirstByteMs: 8e3,
            maxLoadTimeMs: 2e4,
            timeoutRetry: { maxNumRetry: 1, retryDelayMs: 1e3, maxRetryDelayMs: 2e4, backoff: "linear" },
            errorRetry: { maxNumRetry: 8, retryDelayMs: 1e3, maxRetryDelayMs: 2e4, backoff: "linear" },
          },
        },
        manifestLoadPolicy: {
          default: {
            maxTimeToFirstByteMs: 1 / 0,
            maxLoadTimeMs: 2e4,
            timeoutRetry: { maxNumRetry: 2, retryDelayMs: 0, maxRetryDelayMs: 0 },
            errorRetry: { maxNumRetry: 1, retryDelayMs: 1e3, maxRetryDelayMs: 8e3 },
          },
        },
        playlistLoadPolicy: {
          default: {
            maxTimeToFirstByteMs: 1e4,
            maxLoadTimeMs: 2e4,
            timeoutRetry: { maxNumRetry: 2, retryDelayMs: 0, maxRetryDelayMs: 0 },
            errorRetry: { maxNumRetry: 2, retryDelayMs: 1e3, maxRetryDelayMs: 8e3 },
          },
        },
        fragLoadPolicy: {
          default: {
            maxTimeToFirstByteMs: 1e4,
            maxLoadTimeMs: 12e4,
            timeoutRetry: { maxNumRetry: 4, retryDelayMs: 0, maxRetryDelayMs: 0 },
            errorRetry: { maxNumRetry: 6, retryDelayMs: 1e3, maxRetryDelayMs: 8e3 },
          },
        },
        steeringManifestLoadPolicy: {
          default: {
            maxTimeToFirstByteMs: 1e4,
            maxLoadTimeMs: 2e4,
            timeoutRetry: { maxNumRetry: 2, retryDelayMs: 0, maxRetryDelayMs: 0 },
            errorRetry: { maxNumRetry: 1, retryDelayMs: 1e3, maxRetryDelayMs: 8e3 },
          },
        },
        interstitialAssetListLoadPolicy: {
          default: {
            maxTimeToFirstByteMs: 1e4,
            maxLoadTimeMs: 3e4,
            timeoutRetry: { maxNumRetry: 0, retryDelayMs: 0, maxRetryDelayMs: 0 },
            errorRetry: { maxNumRetry: 0, retryDelayMs: 1e3, maxRetryDelayMs: 8e3 },
          },
        },
        manifestLoadingTimeOut: 1e4,
        manifestLoadingMaxRetry: 1,
        manifestLoadingRetryDelay: 1e3,
        manifestLoadingMaxRetryTimeout: 64e3,
        levelLoadingTimeOut: 1e4,
        levelLoadingMaxRetry: 4,
        levelLoadingRetryDelay: 1e3,
        levelLoadingMaxRetryTimeout: 64e3,
        fragLoadingTimeOut: 2e4,
        fragLoadingMaxRetry: 6,
        fragLoadingRetryDelay: 1e3,
        fragLoadingMaxRetryTimeout: 64e3,
      },
      Pz(),
    ),
    {},
    {
      subtitleStreamController: YW,
      subtitleTrackController: BW,
      timelineController: Tz,
      audioStreamController: D9,
      audioTrackController: k9,
      emeController: au,
      cmcdController: kW,
      contentSteeringController: PW,
      interstitialsController: zW,
    },
  );
function Pz() {
  return {
    cueHandler: Az,
    enableWebVTT: !0,
    enableIMSC1: !0,
    enableCEA708Captions: !0,
    captionsTextTrack1Label: "English",
    captionsTextTrack1LanguageCode: "en",
    captionsTextTrack2Label: "Spanish",
    captionsTextTrack2LanguageCode: "es",
    captionsTextTrack3Label: "Unknown CC",
    captionsTextTrack3LanguageCode: "",
    captionsTextTrack4Label: "Unknown CC",
    captionsTextTrack4LanguageCode: "",
    renderTextTracksNatively: !0,
  };
}
function Oz(u, n, i) {
  if (
    (n.liveSyncDurationCount || n.liveMaxLatencyDurationCount) &&
    (n.liveSyncDuration || n.liveMaxLatencyDuration)
  )
    throw new Error(
      "Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration",
    );
  if (
    n.liveMaxLatencyDurationCount !== void 0 &&
    (n.liveSyncDurationCount === void 0 || n.liveMaxLatencyDurationCount <= n.liveSyncDurationCount)
  )
    throw new Error(
      'Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"',
    );
  if (
    n.liveMaxLatencyDuration !== void 0 &&
    (n.liveSyncDuration === void 0 || n.liveMaxLatencyDuration <= n.liveSyncDuration)
  )
    throw new Error(
      'Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"',
    );
  const o = GT(u),
    l = ["manifest", "level", "frag"],
    h = ["TimeOut", "MaxRetry", "RetryDelay", "MaxRetryTimeout"];
  return (
    l.forEach(p => {
      const d = "".concat(p === "level" ? "playlist" : p, "LoadPolicy"),
        y = n[d] === void 0,
        v = [];
      (h.forEach(T => {
        const S = "".concat(p, "Loading").concat(T),
          w = n[S];
        if (w !== void 0 && y) {
          v.push(S);
          const C = o[d].default;
          switch (((n[d] = { default: C }), T)) {
            case "TimeOut":
              ((C.maxLoadTimeMs = w), (C.maxTimeToFirstByteMs = w));
              break;
            case "MaxRetry":
              ((C.errorRetry.maxNumRetry = w), (C.timeoutRetry.maxNumRetry = w));
              break;
            case "RetryDelay":
              ((C.errorRetry.retryDelayMs = w), (C.timeoutRetry.retryDelayMs = w));
              break;
            case "MaxRetryTimeout":
              ((C.errorRetry.maxRetryDelayMs = w), (C.timeoutRetry.maxRetryDelayMs = w));
              break;
          }
        }
      }),
        v.length &&
          i.warn(
            'hls.js config: "'
              .concat(v.join('", "'), '" setting(s) are deprecated, use "')
              .concat(d, '": ')
              .concat(ln(n[d])),
          ));
    }),
    Jt(Jt({}, o), n)
  );
}
function GT(u) {
  return u && typeof u == "object"
    ? Array.isArray(u)
      ? u.map(GT)
      : Object.keys(u).reduce((n, i) => ((n[i] = GT(u[i])), n), {})
    : u;
}
function Nz(u, n) {
  const i = u.loader;
  i !== zb && i !== qM
    ? (n.log("[config]: Custom loader detected, cannot enable progressive streaming"), (u.progressive = !1))
    : Iz() &&
      ((u.loader = zb),
      (u.progressive = !0),
      (u.enableSoftwareAES = !0),
      n.log("[config]: Progressive streaming enabled, using FetchLoader"));
}
const Tg = 2,
  Fz = 0.1,
  Uz = 0.05,
  Bz = 100;
class $z extends Vk {
  constructor(n, i) {
    (super("gap-controller", n.logger),
      (this.hls = void 0),
      (this.fragmentTracker = void 0),
      (this.media = null),
      (this.mediaSource = void 0),
      (this.nudgeRetry = 0),
      (this.stallReported = !1),
      (this.stalled = null),
      (this.moved = !1),
      (this.seeking = !1),
      (this.buffered = {}),
      (this.lastCurrentTime = 0),
      (this.ended = 0),
      (this.waiting = 0),
      (this.onMediaPlaying = () => {
        ((this.ended = 0), (this.waiting = 0));
      }),
      (this.onMediaWaiting = () => {
        var o;
        ((o = this.media) != null && o.seeking) || ((this.waiting = self.performance.now()), this.tick());
      }),
      (this.onMediaEnded = () => {
        if (this.hls) {
          var o;
          ((this.ended = ((o = this.media) == null ? void 0 : o.currentTime) || 1),
            this.hls.trigger(F.MEDIA_ENDED, { stalled: !1 }));
        }
      }),
      (this.hls = n),
      (this.fragmentTracker = i),
      this.registerListeners());
  }
  registerListeners() {
    const { hls: n } = this;
    n &&
      (n.on(F.MEDIA_ATTACHED, this.onMediaAttached, this),
      n.on(F.MEDIA_DETACHING, this.onMediaDetaching, this),
      n.on(F.BUFFER_APPENDED, this.onBufferAppended, this));
  }
  unregisterListeners() {
    const { hls: n } = this;
    n &&
      (n.off(F.MEDIA_ATTACHED, this.onMediaAttached, this),
      n.off(F.MEDIA_DETACHING, this.onMediaDetaching, this),
      n.off(F.BUFFER_APPENDED, this.onBufferAppended, this));
  }
  destroy() {
    (super.destroy(),
      this.unregisterListeners(),
      (this.media = this.hls = this.fragmentTracker = null),
      (this.mediaSource = void 0));
  }
  onMediaAttached(n, i) {
    (this.setInterval(Bz), (this.mediaSource = i.mediaSource));
    const o = (this.media = i.media);
    (ji(o, "playing", this.onMediaPlaying),
      ji(o, "waiting", this.onMediaWaiting),
      ji(o, "ended", this.onMediaEnded));
  }
  onMediaDetaching(n, i) {
    this.clearInterval();
    const { media: o } = this;
    (o &&
      (tr(o, "playing", this.onMediaPlaying),
      tr(o, "waiting", this.onMediaWaiting),
      tr(o, "ended", this.onMediaEnded),
      (this.media = null)),
      (this.mediaSource = void 0));
  }
  onBufferAppended(n, i) {
    this.buffered = i.timeRanges;
  }
  get hasBuffered() {
    return Object.keys(this.buffered).length > 0;
  }
  tick() {
    var n;
    if (!((n = this.media) != null && n.readyState) || !this.hasBuffered) return;
    const i = this.media.currentTime;
    (this.poll(i, this.lastCurrentTime), (this.lastCurrentTime = i));
  }
  poll(n, i) {
    var o, l;
    const h = (o = this.hls) == null ? void 0 : o.config;
    if (!h) return;
    const p = this.media;
    if (!p) return;
    const { seeking: d } = p,
      y = this.seeking && !d,
      v = !this.seeking && d,
      T = (p.paused && !d) || p.ended || p.playbackRate === 0;
    if (((this.seeking = d), n !== i)) {
      (i && (this.ended = 0),
        (this.moved = !0),
        d || ((this.nudgeRetry = 0), h.nudgeOnVideoHole && !T && n > i && this.nudgeOnVideoHole(n, i)),
        this.waiting === 0 && this.stallResolved(n));
      return;
    }
    if (v || y) {
      y && this.stallResolved(n);
      return;
    }
    if (T) {
      ((this.nudgeRetry = 0),
        this.stallResolved(n),
        !this.ended &&
          p.ended &&
          this.hls &&
          ((this.ended = n || 1), this.hls.trigger(F.MEDIA_ENDED, { stalled: !1 })));
      return;
    }
    if (!Tt.getBuffered(p).length) {
      this.nudgeRetry = 0;
      return;
    }
    const S = Tt.bufferInfo(p, n, 0),
      w = S.nextStart || 0,
      C = this.fragmentTracker;
    if (d && C && this.hls) {
      const oe = Yb(this.hls.inFlightFragments, n),
        Y = S.len > Tg,
        te = !w || oe || (w - n > Tg && !C.getPartialFragment(n));
      if (Y || te) return;
      this.moved = !1;
    }
    const L = (l = this.hls) == null ? void 0 : l.latestLevelDetails;
    if (!this.moved && this.stalled !== null && C) {
      if (!(S.len > 0) && !w) return;
      const Y = Math.max(w, S.start || 0) - n,
        _ = !!(L != null && L.live) ? L.targetduration * 2 : Tg,
        K = tg(n, C);
      if (Y > 0 && (Y <= _ || K)) {
        p.paused || this._trySkipBufferHole(K);
        return;
      }
    }
    const k = h.detectStallWithCurrentTimeMs,
      O = self.performance.now(),
      B = this.waiting;
    let N = this.stalled;
    if (N === null)
      if (B > 0 && O - B < k) N = this.stalled = B;
      else {
        this.stalled = O;
        return;
      }
    const $ = O - N;
    if (!d && ($ >= k || B) && this.hls) {
      var I;
      if (
        ((I = this.mediaSource) == null ? void 0 : I.readyState) === "ended" &&
        !(L != null && L.live) &&
        Math.abs(n - ((L == null ? void 0 : L.edge) || 0)) < 1
      ) {
        if (this.ended) return;
        ((this.ended = n || 1), this.hls.trigger(F.MEDIA_ENDED, { stalled: !0 }));
        return;
      }
      if ((this._reportStall(S), !this.media || !this.hls)) return;
    }
    const V = Tt.bufferInfo(p, n, h.maxBufferHole);
    this._tryFixBufferStall(V, $, n);
  }
  stallResolved(n) {
    const i = this.stalled;
    if (i && this.hls && ((this.stalled = null), this.stallReported)) {
      const o = self.performance.now() - i;
      (this.log("playback not stuck anymore @".concat(n, ", after ").concat(Math.round(o), "ms")),
        (this.stallReported = !1),
        (this.waiting = 0),
        this.hls.trigger(F.STALL_RESOLVED, {}));
    }
  }
  nudgeOnVideoHole(n, i) {
    var o;
    const l = this.buffered.video;
    if (
      this.hls &&
      this.media &&
      this.fragmentTracker &&
      (o = this.buffered.audio) != null &&
      o.length &&
      l &&
      l.length > 1 &&
      n > l.end(0)
    ) {
      const h = Tt.bufferedInfo(Tt.timeRangesToArray(this.buffered.audio), n, 0);
      if (h.len > 1 && i >= h.start) {
        const p = Tt.timeRangesToArray(l),
          d = Tt.bufferedInfo(p, i, 0).bufferedIndex;
        if (d > -1 && d < p.length - 1) {
          const y = Tt.bufferedInfo(p, n, 0).bufferedIndex,
            v = p[d].end,
            T = p[d + 1].start;
          if ((y === -1 || y > d) && T - v < 1 && n - v < 2) {
            const S = new Error(
              "nudging playhead to flush pipeline after video hole. currentTime: "
                .concat(n, " hole: ")
                .concat(v, " -> ")
                .concat(T, " buffered index: ")
                .concat(y),
            );
            (this.warn(S.message), (this.media.currentTime += 1e-6));
            let w = tg(n, this.fragmentTracker);
            w && "fragment" in w ? (w = w.fragment) : w || (w = void 0);
            const C = Tt.bufferInfo(this.media, n, 0);
            this.hls.trigger(F.ERROR, {
              type: et.MEDIA_ERROR,
              details: ge.BUFFER_SEEK_OVER_HOLE,
              fatal: !1,
              error: S,
              reason: S.message,
              frag: w,
              buffer: C.len,
              bufferInfo: C,
            });
          }
        }
      }
    }
  }
  _tryFixBufferStall(n, i, o) {
    var l, h;
    const { fragmentTracker: p, media: d } = this,
      y = (l = this.hls) == null ? void 0 : l.config;
    if (!d || !p || !y) return;
    const v = (h = this.hls) == null ? void 0 : h.latestLevelDetails,
      T = tg(o, p);
    if ((T || (v != null && v.live && o < v.fragmentStart)) && (this._trySkipBufferHole(T) || !this.media))
      return;
    const S = n.buffered,
      w = this.adjacentTraversal(n, o);
    ((S && S.length > 1 && n.len > y.maxBufferHole) ||
      (n.nextStart && (n.nextStart - o < y.maxBufferHole || w))) &&
      (i > y.highBufferWatchdogPeriod * 1e3 || this.waiting) &&
      (this.warn("Trying to nudge playhead over buffer-hole"), this._tryNudgeBuffer(n));
  }
  adjacentTraversal(n, i) {
    const o = this.fragmentTracker,
      l = n.nextStart;
    if (o && l) {
      const h = o.getFragAtPos(i, Xe.MAIN),
        p = o.getFragAtPos(l, Xe.MAIN);
      if (h && p) return p.sn - h.sn < 2;
    }
    return !1;
  }
  _reportStall(n) {
    const { hls: i, media: o, stallReported: l, stalled: h } = this;
    if (!l && h !== null && o && i) {
      this.stallReported = !0;
      const p = new Error(
        "Playback stalling at @".concat(o.currentTime, " due to low buffer (").concat(ln(n), ")"),
      );
      (this.warn(p.message),
        i.trigger(F.ERROR, {
          type: et.MEDIA_ERROR,
          details: ge.BUFFER_STALLED_ERROR,
          fatal: !1,
          error: p,
          buffer: n.len,
          bufferInfo: n,
          stalled: { start: h },
        }));
    }
  }
  _trySkipBufferHole(n) {
    var i;
    const { fragmentTracker: o, media: l } = this,
      h = (i = this.hls) == null ? void 0 : i.config;
    if (!l || !o || !h) return 0;
    const p = l.currentTime,
      d = Tt.bufferInfo(l, p, 0),
      y = p < d.start ? d.start : d.nextStart;
    if (y && this.hls) {
      const T = d.len <= h.maxBufferHole,
        S = d.len > 0 && d.len < 1 && l.readyState < 3,
        w = y - p;
      if (w > 0 && (T || S)) {
        if (w > h.maxBufferHole) {
          let L = !1;
          if (p === 0) {
            const k = o.getAppendedFrag(0, Xe.MAIN);
            k && y < k.end && (L = !0);
          }
          if (!L && n) {
            var v;
            if (!((v = this.hls.loadLevelObj) != null && v.details) || Yb(this.hls.inFlightFragments, y))
              return 0;
            let O = !1,
              B = n.end;
            for (; B < y; ) {
              const N = tg(B, o);
              if (N) B += N.duration;
              else {
                O = !0;
                break;
              }
            }
            if (O) return 0;
          }
        }
        const C = Math.max(y + Uz, p + Fz);
        if (
          (this.warn("skipping hole, adjusting currentTime from ".concat(p, " to ").concat(C)),
          (this.moved = !0),
          (l.currentTime = C),
          !(n != null && n.gap))
        ) {
          const L = new Error("fragment loaded with buffer holes, seeking from ".concat(p, " to ").concat(C)),
            k = {
              type: et.MEDIA_ERROR,
              details: ge.BUFFER_SEEK_OVER_HOLE,
              fatal: !1,
              error: L,
              reason: L.message,
              buffer: d.len,
              bufferInfo: d,
            };
          (n && ("fragment" in n ? (k.part = n) : (k.frag = n)), this.hls.trigger(F.ERROR, k));
        }
        return C;
      }
    }
    return 0;
  }
  _tryNudgeBuffer(n) {
    const { hls: i, media: o, nudgeRetry: l } = this,
      h = i == null ? void 0 : i.config;
    if (!o || !h) return 0;
    const p = o.currentTime;
    if ((this.nudgeRetry++, l < h.nudgeMaxRetry)) {
      const d = p + (l + 1) * h.nudgeOffset,
        y = new Error("Nudging 'currentTime' from ".concat(p, " to ").concat(d));
      (this.warn(y.message),
        (o.currentTime = d),
        i.trigger(F.ERROR, {
          type: et.MEDIA_ERROR,
          details: ge.BUFFER_NUDGE_ON_STALL,
          error: y,
          fatal: !1,
          buffer: n.len,
          bufferInfo: n,
        }));
    } else {
      const d = new Error(
        "Playhead still not moving while enough data buffered @"
          .concat(p, " after ")
          .concat(h.nudgeMaxRetry, " nudges"),
      );
      (this.error(d.message),
        i.trigger(F.ERROR, {
          type: et.MEDIA_ERROR,
          details: ge.BUFFER_STALLED_ERROR,
          error: d,
          fatal: !0,
          buffer: n.len,
          bufferInfo: n,
        }));
    }
  }
}
function Yb(u, n) {
  const i = Xb(u.main);
  if (i && i.start <= n) return i;
  const o = Xb(u.audio);
  return o && o.start <= n ? o : null;
}
function Xb(u) {
  if (!u) return null;
  switch (u.state) {
    case Te.IDLE:
    case Te.STOPPED:
    case Te.ENDED:
    case Te.ERROR:
      return null;
  }
  return u.frag;
}
function tg(u, n) {
  return n.getAppendedFrag(u, Xe.MAIN) || n.getPartialFragment(u);
}
const Gz = 0.25;
function jT() {
  if (!(typeof self > "u")) return self.VTTCue || self.TextTrackCue;
}
function zx(u, n, i, o, l) {
  let h = new u(n, i, "");
  try {
    ((h.value = o), l && (h.type = l));
  } catch (p) {
    h = new u(n, i, ln(l ? Jt({ type: l }, o) : o));
  }
  return h;
}
const ng = (() => {
  const u = jT();
  try {
    u && new u(0, Number.POSITIVE_INFINITY, "");
  } catch (n) {
    return Number.MAX_VALUE;
  }
  return Number.POSITIVE_INFINITY;
})();
class jz {
  constructor(n) {
    ((this.hls = void 0),
      (this.id3Track = null),
      (this.media = null),
      (this.dateRangeCuesAppended = {}),
      (this.removeCues = !0),
      (this.assetCue = void 0),
      (this.onEventCueEnter = () => {
        this.hls && this.hls.trigger(F.EVENT_CUE_ENTER, {});
      }),
      (this.hls = n),
      this._registerListeners());
  }
  destroy() {
    (this._unregisterListeners(),
      (this.id3Track = null),
      (this.media = null),
      (this.dateRangeCuesAppended = {}),
      (this.hls = this.onEventCueEnter = null));
  }
  _registerListeners() {
    const { hls: n } = this;
    n &&
      (n.on(F.MEDIA_ATTACHING, this.onMediaAttaching, this),
      n.on(F.MEDIA_ATTACHED, this.onMediaAttached, this),
      n.on(F.MEDIA_DETACHING, this.onMediaDetaching, this),
      n.on(F.MANIFEST_LOADING, this.onManifestLoading, this),
      n.on(F.FRAG_PARSING_METADATA, this.onFragParsingMetadata, this),
      n.on(F.BUFFER_FLUSHING, this.onBufferFlushing, this),
      n.on(F.LEVEL_UPDATED, this.onLevelUpdated, this),
      n.on(F.LEVEL_PTS_UPDATED, this.onLevelPtsUpdated, this));
  }
  _unregisterListeners() {
    const { hls: n } = this;
    n &&
      (n.off(F.MEDIA_ATTACHING, this.onMediaAttaching, this),
      n.off(F.MEDIA_ATTACHED, this.onMediaAttached, this),
      n.off(F.MEDIA_DETACHING, this.onMediaDetaching, this),
      n.off(F.MANIFEST_LOADING, this.onManifestLoading, this),
      n.off(F.FRAG_PARSING_METADATA, this.onFragParsingMetadata, this),
      n.off(F.BUFFER_FLUSHING, this.onBufferFlushing, this),
      n.off(F.LEVEL_UPDATED, this.onLevelUpdated, this),
      n.off(F.LEVEL_PTS_UPDATED, this.onLevelPtsUpdated, this));
  }
  onMediaAttaching(n, i) {
    var o;
    ((this.media = i.media),
      ((o = i.overrides) == null ? void 0 : o.cueRemoval) === !1 && (this.removeCues = !1));
  }
  onMediaAttached() {
    var n;
    const i = (n = this.hls) == null ? void 0 : n.latestLevelDetails;
    i && this.updateDateRangeCues(i);
  }
  onMediaDetaching(n, i) {
    ((this.media = null),
      !i.transferMedia &&
        (this.id3Track &&
          (this.removeCues && tu(this.id3Track, this.onEventCueEnter), (this.id3Track = null)),
        (this.dateRangeCuesAppended = {})));
  }
  onManifestLoading() {
    this.dateRangeCuesAppended = {};
  }
  createTrack(n) {
    const i = this.getID3Track(n.textTracks);
    return ((i.mode = "hidden"), i);
  }
  getID3Track(n) {
    if (this.media) {
      for (let i = 0; i < n.length; i++) {
        const o = n[i];
        if (o.kind === "metadata" && o.label === "id3") return (UM(o, this.media), o);
      }
      return this.media.addTextTrack("metadata", "id3");
    }
  }
  onFragParsingMetadata(n, i) {
    if (!this.media || !this.hls) return;
    const { enableEmsgMetadataCues: o, enableID3MetadataCues: l } = this.hls.config;
    if (!o && !l) return;
    const { samples: h } = i;
    this.id3Track || (this.id3Track = this.createTrack(this.media));
    const p = jT();
    if (p)
      for (let d = 0; d < h.length; d++) {
        const y = h[d].type;
        if ((y === Tr.emsg && !o) || !l) continue;
        const v = hM(h[d].data),
          T = h[d].pts;
        let S = T + h[d].duration;
        (S > ng && (S = ng), S - T <= 0 && (S = T + Gz));
        for (let C = 0; C < v.length; C++) {
          const L = v[C];
          if (!fM(L)) {
            this.updateId3CueEnds(T, y);
            const k = zx(p, T, S, L, y);
            k && this.id3Track.addCue(k);
          }
        }
      }
  }
  updateId3CueEnds(n, i) {
    var o;
    const l = (o = this.id3Track) == null ? void 0 : o.cues;
    if (l)
      for (let h = l.length; h--; ) {
        const p = l[h];
        p.type === i && p.startTime < n && p.endTime === ng && (p.endTime = n);
      }
  }
  onBufferFlushing(n, { startOffset: i, endOffset: o, type: l }) {
    const { id3Track: h, hls: p } = this;
    if (!p) return;
    const {
      config: { enableEmsgMetadataCues: d, enableID3MetadataCues: y },
    } = p;
    if (h && (d || y)) {
      let v;
      (l === "audio"
        ? (v = T => T.type === Tr.audioId3 && y)
        : l === "video"
          ? (v = T => T.type === Tr.emsg && d)
          : (v = T => (T.type === Tr.audioId3 && y) || (T.type === Tr.emsg && d)),
        BT(h, i, o, v));
    }
  }
  onLevelUpdated(n, { details: i }) {
    this.updateDateRangeCues(i, !0);
  }
  onLevelPtsUpdated(n, i) {
    Math.abs(i.drift) > 0.01 && this.updateDateRangeCues(i.details);
  }
  updateDateRangeCues(n, i) {
    if (!this.hls || !this.media) return;
    const {
      assetPlayerId: o,
      timelineOffset: l,
      enableDateRangeMetadataCues: h,
      interstitialsController: p,
    } = this.hls.config;
    if (!h) return;
    const d = jT();
    if (o && l && !p) {
      const { fragmentStart: k, fragmentEnd: O } = n;
      let B = this.assetCue;
      B
        ? ((B.startTime = k), (B.endTime = O))
        : d &&
          ((B = this.assetCue =
            zx(d, k, O, { assetPlayerId: this.hls.config.assetPlayerId }, "hlsjs.interstitial.asset")),
          B &&
            ((B.id = o),
            this.id3Track || (this.id3Track = this.createTrack(this.media)),
            this.id3Track.addCue(B),
            B.addEventListener("enter", this.onEventCueEnter)));
    }
    if (!n.hasProgramDateTime) return;
    const { id3Track: y } = this,
      { dateRanges: v } = n,
      T = Object.keys(v);
    let S = this.dateRangeCuesAppended;
    if (y && i) {
      var w;
      if ((w = y.cues) != null && w.length) {
        const k = Object.keys(S).filter(O => !T.includes(O));
        for (let O = k.length; O--; ) {
          var C;
          const B = k[O],
            N = (C = S[B]) == null ? void 0 : C.cues;
          (delete S[B],
            N &&
              Object.keys(N).forEach($ => {
                const I = N[$];
                if (I) {
                  I.removeEventListener("enter", this.onEventCueEnter);
                  try {
                    y.removeCue(I);
                  } catch (V) {}
                }
              }));
        }
      } else S = this.dateRangeCuesAppended = {};
    }
    const L = n.fragments[n.fragments.length - 1];
    if (!(T.length === 0 || !Ue(L == null ? void 0 : L.programDateTime))) {
      this.id3Track || (this.id3Track = this.createTrack(this.media));
      for (let k = 0; k < T.length; k++) {
        const O = T[k],
          B = v[O],
          N = B.startTime,
          $ = S[O],
          I = ($ == null ? void 0 : $.cues) || {};
        let V = ($ == null ? void 0 : $.durationKnown) || !1,
          oe = ng;
        const { duration: Y, endDate: te } = B;
        if (te && Y !== null) ((oe = N + Y), (V = !0));
        else if (B.endOnNext && !V) {
          const K = T.reduce((q, ce) => {
            if (ce !== B.id) {
              const he = v[ce];
              if (he.class === B.class && he.startDate > B.startDate && (!q || B.startDate < q.startDate))
                return he;
            }
            return q;
          }, null);
          K && ((oe = K.startTime), (V = !0));
        }
        const _ = Object.keys(B.attr);
        for (let K = 0; K < _.length; K++) {
          const q = _[K];
          if (!uK(q)) continue;
          const ce = I[q];
          if (ce)
            V && !($ != null && $.durationKnown)
              ? (ce.endTime = oe)
              : Math.abs(ce.startTime - N) > 0.01 && ((ce.startTime = N), (ce.endTime = oe));
          else if (d) {
            let he = B.attr[q];
            cK(q) && (he = Ak(he));
            const ye = zx(d, N, oe, { key: q, data: he }, Tr.dateRange);
            ye &&
              ((ye.id = O),
              this.id3Track.addCue(ye),
              (I[q] = ye),
              p &&
                (q === "X-ASSET-LIST" || q === "X-ASSET-URL") &&
                ye.addEventListener("enter", this.onEventCueEnter));
          }
        }
        S[O] = { cues: I, dateRange: B, durationKnown: V };
      }
    }
  }
}
class Vz {
  constructor(n) {
    ((this.hls = void 0),
      (this.config = void 0),
      (this.media = null),
      (this.currentTime = 0),
      (this.stallCount = 0),
      (this._latency = null),
      (this._targetLatencyUpdated = !1),
      (this.onTimeupdate = () => {
        const { media: i } = this,
          o = this.levelDetails;
        if (!i || !o) return;
        this.currentTime = i.currentTime;
        const l = this.computeLatency();
        if (l === null) return;
        this._latency = l;
        const { lowLatencyMode: h, maxLiveSyncPlaybackRate: p } = this.config;
        if (!h || p === 1 || !o.live) return;
        const d = this.targetLatency;
        if (d === null) return;
        const y = l - d,
          v = Math.min(this.maxLatency, d + o.targetduration);
        if (y < v && y > 0.05 && this.forwardBufferLength > 1) {
          const S = Math.min(2, Math.max(1, p)),
            w = Math.round((2 / (1 + Math.exp(-0.75 * y - this.edgeStalled))) * 20) / 20,
            C = Math.min(S, Math.max(1, w));
          this.changeMediaPlaybackRate(i, C);
        } else i.playbackRate !== 1 && i.playbackRate !== 0 && this.changeMediaPlaybackRate(i, 1);
      }),
      (this.hls = n),
      (this.config = n.config),
      this.registerListeners());
  }
  get levelDetails() {
    var n;
    return ((n = this.hls) == null ? void 0 : n.latestLevelDetails) || null;
  }
  get latency() {
    return this._latency || 0;
  }
  get maxLatency() {
    const { config: n } = this;
    if (n.liveMaxLatencyDuration !== void 0) return n.liveMaxLatencyDuration;
    const i = this.levelDetails;
    return i ? n.liveMaxLatencyDurationCount * i.targetduration : 0;
  }
  get targetLatency() {
    const n = this.levelDetails;
    if (n === null || this.hls === null) return null;
    const { holdBack: i, partHoldBack: o, targetduration: l } = n,
      { liveSyncDuration: h, liveSyncDurationCount: p, lowLatencyMode: d } = this.config,
      y = this.hls.userConfig;
    let v = (d && o) || i;
    (this._targetLatencyUpdated || y.liveSyncDuration || y.liveSyncDurationCount || v === 0) &&
      (v = h !== void 0 ? h : p * l);
    const T = l;
    return v + Math.min(this.stallCount * this.config.liveSyncOnStallIncrease, T);
  }
  set targetLatency(n) {
    ((this.stallCount = 0), (this.config.liveSyncDuration = n), (this._targetLatencyUpdated = !0));
  }
  get liveSyncPosition() {
    const n = this.estimateLiveEdge(),
      i = this.targetLatency;
    if (n === null || i === null) return null;
    const o = this.levelDetails;
    if (o === null) return null;
    const l = o.edge,
      h = n - i - this.edgeStalled,
      p = l - o.totalduration,
      d = l - ((this.config.lowLatencyMode && o.partTarget) || o.targetduration);
    return Math.min(Math.max(p, h), d);
  }
  get drift() {
    const n = this.levelDetails;
    return n === null ? 1 : n.drift;
  }
  get edgeStalled() {
    const n = this.levelDetails;
    if (n === null) return 0;
    const i = ((this.config.lowLatencyMode && n.partTarget) || n.targetduration) * 3;
    return Math.max(n.age - i, 0);
  }
  get forwardBufferLength() {
    const { media: n } = this,
      i = this.levelDetails;
    if (!n || !i) return 0;
    const o = n.buffered.length;
    return (o ? n.buffered.end(o - 1) : i.edge) - this.currentTime;
  }
  destroy() {
    (this.unregisterListeners(), this.onMediaDetaching(), (this.hls = null));
  }
  registerListeners() {
    const { hls: n } = this;
    n &&
      (n.on(F.MEDIA_ATTACHED, this.onMediaAttached, this),
      n.on(F.MEDIA_DETACHING, this.onMediaDetaching, this),
      n.on(F.MANIFEST_LOADING, this.onManifestLoading, this),
      n.on(F.LEVEL_UPDATED, this.onLevelUpdated, this),
      n.on(F.ERROR, this.onError, this));
  }
  unregisterListeners() {
    const { hls: n } = this;
    n &&
      (n.off(F.MEDIA_ATTACHED, this.onMediaAttached, this),
      n.off(F.MEDIA_DETACHING, this.onMediaDetaching, this),
      n.off(F.MANIFEST_LOADING, this.onManifestLoading, this),
      n.off(F.LEVEL_UPDATED, this.onLevelUpdated, this),
      n.off(F.ERROR, this.onError, this));
  }
  onMediaAttached(n, i) {
    ((this.media = i.media), this.media.addEventListener("timeupdate", this.onTimeupdate));
  }
  onMediaDetaching() {
    this.media && (this.media.removeEventListener("timeupdate", this.onTimeupdate), (this.media = null));
  }
  onManifestLoading() {
    ((this._latency = null), (this.stallCount = 0));
  }
  onLevelUpdated(n, { details: i }) {
    (i.advanced && this.onTimeupdate(),
      !i.live && this.media && this.media.removeEventListener("timeupdate", this.onTimeupdate));
  }
  onError(n, i) {
    var o;
    i.details === ge.BUFFER_STALLED_ERROR &&
      (this.stallCount++,
      this.hls &&
        (o = this.levelDetails) != null &&
        o.live &&
        this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"));
  }
  changeMediaPlaybackRate(n, i) {
    var o, l;
    n.playbackRate !== i &&
      ((o = this.hls) == null ||
        o.logger.debug(
          "[latency-controller]: latency="
            .concat(this.latency.toFixed(3), ", targetLatency=")
            .concat((l = this.targetLatency) == null ? void 0 : l.toFixed(3), ", forwardBufferLength=")
            .concat(this.forwardBufferLength.toFixed(3), ": adjusting playback rate from ")
            .concat(n.playbackRate, " to ")
            .concat(i),
        ),
      (n.playbackRate = i));
  }
  estimateLiveEdge() {
    const n = this.levelDetails;
    return n === null ? null : n.edge + n.age;
  }
  computeLatency() {
    const n = this.estimateLiveEdge();
    return n === null ? null : n - this.currentTime;
  }
}
class Hz extends wS {
  constructor(n, i) {
    (super(n, "level-controller"),
      (this._levels = []),
      (this._firstLevel = -1),
      (this._maxAutoLevel = -1),
      (this._startLevel = void 0),
      (this.currentLevel = null),
      (this.currentLevelIndex = -1),
      (this.manualLevelIndex = -1),
      (this.steering = void 0),
      (this.onParsedComplete = void 0),
      (this.steering = i),
      this._registerListeners());
  }
  _registerListeners() {
    const { hls: n } = this;
    (n.on(F.MANIFEST_LOADING, this.onManifestLoading, this),
      n.on(F.MANIFEST_LOADED, this.onManifestLoaded, this),
      n.on(F.LEVEL_LOADED, this.onLevelLoaded, this),
      n.on(F.LEVELS_UPDATED, this.onLevelsUpdated, this),
      n.on(F.FRAG_BUFFERED, this.onFragBuffered, this),
      n.on(F.ERROR, this.onError, this));
  }
  _unregisterListeners() {
    const { hls: n } = this;
    (n.off(F.MANIFEST_LOADING, this.onManifestLoading, this),
      n.off(F.MANIFEST_LOADED, this.onManifestLoaded, this),
      n.off(F.LEVEL_LOADED, this.onLevelLoaded, this),
      n.off(F.LEVELS_UPDATED, this.onLevelsUpdated, this),
      n.off(F.FRAG_BUFFERED, this.onFragBuffered, this),
      n.off(F.ERROR, this.onError, this));
  }
  destroy() {
    (this._unregisterListeners(), (this.steering = null), this.resetLevels(), super.destroy());
  }
  stopLoad() {
    (this._levels.forEach(i => {
      ((i.loadError = 0), (i.fragmentError = 0));
    }),
      super.stopLoad());
  }
  resetLevels() {
    ((this._startLevel = void 0),
      (this.manualLevelIndex = -1),
      (this.currentLevelIndex = -1),
      (this.currentLevel = null),
      (this._levels = []),
      (this._maxAutoLevel = -1));
  }
  onManifestLoading(n, i) {
    this.resetLevels();
  }
  onManifestLoaded(n, i) {
    const o = this.hls.config.preferManagedMediaSource,
      l = [],
      h = {},
      p = {};
    let d = !1,
      y = !1,
      v = !1;
    (i.levels.forEach(T => {
      const S = T.attrs;
      let { audioCodec: w, videoCodec: C } = T;
      (w && (T.audioCodec = w = Ng(w, o) || void 0), C && (C = T.videoCodec = RH(C)));
      const { width: L, height: k, unknownCodecs: O } = T,
        B = (O == null ? void 0 : O.length) || 0;
      if (
        (d || (d = !!(L && k)),
        y || (y = !!C),
        v || (v = !!w),
        B || (w && !this.isAudioSupported(w)) || (C && !this.isVideoSupported(C)))
      ) {
        this.log('Some or all CODECS not supported "'.concat(S.CODECS, '"'));
        return;
      }
      const {
          CODECS: N,
          "FRAME-RATE": $,
          "HDCP-LEVEL": I,
          "PATHWAY-ID": V,
          RESOLUTION: oe,
          "VIDEO-RANGE": Y,
        } = S,
        te = "".concat(V || ".", "-"),
        _ = ""
          .concat(te)
          .concat(T.bitrate, "-")
          .concat(oe, "-")
          .concat($, "-")
          .concat(N, "-")
          .concat(Y, "-")
          .concat(I);
      if (h[_])
        if (h[_].uri !== T.url && !T.attrs["PATHWAY-ID"]) {
          const K = (p[_] += 1);
          T.attrs["PATHWAY-ID"] = new Array(K + 1).join(".");
          const q = this.createLevel(T);
          ((h[_] = q), l.push(q));
        } else (h[_].addGroupId("audio", S.AUDIO), h[_].addGroupId("text", S.SUBTITLES));
      else {
        const K = this.createLevel(T);
        ((h[_] = K), (p[_] = 1), l.push(K));
      }
    }),
      this.filterAndSortMediaOptions(l, i, d, y, v));
  }
  createLevel(n) {
    const i = new Ld(n),
      o = n.supplemental;
    if (o != null && o.videoCodec && !this.isVideoSupported(o.videoCodec)) {
      const l = new Error('SUPPLEMENTAL-CODECS not supported "'.concat(o.videoCodec, '"'));
      (this.log(l.message), (i.supportedResult = Ok(l, [])));
    }
    return i;
  }
  isAudioSupported(n) {
    return Rd(n, "audio", this.hls.config.preferManagedMediaSource);
  }
  isVideoSupported(n) {
    return Rd(n, "video", this.hls.config.preferManagedMediaSource);
  }
  filterAndSortMediaOptions(n, i, o, l, h) {
    var p;
    let d = [],
      y = [],
      v = n;
    const T = ((p = i.stats) == null ? void 0 : p.parsing) || {};
    if (
      ((o || l) &&
        h &&
        (v = v.filter(
          ({ videoCodec: N, videoRange: $, width: I, height: V }) => (!!N || !!(I && V)) && NH($),
        )),
      v.length === 0)
    ) {
      (Promise.resolve().then(() => {
        if (this.hls) {
          let N = "no level with compatible codecs found in manifest",
            $ = N;
          i.levels.length &&
            (($ = "one or more CODECS in variant not supported: ".concat(
              ln(i.levels.map(V => V.attrs.CODECS).filter((V, oe, Y) => Y.indexOf(V) === oe)),
            )),
            this.warn($),
            (N += " (".concat($, ")")));
          const I = new Error(N);
          this.hls.trigger(F.ERROR, {
            type: et.MEDIA_ERROR,
            details: ge.MANIFEST_INCOMPATIBLE_CODECS_ERROR,
            fatal: !0,
            url: i.url,
            error: I,
            reason: $,
          });
        }
      }),
        (T.end = performance.now()));
      return;
    }
    (i.audioTracks &&
      ((d = i.audioTracks.filter(N => !N.audioCodec || this.isAudioSupported(N.audioCodec))), qb(d)),
      i.subtitles && ((y = i.subtitles), qb(y)));
    const S = v.slice(0);
    v.sort((N, $) => {
      if (N.attrs["HDCP-LEVEL"] !== $.attrs["HDCP-LEVEL"])
        return (N.attrs["HDCP-LEVEL"] || "") > ($.attrs["HDCP-LEVEL"] || "") ? 1 : -1;
      if (o && N.height !== $.height) return N.height - $.height;
      if (N.frameRate !== $.frameRate) return N.frameRate - $.frameRate;
      if (N.videoRange !== $.videoRange) return Fg.indexOf(N.videoRange) - Fg.indexOf($.videoRange);
      if (N.videoCodec !== $.videoCodec) {
        const I = G_(N.videoCodec),
          V = G_($.videoCodec);
        if (I !== V) return V - I;
      }
      if (N.uri === $.uri && N.codecSet !== $.codecSet) {
        const I = Og(N.codecSet),
          V = Og($.codecSet);
        if (I !== V) return V - I;
      }
      return N.averageBitrate !== $.averageBitrate ? N.averageBitrate - $.averageBitrate : 0;
    });
    let w = S[0];
    if (this.steering && ((v = this.steering.filterParsedLevels(v)), v.length !== S.length)) {
      for (let N = 0; N < S.length; N++)
        if (S[N].pathwayId === v[0].pathwayId) {
          w = S[N];
          break;
        }
    }
    this._levels = v;
    for (let N = 0; N < v.length; N++)
      if (v[N] === w) {
        var C;
        this._firstLevel = N;
        const $ = w.bitrate,
          I = this.hls.bandwidthEstimate;
        if (
          (this.log("manifest loaded, ".concat(v.length, " level(s) found, first bitrate: ").concat($)),
          ((C = this.hls.userConfig) == null ? void 0 : C.abrEwmaDefaultEstimate) === void 0)
        ) {
          const V = Math.min($, this.hls.config.abrEwmaDefaultEstimateMax);
          V > I && I === this.hls.abrEwmaDefaultEstimate && (this.hls.bandwidthEstimate = V);
        }
        break;
      }
    const L = h && !l,
      k = this.hls.config,
      O = !!(k.audioStreamController && k.audioTrackController),
      B = {
        levels: v,
        audioTracks: d,
        subtitleTracks: y,
        sessionData: i.sessionData,
        sessionKeys: i.sessionKeys,
        firstLevel: this._firstLevel,
        stats: i.stats,
        audio: h,
        video: l,
        altAudio: O && !L && d.some(N => !!N.url),
      };
    ((T.end = performance.now()), this.hls.trigger(F.MANIFEST_PARSED, B));
  }
  get levels() {
    return this._levels.length === 0 ? null : this._levels;
  }
  get loadLevelObj() {
    return this.currentLevel;
  }
  get level() {
    return this.currentLevelIndex;
  }
  set level(n) {
    const i = this._levels;
    if (i.length === 0) return;
    if (n < 0 || n >= i.length) {
      const T = new Error("invalid level idx"),
        S = n < 0;
      if (
        (this.hls.trigger(F.ERROR, {
          type: et.OTHER_ERROR,
          details: ge.LEVEL_SWITCH_ERROR,
          level: n,
          fatal: S,
          error: T,
          reason: T.message,
        }),
        S)
      )
        return;
      n = Math.min(n, i.length - 1);
    }
    const o = this.currentLevelIndex,
      l = this.currentLevel,
      h = l ? l.attrs["PATHWAY-ID"] : void 0,
      p = i[n],
      d = p.attrs["PATHWAY-ID"];
    if (((this.currentLevelIndex = n), (this.currentLevel = p), o === n && l && h === d)) return;
    this.log(
      "Switching to level "
        .concat(n, " (")
        .concat(p.height ? p.height + "p " : "")
        .concat(p.videoRange ? p.videoRange + " " : "")
        .concat(p.codecSet ? p.codecSet + " " : "", "@")
        .concat(p.bitrate, ")")
        .concat(d ? " with Pathway " + d : "", " from level ")
        .concat(o)
        .concat(h ? " with Pathway " + h : ""),
    );
    const y = {
      level: n,
      attrs: p.attrs,
      details: p.details,
      bitrate: p.bitrate,
      averageBitrate: p.averageBitrate,
      maxBitrate: p.maxBitrate,
      realBitrate: p.realBitrate,
      width: p.width,
      height: p.height,
      codecSet: p.codecSet,
      audioCodec: p.audioCodec,
      videoCodec: p.videoCodec,
      audioGroups: p.audioGroups,
      subtitleGroups: p.subtitleGroups,
      loaded: p.loaded,
      loadError: p.loadError,
      fragmentError: p.fragmentError,
      name: p.name,
      id: p.id,
      uri: p.uri,
      url: p.url,
      urlId: 0,
      audioGroupIds: p.audioGroupIds,
      textGroupIds: p.textGroupIds,
    };
    this.hls.trigger(F.LEVEL_SWITCHING, y);
    const v = p.details;
    if (!v || v.live) {
      const T = this.switchParams(p.uri, l == null ? void 0 : l.details, v);
      this.loadPlaylist(T);
    }
  }
  get manualLevel() {
    return this.manualLevelIndex;
  }
  set manualLevel(n) {
    ((this.manualLevelIndex = n),
      this._startLevel === void 0 && (this._startLevel = n),
      n !== -1 && (this.level = n));
  }
  get firstLevel() {
    return this._firstLevel;
  }
  set firstLevel(n) {
    this._firstLevel = n;
  }
  get startLevel() {
    if (this._startLevel === void 0) {
      const n = this.hls.config.startLevel;
      return n !== void 0 ? n : this.hls.firstAutoLevel;
    }
    return this._startLevel;
  }
  set startLevel(n) {
    this._startLevel = n;
  }
  get pathways() {
    return this.steering ? this.steering.pathways() : [];
  }
  get pathwayPriority() {
    return this.steering ? this.steering.pathwayPriority : null;
  }
  set pathwayPriority(n) {
    if (this.steering) {
      const i = this.steering.pathways(),
        o = n.filter(l => i.indexOf(l) !== -1);
      if (n.length < 1) {
        this.warn("pathwayPriority ".concat(n, " should contain at least one pathway from list: ").concat(i));
        return;
      }
      this.steering.pathwayPriority = o;
    }
  }
  onError(n, i) {
    i.fatal ||
      !i.context ||
      (i.context.type === Ot.LEVEL && i.context.level === this.level && this.checkRetry(i));
  }
  onFragBuffered(n, { frag: i }) {
    if (i !== void 0 && i.type === Xe.MAIN) {
      const o = i.elementaryStreams;
      if (!Object.keys(o).some(h => !!o[h])) return;
      const l = this._levels[i.level];
      l != null &&
        l.loadError &&
        (this.log("Resetting level error count of ".concat(l.loadError, " on frag buffered")),
        (l.loadError = 0));
    }
  }
  onLevelLoaded(n, i) {
    var o;
    const { level: l, details: h } = i,
      p = i.levelInfo;
    if (!p) {
      var d;
      (this.warn("Invalid level index ".concat(l)),
        (d = i.deliveryDirectives) != null && d.skip && (h.deltaUpdateFailed = !0));
      return;
    }
    if (p === this.currentLevel || i.withoutMultiVariant) {
      p.fragmentError === 0 && (p.loadError = 0);
      let y = p.details;
      (y === i.details && y.advanced && (y = void 0), this.playlistLoaded(l, i, y));
    } else (o = i.deliveryDirectives) != null && o.skip && (h.deltaUpdateFailed = !0);
  }
  loadPlaylist(n) {
    (super.loadPlaylist(),
      this.shouldLoadPlaylist(this.currentLevel) && this.scheduleLoading(this.currentLevel, n));
  }
  loadingPlaylist(n, i) {
    super.loadingPlaylist(n, i);
    const o = this.getUrlWithDirectives(n.uri, i),
      l = this.currentLevelIndex,
      h = n.attrs["PATHWAY-ID"],
      p = n.details,
      d = p == null ? void 0 : p.age;
    (this.log(
      "Loading level index "
        .concat(l)
        .concat((i == null ? void 0 : i.msn) !== void 0 ? " at sn " + i.msn + " part " + i.part : "")
        .concat(h ? " Pathway " + h : "")
        .concat(d && p.live ? " age " + d.toFixed(1) + ((p.type && " " + p.type) || "") : "", " ")
        .concat(o),
    ),
      this.hls.trigger(F.LEVEL_LOADING, {
        url: o,
        level: l,
        levelInfo: n,
        pathwayId: n.attrs["PATHWAY-ID"],
        id: 0,
        deliveryDirectives: i || null,
      }));
  }
  get nextLoadLevel() {
    return this.manualLevelIndex !== -1 ? this.manualLevelIndex : this.hls.nextAutoLevel;
  }
  set nextLoadLevel(n) {
    ((this.level = n), this.manualLevelIndex === -1 && (this.hls.nextAutoLevel = n));
  }
  removeLevel(n) {
    var i;
    if (this._levels.length === 1) return;
    const o = this._levels.filter((h, p) =>
      p !== n
        ? !0
        : (this.steering && this.steering.removeLevel(h),
          h === this.currentLevel &&
            ((this.currentLevel = null),
            (this.currentLevelIndex = -1),
            h.details && h.details.fragments.forEach(d => (d.level = -1))),
          !1),
    );
    (nM(o),
      (this._levels = o),
      this.currentLevelIndex > -1 &&
        (i = this.currentLevel) != null &&
        i.details &&
        (this.currentLevelIndex = this.currentLevel.details.fragments[0].level),
      this.manualLevelIndex > -1 && (this.manualLevelIndex = this.currentLevelIndex));
    const l = o.length - 1;
    ((this._firstLevel = Math.min(this._firstLevel, l)),
      this._startLevel && (this._startLevel = Math.min(this._startLevel, l)),
      this.hls.trigger(F.LEVELS_UPDATED, { levels: o }));
  }
  onLevelsUpdated(n, { levels: i }) {
    this._levels = i;
  }
  checkMaxAutoUpdated() {
    const { autoLevelCapping: n, maxAutoLevel: i, maxHdcpLevel: o } = this.hls;
    this._maxAutoLevel !== i &&
      ((this._maxAutoLevel = i),
      this.hls.trigger(F.MAX_AUTO_LEVEL_UPDATED, {
        autoLevelCapping: n,
        levels: this.levels,
        maxAutoLevel: i,
        minAutoLevel: this.hls.minAutoLevel,
        maxHdcpLevel: o,
      }));
  }
}
function qb(u) {
  const n = {};
  u.forEach(i => {
    const o = i.groupId || "";
    ((i.id = n[o] = n[o] || 0), n[o]++);
  });
}
function QM() {
  return self.SourceBuffer || self.WebKitSourceBuffer;
}
function JM() {
  if (!Oo()) return !1;
  const n = QM();
  return (
    !n ||
    (n.prototype && typeof n.prototype.appendBuffer == "function" && typeof n.prototype.remove == "function")
  );
}
function Kz() {
  if (!JM()) return !1;
  const u = Oo();
  return (
    typeof (u == null ? void 0 : u.isTypeSupported) == "function" &&
    (["avc1.42E01E,mp4a.40.2", "av01.0.01M.08", "vp09.00.50.08"].some(n =>
      u.isTypeSupported(Cd(n, "video")),
    ) ||
      ["mp4a.40.2", "fLaC"].some(n => u.isTypeSupported(Cd(n, "audio"))))
  );
}
function Wz() {
  var u;
  const n = QM();
  return typeof (n == null || (u = n.prototype) == null ? void 0 : u.changeType) == "function";
}
const zz = 100;
class Yz extends yS {
  constructor(n, i, o) {
    (super(n, i, o, "stream-controller", Xe.MAIN),
      (this.audioCodecSwap = !1),
      (this.level = -1),
      (this._forceStartLoad = !1),
      (this._hasEnoughToStart = !1),
      (this.altAudio = 0),
      (this.audioOnly = !1),
      (this.fragPlaying = null),
      (this.fragLastKbps = 0),
      (this.couldBacktrack = !1),
      (this.backtrackFragment = null),
      (this.audioCodecSwitch = !1),
      (this.videoBuffer = null),
      (this.onMediaPlaying = () => {
        this.tick();
      }),
      (this.onMediaSeeked = () => {
        const l = this.media,
          h = l ? l.currentTime : null;
        if (
          h === null ||
          !Ue(h) ||
          (this.log("Media seeked to ".concat(h.toFixed(3))), !this.getBufferedFrag(h))
        )
          return;
        const p = this.getFwdBufferInfoAtPos(l, h, Xe.MAIN, 0);
        if (p === null || p.len === 0) {
          this.warn(
            "Main forward buffer length at "
              .concat(h, ' on "seeked" event ')
              .concat(p ? p.len : "empty", ")"),
          );
          return;
        }
        this.tick();
      }),
      this.registerListeners());
  }
  registerListeners() {
    super.registerListeners();
    const { hls: n } = this;
    (n.on(F.MANIFEST_PARSED, this.onManifestParsed, this),
      n.on(F.LEVEL_LOADING, this.onLevelLoading, this),
      n.on(F.LEVEL_LOADED, this.onLevelLoaded, this),
      n.on(F.FRAG_LOAD_EMERGENCY_ABORTED, this.onFragLoadEmergencyAborted, this),
      n.on(F.AUDIO_TRACK_SWITCHING, this.onAudioTrackSwitching, this),
      n.on(F.AUDIO_TRACK_SWITCHED, this.onAudioTrackSwitched, this),
      n.on(F.BUFFER_CREATED, this.onBufferCreated, this),
      n.on(F.BUFFER_FLUSHED, this.onBufferFlushed, this),
      n.on(F.LEVELS_UPDATED, this.onLevelsUpdated, this),
      n.on(F.FRAG_BUFFERED, this.onFragBuffered, this));
  }
  unregisterListeners() {
    super.unregisterListeners();
    const { hls: n } = this;
    (n.off(F.MANIFEST_PARSED, this.onManifestParsed, this),
      n.off(F.LEVEL_LOADED, this.onLevelLoaded, this),
      n.off(F.FRAG_LOAD_EMERGENCY_ABORTED, this.onFragLoadEmergencyAborted, this),
      n.off(F.AUDIO_TRACK_SWITCHING, this.onAudioTrackSwitching, this),
      n.off(F.AUDIO_TRACK_SWITCHED, this.onAudioTrackSwitched, this),
      n.off(F.BUFFER_CREATED, this.onBufferCreated, this),
      n.off(F.BUFFER_FLUSHED, this.onBufferFlushed, this),
      n.off(F.LEVELS_UPDATED, this.onLevelsUpdated, this),
      n.off(F.FRAG_BUFFERED, this.onFragBuffered, this));
  }
  onHandlerDestroying() {
    ((this.onMediaPlaying = this.onMediaSeeked = null),
      this.unregisterListeners(),
      super.onHandlerDestroying());
  }
  startLoad(n, i) {
    if (this.levels) {
      const { lastCurrentTime: o, hls: l } = this;
      if ((this.stopLoad(), this.setInterval(zz), (this.level = -1), !this.startFragRequested)) {
        let h = l.startLevel;
        (h === -1 &&
          (l.config.testBandwidth && this.levels.length > 1
            ? ((h = 0), (this.bitrateTest = !0))
            : (h = l.firstAutoLevel)),
          (l.nextLoadLevel = h),
          (this.level = l.loadLevel),
          (this._hasEnoughToStart = !!i));
      }
      (o > 0 &&
        n === -1 &&
        !i &&
        (this.log("Override startPosition with lastCurrentTime @".concat(o.toFixed(3))), (n = o)),
        (this.state = Te.IDLE),
        (this.nextLoadPosition = this.lastCurrentTime = n + this.timelineOffset),
        (this.startPosition = i ? -1 : n),
        this.tick());
    } else ((this._forceStartLoad = !0), (this.state = Te.STOPPED));
  }
  stopLoad() {
    ((this._forceStartLoad = !1), super.stopLoad());
  }
  doTick() {
    switch (this.state) {
      case Te.WAITING_LEVEL: {
        const { levels: n, level: i } = this,
          o = n == null ? void 0 : n[i],
          l = o == null ? void 0 : o.details;
        if (l && (!l.live || (this.levelLastLoaded === o && !this.waitForLive(o)))) {
          if (this.waitForCdnTuneIn(l)) break;
          this.state = Te.IDLE;
          break;
        } else if (this.hls.nextLoadLevel !== this.level) {
          this.state = Te.IDLE;
          break;
        }
        break;
      }
      case Te.FRAG_LOADING_WAITING_RETRY:
        this.checkRetryDate();
        break;
    }
    (this.state === Te.IDLE && this.doTickIdle(), this.onTickEnd());
  }
  onTickEnd() {
    var n;
    (super.onTickEnd(),
      (n = this.media) != null &&
        n.readyState &&
        this.media.seeking === !1 &&
        (this.lastCurrentTime = this.media.currentTime),
      this.checkFragmentChanged());
  }
  doTickIdle() {
    const { hls: n, levelLastLoaded: i, levels: o, media: l } = this;
    if (
      i === null ||
      (!l && !this.primaryPrefetch && (this.startFragRequested || !n.config.startFragPrefetch)) ||
      (this.altAudio && this.audioOnly)
    )
      return;
    const h = this.buffering ? n.nextLoadLevel : n.loadLevel;
    if (!(o != null && o[h])) return;
    const p = o[h],
      d = this.getMainFwdBufferInfo();
    if (d === null) return;
    const y = this.getLevelDetails();
    if (y && this._streamEnded(d, y)) {
      const k = {};
      (this.altAudio === 2 && (k.type = "video"), this.hls.trigger(F.BUFFER_EOS, k), (this.state = Te.ENDED));
      return;
    }
    if (!this.buffering) return;
    (n.loadLevel !== h &&
      n.manualLevel === -1 &&
      this.log("Adapting to level ".concat(h, " from level ").concat(this.level)),
      (this.level = n.nextLoadLevel = h));
    const v = p.details;
    if (!v || this.state === Te.WAITING_LEVEL || this.waitForLive(p)) {
      ((this.level = h), (this.state = Te.WAITING_LEVEL), (this.startFragRequested = !1));
      return;
    }
    const T = d.len,
      S = this.getMaxBufferLength(p.maxBitrate);
    if (T >= S) return;
    this.backtrackFragment && this.backtrackFragment.start > d.end && (this.backtrackFragment = null);
    const w = this.backtrackFragment ? this.backtrackFragment.start : d.end;
    let C = this.getNextFragment(w, v);
    if (
      this.couldBacktrack &&
      !this.fragPrevious &&
      C &&
      On(C) &&
      this.fragmentTracker.getState(C) !== ei.OK
    ) {
      var L;
      const O = ((L = this.backtrackFragment) != null ? L : C).sn - v.startSN,
        B = v.fragments[O - 1];
      B && C.cc === B.cc && ((C = B), this.fragmentTracker.removeFragment(B));
    } else this.backtrackFragment && d.len && (this.backtrackFragment = null);
    if (C && this.isLoopLoading(C, w)) {
      if (!C.gap) {
        const O = this.audioOnly && !this.altAudio ? an.AUDIO : an.VIDEO,
          B = (O === an.VIDEO ? this.videoBuffer : this.mediaBuffer) || this.media;
        B && this.afterBufferFlushed(B, O, Xe.MAIN);
      }
      C = this.getNextFragmentLoopLoading(C, v, d, Xe.MAIN, S);
    }
    C &&
      (C.initSegment && !C.initSegment.data && !this.bitrateTest && (C = C.initSegment),
      this.loadFragment(C, p, w));
  }
  loadFragment(n, i, o) {
    const l = this.fragmentTracker.getState(n);
    l === ei.NOT_LOADED || l === ei.PARTIAL
      ? On(n)
        ? this.bitrateTest
          ? (this.log(
              "Fragment "
                .concat(n.sn, " of level ")
                .concat(n.level, " is being downloaded to test bitrate and will not be buffered"),
            ),
            this._loadBitrateTestFrag(n, i))
          : super.loadFragment(n, i, o)
        : this._loadInitSegment(n, i)
      : this.clearTrackerIfNeeded(n);
  }
  getBufferedFrag(n) {
    return this.fragmentTracker.getBufferedFrag(n, Xe.MAIN);
  }
  followingBufferedFrag(n) {
    return n ? this.getBufferedFrag(n.end + 0.5) : null;
  }
  immediateLevelSwitch() {
    (this.abortCurrentFrag(), this.flushMainBuffer(0, Number.POSITIVE_INFINITY));
  }
  nextLevelSwitch() {
    const { levels: n, media: i } = this;
    if (i != null && i.readyState) {
      let o;
      const l = this.getAppendedFrag(i.currentTime);
      l && l.start > 1 && this.flushMainBuffer(0, l.start - 1);
      const h = this.getLevelDetails();
      if (h != null && h.live) {
        const d = this.getMainFwdBufferInfo();
        if (!d || d.len < h.targetduration * 2) return;
      }
      if (!i.paused && n) {
        const d = this.hls.nextLoadLevel,
          y = n[d],
          v = this.fragLastKbps;
        v && this.fragCurrent ? (o = (this.fragCurrent.duration * y.maxBitrate) / (1e3 * v) + 1) : (o = 0);
      } else o = 0;
      const p = this.getBufferedFrag(i.currentTime + o);
      if (p) {
        const d = this.followingBufferedFrag(p);
        if (d) {
          this.abortCurrentFrag();
          const y = d.maxStartPTS ? d.maxStartPTS : d.start,
            v = d.duration,
            T = Math.max(
              p.end,
              y +
                Math.min(
                  Math.max(v - this.config.maxFragLookUpTolerance, v * (this.couldBacktrack ? 0.5 : 0.125)),
                  v * (this.couldBacktrack ? 0.75 : 0.25),
                ),
            );
          this.flushMainBuffer(T, Number.POSITIVE_INFINITY);
        }
      }
    }
  }
  abortCurrentFrag() {
    const n = this.fragCurrent;
    switch (
      ((this.fragCurrent = null),
      (this.backtrackFragment = null),
      n && (n.abortRequests(), this.fragmentTracker.removeFragment(n)),
      this.state)
    ) {
      case Te.KEY_LOADING:
      case Te.FRAG_LOADING:
      case Te.FRAG_LOADING_WAITING_RETRY:
      case Te.PARSING:
      case Te.PARSED:
        this.state = Te.IDLE;
        break;
    }
    this.nextLoadPosition = this.getLoadPosition();
  }
  flushMainBuffer(n, i) {
    super.flushMainBuffer(n, i, this.altAudio === 2 ? "video" : null);
  }
  onMediaAttached(n, i) {
    super.onMediaAttached(n, i);
    const o = i.media;
    (ji(o, "playing", this.onMediaPlaying), ji(o, "seeked", this.onMediaSeeked));
  }
  onMediaDetaching(n, i) {
    const { media: o } = this;
    (o && (tr(o, "playing", this.onMediaPlaying), tr(o, "seeked", this.onMediaSeeked)),
      (this.videoBuffer = null),
      (this.fragPlaying = null),
      super.onMediaDetaching(n, i),
      !i.transferMedia && (this._hasEnoughToStart = !1));
  }
  onManifestLoading() {
    (super.onManifestLoading(),
      this.log("Trigger BUFFER_RESET"),
      this.hls.trigger(F.BUFFER_RESET, void 0),
      (this.couldBacktrack = !1),
      (this.fragLastKbps = 0),
      (this.fragPlaying = this.backtrackFragment = null),
      (this.altAudio = 0),
      (this.audioOnly = !1));
  }
  onManifestParsed(n, i) {
    let o = !1,
      l = !1;
    for (let h = 0; h < i.levels.length; h++) {
      const p = i.levels[h].audioCodec;
      p && ((o = o || p.indexOf("mp4a.40.2") !== -1), (l = l || p.indexOf("mp4a.40.5") !== -1));
    }
    ((this.audioCodecSwitch = o && l && !Wz()),
      this.audioCodecSwitch &&
        this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),
      (this.levels = i.levels),
      (this.startFragRequested = !1));
  }
  onLevelLoading(n, i) {
    const { levels: o } = this;
    if (!o || this.state !== Te.IDLE) return;
    const l = i.levelInfo;
    (!l.details ||
      (l.details.live && (this.levelLastLoaded !== l || l.details.expired)) ||
      this.waitForCdnTuneIn(l.details)) &&
      (this.state = Te.WAITING_LEVEL);
  }
  onLevelLoaded(n, i) {
    var o;
    const { levels: l, startFragRequested: h } = this,
      p = i.level,
      d = i.details,
      y = d.totalduration;
    if (!l) {
      this.warn("Levels were reset while loading level ".concat(p));
      return;
    }
    this.log(
      "Level "
        .concat(p, " loaded [")
        .concat(d.startSN, ",")
        .concat(d.endSN, "]")
        .concat(d.lastPartSn ? "[part-".concat(d.lastPartSn, "-").concat(d.lastPartIndex, "]") : "", ", cc [")
        .concat(d.startCC, ", ")
        .concat(d.endCC, "] duration:")
        .concat(y),
    );
    const v = i.levelInfo,
      T = this.fragCurrent;
    T &&
      (this.state === Te.FRAG_LOADING || this.state === Te.FRAG_LOADING_WAITING_RETRY) &&
      T.level !== i.level &&
      T.loader &&
      this.abortCurrentFrag();
    let S = 0;
    if (d.live || ((o = v.details) != null && o.live)) {
      var w;
      if ((this.checkLiveUpdate(d), d.deltaUpdateFailed)) return;
      S = this.alignPlaylists(d, v.details, (w = this.levelLastLoaded) == null ? void 0 : w.details);
    }
    if (
      ((v.details = d),
      (this.levelLastLoaded = v),
      h || this.setStartPosition(d, S),
      this.hls.trigger(F.LEVEL_UPDATED, { details: d, level: p }),
      this.state === Te.WAITING_LEVEL)
    ) {
      if (this.waitForCdnTuneIn(d)) return;
      this.state = Te.IDLE;
    }
    (h && d.live && this.synchronizeToLiveEdge(d), this.tick());
  }
  synchronizeToLiveEdge(n) {
    const { config: i, media: o } = this;
    if (!o) return;
    const l = this.hls.liveSyncPosition,
      h = this.getLoadPosition(),
      p = n.fragmentStart,
      d = n.edge,
      y = h >= p - i.maxFragLookUpTolerance && h <= d;
    if (l !== null && o.duration > l && (h < l || !y)) {
      const T =
        i.liveMaxLatencyDuration !== void 0
          ? i.liveMaxLatencyDuration
          : i.liveMaxLatencyDurationCount * n.targetduration;
      if (
        ((!y && o.readyState < 4) || h < d - T) &&
        (this._hasEnoughToStart || (this.nextLoadPosition = l), o.readyState)
      )
        if (
          (this.warn(
            "Playback: "
              .concat(h.toFixed(3), " is located too far from the end of live sliding playlist: ")
              .concat(d, ", reset currentTime to : ")
              .concat(l.toFixed(3)),
          ),
          this.config.liveSyncMode === "buffered")
        ) {
          var v;
          const S = Tt.bufferInfo(o, l, 0);
          if (!((v = S.buffered) != null && v.length)) {
            o.currentTime = l;
            return;
          }
          if (S.start <= h) {
            o.currentTime = l;
            return;
          }
          const { nextStart: C } = Tt.bufferedInfo(S.buffered, h, 0);
          C && (o.currentTime = C);
        } else o.currentTime = l;
    }
  }
  _handleFragmentLoadProgress(n) {
    var i;
    const o = n.frag,
      { part: l, payload: h } = n,
      { levels: p } = this;
    if (!p) {
      this.warn(
        "Levels were reset while fragment load was in progress. Fragment "
          .concat(o.sn, " of level ")
          .concat(o.level, " will not be buffered"),
      );
      return;
    }
    const d = p[o.level];
    if (!d) {
      this.warn("Level ".concat(o.level, " not found on progress"));
      return;
    }
    const y = d.details;
    if (!y) {
      (this.warn(
        "Dropping fragment ".concat(o.sn, " of level ").concat(o.level, " after level details were reset"),
      ),
        this.fragmentTracker.removeFragment(o));
      return;
    }
    const v = d.videoCodec,
      T = y.PTSKnown || !y.live,
      S = (i = o.initSegment) == null ? void 0 : i.data,
      w = this._getAudioCodec(d),
      C = (this.transmuxer =
        this.transmuxer ||
        new IM(
          this.hls,
          Xe.MAIN,
          this._handleTransmuxComplete.bind(this),
          this._handleTransmuxerFlush.bind(this),
        )),
      L = l ? l.index : -1,
      k = L !== -1,
      O = new pS(o.level, o.sn, o.stats.chunkCount, h.byteLength, L, k),
      B = this.initPTS[o.cc];
    C.push(h, S, w, v, o, l, y.totalduration, T, O, B);
  }
  onAudioTrackSwitching(n, i) {
    const o = this.hls,
      l = this.altAudio !== 0;
    if (Ug(i.url, o)) this.altAudio = 1;
    else {
      if (this.mediaBuffer !== this.media) {
        (this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),
          (this.mediaBuffer = this.media));
        const p = this.fragCurrent;
        (p &&
          (this.log("Switching to main audio track, cancel main fragment load"),
          p.abortRequests(),
          this.fragmentTracker.removeFragment(p)),
          this.resetTransmuxer(),
          this.resetLoadingState());
      } else this.audioOnly && this.resetTransmuxer();
      if (l) {
        ((this.altAudio = 0),
          this.fragmentTracker.removeAllFragments(),
          o.once(F.BUFFER_FLUSHED, () => {
            this.hls && this.hls.trigger(F.AUDIO_TRACK_SWITCHED, i);
          }),
          o.trigger(F.BUFFER_FLUSHING, { startOffset: 0, endOffset: Number.POSITIVE_INFINITY, type: null }));
        return;
      }
      o.trigger(F.AUDIO_TRACK_SWITCHED, i);
    }
  }
  onAudioTrackSwitched(n, i) {
    const o = Ug(i.url, this.hls);
    if (o) {
      const l = this.videoBuffer;
      l &&
        this.mediaBuffer !== l &&
        (this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),
        (this.mediaBuffer = l));
    }
    ((this.altAudio = o ? 2 : 0), this.tick());
  }
  onBufferCreated(n, i) {
    const o = i.tracks;
    let l,
      h,
      p = !1;
    for (const d in o) {
      const y = o[d];
      if (y.id === "main") {
        if (((h = d), (l = y), d === "video")) {
          const v = o[d];
          v && (this.videoBuffer = v.buffer);
        }
      } else p = !0;
    }
    p && l
      ? (this.log("Alternate track found, use ".concat(h, ".buffered to schedule main fragment loading")),
        (this.mediaBuffer = l.buffer))
      : (this.mediaBuffer = this.media);
  }
  onFragBuffered(n, i) {
    const { frag: o, part: l } = i,
      h = o.type === Xe.MAIN;
    if (h) {
      if (this.fragContextChanged(o)) {
        (this.warn(
          "Fragment "
            .concat(o.sn)
            .concat(l ? " p: " + l.index : "", " of level ")
            .concat(o.level, " finished buffering, but was aborted. state: ")
            .concat(this.state),
        ),
          this.state === Te.PARSED && (this.state = Te.IDLE));
        return;
      }
      const d = l ? l.stats : o.stats;
      ((this.fragLastKbps = Math.round((8 * d.total) / (d.buffering.end - d.loading.first))),
        On(o) && (this.fragPrevious = o),
        this.fragBufferedComplete(o, l));
    }
    const p = this.media;
    p &&
      (!this._hasEnoughToStart &&
        Tt.getBuffered(p).length &&
        ((this._hasEnoughToStart = !0), this.seekToStartPos()),
      h && this.tick());
  }
  get hasEnoughToStart() {
    return this._hasEnoughToStart;
  }
  onError(n, i) {
    var o;
    if (i.fatal) {
      this.state = Te.ERROR;
      return;
    }
    switch (i.details) {
      case ge.FRAG_GAP:
      case ge.FRAG_PARSING_ERROR:
      case ge.FRAG_DECRYPT_ERROR:
      case ge.FRAG_LOAD_ERROR:
      case ge.FRAG_LOAD_TIMEOUT:
      case ge.KEY_LOAD_ERROR:
      case ge.KEY_LOAD_TIMEOUT:
        this.onFragmentOrKeyLoadError(Xe.MAIN, i);
        break;
      case ge.LEVEL_LOAD_ERROR:
      case ge.LEVEL_LOAD_TIMEOUT:
      case ge.LEVEL_PARSING_ERROR:
        !i.levelRetry &&
          this.state === Te.WAITING_LEVEL &&
          ((o = i.context) == null ? void 0 : o.type) === Ot.LEVEL &&
          (this.state = Te.IDLE);
        break;
      case ge.BUFFER_ADD_CODEC_ERROR:
      case ge.BUFFER_APPEND_ERROR:
        if (i.parent !== "main") return;
        this.reduceLengthAndFlushBuffer(i) && this.resetLoadingState();
        break;
      case ge.BUFFER_FULL_ERROR:
        if (i.parent !== "main") return;
        this.reduceLengthAndFlushBuffer(i) &&
          (!this.config.interstitialsController && this.config.assetPlayerId
            ? (this._hasEnoughToStart = !0)
            : this.flushMainBuffer(0, Number.POSITIVE_INFINITY));
        break;
      case ge.INTERNAL_EXCEPTION:
        this.recoverWorkerError(i);
        break;
    }
  }
  onFragLoadEmergencyAborted() {
    ((this.state = Te.IDLE),
      this._hasEnoughToStart ||
        ((this.startFragRequested = !1), (this.nextLoadPosition = this.lastCurrentTime)),
      this.tickImmediate());
  }
  onBufferFlushed(n, { type: i }) {
    if (i !== an.AUDIO || !this.altAudio) {
      const o = (i === an.VIDEO ? this.videoBuffer : this.mediaBuffer) || this.media;
      o && (this.afterBufferFlushed(o, i, Xe.MAIN), this.tick());
    }
  }
  onLevelsUpdated(n, i) {
    (this.level > -1 &&
      this.fragCurrent &&
      ((this.level = this.fragCurrent.level),
      this.level === -1 && this.resetWhenMissingContext(this.fragCurrent)),
      (this.levels = i.levels));
  }
  swapAudioCodec() {
    this.audioCodecSwap = !this.audioCodecSwap;
  }
  seekToStartPos() {
    const { media: n } = this;
    if (!n) return;
    const i = n.currentTime;
    let o = this.startPosition;
    if (o >= 0 && i < o) {
      if (n.seeking) {
        this.log("could not seek to ".concat(o, ", already seeking at ").concat(i));
        return;
      }
      const l = this.timelineOffset;
      l && o && (o += l);
      const h = this.getLevelDetails(),
        p = Tt.getBuffered(n),
        d = p.length ? p.start(0) : 0,
        y = d - o,
        v = Math.max(this.config.maxBufferHole, this.config.maxFragLookUpTolerance);
      ((this.config.startOnSegmentBoundary ||
        (y > 0 && (y < v || (this.loadingParts && y < 2 * ((h == null ? void 0 : h.partTarget) || 0))))) &&
        (this.log("adjusting start position by ".concat(y, " to match buffer start")),
        (o += y),
        (this.startPosition = o)),
        i < o &&
          (this.log(
            "seek to target start position "
              .concat(o, " from current time ")
              .concat(i, " buffer start ")
              .concat(d),
          ),
          (n.currentTime = o)));
    }
  }
  _getAudioCodec(n) {
    let i = this.config.defaultAudioCodec || n.audioCodec;
    return (
      this.audioCodecSwap &&
        i &&
        (this.log("Swapping audio codec"),
        i.indexOf("mp4a.40.5") !== -1 ? (i = "mp4a.40.2") : (i = "mp4a.40.5")),
      i
    );
  }
  _loadBitrateTestFrag(n, i) {
    ((n.bitrateTest = !0),
      this._doFragLoad(n, i)
        .then(o => {
          const { hls: l } = this,
            h = o == null ? void 0 : o.frag;
          if (!h || this.fragContextChanged(h)) return;
          ((i.fragmentError = 0),
            (this.state = Te.IDLE),
            (this.startFragRequested = !1),
            (this.bitrateTest = !1));
          const p = h.stats;
          ((p.parsing.start = p.parsing.end = p.buffering.start = p.buffering.end = self.performance.now()),
            l.trigger(F.FRAG_LOADED, o),
            (h.bitrateTest = !1));
        })
        .catch(o => {
          this.state === Te.STOPPED ||
            this.state === Te.ERROR ||
            (this.warn(o), this.resetFragmentLoading(n));
        }));
  }
  _handleTransmuxComplete(n) {
    const i = this.playlistType,
      { hls: o } = this,
      { remuxResult: l, chunkMeta: h } = n,
      p = this.getCurrentContext(h);
    if (!p) {
      this.resetWhenMissingContext(h);
      return;
    }
    const { frag: d, part: y, level: v } = p,
      { video: T, text: S, id3: w, initSegment: C } = l,
      { details: L } = v,
      k = this.altAudio ? void 0 : l.audio;
    if (this.fragContextChanged(d)) {
      this.fragmentTracker.removeFragment(d);
      return;
    }
    if (((this.state = Te.PARSING), C)) {
      const O = C.tracks;
      if (O) {
        const I = d.initSegment || d;
        if (this.unhandledEncryptionError(C, d)) return;
        (this._bufferInitSegment(v, O, I, h),
          o.trigger(F.FRAG_PARSING_INIT_SEGMENT, { frag: I, id: i, tracks: O }));
      }
      const B = C.initPTS,
        N = C.timescale,
        $ = this.initPTS[d.cc];
      if (Ue(B) && (!$ || $.baseTime !== B || $.timescale !== N)) {
        const I = C.trackId;
        ((this.initPTS[d.cc] = { baseTime: B, timescale: N, trackId: I }),
          o.trigger(F.INIT_PTS_FOUND, { frag: d, id: i, initPTS: B, timescale: N, trackId: I }));
      }
    }
    if (T && L) {
      k && T.type === "audiovideo" && this.logMuxedErr(d);
      const O = L.fragments[d.sn - 1 - L.startSN],
        B = d.sn === L.startSN,
        N = !O || d.cc > O.cc;
      if (l.independent !== !1) {
        const { startPTS: $, endPTS: I, startDTS: V, endDTS: oe } = T;
        if (y) y.elementaryStreams[T.type] = { startPTS: $, endPTS: I, startDTS: V, endDTS: oe };
        else if (
          (T.firstKeyFrame && T.independent && h.id === 1 && !N && (this.couldBacktrack = !0),
          T.dropped && T.independent)
        ) {
          const Y = this.getMainFwdBufferInfo(),
            te = (Y ? Y.end : this.getLoadPosition()) + this.config.maxBufferHole,
            _ = T.firstKeyFramePTS ? T.firstKeyFramePTS : $;
          if (!B && te < _ - this.config.maxBufferHole && !N) {
            this.backtrack(d);
            return;
          } else N && (d.gap = !0);
          d.setElementaryStreamInfo(T.type, d.start, I, d.start, oe, !0);
        } else B && $ - (L.appliedTimelineOffset || 0) > Tg && (d.gap = !0);
        (d.setElementaryStreamInfo(T.type, $, I, V, oe),
          this.backtrackFragment && (this.backtrackFragment = d),
          this.bufferFragmentData(T, d, y, h, B || N));
      } else if (B || N) d.gap = !0;
      else {
        this.backtrack(d);
        return;
      }
    }
    if (k) {
      const { startPTS: O, endPTS: B, startDTS: N, endDTS: $ } = k;
      (y && (y.elementaryStreams[an.AUDIO] = { startPTS: O, endPTS: B, startDTS: N, endDTS: $ }),
        d.setElementaryStreamInfo(an.AUDIO, O, B, N, $),
        this.bufferFragmentData(k, d, y, h));
    }
    if (L && w != null && w.samples.length) {
      const O = { id: i, frag: d, details: L, samples: w.samples };
      o.trigger(F.FRAG_PARSING_METADATA, O);
    }
    if (L && S) {
      const O = { id: i, frag: d, details: L, samples: S.samples };
      o.trigger(F.FRAG_PARSING_USERDATA, O);
    }
  }
  logMuxedErr(n) {
    this.warn(
      ""
        .concat(On(n) ? "Media" : "Init", " segment with muxed audiovideo where only video expected: ")
        .concat(n.url),
    );
  }
  _bufferInitSegment(n, i, o, l) {
    if (this.state !== Te.PARSING) return;
    ((this.audioOnly = !!i.audio && !i.video),
      this.altAudio && !this.audioOnly && (delete i.audio, i.audiovideo && this.logMuxedErr(o)));
    const { audio: h, video: p, audiovideo: d } = i;
    if (h) {
      const v = n.audioCodec;
      let T = fg(h.codec, v);
      T === "mp4a" && (T = "mp4a.40.5");
      const S = navigator.userAgent.toLowerCase();
      if (this.audioCodecSwitch) {
        T && (T.indexOf("mp4a.40.5") !== -1 ? (T = "mp4a.40.2") : (T = "mp4a.40.5"));
        const w = h.metadata;
        w &&
          "channelCount" in w &&
          (w.channelCount || 1) !== 1 &&
          S.indexOf("firefox") === -1 &&
          (T = "mp4a.40.5");
      }
      (T &&
        T.indexOf("mp4a.40.5") !== -1 &&
        S.indexOf("android") !== -1 &&
        h.container !== "audio/mpeg" &&
        ((T = "mp4a.40.2"), this.log("Android: force audio codec to ".concat(T))),
        v && v !== T && this.log('Swapping manifest audio codec "'.concat(v, '" for "').concat(T, '"')),
        (h.levelCodec = T),
        (h.id = Xe.MAIN),
        this.log(
          "Init audio buffer, container:"
            .concat(h.container, ", codecs[selected/level/parsed]=[")
            .concat(T || "", "/")
            .concat(v || "", "/")
            .concat(h.codec, "]"),
        ),
        delete i.audiovideo);
    }
    if (p) {
      ((p.levelCodec = n.videoCodec), (p.id = Xe.MAIN));
      const v = p.codec;
      if ((v == null ? void 0 : v.length) === 4)
        switch (v) {
          case "hvc1":
          case "hev1":
            p.codec = "hvc1.1.6.L120.90";
            break;
          case "av01":
            p.codec = "av01.0.04M.08";
            break;
          case "avc1":
            p.codec = "avc1.42e01e";
            break;
        }
      (this.log(
        "Init video buffer, container:"
          .concat(p.container, ", codecs[level/parsed]=[")
          .concat(n.videoCodec || "", "/")
          .concat(v, "]")
          .concat(p.codec !== v ? " parsed-corrected=" + p.codec : "")
          .concat(p.supplemental ? " supplemental=" + p.supplemental : ""),
      ),
        delete i.audiovideo);
    }
    d &&
      (this.log(
        "Init audiovideo buffer, container:"
          .concat(d.container, ", codecs[level/parsed]=[")
          .concat(n.codecs, "/")
          .concat(d.codec, "]"),
      ),
      delete i.video,
      delete i.audio);
    const y = Object.keys(i);
    if (y.length) {
      if ((this.hls.trigger(F.BUFFER_CODECS, i), !this.hls)) return;
      y.forEach(v => {
        const S = i[v].initSegment;
        S != null &&
          S.byteLength &&
          this.hls.trigger(F.BUFFER_APPENDING, {
            type: v,
            data: S,
            frag: o,
            part: null,
            chunkMeta: l,
            parent: o.type,
          });
      });
    }
    this.tickImmediate();
  }
  getMainFwdBufferInfo() {
    const n = this.mediaBuffer && this.altAudio === 2 ? this.mediaBuffer : this.media;
    return this.getFwdBufferInfo(n, Xe.MAIN);
  }
  get maxBufferLength() {
    const { levels: n, level: i } = this,
      o = n == null ? void 0 : n[i];
    return o ? this.getMaxBufferLength(o.maxBitrate) : this.config.maxBufferLength;
  }
  backtrack(n) {
    ((this.couldBacktrack = !0),
      (this.backtrackFragment = n),
      this.resetTransmuxer(),
      this.flushBufferGap(n),
      this.fragmentTracker.removeFragment(n),
      (this.fragPrevious = null),
      (this.nextLoadPosition = n.start),
      (this.state = Te.IDLE));
  }
  checkFragmentChanged() {
    const n = this.media;
    let i = null;
    if (n && n.readyState > 1 && n.seeking === !1) {
      const o = n.currentTime;
      if (
        (Tt.isBuffered(n, o)
          ? (i = this.getAppendedFrag(o))
          : Tt.isBuffered(n, o + 0.1) && (i = this.getAppendedFrag(o + 0.1)),
        i)
      ) {
        this.backtrackFragment = null;
        const l = this.fragPlaying,
          h = i.level;
        (!l || i.sn !== l.sn || l.level !== h) &&
          ((this.fragPlaying = i),
          this.hls.trigger(F.FRAG_CHANGED, { frag: i }),
          (!l || l.level !== h) && this.hls.trigger(F.LEVEL_SWITCHED, { level: h }));
      }
    }
  }
  get nextLevel() {
    const n = this.nextBufferedFrag;
    return n ? n.level : -1;
  }
  get currentFrag() {
    var n;
    if (this.fragPlaying) return this.fragPlaying;
    const i = ((n = this.media) == null ? void 0 : n.currentTime) || this.lastCurrentTime;
    return Ue(i) ? this.getAppendedFrag(i) : null;
  }
  get currentProgramDateTime() {
    var n;
    const i = ((n = this.media) == null ? void 0 : n.currentTime) || this.lastCurrentTime;
    if (Ue(i)) {
      const o = this.getLevelDetails(),
        l = this.currentFrag || (o ? Aa(null, o.fragments, i) : null);
      if (l) {
        const h = l.programDateTime;
        if (h !== null) {
          const p = h + (i - l.start) * 1e3;
          return new Date(p);
        }
      }
    }
    return null;
  }
  get currentLevel() {
    const n = this.currentFrag;
    return n ? n.level : -1;
  }
  get nextBufferedFrag() {
    const n = this.currentFrag;
    return n ? this.followingBufferedFrag(n) : null;
  }
  get forceStartLoad() {
    return this._forceStartLoad;
  }
}
class Xz extends Pr {
  constructor(n, i) {
    (super("key-loader", i),
      (this.config = void 0),
      (this.keyIdToKeyInfo = {}),
      (this.emeController = null),
      (this.config = n));
  }
  abort(n) {
    for (const o in this.keyIdToKeyInfo) {
      const l = this.keyIdToKeyInfo[o].loader;
      if (l) {
        var i;
        if (n && n !== ((i = l.context) == null ? void 0 : i.frag.type)) return;
        l.abort();
      }
    }
  }
  detach() {
    for (const n in this.keyIdToKeyInfo) {
      const i = this.keyIdToKeyInfo[n];
      (i.mediaKeySessionContext || i.decryptdata.isCommonEncryption) && delete this.keyIdToKeyInfo[n];
    }
  }
  destroy() {
    this.detach();
    for (const n in this.keyIdToKeyInfo) {
      const i = this.keyIdToKeyInfo[n].loader;
      i && i.destroy();
    }
    this.keyIdToKeyInfo = {};
  }
  createKeyLoadError(n, i = ge.KEY_LOAD_ERROR, o, l, h) {
    return new Vs({
      type: et.NETWORK_ERROR,
      details: i,
      fatal: !1,
      frag: n,
      response: h,
      error: o,
      networkDetails: l,
    });
  }
  loadClear(n, i, o) {
    if (
      this.emeController &&
      this.config.emeEnabled &&
      !this.emeController.getSelectedKeySystemFormats().length
    ) {
      if (i.length)
        for (let l = 0, h = i.length; l < h; l++) {
          const p = i[l];
          if ((n.cc <= p.cc && (!On(n) || !On(p) || n.sn < p.sn)) || (!o && l == h - 1))
            return this.emeController.selectKeySystemFormat(p).then(d => {
              if (!this.emeController) return;
              p.setKeyFormat(d);
              const y = gg(d);
              if (y) return this.emeController.getKeySystemAccess([y]);
            });
        }
      if (this.config.requireKeySystemAccessOnStart) {
        const l = rd(this.config);
        if (l.length) return this.emeController.getKeySystemAccess(l);
      }
    }
    return null;
  }
  load(n) {
    return !n.decryptdata && n.encrypted && this.emeController && this.config.emeEnabled
      ? this.emeController.selectKeySystemFormat(n).then(i => this.loadInternal(n, i))
      : this.loadInternal(n);
  }
  loadInternal(n, i) {
    var o, l;
    i && n.setKeyFormat(i);
    const h = n.decryptdata;
    if (!h) {
      const v = new Error(
        i
          ? "Expected frag.decryptdata to be defined after setting format ".concat(i)
          : "Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ".concat(
              this.emeController && this.config.emeEnabled,
              ")",
            ),
      );
      return Promise.reject(this.createKeyLoadError(n, ge.KEY_LOAD_ERROR, v));
    }
    const p = h.uri;
    if (!p)
      return Promise.reject(
        this.createKeyLoadError(n, ge.KEY_LOAD_ERROR, new Error('Invalid key URI: "'.concat(p, '"'))),
      );
    const d = Yx(h);
    let y = this.keyIdToKeyInfo[d];
    if ((o = y) != null && o.decryptdata.key)
      return ((h.key = y.decryptdata.key), Promise.resolve({ frag: n, keyInfo: y }));
    if (this.emeController && (l = y) != null && l.keyLoadPromise)
      switch (this.emeController.getKeyStatus(y.decryptdata)) {
        case "usable":
        case "usable-in-future":
          return y.keyLoadPromise.then(T => {
            const { keyInfo: S } = T;
            return ((h.key = S.decryptdata.key), { frag: n, keyInfo: S });
          });
      }
    switch (
      (this.log(
        ""
          .concat(this.keyIdToKeyInfo[d] ? "Rel" : "L", "oading")
          .concat(h.keyId ? " keyId: " + yi(h.keyId) : "", " URI: ")
          .concat(h.uri, " from ")
          .concat(n.type, " ")
          .concat(n.level),
      ),
      (y = this.keyIdToKeyInfo[d] =
        { decryptdata: h, keyLoadPromise: null, loader: null, mediaKeySessionContext: null }),
      h.method)
    ) {
      case "SAMPLE-AES":
      case "SAMPLE-AES-CENC":
      case "SAMPLE-AES-CTR":
        return h.keyFormat === "identity" ? this.loadKeyHTTP(y, n) : this.loadKeyEME(y, n);
      case "AES-128":
      case "AES-256":
      case "AES-256-CTR":
        return this.loadKeyHTTP(y, n);
      default:
        return Promise.reject(
          this.createKeyLoadError(
            n,
            ge.KEY_LOAD_ERROR,
            new Error('Key supplied with unsupported METHOD: "'.concat(h.method, '"')),
          ),
        );
    }
  }
  loadKeyEME(n, i) {
    const o = { frag: i, keyInfo: n };
    if (this.emeController && this.config.emeEnabled) {
      var l;
      if (!n.decryptdata.keyId && (l = i.initSegment) != null && l.data) {
        const p = pH(i.initSegment.data);
        if (p.length) {
          let d = p[0];
          (d.some(y => y !== 0)
            ? (this.log("Using keyId found in init segment ".concat(yi(d))),
              Mo.setKeyIdForUri(n.decryptdata.uri, d))
            : ((d = Mo.addKeyIdForUri(n.decryptdata.uri)),
              this.log("Generating keyId to patch media ".concat(yi(d)))),
            (n.decryptdata.keyId = d));
        }
      }
      if (!n.decryptdata.keyId && !On(i)) return Promise.resolve(o);
      const h = this.emeController.loadKey(o);
      return (n.keyLoadPromise = h.then(p => ((n.mediaKeySessionContext = p), o))).catch(p => {
        throw ((n.keyLoadPromise = null), "data" in p && (p.data.frag = i), p);
      });
    }
    return Promise.resolve(o);
  }
  loadKeyHTTP(n, i) {
    const o = this.config,
      l = o.loader,
      h = new l(o);
    return (
      (i.keyLoader = n.loader = h),
      (n.keyLoadPromise = new Promise((p, d) => {
        const y = { keyInfo: n, frag: i, responseType: "arraybuffer", url: n.decryptdata.uri },
          v = o.keyLoadPolicy.default,
          T = { loadPolicy: v, timeout: v.maxLoadTimeMs, maxRetry: 0, retryDelay: 0, maxRetryDelay: 0 },
          S = {
            onSuccess: (w, C, L, k) => {
              const { frag: O, keyInfo: B } = L,
                N = Yx(B.decryptdata);
              if (!O.decryptdata || B !== this.keyIdToKeyInfo[N])
                return d(
                  this.createKeyLoadError(
                    O,
                    ge.KEY_LOAD_ERROR,
                    new Error("after key load, decryptdata unset or changed"),
                    k,
                  ),
                );
              ((B.decryptdata.key = O.decryptdata.key = new Uint8Array(w.data)),
                (O.keyLoader = null),
                (B.loader = null),
                p({ frag: O, keyInfo: B }));
            },
            onError: (w, C, L, k) => {
              (this.resetLoader(C),
                d(
                  this.createKeyLoadError(
                    i,
                    ge.KEY_LOAD_ERROR,
                    new Error("HTTP Error ".concat(w.code, " loading key ").concat(w.text)),
                    L,
                    Jt({ url: y.url, data: void 0 }, w),
                  ),
                ));
            },
            onTimeout: (w, C, L) => {
              (this.resetLoader(C),
                d(this.createKeyLoadError(i, ge.KEY_LOAD_TIMEOUT, new Error("key loading timed out"), L)));
            },
            onAbort: (w, C, L) => {
              (this.resetLoader(C),
                d(this.createKeyLoadError(i, ge.INTERNAL_ABORTED, new Error("key loading aborted"), L)));
            },
          };
        h.load(y, T, S);
      }))
    );
  }
  resetLoader(n) {
    const { frag: i, keyInfo: o, url: l } = n,
      h = o.loader;
    i.keyLoader === h && ((i.keyLoader = null), (o.loader = null));
    const p = Yx(o.decryptdata) || l;
    (delete this.keyIdToKeyInfo[p], h && h.destroy());
  }
}
function Yx(u) {
  if (u.keyFormat !== vi.FAIRPLAY) {
    const n = u.keyId;
    if (n) return yi(n);
  }
  return u.uri;
}
function Qb(u) {
  const { type: n } = u;
  switch (n) {
    case Ot.AUDIO_TRACK:
      return Xe.AUDIO;
    case Ot.SUBTITLE_TRACK:
      return Xe.SUBTITLE;
    default:
      return Xe.MAIN;
  }
}
function Xx(u, n) {
  let i = u.url;
  return ((i === void 0 || i.indexOf("data:") === 0) && (i = n.url), i);
}
class qz {
  constructor(n) {
    ((this.hls = void 0),
      (this.loaders = Object.create(null)),
      (this.variableList = null),
      (this.onManifestLoaded = this.checkAutostartLoad),
      (this.hls = n),
      this.registerListeners());
  }
  startLoad(n) {}
  stopLoad() {
    this.destroyInternalLoaders();
  }
  registerListeners() {
    const { hls: n } = this;
    (n.on(F.MANIFEST_LOADING, this.onManifestLoading, this),
      n.on(F.LEVEL_LOADING, this.onLevelLoading, this),
      n.on(F.AUDIO_TRACK_LOADING, this.onAudioTrackLoading, this),
      n.on(F.SUBTITLE_TRACK_LOADING, this.onSubtitleTrackLoading, this),
      n.on(F.LEVELS_UPDATED, this.onLevelsUpdated, this));
  }
  unregisterListeners() {
    const { hls: n } = this;
    (n.off(F.MANIFEST_LOADING, this.onManifestLoading, this),
      n.off(F.LEVEL_LOADING, this.onLevelLoading, this),
      n.off(F.AUDIO_TRACK_LOADING, this.onAudioTrackLoading, this),
      n.off(F.SUBTITLE_TRACK_LOADING, this.onSubtitleTrackLoading, this),
      n.off(F.LEVELS_UPDATED, this.onLevelsUpdated, this));
  }
  createInternalLoader(n) {
    const i = this.hls.config,
      o = i.pLoader,
      l = i.loader,
      h = o || l,
      p = new h(i);
    return ((this.loaders[n.type] = p), p);
  }
  getInternalLoader(n) {
    return this.loaders[n.type];
  }
  resetInternalLoader(n) {
    this.loaders[n] && delete this.loaders[n];
  }
  destroyInternalLoaders() {
    for (const n in this.loaders) {
      const i = this.loaders[n];
      (i && i.destroy(), this.resetInternalLoader(n));
    }
  }
  destroy() {
    ((this.variableList = null), this.unregisterListeners(), this.destroyInternalLoaders());
  }
  onManifestLoading(n, i) {
    const { url: o } = i;
    ((this.variableList = null),
      this.load({
        id: null,
        level: 0,
        responseType: "text",
        type: Ot.MANIFEST,
        url: o,
        deliveryDirectives: null,
        levelOrTrack: null,
      }));
  }
  onLevelLoading(n, i) {
    const { id: o, level: l, pathwayId: h, url: p, deliveryDirectives: d, levelInfo: y } = i;
    this.load({
      id: o,
      level: l,
      pathwayId: h,
      responseType: "text",
      type: Ot.LEVEL,
      url: p,
      deliveryDirectives: d,
      levelOrTrack: y,
    });
  }
  onAudioTrackLoading(n, i) {
    const { id: o, groupId: l, url: h, deliveryDirectives: p, track: d } = i;
    this.load({
      id: o,
      groupId: l,
      level: null,
      responseType: "text",
      type: Ot.AUDIO_TRACK,
      url: h,
      deliveryDirectives: p,
      levelOrTrack: d,
    });
  }
  onSubtitleTrackLoading(n, i) {
    const { id: o, groupId: l, url: h, deliveryDirectives: p, track: d } = i;
    this.load({
      id: o,
      groupId: l,
      level: null,
      responseType: "text",
      type: Ot.SUBTITLE_TRACK,
      url: h,
      deliveryDirectives: p,
      levelOrTrack: d,
    });
  }
  onLevelsUpdated(n, i) {
    const o = this.loaders[Ot.LEVEL];
    if (o) {
      const l = o.context;
      l && !i.levels.some(h => h === l.levelOrTrack) && (o.abort(), delete this.loaders[Ot.LEVEL]);
    }
  }
  load(n) {
    var i;
    const o = this.hls.config;
    let l = this.getInternalLoader(n);
    if (l) {
      const v = this.hls.logger,
        T = l.context;
      if (
        T &&
        T.levelOrTrack === n.levelOrTrack &&
        (T.url === n.url || (T.deliveryDirectives && !n.deliveryDirectives))
      ) {
        T.url === n.url
          ? v.log("[playlist-loader]: ignore ".concat(n.url, " ongoing request"))
          : v.log("[playlist-loader]: ignore ".concat(n.url, " in favor of ").concat(T.url));
        return;
      }
      (v.log("[playlist-loader]: aborting previous loader for type: ".concat(n.type)), l.abort());
    }
    let h;
    if (
      (n.type === Ot.MANIFEST
        ? (h = o.manifestLoadPolicy.default)
        : (h = rn({}, o.playlistLoadPolicy.default, { timeoutRetry: null, errorRetry: null })),
      (l = this.createInternalLoader(n)),
      Ue((i = n.deliveryDirectives) == null ? void 0 : i.part))
    ) {
      let v;
      if (
        (n.type === Ot.LEVEL && n.level !== null
          ? (v = this.hls.levels[n.level].details)
          : n.type === Ot.AUDIO_TRACK && n.id !== null
            ? (v = this.hls.audioTracks[n.id].details)
            : n.type === Ot.SUBTITLE_TRACK && n.id !== null && (v = this.hls.subtitleTracks[n.id].details),
        v)
      ) {
        const T = v.partTarget,
          S = v.targetduration;
        if (T && S) {
          const w = Math.max(T * 3, S * 0.8) * 1e3;
          h = rn({}, h, {
            maxTimeToFirstByteMs: Math.min(w, h.maxTimeToFirstByteMs),
            maxLoadTimeMs: Math.min(w, h.maxTimeToFirstByteMs),
          });
        }
      }
    }
    const p = h.errorRetry || h.timeoutRetry || {},
      d = {
        loadPolicy: h,
        timeout: h.maxLoadTimeMs,
        maxRetry: p.maxNumRetry || 0,
        retryDelay: p.retryDelayMs || 0,
        maxRetryDelay: p.maxRetryDelayMs || 0,
      },
      y = {
        onSuccess: (v, T, S, w) => {
          const C = this.getInternalLoader(S);
          this.resetInternalLoader(S.type);
          const L = v.data;
          ((T.parsing.start = performance.now()),
            us.isMediaPlaylist(L) || S.type !== Ot.MANIFEST
              ? this.handleTrackOrLevelPlaylist(v, T, S, w || null, C)
              : this.handleMasterPlaylist(v, T, S, w));
        },
        onError: (v, T, S, w) => {
          this.handleNetworkError(T, S, !1, v, w);
        },
        onTimeout: (v, T, S) => {
          this.handleNetworkError(T, S, !0, void 0, v);
        },
      };
    l.load(n, d, y);
  }
  checkAutostartLoad() {
    if (!this.hls) return;
    const {
      config: { autoStartLoad: n, startPosition: i },
      forceStartLoad: o,
    } = this.hls;
    (n || o) &&
      (this.hls.logger.log(
        "".concat(n ? "auto" : "force", " startLoad with configured startPosition ").concat(i),
      ),
      this.hls.startLoad(i));
  }
  handleMasterPlaylist(n, i, o, l) {
    const h = this.hls,
      p = n.data,
      d = Xx(n, o),
      y = us.parseMasterPlaylist(p, d);
    if (y.playlistParsingError) {
      ((i.parsing.end = performance.now()),
        this.handleManifestParsingError(n, o, y.playlistParsingError, l, i));
      return;
    }
    const {
      contentSteering: v,
      levels: T,
      sessionData: S,
      sessionKeys: w,
      startTimeOffset: C,
      variableList: L,
    } = y;
    ((this.variableList = L),
      T.forEach(N => {
        const { unknownCodecs: $ } = N;
        if ($) {
          const { preferManagedMediaSource: I } = this.hls.config;
          let { audioCodec: V, videoCodec: oe } = N;
          for (let Y = $.length; Y--; ) {
            const te = $[Y];
            Rd(te, "audio", I)
              ? ((N.audioCodec = V = V ? "".concat(V, ",").concat(te) : te),
                (uu.audio[V.substring(0, 4)] = 2),
                $.splice(Y, 1))
              : Rd(te, "video", I) &&
                ((N.videoCodec = oe = oe ? "".concat(oe, ",").concat(te) : te),
                (uu.video[oe.substring(0, 4)] = 2),
                $.splice(Y, 1));
          }
        }
      }));
    const { AUDIO: k = [], SUBTITLES: O, "CLOSED-CAPTIONS": B } = us.parseMasterPlaylistMedia(p, d, y);
    (k.length &&
      !k.some($ => !$.url) &&
      T[0].audioCodec &&
      !T[0].attrs.AUDIO &&
      (this.hls.logger.log(
        "[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one",
      ),
      k.unshift({
        type: "main",
        name: "main",
        groupId: "main",
        default: !1,
        autoselect: !1,
        forced: !1,
        id: -1,
        attrs: new In({}),
        bitrate: 0,
        url: "",
      })),
      h.trigger(F.MANIFEST_LOADED, {
        levels: T,
        audioTracks: k,
        subtitles: O,
        captions: B,
        contentSteering: v,
        url: d,
        stats: i,
        networkDetails: l,
        sessionData: S,
        sessionKeys: w,
        startTimeOffset: C,
        variableList: L,
      }));
  }
  handleTrackOrLevelPlaylist(n, i, o, l, h) {
    const p = this.hls,
      { id: d, level: y, type: v } = o,
      T = Xx(n, o),
      S = Ue(y) ? y : Ue(d) ? d : 0,
      w = Qb(o),
      C = us.parseLevelPlaylist(n.data, T, S, w, 0, this.variableList);
    if (v === Ot.MANIFEST) {
      const L = { attrs: new In({}), bitrate: 0, details: C, name: "", url: T };
      ((C.requestScheduled = i.loading.start + Zk(C, 0)),
        p.trigger(F.MANIFEST_LOADED, {
          levels: [L],
          audioTracks: [],
          url: T,
          stats: i,
          networkDetails: l,
          sessionData: null,
          sessionKeys: null,
          contentSteering: null,
          startTimeOffset: null,
          variableList: null,
        }));
    }
    ((i.parsing.end = performance.now()), (o.levelDetails = C), this.handlePlaylistLoaded(C, n, i, o, l, h));
  }
  handleManifestParsingError(n, i, o, l, h) {
    this.hls.trigger(F.ERROR, {
      type: et.NETWORK_ERROR,
      details: ge.MANIFEST_PARSING_ERROR,
      fatal: i.type === Ot.MANIFEST,
      url: n.url,
      err: o,
      error: o,
      reason: o.message,
      response: n,
      context: i,
      networkDetails: l,
      stats: h,
    });
  }
  handleNetworkError(n, i, o = !1, l, h) {
    let p = "A network "
      .concat(o ? "timeout" : "error" + (l ? " (status " + l.code + ")" : ""), " occurred while loading ")
      .concat(n.type);
    n.type === Ot.LEVEL
      ? (p += ": ".concat(n.level, " id: ").concat(n.id))
      : (n.type === Ot.AUDIO_TRACK || n.type === Ot.SUBTITLE_TRACK) &&
        (p += " id: ".concat(n.id, ' group-id: "').concat(n.groupId, '"'));
    const d = new Error(p);
    this.hls.logger.warn("[playlist-loader]: ".concat(p));
    let y = ge.UNKNOWN,
      v = !1;
    const T = this.getInternalLoader(n);
    switch (n.type) {
      case Ot.MANIFEST:
        ((y = o ? ge.MANIFEST_LOAD_TIMEOUT : ge.MANIFEST_LOAD_ERROR), (v = !0));
        break;
      case Ot.LEVEL:
        ((y = o ? ge.LEVEL_LOAD_TIMEOUT : ge.LEVEL_LOAD_ERROR), (v = !1));
        break;
      case Ot.AUDIO_TRACK:
        ((y = o ? ge.AUDIO_TRACK_LOAD_TIMEOUT : ge.AUDIO_TRACK_LOAD_ERROR), (v = !1));
        break;
      case Ot.SUBTITLE_TRACK:
        ((y = o ? ge.SUBTITLE_TRACK_LOAD_TIMEOUT : ge.SUBTITLE_LOAD_ERROR), (v = !1));
        break;
    }
    T && this.resetInternalLoader(n.type);
    const S = {
      type: et.NETWORK_ERROR,
      details: y,
      fatal: v,
      url: n.url,
      loader: T,
      context: n,
      error: d,
      networkDetails: i,
      stats: h,
    };
    if (l) {
      const w = (i == null ? void 0 : i.url) || n.url;
      S.response = Jt({ url: w, data: void 0 }, l);
    }
    this.hls.trigger(F.ERROR, S);
  }
  handlePlaylistLoaded(n, i, o, l, h, p) {
    const d = this.hls,
      { type: y, level: v, levelOrTrack: T, id: S, groupId: w, deliveryDirectives: C } = l,
      L = Xx(i, l),
      k = Qb(l);
    let O = typeof l.level == "number" && k === Xe.MAIN ? v : void 0;
    const B = n.playlistParsingError;
    if (B) {
      if ((this.hls.logger.warn("".concat(B, " ").concat(n.url)), !d.config.ignorePlaylistParsingErrors)) {
        d.trigger(F.ERROR, {
          type: et.NETWORK_ERROR,
          details: ge.LEVEL_PARSING_ERROR,
          fatal: !1,
          url: L,
          error: B,
          reason: B.message,
          response: i,
          context: l,
          level: O,
          parent: k,
          networkDetails: h,
          stats: o,
        });
        return;
      }
      n.playlistParsingError = null;
    }
    if (!n.fragments.length) {
      const N = (n.playlistParsingError = new Error("No Segments found in Playlist"));
      d.trigger(F.ERROR, {
        type: et.NETWORK_ERROR,
        details: ge.LEVEL_EMPTY_ERROR,
        fatal: !1,
        url: L,
        error: N,
        reason: N.message,
        response: i,
        context: l,
        level: O,
        parent: k,
        networkDetails: h,
        stats: o,
      });
      return;
    }
    switch (
      (n.live &&
        p &&
        (p.getCacheAge && (n.ageHeader = p.getCacheAge() || 0),
        (!p.getCacheAge || isNaN(n.ageHeader)) && (n.ageHeader = 0)),
      y)
    ) {
      case Ot.MANIFEST:
      case Ot.LEVEL:
        if (O) {
          if (!T) O = 0;
          else if (T !== d.levels[O]) {
            const N = d.levels.indexOf(T);
            N > -1 && (O = N);
          }
        }
        d.trigger(F.LEVEL_LOADED, {
          details: n,
          levelInfo: T || d.levels[0],
          level: O || 0,
          id: S || 0,
          stats: o,
          networkDetails: h,
          deliveryDirectives: C,
          withoutMultiVariant: y === Ot.MANIFEST,
        });
        break;
      case Ot.AUDIO_TRACK:
        d.trigger(F.AUDIO_TRACK_LOADED, {
          details: n,
          track: T,
          id: S || 0,
          groupId: w || "",
          stats: o,
          networkDetails: h,
          deliveryDirectives: C,
        });
        break;
      case Ot.SUBTITLE_TRACK:
        d.trigger(F.SUBTITLE_TRACK_LOADED, {
          details: n,
          track: T,
          id: S || 0,
          groupId: w || "",
          stats: o,
          networkDetails: h,
          deliveryDirectives: C,
        });
        break;
    }
  }
}
class _o {
  static get version() {
    return _d;
  }
  static isMSESupported() {
    return JM();
  }
  static isSupported() {
    return Kz();
  }
  static getMediaSource() {
    return Oo();
  }
  static get Events() {
    return F;
  }
  static get MetadataSchema() {
    return Tr;
  }
  static get ErrorTypes() {
    return et;
  }
  static get ErrorDetails() {
    return ge;
  }
  static get DefaultConfig() {
    return _o.defaultConfig ? _o.defaultConfig : Mz;
  }
  static set DefaultConfig(n) {
    _o.defaultConfig = n;
  }
  constructor(n = {}) {
    ((this.config = void 0),
      (this.userConfig = void 0),
      (this.logger = void 0),
      (this.coreComponents = void 0),
      (this.networkControllers = void 0),
      (this._emitter = new vS()),
      (this._autoLevelCapping = -1),
      (this._maxHdcpLevel = null),
      (this.abrController = void 0),
      (this.bufferController = void 0),
      (this.capLevelController = void 0),
      (this.latencyController = void 0),
      (this.levelController = void 0),
      (this.streamController = void 0),
      (this.audioStreamController = void 0),
      (this.subtititleStreamController = void 0),
      (this.audioTrackController = void 0),
      (this.subtitleTrackController = void 0),
      (this.interstitialsController = void 0),
      (this.gapController = void 0),
      (this.emeController = void 0),
      (this.cmcdController = void 0),
      (this._media = null),
      (this._url = null),
      (this._sessionId = void 0),
      (this.triggeringException = void 0),
      (this.started = !1));
    const i = (this.logger = nH(n.debug || !1, "Hls instance", n.assetPlayerId)),
      o = (this.config = Oz(_o.DefaultConfig, n, i));
    ((this.userConfig = n), o.progressive && Nz(o, i));
    const {
        abrController: l,
        bufferController: h,
        capLevelController: p,
        errorController: d,
        fpsController: y,
      } = o,
      v = new d(this),
      T = (this.abrController = new l(this)),
      S = new QH(this),
      w = o.interstitialsController,
      C = w ? (this.interstitialsController = new w(this, _o)) : null,
      L = (this.bufferController = new h(this, S)),
      k = (this.capLevelController = new p(this)),
      O = new y(this),
      B = new qz(this),
      N = o.contentSteeringController,
      $ = N ? new N(this) : null,
      I = (this.levelController = new Hz(this, $)),
      V = new jz(this),
      oe = new Xz(this.config, this.logger),
      Y = (this.streamController = new Yz(this, S, oe)),
      te = (this.gapController = new $z(this, S));
    (k.setStreamController(Y), O.setStreamController(Y));
    const _ = [B, I, Y];
    (C && _.splice(1, 0, C), $ && _.splice(1, 0, $), (this.networkControllers = _));
    const K = [T, L, te, k, O, V, S];
    this.audioTrackController = this.createController(o.audioTrackController, _);
    const q = o.audioStreamController;
    (q && _.push((this.audioStreamController = new q(this, S, oe))),
      (this.subtitleTrackController = this.createController(o.subtitleTrackController, _)));
    const ce = o.subtitleStreamController;
    (ce && _.push((this.subtititleStreamController = new ce(this, S, oe))),
      this.createController(o.timelineController, K),
      (oe.emeController = this.emeController = this.createController(o.emeController, K)),
      (this.cmcdController = this.createController(o.cmcdController, K)),
      (this.latencyController = this.createController(Vz, K)),
      (this.coreComponents = K),
      _.push(v));
    const he = v.onErrorOut;
    (typeof he == "function" && this.on(F.ERROR, he, v), this.on(F.MANIFEST_LOADED, B.onManifestLoaded, B));
  }
  createController(n, i) {
    if (n) {
      const o = new n(this);
      return (i && i.push(o), o);
    }
    return null;
  }
  on(n, i, o = this) {
    this._emitter.on(n, i, o);
  }
  once(n, i, o = this) {
    this._emitter.once(n, i, o);
  }
  removeAllListeners(n) {
    this._emitter.removeAllListeners(n);
  }
  off(n, i, o = this, l) {
    this._emitter.off(n, i, o, l);
  }
  listeners(n) {
    return this._emitter.listeners(n);
  }
  emit(n, i, o) {
    return this._emitter.emit(n, i, o);
  }
  trigger(n, i) {
    if (this.config.debug) return this.emit(n, n, i);
    try {
      return this.emit(n, n, i);
    } catch (o) {
      if (
        (this.logger.error(
          "An internal error happened while handling event " +
            n +
            '. Error message: "' +
            o.message +
            '". Here is a stacktrace:',
          o,
        ),
        !this.triggeringException)
      ) {
        this.triggeringException = !0;
        const l = n === F.ERROR;
        (this.trigger(F.ERROR, {
          type: et.OTHER_ERROR,
          details: ge.INTERNAL_EXCEPTION,
          fatal: l,
          event: n,
          error: o,
        }),
          (this.triggeringException = !1));
      }
    }
    return !1;
  }
  listenerCount(n) {
    return this._emitter.listenerCount(n);
  }
  destroy() {
    (this.logger.log("destroy"),
      this.trigger(F.DESTROYING, void 0),
      this.detachMedia(),
      this.removeAllListeners(),
      (this._autoLevelCapping = -1),
      (this._url = null),
      this.networkControllers.forEach(i => i.destroy()),
      (this.networkControllers.length = 0),
      this.coreComponents.forEach(i => i.destroy()),
      (this.coreComponents.length = 0));
    const n = this.config;
    ((n.xhrSetup = n.fetchSetup = void 0), (this.userConfig = null));
  }
  attachMedia(n) {
    if (!n || ("media" in n && !n.media)) {
      const h = new Error("attachMedia failed: invalid argument (".concat(n, ")"));
      this.trigger(F.ERROR, { type: et.OTHER_ERROR, details: ge.ATTACH_MEDIA_ERROR, fatal: !0, error: h });
      return;
    }
    (this.logger.log("attachMedia"),
      this._media && (this.logger.warn("media must be detached before attaching"), this.detachMedia()));
    const i = "media" in n,
      o = i ? n.media : n,
      l = i ? n : { media: o };
    ((this._media = o), this.trigger(F.MEDIA_ATTACHING, l));
  }
  detachMedia() {
    (this.logger.log("detachMedia"), this.trigger(F.MEDIA_DETACHING, {}), (this._media = null));
  }
  transferMedia() {
    this._media = null;
    const n = this.bufferController.transferMedia();
    return (this.trigger(F.MEDIA_DETACHING, { transferMedia: n }), n);
  }
  loadSource(n) {
    this.stopLoad();
    const i = this.media,
      o = this._url,
      l = (this._url = aS.buildAbsoluteURL(self.location.href, n, { alwaysNormalize: !0 }));
    ((this._autoLevelCapping = -1),
      (this._maxHdcpLevel = null),
      this.logger.log("loadSource:".concat(l)),
      i &&
        o &&
        (o !== l || this.bufferController.hasSourceTypes()) &&
        (this.detachMedia(), this.attachMedia(i)),
      this.trigger(F.MANIFEST_LOADING, { url: n }));
  }
  get url() {
    return this._url;
  }
  get hasEnoughToStart() {
    return this.streamController.hasEnoughToStart;
  }
  get startPosition() {
    return this.streamController.startPositionValue;
  }
  startLoad(n = -1, i) {
    (this.logger.log("startLoad(".concat(n + (i ? ", <skip seek to start>" : ""), ")")),
      (this.started = !0),
      this.resumeBuffering());
    for (
      let o = 0;
      o < this.networkControllers.length &&
      (this.networkControllers[o].startLoad(n, i), !(!this.started || !this.networkControllers));
      o++
    );
  }
  stopLoad() {
    (this.logger.log("stopLoad"), (this.started = !1));
    for (
      let n = 0;
      n < this.networkControllers.length &&
      (this.networkControllers[n].stopLoad(), !(this.started || !this.networkControllers));
      n++
    );
  }
  get loadingEnabled() {
    return this.started;
  }
  get bufferingEnabled() {
    return this.streamController.bufferingEnabled;
  }
  resumeBuffering() {
    this.bufferingEnabled ||
      (this.logger.log("resume buffering"),
      this.networkControllers.forEach(n => {
        n.resumeBuffering && n.resumeBuffering();
      }));
  }
  pauseBuffering() {
    this.bufferingEnabled &&
      (this.logger.log("pause buffering"),
      this.networkControllers.forEach(n => {
        n.pauseBuffering && n.pauseBuffering();
      }));
  }
  get inFlightFragments() {
    const n = { [Xe.MAIN]: this.streamController.inFlightFrag };
    return (
      this.audioStreamController && (n[Xe.AUDIO] = this.audioStreamController.inFlightFrag),
      this.subtititleStreamController && (n[Xe.SUBTITLE] = this.subtititleStreamController.inFlightFrag),
      n
    );
  }
  swapAudioCodec() {
    (this.logger.log("swapAudioCodec"), this.streamController.swapAudioCodec());
  }
  recoverMediaError() {
    this.logger.log("recoverMediaError");
    const n = this._media,
      i = n == null ? void 0 : n.currentTime;
    (this.detachMedia(), n && (this.attachMedia(n), i && this.startLoad(i)));
  }
  removeLevel(n) {
    this.levelController.removeLevel(n);
  }
  get sessionId() {
    let n = this._sessionId;
    return (n || (n = this._sessionId = $W()), n);
  }
  get levels() {
    const n = this.levelController.levels;
    return n || [];
  }
  get latestLevelDetails() {
    return this.streamController.getLevelDetails() || null;
  }
  get loadLevelObj() {
    return this.levelController.loadLevelObj;
  }
  get currentLevel() {
    return this.streamController.currentLevel;
  }
  set currentLevel(n) {
    (this.logger.log("set currentLevel:".concat(n)),
      (this.levelController.manualLevel = n),
      this.streamController.immediateLevelSwitch());
  }
  get nextLevel() {
    return this.streamController.nextLevel;
  }
  set nextLevel(n) {
    (this.logger.log("set nextLevel:".concat(n)),
      (this.levelController.manualLevel = n),
      this.streamController.nextLevelSwitch());
  }
  get loadLevel() {
    return this.levelController.level;
  }
  set loadLevel(n) {
    (this.logger.log("set loadLevel:".concat(n)), (this.levelController.manualLevel = n));
  }
  get nextLoadLevel() {
    return this.levelController.nextLoadLevel;
  }
  set nextLoadLevel(n) {
    this.levelController.nextLoadLevel = n;
  }
  get firstLevel() {
    return Math.max(this.levelController.firstLevel, this.minAutoLevel);
  }
  set firstLevel(n) {
    (this.logger.log("set firstLevel:".concat(n)), (this.levelController.firstLevel = n));
  }
  get startLevel() {
    const n = this.levelController.startLevel;
    return n === -1 && this.abrController.forcedAutoLevel > -1 ? this.abrController.forcedAutoLevel : n;
  }
  set startLevel(n) {
    (this.logger.log("set startLevel:".concat(n)),
      n !== -1 && (n = Math.max(n, this.minAutoLevel)),
      (this.levelController.startLevel = n));
  }
  get capLevelToPlayerSize() {
    return this.config.capLevelToPlayerSize;
  }
  set capLevelToPlayerSize(n) {
    const i = !!n;
    i !== this.config.capLevelToPlayerSize &&
      (i
        ? this.capLevelController.startCapping()
        : (this.capLevelController.stopCapping(),
          (this.autoLevelCapping = -1),
          this.streamController.nextLevelSwitch()),
      (this.config.capLevelToPlayerSize = i));
  }
  get autoLevelCapping() {
    return this._autoLevelCapping;
  }
  get bandwidthEstimate() {
    const { bwEstimator: n } = this.abrController;
    return n ? n.getEstimate() : NaN;
  }
  set bandwidthEstimate(n) {
    this.abrController.resetEstimator(n);
  }
  get abrEwmaDefaultEstimate() {
    const { bwEstimator: n } = this.abrController;
    return n ? n.defaultEstimate : NaN;
  }
  get ttfbEstimate() {
    const { bwEstimator: n } = this.abrController;
    return n ? n.getEstimateTTFB() : NaN;
  }
  set autoLevelCapping(n) {
    this._autoLevelCapping !== n &&
      (this.logger.log("set autoLevelCapping:".concat(n)),
      (this._autoLevelCapping = n),
      this.levelController.checkMaxAutoUpdated());
  }
  get maxHdcpLevel() {
    return this._maxHdcpLevel;
  }
  set maxHdcpLevel(n) {
    OH(n) &&
      this._maxHdcpLevel !== n &&
      ((this._maxHdcpLevel = n), this.levelController.checkMaxAutoUpdated());
  }
  get autoLevelEnabled() {
    return this.levelController.manualLevel === -1;
  }
  get manualLevel() {
    return this.levelController.manualLevel;
  }
  get minAutoLevel() {
    const {
      levels: n,
      config: { minAutoBitrate: i },
    } = this;
    if (!n) return 0;
    const o = n.length;
    for (let l = 0; l < o; l++) if (n[l].maxBitrate >= i) return l;
    return 0;
  }
  get maxAutoLevel() {
    const { levels: n, autoLevelCapping: i, maxHdcpLevel: o } = this;
    let l;
    if ((i === -1 && n != null && n.length ? (l = n.length - 1) : (l = i), o))
      for (let h = l; h--; ) {
        const p = n[h].attrs["HDCP-LEVEL"];
        if (p && p <= o) return h;
      }
    return l;
  }
  get firstAutoLevel() {
    return this.abrController.firstAutoLevel;
  }
  get nextAutoLevel() {
    return this.abrController.nextAutoLevel;
  }
  set nextAutoLevel(n) {
    this.abrController.nextAutoLevel = n;
  }
  get playingDate() {
    return this.streamController.currentProgramDateTime;
  }
  get mainForwardBufferInfo() {
    return this.streamController.getMainFwdBufferInfo();
  }
  get maxBufferLength() {
    return this.streamController.maxBufferLength;
  }
  setAudioOption(n) {
    var i;
    return ((i = this.audioTrackController) == null ? void 0 : i.setAudioOption(n)) || null;
  }
  setSubtitleOption(n) {
    var i;
    return ((i = this.subtitleTrackController) == null ? void 0 : i.setSubtitleOption(n)) || null;
  }
  get allAudioTracks() {
    const n = this.audioTrackController;
    return n ? n.allAudioTracks : [];
  }
  get audioTracks() {
    const n = this.audioTrackController;
    return n ? n.audioTracks : [];
  }
  get audioTrack() {
    const n = this.audioTrackController;
    return n ? n.audioTrack : -1;
  }
  set audioTrack(n) {
    const i = this.audioTrackController;
    i && (i.audioTrack = n);
  }
  get allSubtitleTracks() {
    const n = this.subtitleTrackController;
    return n ? n.allSubtitleTracks : [];
  }
  get subtitleTracks() {
    const n = this.subtitleTrackController;
    return n ? n.subtitleTracks : [];
  }
  get subtitleTrack() {
    const n = this.subtitleTrackController;
    return n ? n.subtitleTrack : -1;
  }
  get media() {
    return this._media;
  }
  set subtitleTrack(n) {
    const i = this.subtitleTrackController;
    i && (i.subtitleTrack = n);
  }
  get subtitleDisplay() {
    const n = this.subtitleTrackController;
    return n ? n.subtitleDisplay : !1;
  }
  set subtitleDisplay(n) {
    const i = this.subtitleTrackController;
    i && (i.subtitleDisplay = n);
  }
  get lowLatencyMode() {
    return this.config.lowLatencyMode;
  }
  set lowLatencyMode(n) {
    this.config.lowLatencyMode = n;
  }
  get liveSyncPosition() {
    return this.latencyController.liveSyncPosition;
  }
  get latency() {
    return this.latencyController.latency;
  }
  get maxLatency() {
    return this.latencyController.maxLatency;
  }
  get targetLatency() {
    return this.latencyController.targetLatency;
  }
  set targetLatency(n) {
    this.latencyController.targetLatency = n;
  }
  get drift() {
    return this.latencyController.drift;
  }
  get forceStartLoad() {
    return this.streamController.forceStartLoad;
  }
  get pathways() {
    return this.levelController.pathways;
  }
  get pathwayPriority() {
    return this.levelController.pathwayPriority;
  }
  set pathwayPriority(n) {
    this.levelController.pathwayPriority = n;
  }
  get bufferedToEnd() {
    var n;
    return !!((n = this.bufferController) != null && n.bufferedToEnd);
  }
  get interstitialsManager() {
    var n;
    return ((n = this.interstitialsController) == null ? void 0 : n.interstitialsManager) || null;
  }
  getMediaDecodingInfo(n, i = this.allAudioTracks) {
    const o = Uk(i);
    return Nk(n, o, navigator.mediaCapabilities);
  }
}
_o.defaultConfig = void 0;
let Ws = null,
  Mt = null,
  Xs = !1;
const [Jb, VT] = en(!1),
  [Zb, ZM] = en(0),
  [eD, eP] = en(0),
  [pY, nu] = en(!1),
  ma = u => {
    !Xs && Mt && u();
  },
  Qz = () => {
    Mt &&
      (Mt.addEventListener("playing", () => ma(() => VT(!0))),
      Mt.addEventListener("pause", () => ma(() => VT(!1))),
      Mt.addEventListener("timeupdate", () => ma(() => ZM(Mt.currentTime))),
      Mt.addEventListener("loadedmetadata", () =>
        ma(() => {
          (eP(Mt.duration || 0), Zg(!1), nu(!1));
        }),
      ),
      Mt.addEventListener("waiting", () => ma(() => nu(!0))),
      Mt.addEventListener("canplay", () => ma(() => nu(!1))),
      Mt.addEventListener("seeking", () => ma(() => nu(!0))));
  },
  Jz = u => {
    ((Xs = !1),
      (Ws = new _o({
        debug: !1,
        enableWorker: !1,
        liveBackBufferLength: 30,
        maxBufferLength: 30,
        backBufferLength: 30,
      })),
      u instanceof HTMLVideoElement
        ? (Mt = u)
        : ((Mt = document.createElement("video")),
          (Mt.style.cssText = "position:absolute;top:0;left:0;width:100%;height:100%;z-index:-1"),
          (Mt.preload = "auto"),
          (Mt.autoplay = !1),
          (Mt.muted = !1),
          (Mt.playsInline = !0),
          Mt.setAttribute("webkit-playsinline", "true"),
          document.body.insertBefore(Mt, document.body.firstChild)),
      Qz());
  },
  Zz = u => {
    !Ws || !Mt || Xs || (Zg(!0), nu(!0), Ws.attachMedia(Mt), !Xs && Ws.loadSource(u.streamUrl));
  },
  tD = async () => {
    !Mt || Xs || (await Mt.play().catch(() => {}));
  },
  eY = () => {
    !Mt || Xs || Mt.pause();
  },
  tY = () => {
    !Mt || Xs || (Mt.currentTime = Math.min(Mt.currentTime + 5, Mt.duration || 1 / 0));
  },
  nY = () => {
    !Mt || Xs || (Mt.currentTime = Math.max(Mt.currentTime - 5, 0));
  },
  qx = () => {
    if (((Xs = !0), Ws)) {
      try {
        (Ws.stopLoad(), Ws.detachMedia(), Ws.destroy());
      } catch (u) {}
      Ws = null;
    }
    if (Mt) {
      try {
        (Mt.pause(), Mt.removeAttribute("src"), Mt.load(), Mt.remove());
      } catch (u) {}
      Mt = null;
    }
    (VT(!1), nu(!1), ZM(0), eP(0), Zg(!1));
  },
  nD = u => {
    const n = Math.floor(u / 3600),
      i = Math.floor((u % 3600) / 60),
      o = Math.floor(u % 60);
    return ""
      .concat(String(n).padStart(2, "0"), ":")
      .concat(String(i).padStart(2, "0"), ":")
      .concat(String(o).padStart(2, "0"));
  },
  ig = "static/images/player/",
  rg = { width: 66, height: 66, color: 4294967117, $focus: { color: 3978044671 } },
  iD = { fontFace: "Inter", fontWeight: 700, fontSize: 26, lineHeight: 1, letterSpacing: 0 },
  iY = () => {
    let u, n, i;
    const o = Ra(),
      l = () => {
        Jb() ? eY() : tD();
      },
      h = () => {
        nY();
      },
      p = () => {
        tY();
      },
      d = () => {
        (o(-1), qx());
      };
    return (
      ek("navbar"),
      WT(async () => {
        (x_(!0),
          Zg(!0),
          (u = document.querySelector('[data-testid="player"]')),
          Jz(u),
          Zz({ streamUrl: "https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8" }),
          document.querySelector("video"),
          tD());
      }),
      hu(() => {
        (x_(!1), qx());
      }),
      Ae(gu, {
        get when() {
          return !fG();
        },
        get fallback() {
          return Ae(oS, {});
        },
        get children() {
          return Ae(pt, {
            onBackspace: () => {
              (qx(), o(-1));
            },
            get children() {
              return [
                Ae(pt, { id: "gradient", width: 1920, height: 1080, colorBottom: 255, colorTop: "#0000000" }),
                Ae(pt, {
                  display: "flex",
                  flexDirection: "column",
                  justifyContent: "center",
                  width: 1680,
                  height: 126,
                  x: 115,
                  y: 836,
                  color: "#0000000",
                  scroll: "none",
                  get children() {
                    return [
                      Ae(pt, {
                        get children() {
                          return [
                            Ae(pt, {
                              style: rg,
                              src: ig + "back.png",
                              onEnter: d,
                              ref(y) {
                                var v = n;
                                typeof v == "function" ? v(y) : (n = y);
                              },
                              onRight: () => {
                                i == null || i.setFocus();
                              },
                            }),
                            Ae(Id, {
                              ref(y) {
                                var v = i;
                                typeof v == "function" ? v(y) : (i = y);
                              },
                              width: 1690,
                              height: 60,
                              alignItems: "center",
                              justifyContent: "center",
                              scroll: "none",
                              autofocus: !0,
                              selected: 1,
                              onLeft: () => {
                                n == null || n.setFocus();
                              },
                              onUp: y => {
                                y.stopPropagation();
                              },
                              get children() {
                                return [
                                  Ae(pt, {
                                    style: rg,
                                    src: ig + "rewind.png",
                                    onEnter: h,
                                    width: 66,
                                    height: 66,
                                  }),
                                  Ae(pt, {
                                    style: rg,
                                    get src() {
                                      return ig + (Jb() ? "pause.png" : "play.png");
                                    },
                                    onEnter: l,
                                    width: 90,
                                    height: 90,
                                  }),
                                  Ae(pt, {
                                    style: rg,
                                    src: ig + "forward.png",
                                    onEnter: p,
                                    width: 66,
                                    height: 66,
                                  }),
                                ];
                              },
                            }),
                          ];
                        },
                      }),
                      Ae(pt, {
                        height: 31,
                        display: "flex",
                        flexDirection: "row",
                        justifyContent: "spaceBetween",
                        alignItems: "center",
                        get children() {
                          return [
                            Ae(Gn, {
                              style: iD,
                              width: 119,
                              height: 31,
                              get children() {
                                return nD(Zb());
                              },
                            }),
                            Ae(pt, {
                              width: 1404,
                              height: 9,
                              color: 3654932764,
                              get children() {
                                return Ae(pt, {
                                  color: 3978044671,
                                  get width() {
                                    return (Zb() / eD()) * 1404;
                                  },
                                });
                              },
                            }),
                            Ae(Gn, {
                              style: iD,
                              width: 119,
                              height: 31,
                              get children() {
                                return nD(eD());
                              },
                            }),
                          ];
                        },
                      }),
                    ];
                  },
                }),
              ];
            },
          });
        },
      })
    );
  };
Vj(Pn, ST.lightning);
const { render: rY } = u8();
w5(mG);
rY(
  () => (
    O8(ST.keys, ST.keyHoldOptions),
    Ae(rG, {
      get children() {
        return Ae(K8, {
          root: gG,
          get children() {
            return [
              Ae(vx, {
                id: "navbar",
                path: "",
                component: mV,
                get children() {
                  return [
                    Ae(vx, {
                      id: "home",
                      path: "/",
                      component: DV,
                      preload: dV,
                      shouldDispose: () => y_() === "/movies",
                    }),
                    Ae(vx, {
                      id: "movies",
                      path: "/movies",
                      component: FV,
                      preload: hV,
                      shouldDispose: () => y_() === "/",
                    }),
                  ];
                },
              }),
              Ae(hg, { path: "/:mediaType/details/:id", component: zV }),
              Ae(hg, {
                path: "player",
                get children() {
                  return Ae(hg, { component: iY });
                },
              }),
            ];
          },
        });
      },
    })
  ),
);
export { oY as __vite_legacy_guard };
